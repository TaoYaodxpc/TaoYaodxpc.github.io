<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>TaoYaopcğŸ</title>
  
  
  <link href="https://www.taoyaopc.live/atom.xml" rel="self"/>
  
  <link href="https://www.taoyaopc.live/"/>
  <updated>2023-05-04T12:22:39.247Z</updated>
  <id>https://www.taoyaopc.live/</id>
  
  <author>
    <name>TaoYaopcğŸ</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CSSé«˜çº§åŠåº”ç”¨</title>
    <link href="https://www.taoyaopc.live/posts/a9a692a4.html"/>
    <id>https://www.taoyaopc.live/posts/a9a692a4.html</id>
    <published>2023-05-04T12:30:00.000Z</published>
    <updated>2023-05-04T12:22:39.247Z</updated>
    
    <content type="html"><![CDATA[<h1 id="day-07-xue-cheng-zai-xian">day07-å­¦æˆåœ¨çº¿</h1><h2 id="01-xiang-mu-mu-lu" id="01-é¡¹ç›®ç›®å½•">01-é¡¹ç›®ç›®å½•</h2><p>ç½‘ç«™æ ¹ç›®å½•æ˜¯æŒ‡å­˜æ”¾ç½‘ç«™çš„<strong>ç¬¬ä¸€å±‚</strong>æ–‡ä»¶å¤¹ï¼Œå†…éƒ¨åŒ…å«å½“å‰ç½‘ç«™çš„<strong>æ‰€æœ‰ç´ æ</strong>ï¼ŒåŒ…å« HTMLã€CSSã€å›¾ç‰‡ã€JavaScriptç­‰ç­‰ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/28/d1b3315b095146bfa1510e88b7c1d3e5" alt="1680336645218"></p><ul><li>é¦–é¡µå¼•å…¥CSSæ–‡ä»¶</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é¡ºåºè¦æ±‚ï¼šå…ˆæ¸…é™¤å†è®¾ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./css/base.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./css/index.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="02-ban-xin-ju-zhong" id="02-ç‰ˆå¿ƒå±…ä¸­">02-ç‰ˆå¿ƒå±…ä¸­</h2><p><img src="https://s1.vika.cn/space/2023/04/28/0fd87fd1d722498b94a588b3e461a78f" alt="1680336711608"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">Â  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">1200px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f3f5f7</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="03-bu-ju-si-lu" id="03-å¸ƒå±€æ€è·¯">03-å¸ƒå±€æ€è·¯</h2><ol><li>å¸ƒå±€æ€è·¯ï¼šå…ˆæ•´ä½“å†å±€éƒ¨ï¼Œä»å¤–åˆ°å†…ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œä»å·¦åˆ°å³</li><li>CSS å®ç°æ€è·¯<ol><li>ç”»ç›’å­ï¼Œè°ƒæ•´ç›’å­èŒƒå›´ â†’ å®½é«˜èƒŒæ™¯è‰²</li><li>è°ƒæ•´ç›’å­ä½ç½® â†’ flex å¸ƒå±€ã€å†…å¤–è¾¹è·</li><li>æ§åˆ¶å›¾ç‰‡ã€æ–‡å­—å†…å®¹æ ·å¼</li></ol></li></ol><h2 id="04-header-qu-yu-zheng-ti-bu-ju" id="04-headeråŒºåŸŸ-æ•´ä½“å¸ƒå±€">04-headeråŒºåŸŸ-æ•´ä½“å¸ƒå±€</h2><p><img src="https://s1.vika.cn/space/2023/04/28/57dedf38653e437fad0053fbcf3507a7" alt="1680337054328"></p><h3 id="html-jie-gou" id="HTMLç»“æ„">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¤´éƒ¨åŒºåŸŸ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- logo --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span>logo<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¯¼èˆª --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;nav&quot;</span>&gt;</span>å¯¼èˆª<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æœç´¢ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;search&quot;</span>&gt;</span>search<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ç”¨æˆ· --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user&quot;</span>&gt;</span>ç”¨æˆ·<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi" id="CSSæ ·å¼">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å¤´éƒ¨åŒºåŸŸ */</span></span><br><span class="line"><span class="selector-class">.header</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.header</span> <span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">29px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="05-header-qu-yu-logo" id="05-headeråŒºåŸŸ-logo">05-headeråŒºåŸŸ-logo</h2><p><img src="https://s1.vika.cn/space/2023/04/28/52f5318ab7db433886a68f43dd6d64ee" alt="1680337229070"></p><p>logo åŠŸèƒ½ï¼š</p><ul><li>å•å‡»è·³è½¬åˆ°é¦–é¡µ</li><li>æœç´¢å¼•æ“ä¼˜åŒ–ï¼šæå‡ç½‘ç«™ç™¾åº¦æœç´¢æ’å</li></ul><p>å®ç°æ–¹æ³•ï¼š</p><ul><li>æ ‡ç­¾ç»“æ„ï¼šh1 &gt; a &gt; ç½‘ç«™åç§°ï¼ˆæœç´¢å…³é”®å­—ï¼‰</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>å­¦æˆåœ¨çº¿<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>CSS æ ·å¼</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* logo */</span></span><br><span class="line"><span class="selector-class">.logo</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">195px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">41px</span>;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">../images/logo.png</span>);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="06-header-qu-yu-dao-hang" id="06-headeråŒºåŸŸ-å¯¼èˆª">06-headeråŒºåŸŸ-å¯¼èˆª</h2><p>å®ç°æ–¹æ³•ï¼š</p><ul><li>æ ‡ç­¾ç»“æ„ï¼šul &gt; <strong>li * 3</strong> &gt; a</li><li>ä¼˜åŠ¿ï¼š<strong>é¿å…å †ç Œ a æ ‡ç­¾</strong>ï¼Œ<strong>ç½‘ç«™æœç´¢æ’åé™çº§</strong></li></ul><p><img src="https://s1.vika.cn/space/2023/04/28/102ed2a356ad4368b4c4467456c5395d" alt="1680337390943"></p><h3 id="html-jie-gou-1" id="HTMLç»“æ„-2">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>è¯¾ç¨‹<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>èŒä¸šè§„åˆ’<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-1" id="CSSæ ·å¼-2">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å¯¼èˆª */</span></span><br><span class="line"><span class="selector-class">.nav</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">102px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-tag">ul</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">24px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">6px</span> <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">27px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">19px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* actvie ç±»é€‰æ‹©å™¨ï¼Œè¡¨ç¤ºé»˜è®¤é€‰ä¸­çš„a */</span></span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-tag">li</span> <span class="selector-class">.active</span>,</span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">2px</span> solid <span class="number">#00a4ff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="07-header-qu-yu-sou-suo-bu-ju" id="07-headeråŒºåŸŸ-æœç´¢å¸ƒå±€">07-headeråŒºåŸŸ-æœç´¢å¸ƒå±€</h2><p><img src="https://s1.vika.cn/space/2023/04/28/ba32c2fb2243495d95a4b31a07755572" alt="1680337525496"></p><h3 id="html-jie-gou-2" id="HTMLç»“æ„-3">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;search&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-2" id="CSSæ ·å¼-3">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.search</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">64px</span>;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">19px</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">412px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f3f5f7</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="08-header-qu-yu-sou-suo-nei-rong" id="08-headeråŒºåŸŸ-æœç´¢å†…å®¹">08-headeråŒºåŸŸ-æœç´¢å†…å®¹</h2><h3 id="html-jie-gou-3" id="HTMLç»“æ„-4">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;search&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥å…³é”®è¯&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-3" id="CSSæ ·å¼-4">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.search</span> <span class="selector-tag">input</span> &#123;</span><br><span class="line">   <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">   <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">   <span class="attribute">background-color</span>: transparent;</span><br><span class="line">   <span class="comment">/* å»æ‰è¡¨å•æ§ä»¶çš„ç„¦ç‚¹æ¡† */</span></span><br><span class="line">   <span class="attribute">outline</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ::placeholder é€‰ä¸­å°±æ˜¯ placeholder å±æ€§æ–‡å­—æ ·å¼*/</span></span><br><span class="line"><span class="selector-class">.search</span> <span class="selector-tag">input</span><span class="selector-pseudo">::placeholder</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* çˆ¶çº§æ˜¯flexå¸ƒå±€ï¼Œå­çº§å˜å¼¹æ€§ç›’å­ï¼šåŠ å®½é«˜ç”Ÿæ•ˆ */</span></span><br><span class="line"><span class="selector-class">.search</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">align-self</span>: center;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">../images/search.png</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="09-header-qu-yu-yong-hu-qu-yu" id="09-headeråŒºåŸŸ-ç”¨æˆ·åŒºåŸŸ">09-headeråŒºåŸŸ-ç”¨æˆ·åŒºåŸŸ</h2><p><img src="https://s1.vika.cn/space/2023/04/28/e2fa3c53952743f0b652d2f6ac9f1f5d" alt="1680337703358"></p><h3 id="html-jie-gou-4" id="HTMLç»“æ„-5">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/user.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>æ’­ä»”å­¦å‰ç«¯<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-4" id="CSSæ ·å¼-5">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ç”¨æˆ· */</span></span><br><span class="line"><span class="selector-class">.user</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">7px</span>;</span><br><span class="line">  <span class="comment">/* vertical-align è¡Œå†…å—å’Œè¡Œå†…å‚ç›´æ–¹å‘å¯¹é½æ–¹å¼ */</span></span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-banner-qu-yu-bu-ju" id="10-banneråŒºåŸŸ-å¸ƒå±€">10-banneråŒºåŸŸ-å¸ƒå±€</h2><p><img src="https://s1.vika.cn/space/2023/05/03/34bb7af2123141679bb3f87e8441617f" alt="1680337778559"></p><h3 id="html-jie-gou-5" id="HTMLç»“æ„-6">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;banner&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-5" id="CSSæ ·å¼-6">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* banner åŒºåŸŸ */</span></span><br><span class="line"><span class="selector-class">.banner</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">420px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#0092cb</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner</span> <span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">420px</span>;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">../uploads/banner.png</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="11-banner-qu-yu-ce-dao-hang" id="11-banneråŒºåŸŸ-ä¾§å¯¼èˆª">11-banneråŒºåŸŸ-ä¾§å¯¼èˆª</h2><h3 id="html-jie-gou-6" id="HTMLç»“æ„-7">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>å‰ç«¯å¼€å‘<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>åç«¯å¼€å‘<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>ç§»åŠ¨å¼€å‘<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>äººå·¥æ™ºèƒ½<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>å•†ä¸šé¢„æµ‹<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>äº‘è®¡ç®—&amp;å¤§æ•°æ®<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>è¿ç»´&amp;æµ‹è¯•<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>UIè®¾è®¡<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>äº§å“<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-6" id="CSSæ ·å¼-7">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ä¾§å¯¼èˆª */</span></span><br><span class="line"><span class="selector-class">.banner</span> <span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">3px</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">191px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">420px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.42</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner</span> <span class="selector-class">.left</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="comment">/* å—çº§ï¼šå®½åº¦æ˜¯çˆ¶çº§çš„100% */</span></span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">46px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">../images/right.png</span>) no-repeat right center;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">46px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner</span> <span class="selector-class">.left</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">../images/right-hover.png</span>);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#00a4ff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-banner-qu-yu-ke-cheng-biao-bu-ju" id="12-banneråŒºåŸŸ-è¯¾ç¨‹è¡¨å¸ƒå±€">12-banneråŒºåŸŸ-è¯¾ç¨‹è¡¨å¸ƒå±€</h2><p><img src="https://s1.vika.cn/space/2023/05/03/ff64ecee96b14a0f82e045aac2d5fe46" alt="1680338145736"></p><h3 id="html-bu-ju" id="HTMLå¸ƒå±€">HTMLå¸ƒå±€</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>æˆ‘çš„è¯¾ç¨‹è¡¨<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-7" id="CSSæ ·å¼-8">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* è¯¾ç¨‹è¡¨ */</span></span><br><span class="line"><span class="selector-class">.banner</span> <span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">218px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">305px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#209dd5</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner</span> <span class="selector-class">.right</span> <span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">48px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">48px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner</span> <span class="selector-class">.right</span> <span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">257px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="13-banner-qu-yu-ke-cheng-biao-nei-rong" id="13-banneråŒºåŸŸ-è¯¾ç¨‹è¡¨å†…å®¹">13-banneråŒºåŸŸ-è¯¾ç¨‹è¡¨å†…å®¹</h2><h3 id="html-jie-gou-7" id="HTMLç»“æ„-8">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>æ•°æ®å¯è§†åŒ–è¯¾ç¨‹<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>æ­£åœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">span</span>&gt;</span>-<span class="tag">&lt;<span class="name">strong</span>&gt;</span>echartsä½¿ç”¨æ­¥éª¤<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>Vue3åŒ»ç–—é¡¹ç›®è¯¾ç¨‹  <span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>æ­£åœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">span</span>&gt;</span>-<span class="tag">&lt;<span class="name">strong</span>&gt;</span>è®¤è¯†ç»„åˆå¼API<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>Reactæ ¸å¿ƒæŠ€æœ¯è¯¾ç¨‹<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>æ­£åœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">span</span>&gt;</span>-<span class="tag">&lt;<span class="name">strong</span>&gt;</span>rudexé…åˆTSä½¿ç”¨<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-8" id="CSSæ ·å¼-9">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.banner</span> <span class="selector-class">.right</span> <span class="selector-tag">dl</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#e0e0e0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner</span> <span class="selector-class">.right</span> <span class="selector-tag">dt</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner</span> <span class="selector-class">.right</span> <span class="selector-tag">dd</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner</span> <span class="selector-class">.right</span> <span class="selector-tag">dd</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#00a4ff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner</span> <span class="selector-class">.right</span> <span class="selector-tag">dd</span> <span class="selector-tag">strong</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#7d7d7d</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="14-banner-qu-yu-quan-bu-ke-cheng" id="14-banneråŒºåŸŸ-å…¨éƒ¨è¯¾ç¨‹">14-banneråŒºåŸŸ-å…¨éƒ¨è¯¾ç¨‹</h2><h3 id="html-jie-gou-8" id="HTMLç»“æ„-9">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>å…¨éƒ¨è¯¾ç¨‹<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-9" id="CSSæ ·å¼-10">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.banner</span> <span class="selector-class">.right</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#00a4ff</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="15-jing-pin-tui-jian-qu-yu-bu-ju" id="15-ç²¾å“æ¨è-åŒºåŸŸå¸ƒå±€">15-ç²¾å“æ¨è-åŒºåŸŸå¸ƒå±€</h2><p><img src="assets/1680338252106.png" alt="1680338252106"></p><h3 id="html-jie-gou-9" id="HTMLç»“æ„-10">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç²¾å“æ¨è --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;recommend wrapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>ç²¾å“æ¨è<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>HTML<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;modify&quot;</span>&gt;</span>ä¿®æ”¹å…´è¶£<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&lt;/div</span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-10" id="CSSæ ·å¼-11">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ç²¾å“æ¨è */</span></span><br><span class="line"><span class="selector-class">.recommend</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">11px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">1px</span> <span class="number">2px</span> <span class="number">0px</span> <span class="built_in">rgba</span>(<span class="number">211</span>, <span class="number">211</span>, <span class="number">211</span>, <span class="number">0.5</span>);</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">60px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="16-jing-pin-tui-jian-nei-rong-yang-shi" id="16-ç²¾å“æ¨è-å†…å®¹æ ·å¼">16-ç²¾å“æ¨è-å†…å®¹æ ·å¼</h2><h3 id="html-jie-gou-10" id="HTMLç»“æ„-11">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>HTML<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>CSS<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Node.js<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Ajax<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Vue2.0<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Vue3.0<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>TypeScript<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>React<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-11" id="CSSæ ·å¼-12">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.recommend</span> <span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#00a4ff</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.recommend</span> <span class="selector-tag">ul</span> &#123;</span><br><span class="line">  <span class="comment">/* é™¤å»æ ‡é¢˜å’Œä¿®æ”¹å…´è¶£çš„å°ºå¯¸ï¼Œçˆ¶çº§å‰©ä½™å°ºå¯¸éƒ½ç»™ulï¼Œå®ç°æŠŠä¿®æ”¹å…´è¶£æŒ¤åˆ°æœ€å³ä¾§ */</span></span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.recommend</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">border-right</span>: <span class="number">1px</span> solid <span class="number">#e0e0e0</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.recommend</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span><span class="selector-pseudo">:last-child</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">border-right</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.recommend</span> <span class="selector-class">.modify</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#00a4ff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="17-tui-jian-ke-cheng-biao-ti-qu-yu" id="17-æ¨èè¯¾ç¨‹-æ ‡é¢˜åŒºåŸŸ">17-æ¨èè¯¾ç¨‹-æ ‡é¢˜åŒºåŸŸ</h2><p><img src="assets/1680338517515.png" alt="1680338517515"></p><h3 id="html-jie-gou-11" id="HTMLç»“æ„-12">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç²¾å“æ¨èè¯¾ç¨‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;course wrapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æ ‡é¢˜ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>ç²¾å“æ¨è<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;more&quot;</span>&gt;</span>æŸ¥çœ‹å…¨éƒ¨<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å†…å®¹ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bd&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-12" id="CSSæ ·å¼-13">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ¨èè¯¾ç¨‹ */</span></span><br><span class="line"><span class="selector-class">.course</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ ‡é¢˜ - å…¬å…±ç±»ï¼Œä¸å…¶ä»–åŒºåŸŸå…±ç”¨ */</span></span><br><span class="line"><span class="selector-class">.hd</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">60px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.hd</span> <span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">21px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.hd</span> <span class="selector-class">.more</span> &#123;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">../images/more.png</span>) no-repeat right center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="18-tui-jian-ke-cheng-nei-rong-bu-ju" id="18-æ¨èè¯¾ç¨‹-å†…å®¹å¸ƒå±€">18-æ¨èè¯¾ç¨‹-å†…å®¹å¸ƒå±€</h2><h3 id="html-jie-gou-12" id="HTMLç»“æ„-13">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>5<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>6<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>7<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-13" id="CSSæ ·å¼-14">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* è¯¾ç¨‹å†…å®¹ - å…¬å…±ç±» */</span></span><br><span class="line"><span class="selector-class">.bd</span> <span class="selector-tag">ul</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bd</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">228px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">271px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="19-tui-jian-ke-cheng-nei-rong-yang-shi" id="19-æ¨èè¯¾ç¨‹-å†…å®¹æ ·å¼">19-æ¨èè¯¾ç¨‹-å†…å®¹æ ·å¼</h2><h3 id="html-jie-gou-13" id="HTMLç»“æ„-14">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/course01.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>JavaScriptæ•°æ®çœ‹æ¿é¡¹ç›®å®æˆ˜<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">i</span>&gt;</span>1125<span class="tag">&lt;/<span class="name">i</span>&gt;</span>äººåœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/course02.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>Vue.jså®æˆ˜â€”â€”é¢ç»å…¨ç«¯é¡¹ç›®<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">i</span>&gt;</span>2726<span class="tag">&lt;/<span class="name">i</span>&gt;</span>äººåœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/course03.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>ç©è½¬Vueå…¨å®¶æ¡¶ï¼ŒiHRMäººåŠ›èµ„æºé¡¹ç›®<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">i</span>&gt;</span>9456<span class="tag">&lt;/<span class="name">i</span>&gt;</span>äººåœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/course04.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>Vue.jså®æˆ˜åŒ»ç–—é¡¹ç›®â€”â€”ä¼˜åŒ»é—®è¯Š<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">i</span>&gt;</span>7192<span class="tag">&lt;/<span class="name">i</span>&gt;</span>äººåœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/course05.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>å°ç¨‹åºå®æˆ˜ï¼šå°å…”é²œç”µå•†å°ç¨‹åºé¡¹ç›®<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">i</span>&gt;</span>2703<span class="tag">&lt;/<span class="name">i</span>&gt;</span>äººåœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/course06.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>å‰ç«¯æ¡†æ¶Flutterå¼€å‘å®æˆ˜<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">i</span>&gt;</span>2841<span class="tag">&lt;/<span class="name">i</span>&gt;</span>äººåœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/course07.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>ç†Ÿç»ƒä½¿ç”¨React.jsâ€”â€”æå®¢å›­H5é¡¹ç›®<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">i</span>&gt;</span>95682<span class="tag">&lt;/<span class="name">i</span>&gt;</span>äººåœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/course08.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>ç†Ÿç»ƒä½¿ç”¨React.jsâ€”â€”æå®¢å›­PCç«¯é¡¹ç›®<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">i</span>&gt;</span>904<span class="tag">&lt;/<span class="name">i</span>&gt;</span>äººåœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/course09.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>å‰ç«¯å®ç”¨æŠ€æœ¯ï¼ŒFetch API å®æˆ˜<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">i</span>&gt;</span>1516<span class="tag">&lt;/<span class="name">i</span>&gt;</span>äººåœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/course10.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>å‰ç«¯é«˜çº§Node.jsé›¶åŸºç¡€å…¥é—¨æ•™ç¨‹<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">i</span>&gt;</span>2766<span class="tag">&lt;/<span class="name">i</span>&gt;</span>äººåœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-14" id="CSSæ ·å¼-15">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.bd</span> <span class="selector-tag">li</span> <span class="selector-class">.pic</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">156px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bd</span> <span class="selector-tag">li</span> <span class="selector-class">.text</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">115px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bd</span> <span class="selector-tag">li</span> <span class="selector-class">.text</span> <span class="selector-tag">h4</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">13px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bd</span> <span class="selector-tag">li</span> <span class="selector-class">.text</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#999</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bd</span> <span class="selector-tag">li</span> <span class="selector-class">.text</span> <span class="selector-tag">p</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fa6400</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bd</span> <span class="selector-tag">li</span> <span class="selector-class">.text</span> <span class="selector-tag">p</span> <span class="selector-tag">i</span> &#123;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="20-qian-duan-kai-fa-gong-cheng-shi-qu-yu" id="20-å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆåŒºåŸŸ">20-å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆåŒºåŸŸ</h2><p><img src="assets/1680339112336.png" alt="1680339112336"></p><h3 id="html-jie-gou-14" id="HTMLç»“æ„-15">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å‰ç«¯ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æ ‡é¢˜ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>çƒ­é—¨<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>åˆçº§<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>ä¸­çº§<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;more&quot;</span>&gt;</span>æŸ¥çœ‹å…¨éƒ¨<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/web_left.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;top&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/web_top.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bottom&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/web01.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h4</span>&gt;</span>JSé«˜çº§javaScriptè¿›é˜¶é¢å‘å¯¹è±¡ES6<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">i</span>&gt;</span>101937<span class="tag">&lt;/<span class="name">i</span>&gt;</span>äººåœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/web02.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h4</span>&gt;</span>é›¶åŸºç¡€ç©è½¬å¾®ä¿¡å°ç¨‹åº<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">i</span>&gt;</span>133781<span class="tag">&lt;/<span class="name">i</span>&gt;</span>äººåœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/web03.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h4</span>&gt;</span>JavaScriptåŸºç¡€â€”â€”è¯­æ³•è§£æ+é¡¹ç›®å®æˆ˜<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">i</span>&gt;</span>8927<span class="tag">&lt;/<span class="name">i</span>&gt;</span>äººåœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./uploads/web04.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h4</span>&gt;</span>å‰ç«¯æ¡†æ¶Vue2+Vue3å…¨å¥—è§†é¢‘<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>é«˜çº§<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Â· <span class="tag">&lt;<span class="name">i</span>&gt;</span>26022<span class="tag">&lt;/<span class="name">i</span>&gt;</span>äººåœ¨å­¦ä¹ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-15" id="CSSæ ·å¼-16">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å‰ç«¯ */</span></span><br><span class="line"><span class="selector-class">.hd</span> <span class="selector-tag">ul</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.hd</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.hd</span> <span class="selector-tag">li</span> <span class="selector-class">.active</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#00a4ff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bd</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bd</span> <span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">228px</span>;</span><br><span class="line">  <span class="comment">/* background-color: pink; */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bd</span> <span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">957px</span>;</span><br><span class="line">  <span class="comment">/* background-color: pink; */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bd</span> <span class="selector-class">.right</span> <span class="selector-class">.top</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="21-ban-quan-bu-ju" id="21-ç‰ˆæƒ-å¸ƒå±€">21-ç‰ˆæƒ-å¸ƒå±€</h2><p><img src="assets/1680339154682.png" alt="1680339154682"></p><h3 id="html-jie-gou-15" id="HTMLç»“æ„-16">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç‰ˆæƒ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-16" id="CSSæ ·å¼-17">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ç‰ˆæƒ */</span></span><br><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">273px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.footer</span> <span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.footer</span> <span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">440px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="22-ban-quan-nei-rong" id="22-ç‰ˆæƒ-å†…å®¹">22-ç‰ˆæƒ-å†…å®¹</h2><h3 id="html-jie-gou-16" id="HTMLç»“æ„-17">HTMLç»“æ„</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/logo.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>å­¦æˆåœ¨çº¿è‡´åŠ›äºæ™®åŠä¸­å›½æœ€å¥½çš„æ•™è‚²å®ƒä¸ä¸­å›½ä¸€æµå¤§å­¦å’Œæœºæ„åˆä½œæä¾›åœ¨çº¿è¯¾ç¨‹ã€‚</span><br><span class="line">    Â© 2017å¹´XTCG Inc.ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚-æ²ªICPå¤‡15025210å·<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;download&quot;</span>&gt;</span>ä¸‹è½½APP<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>å…³äºå­¦æˆç½‘<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>å…³äº<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>ç®¡ç†å›¢é˜Ÿ<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>å·¥ä½œæœºä¼š<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>å®¢æˆ·æœåŠ¡<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>å¸®åŠ©<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>æ–°æ‰‹æŒ‡å—<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>å¦‚ä½•æ³¨å†Œ<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>å¦‚ä½•é€‰è¯¾<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>å¦‚ä½•æ‹¿åˆ°æ¯•ä¸šè¯<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>å­¦åˆ†æ˜¯ä»€ä¹ˆ<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>è€ƒè¯•æœªé€šè¿‡æ€ä¹ˆåŠ<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>åˆä½œä¼™ä¼´<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>åˆä½œæœºæ„<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>åˆä½œå¯¼å¸ˆ<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-17" id="CSSæ ·å¼-18">CSSæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.footer</span> <span class="selector-class">.left</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">17px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.footer</span> <span class="selector-class">.left</span> <span class="selector-class">.download</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">120px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">36px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#00a4ff</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">34px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#00a4ff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.footer</span> <span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.footer</span> <span class="selector-class">.right</span> <span class="selector-tag">dl</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">130px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.footer</span> <span class="selector-class">.right</span> <span class="selector-tag">dt</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">23px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.footer</span> <span class="selector-class">.right</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">24px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">CSSé«˜çº§ã€å­¦æˆåœ¨çº¿å’Œå°å…”é²œå„¿æ¡ˆä¾‹åˆ¶ä½œ</summary>
    
    
    
    <category term="Webå‰ç«¯" scheme="https://www.taoyaopc.live/categories/Web%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="Html" scheme="https://www.taoyaopc.live/tags/Html/"/>
    
    <category term="CSS" scheme="https://www.taoyaopc.live/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>CSS åŸºç¡€</title>
    <link href="https://www.taoyaopc.live/posts/58d5387c.html"/>
    <id>https://www.taoyaopc.live/posts/58d5387c.html</id>
    <published>2023-04-20T00:30:00.000Z</published>
    <updated>2023-04-25T03:08:41.415Z</updated>
    
    <content type="html"><![CDATA[<h1 id="day-03-css-ji-chu">day03-CSSåŸºç¡€</h1><blockquote><p>ç›®æ ‡ï¼šæŒæ¡ CSS å±æ€§åŸºæœ¬å†™æ³•ï¼Œèƒ½å¤Ÿä½¿ç”¨æ–‡å­—ç›¸å…³å±æ€§ç¾åŒ–æ–‡ç« é¡µã€‚</p></blockquote><h2 id="01-css-chu-ti-yan" id="01-CSSåˆä½“éªŒ">01-CSSåˆä½“éªŒ</h2><blockquote><p>å±‚å æ ·å¼è¡¨ (Cascading Style Sheetsï¼Œç¼©å†™ä¸º CSSï¼‰ï¼Œæ˜¯ä¸€ç§ <strong>æ ·å¼è¡¨</strong> è¯­è¨€ï¼Œç”¨æ¥<strong>æè¿° HTML æ–‡æ¡£çš„å‘ˆç°</strong>ï¼ˆ<strong>ç¾åŒ–å†…å®¹</strong>ï¼‰ã€‚</p></blockquote><p>ä¹¦å†™ä½ç½®ï¼š<strong>title æ ‡ç­¾ä¸‹æ–¹æ·»åŠ  style åŒæ ‡ç­¾ï¼Œstyle æ ‡ç­¾é‡Œé¢ä¹¦å†™ CSS ä»£ç </strong>ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>CSS åˆä½“éªŒ<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* é€‰æ‹©å™¨ &#123; &#125; */</span></span></span><br><span class="line"><span class="language-css">Â  <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* CSS å±æ€§ */</span></span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">Â  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>ä½“éªŒ CSS<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æç¤ºï¼šå±æ€§åå’Œå±æ€§å€¼æˆå¯¹å‡ºç° â†’ é”®å€¼å¯¹ã€‚</p></blockquote><h2 id="02-css-yin-ru-fang-shi" id="02-CSSå¼•å…¥æ–¹å¼">02-CSSå¼•å…¥æ–¹å¼</h2><ul><li><strong>å†…éƒ¨</strong>æ ·å¼è¡¨ï¼šå­¦ä¹ ä½¿ç”¨<ul><li>CSS ä»£ç å†™åœ¨ style æ ‡ç­¾é‡Œé¢</li></ul></li><li><strong>å¤–éƒ¨</strong>æ ·å¼è¡¨ï¼šå¼€å‘ä½¿ç”¨<ul><li>CSS ä»£ç å†™åœ¨å•ç‹¬çš„ CSS æ–‡ä»¶ä¸­ï¼ˆ<strong>.css</strong>ï¼‰</li><li>åœ¨ HTML ä½¿ç”¨ link æ ‡ç­¾å¼•å…¥</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./my.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><strong>è¡Œå†…</strong>æ ·å¼ï¼šé…åˆ JavaScript ä½¿ç”¨<ul><li>CSS å†™åœ¨æ ‡ç­¾çš„ style å±æ€§å€¼é‡Œ</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;color: red; font-size:20px;&quot;</span>&gt;</span>è¿™æ˜¯ div æ ‡ç­¾<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šä¼˜å…ˆçº§ï¼šè¡Œå†…æ ·å¼ &gt; å¤–éƒ¨æ ·å¼ &gt; å†…éƒ¨æ ·å¼</p></blockquote><h2 id="03-xuan-ze-qi" id="03-é€‰æ‹©å™¨">03-é€‰æ‹©å™¨</h2><p>ä½œç”¨ï¼š<strong>æŸ¥æ‰¾æ ‡ç­¾</strong>ï¼Œè®¾ç½®æ ·å¼ã€‚</p><h3 id="biao-qian-xuan-ze-qi" id="æ ‡ç­¾é€‰æ‹©å™¨">æ ‡ç­¾é€‰æ‹©å™¨</h3><p>æ ‡ç­¾é€‰æ‹©å™¨ï¼šä½¿ç”¨<strong>æ ‡ç­¾å</strong>ä½œä¸ºé€‰æ‹©å™¨ â†’ é€‰ä¸­<strong>åŒåæ ‡ç­¾è®¾ç½®ç›¸åŒçš„æ ·å¼</strong>ã€‚</p><p>ä¾‹å¦‚ï¼šp, h1, div, a, imgâ€¦</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">Â  <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">Â  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šæ ‡ç­¾é€‰æ‹©å™¨<strong>æ— æ³•å·®å¼‚åŒ–</strong>åŒåæ ‡ç­¾çš„æ˜¾ç¤ºæ•ˆæœã€‚</p></blockquote><h3 id="lei-xuan-ze-qi" id="ç±»é€‰æ‹©å™¨">ç±»é€‰æ‹©å™¨</h3><p>ä½œç”¨ï¼šæŸ¥æ‰¾æ ‡ç­¾ï¼Œ<strong>å·®å¼‚åŒ–</strong>è®¾ç½®æ ‡ç­¾çš„æ˜¾ç¤ºæ•ˆæœã€‚</p><p>æ­¥éª¤ï¼š</p><ul><li>å®šä¹‰ç±»é€‰æ‹©å™¨ â†’ <strong>.ç±»å</strong></li><li>ä½¿ç”¨ç±»é€‰æ‹©å™¨ â†’ æ ‡ç­¾æ·»åŠ  <strong>class=â€œç±»åâ€</strong></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">Â  <span class="comment">/* å®šä¹‰ç±»é€‰æ‹©å™¨ */</span></span></span><br><span class="line"><span class="language-css">Â  <span class="selector-class">.red</span> &#123;</span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">Â  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨ç±»é€‰æ‹©å™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;red&quot;</span>&gt;</span>è¿™æ˜¯ div æ ‡ç­¾<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;red size&quot;</span>&gt;</span>div æ ‡ç­¾<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ul><li>ç±»å<strong>è‡ªå®šä¹‰</strong>ï¼Œä¸è¦ç”¨çº¯æ•°å­—æˆ–ä¸­æ–‡ï¼Œå°½é‡ç”¨è‹±æ–‡å‘½å</li><li>ä¸€ä¸ªç±»é€‰æ‹©å™¨<strong>å¯ä»¥ä¾›å¤šä¸ªæ ‡ç­¾ä½¿ç”¨</strong></li><li><strong>ä¸€ä¸ªæ ‡ç­¾å¯ä»¥ä½¿ç”¨å¤šä¸ªç±»å</strong>ï¼Œç±»åä¹‹é—´ç”¨<strong>ç©ºæ ¼</strong>éš”å¼€</li></ul><blockquote><p>å¼€å‘ä¹ æƒ¯ï¼šç±»åè§åçŸ¥æ„ï¼Œå¤šä¸ªå•è¯å¯ä»¥ç”¨ - è¿æ¥ï¼Œä¾‹å¦‚ï¼šnews-hdã€‚</p></blockquote><h3 id="id-xuan-ze-qi" id="idé€‰æ‹©å™¨">idé€‰æ‹©å™¨</h3><p>ä½œç”¨ï¼šæŸ¥æ‰¾æ ‡ç­¾ï¼Œå·®å¼‚åŒ–è®¾ç½®æ ‡ç­¾çš„æ˜¾ç¤ºæ•ˆæœã€‚</p><p>åœºæ™¯ï¼šid é€‰æ‹©å™¨ä¸€èˆ¬<strong>é…åˆ JavaScript</strong> ä½¿ç”¨ï¼Œå¾ˆå°‘ç”¨æ¥è®¾ç½® CSS æ ·å¼</p><p>æ­¥éª¤ï¼š</p><ul><li>å®šä¹‰ id é€‰æ‹©å™¨ â†’ #idå</li><li>ä½¿ç”¨ id é€‰æ‹©å™¨ â†’ æ ‡ç­¾æ·»åŠ  id= â€œidåâ€</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">Â  <span class="comment">/* å®šä¹‰ id é€‰æ‹©å™¨ */</span></span></span><br><span class="line"><span class="language-css">Â  <span class="selector-id">#red</span> &#123;</span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">Â  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨ id é€‰æ‹©å™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;red&quot;</span>&gt;</span>è¿™æ˜¯ div æ ‡ç­¾<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>è§„åˆ™ï¼šåŒä¸€ä¸ª id é€‰æ‹©å™¨åœ¨ä¸€ä¸ªé¡µé¢åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚</p></blockquote><h3 id="tong-pei-fu-xuan-ze-qi" id="é€šé…ç¬¦é€‰æ‹©å™¨">é€šé…ç¬¦é€‰æ‹©å™¨</h3><p>ä½œç”¨ï¼šæŸ¥æ‰¾é¡µé¢<strong>æ‰€æœ‰</strong>æ ‡ç­¾ï¼Œè®¾ç½®ç›¸åŒæ ·å¼ã€‚</p><p>é€šé…ç¬¦é€‰æ‹©å™¨ï¼š *<strong>ï¼Œä¸éœ€è¦è°ƒç”¨</strong>ï¼Œæµè§ˆå™¨è‡ªåŠ¨æŸ¥æ‰¾é¡µé¢æ‰€æœ‰æ ‡ç­¾ï¼Œè®¾ç½®ç›¸åŒçš„æ ·å¼</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»éªŒï¼šé€šé…ç¬¦é€‰æ‹©å™¨å¯ä»¥ç”¨äº<strong>æ¸…é™¤æ ‡ç­¾çš„é»˜è®¤æ ·å¼</strong>ï¼Œä¾‹å¦‚ï¼šæ ‡ç­¾é»˜è®¤çš„å¤–è¾¹è·ã€å†…è¾¹è·ã€‚</p></blockquote><p><img src="https://s1.vika.cn/space/2023/04/18/4884ccdfcdd24491849e04f60005f0f8" alt="1680317584651"></p><h2 id="04-he-zi-chi-cun-he-bei-jing-se" id="04-ç›’å­å°ºå¯¸å’ŒèƒŒæ™¯è‰²">04-ç›’å­å°ºå¯¸å’ŒèƒŒæ™¯è‰²</h2><table><thead><tr><th>å±æ€§å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>width</td><td>å®½åº¦</td></tr><tr><td>height</td><td>é«˜åº¦</td></tr><tr><td>background-color</td><td>èƒŒæ™¯è‰²</td></tr></tbody></table><h2 id="05-wen-zi-kong-zhi-shu-xing" id="05-æ–‡å­—æ§åˆ¶å±æ€§">05-æ–‡å­—æ§åˆ¶å±æ€§</h2><p><img src="https://s1.vika.cn/space/2023/04/18/c04f631d6974468a969feec1fbc8e7c9" alt="image-20230418214314266"></p><h3 id="zi-ti-da-xiao" id="å­—ä½“å¤§å°">å­—ä½“å¤§å°</h3><ul><li>å±æ€§åï¼š<strong>font-size</strong></li><li>å±æ€§å€¼ï¼šæ–‡å­—å°ºå¯¸ï¼ŒPC ç«¯ç½‘é¡µæœ€å¸¸ç”¨çš„å•ä½ <strong>px</strong></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">Â  <span class="attribute">font-size</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»éªŒï¼šè°·æ­Œæµè§ˆå™¨é»˜è®¤å­—å·æ˜¯16pxã€‚</p><p>æ³¨æ„ï¼šå­—å·å¿…é¡»æœ‰å•ä½ï¼ˆå¦‚ï¼špxï¼‰</p></blockquote><h3 id="zi-ti-cu-xi" id="å­—ä½“ç²—ç»†ï¼š">å­—ä½“ç²—ç»†ï¼š</h3><ul><li>å±æ€§åï¼š<strong>font-size</strong></li><li>å±æ€§å€¼ï¼š<ul><li>æ•°å­—ï¼ˆ<strong>å¼€å‘ä½¿ç”¨</strong>ï¼‰<ul><li>æ­£å¸¸ï¼š400</li><li>åŠ ç²—ï¼š700</li></ul></li><li>å…³é”®å­—ï¼š<ul><li>æ­£å¸¸ï¼šnormal</li><li>åŠ ç²—ï¼šbold</li></ul></li></ul></li></ul><h3 id="zi-ti-yang-shi-shi-fou-qing-xie" id="å­—ä½“æ ·å¼ï¼ˆæ˜¯å¦å€¾æ–œï¼‰">å­—ä½“æ ·å¼ï¼ˆæ˜¯å¦å€¾æ–œï¼‰</h3><p>ä½œç”¨ï¼šæ¸…é™¤æ–‡å­—é»˜è®¤çš„å€¾æ–œæ•ˆæœ</p><p>å±æ€§åï¼š<strong>font-style</strong></p><p>å±æ€§å€¼</p><ul><li>æ­£å¸¸ï¼ˆä¸å€¾æ–œï¼‰ï¼š<strong>normal</strong></li><li>å€¾æ–œï¼š<strong>italic</strong></li></ul><h3 id="xing-gao" id="è¡Œé«˜">è¡Œé«˜</h3><p>ä½œç”¨ï¼šè®¾ç½®å¤šè¡Œæ–‡æœ¬çš„é—´è·</p><p>å±æ€§åï¼šline-height</p><p>å±æ€§å€¼</p><ul><li>æ•°å­— + px</li><li>æ•°å­—ï¼ˆå½“å‰æ ‡ç­¾font-sizeå±æ€§å€¼çš„å€æ•°ï¼‰</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å½“å‰æ ‡ç­¾å­—ä½“å¤§å°ä¸º16px */</span></span><br><span class="line"><span class="attribute">line-height</span>: <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p><img src="https://s1.vika.cn/space/2023/04/19/cb282b2f139742c8a9d86a45ed9bd667" alt="1680317770048"></p><blockquote><p>è¡Œé«˜çš„æµ‹é‡æ–¹æ³•ï¼šä»ä¸€è¡Œæ–‡å­—çš„æœ€é¡¶ç«¯ï¼ˆæœ€åº•ç«¯ï¼‰é‡åˆ°ä¸‹ä¸€è¡Œæ–‡å­—çš„æœ€é¡¶ç«¯ï¼ˆæœ€åº•ç«¯ï¼‰ã€‚</p></blockquote><h4 id="dan-xing-wen-zi-chui-zhi-ju-zhong" id="å•è¡Œæ–‡å­—å‚ç›´å±…ä¸­">å•è¡Œæ–‡å­—å‚ç›´å±…ä¸­</h4><p>å‚ç›´å±…ä¸­æŠ€å·§ï¼š<strong>è¡Œé«˜å±æ€§å€¼ç­‰äºç›’å­é«˜åº¦å±æ€§å€¼</strong></p><p>æ³¨æ„ï¼šè¯¥æŠ€å·§é€‚ç”¨äºå•è¡Œæ–‡å­—å‚ç›´å±…ä¸­æ•ˆæœ</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: skyblue;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* æ³¨æ„ï¼šåªèƒ½æ˜¯å•è¡Œæ–‡å­—å‚ç›´å±…ä¸­ */</span></span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="zi-ti-zu" id="å­—ä½“æ—">å­—ä½“æ—</h3><p>å±æ€§åï¼š<strong>font-family</strong></p><p>å±æ€§å€¼ï¼šå­—ä½“å</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">font-family</span>: æ¥·ä½“;</span><br></pre></td></tr></table></figure><blockquote><p>æ‹“å±•ï¼ˆäº†è§£ï¼‰ï¼šfont-familyå±æ€§å€¼å¯ä»¥ä¹¦å†™å¤šä¸ªå­—ä½“åï¼Œå„ä¸ªå­—ä½“åç”¨é€—å·éš”å¼€ï¼Œæ‰§è¡Œé¡ºåºæ˜¯ä»å·¦å‘å³ä¾æ¬¡æŸ¥æ‰¾</p><ul><li>font-family å±æ€§æœ€åè®¾ç½®ä¸€ä¸ªå­—ä½“æ—åï¼Œç½‘é¡µå¼€å‘å»ºè®®ä½¿ç”¨æ— è¡¬çº¿å­—ä½“</li></ul></blockquote><p><img src="https://s1.vika.cn/space/2023/04/19/6871b4e78ccd4adfb1f01c47e9bd0593" alt="1680318278244"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">font-family</span>: Microsoft YaHei, Heiti SC, tahoma, arial, Hiragino Sans GB, <span class="string">&quot;\5B8B\4F53&quot;</span>, sans-serif;</span><br></pre></td></tr></table></figure><h3 id="font-fu-he-shu-xing" id="fontå¤åˆå±æ€§">fontå¤åˆå±æ€§</h3><p>ä½¿ç”¨åœºæ™¯ï¼šè®¾ç½®ç½‘é¡µæ–‡å­—å…¬å…±æ ·å¼</p><p><img src="https://s1.vika.cn/space/2023/04/19/2fe7efbdf8234bf4871f090c07c3693d" alt="1680318326214"></p><p>å¤åˆå±æ€§ï¼šå±æ€§çš„ç®€å†™æ–¹å¼ï¼Œ<strong>ä¸€ä¸ªå±æ€§å¯¹åº”å¤šä¸ªå€¼çš„å†™æ³•</strong>ï¼Œå„ä¸ªå±æ€§å€¼ä¹‹é—´ç”¨<strong>ç©ºæ ¼</strong>éš”å¼€ã€‚</p><p><strong>font: æ˜¯å¦å€¾æ–œ  æ˜¯å¦åŠ ç²—  å­—å·/è¡Œé«˜ å­—ä½“ï¼ˆå¿…é¡»æŒ‰é¡ºåºä¹¦å†™ï¼‰</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">Â  <span class="attribute">font</span>: italic <span class="number">700</span> <span class="number">30px</span>/<span class="number">2</span> æ¥·ä½“;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šå­—å·å’Œå­—ä½“å€¼å¿…é¡»ä¹¦å†™ï¼Œå¦åˆ™ font å±æ€§ä¸ç”Ÿæ•ˆ ã€‚</p></blockquote><h3 id="wen-ben-suo-jin" id="æ–‡æœ¬ç¼©è¿›">æ–‡æœ¬ç¼©è¿›</h3><p>å±æ€§åï¼š<strong>text-indent</strong></p><p>å±æ€§å€¼ï¼š</p><ul><li>æ•°å­— + px</li><li><strong>æ•°å­— + em</strong>ï¼ˆæ¨èï¼š<strong>1em = å½“å‰æ ‡ç­¾çš„å­—å·å¤§å°</strong>ï¼‰</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">Â  <span class="attribute">text-indent</span>: <span class="number">2em</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="wen-ben-dui-qi-fang-shi" id="æ–‡æœ¬å¯¹é½æ–¹å¼">æ–‡æœ¬å¯¹é½æ–¹å¼</h3><p>ä½œç”¨ï¼šæ§åˆ¶å†…å®¹æ°´å¹³å¯¹é½æ–¹å¼</p><p>å±æ€§åï¼š<strong>text-align</strong></p><table><thead><tr><th>å±æ€§å€¼</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>left</td><td>å·¦å¯¹é½ï¼ˆé»˜è®¤ï¼‰</td></tr><tr><td><strong>center</strong></td><td>å±…ä¸­å¯¹é½</td></tr><tr><td>right</td><td>å³å¯¹é½</td></tr></tbody></table><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">text-align</span>: center;</span><br></pre></td></tr></table></figure><blockquote><p>text-alignæœ¬è´¨æ˜¯æ§åˆ¶å†…å®¹çš„å¯¹é½æ–¹å¼ï¼Œå±æ€§è¦è®¾ç½®ç»™å†…å®¹çš„çˆ¶çº§ã€‚</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">Â  <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">Â  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/1.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="wen-ben-xiu-shi-xian" id="æ–‡æœ¬ä¿®é¥°çº¿">æ–‡æœ¬ä¿®é¥°çº¿</h3><p>å±æ€§åï¼š <strong>text-decoration</strong></p><table><thead><tr><th>å±æ€§å€¼</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td><strong>none</strong></td><td>æ— </td></tr><tr><td><strong>underline</strong></td><td>ä¸‹åˆ’çº¿</td></tr><tr><td>line-through</td><td>åˆ é™¤çº¿</td></tr><tr><td>overline</td><td>ä¸Šåˆ’çº¿</td></tr></tbody></table><h3 id="color-wen-zi-yan-se" id="color-æ–‡å­—é¢œè‰²">color æ–‡å­—é¢œè‰²</h3><table><thead><tr><th>é¢œè‰²è¡¨ç¤ºæ–¹å¼</th><th>å±æ€§å€¼</th><th>è¯´æ˜</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>é¢œè‰²å…³é”®è¯</td><td>é¢œè‰²è‹±æ–‡å•è¯</td><td>redã€greenã€blueã€‚ã€‚ã€‚</td><td>å­¦ä¹ æµ‹è¯•</td></tr><tr><td>rgbè¡¨ç¤ºæ³•</td><td>rgba(r, g, b, a)</td><td>r, g, bè¡¨ç¤ºçº¢ç»¿è“ä¸‰åŸè‰²ï¼Œå–å€¼ï¼š0-255</td><td>äº†è§£æµ‹è¯•</td></tr><tr><td>rgbaè¡¨ç¤ºæ³•</td><td><strong>rgba(r, g, b, a)</strong></td><td>a è¡¨ç¤º<strong>é€æ˜åº¦</strong>ï¼Œå–å€¼ï¼š<code>0-1</code></td><td>å¼€å‘ä½¿ç”¨ï¼Œå®ç°<code>é€æ˜è‰²</code></td></tr><tr><td>åå…­è¿›åˆ¶è¡¨ç¤ºæ³•</td><td><strong>#RRGGBB</strong></td><td>#000000ï¼Œ#ffcc00ï¼Œç®€å†™ï¼š#000ï¼Œ#fc0</td><td>å¼€å‘ä½¿ç”¨ï¼ˆä»è®¾è®¡ç¨¿å¤åˆ¶ï¼‰</td></tr></tbody></table><blockquote><p>æç¤ºï¼šåªè¦å±æ€§å€¼ä¸ºé¢œè‰²ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ä¸Šè¿°å››ç§é¢œè‰²è¡¨ç¤ºæ–¹å¼ï¼Œä¾‹å¦‚ï¼šèƒŒæ™¯è‰²ã€‚</p></blockquote><h2 id="06-diao-shi-gong-ju" id="06-è°ƒè¯•å·¥å…·">06-è°ƒè¯•å·¥å…·</h2><p>ä½œç”¨ï¼šæ£€æŸ¥ã€è°ƒè¯•ä»£ç ï¼›å¸®åŠ©ç¨‹åºå‘˜å‘ç°ä»£ç é—®é¢˜ã€è§£å†³é—®é¢˜</p><ol><li>æ‰“å¼€è°ƒè¯•å·¥å…·</li></ol><ul><li>æµè§ˆå™¨çª—å£å†…ä»»æ„ä½ç½® / é€‰ä¸­æ ‡ç­¾ â†’ é¼ æ ‡å³é”® â†’ æ£€æŸ¥</li><li>F12</li></ul><ol start="2"><li>ä½¿ç”¨è°ƒè¯•å·¥å…·</li></ol><p><img src="https://s1.vika.cn/space/2023/04/19/839d97c1de914683b2e74ae7964e0e39" alt="1680318624523"></p><h2 id="07-zong-he-an-li-yi-xin-wen-xiang-qing" id="07-ç»¼åˆæ¡ˆä¾‹ä¸€-æ–°é—»è¯¦æƒ…">07-ç»¼åˆæ¡ˆä¾‹ä¸€-æ–°é—»è¯¦æƒ…</h2><p>ç½‘é¡µåˆ¶ä½œæ€è·¯ï¼š</p><ol><li>ä»ä¸Šåˆ°ä¸‹ï¼Œå…ˆæ•´ä½“å†å±€éƒ¨</li><li>å…ˆæ ‡ç­¾ï¼Œå† CSS ç¾åŒ–</li></ol><p><img src="https://s1.vika.cn/space/2023/04/20/98539e3a061841d1a6e126c44846d6bb" alt="1680318667113"></p><h3 id="html-biao-qian" id="HTMLæ ‡ç­¾">HTMLæ ‡ç­¾</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>åœ¨å¸Œæœ›çš„ç”°é‡ä¸Š | æ¹–åŒ—ç§‹æ”¶å¼€é•° å„åœ°å¤šä¸¾æªä¿å¢äº§å¢æ”¶<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>æ¥æºï¼šå¤®è§†ç½‘ | 2222å¹´12æœˆ12æ—¥ 12:12:12<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>å¤®è§†ç½‘æ¶ˆæ¯ï¼š<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>çœ¼ä¸‹ï¼Œæ¹–åŒ—çœç§‹æ”¶å¼€é•°å·²æœ‰ä¸€å‘¨å¤šçš„æ—¶é—´ã€‚æ°´ç¨»æ”¶å‰²å·²ç»è¶…è¿‡å››æˆï¼Œç‰ç±³æ”¶å‰²ä¸ƒæˆã€‚æ¹–åŒ—çœé€šè¿‡å¤§åŠ›æ¨å¹¿æ–°å“ç§æ°´ç¨»ï¼Œå»ºè®¾é«˜æ ‡å‡†å†œç”°ç­‰ä¸€ç³»åˆ—æªæ–½ï¼Œä¸ºç§‹ç²®ç¨³äº§æä¾›æœ‰åŠ›æ”¯æ’‘ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>ä¸­ç¨»å æ®äº†æ¹–åŒ—å…¨å¹´ç²®é£Ÿäº§é‡çš„ä¸€åŠä»¥ä¸Šã€‚åœ¨æ¹–åŒ—çš„ä¸»äº§åŒºè†é—¨å¸‚ï¼Œ370ä¸‡äº©ä¸­ç¨»å·²ç»æ”¶å‰²å››æˆä»¥ä¸Šã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./1.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>ç‹åŒ–æ—è¯´çš„æ–°å“ç§ï¼Œæ˜¯æ¹–åŒ—çœç ”å‘çš„æ‚äº¤æ°´ç¨»â€œåå¤é¦™ä¸â€ï¼Œä¸ä»…äº§é‡é«˜ï¼Œè¿˜å…·æœ‰æŠ—ç—…ã€æŠ—å€’ã€æŠ—é«˜æ¸©çš„ç‰¹æ€§ã€‚åœ¨è†é—¨æ¼³æ²³é•‡çš„ä¸€å·¥ç¨‹ç¤ºèŒƒç”°å†…ï¼Œåƒâ€œåå¤é¦™ä¸â€è¿™æ ·æŠ—æ—±èŠ‚æ°´çš„å“ç§è¿˜æœ‰20å¤šä¸ªï¼Œè¿™äº›æ°´ç¨»æ–°å“å°†åœ¨è†é—¨å…¨é¢æ¨å¹¿ï¼Œç¡®ä¿æ¥å¹´å¢äº§å¢æ”¶ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>æ­¤å¤–ï¼Œæ¹–åŒ—è¿˜å¤§åŠ›æ¨è¿›é«˜æ ‡å‡†å†œç”°å»ºè®¾ã€‚æˆªè‡³ä»Šå¹´6æœˆï¼Œå·²å»ºæˆ3980ä¸‡äº©é«˜æ ‡å‡†å†œç”°ã€‚ç›®å‰ï¼Œæ¹–åŒ—å…¨çœä»æœ‰1800å¤šä¸‡äº©ä¸­ç¨»æ­£åœ¨æœ‰åºæ”¶å‰²ä¸­ï¼Œé¢„è®¡10æœˆä¸­æ—¬æ”¶å‰²å®Œæ¯•ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi" id="CSSæ ·å¼">CSSæ ·å¼</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">h1</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: <span class="number">400</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#999</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-indent</span>: <span class="number">2em</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* div &#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">    text-align: center;</span></span></span><br><span class="line"><span class="comment"><span class="language-css">  &#125; */</span></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.pic</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="08-zong-he-an-li-er-css-jian-jie" id="08-ç»¼åˆæ¡ˆä¾‹äºŒ-CSSç®€ä»‹">08-ç»¼åˆæ¡ˆä¾‹äºŒ-CSSç®€ä»‹</h2><p><img src="https://s1.vika.cn/space/2023/04/20/c7d14bae3cc84ba289254e4b47cb9cf5" alt="1680318751246"></p><h3 id="html-biao-qian-1" id="HTMLæ ‡ç­¾-2">HTMLæ ‡ç­¾</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>CSSï¼ˆå±‚å æ ·å¼è¡¨ï¼‰<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>å±‚å æ ·å¼è¡¨ (Cascading Style Sheetsï¼Œç¼©å†™ä¸º CSSï¼‰ï¼Œæ˜¯ä¸€ç§ <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>æ ·å¼è¡¨<span class="tag">&lt;/<span class="name">a</span>&gt;</span> è¯­è¨€ï¼Œç”¨æ¥æè¿° HTML æˆ– XMLï¼ˆåŒ…æ‹¬å¦‚ SVGã€MathMLã€XHTML ä¹‹ç±»çš„ XML åˆ†æ”¯è¯­è¨€ï¼‰æ–‡æ¡£çš„å‘ˆç°ã€‚CSS æè¿°äº†åœ¨å±å¹•ã€çº¸è´¨ã€éŸ³é¢‘ç­‰å…¶å®ƒåª’ä½“ä¸Šçš„å…ƒç´ åº”è¯¥å¦‚ä½•è¢«æ¸²æŸ“çš„é—®é¢˜ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>CSS æ˜¯å¼€æ”¾ç½‘ç»œçš„æ ¸å¿ƒè¯­è¨€ä¹‹ä¸€<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>ï¼Œç”± W3C è§„èŒƒ å®ç°è·¨æµè§ˆå™¨çš„æ ‡å‡†åŒ–ã€‚CSS èŠ‚çœäº†å¤§é‡çš„å·¥ä½œã€‚ æ ·å¼å¯ä»¥é€šè¿‡å®šä¹‰ä¿å­˜åœ¨å¤–éƒ¨.css æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶æ§åˆ¶å¤šä¸ªç½‘é¡µçš„å¸ƒå±€ï¼Œè¿™æ„å‘³ç€å¼€å‘è€…ä¸å¿…ç»å†åœ¨æ‰€æœ‰ç½‘é¡µä¸Šç¼–è¾‘å¸ƒå±€çš„éº»çƒ¦ã€‚CSS è¢«åˆ†ä¸ºä¸åŒç­‰çº§ï¼šCSS1 ç°å·²åºŸå¼ƒï¼Œ CSS2.1 æ˜¯æ¨èæ ‡å‡†ï¼Œ CSS3 åˆ†æˆå¤šä¸ªå°æ¨¡å—ä¸”æ­£åœ¨æ ‡å‡†åŒ–ä¸­ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>CSS ä»‹ç» å¦‚æœä½ æ˜¯ Web å¼€å‘çš„æ–°æ‰‹ï¼Œè¯·åŠ¡å¿…é˜…è¯»æˆ‘ä»¬çš„ CSS åŸºç¡€ æ–‡ç« ä»¥å­¦ä¹  CSS çš„å«ä¹‰å’Œç”¨æ³•ã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>CSS æ•™ç¨‹ æˆ‘ä»¬çš„ CSS å­¦ä¹ åŒº åŒ…å«äº†ä¸°å¯Œçš„æ•™ç¨‹ï¼Œå®ƒä»¬è¦†ç›–äº†å…¨éƒ¨åŸºç¡€çŸ¥è¯†ï¼Œèƒ½ä½¿ä½ åœ¨ CSS ä¹‹è·¯ä¸Šä»åˆå‡ºèŒ…åºåˆ°æ¸¸åˆƒæœ‰ä½™ã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>CSS å‚è€ƒ é’ˆå¯¹èµ„æ·± Web å¼€å‘è€…çš„ <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>è¯¦ç»†å‚è€ƒæ‰‹å†Œ<span class="tag">&lt;/<span class="name">a</span>&gt;</span> ï¼Œæè¿°äº† CSS çš„å„ä¸ªå±æ€§ä¸æ¦‚å¿µã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-1" id="CSSæ ·å¼-2">CSSæ ·å¼</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">h1</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-indent</span>: <span class="number">2em</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#444</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">line-height</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#0069c2</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">li</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#444</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">line-height</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="day-04-css-jin-jie">day04-CSSè¿›é˜¶</h1><blockquote><p>ç›®æ ‡ï¼šæŒæ¡å¤åˆé€‰æ‹©å™¨ä½œç”¨å’Œå†™æ³•ï¼›ä½¿ç”¨backgroundå±æ€§æ·»åŠ èƒŒæ™¯æ•ˆæœ</p></blockquote><h2 id="01-fu-he-xuan-ze-qi" id="01-å¤åˆé€‰æ‹©å™¨">01-å¤åˆé€‰æ‹©å™¨</h2><p>å®šä¹‰ï¼šç”±ä¸¤ä¸ªæˆ–å¤šä¸ªåŸºç¡€é€‰æ‹©å™¨ï¼Œé€šè¿‡ä¸åŒçš„æ–¹å¼ç»„åˆè€Œæˆã€‚</p><p>ä½œç”¨ï¼šæ›´å‡†ç¡®ã€æ›´é«˜æ•ˆçš„é€‰æ‹©ç›®æ ‡å…ƒç´ ï¼ˆæ ‡ç­¾ï¼‰ã€‚</p><h3 id="hou-dai-xuan-ze-qi" id="åä»£é€‰æ‹©å™¨">åä»£é€‰æ‹©å™¨</h3><p>åä»£é€‰æ‹©å™¨ï¼š<strong>é€‰ä¸­æŸå…ƒç´ çš„åä»£å…ƒç´ </strong>ã€‚</p><p>é€‰æ‹©å™¨å†™æ³•ï¼šçˆ¶é€‰æ‹©å™¨  å­é€‰æ‹©å™¨ { CSS å±æ€§}ï¼Œçˆ¶å­é€‰æ‹©å™¨ä¹‹é—´ç”¨<strong>ç©ºæ ¼</strong>éš”å¼€ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">Â  <span class="selector-tag">div</span> <span class="selector-tag">span</span> &#123;</span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">Â  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>span æ ‡ç­¾<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>è¿™æ˜¯div çš„å„¿å­<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>å­™å­<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š åä»£é€‰æ‹©å™¨ï¼Œé€‰ä¸­æ‰€æœ‰åä»£ï¼ŒåŒ…å«å„¿å­ã€å­™å­ã€é‡å­™å­â€¦</p></blockquote><h3 id="zi-dai-xuan-ze-qi" id="å­ä»£é€‰æ‹©å™¨">å­ä»£é€‰æ‹©å™¨</h3><p>å­ä»£é€‰æ‹©å™¨ï¼šé€‰ä¸­æŸå…ƒç´ çš„å­ä»£å…ƒç´ ï¼ˆ<strong>æœ€è¿‘çš„å­çº§</strong>ï¼‰ã€‚</p><p>é€‰æ‹©å™¨å†™æ³•ï¼šçˆ¶é€‰æ‹©å™¨ &gt; å­é€‰æ‹©å™¨ { CSS å±æ€§}ï¼Œçˆ¶å­é€‰æ‹©å™¨ä¹‹é—´ç”¨ <strong>&gt;</strong> éš”å¼€ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">Â  <span class="selector-tag">div</span> &gt; <span class="selector-tag">span</span> &#123;</span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">Â  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">span</span>&gt;</span>è¿™æ˜¯ div é‡Œé¢çš„ span<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">Â  Â  <span class="tag">&lt;<span class="name">span</span>&gt;</span>è¿™æ˜¯ div é‡Œé¢çš„ p é‡Œé¢çš„ span<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="bing-ji-xuan-ze-qi" id="å¹¶é›†é€‰æ‹©å™¨">å¹¶é›†é€‰æ‹©å™¨</h3><p>å¹¶é›†é€‰æ‹©å™¨ï¼šé€‰ä¸­<strong>å¤šç»„æ ‡ç­¾</strong>è®¾ç½®<strong>ç›¸åŒ</strong>çš„æ ·å¼ã€‚</p><p>é€‰æ‹©å™¨å†™æ³•ï¼šé€‰æ‹©å™¨1, é€‰æ‹©å™¨2, â€¦, é€‰æ‹©å™¨N { CSS å±æ€§}ï¼Œé€‰æ‹©å™¨ä¹‹é—´ç”¨ <strong>,</strong> éš”å¼€ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">Â  <span class="selector-tag">div</span>,</span></span><br><span class="line"><span class="language-css">Â  <span class="selector-tag">p</span>,</span></span><br><span class="line"><span class="language-css">Â  <span class="selector-tag">span</span> &#123;</span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">Â  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span> div æ ‡ç­¾<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>p æ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>span æ ‡ç­¾<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="jiao-ji-xuan-ze-qi" id="äº¤é›†é€‰æ‹©å™¨">äº¤é›†é€‰æ‹©å™¨</h3><p>äº¤é›†é€‰æ‹©å™¨ï¼šé€‰ä¸­<strong>åŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶</strong>çš„å…ƒç´ ã€‚</p><p>é€‰æ‹©å™¨å†™æ³•ï¼šé€‰æ‹©å™¨1é€‰æ‹©å™¨2 { CSS å±æ€§}ï¼Œé€‰æ‹©å™¨ä¹‹é—´è¿å†™ï¼Œæ²¡æœ‰ä»»ä½•ç¬¦å·ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">Â  <span class="selector-tag">p</span><span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">Â  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>p æ ‡ç­¾ï¼Œä½¿ç”¨äº†ç±»é€‰æ‹©å™¨ box<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>p æ ‡ç­¾<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>div æ ‡ç­¾ï¼Œä½¿ç”¨äº†ç±»é€‰æ‹©å™¨ box<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šå¦‚æœäº¤é›†é€‰æ‹©å™¨ä¸­æœ‰æ ‡ç­¾é€‰æ‹©å™¨ï¼Œæ ‡ç­¾é€‰æ‹©å™¨å¿…é¡»ä¹¦å†™åœ¨æœ€å‰é¢ã€‚</p></blockquote><h3 id="wei-lei-xuan-ze-qi" id="ä¼ªç±»é€‰æ‹©å™¨">ä¼ªç±»é€‰æ‹©å™¨</h3><p>ä¼ªç±»é€‰æ‹©å™¨ï¼šä¼ªç±»è¡¨ç¤ºå…ƒç´ <strong>çŠ¶æ€</strong>ï¼Œé€‰ä¸­å…ƒç´ çš„æŸä¸ªçŠ¶æ€è®¾ç½®æ ·å¼ã€‚</p><p>é¼ æ ‡æ‚¬åœçŠ¶æ€ï¼š<strong>é€‰æ‹©å™¨:hover { CSS å±æ€§ }</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">Â  <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">Â  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.box</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">color</span>: green;</span></span><br><span class="line"><span class="language-css">Â  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>a æ ‡ç­¾<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>div æ ‡ç­¾<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="chao-lian-jie-wei-lei" id="è¶…é“¾æ¥ä¼ªç±»">è¶…é“¾æ¥ä¼ªç±»</h4><table><thead><tr><th>é€‰æ‹©å™¨</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>:link</td><td>è®¿é—®å‰</td></tr><tr><td>:visited</td><td>è®¿é—®å</td></tr><tr><td>:hover</td><td>é¼ æ ‡æ‚¬åœ</td></tr><tr><td>:active</td><td>ç‚¹å‡»æ—¶ï¼ˆæ¿€æ´»ï¼‰</td></tr></tbody></table><blockquote><p>æç¤ºï¼šå¦‚æœè¦ç»™è¶…é“¾æ¥è®¾ç½®ä»¥ä¸Šå››ä¸ªçŠ¶æ€ï¼Œéœ€è¦æŒ‰ LVHA çš„é¡ºåºä¹¦å†™ã€‚</p><p>ç»éªŒï¼šå·¥ä½œä¸­ï¼Œä¸€ä¸ª a æ ‡ç­¾é€‰æ‹©å™¨è®¾ç½®è¶…é“¾æ¥çš„æ ·å¼ï¼Œ hoverçŠ¶æ€ç‰¹æ®Šè®¾ç½®</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="02-css-te-xing" id="02-CSSç‰¹æ€§">02-CSSç‰¹æ€§</h2><p>CSSç‰¹æ€§ï¼šåŒ–ç®€ä»£ç  / å®šä½é—®é¢˜ï¼Œå¹¶è§£å†³é—®é¢˜</p><ul><li>ç»§æ‰¿æ€§</li><li>å±‚å æ€§</li><li>ä¼˜å…ˆçº§</li></ul><h3 id="ji-cheng-xing" id="ç»§æ‰¿æ€§">ç»§æ‰¿æ€§</h3><p>ç»§æ‰¿æ€§ï¼šå­çº§é»˜è®¤ç»§æ‰¿çˆ¶çº§çš„<strong>æ–‡å­—æ§åˆ¶å±æ€§</strong>ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/20/8e83496e9db24b0b9dbbeb229c5b968c" alt="1680319376438"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-weight</span>: <span class="number">700</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: aqua;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>div <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>p<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>span <span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>a æ ‡ç­¾<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>h1 æ ‡ç­¾<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p><img src="https://s1.vika.cn/space/2023/04/20/cf121bfd113440c6aa5d1d4dbe78bdc2" alt="image-20230420104425599"></p><p>æ³¨æ„ï¼šå¦‚æœæ ‡ç­¾æœ‰é»˜è®¤æ–‡å­—æ ·å¼ä¼šç»§æ‰¿å¤±è´¥ã€‚ ä¾‹å¦‚ï¼ša æ ‡ç­¾çš„é¢œè‰²ã€æ ‡é¢˜çš„å­—ä½“å¤§å°ã€‚</p></blockquote><h3 id="ceng-die-xing" id="å±‚å æ€§">å±‚å æ€§</h3><p>ç‰¹ç‚¹ï¼š</p><ul><li>ç›¸åŒçš„å±æ€§ä¼šè¦†ç›–ï¼š<strong>åé¢çš„ CSS å±æ€§è¦†ç›–å‰é¢çš„ CSS å±æ€§</strong></li><li>ä¸åŒçš„å±æ€§ä¼šå åŠ ï¼š<strong>ä¸åŒçš„ CSS å±æ€§éƒ½ç”Ÿæ•ˆ</strong></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">Â  <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: <span class="number">700</span>;</span></span><br><span class="line"><span class="language-css">Â  &#125;</span></span><br><span class="line"><span class="language-css">Â  <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">color</span>: green;</span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">Â  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>div æ ‡ç­¾<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šé€‰æ‹©å™¨ç±»å‹ç›¸åŒåˆ™éµå¾ªå±‚å æ€§ï¼Œå¦åˆ™æŒ‰é€‰æ‹©å™¨ä¼˜å…ˆçº§åˆ¤æ–­ã€‚</p></blockquote><h3 id="you-xian-ji" id="ä¼˜å…ˆçº§">ä¼˜å…ˆçº§</h3><p>ä¼˜å…ˆçº§ï¼šä¹Ÿå«æƒé‡ï¼Œå½“ä¸€ä¸ªæ ‡ç­¾<strong>ä½¿ç”¨äº†å¤šç§é€‰æ‹©å™¨æ—¶</strong>ï¼ŒåŸºäºä¸åŒç§ç±»çš„é€‰æ‹©å™¨çš„<strong>åŒ¹é…è§„åˆ™</strong>ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">Â  <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">Â  &#125;</span></span><br><span class="line"><span class="language-css">Â  <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">Â  Â  <span class="attribute">color</span>: green;</span></span><br><span class="line"><span class="language-css">Â  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>div æ ‡ç­¾<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ji-chu-xuan-ze-qi" id="åŸºç¡€é€‰æ‹©å™¨">åŸºç¡€é€‰æ‹©å™¨</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-id">#box</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: yellow;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.div</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: blue;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: green;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    * &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: red <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;div&quot;</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: blueviolet;&quot;</span>&gt;</span>div <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è§„åˆ™ï¼šé€‰æ‹©å™¨<strong>ä¼˜å…ˆçº§é«˜çš„æ ·å¼ç”Ÿæ•ˆ</strong>ã€‚</p><p>å…¬å¼ï¼š<strong>é€šé…ç¬¦é€‰æ‹©å™¨ &lt; æ ‡ç­¾é€‰æ‹©å™¨ &lt; ç±»é€‰æ‹©å™¨ &lt; idé€‰æ‹©å™¨ &lt; è¡Œå†…æ ·å¼ &lt; !important</strong></p><p>â€‹           <strong>ï¼ˆé€‰ä¸­æ ‡ç­¾çš„èŒƒå›´è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½ï¼‰</strong></p><h4 id="fu-he-xuan-ze-qi-die-jia" id="å¤åˆé€‰æ‹©å™¨-å åŠ ">å¤åˆé€‰æ‹©å™¨-å åŠ </h4><p>å åŠ è®¡ç®—ï¼šå¦‚æœæ˜¯å¤åˆé€‰æ‹©å™¨ï¼Œåˆ™éœ€è¦<strong>æƒé‡å åŠ </strong>è®¡ç®—ã€‚</p><p>å…¬å¼ï¼šï¼ˆæ¯ä¸€çº§ä¹‹é—´ä¸å­˜åœ¨è¿›ä½ï¼‰</p><p><img src="https://s1.vika.cn/space/2023/04/20/cbf763ff87254816b5d0e1b12690c61d" alt="1680319646205"></p><p>è§„åˆ™ï¼š</p><ul><li>ä»å·¦å‘å³ä¾æ¬¡æ¯”è¾ƒé€‰ä¸ªæ•°ï¼ŒåŒä¸€çº§ä¸ªæ•°å¤šçš„ä¼˜å…ˆçº§é«˜ï¼Œå¦‚æœä¸ªæ•°ç›¸åŒï¼Œåˆ™å‘åæ¯”è¾ƒ</li><li><strong>!important æƒé‡æœ€é«˜</strong></li><li>ç»§æ‰¿æƒé‡æœ€ä½</li></ul><h2 id="03-emmet-xie-fa" id="03-Emmet-å†™æ³•">03-Emmet å†™æ³•</h2><p>Emmetå†™æ³•ï¼šä»£ç çš„<strong>ç®€å†™</strong>æ–¹å¼ï¼Œè¾“å…¥ç¼©å†™ VS Code ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ä»£ç ã€‚</p><ul><li>HTMLæ ‡ç­¾</li></ul><table><thead><tr><th>è¯´æ˜</th><th>æ ‡ç­¾ç»“æ„</th><th>Emmet</th></tr></thead><tbody><tr><td>ç±»é€‰æ‹©å™¨</td><td><code>&lt;div class=&quot;box&quot;&gt;&lt;/div&gt;</code></td><td><code>æ ‡ç­¾å.ç±»å</code></td></tr><tr><td>id é€‰æ‹©å™¨</td><td><code>&lt;div id=&quot;box&quot;&gt;&lt;/div&gt;</code></td><td><code>æ ‡ç­¾å#idå</code></td></tr><tr><td>åŒçº§æ ‡ç­¾</td><td><code>&lt;div&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;</code></td><td><code>div+p</code></td></tr><tr><td>çˆ¶å­çº§æ ‡ç­¾</td><td><code>&lt;div&gt;&lt;p&gt;&lt;/p&gt;&lt;/div&gt;</code></td><td><code>div&gt;p</code></td></tr><tr><td>å¤šä¸ªç›¸åŒæ ‡ç­¾</td><td><code>&lt;span&gt;1&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;</code></td><td><code>span*3</code></td></tr><tr><td>æœ‰å†…å®¹çš„æ ‡ç­¾</td><td><code>&lt;div&gt;å†…å®¹&lt;/div&gt;</code></td><td><code>div&#123;å†…å®¹&#125;</code></td></tr></tbody></table><ul><li>CSSï¼šå¤§å¤šæ•°ç®€å†™æ–¹å¼ä¸ºå±æ€§å•è¯çš„<strong>é¦–å­—æ¯</strong></li></ul><table><thead><tr><th>è¯´æ˜</th><th>CSS å±æ€§</th><th>Emmet</th></tr></thead><tbody><tr><td>å®½åº¦</td><td><code>width</code></td><td><code>w</code></td></tr><tr><td>å®½åº¦500px</td><td><code>width: 500px;</code></td><td><code>w500</code></td></tr><tr><td>èƒŒæ™¯è‰²</td><td><code>background-color</code></td><td><code>bgc</code></td></tr><tr><td>å¤šä¸ªå±æ€§</td><td><code>width: 200px;height: 100px; background-color: #fff</code></td><td><code>w200+h100+bgc</code></td></tr></tbody></table><h2 id="04-bei-jing-shu-xing" id="04-èƒŒæ™¯å±æ€§">04-èƒŒæ™¯å±æ€§</h2><p><img src="https://s1.vika.cn/space/2023/04/20/359165f396a6442891d4efe2ddf5f057" alt="1680319971861"></p><table><thead><tr><th>æè¿°</th><th>å±æ€§</th></tr></thead><tbody><tr><td>èƒŒæ™¯è‰²</td><td><font style="color:red">background-color</font></td></tr><tr><td>èƒŒæ™¯å›¾</td><td><font style="color:red">background-image</font></td></tr><tr><td>èƒŒæ™¯å›¾å¹³é“ºæ–¹å¼</td><td><font style="color:red">background-repeat</font></td></tr><tr><td>èƒŒæ™¯å›¾ä½ç½®</td><td><font style="color:red">background-position</font></td></tr><tr><td>èƒŒæ™¯å›¾ç¼©æ”¾</td><td><font style="color:red">background-size</font></td></tr><tr><td>èƒŒæ™¯å›¾å›ºå®š</td><td><font style="color:red">background-attachment</font></td></tr><tr><td>èƒŒæ™¯å¤åˆå±æ€§</td><td><font style="color:red">background</font></td></tr></tbody></table><h3 id="bei-jing-tu" id="èƒŒæ™¯å›¾">èƒŒæ™¯å›¾</h3><p>ç½‘é¡µä¸­ï¼Œä½¿ç”¨èƒŒæ™¯å›¾å®ç°è£…é¥°æ€§çš„å›¾ç‰‡æ•ˆæœã€‚</p><ul><li>å±æ€§åï¼š<strong>background-image</strong>ï¼ˆbgiï¼‰</li><li>å±æ€§å€¼ï¼šurl(èƒŒæ™¯å›¾ URL)</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">Â  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line"></span><br><span class="line">Â  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">./images/1.png</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æç¤ºï¼šèƒŒæ™¯å›¾é»˜è®¤æœ‰<strong>å¹³é“ºï¼ˆå¤åˆ¶ï¼‰æ•ˆæœ</strong>ã€‚</p></blockquote><h3 id="ping-pu-fang-shi" id="å¹³é“ºæ–¹å¼">å¹³é“ºæ–¹å¼</h3><p>å±æ€§åï¼š<strong>background-repeat</strong>ï¼ˆbgrï¼‰ q</p><table><thead><tr><th>å±æ€§å€¼</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td><strong>no-repeat</strong></td><td>ä¸å¹³é“º</td></tr><tr><td>repeat</td><td>å¹³é“ºï¼ˆé»˜è®¤æ•ˆæœï¼‰</td></tr><tr><td>repeat-x</td><td>æ°´å¹³æ–¹å‘å¹³é“º</td></tr><tr><td>repeat-y</td><td>å‚ç›´æ–¹å‘å¹³é“º</td></tr></tbody></table><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">Â  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">Â  <span class="attribute">background-color</span>: pink;</span><br><span class="line">Â  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">./images/1.png</span>);</span><br><span class="line"></span><br><span class="line">Â  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="bei-jing-tu-wei-zhi" id="èƒŒæ™¯å›¾ä½ç½®">èƒŒæ™¯å›¾ä½ç½®</h3><p>å±æ€§åï¼š<strong>background-position</strong>ï¼ˆbgpï¼‰</p><p>å±æ€§å€¼ï¼šæ°´å¹³æ–¹å‘ä½ç½® å‚ç›´æ–¹å‘ä½ç½®</p><ul><li><p>å…³é”®å­—</p><p>| å…³é”®å­— | ä½ç½® |<br>| ------ | ---- |<br>| left   | å·¦ä¾§ |<br>| right  | å³ä¾§ |<br>| center | å±…ä¸­ |<br>| top    | é¡¶éƒ¨ |<br>| bottom | åº•éƒ¨ |</p></li><li><p>åæ ‡</p><ul><li>æ°´å¹³ï¼šæ­£æ•°å‘å³ï¼›è´Ÿæ•°å‘å·¦</li><li>å‚ç›´ï¼šæ­£æ•°å‘ä¸‹ï¼›è´Ÿæ•°å‘ä¸Š</li></ul></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">Â  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">Â  <span class="attribute">background-color</span>: pink;</span><br><span class="line">Â  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">./images/1.png</span>);</span><br><span class="line">Â  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line"></span><br><span class="line">Â  <span class="attribute">background-position</span>: center bottom;</span><br><span class="line">Â  <span class="attribute">background-position</span>: <span class="number">50px</span> -<span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-position</span>: <span class="number">50px</span> center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æç¤ºï¼š</p><ul><li>å…³é”®å­—å–å€¼æ–¹å¼å†™æ³•ï¼Œå¯ä»¥é¢ å€’å–å€¼é¡ºåº</li><li>å¯ä»¥åªå†™ä¸€ä¸ªå…³é”®å­—ï¼Œå¦ä¸€ä¸ªæ–¹å‘é»˜è®¤ä¸ºå±…ä¸­ï¼›æ•°å­—åªå†™ä¸€ä¸ªå€¼è¡¨ç¤ºæ°´å¹³æ–¹å‘ï¼Œå‚ç›´æ–¹å‘ä¸ºå±…ä¸­</li></ul></blockquote><h3 id="bei-jing-tu-suo-fang" id="èƒŒæ™¯å›¾ç¼©æ”¾">èƒŒæ™¯å›¾ç¼©æ”¾</h3><p>ä½œç”¨ï¼šè®¾ç½®èƒŒæ™¯å›¾å¤§å°</p><p>å±æ€§åï¼š<strong>background-size</strong>ï¼ˆbgzï¼‰</p><p>å¸¸ç”¨å±æ€§å€¼ï¼š</p><ul><li><p>å…³é”®å­—</p><ul><li>coverï¼šç­‰æ¯”ä¾‹ç¼©æ”¾èƒŒæ™¯å›¾ç‰‡ä»¥å®Œå…¨è¦†ç›–èƒŒæ™¯åŒºï¼Œå¯èƒ½èƒŒæ™¯å›¾ç‰‡éƒ¨åˆ†çœ‹ä¸è§</li><li>containï¼šç­‰æ¯”ä¾‹ç¼©æ”¾èƒŒæ™¯å›¾ç‰‡ä»¥å®Œå…¨è£…å…¥èƒŒæ™¯åŒºï¼Œå¯èƒ½èƒŒæ™¯åŒºéƒ¨åˆ†ç©ºç™½</li></ul></li><li><p>ç™¾åˆ†æ¯”ï¼šæ ¹æ®ç›’å­å°ºå¯¸è®¡ç®—å›¾ç‰‡å¤§å°</p></li><li><p>æ•°å­— + å•ä½ï¼ˆä¾‹å¦‚ï¼špxï¼‰</p></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">Â  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">Â  <span class="attribute">background-color</span>: pink;</span><br><span class="line">Â  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">./images/1.png</span>);</span><br><span class="line">Â  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">Â  </span><br><span class="line">Â  <span class="attribute">background-size</span>: cover;</span><br><span class="line">Â  <span class="attribute">background-size</span>: contain;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æç¤ºï¼šå·¥ä½œä¸­ï¼Œ<strong>å›¾ç‰‡æ¯”ä¾‹ä¸ç›’å­æ¯”ä¾‹ç›¸åŒ</strong>ï¼Œä½¿ç”¨ cover æˆ– contain ç¼©æ”¾èƒŒæ™¯å›¾æ•ˆæœç›¸åŒã€‚</p></blockquote><h3 id="bei-jing-tu-gu-ding" id="èƒŒæ™¯å›¾å›ºå®š">èƒŒæ™¯å›¾å›ºå®š</h3><p>ä½œç”¨ï¼šèƒŒæ™¯ä¸ä¼šéšç€å…ƒç´ çš„å†…å®¹æ»šåŠ¨ã€‚</p><p>å±æ€§åï¼š<strong>background-attachment</strong>ï¼ˆbgaï¼‰</p><p>å±æ€§å€¼ï¼š<strong>fixed</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">Â  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">./images/bg.jpg</span>);</span><br><span class="line">Â  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">Â  <span class="attribute">background-attachment</span>: fixed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="bei-jing-fu-he-shu-xing" id="èƒŒæ™¯å¤åˆå±æ€§">èƒŒæ™¯å¤åˆå±æ€§</h3><p>å±æ€§åï¼š<strong>background</strong>ï¼ˆbgï¼‰</p><p>å±æ€§å€¼ï¼šèƒŒæ™¯è‰² èƒŒæ™¯å›¾ èƒŒæ™¯å›¾å¹³é“ºæ–¹å¼ èƒŒæ™¯å›¾ä½ç½®/èƒŒæ™¯å›¾ç¼©æ”¾  èƒŒæ™¯å›¾å›ºå®šï¼ˆ<strong>ç©ºæ ¼éš”å¼€å„ä¸ªå±æ€§å€¼ï¼Œä¸åŒºåˆ†é¡ºåº</strong>ï¼‰</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">Â  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line"></span><br><span class="line">Â  <span class="attribute">background</span>: pink <span class="built_in">url</span>(<span class="string">./images/1.png</span>) no-repeat right center/cover;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="05-xian-shi-mo-shi" id="05-æ˜¾ç¤ºæ¨¡å¼">05-æ˜¾ç¤ºæ¨¡å¼</h2><p>æ˜¾ç¤ºæ¨¡å¼ï¼šæ ‡ç­¾ï¼ˆå…ƒç´ ï¼‰çš„æ˜¾ç¤ºæ–¹å¼ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/20/de7a1b467841411c8d435c3a098173b5" alt="1680320464551"></p><p>ä½œç”¨ï¼šå¸ƒå±€ç½‘é¡µçš„æ—¶å€™ï¼Œæ ¹æ®æ ‡ç­¾çš„æ˜¾ç¤ºæ¨¡å¼é€‰æ‹©åˆé€‚çš„æ ‡ç­¾æ‘†æ”¾å†…å®¹ã€‚</p><h3 id="kuai-ji-yuan-su" id="å—çº§å…ƒç´ ">å—çº§å…ƒç´ </h3><p>ç‰¹ç‚¹ï¼š</p><ul><li>ç‹¬å ä¸€è¡Œ</li><li>å®½åº¦é»˜è®¤æ˜¯çˆ¶çº§çš„100%</li><li>æ·»åŠ å®½é«˜å±æ€§ç”Ÿæ•ˆ</li></ul><p><img src="https://s1.vika.cn/space/2023/04/20/5c459b885a044594b10847804bee2033" alt="1680320578369"></p><h3 id="xing-nei-yuan-su" id="è¡Œå†…å…ƒç´ ">è¡Œå†…å…ƒç´ </h3><p>ç‰¹ç‚¹ï¼š</p><ul><li>ä¸€è¡Œå¯ä»¥æ˜¾ç¤ºå¤šä¸ª</li><li>è®¾ç½®å®½é«˜å±æ€§ä¸ç”Ÿæ•ˆ</li><li>å®½é«˜å°ºå¯¸ç”±å†…å®¹æ’‘å¼€</li></ul><p><img src="https://s1.vika.cn/space/2023/04/22/b21bf8f9b70642c7aeead3a5168d35ae" alt="1680320583985"></p><h3 id="xing-nei-kuai-yuan-su" id="è¡Œå†…å—å…ƒç´ ">è¡Œå†…å—å…ƒç´ </h3><p>ç‰¹ç‚¹ï¼š</p><ul><li>ä¸€è¡Œå¯ä»¥æ˜¾ç¤ºå¤šä¸ª</li><li>è®¾ç½®å®½é«˜å±æ€§ç”Ÿæ•ˆ</li><li>å®½é«˜å°ºå¯¸ä¹Ÿå¯ä»¥ç”±å†…å®¹æ’‘å¼€</li></ul><p><img src="https://s1.vika.cn/space/2023/04/20/1c4ee22d6ac448889fe5d71bf24b8e6d" alt="1680320590005"></p><h3 id="zhuan-huan-xian-shi-mo-shi" id="è½¬æ¢æ˜¾ç¤ºæ¨¡å¼">è½¬æ¢æ˜¾ç¤ºæ¨¡å¼</h3><p>å±æ€§ï¼š<strong>display</strong></p><table><thead><tr><th>å±æ€§å€¼</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td><strong>block</strong></td><td>å—çº§</td></tr><tr><td><strong>inline-block</strong></td><td>è¡Œå†…å—</td></tr><tr><td>inline</td><td>è¡Œå†…</td></tr></tbody></table><h2 id="06-zong-he-an-li-yi-re-ci" id="06-ç»¼åˆæ¡ˆä¾‹ä¸€-çƒ­è¯">06-ç»¼åˆæ¡ˆä¾‹ä¸€-çƒ­è¯</h2><p><img src="https://s1.vika.cn/space/2023/04/20/857b77c4adb54918b1b37b94745c3e17" alt="1680320664821"></p><h3 id="html-biao-qian-2" id="HTMLæ ‡ç­¾-3">HTMLæ ‡ç­¾</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>HTML<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>CSS<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Vue<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>React<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-2" id="CSSæ ·å¼-3">CSSæ ·å¼</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="comment">/* é»˜è®¤æ•ˆæœ */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css"><span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">height</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">background-color</span>: <span class="number">#3064bb</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">text-decoration</span>: none;</span></span><br><span class="line"><span class="language-css"><span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css"><span class="attribute">line-height</span>: <span class="number">80px</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="comment">/* é¼ æ ‡æ‚¬åœçš„æ•ˆæœ */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">background-color</span>: <span class="number">#608dd9</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="07-zong-he-an-li-er-banner-xiao-guo" id="07-ç»¼åˆæ¡ˆä¾‹äºŒ-â€“-banner-æ•ˆæœ">07-ç»¼åˆæ¡ˆä¾‹äºŒ â€“ banner æ•ˆæœ</h2><p><img src="https://s1.vika.cn/space/2023/04/20/58e378fc09e547cc9107de594e03efdf" alt="1680320758496"></p><h3 id="html-biao-qian-3" id="HTMLæ ‡ç­¾-4">HTMLæ ‡ç­¾</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;banner&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>è®©åˆ›é€ äº§ç”Ÿä»·å€¼<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘ä»¬å¸Œæœ›å°æ¸¸æˆå¹³å°å¯ä»¥æä¾›æ— é™çš„å¯èƒ½æ€§ï¼Œè®©æ¯ä¸€ä¸ªåˆ›ä½œè€…éƒ½å¯ä»¥å°†ä»–ä»¬çš„æ‰åå’Œåˆ›æ„ä¼ é€’ç»™ç”¨æˆ·ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>æˆ‘è¦æŠ¥å<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-3" id="CSSæ ·å¼-4">CSSæ ·å¼</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.banner</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">500px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#f3f3f4</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">./images/bk.png</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-repeat</span>: no-repeat;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-position</span>: left bottom;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="comment">/* æ–‡å­—æ§åˆ¶å±æ€§ï¼Œç»§æ‰¿ç»™å­çº§ */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: right;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.banner</span> <span class="selector-tag">h2</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">36px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: <span class="number">400</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">line-height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.banner</span> <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.banner</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">125px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#f06b1f</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: inline-block;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* è½¬å—çº§æ— æ³•å³å¯¹é½ï¼Œå› ä¸ºå—å…ƒç´ ç‹¬å ä¸€è¡Œ */</span></span></span><br><span class="line"><span class="language-css">    <span class="comment">/* display: block; */</span></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">line-height</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-decoration</span>: none;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="day-05-he-zi-mo-xing">day05-ç›’å­æ¨¡å‹</h1><blockquote><p>ç›®æ ‡ï¼šæŒæ¡ç›’å­æ¨¡å‹ç»„æˆéƒ¨åˆ†ï¼Œä½¿ç”¨ç›’å­æ¨¡å‹å¸ƒå±€ç½‘é¡µåŒºåŸŸ</p></blockquote><h2 id="01-xuan-ze-qi" id="01-é€‰æ‹©å™¨">01-é€‰æ‹©å™¨</h2><h3 id="jie-gou-wei-lei-xuan-ze-qi" id="ç»“æ„ä¼ªç±»é€‰æ‹©å™¨">ç»“æ„ä¼ªç±»é€‰æ‹©å™¨</h3><h3 id="ji-ben-shi-yong" id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</h3><p>ä½œç”¨ï¼šæ ¹æ®å…ƒç´ çš„<strong>ç»“æ„å…³ç³»</strong>æŸ¥æ‰¾å…ƒç´ ã€‚</p><table><thead><tr><th>é€‰æ‹©å™¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>E:first-child</td><td>æŸ¥æ‰¾ç¬¬ä¸€ä¸ª E å…ƒç´ </td></tr><tr><td>E:last-child</td><td>æŸ¥æ‰¾æœ€åä¸€ä¸ª E å…ƒç´ </td></tr><tr><td>E:nth-child(N)</td><td>æŸ¥æ‰¾ç¬¬ N ä¸ª E å…ƒç´ ï¼ˆç¬¬ä¸€ä¸ªå…ƒç´  N å€¼ä½1ï¼‰</td></tr></tbody></table><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">li</span><span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">Â  <span class="attribute">background-color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="nth-child-gong-shi" id="nth-child-å…¬å¼">:nth-child(å…¬å¼)</h3><table><thead><tr><th>åŠŸèƒ½</th><th>å…¬å¼</th></tr></thead><tbody><tr><td>å¶æ•°æ ‡ç­¾</td><td>2n</td></tr><tr><td>å¥‡æ•°æ ‡ç­¾</td><td>2n+1ï¼›2n-1</td></tr><tr><td>æ‰¾åˆ°5çš„å€æ•°çš„æ ‡ç­¾</td><td>5n</td></tr><tr><td>æ‰¾åˆ°ç¬¬5ä¸ªä»¥åçš„æ ‡ç­¾</td><td>n+5</td></tr><tr><td>æ‰¾åˆ°ç¬¬5ä¸ªä»¥å‰çš„æ ‡ç­¾</td><td>-n+5</td></tr></tbody></table><blockquote><p>æç¤ºï¼šå…¬å¼ä¸­çš„nå–å€¼ä» <strong>0</strong> å¼€å§‹ã€‚</p></blockquote><h3 id="wei-yuan-su-xuan-ze-qi" id="ä¼ªå…ƒç´ é€‰æ‹©å™¨">ä¼ªå…ƒç´ é€‰æ‹©å™¨</h3><p>ä½œç”¨ï¼šåˆ›å»º<strong>è™šæ‹Ÿå…ƒç´ </strong>ï¼ˆä¼ªå…ƒç´ ï¼‰ï¼Œç”¨æ¥<strong>æ‘†æ”¾è£…é¥°æ€§çš„å†…å®¹</strong>ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/22/31170cdb070d4ce3b5af101e823c1e11" alt="1680321533901"></p><table><thead><tr><th>é€‰æ‹©å™¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>E::before</td><td>åœ¨ E å…ƒç´ <code>é‡Œé¢</code>æœ€<code>å‰</code>é¢æ·»åŠ ä¸€ä¸ªä¼ªå…ƒç´ </td></tr><tr><td>E::after</td><td>åœ¨ E å…ƒç´ <code>é‡Œé¢</code>æœ€<code>å</code>é¢æ·»åŠ ä¸€ä¸ªä¼ªå…ƒç´ </td></tr></tbody></table><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">Â  <span class="attribute">content</span>: <span class="string">&quot;before ä¼ªå…ƒç´ &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">Â  <span class="attribute">content</span>: <span class="string">&quot;after ä¼ªå…ƒç´ &quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ç‚¹ï¼š</p><ul><li>å¿…é¡»è®¾ç½® <strong>content: â€â€å±æ€§</strong>ï¼Œç”¨æ¥ è®¾ç½®ä¼ªå…ƒç´ çš„å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰å†…å®¹ï¼Œåˆ™<strong>å¼•å·ç•™ç©º</strong>å³å¯</li><li>ä¼ªå…ƒç´ é»˜è®¤æ˜¯<strong>è¡Œå†…</strong>æ˜¾ç¤ºæ¨¡å¼</li><li><strong>æƒé‡å’Œæ ‡ç­¾é€‰æ‹©å™¨ç›¸åŒ</strong></li></ul><h2 id="02-px-cook" id="02-PxCook">02-PxCook</h2><p>PxCookï¼ˆåƒç´ å¤§å¨ï¼‰ æ˜¯ä¸€æ¬¾åˆ‡å›¾è®¾è®¡å·¥å…·è½¯ä»¶ã€‚æ”¯æŒPSDæ–‡ä»¶çš„æ–‡å­—ã€é¢œè‰²ã€è·ç¦»è‡ªåŠ¨æ™ºèƒ½è¯†åˆ«ã€‚</p><ul><li>å¼€å‘é¢æ¿ï¼ˆè‡ªåŠ¨æ™ºèƒ½è¯†åˆ«ï¼‰</li><li>è®¾è®¡é¢æ¿ï¼ˆæ‰‹åŠ¨æµ‹é‡å°ºå¯¸å’Œé¢œè‰²ï¼‰</li></ul><p>ä½¿ç”¨æ–¹æ³•ï¼šåˆ›å»ºé¡¹ç›® â†’ è¾“å…¥ é¡¹ç›®åç§°ã€é¡¹ç›®ç±»å‹ Web â†’ å•å‡»æŒ‰é’®ã€åˆ›å»ºé¡¹ç›®ã€‘ â†’ å•å‡»æŒ‰é’®ã€æ·»åŠ ã€‘ï¼Œå¯¼å…¥è®¾è®¡ç¨¿</p><p><img src="https://s1.vika.cn/space/2023/04/23/d4eabe2d4b4842868b4101f9868c6782" alt="1680321681695"></p><h2 id="03-he-zi-mo-xing" id="03-ç›’å­æ¨¡å‹">03-ç›’å­æ¨¡å‹</h2><p>ä½œç”¨ï¼šå¸ƒå±€ç½‘é¡µï¼Œæ‘†æ”¾ç›’å­å’Œå†…å®¹ã€‚</p><h3 id="he-zi-mo-xing-zu-cheng" id="ç›’å­æ¨¡å‹-ç»„æˆ">ç›’å­æ¨¡å‹-ç»„æˆ</h3><ul><li>å†…å®¹åŒºåŸŸ â€“ width &amp; height</li><li>å†…è¾¹è· â€“ paddingï¼ˆå‡ºç°åœ¨å†…å®¹ä¸ç›’å­è¾¹ç¼˜ä¹‹é—´ï¼‰</li><li>è¾¹æ¡†çº¿ â€“ border</li><li>å¤–è¾¹è· â€“ marginï¼ˆå‡ºç°åœ¨ç›’å­å¤–é¢ï¼‰</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">Â  <span class="attribute">margin</span>: <span class="number">50px</span>;</span><br><span class="line">Â  <span class="attribute">border</span>: <span class="number">5px</span> solid brown;</span><br><span class="line">Â  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">Â  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">Â  <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s1.vika.cn/space/2023/04/23/2cb7a23b79f84018b38e27ef3bee2aa0" alt="1680330928735"></p><p><img src="https://s1.vika.cn/space/2023/04/23/d2302186bae84194a5a99837a3de7bee" alt="1680330935635"></p><h3 id="bian-kuang-xian" id="è¾¹æ¡†çº¿">è¾¹æ¡†çº¿</h3><h4 id="si-ge-fang-xiang" id="å››ä¸ªæ–¹å‘">å››ä¸ªæ–¹å‘</h4><p>å±æ€§åï¼š<strong>border</strong>ï¼ˆbdï¼‰</p><p>å±æ€§å€¼ï¼šè¾¹æ¡†çº¿ç²—ç»†  çº¿æ¡æ ·å¼  é¢œè‰²ï¼ˆä¸åŒºåˆ†é¡ºåºï¼‰</p><table><thead><tr><th>å±æ€§å€¼</th><th>çº¿æ¡æ ·å¼</th></tr></thead><tbody><tr><td>solid</td><td>å®ç°</td></tr><tr><td>dashed</td><td>è™šçº¿</td></tr><tr><td>dotted</td><td>ç‚¹çº¿</td></tr></tbody></table><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">Â  <span class="attribute">border</span>: <span class="number">5px</span> solid brown;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">Â  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">Â  <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="dan-fang-xiang-bian-kuang-xian" id="å•æ–¹å‘è¾¹æ¡†çº¿">å•æ–¹å‘è¾¹æ¡†çº¿</h4><p>å±æ€§åï¼š<strong>border-æ–¹ä½åè¯</strong>ï¼ˆbd+æ–¹ä½åè¯é¦–å­—æ¯ï¼Œä¾‹å¦‚ï¼Œbdlï¼‰</p><p>å±æ€§å€¼ï¼šè¾¹æ¡†çº¿ç²—ç»†  çº¿æ¡æ ·å¼  é¢œè‰²ï¼ˆä¸åŒºåˆ†é¡ºåºï¼‰</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">Â  <span class="attribute">border-top</span>: <span class="number">2px</span> solid red;</span><br><span class="line">Â  <span class="attribute">border-right</span>: <span class="number">3px</span> dashed green;</span><br><span class="line">Â  <span class="attribute">border-bottom</span>: <span class="number">4px</span> dotted blue;</span><br><span class="line">Â  <span class="attribute">border-left</span>: <span class="number">5px</span> solid orange;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">Â  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">Â  <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="nei-bian-ju" id="å†…è¾¹è·">å†…è¾¹è·</h3><p>ä½œç”¨ï¼šè®¾ç½® å†…å®¹ ä¸ ç›’å­è¾¹ç¼˜ ä¹‹é—´çš„è·ç¦»ã€‚</p><ul><li>å±æ€§åï¼špadding / padding-æ–¹ä½åè¯</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="comment">/* å››ä¸ªæ–¹å‘ å†…è¾¹è·ç›¸åŒ */</span></span><br><span class="line">Â  <span class="attribute">padding</span>: <span class="number">30px</span>;</span><br><span class="line">Â  <span class="comment">/* å•ç‹¬è®¾ç½®ä¸€ä¸ªæ–¹å‘å†…è¾¹è· */</span></span><br><span class="line">Â  <span class="attribute">padding-top</span>: <span class="number">10px</span>;</span><br><span class="line">Â  <span class="attribute">padding-right</span>: <span class="number">20px</span>;</span><br><span class="line">Â  <span class="attribute">padding-bottom</span>: <span class="number">40px</span>;</span><br><span class="line">Â  <span class="attribute">padding-left</span>: <span class="number">80px</span>;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">Â  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">Â  <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æç¤ºï¼šæ·»åŠ  padding ä¼šæ’‘å¤§ç›’å­ã€‚</p></blockquote><ul><li>padding å¤šå€¼å†™æ³•</li></ul><table><thead><tr><th>å–å€¼ä¸ªæ•°</th><th>ç¤ºä¾‹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>ä¸€ä¸ªå€¼</td><td><code>padding: 10px;</code></td><td>å››ä¸ªæ–¹å‘å†…è¾¹è·å‡ä¸º10px</td></tr><tr><td>å››ä¸ªå€¼</td><td><code>padding: 10px 20px 40px 80px;</code></td><td>ä¸Šï¼š10pxï¼›å³ï¼š20pxï¼›ä¸‹ï¼š40pxï¼›å·¦ï¼š80px</td></tr><tr><td>ä¸‰ä¸ªå€¼</td><td><code>padding: 10px 40px 80px;</code></td><td>ä¸Šï¼š10pxï¼›å·¦å³ï¼š40pxï¼›ä¸‹ï¼š80px</td></tr><tr><td>ä¸¤ä¸ªå€¼</td><td><code>padding: 10px 80px;</code></td><td>ä¸Šä¸‹ï¼š10pxï¼›å·¦å³ï¼š80px</td></tr></tbody></table><blockquote><p>æŠ€å·§ï¼šä»<strong>ä¸Š</strong>å¼€å§‹<strong>é¡ºæ—¶é’ˆ</strong>èµ‹å€¼ï¼Œå½“å‰æ–¹å‘æ²¡æœ‰æ•°å€¼åˆ™ä¸<strong>å¯¹é¢å–å€¼ç›¸åŒ</strong>ã€‚</p></blockquote><h3 id="chi-cun-ji-suan" id="å°ºå¯¸è®¡ç®—">å°ºå¯¸è®¡ç®—</h3><p><img src="https://s1.vika.cn/space/2023/04/23/063b898e28ae4bec9c5f28b4e92696c4" alt="1680331322935"></p><p>é»˜è®¤æƒ…å†µï¼šç›’å­å°ºå¯¸ = å†…å®¹å°ºå¯¸ + border å°ºå¯¸ + å†…è¾¹è·å°ºå¯¸</p><p>ç»“è®ºï¼šç»™ç›’å­åŠ  border / padding ä¼šæ’‘å¤§ç›’å­</p><p>è§£å†³ï¼š</p><ul><li>æ‰‹åŠ¨åšå‡æ³•ï¼Œå‡æ‰ border / padding çš„å°ºå¯¸</li><li>å…§å‡æ¨¡å¼ï¼š<strong>box-sizing: border-box</strong></li></ul><h3 id="wai-bian-ju" id="å¤–è¾¹è·">å¤–è¾¹è·</h3><p>ä½œç”¨ï¼šæ‹‰å¼€ä¸¤ä¸ªç›’å­ä¹‹é—´çš„è·ç¦»</p><p>å±æ€§åï¼š<strong>margin</strong></p><p>æç¤ºï¼šä¸ padding å±æ€§å€¼å†™æ³•ã€å«ä¹‰ç›¸åŒ</p><h3 id="ban-xin-ju-zhong" id="ç‰ˆå¿ƒå±…ä¸­">ç‰ˆå¿ƒå±…ä¸­</h3><p><img src="https://s1.vika.cn/space/2023/04/23/be96dd8766db47779b4e902a9b56276f" alt="1680331503466"></p><p>å·¦å³ margin å€¼ ä¸º autoï¼ˆç›’å­è¦æœ‰å®½åº¦ï¼‰</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">Â  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">1000px</span>;</span><br><span class="line">Â  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">Â  <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="qing-chu-mo-ren-yang-shi" id="æ¸…é™¤é»˜è®¤æ ·å¼">æ¸…é™¤é»˜è®¤æ ·å¼</h3><p><img src="https://s1.vika.cn/space/2023/04/23/2e37afc727f5427e99a493cc36501d7d" alt="1680331558304"></p><p>æ¸…é™¤æ ‡ç­¾é»˜è®¤çš„æ ·å¼ï¼Œæ¯”å¦‚ï¼šé»˜è®¤çš„å†…å¤–è¾¹è·ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/23/49357ff2d08e4d69b3af08b501541ec4" alt="1680331580746"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ¸…é™¤é»˜è®¤å†…å¤–è¾¹è· */</span></span><br><span class="line">* &#123;</span><br><span class="line">Â  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">Â  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* æ¸…é™¤åˆ—è¡¨é¡¹ç›®ç¬¦å· */</span></span><br><span class="line"><span class="selector-tag">li</span> &#123;</span><br><span class="line">Â  <span class="attribute">list-style</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="yuan-su-yi-chu" id="å…ƒç´ æº¢å‡º">å…ƒç´ æº¢å‡º</h3><p>ä½œç”¨ï¼šæ§åˆ¶æº¢å‡ºå…ƒç´ çš„å†…å®¹çš„æ˜¾ç¤ºæ–¹å¼ã€‚</p><p>å±æ€§åï¼š<strong>overflow</strong></p><table><thead><tr><th>å±æ€§å€¼</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td><strong>hidden</strong></td><td><strong>æº¢å‡ºéšè—</strong></td></tr><tr><td>scroll</td><td>æº¢å‡ºæ»šåŠ¨ï¼ˆæ— è®ºæ˜¯å¦æº¢å‡ºï¼Œéƒ½æ˜¾ç¤ºæ»šåŠ¨æ¡ä½ç½®ï¼‰</td></tr><tr><td>auto</td><td>æº¢å‡ºæ»šåŠ¨ï¼ˆæº¢å‡ºæ‰æ˜¾ç¤ºæ»šåŠ¨æ¡ä½ç½®ï¼‰</td></tr></tbody></table><h3 id="wai-bian-ju-wen-ti" id="å¤–è¾¹è·é—®é¢˜">å¤–è¾¹è·é—®é¢˜</h3><h4 id="he-bing-xian-xiang" id="åˆå¹¶ç°è±¡">åˆå¹¶ç°è±¡</h4><p>åœºæ™¯ï¼š<strong>å‚ç›´</strong>æ’åˆ—çš„å…„å¼Ÿå…ƒç´ ï¼Œä¸Šä¸‹ <strong>margin</strong> ä¼š<strong>åˆå¹¶</strong></p><p>ç°è±¡ï¼šå–ä¸¤ä¸ª margin ä¸­çš„<strong>è¾ƒå¤§å€¼ç”Ÿæ•ˆ</strong></p><p><img src="https://s1.vika.cn/space/2023/04/23/917201a86608427496f6a8e323aa3779" alt="1680331672628"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.one</span> &#123;</span><br><span class="line">Â  <span class="attribute">margin-bottom</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.two</span> &#123;</span><br><span class="line">Â  <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="wai-bian-ju-ta-xian" id="å¤–è¾¹è·å¡Œé™·">å¤–è¾¹è·å¡Œé™·</h4><p>åœºæ™¯ï¼šçˆ¶å­çº§çš„æ ‡ç­¾ï¼Œå­çº§çš„æ·»åŠ  <strong>ä¸Šå¤–è¾¹è·</strong> ä¼šäº§ç”Ÿ<strong>å¡Œé™·</strong>é—®é¢˜</p><p>ç°è±¡ï¼š<strong>å¯¼è‡´çˆ¶çº§ä¸€èµ·å‘ä¸‹ç§»åŠ¨</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.son</span> &#123;</span><br><span class="line">Â  <span class="attribute">margin-top</span>: <span class="number">50px</span>;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">Â  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">Â  <span class="attribute">background-color</span>: orange;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s1.vika.cn/space/2023/04/23/50ebfa5e799f4486a04a0d8b25cfd7c8" alt="1680333860271"></p><p>è§£å†³æ–¹æ³•ï¼š</p><ul><li>å–æ¶ˆå­çº§marginï¼Œçˆ¶çº§è®¾ç½®padding</li><li>çˆ¶çº§è®¾ç½® overflow: hidden</li><li>çˆ¶çº§è®¾ç½® border-top</li></ul><h3 id="xing-nei-yuan-su-nei-wai-bian-ju-wen-ti" id="è¡Œå†…å…ƒç´ -â€“-å†…å¤–è¾¹è·é—®é¢˜">è¡Œå†…å…ƒç´  â€“ å†…å¤–è¾¹è·é—®é¢˜</h3><p>åœºæ™¯ï¼šè¡Œå†…å…ƒç´ æ·»åŠ  margin å’Œ paddingï¼Œæ— æ³•æ”¹å˜å…ƒç´ å‚ç›´ä½ç½®</p><p>è§£å†³æ–¹æ³•ï¼šç»™è¡Œå†…å…ƒç´ æ·»åŠ  <strong>line-height</strong> å¯ä»¥æ”¹å˜å‚ç›´ä½ç½®</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">span</span> &#123;</span><br><span class="line">Â  <span class="comment">/* margin å’Œ padding å±æ€§ï¼Œæ— æ³•æ”¹å˜å‚ç›´ä½ç½® */</span></span><br><span class="line">Â  <span class="attribute">margin</span>: <span class="number">50px</span>;</span><br><span class="line">Â  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">Â  <span class="comment">/* è¡Œé«˜å¯ä»¥æ”¹å˜å‚ç›´ä½ç½® */</span></span><br><span class="line">Â  <span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="yuan-jiao" id="åœ†è§’">åœ†è§’</h3><p>ä½œç”¨ï¼šè®¾ç½®å…ƒç´ çš„å¤–è¾¹æ¡†ä¸ºåœ†è§’ã€‚</p><p>å±æ€§åï¼š<strong>border-radius</strong></p><p>å±æ€§å€¼ï¼šæ•°å­—+px / ç™¾åˆ†æ¯”</p><p>æç¤ºï¼šå±æ€§å€¼æ˜¯åœ†è§’åŠå¾„</p><p><img src="https://s1.vika.cn/space/2023/04/23/e5da4206434d4250b4a9b66c71cf9ac0" alt="1680334014390"></p><ul><li>å¤šå€¼å†™æ³•</li></ul><table><thead><tr><th>å–å€¼ä¸ªæ•°</th><th>ç¤ºä¾‹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>ä¸€ä¸ªå€¼</td><td><code>border-radius: 10px;</code></td><td>å››ä¸ªæ–¹å‘å†…è¾¹è·å‡ä¸º10px</td></tr><tr><td>å››ä¸ªå€¼</td><td><code>border-radius: 10px 20px 40px 80px;</code></td><td>ä¸Šï¼š10pxï¼›å³ï¼š20pxï¼›ä¸‹ï¼š40pxï¼›å·¦ï¼š80px</td></tr><tr><td>ä¸‰ä¸ªå€¼</td><td><code>border-radius: 10px 40px 80px;</code></td><td>ä¸Šï¼š10pxï¼›å·¦å³ï¼š40pxï¼›ä¸‹ï¼š80px</td></tr><tr><td>ä¸¤ä¸ªå€¼</td><td><code>border-radius: 10px 80px;</code></td><td>ä¸Šä¸‹ï¼š10pxï¼›å·¦å³ï¼š80px</td></tr></tbody></table><blockquote><p>æŠ€å·§ï¼šä»å·¦ä¸Šè§’å¼€å§‹é¡ºæ—¶é’ˆèµ‹å€¼ï¼Œå½“å‰è§’æ²¡æœ‰æ•°å€¼åˆ™ä¸å¯¹è§’å–å€¼ç›¸åŒã€‚</p></blockquote><ul><li>æ­£åœ†å½¢çŠ¶ï¼šç»™æ­£æ–¹å½¢ç›’å­è®¾ç½®åœ†è§’å±æ€§å€¼ä¸º <strong>å®½é«˜çš„ä¸€åŠ / 50%</strong></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">Â  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">Â  </span><br><span class="line">Â  <span class="attribute">border-radius</span>: <span class="number">100px</span>;</span><br><span class="line">Â  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s1.vika.cn/space/2023/04/23/4ed79f7a7434418d9804d7f4a2cdc4ac" alt="1680334083567"></p><ul><li>èƒ¶å›Šå½¢çŠ¶ï¼šç»™é•¿æ–¹å½¢ç›’å­è®¾ç½®åœ†è§’å±æ€§å€¼ä¸º ç›’å­é«˜åº¦çš„ä¸€åŠ</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">Â  <span class="attribute">height</span>: <span class="number">80px</span>;</span><br><span class="line">Â  <span class="attribute">background-color</span>: orange;</span><br><span class="line">Â  <span class="attribute">border-radius</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s1.vika.cn/space/2023/04/23/7d2d4837cdde49e49b56c7729e02fb52" alt="1680334136242"></p><h3 id="he-zi-yin-ying-tuo-zhan" id="ç›’å­é˜´å½±ï¼ˆæ‹“å±•ï¼‰">ç›’å­é˜´å½±ï¼ˆæ‹“å±•ï¼‰</h3><p>ä½œç”¨ï¼šç»™å…ƒç´ è®¾ç½®é˜´å½±æ•ˆæœ</p><p>å±æ€§åï¼š<strong>box-shadow</strong></p><p>å±æ€§å€¼ï¼šX è½´åç§»é‡  Y è½´åç§»é‡  æ¨¡ç³ŠåŠå¾„  æ‰©æ•£åŠå¾„  é¢œè‰²  å†…å¤–é˜´å½±</p><p>æ³¨æ„ï¼š</p><ul><li>X è½´åç§»é‡ å’Œ Y è½´åç§»é‡ å¿…é¡»ä¹¦å†™</li><li>é»˜è®¤æ˜¯å¤–é˜´å½±ï¼Œå†…é˜´å½±éœ€è¦æ·»åŠ  inset</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">Â  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">Â  <span class="attribute">height</span>: <span class="number">80px</span>;</span><br><span class="line">Â  <span class="attribute">background-color</span>: orange;</span><br><span class="line">Â  <span class="attribute">box-shadow</span>: <span class="number">2px</span> <span class="number">5px</span> <span class="number">10px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>) inset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="04-zong-he-an-li-chan-pin-qia-pian" id="04-ç»¼åˆæ¡ˆä¾‹-äº§å“å¡ç‰‡">04-ç»¼åˆæ¡ˆä¾‹-äº§å“å¡ç‰‡</h2><p><img src="https://s1.vika.cn/space/2023/04/23/0051236a71b449239f7f3431bf799b79" alt="1680334221212"></p><blockquote><p>CSS ä¹¦å†™é¡ºåºï¼š</p><ol><li>ç›’å­æ¨¡å‹å±æ€§</li><li>æ–‡å­—æ ·å¼</li><li>åœ†è§’ã€é˜´å½±ç­‰ä¿®é¥°å±æ€§</li></ol></blockquote><h3 id="html-biao-qian-4" id="HTMLæ ‡ç­¾-5">HTMLæ ‡ç­¾</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;product&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/liveSDK.svg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h4</span>&gt;</span>æŠ–éŸ³ç›´æ’­SDK<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>åŒ…å«æŠ–éŸ³ç›´æ’­çœ‹æ’­åŠŸèƒ½<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="css-yang-shi-4" id="CSSæ ·å¼-5">CSSæ ·å¼</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  * &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#f1f1f1</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.product</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">50px</span> auto;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding-top</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">270px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">253px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.product</span> <span class="selector-tag">h4</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-bottom</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-weight</span>: <span class="number">400</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.product</span> <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#555</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="05-zong-he-an-li-er-xin-wen-lie-biao" id="05-ç»¼åˆæ¡ˆä¾‹äºŒ-â€“-æ–°é—»åˆ—è¡¨">05-ç»¼åˆæ¡ˆä¾‹äºŒ â€“ æ–°é—»åˆ—è¡¨</h2><p><img src="https://s1.vika.cn/space/2023/04/23/a5296b6243674a5da4596b3d93d35536" alt="1680334329887"></p><h3 id="zheng-ti-bu-ju" id="æ•´ä½“å¸ƒå±€">æ•´ä½“å¸ƒå±€</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">* &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">li</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">list-style</span>: none;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">text-decoration</span>: none;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.news</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin</span>: <span class="number">100px</span> auto;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">360px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="comment">/* background-color: pink; */</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;news&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="biao-ti-qu-yu" id="æ ‡é¢˜åŒºåŸŸ">æ ‡é¢˜åŒºåŸŸ</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.news</span> <span class="selector-class">.hd</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">34px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#dbdee1</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.news</span> <span class="selector-class">.hd</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="comment">/* -1 ç›’å­å‘ä¸Šç§»åŠ¨ */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-top</span>: -<span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-top</span>: <span class="number">3px</span> solid <span class="number">#ff8400</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-right</span>: <span class="number">1px</span> solid <span class="number">#dbdee1</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">48px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">34px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">line-height</span>: <span class="number">32px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>æ–°é—»<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="nei-rong-qu-yu" id="å†…å®¹åŒºåŸŸ">å†…å®¹åŒºåŸŸ</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.news</span> <span class="selector-class">.bd</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.news</span> <span class="selector-class">.bd</span> <span class="selector-tag">li</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding-left</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">./images/square.png</span>);</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-repeat</span>: no-repeat;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-position</span>: <span class="number">0</span> center;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.news</span> <span class="selector-class">.bd</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding-left</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">./images/img.gif</span>) no-repeat <span class="number">0</span> center;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#666</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">line-height</span>: <span class="number">24px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.news</span> <span class="selector-class">.bd</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#ff8400</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>ç‚¹èµâ€œæ–°å†œäººâ€ æ¸©æš–çš„ä¼¸æ‰‹<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>åœ¨å¸Œæœ›çš„ç”°é‡ä¸Š...<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>â€œä¸­å›½å¤©çœ¼â€åˆæœ‰æ–°å‘ç° å·²åœ¨ã€Šè‡ªç„¶ã€‹æ‚å¿—å‘è¡¨<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>æ€¥ï¼è¿™ä¸ªé¢†åŸŸï¼Œç¼ºäººï¼æœˆè–ª4ä¸‡å…ƒè¿˜ä¸å¥½æ‹›ï¼å•¥æƒ…å†µï¼Ÿ<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>G9â€œå¸¦è´§â€èƒŒåï¼šäºæŸé¢æŒç»­æ‰©å¤§ï¼Œç«äº‰ç¯å¢ƒæ¿€çƒˆ<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>å¤šåœ°åŠ›æ¨äºŒæ‰‹æˆ¿â€œå¸¦æŠ¼è¿‡æˆ·â€ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="day-06-flex-bu-ju">day06-Flexå¸ƒå±€</h1><blockquote><p>ç›®æ ‡ï¼šç†Ÿç»ƒä½¿ç”¨ Flex å®Œæˆç»“æ„åŒ–å¸ƒå±€</p></blockquote><h2 id="01-biao-zhun-liu" id="01-æ ‡å‡†æµ">01-æ ‡å‡†æµ</h2><p>æ ‡å‡†æµä¹Ÿå«æ–‡æ¡£æµï¼ŒæŒ‡çš„æ˜¯æ ‡ç­¾åœ¨é¡µé¢ä¸­<strong>é»˜è®¤çš„æ’å¸ƒè§„åˆ™</strong>ï¼Œä¾‹å¦‚ï¼šå—å…ƒç´ ç‹¬å ä¸€è¡Œï¼Œè¡Œå†…å…ƒç´ å¯ä»¥ä¸€è¡Œæ˜¾ç¤ºå¤šä¸ªã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/20/de7a1b467841411c8d435c3a098173b5" alt="1680334840709"></p><h2 id="02-fu-dong" id="02-æµ®åŠ¨">02-æµ®åŠ¨</h2><h3 id="ji-ben-shi-yong-1" id="åŸºæœ¬ä½¿ç”¨-2">åŸºæœ¬ä½¿ç”¨</h3><p>ä½œç”¨ï¼šè®©å—å…ƒç´ æ°´å¹³æ’åˆ—ã€‚</p><p>å±æ€§åï¼š<strong>float</strong></p><p>å±æ€§å€¼</p><ul><li><strong>left</strong>ï¼šå·¦å¯¹é½</li><li><strong>right</strong>ï¼šå³å¯¹é½</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* ç‰¹ç‚¹ï¼šé¡¶å¯¹é½ï¼›å…·å¤‡è¡Œå†…å—æ˜¾ç¤ºæ¨¡å¼ç‰¹ç‚¹ï¼›æµ®åŠ¨çš„ç›’å­ä¼šè„±æ ‡ */</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.one</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: brown;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.two</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: orange;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="comment">/* float: left; */</span></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="attribute">float</span>: right;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;one&quot;</span>&gt;</span>one<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;two&quot;</span>&gt;</span>two<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç‰¹ç‚¹ï¼š</p><ul><li>æµ®åŠ¨åçš„ç›’å­<strong>é¡¶å¯¹é½</strong></li><li>æµ®åŠ¨åçš„ç›’å­å…·å¤‡<strong>è¡Œå†…å—</strong>ç‰¹ç‚¹</li><li>æµ®åŠ¨åçš„ç›’å­<strong>è„±æ ‡</strong>ï¼Œ<strong>ä¸å ç”¨æ ‡å‡†æµçš„ä½ç½®</strong></li></ul><h3 id="chan-pin-qu-yu-bu-ju" id="äº§å“åŒºåŸŸå¸ƒå±€">äº§å“åŒºåŸŸå¸ƒå±€</h3><p><img src="https://s1.vika.cn/space/2023/04/24/3aa2216610e240c88262991d723bd772" alt="1680335016853"></p><h4 id="html-biao-qian-5" id="HTMLæ ‡ç­¾-6">HTMLæ ‡ç­¾</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç‰ˆå¿ƒï¼šå·¦å³ï¼Œå³é¢ï¼š8ä¸ªäº§å“ â†’ 8ä¸ª li --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;product&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="css-yang-shi-5" id="CSSæ ·å¼-6">CSSæ ·å¼</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  * &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">li</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">list-style</span>: none;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.product</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">50px</span> auto;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">1226px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">628px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: pink;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.left</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">234px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">628px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: skyblue;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.right</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">float</span>: right;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">978px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">628px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: brown;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.right</span> <span class="selector-tag">li</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-right</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-bottom</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">234px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: orange;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* ç¬¬å››ä¸ªliå’Œç¬¬å…«ä¸ªli å»æ‰å³ä¾§çš„margin */</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.right</span> <span class="selector-tag">li</span><span class="selector-pseudo">:nth-child</span>(<span class="number">4</span>n) &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* ç»†èŠ‚ï¼šå¦‚æœçˆ¶çº§å®½åº¦ä¸å¤Ÿï¼Œæµ®åŠ¨çš„ç›’å­ä¼šæ‰ä¸‹æ¥ */</span></span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="qing-chu-fu-dong" id="æ¸…é™¤æµ®åŠ¨">æ¸…é™¤æµ®åŠ¨</h3><p>åœºæ™¯ï¼šæµ®åŠ¨å…ƒç´ ä¼šè„±æ ‡ï¼Œå¦‚æœ<strong>çˆ¶çº§æ²¡æœ‰é«˜åº¦</strong>ï¼Œ<strong>å­çº§æ— æ³•æ’‘å¼€çˆ¶çº§é«˜åº¦</strong>ï¼ˆå¯èƒ½å¯¼è‡´é¡µé¢å¸ƒå±€é”™ä¹±ï¼‰</p><p>è§£å†³æ–¹æ³•ï¼š<strong>æ¸…é™¤æµ®åŠ¨</strong>ï¼ˆæ¸…é™¤æµ®åŠ¨å¸¦æ¥çš„å½±å“ï¼‰</p><h4 id="chang-jing-da-jian" id="åœºæ™¯æ­å»º">åœºæ™¯æ­å»º</h4><p><img src="https://s1.vika.cn/space/2023/04/24/fbb72eb6982c4ef4a3885f3141bf09f5" alt="1680335081694"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.top</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">10px</span> auto;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">1200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* height: 300px; */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: pink;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.left</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: skyblue;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.right</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">float</span>: right;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">950px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: orange;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.bottom</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: brown;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;top&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bottom&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="e-wai-biao-qian-fa" id="é¢å¤–æ ‡ç­¾æ³•">é¢å¤–æ ‡ç­¾æ³•</h4><p>åœ¨<strong>çˆ¶å…ƒç´ å†…å®¹çš„æœ€å</strong>æ·»åŠ ä¸€ä¸ª<strong>å—çº§</strong>å…ƒç´ ï¼Œè®¾ç½® CSS å±æ€§ <strong>clear: both</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.clearfix</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">clear</span>: both;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;clearfix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="dan-wei-yuan-su-fa" id="å•ä¼ªå…ƒç´ æ³•">å•ä¼ªå…ƒç´ æ³•</h4><ol><li>å‡†å¤‡ after ä¼ªå…ƒç´ </li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>çˆ¶çº§ä½¿ç”¨ clearfix ç±»</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;father clearfix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="shuang-wei-yuan-su-fa" id="åŒä¼ªå…ƒç´ æ³•">åŒä¼ªå…ƒç´ æ³•</h4><ol><li>å‡†å¤‡ after å’Œ before ä¼ªå…ƒç´ </li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* before è§£å†³å¤–è¾¹è·å¡Œé™·é—®é¢˜ */</span></span><br><span class="line"><span class="comment">/* åŒä¼ªå…ƒç´ æ³• */</span></span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="attribute">display</span>: table;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* after æ¸…é™¤æµ®åŠ¨ */</span></span><br><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>çˆ¶çº§ä½¿ç”¨ clearfix ç±»</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;father clearfix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="overfow-fa" id="overfowæ³•">overfowæ³•</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.father</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span> auto;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1200px</span>;</span><br><span class="line">  <span class="comment">/* height: 300px; */</span></span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="03-flex-bu-ju" id="03-Flexå¸ƒå±€">03-Flexå¸ƒå±€</h2><img src="https://s1.vika.cn/space/2023/04/25/4c3ece4476a64dbba58238acdd11ef7a" alt="image-20230425110650225" style="zoom:50%;" /><p>Flex å¸ƒå±€ä¹Ÿå«<strong>å¼¹æ€§å¸ƒå±€</strong>ï¼Œæ˜¯æµè§ˆå™¨<strong>æå€¡çš„å¸ƒå±€æ¨¡å‹</strong>ï¼Œéå¸¸é€‚åˆ<strong>ç»“æ„åŒ–</strong>å¸ƒå±€ï¼Œæä¾›äº†å¼ºå¤§çš„ç©ºé—´åˆ†å¸ƒå’Œå¯¹é½èƒ½åŠ›ã€‚</p><p>Flex æ¨¡å‹ä¸ä¼šäº§ç”Ÿæµ®åŠ¨å¸ƒå±€ä¸­è„±æ ‡ç°è±¡ï¼Œå¸ƒå±€ç½‘é¡µæ›´ç®€å•ã€æ›´çµæ´»ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/24/f362527a41214e7ca4095b7916beb259" alt="1680335815005"></p><h3 id="flex-zu-cheng" id="Flexç»„æˆ">Flexç»„æˆ</h3><p>è®¾ç½®æ–¹å¼ï¼šç»™<strong>çˆ¶</strong>å…ƒç´ è®¾ç½® <strong>display: flex</strong>ï¼Œå­å…ƒç´ å¯ä»¥è‡ªåŠ¨æŒ¤å‹æˆ–æ‹‰ä¼¸</p><p>ç»„æˆéƒ¨åˆ†ï¼š</p><ul><li>å¼¹æ€§å®¹å™¨</li><li>å¼¹æ€§ç›’å­</li><li>ä¸»è½´ï¼šé»˜è®¤åœ¨<strong>æ°´å¹³</strong>æ–¹å‘</li><li>ä¾§è½´ / äº¤å‰è½´ï¼šé»˜è®¤åœ¨<strong>å‚ç›´</strong>æ–¹å‘</li></ul><p><img src="https://s1.vika.cn/space/2023/04/24/4f9f839ceb3848ec83645d793ef0d68d" alt="1680335870554"></p><h3 id="zhu-zhou-dui-qi-fang-shi" id="ä¸»è½´å¯¹é½æ–¹å¼">ä¸»è½´å¯¹é½æ–¹å¼</h3><p>å±æ€§åï¼š<strong>justify-content</strong></p><table><thead><tr><th>å±æ€§å€¼</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>flex-start</td><td>é»˜è®¤å€¼ï¼Œå¼¹æ€§ç›’å­ä»<code>èµ·ç‚¹</code>å¼€å§‹ä¾æ¬¡æ’åˆ—</td></tr><tr><td>flex-end</td><td>å¼¹æ€§ç›’å­ä»<code>ç»ˆç‚¹</code>å¼€å§‹ä¾æ¬¡æ’åˆ—</td></tr><tr><td><strong>center</strong></td><td>å¼¹æ€§ç›’å­æ²¿ä¸»è½´<code>å±…ä¸­</code>æ’åˆ—</td></tr><tr><td><strong>space-between</strong></td><td>å¼¹æ€§ç›’å­æ²¿ä¸»è½´å‡åŒ€æ’åˆ—ï¼Œç©ºç™½é—´è·å‡åˆ†åœ¨å¼¹æ€§ç›’å­<code>ä¹‹é—´</code></td></tr><tr><td><strong>space-around</strong></td><td>å¼¹æ€§ç›’å­æ²¿ä¸»è½´å‡åŒ€æ’åˆ—ï¼Œç©ºç™½é—´è·å‡åˆ†åœ¨å¼¹æ€§ç›’å­<code>ä¸¤ä¾§</code></td></tr><tr><td><strong>space-evenly</strong></td><td>å¼¹æ€§ç›’å­æ²¿ä¸»è½´å‡åŒ€æ’åˆ—ï¼Œå¼¹æ€§ç›’å­ä¸å®¹å™¨ä¹‹é—´é—´è·ç›¸ç­‰</td></tr></tbody></table><h3 id="ce-zhou-dui-qi-fang-shi" id="ä¾§è½´å¯¹é½æ–¹å¼">ä¾§è½´å¯¹é½æ–¹å¼</h3><ul><li>align-itemsï¼šå½“å‰å¼¹æ€§å®¹å™¨å†…<strong>æ‰€æœ‰</strong>å¼¹æ€§ç›’å­çš„ä¾§è½´å¯¹é½æ–¹å¼ï¼ˆç»™<strong>å¼¹æ€§å®¹å™¨</strong>è®¾ç½®ï¼‰</li><li>align-selfï¼šå•ç‹¬æ§åˆ¶<strong>æŸä¸ªå¼¹æ€§ç›’å­</strong>çš„ä¾§è½´å¯¹é½æ–¹å¼ï¼ˆç»™<strong>å¼¹æ€§ç›’å­</strong>è®¾ç½®ï¼‰</li></ul><table><thead><tr><th>å±æ€§å€¼</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>stretch</td><td>å¼¹æ€§ç›’å­æ²¿ç€ä¾§è½´çº¿è¢«<code>æ‹‰ä¼¸è‡³é“ºæ»¡å®¹å™¨</code>ï¼ˆå¼¹æ€§ç›’å­æ²¡æœ‰è®¾ç½®ä¾§è½´æ–¹å‘å°ºå¯¸åˆ™é»˜è®¤æ‹‰ä¼¸ï¼‰</td></tr><tr><td>center</td><td>å¼¹æ€§ç›’å­æ²¿ä¾§è½´<code>å±…ä¸­</code>æ’åˆ—</td></tr><tr><td>flex-start</td><td>å¼¹æ€§ç›’å­ä»<code>èµ·ç‚¹</code>å¼€å§‹ä¾æ¬¡æ’åˆ—</td></tr><tr><td>flex-end</td><td>å¼¹æ€§ç›’å­ä»<code>ç»ˆç‚¹</code>å¼€å§‹ä¾æ¬¡æ’åˆ—</td></tr></tbody></table><h3 id="xiu-gai-zhu-zhou-fang-xiang" id="ä¿®æ”¹ä¸»è½´æ–¹å‘">ä¿®æ”¹ä¸»è½´æ–¹å‘</h3><p><strong>ä¸»è½´é»˜è®¤åœ¨æ°´å¹³æ–¹å‘ï¼Œä¾§è½´é»˜è®¤åœ¨å‚ç›´æ–¹å‘</strong></p><p>å±æ€§åï¼š<strong>flex-direction</strong></p><table><thead><tr><th>å±æ€§å€¼</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>row</td><td>æ°´å¹³æ–¹å‘ï¼Œä»å·¦å‘å³ï¼ˆé»˜è®¤ï¼‰</td></tr><tr><td><strong>column</strong></td><td><strong>å‚ç›´æ–¹å‘ï¼Œä»ä¸Šåˆ°ä¸‹</strong></td></tr><tr><td>row-reverse</td><td>æ°´å¹³æ–¹å‘ï¼Œä»å³å‘å·¦</td></tr><tr><td>column-reverse</td><td>å‚ç›´æ–¹å‘ï¼Œä»ä¸‹å‘ä¸Š</td></tr></tbody></table><h3 id="dan-xing-shen-suo-bi" id="å¼¹æ€§ä¼¸ç¼©æ¯”">å¼¹æ€§ä¼¸ç¼©æ¯”</h3><p>ä½œç”¨ï¼šæ§åˆ¶å¼¹æ€§ç›’å­çš„ä¸»è½´æ–¹å‘çš„å°ºå¯¸ã€‚</p><p>å±æ€§åï¼š<strong>flex</strong></p><p>å±æ€§å€¼ï¼šæ•´æ•°æ•°å­—ï¼Œè¡¨ç¤ºå ç”¨<strong>çˆ¶çº§å‰©ä½™å°ºå¯¸çš„ä»½æ•°</strong>ã€‚</p><blockquote><p>æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸»è½´æ–¹å‘æ˜¯é å†…å®¹æ’‘å¼€ï¼šä¾§è½´é»˜è®¤æ‹‰ä¼¸</p></blockquote><h3 id="dan-xing-he-zi-huan-xing" id="å¼¹æ€§ç›’å­æ¢è¡Œ">å¼¹æ€§ç›’å­æ¢è¡Œ</h3><p>å¼¹æ€§ç›’å­å¯ä»¥è‡ªåŠ¨æŒ¤å‹æˆ–æ‹‰ä¼¸ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å¼¹æ€§ç›’å­éƒ½åœ¨ä¸€è¡Œæ˜¾ç¤ºã€‚</p><p>å±æ€§åï¼š<strong>flex-wrap</strong></p><p>å±æ€§å€¼</p><ul><li>wrapï¼šæ¢è¡Œ</li><li>nowrapï¼šä¸æ¢è¡Œï¼ˆé»˜è®¤ï¼‰</li></ul><h3 id="xing-nei-dui-qi-fang-shi" id="è¡Œå†…å¯¹é½æ–¹å¼">è¡Œå†…å¯¹é½æ–¹å¼</h3><p>å±æ€§åï¼š<strong>align-content</strong></p><table><thead><tr><th>å±æ€§å€¼</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>flex-start</td><td>é»˜è®¤å€¼ï¼Œå¼¹æ€§ç›’å­ä»<code>èµ·ç‚¹</code>å¼€å§‹ä¾æ¬¡æ’åˆ—</td></tr><tr><td>flex-end</td><td>å¼¹æ€§ç›’å­ä»<code>ç»ˆç‚¹</code>å¼€å§‹ä¾æ¬¡æ’åˆ—</td></tr><tr><td><strong>center</strong></td><td>å¼¹æ€§ç›’å­æ²¿ä¸»è½´<code>å±…ä¸­</code>æ’åˆ—</td></tr><tr><td><strong>space-between</strong></td><td>å¼¹æ€§ç›’å­æ²¿ä¸»è½´å‡åŒ€æ’åˆ—ï¼Œç©ºç™½é—´è·å‡åˆ†åœ¨å¼¹æ€§ç›’å­<code>ä¹‹é—´</code></td></tr><tr><td><strong>space-around</strong></td><td>å¼¹æ€§ç›’å­æ²¿ä¸»è½´å‡åŒ€æ’åˆ—ï¼Œç©ºç™½é—´è·å‡åˆ†åœ¨å¼¹æ€§ç›’å­<code>ä¸¤ä¾§</code></td></tr><tr><td><strong>space-evenly</strong></td><td>å¼¹æ€§ç›’å­æ²¿ä¸»è½´å‡åŒ€æ’åˆ—ï¼Œå¼¹æ€§ç›’å­ä¸å®¹å™¨ä¹‹é—´é—´è·ç›¸ç­‰</td></tr></tbody></table><blockquote><p>æ³¨æ„ï¼šè¯¥å±æ€§å¯¹<strong>å•è¡Œ</strong>å¼¹æ€§ç›’å­æ¨¡å‹<strong>æ— æ•ˆ</strong>ã€‚</p></blockquote><h2 id="04-zong-he-an-li-dou-yin-jie-jue-fang-an" id="04-ç»¼åˆæ¡ˆä¾‹-â€“-æŠ–éŸ³è§£å†³æ–¹æ¡ˆ">04-ç»¼åˆæ¡ˆä¾‹ â€“ æŠ–éŸ³è§£å†³æ–¹æ¡ˆ</h2><p><img src="https://s1.vika.cn/space/2023/04/24/04f7926f62b24c98a0c59831f9dc549b" alt="1680336238340"></p><h3 id="zheng-ti-bu-ju-1" id="æ•´ä½“å¸ƒå±€-2">æ•´ä½“å¸ƒå±€</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">* &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">li</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">list-style</span>: none;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin</span>: <span class="number">50px</span> auto;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">1200px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">418px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="lie-biao-bu-ju" id="åˆ—è¡¨å¸ƒå±€">åˆ—è¡¨å¸ƒå±€</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.box</span> <span class="selector-tag">ul</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="comment">/* å¼¹æ€§ç›’å­æ¢è¡Œ */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">flex-wrap</span>: wrap;</span></span><br><span class="line"><span class="language-css">  <span class="comment">/* è°ƒæ•´ä¸»è½´å¯¹é½æ–¹å¼ */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* è°ƒæ•´ è¡Œå¯¹é½æ–¹å¼ */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">align-content</span>: space-between;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">90px</span> <span class="number">40px</span> <span class="number">90px</span> <span class="number">60px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">418px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.box</span> <span class="selector-tag">li</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">500px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">88px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="comment">/* background-color: pink; */</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="nei-rong-yang-shi" id="å†…å®¹æ ·å¼">å†…å®¹æ ·å¼</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.box</span> <span class="selector-class">.pic</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-right</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.box</span> <span class="selector-class">.text</span> <span class="selector-tag">h4</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">line-height</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.box</span> <span class="selector-class">.text</span> <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#666</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/1.svg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h4</span>&gt;</span>ä¸€é”®å‘å¸ƒå¤šç«¯<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>å‘å¸ƒè§†é¢‘åˆ°æŠ–éŸ³çŸ­è§†é¢‘ã€è¥¿ç“œè§†é¢‘åŠä»Šæ—¥å¤´æ¡<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/2.svg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h4</span>&gt;</span>ç®¡ç†è§†é¢‘å†…å®¹<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ”¯æŒä¿®æ”¹å·²å‘å¸ƒç¨¿ä»¶çŠ¶æ€å’Œå®æ—¶æŸ¥è¯¢è§†é¢‘å®¡æ ¸çŠ¶æ€<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/3.svg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h4</span>&gt;</span>å‘å¸ƒæºå¸¦ç»„ä»¶<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ”¯æŒåˆ†äº«å†…å®¹æºå¸¦å°ç¨‹åºã€åœ°ç†ä½ç½®ä¿¡æ¯ç­‰ç»„ä»¶ï¼Œæ‰©å±•å†…å®¹åŠçªå‡ºåœ°åŸŸæ€§<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/4.svg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h4</span>&gt;</span>æ•°æ®è¯„ä¼°åˆ†æ<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>è·å–è§†é¢‘åœ¨å¯¹åº”äº§å“å†…çš„æ•°æ®è¡¨ç°ã€è·å–æŠ–éŸ³çƒ­ç‚¹ï¼ŒåŠæ—¶è¿›è¡Œè¡¨ç°è¯„ä¼°<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">CSS åŸºç¡€ã€ç›’å­æ¨¡å‹ã€Flexå¸ƒå±€</summary>
    
    
    
    <category term="Webå‰ç«¯" scheme="https://www.taoyaopc.live/categories/Web%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="Html" scheme="https://www.taoyaopc.live/tags/Html/"/>
    
    <category term="CSS" scheme="https://www.taoyaopc.live/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>HTML åŸºç¡€</title>
    <link href="https://www.taoyaopc.live/posts/b8b839b9.html"/>
    <id>https://www.taoyaopc.live/posts/b8b839b9.html</id>
    <published>2023-04-16T16:00:00.000Z</published>
    <updated>2023-04-22T07:58:54.486Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>é˜¶æ®µç›®æ ‡ï¼šæŒæ¡HTMLã€CSSå¸¸ç”¨å¸ƒå±€æŠ€å·§ï¼Œèƒ½å¤Ÿç‹¬ç«‹åˆ¶ä½œç½‘é¡µã€‚</p></blockquote><h1 id="day-01-html-ji-chu">day01ï¼šHTML åŸºç¡€</h1><blockquote><p>ç›®æ ‡ï¼šæŒæ¡æ ‡ç­¾åŸºæœ¬è¯­æ³•ï¼Œèƒ½å¤Ÿç‹¬ç«‹å¸ƒå±€æ–‡ç« é¡µã€‚</p></blockquote><h2 id="jin-ri-ke-cheng-jie-shao" id="ä»Šæ—¥è¯¾ç¨‹ä»‹ç»">ä»Šæ—¥è¯¾ç¨‹ä»‹ç»</h2><blockquote><p>ä»Šæ—¥ç›®æ ‡ï¼šæŒæ¡æ ‡ç­¾åŸºæœ¬è¯­æ³•ï¼Œèƒ½å¤Ÿç‹¬ç«‹å¸ƒå±€æ–‡ç« é¡µã€‚</p></blockquote><h3 id="he-xin-ji-zhu-dian" id="æ ¸å¿ƒæŠ€æœ¯ç‚¹">æ ¸å¿ƒæŠ€æœ¯ç‚¹</h3><ul><li><p>ç½‘é¡µç»„æˆ</p></li><li><p>æ’ç‰ˆæ ‡ç­¾</p></li><li><p>å¤šåª’ä½“æ ‡ç­¾åŠå±æ€§</p></li><li><p>ç»¼åˆæ¡ˆä¾‹ä¸€ - ä¸ªäººç®€ä»‹</p><p><img src="https://s1.vika.cn/space/2023/04/16/ab9344c6d3d94209bc66ffb2b25b8684" alt="1680242340931"></p></li><li><p>ç»¼åˆæ¡ˆä¾‹äºŒ - Vue ç®€ä»‹</p><p><img src="https://s1.vika.cn/space/2023/04/16/81fa9eb64c624023b487c77dd50ad294" alt="1680242362352"></p></li></ul><h2 id="biao-qian-yu-fa" id="æ ‡ç­¾è¯­æ³•">æ ‡ç­¾è¯­æ³•</h2><p>HTML è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€â€”â€”HyperText Markup Languageã€‚</p><ul><li>è¶…æ–‡æœ¬ï¼šé“¾æ¥</li><li>æ ‡è®°ï¼šæ ‡ç­¾ï¼Œå¸¦å°–æ‹¬å·çš„æ–‡æœ¬</li></ul><p><img src="assets/1680242502155.png" alt="1680242502155"></p><h3 id="biao-qian-jie-gou" id="æ ‡ç­¾ç»“æ„">æ ‡ç­¾ç»“æ„</h3><ul><li>æ ‡ç­¾è¦æˆå¯¹å‡ºç°ï¼Œä¸­é—´åŒ…è£¹å†…å®¹</li><li>&lt;&gt;é‡Œé¢æ”¾è‹±æ–‡å­—æ¯ï¼ˆæ ‡ç­¾åï¼‰</li><li>ç»“æŸæ ‡ç­¾æ¯”å¼€å§‹æ ‡ç­¾å¤š /</li><li>æ ‡ç­¾åˆ†ç±»ï¼šåŒæ ‡ç­¾å’Œå•æ ‡ç­¾</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">strong</span>&gt;</span>éœ€è¦åŠ ç²—çš„æ–‡å­—<span class="tag">&lt;<span class="name">strong</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://s1.vika.cn/space/2023/04/16/c1d61a004ab344c79e420f223864e2d6" alt="1680242555328"></p><h2 id="html-gu-jia" id="HTMLéª¨æ¶">HTMLéª¨æ¶</h2><ul><li>htmlï¼šæ•´ä¸ªç½‘é¡µ</li><li>headï¼šç½‘é¡µå¤´éƒ¨ï¼Œç”¨æ¥å­˜æ”¾ç»™æµè§ˆå™¨çœ‹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ CSS<ul><li>titleï¼šç½‘é¡µæ ‡é¢˜</li></ul></li><li>bodyï¼šç½‘é¡µä¸»ä½“ï¼Œç”¨æ¥å­˜æ”¾ç»™ç”¨æˆ·çœ‹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å›¾ç‰‡ã€æ–‡å­—</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ç½‘é¡µæ ‡é¢˜<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    ç½‘é¡µä¸»ä½“</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æç¤º</p><p>VS Code å¯ä»¥å¿«é€Ÿç”Ÿæˆéª¨æ¶ï¼šåœ¨ HTML æ–‡ä»¶ï¼ˆ.htmlï¼‰ä¸­ï¼Œ!ï¼ˆè‹±æ–‡ï¼‰é…åˆ Enter / Tab é”®</p></blockquote><h2 id="biao-qian-de-guan-xi" id="æ ‡ç­¾çš„å…³ç³»">æ ‡ç­¾çš„å…³ç³»</h2><blockquote><p>ä½œç”¨ï¼šæ˜ç¡®æ ‡ç­¾çš„ä¹¦å†™ä½ç½®ï¼Œè®©ä»£ç æ ¼å¼æ›´æ•´é½</p></blockquote><ul><li><p>çˆ¶å­å…³ç³»ï¼ˆåµŒå¥—å…³ç³»ï¼‰ï¼šå­çº§æ ‡ç­¾æ¢è¡Œä¸”ç¼©è¿›ï¼ˆTabé”®ï¼‰</p><p><img src="https://s1.vika.cn/space/2023/04/16/104dbe75f1db43c191304b46e60e3e09" alt="1680255766672"></p></li><li><p>å…„å¼Ÿå…³ç³»ï¼ˆå¹¶åˆ—å…³ç³»ï¼‰ï¼šå…„å¼Ÿæ ‡ç­¾æ¢è¡Œè¦å¯¹é½</p><p><img src="https://s1.vika.cn/space/2023/04/16/836f057be35b426b82b48aa420302583" alt="1680255775150"></p></li></ul><h2 id="zhu-shi" id="æ³¨é‡Š">æ³¨é‡Š</h2><blockquote><p>æ¦‚å¿µï¼šæ³¨é‡Šæ˜¯å¯¹ä»£ç çš„è§£é‡Šå’Œè¯´æ˜ï¼Œèƒ½å¤Ÿæé«˜ç¨‹åºçš„å¯è¯»æ€§ï¼Œæ–¹ä¾¿ç†è§£ã€æŸ¥æ‰¾ä»£ç ã€‚</p></blockquote><p>æ³¨é‡Šä¸ä¼šå†æµè§ˆå™¨ä¸­æ˜¾ç¤ºã€‚</p><p>åœ¨ VS Code ä¸­ï¼Œ<strong>æ·»åŠ  / åˆ é™¤</strong>æ³¨é‡Šçš„å¿«æ·é”®ï¼š<strong>Ctrl + /</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æˆ‘æ˜¯ HTML æ³¨é‡Š --&gt;</span></span><br></pre></td></tr></table></figure><h2 id="biao-ti-biao-qian" id="æ ‡é¢˜æ ‡ç­¾">æ ‡é¢˜æ ‡ç­¾</h2><p>ä¸€èˆ¬ç”¨åœ¨æ–°é—»æ ‡é¢˜ã€æ–‡ç« æ ‡é¢˜ã€ç½‘é¡µåŒºåŸŸåç§°ã€äº§å“åç§°ç­‰ç­‰ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>ä¸€çº§æ ‡é¢˜<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>äºŒçº§æ ‡é¢˜<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>ä¸‰çº§æ ‡é¢˜<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>å››çº§æ ‡é¢˜<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h5</span>&gt;</span>äº”çº§æ ‡é¢˜<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h6</span>&gt;</span>å…­çº§æ ‡é¢˜<span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºç‰¹ç‚¹ï¼š</p><ul><li>æ–‡å­—åŠ ç²—</li><li>å­—å·é€æ¸å‡å°</li><li>ç‹¬å ä¸€è¡Œï¼ˆæ¢è¡Œï¼‰</li></ul><blockquote><p>ç»éªŒ</p><ol><li>h1 æ ‡ç­¾åœ¨ä¸€ä¸ªç½‘é¡µä¸­åªèƒ½ç”¨ä¸€æ¬¡ï¼Œç”¨æ¥æ”¾æ–°é—»æ ‡é¢˜æˆ–ç½‘é¡µçš„ logo</li><li>h2 ~ h6 æ²¡æœ‰ä½¿ç”¨æ¬¡æ•°çš„é™åˆ¶</li></ol></blockquote><h2 id="duan-luo-biao-qian" id="æ®µè½æ ‡ç­¾">æ®µè½æ ‡ç­¾</h2><p>ä¸€èˆ¬ç”¨åœ¨æ–°é—»æ®µè½ã€æ–‡ç« æ®µè½ã€äº§å“æè¿°ä¿¡æ¯ç­‰ç­‰ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>æ®µè½<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºç‰¹ç‚¹ï¼š</p><ul><li>ç‹¬å ä¸€è¡Œ</li><li>æ®µè½ä¹‹é—´å­˜åœ¨é—´éš™</li></ul><h2 id="huan-xing-he-shui-ping-xian" id="æ¢è¡Œå’Œæ°´å¹³çº¿">æ¢è¡Œå’Œæ°´å¹³çº¿</h2><ul><li>æ¢è¡Œï¼šbr</li><li>æ°´å¹³çº¿ï¼šhr</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="wen-ben-ge-shi-hua-biao-qian" id="æ–‡æœ¬æ ¼å¼åŒ–æ ‡ç­¾">æ–‡æœ¬æ ¼å¼åŒ–æ ‡ç­¾</h2><p>ä½œç”¨ï¼šä¸ºæ–‡æœ¬æ·»åŠ ç‰¹æ®Šæ ¼å¼ï¼Œä»¥çªå‡ºé‡ç‚¹ã€‚å¸¸è§çš„æ–‡æœ¬æ ¼å¼ï¼šåŠ ç²—ã€å€¾æ–œã€ä¸‹åˆ’çº¿ã€åˆ é™¤çº¿ç­‰ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/16/da657269df9447e8a16d7d7cda661c33" alt="1680314078647"></p><blockquote><p>æç¤ºï¼šstrongã€emã€insã€del æ ‡ç­¾è‡ªå¸¦å¼ºè°ƒå«ä¹‰ï¼ˆè¯­ä¹‰ï¼‰ã€‚</p></blockquote><h2 id="tu-xiang-biao-qian" id="å›¾åƒæ ‡ç­¾">å›¾åƒæ ‡ç­¾</h2><p>ä½œç”¨ï¼šåœ¨ç½‘é¡µä¸­æ’å…¥å›¾ç‰‡</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span>  <span class="attr">src</span>=<span class="string">&quot;å›¾ç‰‡çš„ URL&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>srcç”¨äºæŒ‡å®šå›¾åƒçš„ä½ç½®å’Œåç§°ï¼Œæ˜¯ <img> çš„å¿…é¡»å±æ€§ã€‚</p><h3 id="tu-xiang-shu-xing" id="å›¾åƒå±æ€§">å›¾åƒå±æ€§</h3><ul><li>æµè§ˆå™¨ç¼©æ”¾å›¾ç‰‡ï¼Œé»˜è®¤æ˜¯ç­‰æ¯”ä¾‹ç¼©æ”¾</li></ul><table><thead><tr><th>å±æ€§</th><th>ä½œç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>alt</td><td>æ›¿æ¢æ–‡æœ¬</td><td>å›¾ç‰‡æ— æ³•æ˜¾ç¤ºçš„æ—¶å€™æ˜¾ç¤ºçš„æ–‡å­—</td></tr><tr><td>title</td><td>æç¤ºæ–‡æœ¬</td><td>é¼ æ ‡æ‚¬åœåœ¨å›¾ç‰‡ä¸Šé¢çš„æ—¶å€™æ˜¾ç¤ºçš„æ–‡å­—</td></tr><tr><td>width</td><td>å›¾ç‰‡çš„å®½åº¦</td><td>å€¼ä¸ºæ•°å­—ï¼Œæ²¡æœ‰å•ä½</td></tr><tr><td>height</td><td>å›¾ç‰‡çš„é«˜åº¦</td><td>å€¼ä¸ºæ•°å­—ï¼Œæ²¡æœ‰å•ä½</td></tr></tbody></table><h3 id="shu-xing-yu-fa" id="å±æ€§è¯­æ³•">å±æ€§è¯­æ³•</h3><ul><li>å±æ€§å=â€œå±æ€§å€¼â€</li><li>å±æ€§å†™åœ¨å°–æ‹¬å·é‡Œé¢ï¼Œæ ‡ç­¾ååé¢ï¼Œæ ‡ç­¾åå’Œå±æ€§ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ï¼Œä¸åŒºåˆ†å…ˆåé¡ºåº</li></ul><p><img src="https://s1.vika.cn/space/2023/04/16/6ec191da427c4a9b933e676c142abfbc" alt="1680314195951"></p><h2 id="lu-jing" id="è·¯å¾„">è·¯å¾„</h2><blockquote><p>æ¦‚å¿µï¼šè·¯å¾„æŒ‡çš„æ˜¯æŸ¥æ‰¾æ–‡ä»¶æ—¶ï¼Œä»<strong>èµ·ç‚¹</strong>åˆ°<strong>ç»ˆç‚¹</strong>ç»å†çš„<strong>è·¯çº¿</strong>ã€‚</p></blockquote><p>è·¯å¾„åˆ†ç±»ï¼š</p><ul><li>ç›¸å¯¹è·¯å¾„ï¼šä»å½“å‰æ–‡ä»¶ä½ç½®å‡ºå‘æŸ¥æ‰¾ç›®æ ‡æ–‡ä»¶</li><li>ç»å¯¹è·¯å¾„ï¼šä»ç›˜ç¬¦å‡ºå‘æŸ¥æ‰¾ç›®æ ‡æ–‡ä»¶<ul><li>Windows ç”µè„‘ä»ç›˜ç¬¦å‡ºå‘</li><li>Mac ç”µè„‘ä»æ ¹ç›®å½•å‡ºå‘</li></ul></li></ul><h3 id="xiang-dui-lu-jing" id="ç›¸å¯¹è·¯å¾„">ç›¸å¯¹è·¯å¾„</h3><p>æŸ¥æ‰¾æ–¹å¼ï¼šä»<strong>å½“å‰æ–‡ä»¶ä½ç½®</strong>å‡ºå‘æŸ¥æ‰¾ç›®æ ‡æ–‡ä»¶</p><p>ç‰¹æ®Šç¬¦å·ï¼š</p><ul><li><strong>/</strong> è¡¨ç¤ºè¿›å…¥æŸä¸ªæ–‡ä»¶å¤¹é‡Œé¢          â†’ æ–‡ä»¶å¤¹å/</li><li>**. ** è¡¨ç¤ºå½“å‰æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹           â†’ ./</li><li><strong>â€¦</strong> è¡¨ç¤ºå½“å‰æ–‡ä»¶çš„ä¸Šä¸€çº§æ–‡ä»¶å¤¹ â†’ â€¦/</li></ul><p><img src="https://s1.vika.cn/space/2023/04/16/d541ed973cd54e619c31aaf6116db5fc" alt="1680314322997"></p><h3 id="jue-dui-lu-jing" id="ç»å¯¹è·¯å¾„">ç»å¯¹è·¯å¾„</h3><p>æŸ¥æ‰¾æ–¹å¼ï¼šWindows ç”µè„‘ä»ç›˜ç¬¦å‡ºå‘ï¼›Mac ç”µè„‘ä»æ ¹ç›®å½•ï¼ˆ/ï¼‰å‡ºå‘</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span>  <span class="attr">src</span>=<span class="string">&quot;C:\images\mao.jpg&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æç¤ºï¼š</p><ol><li>Windows é»˜è®¤æ˜¯ \ ï¼Œå…¶ä»–ç³»ç»Ÿæ˜¯ /ï¼Œå»ºè®®ç»Ÿä¸€å†™ä¸º /</li><li>ç‰¹æ®Šçš„ç»å¯¹è·¯å¾„ â†’ æ–‡ä»¶çš„åœ¨çº¿ç½‘å€ï¼š<a href="https://www.itheima.com/images/logo.png">https://www.itheima.com/images/logo.png</a> &quot;ï¼Œåº”ç”¨åœºæ™¯ï¼šç½‘é¡µåº•éƒ¨<strong>å‹æƒ…é“¾æ¥</strong></li></ol></blockquote><p><img src="https://s1.vika.cn/space/2023/04/16/b03a44027a1f47ce88b7895a9fa644ce" alt="1680314503056"></p><h2 id="chao-lian-jie-biao-qian" id="è¶…é“¾æ¥æ ‡ç­¾">è¶…é“¾æ¥æ ‡ç­¾</h2><blockquote><p>ä½œç”¨ï¼šç‚¹å‡»è·³è½¬åˆ°å…¶ä»–é¡µé¢ã€‚</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.baidu.com&quot;</span>&gt;</span>è·³è½¬åˆ°ç™¾åº¦<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>href å±æ€§å€¼æ˜¯è·³è½¬åœ°å€ï¼Œæ˜¯è¶…é“¾æ¥çš„å¿…é¡»å±æ€§ã€‚</strong></p><p>è¶…é“¾æ¥é»˜è®¤æ˜¯åœ¨å½“å‰çª—å£è·³è½¬é¡µé¢ï¼Œæ·»åŠ  <strong>target=â€œ_blankâ€</strong> å®ç°<strong>æ–°çª—å£</strong>æ‰“å¼€é¡µé¢ã€‚</p><blockquote><p>æ‹“å±•ï¼šå¼€å‘åˆæœŸï¼Œä¸ç¡®å®šè·³è½¬åœ°å€ï¼Œåˆ™ href å±æ€§å€¼å†™ä¸º <strong>#</strong>ï¼Œè¡¨ç¤º<strong>ç©ºé“¾æ¥</strong>ï¼Œé¡µé¢ä¸ä¼šè·³è½¬ï¼Œåœ¨å½“å‰é¡µé¢åˆ·æ–°ä¸€æ¬¡ã€‚</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.baidu.com/&quot;</span>&gt;</span>è·³è½¬åˆ°ç™¾åº¦<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- è·³è½¬åˆ°æœ¬åœ°æ–‡ä»¶ï¼šç›¸å¯¹è·¯å¾„æŸ¥æ‰¾ --&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- target=&quot;_blank&quot; æ–°çª—å£è·³è½¬é¡µé¢ --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;./01-æ ‡ç­¾çš„å†™æ³•.html&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>è·³è½¬åˆ°01-æ ‡ç­¾çš„å†™æ³•<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å¼€å‘åˆæœŸï¼Œä¸çŸ¥é“è¶…é“¾æ¥çš„è·³è½¬åœ°å€ï¼Œhrefå±æ€§å€¼å†™#ï¼Œè¡¨ç¤ºç©ºé“¾æ¥ï¼Œä¸ä¼šè·³è½¬ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>ç©ºé“¾æ¥<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="yin-pin" id="éŸ³é¢‘">éŸ³é¢‘</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">&quot;éŸ³é¢‘çš„ URL&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¸¸ç”¨å±æ€§</p><table><thead><tr><th>å±æ€§</th><th>ä½œç”¨</th><th>ç‰¹æ®Šè¯´æ˜</th></tr></thead><tbody><tr><td><strong>srcï¼ˆå¿…é¡»å±æ€§ï¼‰</strong></td><td><strong>éŸ³é¢‘ URL</strong></td><td>æ”¯æŒæ ¼å¼ï¼š<strong>MP3</strong>ã€Oggã€Wav</td></tr><tr><td>controls</td><td>æ˜¾ç¤ºéŸ³é¢‘æ§åˆ¶é¢æ¿</td><td></td></tr><tr><td>loop</td><td>å¾ªç¯æ’­æ”¾</td><td></td></tr><tr><td>autoplay</td><td>è‡ªåŠ¨æ’­æ”¾</td><td>ä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒï¼Œæµè§ˆå™¨ä¸€èˆ¬ä¼š<strong>ç¦ç”¨</strong>è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½</td></tr></tbody></table><blockquote><p>æ‹“å±•ï¼šä¹¦å†™ HTML5 å±æ€§æ—¶ï¼Œå¦‚æœå±æ€§åå’Œå±æ€§å€¼ç›¸åŒï¼Œå¯ä»¥ç®€å†™ä¸ºä¸€ä¸ªå•è¯ã€‚</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åœ¨ HTML5 é‡Œé¢ï¼Œå¦‚æœå±æ€§åå’Œå±æ€§å€¼å®Œå…¨ä¸€æ ·ï¼Œå¯ä»¥ç®€å†™ä¸ºä¸€ä¸ªå•è¯ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">&quot;./media/music.mp3&quot;</span> <span class="attr">controls</span> <span class="attr">loop</span> <span class="attr">autoplay</span>&gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="shi-pin" id="è§†é¢‘">è§†é¢‘</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">&quot;è§†é¢‘çš„ URL&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¸¸ç”¨å±æ€§</p><table><thead><tr><th>å±æ€§</th><th>ä½œç”¨</th><th>ç‰¹æ®Šè¯´æ˜</th></tr></thead><tbody><tr><td><strong>srcï¼ˆå¿…é¡»å±æ€§ï¼‰</strong></td><td>è§†é¢‘ URL</td><td>æ”¯æŒæ ¼å¼ï¼š<strong>MP4</strong>ã€WebMã€Ogg</td></tr><tr><td>controls</td><td>æ˜¾ç¤ºè§†é¢‘æ§åˆ¶é¢æ¿</td><td></td></tr><tr><td>loop</td><td>å¾ªç¯æ’­æ”¾</td><td></td></tr><tr><td>muted</td><td>é™éŸ³æ’­æ”¾</td><td></td></tr><tr><td>autoplay</td><td>è‡ªåŠ¨æ’­æ”¾</td><td>ä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒï¼Œæµè§ˆå™¨æ”¯æŒåœ¨<strong>é™éŸ³çŠ¶æ€</strong>è‡ªåŠ¨æ’­æ”¾</td></tr></tbody></table><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åœ¨æµè§ˆå™¨ä¸­ï¼Œæƒ³è¦è‡ªåŠ¨æ’­æ”¾ï¼Œå¿…é¡»æœ‰ muted å±æ€§ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">&quot;./media/vue.mp4&quot;</span> <span class="attr">controls</span> <span class="attr">loop</span> <span class="attr">muted</span> <span class="attr">autoplay</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="zong-he-an-li-yi-ge-ren-jian-jie" id="ç»¼åˆæ¡ˆä¾‹ä¸€-ä¸ªäººç®€ä»‹">ç»¼åˆæ¡ˆä¾‹ä¸€-ä¸ªäººç®€ä»‹</h2><p><strong>alt+z</strong>ï¼šå®ç°vscodeæŠ˜è¡Œæ•ˆæœ</p><blockquote><p>ç½‘é¡µåˆ¶ä½œæ€è·¯ï¼šä»ä¸Šåˆ°ä¸‹ï¼Œå…ˆæ•´ä½“å†å±€éƒ¨ï¼Œé€æ­¥åˆ†æåˆ¶ä½œ</p><p>åˆ†æå†…å®¹ â†’ å†™ä»£ç  â†’ ä¿å­˜ â†’ åˆ·æ–°æµè§ˆå™¨ï¼Œçœ‹æ•ˆæœ</p></blockquote><p><img src="https://s1.vika.cn/space/2023/04/16/ab9344c6d3d94209bc66ffb2b25b8684" alt="1680314754557"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>å°¤é›¨æºª<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>å°¤é›¨æºªï¼Œå‰ç«¯æ¡†æ¶<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;../17-ç»¼åˆæ¡ˆä¾‹äºŒ/vueç®€ä»‹.html&quot;</span>&gt;</span>Vue.js<span class="tag">&lt;/<span class="name">a</span>&gt;</span>çš„ä½œè€…ï¼Œ<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>HTML5<span class="tag">&lt;/<span class="name">a</span>&gt;</span>ç‰ˆClearçš„æ‰“é€ äººï¼Œç‹¬ç«‹å¼€æºå¼€å‘è€…ã€‚æ›¾å°±èŒäºGoogle Creative Labså’ŒMeteor Development Groupã€‚ç”±äºå·¥ä½œä¸­å¤§é‡æ¥è§¦å¼€æºçš„é¡¹ç›®<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">a</span>&gt;</span>ï¼Œæœ€åè‡ªå·±ä¹Ÿèµ°ä¸Šäº†å¼€æºä¹‹è·¯ï¼Œç°å…¨èŒå¼€å‘å’Œç»´æŠ¤<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Vue.js<span class="tag">&lt;/<span class="name">a</span>&gt;</span>ã€‚</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./photo.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;å°¤é›¨æºªçš„ç…§ç‰‡&quot;</span> <span class="attr">title</span>=<span class="string">&quot;å°¤é›¨æºª&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>å­¦ä¹ ç»å†<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>å°¤é›¨æºªæ¯•ä¸šäºä¸Šæµ·å¤æ—¦é™„ä¸­ï¼Œåœ¨ç¾å›½å®Œæˆå¤§å­¦å­¦ä¸šï¼Œæœ¬ç§‘æ¯•ä¸šäºColgate Universityï¼Œååœ¨Parsonsè®¾è®¡å­¦é™¢è·å¾—Design &amp; Technologyè‰ºæœ¯ç¡•å£«å­¦ä½ï¼Œä»»èŒäºçº½çº¦Google Creative Labã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>ä¸»è¦æˆå°±<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>å°¤é›¨æºª<span class="tag">&lt;<span class="name">strong</span>&gt;</span>å¤§å­¦ä¸“ä¸šå¹¶éæ˜¯è®¡ç®—æœºä¸“ä¸š<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>ï¼Œåœ¨å¤§å­¦æœŸé—´ä»–å­¦ä¹ ä¸“ä¸šæ˜¯å®¤å†…è‰ºæœ¯å’Œè‰ºæœ¯å²ï¼Œåæ¥è¯»äº†ç¾æœ¯è®¾è®¡å’ŒæŠ€æœ¯çš„ç¡•å£«ï¼Œ <span class="tag">&lt;<span class="name">ins</span>&gt;</span>æ­£æ˜¯åœ¨è¯»ç¡•å£«æœŸé—´ï¼Œä»–å¶ç„¶æ¥è§¦åˆ°äº†JavaScript ï¼Œä»æ­¤è¢«è¿™é—¨ç¼–ç¨‹è¯­è¨€æ·±æ·±å¸å¼•ï¼Œå¼€å¯äº†è‡ªå·±çš„å‰ç«¯ç”Ÿæ¶¯<span class="tag">&lt;/<span class="name">ins</span>&gt;</span> ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>2014å¹´2æœˆï¼Œå¼€å‘äº†ä¸€ä¸ªå‰ç«¯å¼€å‘åº“Vue.jsã€‚Vue.js æ˜¯æ„å»º Web ç•Œé¢çš„ JavaScript æ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªé€šè¿‡ç®€æ´çš„APIæä¾›é«˜æ•ˆçš„æ•°æ®ç»‘å®šå’Œçµæ´»çš„ç»„ä»¶ç³»ç»Ÿã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>ç¤¾ä¼šä»»èŒ<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>2016å¹´9æœˆ3æ—¥ï¼Œåœ¨å—äº¬çš„JSConfä¸Šï¼ŒVueä½œè€…å°¤é›¨æºªæ­£å¼å®£å¸ƒåŠ ç›Ÿé˜¿é‡Œå·´å·´Weexå›¢é˜Ÿï¼Œå°¤é›¨æºªç§°ä»–å°†ä»¥æŠ€æœ¯é¡¾é—®çš„èº«ä»½åŠ å…¥Weexå›¢é˜Ÿæ¥åš Vue å’Œ Weex çš„ JavaScript runtime æ•´åˆï¼Œç›®æ ‡æ˜¯è®©å¤§å®¶èƒ½ç”¨ Vue çš„è¯­æ³•è·¨ä¸‰ç«¯ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="zong-he-an-li-er-vue-jian-jie" id="ç»¼åˆæ¡ˆä¾‹äºŒ-Vueç®€ä»‹">ç»¼åˆæ¡ˆä¾‹äºŒ-Vueç®€ä»‹</h2><p><img src="https://s1.vika.cn/space/2023/04/16/81fa9eb64c624023b487c77dd50ad294" alt="1680314805528"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Vue.js<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Vue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äº view) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼JavaScriptæ¡†æ¶ã€‚ [5] ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸ç°ä»£åŒ–çš„å·¥å…·é“¾ä»¥åŠå„ç§æ”¯æŒç±»åº“ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æä¾›é©±åŠ¨ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>å…¶ä½œè€…ä¸º<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;../16-ç»¼åˆæ¡ˆä¾‹ä¸€/ä¸ªäººç®€ä»‹.html&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>å°¤é›¨æºª<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>ä¸»è¦åŠŸèƒ½<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Vue.jsæ˜¯ä¸€å¥—æ„å»ºç”¨æˆ·ç•Œé¢çš„æ¸è¿›å¼æ¡†æ¶ã€‚ä¸å…¶ä»–é‡é‡çº§æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVueé‡‡ç”¨è‡ªåº•å‘ä¸Šå¢é‡å¼€å‘çš„è®¾è®¡ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œå¹¶ä¸”éå¸¸å®¹æ˜“å­¦ä¹ ï¼Œéå¸¸å®¹æ˜“ä¸å…¶å®ƒåº“æˆ–å·²æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼ŒVue å®Œå…¨æœ‰èƒ½åŠ›é©±åŠ¨é‡‡ç”¨å•æ–‡ä»¶ç»„ä»¶å’ŒVueç”Ÿæ€ç³»ç»Ÿæ”¯æŒçš„åº“å¼€å‘çš„å¤æ‚å•é¡µåº”ç”¨ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Vue.js çš„ç›®æ ‡æ˜¯é€šè¿‡å°½å¯èƒ½ç®€å•çš„ API å®ç°å“åº”çš„æ•°æ®ç»‘å®šå’Œç»„åˆçš„è§†å›¾ç»„ä»¶ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Vue.js è‡ªèº«ä¸æ˜¯ä¸€ä¸ªå…¨èƒ½æ¡†æ¶â€”â€”å®ƒåªèšç„¦äºè§†å›¾å±‚ã€‚å› æ­¤å®ƒéå¸¸å®¹æ˜“å­¦ä¹ ï¼Œéå¸¸å®¹æ˜“ä¸å…¶å®ƒåº“æˆ–å·²æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨ä¸ç›¸å…³å·¥å…·å’Œæ”¯æŒåº“ä¸€èµ·ä½¿ç”¨æ—¶ [2] ï¼ŒVue.js ä¹Ÿèƒ½é©±åŠ¨å¤æ‚çš„å•é¡µåº”ç”¨ã€‚<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">&quot;../media/vue.mp4&quot;</span> <span class="attr">controls</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="day-02-lie-biao-biao-ge-biao-dan">day02ï¼šåˆ—è¡¨ã€è¡¨æ ¼ã€è¡¨å•</h1><blockquote><p>ç›®æ ‡ï¼šæŒæ¡åµŒå¥—å…³ç³»æ ‡ç­¾çš„å†™æ³•ï¼Œä½¿ç”¨åˆ—è¡¨æ ‡ç­¾å¸ƒå±€ç½‘é¡µ</p></blockquote><h2 id="01-lie-biao" id="01-åˆ—è¡¨">01-åˆ—è¡¨</h2><p>ä½œç”¨ï¼šå¸ƒå±€å†…å®¹æ’åˆ—æ•´é½çš„åŒºåŸŸã€‚</p><p>åˆ—è¡¨åˆ†ç±»ï¼šæ— åºåˆ—è¡¨ã€æœ‰åºåˆ—è¡¨ã€å®šä¹‰åˆ—è¡¨ã€‚</p><h3 id="wu-xu-lie-biao" id="æ— åºåˆ—è¡¨">æ— åºåˆ—è¡¨</h3><p>ä½œç”¨ï¼šå¸ƒå±€æ’åˆ—æ•´é½çš„<strong>ä¸éœ€è¦è§„å®šé¡ºåº</strong>çš„åŒºåŸŸã€‚</p><p>æ ‡ç­¾ï¼šul åµŒå¥— liï¼Œul æ˜¯æ— åºåˆ—è¡¨ï¼Œli æ˜¯åˆ—è¡¨æ¡ç›®ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">li</span>&gt;</span>ç¬¬ä¸€é¡¹<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">li</span>&gt;</span>ç¬¬äºŒé¡¹<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">li</span>&gt;</span>ç¬¬ä¸‰é¡¹<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  â€¦â€¦</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>ul æ ‡ç­¾é‡Œé¢åªèƒ½åŒ…è£¹ li æ ‡ç­¾</li><li>li æ ‡ç­¾é‡Œé¢å¯ä»¥åŒ…è£¹ä»»ä½•å†…å®¹</li></ul></blockquote><h3 id="you-xu-lie-biao" id="æœ‰åºåˆ—è¡¨">æœ‰åºåˆ—è¡¨</h3><p>ä½œç”¨ï¼šå¸ƒå±€æ’åˆ—æ•´é½çš„<strong>éœ€è¦è§„å®šé¡ºåº</strong>çš„åŒºåŸŸã€‚</p><p>æ ‡ç­¾ï¼šol åµŒå¥— liï¼Œol æ˜¯æœ‰åºåˆ—è¡¨ï¼Œli æ˜¯åˆ—è¡¨æ¡ç›®ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">li</span>&gt;</span>ç¬¬ä¸€é¡¹<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">li</span>&gt;</span>ç¬¬äºŒé¡¹<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">li</span>&gt;</span>ç¬¬ä¸‰é¡¹<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  â€¦â€¦</span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>ol æ ‡ç­¾é‡Œé¢åªèƒ½åŒ…è£¹ li æ ‡ç­¾</li><li>li æ ‡ç­¾é‡Œé¢å¯ä»¥åŒ…è£¹ä»»ä½•å†…å®¹</li></ul></blockquote><h3 id="ding-yi-lie-biao" id="å®šä¹‰åˆ—è¡¨">å®šä¹‰åˆ—è¡¨</h3><p>æ ‡ç­¾ï¼šdl åµŒå¥— dt å’Œ ddï¼Œ</p><ul><li>dl æ˜¯å®šä¹‰åˆ—è¡¨ï¼Œ</li><li>dt æ˜¯å®šä¹‰åˆ—è¡¨çš„æ ‡é¢˜ï¼Œ</li><li>dd æ˜¯å®šä¹‰åˆ—è¡¨çš„æè¿° / è¯¦æƒ…ã€‚</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>åˆ—è¡¨æ ‡é¢˜<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>åˆ—è¡¨æè¿° / è¯¦æƒ…<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">   â€¦â€¦</span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://s1.vika.cn/space/2023/04/17/8c39057c007b41399bb832ae05d962d3" alt="1680315652403"></p><blockquote><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>dl é‡Œé¢åªèƒ½åŒ…å«dt å’Œ dd</li><li>dt å’Œ dd é‡Œé¢å¯ä»¥åŒ…å«ä»»ä½•å†…å®¹</li></ul></blockquote><h2 id="02-biao-ge" id="02-è¡¨æ ¼">02-è¡¨æ ¼</h2><p>ç½‘é¡µä¸­çš„è¡¨æ ¼ä¸ Excel è¡¨æ ¼ç±»ä¼¼ï¼Œç”¨æ¥å±•ç¤ºæ•°æ®ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/17/cdcc795c5f144294a811a8be3b240a5c" alt="1680315690740"></p><h3 id="ji-ben-shi-yong" id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</h3><p>æ ‡ç­¾ï¼štable åµŒå¥— trï¼Œtr åµŒå¥— td / thã€‚</p><table><thead><tr><th>æ ‡ç­¾å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>table</td><td>è¡¨æ ¼</td></tr><tr><td>caption</td><td>è¡¨æ ¼åå­—</td></tr><tr><td>tr</td><td>è¡Œ</td></tr><tr><td>th</td><td><strong>è¡¨å¤´</strong>å•å…ƒæ ¼</td></tr><tr><td>td</td><td><strong>å†…å®¹</strong>å•å…ƒæ ¼</td></tr></tbody></table><blockquote><p>æç¤ºï¼šåœ¨ç½‘é¡µä¸­ï¼Œ<strong>è¡¨æ ¼é»˜è®¤æ²¡æœ‰è¾¹æ¡†çº¿</strong>ï¼Œä½¿ç”¨ <strong>border å±æ€§</strong>å¯ä»¥ä¸ºè¡¨æ ¼æ·»åŠ è¾¹æ¡†çº¿ã€‚</p><ul><li>å…¶ä¸­å†…å®¹ <code>1</code> è¡¨ç¤ºè¾¹æ¡†çº¿ä½1åƒç´ å•ä½ç²—</li></ul></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>å§“å<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>è¯­æ–‡<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>æ•°å­¦<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>æ€»åˆ†<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>å¼ ä¸‰<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>99<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>100<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>199<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>æå››<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>98<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>100<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>198<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>æ€»ç»“<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>å…¨å¸‚ç¬¬ä¸€<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>å…¨å¸‚ç¬¬ä¸€<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>å…¨å¸‚ç¬¬ä¸€<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="biao-ge-jie-gou-biao-qian-liao-jie" id="è¡¨æ ¼ç»“æ„æ ‡ç­¾-äº†è§£">è¡¨æ ¼ç»“æ„æ ‡ç­¾-äº†è§£</h3><p>ä½œç”¨ï¼šç”¨è¡¨æ ¼ç»“æ„æ ‡ç­¾æŠŠå†…å®¹åˆ’åˆ†åŒºåŸŸï¼Œè®©è¡¨æ ¼ç»“æ„æ›´æ¸…æ™°ï¼Œè¯­ä¹‰æ›´æ¸…æ™°ã€‚</p><table><thead><tr><th>æ ‡ç­¾å</th><th>å«ä¹‰</th><th>ç‰¹æ®Šè¯´æ˜</th></tr></thead><tbody><tr><td>thead</td><td>è¡¨æ ¼å¤´éƒ¨</td><td>è¡¨æ ¼å¤´éƒ¨å†…å®¹</td></tr><tr><td>tbody</td><td>è¡¨æ ¼ä¸»ä½“</td><td>ä¸»è¦å†…å®¹åŒºåŸŸ</td></tr><tr><td>tfoot</td><td>è¡¨æ ¼åº•éƒ¨</td><td>æ±‡æ€»ä¿¡æ¯åŒºåŸŸ</td></tr></tbody></table><blockquote><p>æç¤ºï¼šè¡¨æ ¼ç»“æ„æ ‡ç­¾å¯ä»¥çœç•¥ã€‚</p></blockquote><h3 id="he-bing-dan-yuan-ge" id="åˆå¹¶å•å…ƒæ ¼">åˆå¹¶å•å…ƒæ ¼</h3><p>ä½œç”¨ï¼šå°†å¤šä¸ªå•å…ƒæ ¼åˆå¹¶æˆä¸€ä¸ªå•å…ƒæ ¼ï¼Œä»¥åˆå¹¶åŒç±»ä¿¡æ¯ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/17/22c30d7f8e93480faf9effe540f242cf" alt="1680315812998"></p><p>åˆå¹¶å•å…ƒæ ¼çš„æ­¥éª¤ï¼š</p><ol><li>æ˜ç¡®åˆå¹¶çš„ç›®æ ‡</li><li>ä¿ç•™<strong>æœ€å·¦æœ€ä¸Š</strong>çš„å•å…ƒæ ¼ï¼Œæ·»åŠ å±æ€§ï¼ˆå–å€¼æ˜¯<strong>æ•°å­—</strong>ï¼Œè¡¨ç¤ºéœ€è¦<strong>åˆå¹¶çš„å•å…ƒæ ¼æ•°é‡</strong>ï¼‰<ul><li><strong>è·¨è¡Œåˆå¹¶</strong>ï¼Œä¿ç•™æœ€ä¸Šå•å…ƒæ ¼ï¼Œæ·»åŠ å±æ€§ <strong>rowspan</strong></li><li><strong>è·¨åˆ—åˆå¹¶</strong>ï¼Œä¿ç•™æœ€å·¦å•å…ƒæ ¼ï¼Œæ·»åŠ å±æ€§ <strong>colspan</strong></li></ul></li><li>åˆ é™¤å…¶ä»–å•å…ƒæ ¼</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>å§“å<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>è¯­æ–‡<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>æ•°å­¦<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>æ€»åˆ†<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>å¼ ä¸‰<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>99<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">rowspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>100<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>199<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>æå››<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>98<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- &lt;td&gt;100&lt;/td&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>198<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tfoot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>æ€»ç»“<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span>&gt;</span>å…¨å¸‚ç¬¬ä¸€<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- &lt;td&gt;å…¨å¸‚ç¬¬ä¸€&lt;/td&gt;</span></span><br><span class="line"><span class="comment">      &lt;td&gt;å…¨å¸‚ç¬¬ä¸€&lt;/td&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tfoot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šä¸èƒ½è·¨è¡¨æ ¼ç»“æ„æ ‡ç­¾åˆå¹¶å•å…ƒæ ¼ï¼ˆtheadã€tbodyã€tfootï¼‰ã€‚</p></blockquote><h2 id="03-biao-dan" id="03-è¡¨å•">03-è¡¨å•</h2><p>ä½œç”¨ï¼šæ”¶é›†ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>ç™»å½•é¡µé¢</li><li>æ³¨å†Œé¡µé¢</li><li>æœç´¢åŒºåŸŸ</li></ul><h3 id="input-biao-qian" id="input-æ ‡ç­¾">input æ ‡ç­¾</h3><p>input æ ‡ç­¾ type å±æ€§å€¼ä¸åŒï¼Œåˆ™åŠŸèƒ½ä¸åŒã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;...&quot;</span> &gt;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>type å±æ€§å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>text</td><td>å¯†ç æ¡†</td></tr><tr><td>password</td><td>å¯†ç æ¡†</td></tr><tr><td>radio</td><td>å•é€‰æ¡†</td></tr><tr><td>checkbox</td><td>å¤šé€‰æ¡†</td></tr><tr><td>file</td><td>ä¸Šä¼ æ–‡ä»¶</td></tr></tbody></table><h3 id="input-biao-qian-zhan-wei-wen-ben" id="input-æ ‡ç­¾å ä½æ–‡æœ¬">input æ ‡ç­¾å ä½æ–‡æœ¬</h3><p>å ä½æ–‡æœ¬ï¼šæç¤ºä¿¡æ¯ï¼Œæ–‡æœ¬æ¡†å’Œå¯†ç æ¡†éƒ½å¯ä»¥ä½¿ç”¨ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;...&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;æç¤ºä¿¡æ¯&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="dan-xuan-kuang" id="å•é€‰æ¡†">å•é€‰æ¡†</h3><p>å¸¸ç”¨å±æ€§</p><table><thead><tr><th>å±æ€§å</th><th>ä½œç”¨</th><th>ç‰¹æ®Šè¯´æ˜</th></tr></thead><tbody><tr><td>name</td><td>ç©ºé—´åç§°</td><td>ç©ºé—´åˆ†ç»„ï¼ŒåŒç»„åªèƒ½é€‰ä¸­ä¸€ä¸ªï¼ˆå•é€‰åŠŸèƒ½ï¼‰</td></tr><tr><td>checked</td><td>é»˜è®¤é€‰ä¸­</td><td>å±æ€§åå’Œå±æ€§å€¼ç›¸åŒï¼Œç®€å†™ä¸ºä¸€ä¸ªå•è¯</td></tr></tbody></table><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">checked</span>&gt;</span> ç”·</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span>&gt;</span> å¥³</span><br></pre></td></tr></table></figure><blockquote><p>æç¤ºï¼šname å±æ€§å€¼è‡ªå®šä¹‰ã€‚</p></blockquote><h3 id="shang-chuan-wen-jian" id="ä¸Šä¼ æ–‡ä»¶">ä¸Šä¼ æ–‡ä»¶</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–‡ä»¶ä¸Šä¼ è¡¨å•æ§ä»¶åªèƒ½ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œæ·»åŠ  multiple å±æ€§å¯ä»¥å®ç°æ–‡ä»¶å¤šé€‰åŠŸèƒ½ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">multiple</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="duo-xuan-kuang" id="å¤šé€‰æ¡†">å¤šé€‰æ¡†</h3><p>å¤šé€‰æ¡†ä¹Ÿå«å¤é€‰æ¡†ï¼Œé»˜è®¤é€‰ä¸­ï¼šcheckedã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å…´è¶£çˆ±å¥½ï¼š</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span> æ•²ä»£ç </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">checked</span>&gt;</span> æ¡¥å‰ç«¯ä»£ç </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">checked</span>&gt;</span> æ•²HTMLä»£ç </span><br></pre></td></tr></table></figure><h3 id="xia-la-cai-dan" id="ä¸‹æ‹‰èœå•">ä¸‹æ‹‰èœå•</h3><p><img src="https://s1.vika.cn/space/2023/04/18/dbc09a92757d4d6bab325bb7513dec10" alt="1680316175031"></p><p>æ ‡ç­¾ï¼šselect åµŒå¥— optionï¼Œselect æ˜¯ä¸‹æ‹‰èœå•æ•´ä½“ï¼Œoptionæ˜¯ä¸‹æ‹‰èœå•çš„æ¯ä¸€é¡¹ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">option</span>&gt;</span>åŒ—äº¬<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">option</span>&gt;</span>ä¸Šæµ·<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">option</span>&gt;</span>å¹¿å·<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">option</span>&gt;</span>æ·±åœ³<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">Â  <span class="tag">&lt;<span class="name">option</span> <span class="attr">selected</span>&gt;</span>æ­¦æ±‰<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>é»˜è®¤æ˜¾ç¤ºç¬¬ä¸€é¡¹ï¼Œ<strong>selected</strong> å±æ€§å®ç°<strong>é»˜è®¤é€‰ä¸­</strong>åŠŸèƒ½ã€‚</p></blockquote><h3 id="wen-ben-yu" id="æ–‡æœ¬åŸŸ">æ–‡æœ¬åŸŸ</h3><p>ä½œç”¨ï¼šå¤šè¡Œè¾“å…¥æ–‡æœ¬çš„è¡¨å•æ§ä»¶ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/18/ba16c5795e7745a68b3223d076d8cc75" alt="1680316238194"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">textarea</span>&gt;</span>é»˜è®¤æç¤ºæ–‡å­—<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ç‚¹ï¼š</p><ul><li>å®é™…å¼€å‘ä¸­ï¼Œä½¿ç”¨ CSS è®¾ç½® æ–‡æœ¬åŸŸçš„å°ºå¯¸</li><li>å®é™…å¼€å‘ä¸­ï¼Œä¸€èˆ¬ç¦ç”¨å³ä¸‹è§’çš„æ‹–æ‹½åŠŸèƒ½</li></ul></blockquote><h3 id="label-biao-qian" id="label-æ ‡ç­¾">label æ ‡ç­¾</h3><p>ä½œç”¨ï¼šç½‘é¡µä¸­ï¼ŒæŸä¸ªæ ‡ç­¾çš„è¯´æ˜æ–‡æœ¬ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/18/fdaa34fa934c43afa0dcc3a8a07ef76a" alt="1680316296894"></p><p>ç»éªŒï¼šç”¨ label æ ‡ç­¾ç»‘å®šæ–‡å­—å’Œè¡¨å•æ§ä»¶çš„å…³ç³»ï¼Œå¢å¤§è¡¨å•æ§ä»¶çš„ç‚¹å‡»èŒƒå›´ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/18/41d98171623744c1b088cbbb6f8dc5e9" alt="1680316314721"></p><ul><li>å†™æ³•ä¸€<ul><li>label æ ‡ç­¾åªåŒ…è£¹å†…å®¹ï¼Œä¸åŒ…è£¹è¡¨å•æ§ä»¶</li><li>è®¾ç½® label æ ‡ç­¾çš„ for å±æ€§å€¼ å’Œè¡¨å•æ§ä»¶çš„ id å±æ€§å€¼ç›¸åŒ</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">id</span>=<span class="string">&quot;man&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;man&quot;</span>&gt;</span>ç”·<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å†™æ³•äºŒï¼šä½¿ç”¨ label æ ‡ç­¾åŒ…è£¹æ–‡å­—å’Œè¡¨å•æ§ä»¶ï¼Œä¸éœ€è¦å±æ€§</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span>&gt;</span> å¥³<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æç¤ºï¼šæ”¯æŒ label æ ‡ç­¾å¢å¤§ç‚¹å‡»èŒƒå›´çš„è¡¨å•æ§ä»¶ï¼šæ–‡æœ¬æ¡†ã€å¯†ç æ¡†ã€ä¸Šä¼ æ–‡ä»¶ã€å•é€‰æ¡†ã€å¤šé€‰æ¡†ã€ä¸‹æ‹‰èœå•ã€æ–‡æœ¬åŸŸç­‰ç­‰ã€‚</p></blockquote><h3 id="an-niu-form-biao-qian" id="æŒ‰é’®ã€form-æ ‡ç­¾">æŒ‰é’®ã€form æ ‡ç­¾</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;&quot;</span>&gt;</span>æŒ‰é’®<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>type å±æ€§å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>submit</td><td>æäº¤æŒ‰é’®ï¼Œç‚¹å‡»åå¯ä»¥æäº¤æ•°æ®åˆ°åå°ï¼ˆé»˜è®¤åŠŸèƒ½ï¼‰</td></tr><tr><td>reset</td><td>é‡ç½®æŒ‰é’®ï¼Œç‚¹å‡»åå°†è¡¨å•æ§ä»¶æ¢å¤é»˜è®¤å€¼</td></tr><tr><td>button</td><td>æ™®é€šæŒ‰é’®ï¼Œé»˜è®¤æ²¡æœ‰åŠŸèƒ½ï¼Œä¸€èˆ¬é…åˆ JavaScript ä½¿ç”¨</td></tr></tbody></table><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- form è¡¨å•åŒºåŸŸ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- action=&quot;&quot; å‘é€æ•°æ®çš„åœ°å€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  ç”¨æˆ·åï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  å¯†ç ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- å¦‚æœçœç•¥ type å±æ€§ï¼ŒåŠŸèƒ½æ˜¯ æäº¤ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>æäº¤<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;reset&quot;</span>&gt;</span>é‡ç½®<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span>&gt;</span>æ™®é€šæŒ‰é’®<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æç¤ºï¼šæŒ‰é’®éœ€é…åˆ form æ ‡ç­¾ï¼ˆè¡¨å•åŒºåŸŸï¼‰æ‰èƒ½å®ç°å¯¹åº”çš„åŠŸèƒ½ã€‚</p></blockquote><h2 id="04-yu-yi-hua" id="04-è¯­ä¹‰åŒ–">04-è¯­ä¹‰åŒ–</h2><h3 id="wu-yu-yi-de-bu-ju-biao-qian" id="æ— è¯­ä¹‰çš„å¸ƒå±€æ ‡ç­¾">æ— è¯­ä¹‰çš„å¸ƒå±€æ ‡ç­¾</h3><p>ä½œç”¨ï¼šå¸ƒå±€ç½‘é¡µï¼ˆåˆ’åˆ†ç½‘é¡µåŒºåŸŸï¼Œæ‘†æ”¾å†…å®¹ï¼‰</p><ul><li>divï¼šç‹¬å ä¸€è¡Œ</li><li>spanï¼šä¸æ¢è¡Œ</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>div æ ‡ç­¾ï¼Œç‹¬å ä¸€è¡Œ<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>span æ ‡ç­¾ï¼Œä¸æ¢è¡Œ<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="you-yu-yi-de-bu-ju-biao-qian" id="æœ‰è¯­ä¹‰çš„å¸ƒå±€æ ‡ç­¾">æœ‰è¯­ä¹‰çš„å¸ƒå±€æ ‡ç­¾</h3><table><thead><tr><th style="text-align:center">æ ‡ç­¾å</th><th style="text-align:center">è¯­ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center">header</td><td style="text-align:center">ç½‘é¡µå¤´éƒ¨</td></tr><tr><td style="text-align:center">nav</td><td style="text-align:center">ç½‘é¡µå¯¼èˆª</td></tr><tr><td style="text-align:center">footer</td><td style="text-align:center">ç½‘é¡µåº•éƒ¨</td></tr><tr><td style="text-align:center">aside</td><td style="text-align:center">ç½‘é¡µä¾§è¾¹æ </td></tr><tr><td style="text-align:center">section</td><td style="text-align:center">ç½‘é¡µåŒºå—</td></tr><tr><td style="text-align:center">article</td><td style="text-align:center">ç½‘é¡µæ–‡ç« </td></tr></tbody></table><h2 id="05-zi-fu-shi-ti" id="05-å­—ç¬¦å®ä½“">05-å­—ç¬¦å®ä½“</h2><table><thead><tr><th>æ˜¾ç¤ºç»“æœ</th><th>æè¿°</th><th>å®ä½“åç§°</th></tr></thead><tbody><tr><td></td><td>ç©ºæ ¼</td><td>&amp;nbspï¼›</td></tr><tr><td>&lt;</td><td>å°äºå·</td><td>&amp;ltï¼›</td></tr><tr><td>&gt;</td><td>å¤§äºå·</td><td>&amp;gtï¼›</td></tr></tbody></table><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä¹¾å¤æœªå®šï¼Œä½ æˆ‘çš†æ˜¯é»‘<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>é©¬</span><br><span class="line"><span class="symbol">&amp;lt;</span>p<span class="symbol">&amp;gt;</span></span><br></pre></td></tr></table></figure><h2 id="06-zong-he-an-li-yi-ti-yu-xin-wen-lie-biao" id="06-ç»¼åˆæ¡ˆä¾‹ä¸€â€”ä½“è‚²æ–°é—»åˆ—è¡¨">06-ç»¼åˆæ¡ˆä¾‹ä¸€â€”ä½“è‚²æ–°é—»åˆ—è¡¨</h2><p><img src="https://s1.vika.cn/space/2023/04/18/65e20aa06a5c4ac3adf5660350009341" alt="1680316581559"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/1.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>ä¸»å¸…å®‰ä¸œå°¼å¥¥å›è¥¿ç­ç‰™ä¼‘å‡ å›½é’æŠµè¾¾æµ·å£è¿›è¡Œéš”ç¦»<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/2.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>æ¢…å·ä¸»å¸…ï¼šç”³èŠ±æœ‰å¼ºæœ‰åŠ›çš„æ•™ç»ƒç»„ çƒå‘˜ä½“èƒ½æ°´å¹³é«˜<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/3.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>é©¬å¾·å…´:00åçƒå‘˜å°†é¦–ç™»äºšæ´²èˆå° è°ƒæ•´å¿ƒæ€æ‰åŠ¡å®<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="07-zong-he-an-li-er-zhu-ce-xin-xi" id="07-ç»¼åˆæ¡ˆä¾‹äºŒâ€”æ³¨å†Œä¿¡æ¯">07-ç»¼åˆæ¡ˆä¾‹äºŒâ€”æ³¨å†Œä¿¡æ¯</h2><p><img src="https://s1.vika.cn/space/2023/04/18/9edc5857806c4a459d91239887d0164f" alt="1680316627956"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>æ³¨å†Œä¿¡æ¯<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- è¡¨å•æ§ä»¶ --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ä¸ªäººä¿¡æ¯ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>ä¸ªäººä¿¡æ¯<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>å§“åï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥çœŸå®å§“å&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>å¯†ç ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥å¯†ç &quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>ç¡®è®¤å¯†ç ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥ç¡®è®¤å¯†ç &quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>æ€§åˆ«ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span>&gt;</span> ç”·<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">checked</span>&gt;</span> å¥³<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>å±…ä½åŸå¸‚ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>åŒ—äº¬<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>ä¸Šæµ·<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>å¹¿å·<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>æ·±åœ³<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>æ­¦æ±‰<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æ•™è‚²ç»å† --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>æ•™è‚²ç»å†<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>æœ€é«˜å­¦å†ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>åšå£«<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>ç¡•å£«<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>æœ¬ç§‘<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>å¤§ä¸“<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>å­¦æ ¡åç§°ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>æ‰€å­¦ä¸“ä¸šï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>åœ¨æ ¡æ—¶é—´ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>2015<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>2016<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>2017<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>2018<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  --</span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>2019<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>2020<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>2021<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>2022<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å·¥ä½œç»å† --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>å·¥ä½œç»å†<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>å…¬å¸åç§°ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>å·¥ä½œæè¿°ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">textarea</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- åè®® å’Œ æŒ‰é’® --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>å·²é˜…è¯»å¹¶åŒæ„ä»¥ä¸‹åè®®ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>ã€Šç”¨æˆ·æœåŠ¡åè®®ã€‹<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>ã€Šéšç§æ”¿ç­–ã€‹<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span>&gt;</span>å…è´¹æ³¨å†Œ<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;reset&quot;</span>&gt;</span>é‡æ–°å¡«å†™<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">HTMLåŸºæœ¬æ ‡ç­¾è¯­æ³•ã€åˆ—è¡¨è¡¨æ ¼è¡¨å•</summary>
    
    
    
    <category term="Webå‰ç«¯" scheme="https://www.taoyaopc.live/categories/Web%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="Html" scheme="https://www.taoyaopc.live/tags/Html/"/>
    
    <category term="å‰ç«¯" scheme="https://www.taoyaopc.live/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>å¤šçº§ç¼“å­˜</title>
    <link href="https://www.taoyaopc.live/posts/9c74e32c.html"/>
    <id>https://www.taoyaopc.live/posts/9c74e32c.html</id>
    <published>2023-04-09T15:00:00.000Z</published>
    <updated>2023-04-15T01:51:38.119Z</updated>
    
    <content type="html"><![CDATA[<h1 id="duo-ji-huan-cun">å¤šçº§ç¼“å­˜</h1><h1 id="shi-yao-shi-duo-ji-huan-cun">ä»€ä¹ˆæ˜¯å¤šçº§ç¼“å­˜</h1><p>ä¼ ç»Ÿçš„ç¼“å­˜ç­–ç•¥ä¸€èˆ¬æ˜¯è¯·æ±‚åˆ°è¾¾Tomcatåï¼Œå…ˆæŸ¥è¯¢Redisï¼Œå¦‚æœæœªå‘½ä¸­åˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/08/0f411887041b463da236902113f01732" alt="image-20210821075259137"></p><p>å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li><p>è¯·æ±‚è¦ç»è¿‡Tomcatå¤„ç†ï¼ŒTomcatçš„æ€§èƒ½æˆä¸ºæ•´ä¸ªç³»ç»Ÿçš„ç“¶é¢ˆ</p></li><li><p>Redisç¼“å­˜å¤±æ•ˆæ—¶ï¼Œä¼šå¯¹æ•°æ®åº“äº§ç”Ÿå†²å‡»</p></li></ul><blockquote><p>å¤šçº§ç¼“å­˜å°±æ˜¯å……åˆ†åˆ©ç”¨è¯·æ±‚å¤„ç†çš„æ¯ä¸ªç¯èŠ‚ï¼Œåˆ†åˆ«æ·»åŠ ç¼“å­˜ï¼Œå‡è½»Tomcatå‹åŠ›ï¼Œæå‡æœåŠ¡æ€§èƒ½ï¼š</p></blockquote><ul><li>æµè§ˆå™¨è®¿é—®é™æ€èµ„æºæ—¶ï¼Œä¼˜å…ˆè¯»å–æµè§ˆå™¨æœ¬åœ°ç¼“å­˜</li><li>è®¿é—®éé™æ€èµ„æºï¼ˆajaxæŸ¥è¯¢æ•°æ®ï¼‰æ—¶ï¼Œè®¿é—®æœåŠ¡ç«¯</li><li>è¯·æ±‚åˆ°è¾¾Nginxåï¼Œä¼˜å…ˆè¯»å–Nginxæœ¬åœ°ç¼“å­˜</li><li>å¦‚æœNginxæœ¬åœ°ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™å»ç›´æ¥æŸ¥è¯¢Redisï¼ˆä¸ç»è¿‡Tomcatï¼‰</li><li>å¦‚æœRedisæŸ¥è¯¢æœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢Tomcat</li><li>è¯·æ±‚è¿›å…¥Tomcatåï¼Œä¼˜å…ˆæŸ¥è¯¢JVMè¿›ç¨‹ç¼“å­˜</li><li>å¦‚æœJVMè¿›ç¨‹ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“</li></ul><p><img src="https://s1.vika.cn/space/2023/04/08/ee1c943ba6ec436d92964a680491a7a2" alt="image-20210821075558137"></p><p>åœ¨å¤šçº§ç¼“å­˜æ¶æ„ä¸­ï¼Œ<u>Nginxå†…éƒ¨éœ€è¦ç¼–å†™æœ¬åœ°ç¼“å­˜æŸ¥è¯¢ã€RedisæŸ¥è¯¢ã€TomcatæŸ¥è¯¢çš„ä¸šåŠ¡é€»è¾‘</u>ï¼Œå› æ­¤è¿™æ ·çš„nginxæœåŠ¡ä¸å†æ˜¯ä¸€ä¸ª<strong>åå‘ä»£ç†æœåŠ¡å™¨</strong>ï¼Œè€Œæ˜¯ä¸€ä¸ªç¼–å†™<strong>ä¸šåŠ¡çš„WebæœåŠ¡å™¨äº†</strong>ã€‚</p><p>å› æ­¤è¿™æ ·çš„ä¸šåŠ¡NginxæœåŠ¡ä¹Ÿéœ€è¦æ­å»ºé›†ç¾¤æ¥æé«˜å¹¶å‘ï¼Œå†æœ‰ä¸“é—¨çš„nginxæœåŠ¡æ¥åšåå‘ä»£ç†ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/08/4d3b76906c6c42fdb6f514c08092fd40" alt="image-20210821080511581"></p><p>å¦å¤–ï¼Œæˆ‘ä»¬çš„TomcatæœåŠ¡å°†æ¥ä¹Ÿä¼šéƒ¨ç½²ä¸ºé›†ç¾¤æ¨¡å¼ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/08/6fe8e190044f4d848f1eb088d54b30e4" alt="image-20210821080954947"></p><p>å¯è§ï¼Œå¤šçº§ç¼“å­˜çš„å…³é”®æœ‰ä¸¤ä¸ªï¼š</p><ul><li><p>ä¸€ä¸ªæ˜¯åœ¨nginxä¸­ç¼–å†™ä¸šåŠ¡ï¼Œå®ç°nginxæœ¬åœ°ç¼“å­˜ã€Redisã€Tomcatçš„æŸ¥è¯¢</p></li><li><p>å¦ä¸€ä¸ªå°±æ˜¯åœ¨Tomcatä¸­å®ç°JVMè¿›ç¨‹ç¼“å­˜</p></li></ul><p>å…¶ä¸­Nginxç¼–ç¨‹åˆ™ä¼šç”¨åˆ°OpenRestyæ¡†æ¶ç»“åˆLuaè¿™æ ·çš„è¯­è¨€ã€‚</p><p>è¿™ä¹Ÿæ˜¯ä»Šå¤©è¯¾ç¨‹çš„éš¾ç‚¹å’Œé‡ç‚¹ã€‚</p><h1 id="jvm-jin-cheng-huan-cun">JVMè¿›ç¨‹ç¼“å­˜</h1><p>ä¸ºäº†æ¼”ç¤ºå¤šçº§ç¼“å­˜çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å…ˆå‡†å¤‡ä¸€ä¸ªå•†å“æŸ¥è¯¢çš„ä¸šåŠ¡ã€‚</p><h2 id="dao-ru-an-li" id="å¯¼å…¥æ¡ˆä¾‹">å¯¼å…¥æ¡ˆä¾‹</h2><h3 id="an-zhuang-my-sql" id="å®‰è£…MySQL">å®‰è£…MySQL</h3><p>åæœŸåšæ•°æ®åŒæ­¥éœ€è¦ç”¨åˆ°MySQLçš„ä¸»ä»åŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦å¤§å®¶åœ¨è™šæ‹Ÿæœºä¸­ï¼Œåˆ©ç”¨Dockeræ¥è¿è¡Œä¸€ä¸ªMySQLå®¹å™¨ã€‚</p><ol><li><strong>å‡†å¤‡ç›®å½•</strong></li></ol><p>ä¸ºäº†æ–¹ä¾¿åæœŸé…ç½®MySQLï¼Œæˆ‘ä»¬å…ˆå‡†å¤‡ä¸¤ä¸ªç›®å½•ï¼Œç”¨äºæŒ‚è½½å®¹å™¨çš„æ•°æ®å’Œé…ç½®æ–‡ä»¶ç›®å½•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥/tmpç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"><span class="comment"># åˆ›å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">mkdir</span> mysql</span><br><span class="line"><span class="comment"># è¿›å…¥mysqlç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> mysql</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>è¿è¡Œå‘½ä»¤</strong></li></ol><p>è¿›å…¥mysqlç›®å½•åï¼Œæ‰§è¡Œä¸‹é¢çš„Dockerå‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line"> -p 3306:3306 \</span><br><span class="line"> --name mysql \</span><br><span class="line"> -v <span class="variable">$PWD</span>/conf:/etc/mysql/conf.d \</span><br><span class="line"> -v <span class="variable">$PWD</span>/logs:/logs \</span><br><span class="line"> -v <span class="variable">$PWD</span>/data:/var/lib/mysql \</span><br><span class="line"> -e MYSQL_ROOT_PASSWORD=123 \</span><br><span class="line"> --privileged \</span><br><span class="line"> -d \</span><br><span class="line"> mysql:5.7.25</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>ä¿®æ”¹é…ç½®</strong></li></ol><p>åœ¨/tmp/mysql/confç›®å½•æ·»åŠ ä¸€ä¸ªmy.cnfæ–‡ä»¶ï¼Œä½œä¸ºmysqlçš„é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">touch</span> /tmp/mysql/conf/my.cnf</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line">skip-name-resolve</span><br><span class="line"><span class="attr">character_set_server</span>=utf8</span><br><span class="line"><span class="attr">datadir</span>=/var/lib/mysql</span><br><span class="line"><span class="attr">server-id</span>=<span class="number">1000</span></span><br></pre></td></tr></table></figure><ol start="4"><li><strong>é‡å¯</strong></li></ol><p>é…ç½®ä¿®æ”¹åï¼Œå¿…é¡»é‡å¯å®¹å™¨ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart mysql</span><br></pre></td></tr></table></figure><h3 id="dao-ru-sql" id="å¯¼å…¥SQL">å¯¼å…¥SQL</h3><p>æ¥ä¸‹æ¥ï¼Œåˆ©ç”¨Navicatå®¢æˆ·ç«¯è¿æ¥MySQLï¼Œç„¶åå¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„sqlæ–‡ä»¶ï¼š</p><p>å…¶ä¸­åŒ…å«ä¸¤å¼ è¡¨ï¼š</p><ul><li>tb_itemï¼šå•†å“è¡¨ï¼ŒåŒ…å«å•†å“çš„åŸºæœ¬ä¿¡æ¯</li><li>tb_item_stockï¼šå•†å“åº“å­˜è¡¨ï¼ŒåŒ…å«å•†å“çš„åº“å­˜ä¿¡æ¯</li></ul><p>ä¹‹æ‰€ä»¥å°†åº“å­˜åˆ†ç¦»å‡ºæ¥ï¼Œæ˜¯å› ä¸ºåº“å­˜æ˜¯æ›´æ–°æ¯”è¾ƒé¢‘ç¹çš„ä¿¡æ¯ï¼Œå†™æ“ä½œè¾ƒå¤šã€‚è€Œå…¶ä»–ä¿¡æ¯ä¿®æ”¹çš„é¢‘ç‡éå¸¸ä½ã€‚</p><div class="tabs" id="sql"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#sql-1">tb_item</button></li><li class="tab"><button type="button" data-href="#sql-2">tb_item_stock</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="sql-1"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `tb_item` (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;å•†å“id&#x27;,</span><br><span class="line">  `title` varchar(264) NOT NULL COMMENT &#x27;å•†å“æ ‡é¢˜&#x27;,</span><br><span class="line">  `name` varchar(128) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;å•†å“åç§°&#x27;,</span><br><span class="line">  `price` bigint(20) NOT NULL COMMENT &#x27;ä»·æ ¼ï¼ˆåˆ†ï¼‰&#x27;,</span><br><span class="line">  `image` varchar(200) DEFAULT NULL COMMENT &#x27;å•†å“å›¾ç‰‡&#x27;,</span><br><span class="line">  `category` varchar(200) DEFAULT NULL COMMENT &#x27;ç±»ç›®åç§°&#x27;,</span><br><span class="line">  `brand` varchar(100) DEFAULT NULL COMMENT &#x27;å“ç‰Œåç§°&#x27;,</span><br><span class="line">  `spec` varchar(200) DEFAULT NULL COMMENT &#x27;è§„æ ¼&#x27;,</span><br><span class="line">  `status` int(1) DEFAULT &#x27;1&#x27; COMMENT &#x27;å•†å“çŠ¶æ€ 1-æ­£å¸¸ï¼Œ2-ä¸‹æ¶ï¼Œ3-åˆ é™¤&#x27;,</span><br><span class="line">  `create_time` datetime DEFAULT NULL COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;,</span><br><span class="line">  `update_time` datetime DEFAULT NULL COMMENT &#x27;æ›´æ–°æ—¶é—´&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE,</span><br><span class="line">  KEY `status` (`status`) USING BTREE,</span><br><span class="line">  KEY `updated` (`update_time`) USING BTREE</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=50002 DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT COMMENT=&#x27;å•†å“è¡¨&#x27;;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="sql-2"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `tb_item_stock` (</span><br><span class="line">  `item_id` bigint(20) NOT NULL COMMENT &#x27;å•†å“idï¼Œå…³è”tb_itemè¡¨&#x27;,</span><br><span class="line">  `stock` int(10) NOT NULL DEFAULT &#x27;9999&#x27; COMMENT &#x27;å•†å“åº“å­˜&#x27;,</span><br><span class="line">  `sold` int(10) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;å•†å“é”€é‡&#x27;,</span><br><span class="line">  PRIMARY KEY (`item_id`) USING BTREE</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=COMPACT;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="dao-ru-demo-gong-cheng" id="å¯¼å…¥Demoå·¥ç¨‹">å¯¼å…¥Demoå·¥ç¨‹</h3><p>ä¸‹é¢å¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„å·¥ç¨‹ï¼š</p><p>é¡¹ç›®ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/08/3c2cab6ac6854aa8bccfed7f2f5b655f" alt="image-20210809181346450"></p><p>å…¶ä¸­çš„ä¸šåŠ¡åŒ…æ‹¬ï¼š</p><ul><li>åˆ†é¡µæŸ¥è¯¢å•†å“</li><li>æ–°å¢å•†å“</li><li>ä¿®æ”¹å•†å“</li><li>ä¿®æ”¹åº“å­˜</li><li>åˆ é™¤å•†å“</li><li>æ ¹æ®idæŸ¥è¯¢å•†å“</li><li>æ ¹æ®idæŸ¥è¯¢åº“å­˜</li></ul><p>ä¸šåŠ¡å…¨éƒ¨ä½¿ç”¨mybatis-plusæ¥å®ç°ï¼Œå¦‚æœ‰éœ€è¦è¯·è‡ªè¡Œä¿®æ”¹ä¸šåŠ¡é€»è¾‘ã€‚</p><ul><li>æ³¨æ„ä¿®æ”¹application.ymlæ–‡ä»¶ä¸­é…ç½®çš„mysqlåœ°å€ä¿¡æ¯ï¼š</li></ul><p><img src="https://s1.vika.cn/space/2023/04/08/082ca88a9ccc424dbc364cf84e38f13a" alt="image-20210809182350132"></p><p>éœ€è¦ä¿®æ”¹ä¸ºè‡ªå·±çš„è™šæ‹Ÿæœºåœ°å€ä¿¡æ¯ã€è¿˜æœ‰è´¦å·å’Œå¯†ç ã€‚</p><p>ä¿®æ”¹åï¼Œå¯åŠ¨æœåŠ¡ï¼Œè®¿é—®ï¼š<a href="http://localhost:8081/item/10001%E5%8D%B3%E5%8F%AF%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE">http://localhost:8081/item/10001å³å¯æŸ¥è¯¢æ•°æ®</a></p><h3 id="dao-ru-shang-pin-cha-xun-ye-mian" id="å¯¼å…¥å•†å“æŸ¥è¯¢é¡µé¢">å¯¼å…¥å•†å“æŸ¥è¯¢é¡µé¢</h3><p>å•†å“æŸ¥è¯¢æ˜¯è´­ç‰©é¡µé¢ï¼Œä¸å•†å“ç®¡ç†çš„é¡µé¢æ˜¯åˆ†ç¦»çš„ã€‚</p><p>éƒ¨ç½²æ–¹å¼å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/08/c3db1d7496844afcbe51dc833da0fa94" alt="image-20210816111210961"></p><p>æˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªåå‘ä»£ç†çš„nginxæœåŠ¡å™¨ï¼Œå¦‚ä¸Šå›¾çº¢æ¡†æ‰€ç¤ºï¼Œå°†é™æ€çš„å•†å“é¡µé¢æ”¾åˆ°nginxç›®å½•ä¸­ã€‚</p><p>é¡µé¢éœ€è¦çš„æ•°æ®é€šè¿‡ajaxå‘æœåŠ¡ç«¯ï¼ˆnginxä¸šåŠ¡é›†ç¾¤ï¼‰æŸ¥è¯¢ã€‚</p><h4 id="yun-xing-nginx-fu-wu" id="è¿è¡ŒnginxæœåŠ¡">è¿è¡ŒnginxæœåŠ¡</h4><p>è¿™é‡Œæˆ‘å·²ç»ç»™å¤§å®¶å‡†å¤‡å¥½äº†nginxåå‘ä»£ç†æœåŠ¡å™¨å’Œé™æ€èµ„æºã€‚</p><p>æˆ‘ä»¬æ‰¾åˆ°è¯¾å‰èµ„æ–™çš„nginxç›®å½•ï¼š</p><p>å°†å…¶æ‹·è´åˆ°ä¸€ä¸ªéä¸­æ–‡ç›®å½•ä¸‹ï¼Œè¿è¡Œè¿™ä¸ªnginxæœåŠ¡ã€‚</p><ul><li>è¿è¡Œå‘½ä»¤ï¼š</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">start</span> nginx.exe</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—® <a href="http://localhost/item.html?id=10001%E5%8D%B3%E5%8F%AF%EF%BC%9A">http://localhost/item.html?id=10001å³å¯ï¼š</a></p><h4 id="fan-xiang-dai-li" id="åå‘ä»£ç†">åå‘ä»£ç†</h4><p>ç°åœ¨ï¼Œé¡µé¢æ˜¯å‡æ•°æ®å±•ç¤ºçš„ã€‚æˆ‘ä»¬éœ€è¦å‘æœåŠ¡å™¨å‘é€ajaxè¯·æ±‚ï¼ŒæŸ¥è¯¢å•†å“æ•°æ®ã€‚</p><p>æ‰“å¼€æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°é¡µé¢æœ‰å‘èµ·ajaxæŸ¥è¯¢æ•°æ®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/08/a8e945c098db427fa35dc53d63804c4b" alt="image-20210816113816958"></p><p>è€Œè¿™ä¸ªè¯·æ±‚åœ°å€åŒæ ·æ˜¯80ç«¯å£ï¼Œæ‰€ä»¥è¢«å½“å‰çš„nginxåå‘ä»£ç†äº†ã€‚</p><p>æŸ¥çœ‹nginxçš„confç›®å½•ä¸‹çš„nginx.confæ–‡ä»¶ï¼š</p><ul><li>å…¶ä¸­çš„å…³é”®é…ç½®å¦‚ä¸‹ï¼š</li></ul><p><img src="https://s1.vika.cn/space/2023/04/08/c941595dac96443c9054d63caf62f410" alt="image-20210816114416561"></p><p>å…¶ä¸­çš„192.168.150.101æ˜¯æˆ‘çš„è™šæ‹ŸæœºIPï¼Œä¹Ÿå°±æ˜¯æˆ‘çš„Nginxä¸šåŠ¡é›†ç¾¤è¦éƒ¨ç½²çš„åœ°æ–¹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/08/10cd82678736481da843c60aac38d2b9" alt="image-20210816114554645"></p><p>å®Œæ•´å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">upstream</span> nginx-cluster&#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">47.120.32.255:8081</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> /api &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://nginx-cluster;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="chu-shi-caffeine" id="åˆè¯†Caffeine">åˆè¯†Caffeine</h2><p>ç¼“å­˜åœ¨æ—¥å¸¸å¼€å‘ä¸­å¯åŠ¨è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œç”±äºæ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ•°æ®çš„è¯»å–é€Ÿåº¦æ˜¯éå¸¸å¿«çš„ï¼Œèƒ½å¤§é‡å‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œå‡å°‘æ•°æ®åº“çš„å‹åŠ›ã€‚æˆ‘ä»¬æŠŠç¼“å­˜åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>åˆ†å¸ƒå¼ç¼“å­˜ï¼Œä¾‹å¦‚Redisï¼š<ul><li>ä¼˜ç‚¹ï¼šå­˜å‚¨å®¹é‡æ›´å¤§ã€å¯é æ€§æ›´å¥½ã€å¯ä»¥åœ¨é›†ç¾¤é—´å…±äº«</li><li>ç¼ºç‚¹ï¼šè®¿é—®ç¼“å­˜æœ‰ç½‘ç»œå¼€é”€</li><li>åœºæ™¯ï¼šç¼“å­˜æ•°æ®é‡è¾ƒå¤§ã€å¯é æ€§è¦æ±‚è¾ƒé«˜ã€éœ€è¦åœ¨é›†ç¾¤é—´å…±äº«</li></ul></li><li>è¿›ç¨‹æœ¬åœ°ç¼“å­˜ï¼Œä¾‹å¦‚HashMapã€GuavaCacheï¼š<ul><li>ä¼˜ç‚¹ï¼šè¯»å–æœ¬åœ°å†…å­˜ï¼Œæ²¡æœ‰ç½‘ç»œå¼€é”€ï¼Œé€Ÿåº¦æ›´å¿«</li><li>ç¼ºç‚¹ï¼šå­˜å‚¨å®¹é‡æœ‰é™ã€å¯é æ€§è¾ƒä½ã€æ— æ³•å…±äº«</li><li>åœºæ™¯ï¼šæ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œç¼“å­˜æ•°æ®é‡è¾ƒå°</li></ul></li></ul><p>æˆ‘ä»¬ä»Šå¤©ä¼šåˆ©ç”¨Caffeineæ¡†æ¶æ¥å®ç°JVMè¿›ç¨‹ç¼“å­˜ã€‚</p><p><strong>Caffeine</strong>æ˜¯ä¸€ä¸ªåŸºäºJava8å¼€å‘çš„ï¼Œæä¾›äº†è¿‘ä¹æœ€ä½³å‘½ä¸­ç‡çš„é«˜æ€§èƒ½çš„æœ¬åœ°ç¼“å­˜åº“ã€‚ç›®å‰Springå†…éƒ¨çš„ç¼“å­˜ä½¿ç”¨çš„å°±æ˜¯Caffeineã€‚GitHubåœ°å€ï¼š<a href="https://github.com/ben-manes/caffeine">https://github.com/ben-manes/caffeine</a></p><p>Caffeineçš„æ€§èƒ½éå¸¸å¥½ï¼Œä¸‹å›¾æ˜¯å®˜æ–¹ç»™å‡ºçš„æ€§èƒ½å¯¹æ¯”ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/09/0b00463f387548919c8958f03b363f09" alt="image-20210821081826399"></p><p>å¯ä»¥çœ‹åˆ°Caffeineçš„æ€§èƒ½é¥é¥é¢†å…ˆï¼</p><p>ç¼“å­˜ä½¿ç”¨çš„åŸºæœ¬APIï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBasicOps</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ„å»ºcacheå¯¹è±¡</span></span><br><span class="line">    Cache&lt;String, String&gt; cache = Caffeine.newBuilder().build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­˜æ•°æ®</span></span><br><span class="line">    cache.put(<span class="string">&quot;gf&quot;</span>, <span class="string">&quot;è¿ªä¸½çƒ­å·´&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å–æ•°æ®</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">gf</span> <span class="operator">=</span> cache.getIfPresent(<span class="string">&quot;gf&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;gf = &quot;</span> + gf);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å–æ•°æ®ï¼ŒåŒ…å«ä¸¤ä¸ªå‚æ•°ï¼š</span></span><br><span class="line">    <span class="comment">// å‚æ•°ä¸€ï¼šç¼“å­˜çš„key</span></span><br><span class="line">    <span class="comment">// å‚æ•°äºŒï¼šLambdaè¡¨è¾¾å¼ï¼Œè¡¨è¾¾å¼å‚æ•°å°±æ˜¯ç¼“å­˜çš„keyï¼Œæ–¹æ³•ä½“æ˜¯æŸ¥è¯¢æ•°æ®åº“çš„é€»è¾‘</span></span><br><span class="line">    <span class="comment">// ä¼˜å…ˆæ ¹æ®keyæŸ¥è¯¢JVMç¼“å­˜ï¼Œå¦‚æœæœªå‘½ä¸­ï¼Œåˆ™æ‰§è¡Œå‚æ•°äºŒçš„Lambdaè¡¨è¾¾å¼</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">defaultGF</span> <span class="operator">=</span> cache.get(<span class="string">&quot;defaultGF&quot;</span>, key -&gt; &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®keyå»æ•°æ®åº“æŸ¥è¯¢æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æŸ³å²©&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(<span class="string">&quot;defaultGF = &quot;</span> + defaultGF);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Caffeineæ—¢ç„¶æ˜¯ç¼“å­˜çš„ä¸€ç§ï¼Œè‚¯å®šéœ€è¦æœ‰ç¼“å­˜çš„æ¸…é™¤ç­–ç•¥ï¼Œä¸ç„¶çš„è¯å†…å­˜æ€»ä¼šæœ‰è€—å°½çš„æ—¶å€™ã€‚</p><p>Caffeineæä¾›äº†ä¸‰ç§ç¼“å­˜é©±é€ç­–ç•¥ï¼š</p><ul><li><p><strong>åŸºäºå®¹é‡</strong>ï¼šè®¾ç½®ç¼“å­˜çš„æ•°é‡ä¸Šé™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºç¼“å­˜å¯¹è±¡</span></span><br><span class="line">Cache&lt;String, String&gt; cache = Caffeine.newBuilder()</span><br><span class="line">    .maximumSize(<span class="number">1</span>) <span class="comment">// è®¾ç½®ç¼“å­˜å¤§å°ä¸Šé™ä¸º 1</span></span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure></li><li><p><strong>åŸºäºæ—¶é—´</strong>ï¼šè®¾ç½®ç¼“å­˜çš„æœ‰æ•ˆæ—¶é—´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºç¼“å­˜å¯¹è±¡</span></span><br><span class="line">Cache&lt;String, String&gt; cache = Caffeine.newBuilder()</span><br><span class="line">    <span class="comment">// è®¾ç½®ç¼“å­˜æœ‰æ•ˆæœŸä¸º 10 ç§’ï¼Œä»æœ€åä¸€æ¬¡å†™å…¥å¼€å§‹è®¡æ—¶ </span></span><br><span class="line">    .expireAfterWrite(Duration.ofSeconds(<span class="number">10</span>)) </span><br><span class="line">    .build();</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><strong>åŸºäºå¼•ç”¨</strong>ï¼šè®¾ç½®ç¼“å­˜ä¸ºè½¯å¼•ç”¨æˆ–å¼±å¼•ç”¨ï¼Œåˆ©ç”¨GCæ¥å›æ”¶ç¼“å­˜æ•°æ®ã€‚æ€§èƒ½è¾ƒå·®ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</p></li></ul><blockquote><p><strong>æ³¨æ„</strong>ï¼šåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç¼“å­˜å…ƒç´ è¿‡æœŸçš„æ—¶å€™ï¼ŒCaffeineä¸ä¼šè‡ªåŠ¨ç«‹å³å°†å…¶æ¸…ç†å’Œé©±é€ã€‚è€Œæ˜¯åœ¨ä¸€æ¬¡è¯»æˆ–å†™æ“ä½œåï¼Œæˆ–è€…åœ¨ç©ºé—²æ—¶é—´å®Œæˆå¯¹å¤±æ•ˆæ•°æ®çš„é©±é€ã€‚</p></blockquote><h2 id="shi-xian-jvm-jin-cheng-huan-cun" id="å®ç°JVMè¿›ç¨‹ç¼“å­˜">å®ç°JVMè¿›ç¨‹ç¼“å­˜</h2><h3 id="xu-qiu" id="éœ€æ±‚">éœ€æ±‚</h3><blockquote><p>åˆ©ç”¨Caffeineå®ç°ä¸‹åˆ—éœ€æ±‚ï¼š</p><ul><li>ç»™æ ¹æ®idæŸ¥è¯¢å•†å“çš„ä¸šåŠ¡æ·»åŠ ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“</li><li>ç»™æ ¹æ®idæŸ¥è¯¢å•†å“åº“å­˜çš„ä¸šåŠ¡æ·»åŠ ç¼“å­˜ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥è¯¢æ•°æ®åº“</li><li>ç¼“å­˜åˆå§‹å¤§å°ä¸º100</li><li>ç¼“å­˜ä¸Šé™ä¸º10000</li></ul></blockquote><h3 id="shi-xian" id="å®ç°">å®ç°</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸¤ä¸ªCaffeineçš„ç¼“å­˜å¯¹è±¡ï¼Œåˆ†åˆ«ä¿å­˜å•†å“ã€åº“å­˜çš„ç¼“å­˜æ•°æ®ã€‚</p><p>åœ¨item-serviceçš„<code>com.heima.item.config</code>åŒ…ä¸‹å®šä¹‰<code>CaffeineConfig</code>ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CaffeineConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Cache&lt;Long, Item&gt; <span class="title function_">itemCache</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Caffeine.newBuilder()</span><br><span class="line">                .initialCapacity(<span class="number">100</span>)</span><br><span class="line">                .maximumSize(<span class="number">10_000</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Cache&lt;Long, ItemStock&gt; <span class="title function_">stockCache</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Caffeine.newBuilder()</span><br><span class="line">                .initialCapacity(<span class="number">100</span>)</span><br><span class="line">                .maximumSize(<span class="number">10_000</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œä¿®æ”¹item-serviceä¸­çš„<code>com.heima.item.web</code>åŒ…ä¸‹çš„ItemControllerç±»ï¼Œæ·»åŠ ç¼“å­˜é€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;item&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IItemService itemService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IItemStockService stockService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Cache&lt;Long, Item&gt; itemCache;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Cache&lt;Long, ItemStock&gt; stockCache;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...å…¶å®ƒç•¥</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Item <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> itemCache.get(id, key -&gt; itemService.query()</span><br><span class="line">                .ne(<span class="string">&quot;status&quot;</span>, <span class="number">3</span>).eq(<span class="string">&quot;id&quot;</span>, key)</span><br><span class="line">                .one()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/stock/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ItemStock <span class="title function_">findStockById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stockCache.get(id, key -&gt; stockService.getById(key));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="lua-yu-fa-ru-men">Luaè¯­æ³•å…¥é—¨</h1><p>Nginxç¼–ç¨‹éœ€è¦ç”¨åˆ°Luaè¯­è¨€ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»å…ˆå…¥é—¨Luaçš„åŸºæœ¬è¯­æ³•ã€‚</p><h2 id="chu-shi-lua" id="åˆè¯†Lua">åˆè¯†Lua</h2><p>Lua æ˜¯ä¸€ç§è½»é‡å°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€æ”¾ï¼Œ å…¶è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚å®˜ç½‘ï¼š<a href="https://www.lua.org/">https://www.lua.org/</a></p><p><img src="https://s1.vika.cn/space/2023/04/09/4b28ccc0be7f4ce59275b033a8ed4247" alt="image-20210821091437975"></p><p>Luaç»å¸¸åµŒå…¥åˆ°Cè¯­è¨€å¼€å‘çš„ç¨‹åºä¸­ï¼Œä¾‹å¦‚æ¸¸æˆå¼€å‘ã€æ¸¸æˆæ’ä»¶ç­‰ã€‚</p><p>Nginxæœ¬èº«ä¹Ÿæ˜¯Cè¯­è¨€å¼€å‘ï¼Œå› æ­¤ä¹Ÿå…è®¸åŸºäºLuaåšæ‹“å±•ã€‚</p><h2 id="hello-world" id="HelloWorld">HelloWorld</h2><p>CentOS7é»˜è®¤å·²ç»å®‰è£…äº†Luaè¯­è¨€ç¯å¢ƒï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¿è¡ŒLuaä»£ç ã€‚</p><ol><li>åœ¨Linuxè™šæ‹Ÿæœºçš„ä»»æ„ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªhello.luaæ–‡ä»¶</li></ol><p><img src="https://s1.vika.cn/space/2023/04/09/c49c4bd540424afcaa1cae4cda2ca55a" alt="image-20210821091621308"></p><ol start="2"><li>æ·»åŠ ä¸‹é¢çš„å†…å®¹</li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hello World!&quot;</span>)  </span><br></pre></td></tr></table></figure><ol start="3"><li>è¿è¡Œ</li></ol><p><img src="https://s1.vika.cn/space/2023/04/09/8dc508f2e7ca4b06bc7e58f24644b7f5" alt="image-20210821091638140"></p><h2 id="bian-liang-he-xun-huan" id="å˜é‡å’Œå¾ªç¯">å˜é‡å’Œå¾ªç¯</h2><p>å­¦ä¹ ä»»ä½•è¯­è¨€å¿…ç„¶ç¦»ä¸å¼€å˜é‡ï¼Œè€Œå˜é‡çš„å£°æ˜å¿…é¡»å…ˆçŸ¥é“æ•°æ®çš„ç±»å‹ã€‚</p><h3 id="lua-de-shu-ju-lei-xing" id="Luaçš„æ•°æ®ç±»å‹">Luaçš„æ•°æ®ç±»å‹</h3><p>Luaä¸­æ”¯æŒçš„å¸¸è§æ•°æ®ç±»å‹åŒ…æ‹¬ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/09/71c7ddf7cdbe4e5799c501cbf24ec7d4" alt="image-20210821091835406"></p><p>å¦å¤–ï¼ŒLuaæä¾›äº†type()å‡½æ•°æ¥åˆ¤æ–­ä¸€ä¸ªå˜é‡çš„æ•°æ®ç±»å‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/09/97621c7fcee7477e83bda7d612d5c760" alt="image-20210821091904332"></p><h3 id="sheng-ming-bian-liang" id="å£°æ˜å˜é‡">å£°æ˜å˜é‡</h3><ul><li>Luaå£°æ˜å˜é‡çš„æ—¶å€™æ— éœ€æŒ‡å®šæ•°æ®ç±»å‹ï¼Œè€Œæ˜¯ç”¨localæ¥å£°æ˜å˜é‡ä¸ºå±€éƒ¨å˜é‡ï¼š</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å£°æ˜å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨å•å¼•å·æˆ–åŒå¼•å·ï¼Œ</span></span><br><span class="line"><span class="keyword">local</span> str = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="comment">-- å­—ç¬¦ä¸²æ‹¼æ¥å¯ä»¥ä½¿ç”¨ ..</span></span><br><span class="line"><span class="keyword">local</span> str2 = <span class="string">&#x27;hello&#x27;</span> .. <span class="string">&#x27;world&#x27;</span></span><br><span class="line"><span class="comment">-- å£°æ˜æ•°å­—</span></span><br><span class="line"><span class="keyword">local</span> num = <span class="number">21</span></span><br><span class="line"><span class="comment">-- å£°æ˜å¸ƒå°”ç±»å‹</span></span><br><span class="line"><span class="keyword">local</span> flag = <span class="literal">true</span></span><br></pre></td></tr></table></figure><ul><li>Luaä¸­çš„tableç±»å‹æ—¢å¯ä»¥ä½œä¸ºæ•°ç»„ï¼Œåˆå¯ä»¥ä½œä¸ºJavaä¸­çš„mapæ¥ä½¿ç”¨ã€‚æ•°ç»„å°±æ˜¯ç‰¹æ®Šçš„tableï¼Œkeyæ˜¯æ•°ç»„è§’æ ‡è€Œå·²ï¼š</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å£°æ˜æ•°ç»„ ï¼Œkeyä¸ºè§’æ ‡çš„ table</span></span><br><span class="line"><span class="keyword">local</span> arr = &#123;<span class="string">&#x27;java&#x27;</span>, <span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;lua&#x27;</span>&#125;</span><br><span class="line"><span class="comment">-- å£°æ˜tableï¼Œç±»ä¼¼javaçš„map</span></span><br><span class="line"><span class="keyword">local</span> map =  &#123;name=<span class="string">&#x27;Jack&#x27;</span>, age=<span class="number">21</span>&#125;</span><br></pre></td></tr></table></figure><ul><li>Luaä¸­çš„æ•°ç»„è§’æ ‡æ˜¯ä»1å¼€å§‹ï¼Œè®¿é—®çš„æ—¶å€™ä¸Javaä¸­ç±»ä¼¼ï¼š</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è®¿é—®æ•°ç»„ï¼Œluaæ•°ç»„çš„è§’æ ‡ä»1å¼€å§‹</span></span><br><span class="line"><span class="built_in">print</span>(arr[<span class="number">1</span>])</span><br></pre></td></tr></table></figure><ul><li>Luaä¸­çš„tableå¯ä»¥ç”¨keyæ¥è®¿é—®ï¼š</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è®¿é—®table</span></span><br><span class="line"><span class="built_in">print</span>(map[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(map.name)</span><br></pre></td></tr></table></figure><h3 id="xun-huan" id="å¾ªç¯">å¾ªç¯</h3><p>å¯¹äºtableï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨forå¾ªç¯æ¥éå†ã€‚ä¸è¿‡æ•°ç»„å’Œæ™®é€štableéå†ç•¥æœ‰å·®å¼‚ã€‚</p><ul><li>éå†æ•°ç»„ï¼š</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å£°æ˜æ•°ç»„ keyä¸ºç´¢å¼•çš„ table</span></span><br><span class="line"><span class="keyword">local</span> arr = &#123;<span class="string">&#x27;java&#x27;</span>, <span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;lua&#x27;</span>&#125;</span><br><span class="line"><span class="comment">-- éå†æ•°ç»„</span></span><br><span class="line"><span class="keyword">for</span> index,value <span class="keyword">in</span> <span class="built_in">ipairs</span>(arr) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(index, value) </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li>éå†æ™®é€štable</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å£°æ˜mapï¼Œä¹Ÿå°±æ˜¯table</span></span><br><span class="line"><span class="keyword">local</span> map = &#123;name=<span class="string">&#x27;Jack&#x27;</span>, age=<span class="number">21</span>&#125;</span><br><span class="line"><span class="comment">-- éå†table</span></span><br><span class="line"><span class="keyword">for</span> key,value <span class="keyword">in</span> <span class="built_in">pairs</span>(map) <span class="keyword">do</span></span><br><span class="line">   <span class="built_in">print</span>(key, value) </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h2 id="tiao-jian-kong-zhi-han-shu" id="æ¡ä»¶æ§åˆ¶ã€å‡½æ•°">æ¡ä»¶æ§åˆ¶ã€å‡½æ•°</h2><p>Luaä¸­çš„æ¡ä»¶æ§åˆ¶å’Œå‡½æ•°å£°æ˜ä¸Javaç±»ä¼¼ã€‚</p><h3 id="han-shu" id="å‡½æ•°">å‡½æ•°</h3><ul><li>å®šä¹‰å‡½æ•°çš„è¯­æ³•ï¼š</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> å‡½æ•°å<span class="params">( argument1, argument2..., argumentn)</span></span></span><br><span class="line">    <span class="comment">-- å‡½æ•°ä½“</span></span><br><span class="line">    <span class="keyword">return</span> è¿”å›å€¼</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li>ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æ‰“å°æ•°ç»„ï¼š</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printArr</span><span class="params">(arr)</span></span></span><br><span class="line">    <span class="keyword">for</span> index, value <span class="keyword">in</span> <span class="built_in">ipairs</span>(arr) <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">print</span>(value)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="tiao-jian-kong-zhi" id="æ¡ä»¶æ§åˆ¶">æ¡ä»¶æ§åˆ¶</h3><p>ç±»ä¼¼Javaçš„æ¡ä»¶æ§åˆ¶ï¼Œä¾‹å¦‚ifã€elseè¯­æ³•ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(å¸ƒå°”è¡¨è¾¾å¼)</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="comment">--[ å¸ƒå°”è¡¨è¾¾å¼ä¸º true æ—¶æ‰§è¡Œè¯¥è¯­å¥å— --]</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="comment">--[ å¸ƒå°”è¡¨è¾¾å¼ä¸º false æ—¶æ‰§è¡Œè¯¥è¯­å¥å— --]</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ä¸javaä¸åŒï¼Œå¸ƒå°”è¡¨è¾¾å¼ä¸­çš„é€»è¾‘è¿ç®—æ˜¯åŸºäºè‹±æ–‡å•è¯ï¼š</li></ul><p><img src="https://s1.vika.cn/space/2023/04/09/be9a081941374e55a27a8188def265e0" alt="image-20210821092657918"></p><h3 id="an-li" id="æ¡ˆä¾‹">æ¡ˆä¾‹</h3><blockquote><p>éœ€æ±‚ï¼šè‡ªå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥æ‰“å°tableï¼Œå½“å‚æ•°ä¸ºnilæ—¶ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯</p></blockquote><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printArr</span><span class="params">(arr)</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> arr <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;æ•°ç»„ä¸èƒ½ä¸ºç©ºï¼&#x27;</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">for</span> index, value <span class="keyword">in</span> <span class="built_in">ipairs</span>(arr) <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">print</span>(value)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h1 id="shi-xian-duo-ji-huan-cun">å®ç°å¤šçº§ç¼“å­˜</h1><p>å¤šçº§ç¼“å­˜çš„å®ç°ç¦»ä¸å¼€Nginxç¼–ç¨‹ï¼Œè€ŒNginxç¼–ç¨‹åˆç¦»ä¸å¼€OpenRestyã€‚</p><h2 id="an-zhuang-open-resty" id="å®‰è£…OpenResty">å®‰è£…OpenResty</h2><p>OpenRestyÂ® æ˜¯ä¸€ä¸ªåŸºäº Nginxçš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚å…·å¤‡ä¸‹åˆ—ç‰¹ç‚¹ï¼š</p><ul><li>å…·å¤‡Nginxçš„å®Œæ•´åŠŸèƒ½</li><li>åŸºäºLuaè¯­è¨€è¿›è¡Œæ‰©å±•ï¼Œé›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—</li><li>å…è®¸ä½¿ç”¨Lua<strong>è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘</strong>ã€<strong>è‡ªå®šä¹‰åº“</strong></li></ul><p>å®˜æ–¹ç½‘ç«™ï¼š <a href="https://openresty.org/cn/">https://openresty.org/cn/</a></p><p><img src="https://s1.vika.cn/space/2023/04/09/383101f8b9e740868abaab6bf911b838" alt="image-20210821092902946"></p><p>é¦–å…ˆä½ çš„Linuxè™šæ‹Ÿæœºå¿…é¡»è”ç½‘</p><h3 id="an-zhuang-open-resty-1" id="å®‰è£…OpenResty-2">å®‰è£…OpenResty</h3><ol><li><strong>å®‰è£…å¼€å‘åº“</strong></li></ol><p>é¦–å…ˆè¦å®‰è£…OpenRestyçš„ä¾èµ–å¼€å‘åº“ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y pcre-devel openssl-devel gcc --skip-broken</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>å®‰è£…OpenRestyä»“åº“</strong></li></ol><p>ä½ å¯ä»¥åœ¨ä½ çš„ CentOS ç³»ç»Ÿä¸­æ·»åŠ  <code>openresty</code> ä»“åº“ï¼Œè¿™æ ·å°±å¯ä»¥ä¾¿äºæœªæ¥å®‰è£…æˆ–æ›´æ–°æˆ‘ä»¬çš„è½¯ä»¶åŒ…ï¼ˆé€šè¿‡ <code>yum check-update</code> å‘½ä»¤ï¼‰ã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥æ·»åŠ æˆ‘ä»¬çš„ä»“åº“ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo https://openresty.org/package/centos/openresty.repo</span><br></pre></td></tr></table></figure><p>å¦‚æœæç¤ºè¯´å‘½ä»¤ä¸å­˜åœ¨ï¼Œåˆ™è¿è¡Œï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> -y yum-utils </span><br></pre></td></tr></table></figure><p>ç„¶åå†é‡å¤ä¸Šé¢çš„å‘½ä»¤</p><ol start="3"><li><strong>å®‰è£…OpenResty</strong></li></ol><p>ç„¶åå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·å®‰è£…è½¯ä»¶åŒ…ï¼Œæ¯”å¦‚ <code>openresty</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openresty</span><br></pre></td></tr></table></figure><ol start="4"><li><strong>å®‰è£…opmå·¥å…·</strong></li></ol><p>opmæ˜¯OpenRestyçš„ä¸€ä¸ªç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®‰è£…ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„Luaæ¨¡å—ã€‚</p><p>å¦‚æœä½ æƒ³å®‰è£…å‘½ä»¤è¡Œå·¥å…· <code>opm</code>ï¼Œé‚£ä¹ˆå¯ä»¥åƒä¸‹é¢è¿™æ ·å®‰è£… <code>openresty-opm</code> åŒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openresty-opm</span><br></pre></td></tr></table></figure><ol start="5"><li><strong>ç›®å½•ç»“æ„</strong></li></ol><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenRestyå®‰è£…çš„ç›®å½•æ˜¯ï¼š/usr/local/openresty</p><ul><li>çœ‹åˆ°é‡Œé¢çš„nginxç›®å½•äº†å—ï¼ŒOpenRestyå°±æ˜¯åœ¨NginxåŸºç¡€ä¸Šé›†æˆäº†ä¸€äº›Luaæ¨¡å—ã€‚</li></ul><ol start="6"><li><strong>é…ç½®nginxçš„ç¯å¢ƒå˜é‡</strong></li></ol><p>æ‰“å¼€é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br></pre></td></tr></table></figure><p>åœ¨æœ€ä¸‹é¢åŠ å…¥ä¸¤è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> NGINX_HOME=/usr/local/openresty/nginx</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;NGINX_HOME&#125;</span>/sbin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><p>NGINX_HOMEï¼šåé¢æ˜¯OpenRestyå®‰è£…ç›®å½•ä¸‹çš„nginxçš„ç›®å½•</p><p>ç„¶åè®©é…ç½®ç”Ÿæ•ˆï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">source</span> <span class="regexp">/etc/</span>profile</span><br></pre></td></tr></table></figure><h3 id="qi-dong-he-yun-xing" id="å¯åŠ¨å’Œè¿è¡Œ">å¯åŠ¨å’Œè¿è¡Œ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=8081/tcp --permanent</span><br></pre></td></tr></table></figure><p>OpenRestyåº•å±‚æ˜¯åŸºäºNginxçš„ï¼ŒæŸ¥çœ‹OpenRestyç›®å½•çš„nginxç›®å½•ï¼Œç»“æ„ä¸windowsä¸­å®‰è£…çš„nginxåŸºæœ¬ä¸€è‡´ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/09/c46da29bb345487e99ec091869250971" alt="image-20210811100653291"></p><p>æ‰€ä»¥è¿è¡Œæ–¹å¼ä¸nginxåŸºæœ¬ä¸€è‡´ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨nginx</span></span><br><span class="line">nginx</span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½é…ç½®</span></span><br><span class="line">nginx -s reload</span><br><span class="line"><span class="comment"># åœæ­¢</span></span><br><span class="line">nginx -s stop</span><br></pre></td></tr></table></figure><p>nginxçš„é»˜è®¤é…ç½®æ–‡ä»¶æ³¨é‡Šå¤ªå¤šï¼Œå½±å“åç»­æˆ‘ä»¬çš„ç¼–è¾‘ï¼Œè¿™é‡Œå°†nginx.confä¸­çš„æ³¨é‡Šéƒ¨åˆ†åˆ é™¤ï¼Œä¿ç•™æœ‰æ•ˆéƒ¨åˆ†ã€‚</p><p>ä¿®æ”¹<code>/usr/local/openresty/nginx/conf/nginx.conf</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"><span class="attribute">error_log</span>  logs/<span class="literal">error</span>.log;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">8081</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨Linuxçš„æ§åˆ¶å°è¾“å…¥å‘½ä»¤ä»¥å¯åŠ¨nginxï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®é¡µé¢ï¼š<a href="http://192.168.150.101:8081">http://192.168.150.101:8081</a>ï¼Œæ³¨æ„ipåœ°å€æ›¿æ¢ä¸ºä½ è‡ªå·±çš„è™šæ‹ŸæœºIPï¼š</p><h3 id="bei-zhu" id="å¤‡æ³¨">å¤‡æ³¨</h3><p>åŠ è½½OpenRestyçš„luaæ¨¡å—ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#lua æ¨¡å—</span></span><br><span class="line"><span class="attribute">lua_package_path</span> <span class="string">&quot;/usr/local/openresty/lualib/?.lua;;&quot;</span>;</span><br><span class="line"><span class="comment">#cæ¨¡å—     </span></span><br><span class="line"><span class="attribute">lua_package_cpath</span> <span class="string">&quot;/usr/local/openresty/lualib/?.so;;&quot;</span>;  </span><br></pre></td></tr></table></figure><p>common.lua</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å°è£…å‡½æ•°ï¼Œå‘é€httpè¯·æ±‚ï¼Œå¹¶è§£æå“åº”</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">read_http</span><span class="params">(path, params)</span></span></span><br><span class="line">    <span class="keyword">local</span> resp = ngx.location.capture(<span class="built_in">path</span>,&#123;</span><br><span class="line">        method = ngx.HTTP_GET,</span><br><span class="line">        args = params,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> resp <span class="keyword">then</span></span><br><span class="line">        <span class="comment">-- è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œè¿”å›404</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;http not found, path: &quot;</span>, <span class="built_in">path</span> , <span class="string">&quot;, args: &quot;</span>, args)</span><br><span class="line">        ngx.<span class="built_in">exit</span>(<span class="number">404</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> resp.body</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- å°†æ–¹æ³•å¯¼å‡º</span></span><br><span class="line"><span class="keyword">local</span> _M = &#123;  </span><br><span class="line">    read_http = read_http</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">return</span> _M</span><br></pre></td></tr></table></figure><p>é‡Šæ”¾Redisè¿æ¥APIï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å…³é—­redisè¿æ¥çš„å·¥å…·æ–¹æ³•ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">close_redis</span><span class="params">(red)</span></span></span><br><span class="line">    <span class="keyword">local</span> pool_max_idle_time = <span class="number">10000</span> <span class="comment">-- è¿æ¥çš„ç©ºé—²æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span></span><br><span class="line">    <span class="keyword">local</span> pool_size = <span class="number">100</span> <span class="comment">--è¿æ¥æ± å¤§å°</span></span><br><span class="line">    <span class="keyword">local</span> ok, err = red:set_keepalive(pool_max_idle_time, pool_size)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;æ”¾å…¥redisè¿æ¥æ± å¤±è´¥: &quot;</span>, err)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>è¯»å–Redisæ•°æ®çš„APIï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢redisçš„æ–¹æ³• ipå’Œportæ˜¯redisåœ°å€ï¼Œkeyæ˜¯æŸ¥è¯¢çš„key</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">read_redis</span><span class="params">(ip, port, key)</span></span></span><br><span class="line">    <span class="comment">-- è·å–ä¸€ä¸ªè¿æ¥</span></span><br><span class="line">    <span class="keyword">local</span> ok, err = red:connect(ip, port)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;è¿æ¥rediså¤±è´¥ : &quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- æŸ¥è¯¢redis</span></span><br><span class="line">    <span class="keyword">local</span> resp, err = red:get(key)</span><br><span class="line">    <span class="comment">-- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> resp <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;æŸ¥è¯¢Rediså¤±è´¥: &quot;</span>, err, <span class="string">&quot;, key = &quot;</span> , key)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">--å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> resp == ngx.null <span class="keyword">then</span></span><br><span class="line">        resp = <span class="literal">nil</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;æŸ¥è¯¢Redisæ•°æ®ä¸ºç©º, key = &quot;</span>, key)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    close_redis(red)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>å¼€å¯å…±äº«è¯å…¸ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…±äº«å­—å…¸ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œåç§°å«åšï¼šitem_cacheï¼Œå¤§å°150m</span></span><br><span class="line"><span class="attribute">lua_shared_dict</span> item_cache <span class="number">150m</span>;Â </span><br></pre></td></tr></table></figure><h2 id="open-resty-kuai-su-ru-men" id="OpenRestyå¿«é€Ÿå…¥é—¨">OpenRestyå¿«é€Ÿå…¥é—¨</h2><p>æˆ‘ä»¬å¸Œæœ›è¾¾åˆ°çš„å¤šçº§ç¼“å­˜æ¶æ„å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/09/bd89bea7c6d140918290ba5b6535a5ca" alt="yeVDlwtfMx"></p><p>å…¶ä¸­ï¼š</p><ul><li><p>windowsä¸Šçš„nginxç”¨æ¥åšåå‘ä»£ç†æœåŠ¡ï¼Œå°†å‰ç«¯çš„æŸ¥è¯¢å•†å“çš„ajaxè¯·æ±‚ä»£ç†åˆ°OpenRestyé›†ç¾¤</p></li><li><p>OpenRestyé›†ç¾¤ç”¨æ¥ç¼–å†™å¤šçº§ç¼“å­˜ä¸šåŠ¡</p></li></ul><h3 id="fan-xiang-dai-li-liu-cheng" id="åå‘ä»£ç†æµç¨‹">åå‘ä»£ç†æµç¨‹</h3><p>ç°åœ¨ï¼Œå•†å“è¯¦æƒ…é¡µä½¿ç”¨çš„æ˜¯å‡çš„å•†å“æ•°æ®ã€‚ä¸è¿‡åœ¨æµè§ˆå™¨ä¸­ï¼Œå¯ä»¥çœ‹åˆ°é¡µé¢æœ‰å‘èµ·ajaxè¯·æ±‚æŸ¥è¯¢çœŸå®å•†å“æ•°æ®ã€‚</p><p>è¿™ä¸ªè¯·æ±‚å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/09/694c6667c93940a69c64967c1979db75" alt="image-20210821093144700"></p><p>è¯·æ±‚åœ°å€æ˜¯localhostï¼Œç«¯å£æ˜¯80ï¼Œå°±è¢«windowsä¸Šå®‰è£…çš„NginxæœåŠ¡ç»™æ¥æ”¶åˆ°äº†ã€‚ç„¶åä»£ç†ç»™äº†OpenRestyé›†ç¾¤ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/09/e845700cd8f147a49237e305f83a071a" alt="image-20210821094447709"></p><p>æˆ‘ä»¬éœ€è¦åœ¨OpenRestyä¸­ç¼–å†™ä¸šåŠ¡ï¼ŒæŸ¥è¯¢å•†å“æ•°æ®å¹¶è¿”å›åˆ°æµè§ˆå™¨ã€‚</p><p>ä½†æ˜¯è¿™æ¬¡ï¼Œæˆ‘ä»¬å…ˆåœ¨OpenRestyæ¥æ”¶è¯·æ±‚ï¼Œè¿”å›å‡çš„å•†å“æ•°æ®ã€‚</p><h3 id="open-resty-jian-ting-qing-qiu" id="OpenRestyç›‘å¬è¯·æ±‚">OpenRestyç›‘å¬è¯·æ±‚</h3><p>OpenRestyçš„å¾ˆå¤šåŠŸèƒ½éƒ½ä¾èµ–äºå…¶ç›®å½•ä¸‹çš„Luaåº“ï¼Œéœ€è¦åœ¨nginx.confä¸­æŒ‡å®šä¾èµ–åº“çš„ç›®å½•ï¼Œå¹¶å¯¼å…¥ä¾èµ–ï¼š</p><ol><li>æ·»åŠ å¯¹OpenRestyçš„Luaæ¨¡å—çš„åŠ è½½</li></ol><p>ä¿®æ”¹<code>/usr/local/openresty/nginx/conf/nginx.conf</code>æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­çš„httpä¸‹é¢ï¼Œæ·»åŠ ä¸‹é¢ä»£ç ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#lua æ¨¡å—</span></span><br><span class="line"><span class="attribute">lua_package_path</span> <span class="string">&quot;/usr/local/openresty/lualib/?.lua;;&quot;</span>;</span><br><span class="line"><span class="comment">#cæ¨¡å—     </span></span><br><span class="line"><span class="attribute">lua_package_cpath</span> <span class="string">&quot;/usr/local/openresty/lualib/?.so;;&quot;</span>;  </span><br></pre></td></tr></table></figure><ol start="2"><li>ç›‘å¬/api/itemè·¯å¾„</li></ol><p>ä¿®æ”¹<code>/usr/local/openresty/nginx/conf/nginx.conf</code>æ–‡ä»¶ï¼Œåœ¨nginx.confçš„serverä¸‹é¢ï¼Œæ·»åŠ å¯¹/api/itemè¿™ä¸ªè·¯å¾„çš„ç›‘å¬ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span>  /api/item &#123;</span><br><span class="line">    <span class="comment"># é»˜è®¤çš„å“åº”ç±»å‹</span></span><br><span class="line">    <span class="attribute">default_type</span> application/json;</span><br><span class="line">    <span class="comment"># å“åº”ç»“æœç”±lua/item.luaæ–‡ä»¶æ¥å†³å®š</span></span><br><span class="line">    <span class="attribute">content_by_lua_file</span> lua/item.lua;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç›‘å¬ï¼Œå°±ç±»ä¼¼äºSpringMVCä¸­çš„<code>@GetMapping(&quot;/api/item&quot;)</code>åšè·¯å¾„æ˜ å°„ã€‚</p><p>è€Œ<code>content_by_lua_file lua/item.lua</code>åˆ™ç›¸å½“äºè°ƒç”¨item.luaè¿™ä¸ªæ–‡ä»¶ï¼Œæ‰§è¡Œå…¶ä¸­çš„ä¸šåŠ¡ï¼ŒæŠŠç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚ç›¸å½“äºjavaä¸­è°ƒç”¨serviceã€‚</p><h3 id="bian-xie-item-lua" id="ç¼–å†™item-lua">ç¼–å†™item.lua</h3><ol><li>åœ¨<code>/usr/loca/openresty/nginx</code>ç›®å½•åˆ›å»ºæ–‡ä»¶å¤¹ï¼šlua</li></ol><p><img src="https://s1.vika.cn/space/2023/04/09/b187bb2fa7304335b430d1a98e5fef3e" alt="image-20210821100755080"></p><ol start="2"><li>åœ¨<code>/usr/loca/openresty/nginx/lua</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºæ–‡ä»¶ï¼šitem.lua</li></ol><p><img src="https://s1.vika.cn/space/2023/04/09/a54c429ab5ac488e8769c1deac83108d" alt="image-20210821100801756"></p><ol start="3"><li>ç¼–å†™item.luaï¼Œè¿”å›å‡æ•°æ®</li></ol><p>item.luaä¸­ï¼Œåˆ©ç”¨ngx.say()å‡½æ•°è¿”å›æ•°æ®åˆ°Responseä¸­</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ngx.say(<span class="string">&#x27;&#123;&quot;id&quot;:10001,&quot;name&quot;:&quot;SALSA AIR&quot;,&quot;title&quot;:&quot;RIMOWA 21å¯¸æ‰˜è¿ç®±æ‹‰æ†ç®± SALSA AIRç³»åˆ—æœç»¿è‰² 820.70.36.4&quot;,&quot;price&quot;:17900,&quot;image&quot;:&quot;https://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webp&quot;,&quot;category&quot;:&quot;æ‹‰æ†ç®±&quot;,&quot;brand&quot;:&quot;RIMOWA&quot;,&quot;spec&quot;:&quot;&quot;,&quot;status&quot;:1,&quot;createTime&quot;:&quot;2019-04-30T16:00:00.000+00:00&quot;,&quot;updateTime&quot;:&quot;2019-04-30T16:00:00.000+00:00&quot;,&quot;stock&quot;:2999,&quot;sold&quot;:31290&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="4"><li>é‡æ–°åŠ è½½é…ç½®</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><p>åˆ·æ–°å•†å“é¡µé¢ï¼š<a href="http://localhost/item.html?id=1001%EF%BC%8C%E5%8D%B3%E5%8F%AF%E7%9C%8B%E5%88%B0%E6%95%88%E6%9E%9C%EF%BC%9A">http://localhost/item.html?id=1001ï¼Œå³å¯çœ‹åˆ°æ•ˆæœï¼š</a></p><p><img src="https://s1.vika.cn/space/2023/04/09/b9474385013743c69910fe163dc2dd19" alt="image-20210821101217089"></p><h2 id="qing-qiu-can-shu-chu-li" id="è¯·æ±‚å‚æ•°å¤„ç†">è¯·æ±‚å‚æ•°å¤„ç†</h2><p>ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬åœ¨OpenRestyæ¥æ”¶å‰ç«¯è¯·æ±‚ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯å‡æ•°æ®ã€‚</p><p>è¦è¿”å›çœŸå®æ•°æ®ï¼Œå¿…é¡»æ ¹æ®å‰ç«¯ä¼ é€’æ¥çš„å•†å“idï¼ŒæŸ¥è¯¢å•†å“ä¿¡æ¯æ‰å¯ä»¥ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•è·å–å‰ç«¯ä¼ é€’çš„å•†å“å‚æ•°å‘¢ï¼Ÿ</p><h3 id="huo-qu-can-shu-de-api" id="è·å–å‚æ•°çš„API">è·å–å‚æ•°çš„API</h3><p>OpenRestyä¸­æä¾›äº†ä¸€äº›APIç”¨æ¥è·å–ä¸åŒç±»å‹çš„å‰ç«¯è¯·æ±‚å‚æ•°ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/09/a31b2fd0e36a41ffb91101e719af134b" alt="image-20210821101433528"></p><h3 id="huo-qu-can-shu-bing-fan-hui" id="è·å–å‚æ•°å¹¶è¿”å›">è·å–å‚æ•°å¹¶è¿”å›</h3><p>åœ¨å‰ç«¯å‘èµ·çš„ajaxè¯·æ±‚å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/09/90d15bd1766d40a9a418302514c77204" alt="image-20210821101721649"></p><p>å¯ä»¥çœ‹åˆ°å•†å“idæ˜¯ä»¥è·¯å¾„å ä½ç¬¦æ–¹å¼ä¼ é€’çš„ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ–¹å¼æ¥è·å–ID</p><ol><li>è·å–å•†å“id</li></ol><p>ä¿®æ”¹<code>/usr/loca/openresty/nginx/nginx.conf</code>æ–‡ä»¶ä¸­ç›‘å¬/api/itemçš„ä»£ç ï¼Œåˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼è·å–IDï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~ /api/item/(\d+)</span> &#123;</span><br><span class="line">    <span class="comment"># é»˜è®¤çš„å“åº”ç±»å‹</span></span><br><span class="line">    <span class="attribute">default_type</span> application/json;</span><br><span class="line">    <span class="comment"># å“åº”ç»“æœç”±lua/item.luaæ–‡ä»¶æ¥å†³å®š</span></span><br><span class="line">    <span class="attribute">content_by_lua_file</span> lua/item.lua;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>æ‹¼æ¥IDå¹¶è¿”å›</li></ol><p>ä¿®æ”¹<code>/usr/loca/openresty/nginx/lua/item.lua</code>æ–‡ä»¶ï¼Œè·å–idå¹¶æ‹¼æ¥åˆ°ç»“æœä¸­è¿”å›ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è·å–å•†å“id</span></span><br><span class="line"><span class="keyword">local</span> id = ngx.var[<span class="number">1</span>]</span><br><span class="line"><span class="comment">-- æ‹¼æ¥å¹¶è¿”å›</span></span><br><span class="line">ngx.say(<span class="string">&#x27;&#123;&quot;id&quot;:&#x27;</span> .. id .. <span class="string">&#x27;,&quot;name&quot;:&quot;SALSA AIR&quot;,&quot;title&quot;:&quot;RIMOWA 21å¯¸æ‰˜è¿ç®±æ‹‰æ†ç®± SALSA AIRç³»åˆ—æœç»¿è‰² 820.70.36.4&quot;,&quot;price&quot;:17900,&quot;image&quot;:&quot;https://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webp&quot;,&quot;category&quot;:&quot;æ‹‰æ†ç®±&quot;,&quot;brand&quot;:&quot;RIMOWA&quot;,&quot;spec&quot;:&quot;&quot;,&quot;status&quot;:1,&quot;createTime&quot;:&quot;2019-04-30T16:00:00.000+00:00&quot;,&quot;updateTime&quot;:&quot;2019-04-30T16:00:00.000+00:00&quot;,&quot;stock&quot;:2999,&quot;sold&quot;:31290&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li>é‡æ–°åŠ è½½å¹¶æµ‹è¯•</li></ol><p>è¿è¡Œå‘½ä»¤ä»¥é‡æ–°åŠ è½½OpenRestyé…ç½®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><p>åˆ·æ–°é¡µé¢å¯ä»¥çœ‹åˆ°ç»“æœä¸­å·²ç»å¸¦ä¸Šäº†IDï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/09/db0874b72f514d2381245bfe345845e6" alt="image-20210821102235467"></p><h2 id="cha-xun-tomcat" id="æŸ¥è¯¢Tomcat">æŸ¥è¯¢Tomcat</h2><blockquote><p>æ‹¿åˆ°å•†å“IDåï¼Œæœ¬åº”å»ç¼“å­˜ä¸­æŸ¥è¯¢å•†å“ä¿¡æ¯ï¼Œä¸è¿‡ç›®å‰æˆ‘ä»¬è¿˜æœªå»ºç«‹nginxã€redisç¼“å­˜ã€‚å› æ­¤ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæ ¹æ®å•†å“idå»tomcatæŸ¥è¯¢å•†å“ä¿¡æ¯ã€‚æˆ‘ä»¬å®ç°å¦‚å›¾éƒ¨åˆ†ï¼š</p></blockquote><p><img src="https://s1.vika.cn/space/2023/04/09/ae58204cd4e34d8caa1108b61fb987e4" alt="image-20210821102610167"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬çš„OpenRestyæ˜¯åœ¨è™šæ‹Ÿæœºï¼ŒTomcatæ˜¯åœ¨Windowsç”µè„‘ä¸Šã€‚ä¸¤è€…IPä¸€å®šä¸è¦æé”™äº†ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/09/48f9b7376bfe4cb8807d8fefbf74bd00" alt="image-20210821102959829"></p><h3 id="fa-song-http-qing-qiu-de-api" id="å‘é€httpè¯·æ±‚çš„API">å‘é€httpè¯·æ±‚çš„API</h3><p>nginxæä¾›äº†å†…éƒ¨APIç”¨ä»¥å‘é€httpè¯·æ±‚ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> resp = ngx.location.capture(<span class="string">&quot;/path&quot;</span>,&#123;</span><br><span class="line">    method = ngx.HTTP_GET,   <span class="comment">-- è¯·æ±‚æ–¹å¼</span></span><br><span class="line">    args = &#123;a=<span class="number">1</span>,b=<span class="number">2</span>&#125;,  <span class="comment">-- getæ–¹å¼ä¼ å‚æ•°</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿”å›çš„å“åº”å†…å®¹åŒ…æ‹¬ï¼š</p><ul><li>resp.statusï¼šå“åº”çŠ¶æ€ç </li><li>resp.headerï¼šå“åº”å¤´ï¼Œæ˜¯ä¸€ä¸ªtable</li><li>resp.bodyï¼šå“åº”ä½“ï¼Œå°±æ˜¯å“åº”æ•°æ®</li></ul><blockquote><p>æ³¨æ„ï¼šè¿™é‡Œçš„pathæ˜¯è·¯å¾„ï¼Œå¹¶ä¸åŒ…å«IPå’Œç«¯å£ã€‚è¿™ä¸ªè¯·æ±‚ä¼šè¢«nginxå†…éƒ¨çš„serverç›‘å¬å¹¶å¤„ç†ã€‚</p></blockquote><p>ä½†æ˜¯æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªè¯·æ±‚å‘é€åˆ°TomcatæœåŠ¡å™¨ï¼Œæ‰€ä»¥è¿˜éœ€è¦ç¼–å†™ä¸€ä¸ªserveræ¥å¯¹è¿™ä¸ªè·¯å¾„åšåå‘ä»£ç†ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /path &#123;</span><br><span class="line">    <span class="comment"># è¿™é‡Œæ˜¯windowsç”µè„‘çš„ipå’ŒJavaæœåŠ¡ç«¯å£ï¼Œéœ€è¦ç¡®ä¿windowsé˜²ç«å¢™å¤„äºå…³é—­çŠ¶æ€</span></span><br><span class="line">    <span class="attribute">proxy_pass</span> http://192.168.150.1:8081; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸç†å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/09/09263482b6004bf29204afa79df81930" alt="image-20210821104149061"></p><h3 id="feng-zhuang-http-gong-ju" id="å°è£…httpå·¥å…·">å°è£…httpå·¥å…·</h3><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°è£…ä¸€ä¸ªå‘é€Httpè¯·æ±‚çš„å·¥å…·ï¼ŒåŸºäºngx.location.captureæ¥å®ç°æŸ¥è¯¢tomcatã€‚</p><ol><li>æ·»åŠ åå‘ä»£ç†ï¼Œåˆ°windowsçš„JavaæœåŠ¡</li></ol><p>å› ä¸ºitem-serviceä¸­çš„æ¥å£éƒ½æ˜¯/itemå¼€å¤´ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›‘å¬/itemè·¯å¾„ï¼Œä»£ç†åˆ°windowsä¸Šçš„tomcatæœåŠ¡ã€‚</p><p>ä¿®æ”¹ <code>/usr/local/openresty/nginx/conf/nginx.conf</code>æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ªlocationï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /item &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://192.168.150.1:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šä½¿ç”¨äº‘æœåŠ¡å™¨</p><ul><li>å¯ä»¥é€šè¿‡å†…ç½‘ç©¿é€å·¥å…·cpolarè®¿é—®æœ¬æœº</li><li>å®˜ç½‘ï¼š<a href="https://www.cpolar.com/">cpolar - å®‰å…¨çš„å†…ç½‘ç©¿é€å·¥å…·</a></li><li>ä¸‹è½½å¯åŠ¨ï¼Œå†ä½¿ç”¨æ³¨å†Œè´¦å·ç™»å½•å³å¯</li></ul></blockquote><img src="C:/Users/86185/AppData/Roaming/Typora/typora-user-images/image-20230409220520991.png" alt="image-20230409220520991" style="zoom:50%;" /><p><img src="https://s1.vika.cn/space/2023/04/09/0a4f35161bad46e58210190d308cab29" alt="image-20230409220556772"></p><p>ä»¥åï¼Œåªè¦æˆ‘ä»¬è°ƒç”¨<code>ngx.location.capture(&quot;/item&quot;)</code>ï¼Œå°±ä¸€å®šèƒ½å‘é€è¯·æ±‚åˆ°windowsçš„tomcatæœåŠ¡ã€‚</p><ol start="2"><li>å°è£…å·¥å…·ç±»</li></ol><p>ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼ŒOpenRestyå¯åŠ¨æ—¶ä¼šåŠ è½½ä»¥ä¸‹ä¸¤ä¸ªç›®å½•ä¸­çš„å·¥å…·æ–‡ä»¶ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/14/3c908bab1afb4e259593c7747574450b" alt="image-20210821104857413"></p><p>æ‰€ä»¥ï¼Œè‡ªå®šä¹‰çš„httpå·¥å…·ä¹Ÿéœ€è¦æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹ã€‚</p><p>åœ¨<code>/usr/local/openresty/lualib</code>ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªcommon.luaæ–‡ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/openresty/lualib/common.lua</span><br></pre></td></tr></table></figure><p>å†…å®¹å¦‚ä¸‹:</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å°è£…å‡½æ•°ï¼Œå‘é€httpè¯·æ±‚ï¼Œå¹¶è§£æå“åº”</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">read_http</span><span class="params">(path, params)</span></span></span><br><span class="line">    <span class="keyword">local</span> resp = ngx.location.capture(<span class="built_in">path</span>,&#123;</span><br><span class="line">        method = ngx.HTTP_GET,</span><br><span class="line">        args = params,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> resp <span class="keyword">then</span></span><br><span class="line">        <span class="comment">-- è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œè¿”å›404</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;httpè¯·æ±‚æŸ¥è¯¢å¤±è´¥, path: &quot;</span>, <span class="built_in">path</span> , <span class="string">&quot;, args: &quot;</span>, args)</span><br><span class="line">        ngx.<span class="built_in">exit</span>(<span class="number">404</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> resp.body</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- å°†æ–¹æ³•å¯¼å‡º</span></span><br><span class="line"><span class="keyword">local</span> _M = &#123;  </span><br><span class="line">    read_http = read_http</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">return</span> _M</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå·¥å…·å°†read_httpå‡½æ•°å°è£…åˆ°_Mè¿™ä¸ªtableç±»å‹çš„å˜é‡ä¸­ï¼Œå¹¶ä¸”è¿”å›ï¼Œè¿™ç±»ä¼¼äºå¯¼å‡ºã€‚</p><p>ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨<code>require('common')</code>æ¥å¯¼å…¥è¯¥å‡½æ•°åº“ï¼Œè¿™é‡Œçš„commonæ˜¯å‡½æ•°åº“çš„æ–‡ä»¶åã€‚</p><ol start="3"><li>å®ç°å•†å“æŸ¥è¯¢</li></ol><p>æœ€åï¼Œæˆ‘ä»¬ä¿®æ”¹<code>/usr/local/openresty/lua/item.lua</code>æ–‡ä»¶ï¼Œåˆ©ç”¨åˆšåˆšå°è£…çš„å‡½æ•°åº“å®ç°å¯¹tomcatçš„æŸ¥è¯¢ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¼•å…¥è‡ªå®šä¹‰commonå·¥å…·æ¨¡å—ï¼Œè¿”å›å€¼æ˜¯commonä¸­è¿”å›çš„ _M</span></span><br><span class="line"><span class="keyword">local</span> common = <span class="built_in">require</span>(<span class="string">&quot;common&quot;</span>)</span><br><span class="line"><span class="comment">-- ä» commonä¸­è·å–read_httpè¿™ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="keyword">local</span> read_http = common.read_http</span><br><span class="line"><span class="comment">-- è·å–è·¯å¾„å‚æ•°</span></span><br><span class="line"><span class="keyword">local</span> id = ngx.var[<span class="number">1</span>]</span><br><span class="line"><span class="comment">-- æ ¹æ®idæŸ¥è¯¢å•†å“</span></span><br><span class="line"><span class="keyword">local</span> itemJSON = read_http(<span class="string">&quot;/item/&quot;</span>.. id, <span class="literal">nil</span>)</span><br><span class="line"><span class="comment">-- æ ¹æ®idæŸ¥è¯¢å•†å“åº“å­˜</span></span><br><span class="line"><span class="keyword">local</span> itemStockJSON = read_http(<span class="string">&quot;/item/stock/&quot;</span>.. id, <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒæŸ¥è¯¢åˆ°çš„ç»“æœæ˜¯jsonå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”åŒ…å«å•†å“ã€åº“å­˜ä¸¤ä¸ªjsonå­—ç¬¦ä¸²ï¼Œé¡µé¢æœ€ç»ˆéœ€è¦çš„æ˜¯æŠŠä¸¤ä¸ªjsonæ‹¼æ¥ä¸ºä¸€ä¸ªjsonï¼š</p><p><img src="assets/image-20210821110441222.png" alt="image-20210821110441222"></p><p>è¿™å°±éœ€è¦æˆ‘ä»¬å…ˆæŠŠJSONå˜ä¸ºluaçš„tableï¼Œå®Œæˆæ•°æ®æ•´åˆåï¼Œå†è½¬ä¸ºJSONã€‚</p><h3 id="cjson-gong-ju-lei" id="CJSONå·¥å…·ç±»">CJSONå·¥å…·ç±»</h3><p>OpenRestyæä¾›äº†ä¸€ä¸ªcjsonçš„æ¨¡å—ç”¨æ¥å¤„ç†JSONçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p><p>å®˜æ–¹åœ°å€ï¼š <a href="https://github.com/openresty/lua-cjson/">https://github.com/openresty/lua-cjson/</a></p><ol><li>å¼•å…¥cjsonæ¨¡å—ï¼š</li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> cjson = <span class="built_in">require</span> <span class="string">&quot;cjson&quot;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>åºåˆ—åŒ–ï¼š</li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> obj = &#123;</span><br><span class="line">    name = <span class="string">&#x27;jack&#x27;</span>,</span><br><span class="line">    age = <span class="number">21</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">-- æŠŠ table åºåˆ—åŒ–ä¸º json</span></span><br><span class="line"><span class="keyword">local</span> json = cjson.encode(obj)</span><br></pre></td></tr></table></figure><ol start="3"><li>ååºåˆ—åŒ–ï¼š</li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> json = <span class="string">&#x27;&#123;&quot;name&quot;: &quot;jack&quot;, &quot;age&quot;: 21&#125;&#x27;</span></span><br><span class="line"><span class="comment">-- ååºåˆ—åŒ– jsonä¸º table</span></span><br><span class="line"><span class="keyword">local</span> obj = cjson.decode(json);</span><br><span class="line"><span class="built_in">print</span>(obj.name)</span><br></pre></td></tr></table></figure><h3 id="shi-xian-tomcat-cha-xun" id="å®ç°TomcatæŸ¥è¯¢">å®ç°TomcatæŸ¥è¯¢</h3><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¹‹å‰çš„item.luaä¸­çš„ä¸šåŠ¡ï¼Œæ·»åŠ jsonå¤„ç†åŠŸèƒ½ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¯¼å…¥commonå‡½æ•°åº“</span></span><br><span class="line"><span class="keyword">local</span> common = <span class="built_in">require</span>(<span class="string">&#x27;common&#x27;</span>)</span><br><span class="line"><span class="keyword">local</span> read_http = common.read_http</span><br><span class="line"><span class="comment">-- å¯¼å…¥cjsonåº“</span></span><br><span class="line"><span class="keyword">local</span> cjson = <span class="built_in">require</span>(<span class="string">&#x27;cjson&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è·å–è·¯å¾„å‚æ•°</span></span><br><span class="line"><span class="keyword">local</span> id = ngx.var[<span class="number">1</span>]</span><br><span class="line"><span class="comment">-- æ ¹æ®idæŸ¥è¯¢å•†å“</span></span><br><span class="line"><span class="keyword">local</span> itemJSON = read_http(<span class="string">&quot;/item/&quot;</span>.. id, <span class="literal">nil</span>)</span><br><span class="line"><span class="comment">-- æ ¹æ®idæŸ¥è¯¢å•†å“åº“å­˜</span></span><br><span class="line"><span class="keyword">local</span> itemStockJSON = read_http(<span class="string">&quot;/item/stock/&quot;</span>.. id, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- JSONè½¬åŒ–ä¸ºluaçš„table</span></span><br><span class="line"><span class="keyword">local</span> item = cjson.decode(itemJSON)</span><br><span class="line"><span class="keyword">local</span> stock = cjson.decode(itemStockJSON)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç»„åˆæ•°æ®</span></span><br><span class="line">item.stock = stock.stock</span><br><span class="line">item.sold = stock.sold</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŠŠitemåºåˆ—åŒ–ä¸ºjson è¿”å›ç»“æœ</span></span><br><span class="line">ngx.say(cjson.encode(item))</span><br></pre></td></tr></table></figure><h3 id="ji-yu-id-fu-zai-jun-heng" id="åŸºäºIDè´Ÿè½½å‡è¡¡">åŸºäºIDè´Ÿè½½å‡è¡¡</h3><p>åˆšæ‰çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬çš„tomcatæ˜¯å•æœºéƒ¨ç½²ã€‚è€Œå®é™…å¼€å‘ä¸­ï¼Œtomcatä¸€å®šæ˜¯é›†ç¾¤æ¨¡å¼ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/09/377fa42373dd46609e0cb3c883a509d2" alt="image-20210821111023255"></p><p>å› æ­¤ï¼ŒOpenRestyéœ€è¦å¯¹tomcaté›†ç¾¤åšè´Ÿè½½å‡è¡¡ã€‚</p><p>è€Œé»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™æ˜¯è½®è¯¢æ¨¡å¼ï¼Œå½“æˆ‘ä»¬æŸ¥è¯¢/item/10001æ—¶ï¼š</p><ul><li>ç¬¬ä¸€æ¬¡ä¼šè®¿é—®8081ç«¯å£çš„tomcatæœåŠ¡ï¼Œåœ¨è¯¥æœåŠ¡å†…éƒ¨å°±å½¢æˆäº†JVMè¿›ç¨‹ç¼“å­˜</li><li>ç¬¬äºŒæ¬¡ä¼šè®¿é—®8082ç«¯å£çš„tomcatæœåŠ¡ï¼Œè¯¥æœåŠ¡å†…éƒ¨æ²¡æœ‰JVMç¼“å­˜ï¼ˆå› ä¸ºJVMç¼“å­˜æ— æ³•å…±äº«ï¼‰ï¼Œä¼šæŸ¥è¯¢æ•°æ®åº“</li><li>â€¦</li></ul><p>ä½ çœ‹ï¼Œå› ä¸ºè½®è¯¢çš„åŸå› ï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢8081å½¢æˆçš„JVMç¼“å­˜å¹¶æœªç”Ÿæ•ˆï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡å†æ¬¡è®¿é—®åˆ°8081æ—¶æ‰å¯ä»¥ç”Ÿæ•ˆï¼Œç¼“å­˜å‘½ä¸­ç‡å¤ªä½äº†ã€‚</p><ul><li><p>å¦‚æœèƒ½è®©åŒä¸€ä¸ªå•†å“ï¼Œæ¯æ¬¡æŸ¥è¯¢æ—¶éƒ½è®¿é—®åŒä¸€ä¸ªtomcatæœåŠ¡ï¼Œé‚£ä¹ˆJVMç¼“å­˜å°±ä¸€å®šèƒ½ç”Ÿæ•ˆäº†ã€‚</p></li><li><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å•†å“idåšè´Ÿè½½å‡è¡¡ï¼Œè€Œä¸æ˜¯è½®è¯¢ã€‚</p></li></ul><ol><li><strong>åŸç†</strong></li></ol><p>nginxæä¾›äº†åŸºäºè¯·æ±‚è·¯å¾„åšè´Ÿè½½å‡è¡¡çš„ç®—æ³•ï¼š</p><ul><li>nginxæ ¹æ®è¯·æ±‚è·¯å¾„åšhashè¿ç®—ï¼ŒæŠŠå¾—åˆ°çš„æ•°å€¼å¯¹tomcatæœåŠ¡çš„æ•°é‡å–ä½™ï¼Œä½™æ•°æ˜¯å‡ ï¼Œå°±è®¿é—®ç¬¬å‡ ä¸ªæœåŠ¡ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><ul><li>æˆ‘ä»¬çš„è¯·æ±‚è·¯å¾„æ˜¯ /item/10001</li><li>tomcatæ€»æ•°ä¸º2å°ï¼ˆ8081ã€8082ï¼‰</li><li>å¯¹è¯·æ±‚è·¯å¾„/item/1001åšhashè¿ç®—æ±‚ä½™çš„ç»“æœä¸º1</li><li>åˆ™è®¿é—®ç¬¬ä¸€ä¸ªtomcatæœåŠ¡ï¼Œä¹Ÿå°±æ˜¯8081</li></ul><p>åªè¦idä¸å˜ï¼Œæ¯æ¬¡hashè¿ç®—ç»“æœä¹Ÿä¸ä¼šå˜ï¼Œé‚£å°±å¯ä»¥ä¿è¯åŒä¸€ä¸ªå•†å“ï¼Œä¸€ç›´è®¿é—®åŒä¸€ä¸ªtomcatæœåŠ¡ï¼Œç¡®ä¿JVMç¼“å­˜ç”Ÿæ•ˆã€‚</p><ol start="2"><li><strong>å®ç°</strong></li></ol><p>ä¿®æ”¹<code>/usr/local/openresty/nginx/conf/nginx.conf</code>æ–‡ä»¶ï¼Œå®ç°åŸºäºIDåšè´Ÿè½½å‡è¡¡ã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰tomcaté›†ç¾¤ï¼Œå¹¶è®¾ç½®åŸºäºè·¯å¾„åšè´Ÿè½½å‡è¡¡ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> tomcat-cluster &#123;</span><br><span class="line">    <span class="attribute">hash</span> <span class="variable">$request_uri</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.150.1:8081</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.150.1:8082</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œä¿®æ”¹å¯¹tomcatæœåŠ¡çš„åå‘ä»£ç†ï¼Œç›®æ ‡æŒ‡å‘tomcaté›†ç¾¤ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /item &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://tomcat-cluster;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°åŠ è½½OpenResty</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>æµ‹è¯•</strong></li></ol><p>å¯åŠ¨ä¸¤å°tomcatæœåŠ¡ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/15/c6d0cc8962b54448ac0412fe6c08ad10" alt="image-20210821112420464"></p><p>åŒæ—¶å¯åŠ¨ï¼š</p><p>æ¸…ç©ºæ—¥å¿—åï¼Œå†æ¬¡è®¿é—®é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°ä¸åŒidçš„å•†å“ï¼Œè®¿é—®åˆ°äº†ä¸åŒçš„tomcatæœåŠ¡ï¼š</p><h2 id="redis-huan-cun-yu-re" id="Redisç¼“å­˜é¢„çƒ­">Redisç¼“å­˜é¢„çƒ­</h2><p>Redisç¼“å­˜ä¼šé¢ä¸´å†·å¯åŠ¨é—®é¢˜ï¼š</p><ul><li><p><strong>å†·å¯åŠ¨</strong>ï¼šæœåŠ¡åˆšåˆšå¯åŠ¨æ—¶ï¼ŒRedisä¸­å¹¶æ²¡æœ‰ç¼“å­˜ï¼Œå¦‚æœæ‰€æœ‰å•†å“æ•°æ®éƒ½åœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶æ·»åŠ ç¼“å­˜ï¼Œå¯èƒ½ä¼šç»™æ•°æ®åº“å¸¦æ¥è¾ƒå¤§å‹åŠ›ã€‚</p></li><li><p><strong>ç¼“å­˜é¢„çƒ­</strong>ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¤§æ•°æ®ç»Ÿè®¡ç”¨æˆ·è®¿é—®çš„çƒ­ç‚¹æ•°æ®ï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶å°†è¿™äº›çƒ­ç‚¹æ•°æ®æå‰æŸ¥è¯¢å¹¶ä¿å­˜åˆ°Redisä¸­ã€‚</p></li></ul><p>æˆ‘ä»¬æ•°æ®é‡è¾ƒå°‘ï¼Œå¹¶ä¸”æ²¡æœ‰æ•°æ®ç»Ÿè®¡ç›¸å…³åŠŸèƒ½ï¼Œç›®å‰å¯ä»¥åœ¨å¯åŠ¨æ—¶å°†æ‰€æœ‰æ•°æ®éƒ½æ”¾å…¥ç¼“å­˜ä¸­ã€‚</p><ol><li>åˆ©ç”¨Dockerå®‰è£…Redis</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name redis -p 6379:6379 -d redis redis-server --appendonly <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><ol start="2"><li>åœ¨item-serviceæœåŠ¡ä¸­å¼•å…¥Redisä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>é…ç½®Redisåœ°å€</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span></span><br></pre></td></tr></table></figure><ol start="4"><li>ç¼–å†™åˆå§‹åŒ–ç±»</li></ol><p>ç¼“å­˜é¢„çƒ­éœ€è¦åœ¨é¡¹ç›®å¯åŠ¨æ—¶å®Œæˆï¼Œå¹¶ä¸”å¿…é¡»æ˜¯æ‹¿åˆ°RedisTemplateä¹‹åã€‚</p><ul><li>è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨InitializingBeanæ¥å£æ¥å®ç°ï¼Œå› ä¸ºInitializingBeanå¯ä»¥åœ¨å¯¹è±¡è¢«Springåˆ›å»ºå¹¶ä¸”æˆå‘˜å˜é‡å…¨éƒ¨æ³¨å…¥åæ‰§è¡Œã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.heima.item.config;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisHandler</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IItemService itemService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IItemStockService stockService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">MAPPER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ç¼“å­˜</span></span><br><span class="line">        <span class="comment">// 1.æŸ¥è¯¢å•†å“ä¿¡æ¯</span></span><br><span class="line">        List&lt;Item&gt; itemList = itemService.list();</span><br><span class="line">        <span class="comment">// 2.æ”¾å…¥ç¼“å­˜</span></span><br><span class="line">        <span class="keyword">for</span> (Item item : itemList) &#123;</span><br><span class="line">            <span class="comment">// 2.1.itemåºåˆ—åŒ–ä¸ºJSON</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> MAPPER.writeValueAsString(item);</span><br><span class="line">            <span class="comment">// 2.2.å­˜å…¥redis</span></span><br><span class="line">            redisTemplate.opsForValue().set(<span class="string">&quot;item:id:&quot;</span> + item.getId(), json);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.æŸ¥è¯¢å•†å“åº“å­˜ä¿¡æ¯</span></span><br><span class="line">        List&lt;ItemStock&gt; stockList = stockService.list();</span><br><span class="line">        <span class="comment">// 4.æ”¾å…¥ç¼“å­˜</span></span><br><span class="line">        <span class="keyword">for</span> (ItemStock stock : stockList) &#123;</span><br><span class="line">            <span class="comment">// 2.1.itemåºåˆ—åŒ–ä¸ºJSON</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> MAPPER.writeValueAsString(stock);</span><br><span class="line">            <span class="comment">// 2.2.å­˜å…¥redis</span></span><br><span class="line">            redisTemplate.opsForValue().set(<span class="string">&quot;item:stock:id:&quot;</span> + stock.getId(), json);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="cha-xun-redis-huan-cun" id="æŸ¥è¯¢Redisç¼“å­˜">æŸ¥è¯¢Redisç¼“å­˜</h2><p>ç°åœ¨ï¼ŒRedisç¼“å­˜å·²ç»å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬å¯ä»¥å†OpenRestyä¸­å®ç°æŸ¥è¯¢Redisçš„é€»è¾‘äº†ã€‚å¦‚ä¸‹å›¾çº¢æ¡†æ‰€ç¤ºï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/15/cb5458197278483bbe69895864c2b83d" alt="image-20210821113340111"></p><p>å½“è¯·æ±‚è¿›å…¥OpenRestyä¹‹åï¼š</p><ul><li>ä¼˜å…ˆæŸ¥è¯¢Redisç¼“å­˜</li><li>å¦‚æœRedisç¼“å­˜æœªå‘½ä¸­ï¼Œå†æŸ¥è¯¢Tomcat</li></ul><h3 id="feng-zhuang-redis-gong-ju" id="å°è£…Rediså·¥å…·">å°è£…Rediså·¥å…·</h3><p>OpenRestyæä¾›äº†æ“ä½œRedisçš„æ¨¡å—ï¼Œæˆ‘ä»¬åªè¦å¼•å…¥è¯¥æ¨¡å—å°±èƒ½ç›´æ¥ä½¿ç”¨ã€‚ä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å°†Redisæ“ä½œå°è£…åˆ°ä¹‹å‰çš„common.luaå·¥å…·åº“ä¸­ã€‚</p><p>ä¿®æ”¹<code>/usr/local/openresty/lualib/common.lua</code>æ–‡ä»¶ï¼š</p><ol><li>å¼•å…¥Redisæ¨¡å—ï¼Œå¹¶åˆå§‹åŒ–Rediså¯¹è±¡</li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¯¼å…¥redis</span></span><br><span class="line"><span class="keyword">local</span> redis = <span class="built_in">require</span>(<span class="string">&#x27;resty.redis&#x27;</span>)</span><br><span class="line"><span class="comment">-- åˆå§‹åŒ–redis</span></span><br><span class="line"><span class="keyword">local</span> red = redis:new()</span><br><span class="line">red:set_timeouts(<span class="number">1000</span>, <span class="number">1000</span>, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>å°è£…å‡½æ•°ï¼Œç”¨æ¥é‡Šæ”¾Redisè¿æ¥ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å…³é—­redisè¿æ¥çš„å·¥å…·æ–¹æ³•ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">close_redis</span><span class="params">(red)</span></span></span><br><span class="line">    <span class="keyword">local</span> pool_max_idle_time = <span class="number">10000</span> <span class="comment">-- è¿æ¥çš„ç©ºé—²æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span></span><br><span class="line">    <span class="keyword">local</span> pool_size = <span class="number">100</span> <span class="comment">--è¿æ¥æ± å¤§å°</span></span><br><span class="line">    <span class="keyword">local</span> ok, err = red:set_keepalive(pool_max_idle_time, pool_size)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;æ”¾å…¥redisè¿æ¥æ± å¤±è´¥: &quot;</span>, err)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ol start="3"><li>å°è£…å‡½æ•°ï¼Œæ ¹æ®keyæŸ¥è¯¢Redisæ•°æ®</li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢redisçš„æ–¹æ³• ipå’Œportæ˜¯redisåœ°å€ï¼Œkeyæ˜¯æŸ¥è¯¢çš„key</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">read_redis</span><span class="params">(ip, port, key)</span></span></span><br><span class="line">    <span class="comment">-- è·å–ä¸€ä¸ªè¿æ¥</span></span><br><span class="line">    <span class="keyword">local</span> ok, err = red:connect(ip, port)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;è¿æ¥rediså¤±è´¥ : &quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- æŸ¥è¯¢redis</span></span><br><span class="line">    <span class="keyword">local</span> resp, err = red:get(key)</span><br><span class="line">    <span class="comment">-- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> resp <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;æŸ¥è¯¢Rediså¤±è´¥: &quot;</span>, err, <span class="string">&quot;, key = &quot;</span> , key)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">--å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> resp == ngx.null <span class="keyword">then</span></span><br><span class="line">        resp = <span class="literal">nil</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;æŸ¥è¯¢Redisæ•°æ®ä¸ºç©º, key = &quot;</span>, key)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    close_redis(red)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ol start="4"><li>å¯¼å‡º</li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å°†æ–¹æ³•å¯¼å‡º</span></span><br><span class="line"><span class="keyword">local</span> _M = &#123;  </span><br><span class="line">    read_http = read_http,</span><br><span class="line">    read_redis = read_redis</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">return</span> _M</span><br></pre></td></tr></table></figure><p>å®Œæ•´çš„common.luaï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¯¼å…¥redis</span></span><br><span class="line"><span class="keyword">local</span> redis = <span class="built_in">require</span>(<span class="string">&#x27;resty.redis&#x27;</span>)</span><br><span class="line"><span class="comment">-- åˆå§‹åŒ–redis</span></span><br><span class="line"><span class="keyword">local</span> red = redis:new()</span><br><span class="line">red:set_timeouts(<span class="number">1000</span>, <span class="number">1000</span>, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å…³é—­redisè¿æ¥çš„å·¥å…·æ–¹æ³•ï¼Œå…¶å®æ˜¯æ”¾å…¥è¿æ¥æ± </span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">close_redis</span><span class="params">(red)</span></span></span><br><span class="line">    <span class="keyword">local</span> pool_max_idle_time = <span class="number">10000</span> <span class="comment">-- è¿æ¥çš„ç©ºé—²æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span></span><br><span class="line">    <span class="keyword">local</span> pool_size = <span class="number">100</span> <span class="comment">--è¿æ¥æ± å¤§å°</span></span><br><span class="line">    <span class="keyword">local</span> ok, err = red:set_keepalive(pool_max_idle_time, pool_size)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;æ”¾å…¥redisè¿æ¥æ± å¤±è´¥: &quot;</span>, err)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢redisçš„æ–¹æ³• ipå’Œportæ˜¯redisåœ°å€ï¼Œkeyæ˜¯æŸ¥è¯¢çš„key</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">read_redis</span><span class="params">(ip, port, key)</span></span></span><br><span class="line">    <span class="comment">-- è·å–ä¸€ä¸ªè¿æ¥</span></span><br><span class="line">    <span class="keyword">local</span> ok, err = red:connect(ip, port)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;è¿æ¥rediså¤±è´¥ : &quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- æŸ¥è¯¢redis</span></span><br><span class="line">    <span class="keyword">local</span> resp, err = red:get(key)</span><br><span class="line">    <span class="comment">-- æŸ¥è¯¢å¤±è´¥å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> resp <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;æŸ¥è¯¢Rediså¤±è´¥: &quot;</span>, err, <span class="string">&quot;, key = &quot;</span> , key)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">--å¾—åˆ°çš„æ•°æ®ä¸ºç©ºå¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> resp == ngx.null <span class="keyword">then</span></span><br><span class="line">        resp = <span class="literal">nil</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;æŸ¥è¯¢Redisæ•°æ®ä¸ºç©º, key = &quot;</span>, key)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    close_redis(red)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å°è£…å‡½æ•°ï¼Œå‘é€httpè¯·æ±‚ï¼Œå¹¶è§£æå“åº”</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">read_http</span><span class="params">(path, params)</span></span></span><br><span class="line">    <span class="keyword">local</span> resp = ngx.location.capture(<span class="built_in">path</span>,&#123;</span><br><span class="line">        method = ngx.HTTP_GET,</span><br><span class="line">        args = params,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> resp <span class="keyword">then</span></span><br><span class="line">        <span class="comment">-- è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œè¿”å›404</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;httpæŸ¥è¯¢å¤±è´¥, path: &quot;</span>, <span class="built_in">path</span> , <span class="string">&quot;, args: &quot;</span>, args)</span><br><span class="line">        ngx.<span class="built_in">exit</span>(<span class="number">404</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> resp.body</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- å°†æ–¹æ³•å¯¼å‡º</span></span><br><span class="line"><span class="keyword">local</span> _M = &#123;  </span><br><span class="line">    read_http = read_http,</span><br><span class="line">    read_redis = read_redis</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">return</span> _M</span><br></pre></td></tr></table></figure><h3 id="shi-xian-redis-cha-xun" id="å®ç°RedisæŸ¥è¯¢">å®ç°RedisæŸ¥è¯¢</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å»ä¿®æ”¹item.luaæ–‡ä»¶ï¼Œå®ç°å¯¹Redisçš„æŸ¥è¯¢äº†ã€‚</p><p>æŸ¥è¯¢é€»è¾‘æ˜¯ï¼š</p><ul><li>æ ¹æ®idæŸ¥è¯¢Redis</li><li>å¦‚æœæŸ¥è¯¢å¤±è´¥åˆ™ç»§ç»­æŸ¥è¯¢Tomcat</li><li>å°†æŸ¥è¯¢ç»“æœè¿”å›</li></ul><ol><li>ä¿®æ”¹<code>/usr/local/openresty/lua/item.lua</code>æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ªæŸ¥è¯¢å‡½æ•°ï¼š</li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¯¼å…¥commonå‡½æ•°åº“</span></span><br><span class="line"><span class="keyword">local</span> common = <span class="built_in">require</span>(<span class="string">&#x27;common&#x27;</span>)</span><br><span class="line"><span class="keyword">local</span> read_http = common.read_http</span><br><span class="line"><span class="keyword">local</span> read_redis = common.read_redis</span><br><span class="line"><span class="comment">-- å°è£…æŸ¥è¯¢å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read_data</span><span class="params">(key, path, params)</span></span></span><br><span class="line">    <span class="comment">-- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">local</span> val = read_redis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, key)</span><br><span class="line">    <span class="comment">-- åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> val <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;redisæŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢httpï¼Œ key: &quot;</span>, key)</span><br><span class="line">        <span class="comment">-- redisæŸ¥è¯¢å¤±è´¥ï¼Œå»æŸ¥è¯¢http</span></span><br><span class="line">        val = read_http(<span class="built_in">path</span>, params)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- è¿”å›æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ol start="2"><li>è€Œåä¿®æ”¹å•†å“æŸ¥è¯¢ã€åº“å­˜æŸ¥è¯¢çš„ä¸šåŠ¡ï¼š</li></ol><p><img src="https://s1.vika.cn/space/2023/04/15/a0038fcdebf145d1bb9b721781e76111" alt="image-20210821114528954"></p><ol start="3"><li>å®Œæ•´çš„item.luaä»£ç ï¼š</li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¯¼å…¥commonå‡½æ•°åº“</span></span><br><span class="line"><span class="keyword">local</span> common = <span class="built_in">require</span>(<span class="string">&#x27;common&#x27;</span>)</span><br><span class="line"><span class="keyword">local</span> read_http = common.read_http</span><br><span class="line"><span class="keyword">local</span> read_redis = common.read_redis</span><br><span class="line"><span class="comment">-- å¯¼å…¥cjsonåº“</span></span><br><span class="line"><span class="keyword">local</span> cjson = <span class="built_in">require</span>(<span class="string">&#x27;cjson&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å°è£…æŸ¥è¯¢å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read_data</span><span class="params">(key, path, params)</span></span></span><br><span class="line">    <span class="comment">-- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">local</span> val = read_redis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, key)</span><br><span class="line">    <span class="comment">-- åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> val <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;redisæŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢httpï¼Œ key: &quot;</span>, key)</span><br><span class="line">        <span class="comment">-- redisæŸ¥è¯¢å¤±è´¥ï¼Œå»æŸ¥è¯¢http</span></span><br><span class="line">        val = read_http(<span class="built_in">path</span>, params)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- è¿”å›æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è·å–è·¯å¾„å‚æ•°</span></span><br><span class="line"><span class="keyword">local</span> id = ngx.var[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å•†å“ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">local</span> itemJSON = read_data(<span class="string">&quot;item:id:&quot;</span> .. id,  <span class="string">&quot;/item/&quot;</span> .. id, <span class="literal">nil</span>)</span><br><span class="line"><span class="comment">-- æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">local</span> stockJSON = read_data(<span class="string">&quot;item:stock:id:&quot;</span> .. id, <span class="string">&quot;/item/stock/&quot;</span> .. id, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- JSONè½¬åŒ–ä¸ºluaçš„table</span></span><br><span class="line"><span class="keyword">local</span> item = cjson.decode(itemJSON)</span><br><span class="line"><span class="keyword">local</span> stock = cjson.decode(stockJSON)</span><br><span class="line"><span class="comment">-- ç»„åˆæ•°æ®</span></span><br><span class="line">item.stock = stock.stock</span><br><span class="line">item.sold = stock.sold</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŠŠitemåºåˆ—åŒ–ä¸ºjson è¿”å›ç»“æœ</span></span><br><span class="line">ngx.say(cjson.encode(item))</span><br></pre></td></tr></table></figure><h2 id="nginx-ben-di-huan-cun" id="Nginxæœ¬åœ°ç¼“å­˜">Nginxæœ¬åœ°ç¼“å­˜</h2><p>ç°åœ¨ï¼Œæ•´ä¸ªå¤šçº§ç¼“å­˜ä¸­åªå·®æœ€åä¸€ç¯ï¼Œä¹Ÿå°±æ˜¯nginxçš„æœ¬åœ°ç¼“å­˜äº†ã€‚å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/15/b960d85d1a65420d90a765de11d6b5cc" alt="image-20210821114742950"></p><h3 id="ben-di-huan-cun-api" id="æœ¬åœ°ç¼“å­˜API">æœ¬åœ°ç¼“å­˜API</h3><p>OpenRestyä¸ºNginxæä¾›äº†<strong>shard dict</strong>çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨nginxçš„å¤šä¸ªworkerä¹‹é—´å…±äº«æ•°æ®ï¼Œå®ç°ç¼“å­˜åŠŸèƒ½ã€‚</p><ol><li>å¼€å¯å…±äº«å­—å…¸ï¼Œåœ¨nginx.confçš„httpä¸‹æ·»åŠ é…ç½®ï¼š</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…±äº«å­—å…¸ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œåç§°å«åšï¼šitem_cacheï¼Œå¤§å°150m</span></span><br><span class="line"><span class="attribute">lua_shared_dict</span> item_cache <span class="number">150m</span>; </span><br></pre></td></tr></table></figure><ol start="2"><li>æ“ä½œå…±äº«å­—å…¸ï¼š</li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è·å–æœ¬åœ°ç¼“å­˜å¯¹è±¡</span></span><br><span class="line"><span class="keyword">local</span> item_cache = ngx.shared.item_cache</span><br><span class="line"><span class="comment">-- å­˜å‚¨, æŒ‡å®škeyã€valueã€è¿‡æœŸæ—¶é—´ï¼Œå•ä½sï¼Œé»˜è®¤ä¸º0ä»£è¡¨æ°¸ä¸è¿‡æœŸ</span></span><br><span class="line">item_cache:set(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>, <span class="number">1000</span>)</span><br><span class="line"><span class="comment">-- è¯»å–</span></span><br><span class="line"><span class="keyword">local</span> val = item_cache:get(<span class="string">&#x27;key&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="shi-xian-ben-di-huan-cun-cha-xun" id="å®ç°æœ¬åœ°ç¼“å­˜æŸ¥è¯¢">å®ç°æœ¬åœ°ç¼“å­˜æŸ¥è¯¢</h3><ol><li>ä¿®æ”¹<code>/usr/local/openresty/lua/item.lua</code>æ–‡ä»¶ï¼Œä¿®æ”¹read_dataæŸ¥è¯¢å‡½æ•°ï¼Œæ·»åŠ æœ¬åœ°ç¼“å­˜é€»è¾‘ï¼š</li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¯¼å…¥å…±äº«è¯å…¸ï¼Œæœ¬åœ°ç¼“å­˜</span></span><br><span class="line"><span class="keyword">local</span> item_cache = ngx.shared.item_cache</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å°è£…æŸ¥è¯¢å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read_data</span><span class="params">(key, expire, path, params)</span></span></span><br><span class="line">    <span class="comment">-- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">local</span> val = item_cache:get(key)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> val <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;æœ¬åœ°ç¼“å­˜æŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢Redisï¼Œ key: &quot;</span>, key)</span><br><span class="line">        <span class="comment">-- æŸ¥è¯¢redis</span></span><br><span class="line">        val = read_redis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, key)</span><br><span class="line">        <span class="comment">-- åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> val <span class="keyword">then</span></span><br><span class="line">            ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;redisæŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢httpï¼Œ key: &quot;</span>, key)</span><br><span class="line">            <span class="comment">-- redisæŸ¥è¯¢å¤±è´¥ï¼Œå»æŸ¥è¯¢http</span></span><br><span class="line">            val = read_http(<span class="built_in">path</span>, params)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- æŸ¥è¯¢æˆåŠŸï¼ŒæŠŠæ•°æ®å†™å…¥æœ¬åœ°ç¼“å­˜</span></span><br><span class="line">    item_cache:set(key, val, expire)</span><br><span class="line">    <span class="comment">-- è¿”å›æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ol start="2"><li>ä¿®æ”¹item.luaä¸­æŸ¥è¯¢å•†å“å’Œåº“å­˜çš„ä¸šåŠ¡ï¼Œå®ç°æœ€æ–°çš„read_dataå‡½æ•°ï¼š</li></ol><p><img src="https://s1.vika.cn/space/2023/04/15/e8c318db39ba4be8b1fff7346fa6a42e" alt="image-20210821115108528"></p><p>å…¶å®å°±æ˜¯å¤šäº†ç¼“å­˜æ—¶é—´å‚æ•°ï¼Œè¿‡æœŸånginxç¼“å­˜ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œä¸‹æ¬¡è®¿é—®å³å¯æ›´æ–°ç¼“å­˜ã€‚</p><ul><li><p>è¿™é‡Œç»™å•†å“åŸºæœ¬ä¿¡æ¯è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º30åˆ†é’Ÿï¼Œåº“å­˜ä¸º1åˆ†é’Ÿã€‚</p></li><li><p>å› ä¸ºåº“å­˜æ›´æ–°é¢‘ç‡è¾ƒé«˜ï¼Œå¦‚æœç¼“å­˜æ—¶é—´è¿‡é•¿ï¼Œå¯èƒ½ä¸æ•°æ®åº“å·®å¼‚è¾ƒå¤§ã€‚</p></li></ul><ol start="3"><li>å®Œæ•´çš„item.luaæ–‡ä»¶ï¼š</li></ol><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¯¼å…¥commonå‡½æ•°åº“</span></span><br><span class="line"><span class="keyword">local</span> common = <span class="built_in">require</span>(<span class="string">&#x27;common&#x27;</span>)</span><br><span class="line"><span class="keyword">local</span> read_http = common.read_http</span><br><span class="line"><span class="keyword">local</span> read_redis = common.read_redis</span><br><span class="line"><span class="comment">-- å¯¼å…¥cjsonåº“</span></span><br><span class="line"><span class="keyword">local</span> cjson = <span class="built_in">require</span>(<span class="string">&#x27;cjson&#x27;</span>)</span><br><span class="line"><span class="comment">-- å¯¼å…¥å…±äº«è¯å…¸ï¼Œæœ¬åœ°ç¼“å­˜</span></span><br><span class="line"><span class="keyword">local</span> item_cache = ngx.shared.item_cache</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å°è£…æŸ¥è¯¢å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read_data</span><span class="params">(key, expire, path, params)</span></span></span><br><span class="line">    <span class="comment">-- æŸ¥è¯¢æœ¬åœ°ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">local</span> val = item_cache:get(key)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> val <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;æœ¬åœ°ç¼“å­˜æŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢Redisï¼Œ key: &quot;</span>, key)</span><br><span class="line">        <span class="comment">-- æŸ¥è¯¢redis</span></span><br><span class="line">        val = read_redis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>, key)</span><br><span class="line">        <span class="comment">-- åˆ¤æ–­æŸ¥è¯¢ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> val <span class="keyword">then</span></span><br><span class="line">            ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;redisæŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æŸ¥è¯¢httpï¼Œ key: &quot;</span>, key)</span><br><span class="line">            <span class="comment">-- redisæŸ¥è¯¢å¤±è´¥ï¼Œå»æŸ¥è¯¢http</span></span><br><span class="line">            val = read_http(<span class="built_in">path</span>, params)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- æŸ¥è¯¢æˆåŠŸï¼ŒæŠŠæ•°æ®å†™å…¥æœ¬åœ°ç¼“å­˜</span></span><br><span class="line">    item_cache:set(key, val, expire)</span><br><span class="line">    <span class="comment">-- è¿”å›æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è·å–è·¯å¾„å‚æ•°</span></span><br><span class="line"><span class="keyword">local</span> id = ngx.var[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å•†å“ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">local</span> itemJSON = read_data(<span class="string">&quot;item:id:&quot;</span> .. id, <span class="number">1800</span>,  <span class="string">&quot;/item/&quot;</span> .. id, <span class="literal">nil</span>)</span><br><span class="line"><span class="comment">-- æŸ¥è¯¢åº“å­˜ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">local</span> stockJSON = read_data(<span class="string">&quot;item:stock:id:&quot;</span> .. id, <span class="number">60</span>, <span class="string">&quot;/item/stock/&quot;</span> .. id, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- JSONè½¬åŒ–ä¸ºluaçš„table</span></span><br><span class="line"><span class="keyword">local</span> item = cjson.decode(itemJSON)</span><br><span class="line"><span class="keyword">local</span> stock = cjson.decode(stockJSON)</span><br><span class="line"><span class="comment">-- ç»„åˆæ•°æ®</span></span><br><span class="line">item.stock = stock.stock</span><br><span class="line">item.sold = stock.sold</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŠŠitemåºåˆ—åŒ–ä¸ºjson è¿”å›ç»“æœ</span></span><br><span class="line">ngx.say(cjson.encode(item))</span><br></pre></td></tr></table></figure><h1 id="huan-cun-tong-bu">ç¼“å­˜åŒæ­¥</h1><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨æŸ¥è¯¢åˆ°çš„éƒ½æ˜¯ç¼“å­˜æ•°æ®ï¼Œå¦‚æœç¼“å­˜æ•°æ®ä¸æ•°æ®åº“æ•°æ®å­˜åœ¨è¾ƒå¤§å·®å¼‚ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ¯”è¾ƒä¸¥é‡çš„åæœã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä¿è¯æ•°æ®åº“æ•°æ®ã€ç¼“å­˜æ•°æ®çš„ä¸€è‡´æ€§ï¼Œè¿™å°±æ˜¯ç¼“å­˜ä¸æ•°æ®åº“çš„åŒæ­¥ã€‚</p><h2 id="shu-ju-tong-bu-ce-lue" id="æ•°æ®åŒæ­¥ç­–ç•¥">æ•°æ®åŒæ­¥ç­–ç•¥</h2><p>ç¼“å­˜æ•°æ®åŒæ­¥çš„å¸¸è§æ–¹å¼æœ‰ä¸‰ç§ï¼š</p><p><strong>è®¾ç½®æœ‰æ•ˆæœŸ</strong>ï¼šç»™ç¼“å­˜è®¾ç½®æœ‰æ•ˆæœŸï¼Œåˆ°æœŸåè‡ªåŠ¨åˆ é™¤ã€‚å†æ¬¡æŸ¥è¯¢æ—¶æ›´æ–°</p><ul><li>ä¼˜åŠ¿ï¼šç®€å•ã€æ–¹ä¾¿</li><li>ç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§å·®ï¼Œç¼“å­˜è¿‡æœŸä¹‹å‰å¯èƒ½ä¸ä¸€è‡´</li><li>åœºæ™¯ï¼šæ›´æ–°é¢‘ç‡è¾ƒä½ï¼Œæ—¶æ•ˆæ€§è¦æ±‚ä½çš„ä¸šåŠ¡</li></ul><p><strong>åŒæ­¥åŒå†™</strong>ï¼šåœ¨ä¿®æ”¹æ•°æ®åº“çš„åŒæ—¶ï¼Œç›´æ¥ä¿®æ”¹ç¼“å­˜</p><ul><li>ä¼˜åŠ¿ï¼šæ—¶æ•ˆæ€§å¼ºï¼Œç¼“å­˜ä¸æ•°æ®åº“å¼ºä¸€è‡´</li><li>ç¼ºç‚¹ï¼šæœ‰ä»£ç ä¾µå…¥ï¼Œè€¦åˆåº¦é«˜ï¼›</li><li>åœºæ™¯ï¼šå¯¹ä¸€è‡´æ€§ã€æ—¶æ•ˆæ€§è¦æ±‚è¾ƒé«˜çš„ç¼“å­˜æ•°æ®</li></ul><p>**å¼‚æ­¥é€šçŸ¥ï¼š**ä¿®æ”¹æ•°æ®åº“æ—¶å‘é€äº‹ä»¶é€šçŸ¥ï¼Œç›¸å…³æœåŠ¡ç›‘å¬åˆ°é€šçŸ¥åä¿®æ”¹ç¼“å­˜æ•°æ®</p><ul><li>ä¼˜åŠ¿ï¼šä½è€¦åˆï¼Œå¯ä»¥åŒæ—¶é€šçŸ¥å¤šä¸ªç¼“å­˜æœåŠ¡</li><li>ç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§ä¸€èˆ¬ï¼Œå¯èƒ½å­˜åœ¨ä¸­é—´ä¸ä¸€è‡´çŠ¶æ€</li><li>åœºæ™¯ï¼šæ—¶æ•ˆæ€§è¦æ±‚ä¸€èˆ¬ï¼Œæœ‰å¤šä¸ªæœåŠ¡éœ€è¦åŒæ­¥</li></ul><p>è€Œå¼‚æ­¥å®ç°åˆå¯ä»¥åŸºäºMQæˆ–è€…Canalæ¥å®ç°ï¼š</p><ol><li>åŸºäºMQçš„å¼‚æ­¥é€šçŸ¥ï¼š</li></ol><p><img src="https://s1.vika.cn/space/2023/04/15/ca90f80928d44639b82e7adc2e7b6d60" alt="image-20210821115552327"></p><p>è§£è¯»ï¼š</p><ul><li>å•†å“æœåŠ¡å®Œæˆå¯¹æ•°æ®çš„ä¿®æ”¹åï¼Œåªéœ€è¦å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°MQä¸­ã€‚</li><li>ç¼“å­˜æœåŠ¡ç›‘å¬MQæ¶ˆæ¯ï¼Œç„¶åå®Œæˆå¯¹ç¼“å­˜çš„æ›´æ–°</li></ul><p>ä¾ç„¶æœ‰å°‘é‡çš„ä»£ç ä¾µå…¥ã€‚</p><ol start="2"><li>åŸºäºCanalçš„é€šçŸ¥</li></ol><p><img src="https://s1.vika.cn/space/2023/04/15/b3b330b9203146b29c95a961bed04573" alt="image-20210821115719363"></p><p>è§£è¯»ï¼š</p><ul><li>å•†å“æœåŠ¡å®Œæˆå•†å“ä¿®æ”¹åï¼Œä¸šåŠ¡ç›´æ¥ç»“æŸï¼Œæ²¡æœ‰ä»»ä½•ä»£ç ä¾µå…¥</li><li>Canalç›‘å¬MySQLå˜åŒ–ï¼Œå½“å‘ç°å˜åŒ–åï¼Œç«‹å³é€šçŸ¥ç¼“å­˜æœåŠ¡</li><li>ç¼“å­˜æœåŠ¡æ¥æ”¶åˆ°canalé€šçŸ¥ï¼Œæ›´æ–°ç¼“å­˜</li></ul><p>ä»£ç é›¶ä¾µå…¥</p><h2 id="an-zhuang-canal" id="å®‰è£…Canal">å®‰è£…Canal</h2><h3 id="ren-shi-canal" id="è®¤è¯†Canal">è®¤è¯†Canal</h3><p><strong>Canal [kÉ™â€™nÃ¦l]</strong>ï¼Œè¯‘æ„ä¸ºæ°´é“/ç®¡é“/æ²Ÿæ¸ ï¼Œcanalæ˜¯é˜¿é‡Œå·´å·´æ——ä¸‹çš„ä¸€æ¬¾å¼€æºé¡¹ç›®ï¼ŒåŸºäºJavaå¼€å‘ã€‚åŸºäºæ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œæä¾›å¢é‡æ•°æ®è®¢é˜…&amp;æ¶ˆè´¹ã€‚</p><ul><li><p>GitHubçš„åœ°å€ï¼š<a href="https://github.com/alibaba/canal">https://github.com/alibaba/canal</a></p></li><li><p>Canalæ˜¯åŸºäºmysqlçš„ä¸»ä»åŒæ­¥æ¥å®ç°çš„ï¼ŒMySQLä¸»ä»åŒæ­¥çš„åŸç†å¦‚ä¸‹ï¼š</p></li></ul><p><img src="https://s1.vika.cn/space/2023/04/15/7e721c3a90b44f0897785572546b6164" alt="image-20210821115914748"></p><ul><li>MySQL master å°†æ•°æ®å˜æ›´å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—( binary logï¼‰ï¼Œå…¶ä¸­è®°å½•çš„æ•°æ®å«åšbinary log events</li><li>MySQL slave å°† master çš„ binary log eventsæ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—(relay log)</li><li>MySQL slave é‡æ”¾ relay log ä¸­äº‹ä»¶ï¼Œå°†æ•°æ®å˜æ›´åæ˜ å®ƒè‡ªå·±çš„æ•°æ®</li></ul><p>è€ŒCanalå°±æ˜¯æŠŠè‡ªå·±ä¼ªè£…æˆMySQLçš„ä¸€ä¸ªslaveèŠ‚ç‚¹ï¼Œä»è€Œç›‘å¬masterçš„binary logå˜åŒ–ã€‚å†æŠŠå¾—åˆ°çš„å˜åŒ–ä¿¡æ¯é€šçŸ¥ç»™Canalçš„å®¢æˆ·ç«¯ï¼Œè¿›è€Œå®Œæˆå¯¹å…¶å®ƒæ•°æ®åº“çš„åŒæ­¥ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/15/ee8f6251c8994334b18c7087cc67f408" alt="image-20210821115948395"></p><p>ä¸‹é¢æˆ‘ä»¬å°±å¼€å¯mysqlçš„ä¸»ä»åŒæ­¥æœºåˆ¶ï¼Œè®©Canalæ¥æ¨¡æ‹Ÿsalve</p><h3 id="kai-qi-my-sql-zhu-cong" id="å¼€å¯MySQLä¸»ä»">å¼€å¯MySQLä¸»ä»</h3><p>Canalæ˜¯åŸºäºMySQLçš„ä¸»ä»åŒæ­¥åŠŸèƒ½ï¼Œå› æ­¤å¿…é¡»å…ˆå¼€å¯MySQLçš„ä¸»ä»åŠŸèƒ½æ‰å¯ä»¥ã€‚</p><p>è¿™é‡Œä»¥ä¹‹å‰ç”¨Dockerè¿è¡Œçš„mysqlä¸ºä¾‹ï¼š</p><p><strong>å¼€å¯binlog</strong></p><ol><li>æ‰“å¼€mysqlå®¹å™¨æŒ‚è½½çš„æ—¥å¿—æ–‡ä»¶ï¼Œæˆ‘çš„åœ¨<code>/tmp/mysql/conf</code>ç›®å½•:</li></ol><p><img src="https://s1.vika.cn/space/2023/04/15/247548fb3320463da091ca8da2bf3e69" alt="image-20210813153241537"></p><ol start="2"><li>ä¿®æ”¹æ–‡ä»¶ï¼š</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /tmp/mysql/conf/my.cnf</span><br></pre></td></tr></table></figure><ol start="3"><li>æ·»åŠ å†…å®¹ï¼š</li></ol><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log-bin</span>=/var/lib/mysql/mysql-bin</span><br><span class="line"><span class="attr">binlog-do-db</span>=heima</span><br></pre></td></tr></table></figure><ol start="4"><li>é…ç½®è§£è¯»ï¼š</li></ol><ul><li><code>log-bin=/var/lib/mysql/mysql-bin</code>ï¼šè®¾ç½®binary logæ–‡ä»¶çš„å­˜æ”¾åœ°å€å’Œæ–‡ä»¶åï¼Œå«åšmysql-bin</li><li><code>binlog-do-db=heima</code>ï¼šæŒ‡å®šå¯¹å“ªä¸ªdatabaseè®°å½•binary log eventsï¼Œè¿™é‡Œè®°å½•heimaè¿™ä¸ªåº“</li></ul><ol start="5"><li>æœ€ç»ˆæ•ˆæœï¼š</li></ol><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line">skip-name-resolve</span><br><span class="line"><span class="attr">character_set_server</span>=utf8</span><br><span class="line"><span class="attr">datadir</span>=/var/lib/mysql</span><br><span class="line"><span class="attr">server-id</span>=<span class="number">1000</span></span><br><span class="line"><span class="attr">log-bin</span>=/var/lib/mysql/mysql-bin</span><br><span class="line"><span class="attr">binlog-do-db</span>=heima</span><br></pre></td></tr></table></figure><h3 id="she-zhi-yong-hu-quan-xian" id="è®¾ç½®ç”¨æˆ·æƒé™">è®¾ç½®ç”¨æˆ·æƒé™</h3><ol><li>æ¥ä¸‹æ¥æ·»åŠ ä¸€ä¸ªä»…ç”¨äºæ•°æ®åŒæ­¥çš„è´¦æˆ·ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œè¿™é‡Œä»…æä¾›å¯¹heimaè¿™ä¸ªåº“çš„æ“ä½œæƒé™ã€‚</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create user canal@&#x27;%&#x27; IDENTIFIED by &#x27;canal&#x27;;</span><br><span class="line">GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT,SUPER ON *.* TO &#x27;canal&#x27;@&#x27;%&#x27; identified by &#x27;canal&#x27;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><ol start="2"><li>é‡å¯mysqlå®¹å™¨å³å¯</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart mysql</span><br></pre></td></tr></table></figure><ol start="3"><li>æµ‹è¯•è®¾ç½®æ˜¯å¦æˆåŠŸï¼šåœ¨mysqlæ§åˆ¶å°ï¼Œæˆ–è€…Navicatä¸­ï¼Œè¾“å…¥å‘½ä»¤ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure><p><img src="D:/ProgramData/Java-Source/9%E3%80%81SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/day11-%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/%E8%B5%84%E6%96%99/assets/image-20200327094735948.png" alt="image-20200327094735948"></p><h3 id="chuang-jian-wang-luo" id="åˆ›å»ºç½‘ç»œ">åˆ›å»ºç½‘ç»œ</h3><p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼Œå°†MySQLã€Canalã€MQæ”¾åˆ°åŒä¸€ä¸ªDockerç½‘ç»œä¸­ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create heima</span><br></pre></td></tr></table></figure><p>è®©mysqlåŠ å…¥è¿™ä¸ªç½‘ç»œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect heima mysql</span><br></pre></td></tr></table></figure><h3 id="an-zhuang-canal-1" id="å®‰è£…Canal-2">å®‰è£…Canal</h3><p>è¯¾å‰èµ„æ–™ä¸­æä¾›äº†canalçš„é•œåƒå‹ç¼©åŒ…:</p><ul><li>å¤§å®¶å¯ä»¥ä¸Šä¼ åˆ°è™šæ‹Ÿæœºï¼Œç„¶åé€šè¿‡å‘½ä»¤å¯¼å…¥ï¼š</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load -<span class="selector-tag">i</span> canal<span class="selector-class">.tar</span></span><br></pre></td></tr></table></figure><ul><li>ç„¶åè¿è¡Œå‘½ä»¤åˆ›å»ºCanalå®¹å™¨ï¼š</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 11111:11111 --name canal \</span><br><span class="line">-e canal.destinations=heima \</span><br><span class="line">-e canal.instance.master.address=mysql:3306  \</span><br><span class="line">-e canal.instance.dbUsername=canal  \</span><br><span class="line">-e canal.instance.dbPassword=canal  \</span><br><span class="line">-e canal.instance.connectionCharset=UTF-8 \</span><br><span class="line">-e canal.instance.tsdb.enable=<span class="literal">true</span> \</span><br><span class="line">-e canal.instance.gtidon=<span class="literal">false</span>  \</span><br><span class="line">-e canal.instance.filter.regex=heima\\..* \</span><br><span class="line">--network heima \</span><br><span class="line">-d canal/canal-server:v1.1.5</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>:</p><ul><li><code>-p 11111:11111</code>ï¼šè¿™æ˜¯canalçš„é»˜è®¤ç›‘å¬ç«¯å£</li><li><code>-e canal.instance.master.address=mysql:3306</code>ï¼šæ•°æ®åº“åœ°å€å’Œç«¯å£ï¼Œå¦‚æœä¸çŸ¥é“mysqlå®¹å™¨åœ°å€ï¼Œå¯ä»¥é€šè¿‡<code>docker inspect å®¹å™¨id</code>æ¥æŸ¥çœ‹</li><li><code>-e canal.instance.dbUsername=canal</code>ï¼šæ•°æ®åº“ç”¨æˆ·å</li><li><code>-e canal.instance.dbPassword=canal</code> ï¼šæ•°æ®åº“å¯†ç </li><li><code>-e canal.instance.filter.regex=</code>ï¼šè¦ç›‘å¬çš„è¡¨åç§°</li></ul><p>è¡¨åç§°ç›‘å¬æ”¯æŒçš„è¯­æ³•ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql æ•°æ®è§£æå…³æ³¨çš„è¡¨ï¼ŒPerlæ­£åˆ™è¡¨è¾¾å¼.</span><br><span class="line">å¤šä¸ªæ­£åˆ™ä¹‹é—´ä»¥é€—å·(,)åˆ†éš”ï¼Œè½¬ä¹‰ç¬¦éœ€è¦åŒæ–œæ (\\) </span><br><span class="line">å¸¸è§ä¾‹å­ï¼š</span><br><span class="line"><span class="bullet">1.</span>  æ‰€æœ‰è¡¨ï¼š.*   or  .<span class="emphasis">*\\..*</span></span><br><span class="line"><span class="bullet">2.</span>  canal schemaä¸‹æ‰€æœ‰è¡¨ï¼š canal\\..*</span><br><span class="line"><span class="bullet">3.</span>  canalä¸‹çš„ä»¥canalæ‰“å¤´çš„è¡¨ï¼šcanal\\.canal.*</span><br><span class="line"><span class="bullet">4.</span>  canal schemaä¸‹çš„ä¸€å¼ è¡¨ï¼šcanal.test1</span><br><span class="line"><span class="bullet">5.</span>  å¤šä¸ªè§„åˆ™ç»„åˆä½¿ç”¨ç„¶åä»¥é€—å·éš”å¼€ï¼šcanal\\..<span class="emphasis">*,mysql.test1,mysql.test2 </span></span><br></pre></td></tr></table></figure><h2 id="jian-ting-canal" id="ç›‘å¬Canal">ç›‘å¬Canal</h2><p>Canalæä¾›äº†å„ç§è¯­è¨€çš„å®¢æˆ·ç«¯ï¼Œå½“Canalç›‘å¬åˆ°binlogå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥Canalçš„å®¢æˆ·ç«¯ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/15/a6217ca1bb3646dc8e8995cffc44750b" alt="image-20210821120049024"></p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Canalæä¾›çš„Javaå®¢æˆ·ç«¯ï¼Œç›‘å¬Canalé€šçŸ¥æ¶ˆæ¯ã€‚å½“æ”¶åˆ°å˜åŒ–çš„æ¶ˆæ¯æ—¶ï¼Œå®Œæˆå¯¹ç¼“å­˜çš„æ›´æ–°ã€‚</p><ul><li><p>ä¸è¿‡è¿™é‡Œæˆ‘ä»¬ä¼šä½¿ç”¨GitHubä¸Šçš„ç¬¬ä¸‰æ–¹å¼€æºçš„canal-starterå®¢æˆ·ç«¯ã€‚åœ°å€ï¼š<a href="https://github.com/NormanGyllenhaal/canal-client">https://github.com/NormanGyllenhaal/canal-client</a></p></li><li><p>ä¸SpringBootå®Œç¾æ•´åˆï¼Œè‡ªåŠ¨è£…é…ï¼Œæ¯”å®˜æ–¹å®¢æˆ·ç«¯è¦ç®€å•å¥½ç”¨å¾ˆå¤šã€‚</p></li></ul><h3 id="yin-ru-yi-lai" id="å¼•å…¥ä¾èµ–ï¼š">å¼•å…¥ä¾èµ–ï¼š</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.javatool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>canal-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1-RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="bian-xie-pei-zhi" id="ç¼–å†™é…ç½®ï¼š">ç¼–å†™é…ç½®ï¼š</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">canal:</span></span><br><span class="line">  <span class="attr">destination:</span> <span class="string">heima</span> <span class="comment"># canalçš„é›†ç¾¤åå­—ï¼Œè¦ä¸å®‰è£…canalæ—¶è®¾ç½®çš„åç§°ä¸€è‡´</span></span><br><span class="line">  <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span><span class="string">:11111</span> <span class="comment"># canalæœåŠ¡åœ°å€</span></span><br></pre></td></tr></table></figure><h3 id="xiu-gai-item-shi-ti-lei" id="ä¿®æ”¹Itemå®ä½“ç±»">ä¿®æ”¹Itemå®ä½“ç±»</h3><p>é€šè¿‡@Idã€@Columnã€ç­‰æ³¨è§£å®ŒæˆItemä¸æ•°æ®åº“è¡¨å­—æ®µçš„æ˜ å°„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.heima.item.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Transient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;tb_item&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Item</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;<span class="comment">//å•†å“id</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;<span class="comment">//å•†å“åç§°</span></span><br><span class="line">    <span class="keyword">private</span> String title;<span class="comment">//å•†å“æ ‡é¢˜</span></span><br><span class="line">    <span class="keyword">private</span> Long price;<span class="comment">//ä»·æ ¼ï¼ˆåˆ†ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> String image;<span class="comment">//å•†å“å›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">private</span> String category;<span class="comment">//åˆ†ç±»åç§°</span></span><br><span class="line">    <span class="keyword">private</span> String brand;<span class="comment">//å“ç‰Œåç§°</span></span><br><span class="line">    <span class="keyword">private</span> String spec;<span class="comment">//è§„æ ¼</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;<span class="comment">//å•†å“çŠ¶æ€ 1-æ­£å¸¸ï¼Œ2-ä¸‹æ¶</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;<span class="comment">//åˆ›å»ºæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;<span class="comment">//æ›´æ–°æ—¶é—´</span></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> Integer stock;</span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> Integer sold;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="bian-xie-jian-ting-qi" id="ç¼–å†™ç›‘å¬å™¨">ç¼–å†™ç›‘å¬å™¨</h3><p>é€šè¿‡å®ç°<code>EntryHandler&lt;T&gt;</code>æ¥å£ç¼–å†™ç›‘å¬å™¨ï¼Œç›‘å¬Canalæ¶ˆæ¯ã€‚æ³¨æ„ä¸¤ç‚¹ï¼š</p><ul><li>å®ç°ç±»é€šè¿‡<code>@CanalTable(&quot;tb_item&quot;)</code>æŒ‡å®šç›‘å¬çš„è¡¨ä¿¡æ¯</li><li>EntryHandlerçš„æ³›å‹æ˜¯ä¸è¡¨å¯¹åº”çš„å®ä½“ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.heima.item.canal;</span><br><span class="line"></span><br><span class="line"><span class="meta">@CanalTable(&quot;tb_item&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemHandler</span> <span class="keyword">implements</span> <span class="title class_">EntryHandler</span>&lt;Item&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisHandler redisHandler;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Cache&lt;Long, Item&gt; itemCache;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Item item)</span> &#123;</span><br><span class="line">        <span class="comment">// å†™æ•°æ®åˆ°JVMè¿›ç¨‹ç¼“å­˜</span></span><br><span class="line">        itemCache.put(item.getId(), item);</span><br><span class="line">        <span class="comment">// å†™æ•°æ®åˆ°redis</span></span><br><span class="line">        redisHandler.saveItem(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Item before, Item after)</span> &#123;</span><br><span class="line">        <span class="comment">// å†™æ•°æ®åˆ°JVMè¿›ç¨‹ç¼“å­˜</span></span><br><span class="line">        itemCache.put(after.getId(), after);</span><br><span class="line">        <span class="comment">// å†™æ•°æ®åˆ°redis</span></span><br><span class="line">        redisHandler.saveItem(after);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Item item)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ é™¤æ•°æ®åˆ°JVMè¿›ç¨‹ç¼“å­˜</span></span><br><span class="line">        itemCache.invalidate(item.getId());</span><br><span class="line">        <span class="comment">// åˆ é™¤æ•°æ®åˆ°redis</span></span><br><span class="line">        redisHandler.deleteItemById(item.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå¯¹Redisçš„æ“ä½œéƒ½å°è£…åˆ°äº†RedisHandlerè¿™ä¸ªå¯¹è±¡ä¸­ï¼Œæ˜¯æˆ‘ä»¬ä¹‹å‰åšç¼“å­˜é¢„çƒ­æ—¶ç¼–å†™çš„ä¸€ä¸ªç±»ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.heima.item.config;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisHandler</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IItemService itemService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IItemStockService stockService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">MAPPER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ç¼“å­˜</span></span><br><span class="line">        <span class="comment">// 1.æŸ¥è¯¢å•†å“ä¿¡æ¯</span></span><br><span class="line">        List&lt;Item&gt; itemList = itemService.list();</span><br><span class="line">        <span class="comment">// 2.æ”¾å…¥ç¼“å­˜</span></span><br><span class="line">        <span class="keyword">for</span> (Item item : itemList) &#123;</span><br><span class="line">            <span class="comment">// 2.1.itemåºåˆ—åŒ–ä¸ºJSON</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> MAPPER.writeValueAsString(item);</span><br><span class="line">            <span class="comment">// 2.2.å­˜å…¥redis</span></span><br><span class="line">            redisTemplate.opsForValue().set(<span class="string">&quot;item:id:&quot;</span> + item.getId(), json);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.æŸ¥è¯¢å•†å“åº“å­˜ä¿¡æ¯</span></span><br><span class="line">        List&lt;ItemStock&gt; stockList = stockService.list();</span><br><span class="line">        <span class="comment">// 4.æ”¾å…¥ç¼“å­˜</span></span><br><span class="line">        <span class="keyword">for</span> (ItemStock stock : stockList) &#123;</span><br><span class="line">            <span class="comment">// 2.1.itemåºåˆ—åŒ–ä¸ºJSON</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> MAPPER.writeValueAsString(stock);</span><br><span class="line">            <span class="comment">// 2.2.å­˜å…¥redis</span></span><br><span class="line">            redisTemplate.opsForValue().set(<span class="string">&quot;item:stock:id:&quot;</span> + stock.getId(), json);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveItem</span><span class="params">(Item item)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> MAPPER.writeValueAsString(item);</span><br><span class="line">            redisTemplate.opsForValue().set(<span class="string">&quot;item:id:&quot;</span> + item.getId(), json);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteItemById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        redisTemplate.delete(<span class="string">&quot;item:id:&quot;</span> + id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Caffeine(JVMè¿›ç¨‹ç¼“å­˜), Lua, OpenResty(nginx), Canal(ç¼“å­˜åŒæ­¥)</summary>
    
    
    
    <category term="Java" scheme="https://www.taoyaopc.live/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>Redisåˆ†å¸ƒå¼ç¼“å­˜</title>
    <link href="https://www.taoyaopc.live/posts/d4758cbd.html"/>
    <id>https://www.taoyaopc.live/posts/d4758cbd.html</id>
    <published>2023-04-05T07:30:00.000Z</published>
    <updated>2023-04-06T13:23:07.931Z</updated>
    
    <content type="html"><![CDATA[<h1 id="fen-bu-shi-huan-cun">åˆ†å¸ƒå¼ç¼“å­˜</h1><ul><li>åŸºäºRedisé›†ç¾¤è§£å†³å•æœºRediså­˜åœ¨çš„é—®é¢˜</li></ul><p>å•æœºçš„Rediså­˜åœ¨å››å¤§é—®é¢˜ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/83fc4bd60b3f49969c8c2b1c0a87aec4" alt="image-20210725144240631"></p><h1 id="dan-ji-an-zhuang-redis">å•æœºå®‰è£…Redis</h1><ol><li>é¦–å…ˆéœ€è¦å®‰è£…Redisæ‰€éœ€è¦çš„ä¾èµ–ï¼š</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc tcl</span><br></pre></td></tr></table></figure><ol start="2"><li><p>ç„¶åå°†è¯¾å‰èµ„æ–™æä¾›çš„Rediså®‰è£…åŒ…ä¸Šä¼ åˆ°è™šæ‹Ÿæœºçš„ä»»æ„ç›®å½•ï¼š</p></li><li><p>è§£å‹ç¼©ï¼š</p></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf redis-6.2.4.tar.gz</span><br></pre></td></tr></table></figure><ol start="4"><li>è§£å‹åè¿›å…¥redisç›®å½•ï¼š</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> redis-6.2.4</span><br></pre></td></tr></table></figure><ol start="5"><li>è¿è¡Œç¼–è¯‘å‘½ä»¤ï¼š</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰å‡ºé”™ï¼Œåº”è¯¥å°±å®‰è£…æˆåŠŸäº†ã€‚</p><ol start="6"><li>ç„¶åä¿®æ”¹redis.confæ–‡ä»¶ä¸­çš„ä¸€äº›é…ç½®ï¼š</li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»‘å®šåœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1ï¼Œä¼šå¯¼è‡´åªèƒ½åœ¨æœ¬åœ°è®¿é—®ã€‚ä¿®æ”¹ä¸º0.0.0.0åˆ™å¯ä»¥åœ¨ä»»æ„IPè®¿é—®</span></span><br><span class="line"><span class="attr">bind</span> <span class="string">0.0.0.0</span></span><br><span class="line"><span class="comment"># æ•°æ®åº“æ•°é‡ï¼Œè®¾ç½®ä¸º1</span></span><br><span class="line"><span class="attr">databases</span> <span class="string">1</span></span><br></pre></td></tr></table></figure><ol start="7"><li>å¯åŠ¨Redisï¼š</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis.conf</span><br></pre></td></tr></table></figure><ol start="8"><li>åœæ­¢redisæœåŠ¡ï¼š</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli shutdown</span><br></pre></td></tr></table></figure><h1 id="redis-chi-jiu-hua">RedisæŒä¹…åŒ–</h1><p>Redisæœ‰ä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆï¼š</p><ul><li>RDBæŒä¹…åŒ–</li><li>AOFæŒä¹…åŒ–</li></ul><h2 id="rdb-chi-jiu-hua" id="RDBæŒä¹…åŒ–">RDBæŒä¹…åŒ–</h2><p>RDBå…¨ç§°Redis Database Backup fileï¼ˆRedisæ•°æ®å¤‡ä»½æ–‡ä»¶ï¼‰ï¼Œ</p><ul><li><p>ä¹Ÿè¢«å«åšRedisæ•°æ®å¿«ç…§ã€‚</p></li><li><p>ç®€å•æ¥è¯´å°±æ˜¯æŠŠå†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è®°å½•åˆ°ç£ç›˜ä¸­ã€‚</p></li><li><p>å½“Rediså®ä¾‹æ•…éšœé‡å¯åï¼Œä»ç£ç›˜è¯»å–å¿«ç…§æ–‡ä»¶ï¼Œæ¢å¤æ•°æ®ã€‚å¿«ç…§æ–‡ä»¶ç§°ä¸ºRDBæ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ä¿å­˜åœ¨å½“å‰è¿è¡Œç›®å½•ã€‚</p></li></ul><h3 id="zhi-xing-shi-ji" id="æ‰§è¡Œæ—¶æœº">æ‰§è¡Œæ—¶æœº</h3><p>RDBæŒä¹…åŒ–åœ¨å››ç§æƒ…å†µä¸‹ä¼šæ‰§è¡Œï¼š</p><ul><li>æ‰§è¡Œsaveå‘½ä»¤</li><li>æ‰§è¡Œbgsaveå‘½ä»¤</li><li>Redisåœæœºæ—¶</li><li>è§¦å‘RDBæ¡ä»¶æ—¶</li></ul><p><strong>1ï¼‰saveå‘½ä»¤</strong></p><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¯ä»¥ç«‹å³æ‰§è¡Œä¸€æ¬¡RDBï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/a7399982adea4996aa88ac6515b85c5b" alt="image-20210725144536958"></p><p>saveå‘½ä»¤ä¼šå¯¼è‡´ä¸»è¿›ç¨‹æ‰§è¡ŒRDBï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å…¶å®ƒæ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«é˜»å¡ã€‚åªæœ‰åœ¨æ•°æ®è¿ç§»æ—¶å¯èƒ½ç”¨åˆ°ã€‚</p><p><strong>2ï¼‰bgsaveå‘½ä»¤</strong></p><p>ä¸‹é¢çš„å‘½ä»¤å¯ä»¥å¼‚æ­¥æ‰§è¡ŒRDBï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/6212fbf749fc4ef28ab720b3aa5930f3" alt="image-20210725144725943"></p><p>è¿™ä¸ªå‘½ä»¤æ‰§è¡Œåä¼šå¼€å¯ç‹¬ç«‹è¿›ç¨‹å®ŒæˆRDBï¼Œä¸»è¿›ç¨‹å¯ä»¥æŒç»­å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œä¸å—å½±å“ã€‚</p><p><strong>3ï¼‰åœæœºæ—¶</strong></p><p>Redisåœæœºæ—¶ä¼šæ‰§è¡Œä¸€æ¬¡saveå‘½ä»¤ï¼Œå®ç°RDBæŒä¹…åŒ–ã€‚</p><p><strong>4ï¼‰è§¦å‘RDBæ¡ä»¶</strong></p><p>Rediså†…éƒ¨æœ‰è§¦å‘RDBçš„æœºåˆ¶ï¼Œå¯ä»¥åœ¨redis.confæ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 900ç§’å†…ï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyè¢«ä¿®æ”¹ï¼Œåˆ™æ‰§è¡Œbgsave ï¼Œ å¦‚æœæ˜¯save &quot;&quot; åˆ™è¡¨ç¤ºç¦ç”¨RDB</span></span><br><span class="line"><span class="attr">save</span> <span class="string">900 1  </span></span><br><span class="line"><span class="attr">save</span> <span class="string">300 10  </span></span><br><span class="line"><span class="attr">save</span> <span class="string">60 10000 </span></span><br></pre></td></tr></table></figure><p>RDBçš„å…¶å®ƒé…ç½®ä¹Ÿå¯ä»¥åœ¨redis.confæ–‡ä»¶ä¸­è®¾ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¯å¦å‹ç¼© ,å»ºè®®ä¸å¼€å¯ï¼Œå‹ç¼©ä¹Ÿä¼šæ¶ˆè€—cpuï¼Œç£ç›˜çš„è¯ä¸å€¼é’±</span></span><br><span class="line"><span class="attr">rdbcompression</span> <span class="string">yes</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># RDBæ–‡ä»¶åç§°</span></span><br><span class="line"><span class="attr">dbfilename</span> <span class="string">dump.rdb  </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># æ–‡ä»¶ä¿å­˜çš„è·¯å¾„ç›®å½•</span></span><br><span class="line"><span class="attr">dir</span> <span class="string">./ </span></span><br></pre></td></tr></table></figure><h3 id="rdb-yuan-li" id="RDBåŸç†">RDBåŸç†</h3><p>bgsaveå¼€å§‹æ—¶ä¼šforkä¸»è¿›ç¨‹å¾—åˆ°å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å…±äº«ä¸»è¿›ç¨‹çš„å†…å­˜æ•°æ®ã€‚å®Œæˆforkåè¯»å–å†…å­˜æ•°æ®å¹¶å†™å…¥ RDB æ–‡ä»¶ã€‚</p><p>forké‡‡ç”¨çš„æ˜¯copy-on-writeæŠ€æœ¯ï¼š</p><ul><li>å½“ä¸»è¿›ç¨‹æ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œè®¿é—®å…±äº«å†…å­˜ï¼›</li><li>å½“ä¸»è¿›ç¨‹æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œåˆ™ä¼šæ‹·è´ä¸€ä»½æ•°æ®ï¼Œæ‰§è¡Œå†™æ“ä½œã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/03/19/c506f7e9759d4d22bed9feaad539d408" alt="image-20210725151319695"></p><h3 id="xiao-jie" id="å°ç»“">å°ç»“</h3><p>RDBæ–¹å¼bgsaveçš„åŸºæœ¬æµç¨‹ï¼Ÿ</p><ul><li>forkä¸»è¿›ç¨‹å¾—åˆ°ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå…±äº«å†…å­˜ç©ºé—´</li><li>å­è¿›ç¨‹è¯»å–å†…å­˜æ•°æ®å¹¶å†™å…¥æ–°çš„RDBæ–‡ä»¶</li><li>ç”¨æ–°RDBæ–‡ä»¶æ›¿æ¢æ—§çš„RDBæ–‡ä»¶</li></ul><p>RDBä¼šåœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿsave 60 1000ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ</p><ul><li>é»˜è®¤æ˜¯æœåŠ¡åœæ­¢æ—¶</li><li>ä»£è¡¨60ç§’å†…è‡³å°‘æ‰§è¡Œ1000æ¬¡ä¿®æ”¹åˆ™è§¦å‘RDB</li></ul><p>RDBçš„ç¼ºç‚¹ï¼Ÿ</p><ul><li>RDBæ‰§è¡Œé—´éš”æ—¶é—´é•¿ï¼Œä¸¤æ¬¡RDBä¹‹é—´å†™å…¥æ•°æ®æœ‰ä¸¢å¤±çš„é£é™©</li><li>forkå­è¿›ç¨‹ã€å‹ç¼©ã€å†™å‡ºRDBæ–‡ä»¶éƒ½æ¯”è¾ƒè€—æ—¶</li></ul><h2 id="aof-chi-jiu-hua" id="AOFæŒä¹…åŒ–">AOFæŒä¹…åŒ–</h2><h3 id="aof-yuan-li" id="AOFåŸç†">AOFåŸç†</h3><p>AOFå…¨ç§°ä¸ºAppend Only Fileï¼ˆè¿½åŠ æ–‡ä»¶ï¼‰ã€‚Rediså¤„ç†çš„æ¯ä¸€ä¸ªå†™å‘½ä»¤éƒ½ä¼šè®°å½•åœ¨AOFæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åšæ˜¯å‘½ä»¤æ—¥å¿—æ–‡ä»¶ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/19/7171c00eeae54823916d3323efafafe9" alt="image-20210725151543640"></p><h3 id="aof-pei-zhi" id="AOFé…ç½®">AOFé…ç½®</h3><p>AOFé»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦ä¿®æ”¹redis.confé…ç½®æ–‡ä»¶æ¥å¼€å¯AOFï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¯å¦å¼€å¯AOFåŠŸèƒ½ï¼Œé»˜è®¤æ˜¯no</span></span><br><span class="line"><span class="attr">appendonly</span> <span class="string">yes</span></span><br><span class="line"><span class="comment"># AOFæ–‡ä»¶çš„åç§°</span></span><br><span class="line"><span class="attr">appendfilename</span> <span class="string">&quot;appendonly.aof&quot;</span></span><br></pre></td></tr></table></figure><p>AOFçš„å‘½ä»¤è®°å½•çš„é¢‘ç‡ä¹Ÿå¯ä»¥é€šè¿‡redis.confæ–‡ä»¶æ¥é…ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¡¨ç¤ºæ¯æ‰§è¡Œä¸€æ¬¡å†™å‘½ä»¤ï¼Œç«‹å³è®°å½•åˆ°AOFæ–‡ä»¶</span></span><br><span class="line"><span class="attr">appendfsync</span> <span class="string">always </span></span><br><span class="line"><span class="comment"># å†™å‘½ä»¤æ‰§è¡Œå®Œå…ˆæ”¾å…¥AOFç¼“å†²åŒºï¼Œç„¶åè¡¨ç¤ºæ¯éš”1ç§’å°†ç¼“å†²åŒºæ•°æ®å†™åˆ°AOFæ–‡ä»¶ï¼Œæ˜¯é»˜è®¤æ–¹æ¡ˆ</span></span><br><span class="line"><span class="attr">appendfsync</span> <span class="string">everysec </span></span><br><span class="line"><span class="comment"># å†™å‘½ä»¤æ‰§è¡Œå®Œå…ˆæ”¾å…¥AOFç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜</span></span><br><span class="line"><span class="attr">appendfsync</span> <span class="string">no</span></span><br></pre></td></tr></table></figure><p>ä¸‰ç§ç­–ç•¥å¯¹æ¯”ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/5579e75b3033497bbab5712f3267fd20" alt="image-20210725151654046"></p><h3 id="aof-wen-jian-zhong-xie" id="AOFæ–‡ä»¶é‡å†™">AOFæ–‡ä»¶é‡å†™</h3><p>å› ä¸ºæ˜¯è®°å½•å‘½ä»¤ï¼ŒAOFæ–‡ä»¶ä¼šæ¯”RDBæ–‡ä»¶å¤§çš„å¤šã€‚</p><ul><li>è€Œä¸”AOFä¼šè®°å½•å¯¹åŒä¸€ä¸ªkeyçš„å¤šæ¬¡å†™æ“ä½œï¼Œä½†åªæœ‰æœ€åä¸€æ¬¡å†™æ“ä½œæ‰æœ‰æ„ä¹‰ã€‚</li><li>é€šè¿‡æ‰§è¡Œ<code>bgrewriteaof</code>å‘½ä»¤ï¼Œå¯ä»¥è®©AOFæ–‡ä»¶æ‰§è¡Œé‡å†™åŠŸèƒ½ï¼Œç”¨æœ€å°‘çš„å‘½ä»¤è¾¾åˆ°ç›¸åŒæ•ˆæœã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/03/19/96949e3df0c74760b661c89c66632abf" alt="image-20210725151729118"></p><p>å¦‚å›¾ï¼ŒAOFåŸæœ¬æœ‰ä¸‰ä¸ªå‘½ä»¤ï¼Œä½†æ˜¯<code>set num 123 å’Œ set num 666</code>éƒ½æ˜¯å¯¹numçš„æ“ä½œï¼Œç¬¬äºŒæ¬¡ä¼šè¦†ç›–ç¬¬ä¸€æ¬¡çš„å€¼ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªå‘½ä»¤è®°å½•ä¸‹æ¥æ²¡æœ‰æ„ä¹‰ã€‚</p><ul><li>æ‰€ä»¥é‡å†™å‘½ä»¤åï¼ŒAOFæ–‡ä»¶å†…å®¹å°±æ˜¯ï¼š<code>mset name jack num 666</code></li></ul><p>Redisä¹Ÿä¼šåœ¨è§¦å‘é˜ˆå€¼æ—¶è‡ªåŠ¨å»é‡å†™AOFæ–‡ä»¶ã€‚é˜ˆå€¼ä¹Ÿå¯ä»¥åœ¨redis.confä¸­é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># AOFæ–‡ä»¶æ¯”ä¸Šæ¬¡æ–‡ä»¶ å¢é•¿è¶…è¿‡å¤šå°‘ç™¾åˆ†æ¯”åˆ™è§¦å‘é‡å†™</span></span><br><span class="line"><span class="attr">auto-aof-rewrite-percentage</span> <span class="string">100</span></span><br><span class="line"><span class="comment"># AOFæ–‡ä»¶ä½“ç§¯æœ€å°å¤šå¤§ä»¥ä¸Šæ‰è§¦å‘é‡å†™ </span></span><br><span class="line"><span class="attr">auto-aof-rewrite-min-size</span> <span class="string">64mb </span></span><br></pre></td></tr></table></figure><h2 id="rdb-yu-aof-dui-bi" id="RDBä¸AOFå¯¹æ¯”">RDBä¸AOFå¯¹æ¯”</h2><p>RDBå’ŒAOFå„æœ‰è‡ªå·±çš„ä¼˜ç¼ºç‚¹ï¼Œå¦‚æœå¯¹æ•°æ®å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜ï¼Œåœ¨å®é™…å¼€å‘ä¸­å¾€å¾€ä¼š<strong>ç»“åˆ</strong>ä¸¤è€…æ¥ä½¿ç”¨ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/19/4937a43a1eb5420c8a55189e84f86c9a" alt="image-20210725151940515"></p><h1 id="redis-zhu-cong">Redisä¸»ä»</h1><h2 id="da-jian-zhu-cong-jia-gou" id="æ­å»ºä¸»ä»æ¶æ„">æ­å»ºä¸»ä»æ¶æ„</h2><p>å•èŠ‚ç‚¹Redisçš„å¹¶å‘èƒ½åŠ›æ˜¯æœ‰ä¸Šé™çš„ï¼Œè¦è¿›ä¸€æ­¥æé«˜Redisçš„å¹¶å‘èƒ½åŠ›ï¼Œå°±éœ€è¦æ­å»ºä¸»ä»é›†ç¾¤ï¼Œå®ç°è¯»å†™åˆ†ç¦»ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/19/f985eb9cd39f4b4ea7e1567b88801c8b" alt="image-20210725152037611"></p><p>å…±åŒ…å«ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œä¸¤ä¸ªä»èŠ‚ç‚¹ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¼šåœ¨åŒä¸€å°è™šæ‹Ÿæœºä¸­å¼€å¯3ä¸ªrediså®ä¾‹ï¼Œæ¨¡æ‹Ÿä¸»ä»é›†ç¾¤ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:center">IP</th><th style="text-align:center">PORT</th><th style="text-align:center">è§’è‰²</th></tr></thead><tbody><tr><td style="text-align:center">192.168.150.101</td><td style="text-align:center">7001</td><td style="text-align:center">master</td></tr><tr><td style="text-align:center">192.168.150.101</td><td style="text-align:center">7002</td><td style="text-align:center">slave</td></tr><tr><td style="text-align:center">192.168.150.101</td><td style="text-align:center">7003</td><td style="text-align:center">slave</td></tr></tbody></table><h3 id="zhun-bei-shi-li-he-pei-zhi" id="å‡†å¤‡å®ä¾‹å’Œé…ç½®">å‡†å¤‡å®ä¾‹å’Œé…ç½®</h3><p>è¦åœ¨åŒä¸€å°è™šæ‹Ÿæœºå¼€å¯3ä¸ªå®ä¾‹ï¼Œå¿…é¡»å‡†å¤‡ä¸‰ä»½ä¸åŒçš„é…ç½®æ–‡ä»¶å’Œç›®å½•ï¼Œé…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¹Ÿå°±æ˜¯å·¥ä½œç›®å½•ã€‚</p><ol><li>åˆ›å»ºç›®å½•</li></ol><p>æˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œåå­—åˆ†åˆ«å«7001ã€7002ã€7003ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥/tmpç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"><span class="comment"># åˆ›å»ºç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> 7001 7002 7003</span><br></pre></td></tr></table></figure><p>å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/ffe29876883a46779b0b017c75824e3e" alt="image-20210630113929868"></p><ol start="2"><li>æ¢å¤åŸå§‹é…ç½®</li></ol><p>ä¿®æ”¹redis-6.2.4/redis.confæ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„æŒä¹…åŒ–æ¨¡å¼æ”¹ä¸ºé»˜è®¤çš„RDBæ¨¡å¼ï¼ŒAOFä¿æŒå…³é—­çŠ¶æ€ã€‚</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯RDB</span></span><br><span class="line"><span class="comment"># save &quot;&quot;</span></span><br><span class="line"><span class="attr">save</span> <span class="string">3600 1</span></span><br><span class="line"><span class="attr">save</span> <span class="string">300 100</span></span><br><span class="line"><span class="attr">save</span> <span class="string">60 10000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># å…³é—­AOF</span></span><br><span class="line"><span class="attr">appendonly</span> <span class="string">no</span></span><br></pre></td></tr></table></figure><ol start="3"><li>æ‹·è´é…ç½®æ–‡ä»¶åˆ°æ¯ä¸ªå®ä¾‹ç›®å½•</li></ol><p>ç„¶åå°†redis-6.2.4/redis.confæ–‡ä»¶æ‹·è´åˆ°ä¸‰ä¸ªç›®å½•ä¸­ï¼ˆåœ¨/tmpç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼ä¸€ï¼šé€ä¸ªæ‹·è´</span></span><br><span class="line"><span class="built_in">cp</span> redis-6.2.4/redis.conf 7001</span><br><span class="line"><span class="built_in">cp</span> redis-6.2.4/redis.conf 7002</span><br><span class="line"><span class="built_in">cp</span> redis-6.2.4/redis.conf 7003</span><br><span class="line"><span class="comment"># æ–¹å¼äºŒï¼šç®¡é“ç»„åˆå‘½ä»¤ï¼Œä¸€é”®æ‹·è´</span></span><br><span class="line"><span class="built_in">echo</span> 7001 7002 7003 | xargs -t -n 1 <span class="built_in">cp</span> redis-6.2.4/redis.conf</span><br></pre></td></tr></table></figure><ol start="4"><li>ä¿®æ”¹æ¯ä¸ªå®ä¾‹çš„ç«¯å£ã€å·¥ä½œç›®å½•</li></ol><p>ä¿®æ”¹æ¯ä¸ªæ–‡ä»¶å¤¹å†…çš„é…ç½®æ–‡ä»¶ï¼Œå°†ç«¯å£åˆ†åˆ«ä¿®æ”¹ä¸º7001ã€7002ã€7003ï¼Œå°†rdbæ–‡ä»¶ä¿å­˜ä½ç½®éƒ½ä¿®æ”¹ä¸ºè‡ªå·±æ‰€åœ¨ç›®å½•ï¼ˆåœ¨/tmpç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i -e <span class="string">&#x27;s/6379/7001/g&#x27;</span> -e <span class="string">&#x27;s/dir .\//dir \/tmp\/redis\/7001\//g&#x27;</span> 7001/redis.conf</span><br><span class="line">sed -i -e <span class="string">&#x27;s/6379/7002/g&#x27;</span> -e <span class="string">&#x27;s/dir .\//dir \/tmp\/redis\/7002\//g&#x27;</span> 7002/redis.conf</span><br><span class="line">sed -i -e <span class="string">&#x27;s/6379/7003/g&#x27;</span> -e <span class="string">&#x27;s/dir .\//dir \/tmp\/redis\/7003\//g&#x27;</span> 7003/redis.conf</span><br></pre></td></tr></table></figure><ol start="5"><li>ä¿®æ”¹æ¯ä¸ªå®ä¾‹çš„å£°æ˜IP</li></ol><p>è™šæ‹Ÿæœºæœ¬èº«æœ‰å¤šä¸ªIPï¼Œä¸ºäº†é¿å…å°†æ¥æ··ä¹±ï¼Œæˆ‘ä»¬éœ€è¦åœ¨redis.confæ–‡ä»¶ä¸­æŒ‡å®šæ¯ä¸€ä¸ªå®ä¾‹çš„ç»‘å®šipä¿¡æ¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rediså®ä¾‹çš„å£°æ˜ IP</span></span><br><span class="line"><span class="attr">replica-announce-ip</span> <span class="string">192.168.150.101</span></span><br></pre></td></tr></table></figure><p>æ¯ä¸ªç›®å½•éƒ½è¦æ”¹ï¼Œæˆ‘ä»¬ä¸€é”®å®Œæˆä¿®æ”¹ï¼ˆåœ¨/tmpç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€ä¸€æ‰§è¡Œ</span></span><br><span class="line">sed -i <span class="string">&#x27;1a replica-announce-ip 47.120.32.255&#x27;</span> 7001/redis.conf</span><br><span class="line">sed -i <span class="string">&#x27;1a replica-announce-ip 47.120.32.255&#x27;</span> 7002/redis.conf</span><br><span class="line">sed -i <span class="string">&#x27;1a replica-announce-ip 47.120.32.255&#x27;</span> 7003/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ä¸€é”®ä¿®æ”¹</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;%s\n&#x27;</span> 7001 7002 7003 | xargs -I&#123;&#125; -t sed -i <span class="string">&#x27;1a replica-announce-ip 47.120.32.255&#x27;</span> &#123;&#125;/redis.conf</span><br></pre></td></tr></table></figure><h3 id="qi-dong" id="å¯åŠ¨">å¯åŠ¨</h3><p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ—¥å¿—ï¼Œæˆ‘ä»¬æ‰“å¼€3ä¸ªsshçª—å£ï¼Œåˆ†åˆ«å¯åŠ¨3ä¸ªrediså®ä¾‹ï¼Œå¯åŠ¨å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬1ä¸ª</span></span><br><span class="line">redis-server 7001/redis.conf</span><br><span class="line"><span class="comment"># ç¬¬2ä¸ª</span></span><br><span class="line">redis-server 7002/redis.conf</span><br><span class="line"><span class="comment"># ç¬¬3ä¸ª</span></span><br><span class="line">redis-server 7003/redis.conf</span><br></pre></td></tr></table></figure><p>å¯åŠ¨åï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/31accd1fb9f44191a99447c39d0f8688" alt="image-20210630183914491"></p><p>å¦‚æœè¦ä¸€é”®åœæ­¢ï¼Œå¯ä»¥è¿è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;%s\n&#x27;</span> 7001 7002 7003 | xargs -I&#123;&#125; -t redis-cli -p &#123;&#125; shutdown</span><br></pre></td></tr></table></figure><h3 id="kai-qi-zhu-cong-guan-xi" id="å¼€å¯ä¸»ä»å…³ç³»">å¼€å¯ä¸»ä»å…³ç³»</h3><blockquote><p>æ³¨æ„ï¼šç”¨äº‘æœåŠ¡å™¨ECSè¦å…ˆå¼€æ”¾ç«¯å£</p></blockquote><ol><li>å¼€æ”¾æŒ‡å®šç«¯å£</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=7001/tcp --permanent</span><br></pre></td></tr></table></figure><ol start="2"><li>é‡æ–°è½½å…¥é˜²ç«å¢™</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><ol start="3"><li>åˆ é™¤æŒ‡å®šç«¯å£</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --remove-port=7001/tcp --permanent</span><br></pre></td></tr></table></figure><ol start="4"><li>æŸ¥çœ‹å·²ç»å¼€æ”¾çš„ç«¯å£</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --list-ports</span><br></pre></td></tr></table></figure><p>ç°åœ¨ä¸‰ä¸ªå®ä¾‹è¿˜æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œè¦é…ç½®ä¸»ä»å¯ä»¥ä½¿ç”¨replicaof æˆ–è€…slaveofï¼ˆ5.0ä»¥å‰ï¼‰å‘½ä»¤ã€‚</p><p>æœ‰ä¸´æ—¶å’Œæ°¸ä¹…ä¸¤ç§æ¨¡å¼ï¼š</p><ul><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆæ°¸ä¹…ç”Ÿæ•ˆï¼‰</p><ul><li>åœ¨redis.confä¸­æ·»åŠ ä¸€è¡Œé…ç½®ï¼š<code>slaveof &lt;masterip&gt; &lt;masterport&gt;</code></li></ul></li><li><p>ä½¿ç”¨redis-cliå®¢æˆ·ç«¯è¿æ¥åˆ°redisæœåŠ¡ï¼Œæ‰§è¡Œslaveofå‘½ä»¤ï¼ˆé‡å¯åå¤±æ•ˆï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br></pre></td></tr></table></figure></li></ul><p><strong><font color='red'>æ³¨æ„</font></strong>ï¼šåœ¨5.0ä»¥åæ–°å¢å‘½ä»¤<code>replicaof</code>ï¼Œä¸salveofæ•ˆæœä¸€è‡´ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œä½¿ç”¨æ–¹å¼äºŒã€‚</p><ul><li>é€šè¿‡redis-cliå‘½ä»¤è¿æ¥7002ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥ 7002</span></span><br><span class="line">redis-cli -p 7002</span><br><span class="line"><span class="comment"># æ‰§è¡Œslaveof</span></span><br><span class="line">slaveof 192.168.150.101 7001</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡redis-cliå‘½ä»¤è¿æ¥7003ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥ 7003</span></span><br><span class="line">redis-cli -p 7003</span><br><span class="line"><span class="comment"># æ‰§è¡Œslaveof</span></span><br><span class="line">replicaof 192.168.150.101 7001</span><br></pre></td></tr></table></figure><ul><li>ç„¶åè¿æ¥ 7001èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥ 7001</span></span><br><span class="line">redis-cli -p 7001</span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">info replication</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/04d8d72e1fb343749f74a7e19568f13f" alt="image-20210630201258802"></p><h3 id="ce-shi" id="æµ‹è¯•">æµ‹è¯•</h3><p>æ‰§è¡Œä¸‹åˆ—æ“ä½œä»¥æµ‹è¯•ï¼š</p><ul><li><p>åˆ©ç”¨redis-cliè¿æ¥7001ï¼Œæ‰§è¡Œ<code>set num 123</code></p></li><li><p>åˆ©ç”¨redis-cliè¿æ¥7002ï¼Œæ‰§è¡Œ<code>get num</code>ï¼Œå†æ‰§è¡Œ<code>set num 666</code></p></li><li><p>åˆ©ç”¨redis-cliè¿æ¥7003ï¼Œæ‰§è¡Œ<code>get num</code>ï¼Œå†æ‰§è¡Œ<code>set num 888</code></p></li></ul><blockquote><p>å¯ä»¥å‘ç°ï¼Œåªæœ‰åœ¨7001è¿™ä¸ªmasterèŠ‚ç‚¹ä¸Šå¯ä»¥æ‰§è¡Œå†™æ“ä½œï¼Œ7002å’Œ7003è¿™ä¸¤ä¸ªslaveèŠ‚ç‚¹åªèƒ½æ‰§è¡Œè¯»æ“ä½œã€‚</p></blockquote><h2 id="zhu-cong-shu-ju-tong-bu-yuan-li" id="ä¸»ä»æ•°æ®åŒæ­¥åŸç†">ä¸»ä»æ•°æ®åŒæ­¥åŸç†</h2><h3 id="quan-liang-tong-bu" id="å…¨é‡åŒæ­¥">å…¨é‡åŒæ­¥</h3><p>ä¸»ä»ç¬¬ä¸€æ¬¡å»ºç«‹è¿æ¥æ—¶ï¼Œä¼šæ‰§è¡Œ<strong>å…¨é‡åŒæ­¥</strong>ï¼Œå°†masterèŠ‚ç‚¹çš„æ‰€æœ‰æ•°æ®éƒ½æ‹·è´ç»™slaveèŠ‚ç‚¹ï¼Œæµç¨‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/2ac8684e41ad4879ba2fd71b47385719" alt="image-20210725152222497"></p><p>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œmasterå¦‚ä½•å¾—çŸ¥salveæ˜¯ç¬¬ä¸€æ¬¡æ¥è¿æ¥å‘¢ï¼Ÿï¼Ÿ</p><p>æœ‰å‡ ä¸ªæ¦‚å¿µï¼Œå¯ä»¥ä½œä¸ºåˆ¤æ–­ä¾æ®ï¼š</p><ul><li><p><strong>Replication Id</strong>ï¼šç®€ç§°replidï¼Œæ˜¯æ•°æ®é›†çš„æ ‡è®°ï¼Œidä¸€è‡´åˆ™è¯´æ˜æ˜¯åŒä¸€æ•°æ®é›†ã€‚</p><ul><li>æ¯ä¸€ä¸ªmasteréƒ½æœ‰å”¯ä¸€çš„replidï¼Œslaveåˆ™ä¼šç»§æ‰¿masterèŠ‚ç‚¹çš„replid</li></ul></li><li><p><strong>offset</strong>ï¼šåç§»é‡ï¼Œéšç€è®°å½•åœ¨repl_baklogä¸­çš„æ•°æ®å¢å¤šè€Œé€æ¸å¢å¤§ã€‚</p><ul><li>slaveå®ŒæˆåŒæ­¥æ—¶ä¹Ÿä¼šè®°å½•å½“å‰åŒæ­¥çš„offsetã€‚å¦‚æœslaveçš„offsetå°äºmasterçš„offsetï¼Œè¯´æ˜slaveæ•°æ®è½åäºmasterï¼Œéœ€è¦æ›´æ–°ã€‚</li></ul></li></ul><p>å› æ­¤slaveåšæ•°æ®åŒæ­¥ï¼Œå¿…é¡»å‘masterå£°æ˜è‡ªå·±çš„<u>replication id å’Œoffset</u>ï¼Œmasteræ‰å¯ä»¥åˆ¤æ–­åˆ°åº•éœ€è¦åŒæ­¥å“ªäº›æ•°æ®ã€‚</p><ul><li><p>å› ä¸ºslaveåŸæœ¬ä¹Ÿæ˜¯ä¸€ä¸ªmasterï¼Œæœ‰è‡ªå·±çš„replidå’Œoffsetï¼Œ</p></li><li><p>å½“ç¬¬ä¸€æ¬¡å˜æˆslaveï¼Œä¸masterå»ºç«‹è¿æ¥æ—¶ï¼Œå‘é€çš„replidå’Œoffset<u>æ˜¯è‡ªå·±çš„replidå’Œoffset</u>ã€‚</p></li><li><p>masteråˆ¤æ–­å‘ç°slaveå‘é€æ¥çš„replidä¸è‡ªå·±çš„<code>ä¸ä¸€è‡´</code>ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ª<code>å…¨æ–°</code>çš„slaveï¼Œå°±çŸ¥é“è¦åš<code>å…¨é‡åŒæ­¥</code>äº†ã€‚</p></li><li><p>masterä¼šå°†è‡ªå·±çš„replidå’Œoffsetéƒ½å‘é€ç»™è¿™ä¸ªslaveï¼Œslaveä¿å­˜è¿™äº›ä¿¡æ¯ã€‚<u>ä»¥åslaveçš„replidå°±ä¸masterä¸€è‡´äº†ã€‚</u></p></li></ul><p>å› æ­¤ï¼Œ<strong>masteråˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡åŒæ­¥çš„ä¾æ®ï¼Œå°±æ˜¯çœ‹replidæ˜¯å¦ä¸€è‡´</strong>ã€‚</p><p>å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/4ff652654b6742b581477a203e872299" alt="image-20210725152700914"></p><blockquote><p>å®Œæ•´æµç¨‹æè¿°ï¼š</p><ul><li>slaveèŠ‚ç‚¹è¯·æ±‚å¢é‡åŒæ­¥</li><li>masterèŠ‚ç‚¹åˆ¤æ–­replidï¼Œå‘ç°ä¸ä¸€è‡´ï¼Œæ‹’ç»å¢é‡åŒæ­¥</li><li>masterå°†å®Œæ•´å†…å­˜æ•°æ®ç”ŸæˆRDBï¼Œå‘é€RDBåˆ°slave</li><li>slaveæ¸…ç©ºæœ¬åœ°æ•°æ®ï¼ŒåŠ è½½masterçš„RDB</li><li>masterå°†RDBæœŸé—´çš„å‘½ä»¤è®°å½•åœ¨repl_baklogï¼Œå¹¶æŒç»­å°†logä¸­çš„å‘½ä»¤å‘é€ç»™slave</li><li>slaveæ‰§è¡Œæ¥æ”¶åˆ°çš„å‘½ä»¤ï¼Œä¿æŒä¸masterä¹‹é—´çš„åŒæ­¥</li></ul></blockquote><h3 id="zeng-liang-tong-bu" id="å¢é‡åŒæ­¥">å¢é‡åŒæ­¥</h3><p>å…¨é‡åŒæ­¥éœ€è¦å…ˆåšRDBï¼Œç„¶åå°†RDBæ–‡ä»¶é€šè¿‡ç½‘ç»œä¼ è¾“ä¸ªslaveï¼Œæˆæœ¬å¤ªé«˜äº†ã€‚</p><ul><li>å› æ­¤é™¤äº†ç¬¬ä¸€æ¬¡åšå…¨é‡åŒæ­¥ï¼Œå…¶å®ƒå¤§å¤šæ•°æ—¶å€™slaveä¸masteréƒ½æ˜¯åš<strong>å¢é‡åŒæ­¥</strong>ã€‚</li></ul><p>ä»€ä¹ˆæ˜¯å¢é‡åŒæ­¥ï¼Ÿå°±æ˜¯åªæ›´æ–°slaveä¸masterå­˜åœ¨å·®å¼‚çš„éƒ¨åˆ†æ•°æ®ã€‚å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/c098a14d03654bab9ffe74cde45f379d" alt="image-20210725153201086"></p><p>é‚£ä¹ˆmasteræ€ä¹ˆçŸ¥é“slaveä¸è‡ªå·±çš„æ•°æ®å·®å¼‚åœ¨å“ªé‡Œå‘¢?</p><h3 id="repl-backlog-yuan-li" id="repl-backlogåŸç†">repl_backlogåŸç†</h3><p>masteræ€ä¹ˆçŸ¥é“slaveä¸è‡ªå·±çš„æ•°æ®å·®å¼‚åœ¨å“ªé‡Œå‘¢?</p><p>è¿™å°±è¦è¯´åˆ°å…¨é‡åŒæ­¥æ—¶çš„repl_baklogæ–‡ä»¶äº†ã€‚</p><ul><li>è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„ï¼Œåªä¸è¿‡æ•°ç»„æ˜¯ç¯å½¢ï¼Œ</li><li>ä¹Ÿå°±æ˜¯è¯´<strong>è§’æ ‡åˆ°è¾¾æ•°ç»„æœ«å°¾åï¼Œä¼šå†æ¬¡ä»0å¼€å§‹è¯»å†™</strong>ï¼Œè¿™æ ·æ•°ç»„å¤´éƒ¨çš„æ•°æ®å°±ä¼šè¢«è¦†ç›–ã€‚</li></ul><p>repl_baklogä¸­ä¼šè®°å½•Rediså¤„ç†è¿‡çš„å‘½ä»¤æ—¥å¿—åŠoffsetï¼ŒåŒ…æ‹¬masterå½“å‰çš„offsetï¼Œå’Œslaveå·²ç»æ‹·è´åˆ°çš„offsetï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/dcd6f0bf0f4d47a1816e3b8d628d20fd" alt="image-20210725153359022"></p><p>slaveä¸masterçš„offsetä¹‹é—´çš„å·®å¼‚ï¼Œå°±æ˜¯salveéœ€è¦å¢é‡æ‹·è´çš„æ•°æ®äº†ã€‚</p><p>éšç€ä¸æ–­æœ‰æ•°æ®å†™å…¥ï¼Œmasterçš„offseté€æ¸å˜å¤§ï¼Œslaveä¹Ÿä¸æ–­çš„æ‹·è´ï¼Œè¿½èµ¶masterçš„offsetï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/1a0e7b6720c648d9bf5f1c590f831264" alt="image-20210725153524190"></p><p>ç›´åˆ°æ•°ç»„è¢«å¡«æ»¡ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/c1849d8e5f824e4bbd7e9cacb43f995a" alt="image-20210725153715910"></p><p>æ­¤æ—¶ï¼Œå¦‚æœæœ‰æ–°çš„æ•°æ®å†™å…¥ï¼Œå°±ä¼šè¦†ç›–æ•°ç»„ä¸­çš„æ—§æ•°æ®ã€‚ä¸è¿‡ï¼Œæ—§çš„æ•°æ®åªè¦æ˜¯ç»¿è‰²çš„ï¼Œè¯´æ˜æ˜¯å·²ç»è¢«åŒæ­¥åˆ°slaveçš„æ•°æ®ï¼Œå³ä¾¿è¢«è¦†ç›–äº†ä¹Ÿæ²¡ä»€ä¹ˆå½±å“ã€‚å› ä¸ºæœªåŒæ­¥çš„ä»…ä»…æ˜¯çº¢è‰²éƒ¨åˆ†ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœslaveå‡ºç°ç½‘ç»œé˜»å¡ï¼Œå¯¼è‡´masterçš„offsetè¿œè¿œè¶…è¿‡äº†slaveçš„offsetï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/44fb82d95e684b4f87bc316049a0b491" alt="image-20210725153937031"></p><p>å¦‚æœmasterç»§ç»­å†™å…¥æ–°æ•°æ®ï¼Œå…¶offsetå°±ä¼šè¦†ç›–æ—§çš„æ•°æ®ï¼Œç›´åˆ°å°†slaveç°åœ¨çš„offsetä¹Ÿè¦†ç›–ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/0ea00e3e456644baa2a9f3d1f46a7516" alt="image-20210725154155984"></p><p>æ£•è‰²æ¡†ä¸­çš„çº¢è‰²éƒ¨åˆ†ï¼Œå°±æ˜¯å°šæœªåŒæ­¥ï¼Œä½†æ˜¯å´å·²ç»è¢«è¦†ç›–çš„æ•°æ®ã€‚</p><ul><li>æ­¤æ—¶å¦‚æœslaveæ¢å¤ï¼Œéœ€è¦åŒæ­¥ï¼Œå´å‘ç°è‡ªå·±çš„offsetéƒ½æ²¡æœ‰äº†ï¼Œ<ul><li>æ— æ³•å®Œæˆå¢é‡åŒæ­¥äº†ã€‚</li><li>åªèƒ½åšå…¨é‡åŒæ­¥ã€‚</li></ul></li></ul><p><img src="https://s1.vika.cn/space/2023/03/19/10bd88e872034aff946ee81cc8e5315a" alt="image-20210725154216392"></p><h2 id="zhu-cong-tong-bu-you-hua" id="ä¸»ä»åŒæ­¥ä¼˜åŒ–">ä¸»ä»åŒæ­¥ä¼˜åŒ–</h2><p>ä¸»ä»åŒæ­¥å¯ä»¥ä¿è¯ä¸»ä»æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéå¸¸é‡è¦ã€‚</p><p>å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä¼˜åŒ–Redisä¸»ä»å°±é›†ç¾¤ï¼š</p><ul><li>åœ¨masterä¸­é…ç½®<code>repl-diskless-sync yes</code>å¯ç”¨<code>æ— ç£ç›˜å¤åˆ¶</code>ï¼Œé¿å…å…¨é‡åŒæ­¥æ—¶çš„ç£ç›˜IOã€‚</li><li>Rediså•èŠ‚ç‚¹ä¸Šçš„<u>å†…å­˜å ç”¨ä¸è¦å¤ªå¤§</u>ï¼Œå‡å°‘RDBå¯¼è‡´çš„è¿‡å¤šç£ç›˜IO</li><li>é€‚å½“<u>æé«˜repl_baklogçš„å¤§å°</u>ï¼Œå‘ç°slaveå®•æœºæ—¶å°½å¿«å®ç°æ•…éšœæ¢å¤ï¼Œå°½å¯èƒ½é¿å…å…¨é‡åŒæ­¥</li><li><u>é™åˆ¶ä¸€ä¸ªmasterä¸Šçš„slaveèŠ‚ç‚¹æ•°é‡</u>ï¼Œå¦‚æœå®åœ¨æ˜¯å¤ªå¤šslaveï¼Œåˆ™å¯ä»¥é‡‡ç”¨<code>ä¸»-ä»-ä»é“¾å¼ç»“æ„</code>ï¼Œå‡å°‘masterå‹åŠ›</li></ul><p>ä¸»ä»ä»æ¶æ„å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/b5f39a07992e4ad0aa76182eacf8db3c" alt="image-20210725154405899"></p><h2 id="xiao-jie-1" id="å°ç»“-2">å°ç»“</h2><p>ç®€è¿°å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥åŒºåˆ«ï¼Ÿ</p><ul><li><strong>å…¨é‡åŒæ­¥</strong>ï¼šmasterå°†å®Œæ•´å†…å­˜æ•°æ®ç”ŸæˆRDBï¼Œå‘é€RDBåˆ°slaveã€‚åç»­å‘½ä»¤åˆ™è®°å½•åœ¨repl_baklogï¼Œé€ä¸ªå‘é€ç»™slaveã€‚</li><li><strong>å¢é‡åŒæ­¥</strong>ï¼šslaveæäº¤è‡ªå·±çš„offsetåˆ°masterï¼Œmasterè·å–repl_baklogä¸­ä»offsetä¹‹åçš„å‘½ä»¤ç»™slave</li></ul><p>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå…¨é‡åŒæ­¥ï¼Ÿ</p><ul><li>slaveèŠ‚ç‚¹ç¬¬ä¸€æ¬¡è¿æ¥masterèŠ‚ç‚¹æ—¶</li><li>slaveèŠ‚ç‚¹æ–­å¼€æ—¶é—´å¤ªä¹…ï¼Œrepl_baklogä¸­çš„offsetå·²ç»è¢«è¦†ç›–æ—¶</li></ul><p>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå¢é‡åŒæ­¥ï¼Ÿ</p><ul><li>slaveèŠ‚ç‚¹æ–­å¼€åˆæ¢å¤ï¼Œå¹¶ä¸”åœ¨repl_baklogä¸­èƒ½æ‰¾åˆ°offsetæ—¶</li></ul><h1 id="redis-shao-bing">Rediså“¨å…µ</h1><p>Redisæä¾›äº†å“¨å…µï¼ˆSentinelï¼‰æœºåˆ¶æ¥å®ç°ä¸»ä»é›†ç¾¤çš„è‡ªåŠ¨æ•…éšœæ¢å¤ã€‚</p><h2 id="shao-bing-yuan-li" id="å“¨å…µåŸç†">å“¨å…µåŸç†</h2><h3 id="ji-qun-jie-gou-he-zuo-yong" id="é›†ç¾¤ç»“æ„å’Œä½œç”¨">é›†ç¾¤ç»“æ„å’Œä½œç”¨</h3><p>å“¨å…µçš„ç»“æ„å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/adf5f68a25834460bc2791967bae42ee" alt="image-20210725154528072"></p><p>å“¨å…µçš„ä½œç”¨å¦‚ä¸‹ï¼š</p><ul><li><strong>ç›‘æ§</strong>ï¼šSentinel ä¼šä¸æ–­æ£€æŸ¥æ‚¨çš„masterå’Œslaveæ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ</li><li><strong>è‡ªåŠ¨æ•…éšœæ¢å¤</strong>ï¼šå¦‚æœmasteræ•…éšœï¼ŒSentinelä¼šå°†ä¸€ä¸ªslaveæå‡ä¸ºmasterã€‚å½“æ•…éšœå®ä¾‹æ¢å¤åä¹Ÿä»¥æ–°çš„masterä¸ºä¸»</li><li><strong>é€šçŸ¥</strong>ï¼šSentinelå……å½“Rediså®¢æˆ·ç«¯çš„æœåŠ¡å‘ç°æ¥æºï¼Œå½“é›†ç¾¤å‘ç”Ÿæ•…éšœè½¬ç§»æ—¶ï¼Œä¼šå°†æœ€æ–°ä¿¡æ¯æ¨é€ç»™<u>Redisçš„å®¢æˆ·ç«¯</u></li></ul><h3 id="ji-qun-jian-kong-yuan-li" id="é›†ç¾¤ç›‘æ§åŸç†">é›†ç¾¤ç›‘æ§åŸç†</h3><p>SentinelåŸºäºå¿ƒè·³æœºåˆ¶ç›‘æµ‹æœåŠ¡çŠ¶æ€ï¼Œæ¯éš”1ç§’å‘é›†ç¾¤çš„æ¯ä¸ªå®ä¾‹å‘é€pingå‘½ä»¤ï¼š</p><ul><li><p>ä¸»è§‚ä¸‹çº¿ï¼šå¦‚æœæŸsentinelèŠ‚ç‚¹å‘ç°æŸå®ä¾‹æœªåœ¨è§„å®šæ—¶é—´å“åº”ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹<strong>ä¸»è§‚ä¸‹çº¿</strong>ã€‚</p></li><li><p>å®¢è§‚ä¸‹çº¿ï¼šè‹¥è¶…è¿‡æŒ‡å®šæ•°é‡ï¼ˆquorumï¼‰çš„sentineléƒ½è®¤ä¸ºè¯¥å®ä¾‹ä¸»è§‚ä¸‹çº¿ï¼Œåˆ™è¯¥å®ä¾‹<strong>å®¢è§‚ä¸‹çº¿</strong>ã€‚</p><ul><li>quorumå€¼æœ€å¥½è¶…è¿‡Sentinelå®ä¾‹æ•°é‡çš„ä¸€åŠã€‚</li></ul></li></ul><p><img src="https://s1.vika.cn/space/2023/03/19/3922e823d11f4ca5882b136813570869" alt="image-20210725154632354"></p><h3 id="ji-qun-gu-zhang-hui-fu-yuan-li" id="é›†ç¾¤æ•…éšœæ¢å¤åŸç†">é›†ç¾¤æ•…éšœæ¢å¤åŸç†</h3><p>ä¸€æ—¦å‘ç°masteræ•…éšœï¼Œsentineléœ€è¦åœ¨salveä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºæ–°çš„masterï¼Œ<strong>é€‰æ‹©ä¾æ®</strong>æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>é¦–å…ˆä¼šåˆ¤æ–­slaveèŠ‚ç‚¹ä¸masterèŠ‚ç‚¹æ–­å¼€<code>æ—¶é—´é•¿çŸ­</code>ï¼Œå¦‚æœè¶…è¿‡æŒ‡å®šå€¼<code>ï¼ˆdown-after-milliseconds * 10ï¼‰</code>åˆ™ä¼šæ’é™¤è¯¥slaveèŠ‚ç‚¹ï¼ˆä¸masteræ–­å¼€å¤ªä¹…ï¼Œæ•°æ®ä¸¢å¤±å¤šï¼Œå¤±å»é€‰ä¸¾æƒï¼‰</li><li>ç„¶ååˆ¤æ–­slaveèŠ‚ç‚¹çš„slave-priorityå€¼ï¼Œ<code>è¶Šå°</code>ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå¦‚æœæ˜¯0åˆ™æ°¸ä¸å‚ä¸é€‰ä¸¾</li><li>å¦‚æœslave-prorityä¸€æ ·ï¼Œåˆ™åˆ¤æ–­slaveèŠ‚ç‚¹çš„offsetå€¼ï¼Œ<code>è¶Šå¤§</code>è¯´æ˜æ•°æ®è¶Šæ–°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</li><li>æœ€åæ˜¯åˆ¤æ–­slaveèŠ‚ç‚¹çš„è¿è¡Œidå¤§å°ï¼Œ<code>è¶Šå°</code>ä¼˜å…ˆçº§è¶Šé«˜ã€‚</li></ul><p>å½“é€‰å‡ºä¸€ä¸ªæ–°çš„masteråï¼Œè¯¥å¦‚ä½•å®ç°åˆ‡æ¢å‘¢ï¼Ÿ</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>sentinelç»™å¤‡é€‰çš„slave1èŠ‚ç‚¹å‘é€<code>slaveof no one</code>å‘½ä»¤ï¼Œè®©è¯¥èŠ‚ç‚¹æˆä¸ºmaster</li><li>sentinelç»™æ‰€æœ‰å…¶å®ƒslaveå‘é€<code>slaveof 47.120.32.255 7002</code> å‘½ä»¤ï¼Œè®©è¿™äº›slaveæˆä¸ºæ–°masterçš„ä»èŠ‚ç‚¹ï¼Œå¼€å§‹ä»æ–°çš„masterä¸ŠåŒæ­¥æ•°æ®ã€‚</li><li>æœ€åï¼Œsentinelå°†æ•…éšœèŠ‚ç‚¹<code>æ ‡è®°</code>ä¸ºslaveï¼Œå½“æ•…éšœèŠ‚ç‚¹æ¢å¤åä¼šè‡ªåŠ¨æˆä¸º<u>æ–°çš„masterçš„slaveèŠ‚ç‚¹</u></li></ul><p><img src="https://s1.vika.cn/space/2023/03/19/396f8129618049a2bdce1fd181a882c0" alt="image-20210725154816841"></p><h3 id="xiao-jie-2" id="å°ç»“-3">å°ç»“</h3><p>Sentinelçš„ä¸‰ä¸ªä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>ç›‘æ§</li><li>æ•…éšœè½¬ç§»</li><li>é€šçŸ¥</li></ul><p>Sentinelå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªrediså®ä¾‹æ˜¯å¦å¥åº·ï¼Ÿ</p><ul><li>æ¯éš”1ç§’å‘é€ä¸€æ¬¡pingå‘½ä»¤ï¼Œå¦‚æœè¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰ç›¸å‘åˆ™è®¤ä¸ºæ˜¯ä¸»è§‚ä¸‹çº¿</li><li>å¦‚æœå¤§å¤šæ•°sentineléƒ½è®¤ä¸ºå®ä¾‹ä¸»è§‚ä¸‹çº¿ï¼Œåˆ™åˆ¤å®šæœåŠ¡ä¸‹çº¿</li></ul><p>æ•…éšœè½¬ç§»æ­¥éª¤æœ‰å“ªäº›ï¼Ÿ</p><ul><li>é¦–å…ˆé€‰å®šä¸€ä¸ªslaveä½œä¸ºæ–°çš„masterï¼Œæ‰§è¡Œslaveof no one</li><li>ç„¶åè®©æ‰€æœ‰èŠ‚ç‚¹éƒ½æ‰§è¡Œslaveof æ–°master</li><li>ä¿®æ”¹æ•…éšœèŠ‚ç‚¹é…ç½®ï¼Œæ·»åŠ slaveof æ–°masterï¼Œä½¿å…¶æ¢å¤åæˆä¸ºslaveèŠ‚ç‚¹</li></ul><h2 id="da-jian-shao-bing-ji-qun" id="æ­å»ºå“¨å…µé›†ç¾¤">æ­å»ºå“¨å…µé›†ç¾¤</h2><h3 id="ji-qun-jie-gou" id="é›†ç¾¤ç»“æ„">é›†ç¾¤ç»“æ„</h3><p>è¿™é‡Œæˆ‘ä»¬æ­å»ºä¸€ä¸ªä¸‰èŠ‚ç‚¹å½¢æˆçš„Sentinelé›†ç¾¤ï¼Œæ¥ç›‘ç®¡ä¹‹å‰çš„Redisä¸»ä»é›†ç¾¤ã€‚å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/23db3eee471b4ae7a543df72c24d86ae" alt="image-20210701215227018"></p><p>ä¸‰ä¸ªsentinelå®ä¾‹ä¿¡æ¯å¦‚ä¸‹ï¼š</p><table><thead><tr><th>èŠ‚ç‚¹</th><th style="text-align:center">IP</th><th style="text-align:center">PORT</th></tr></thead><tbody><tr><td>s1</td><td style="text-align:center">192.168.150.101</td><td style="text-align:center">27001</td></tr><tr><td>s2</td><td style="text-align:center">192.168.150.101</td><td style="text-align:center">27002</td></tr><tr><td>s3</td><td style="text-align:center">192.168.150.101</td><td style="text-align:center">27003</td></tr></tbody></table><h3 id="zhun-bei-shi-li-he-pei-zhi-1" id="å‡†å¤‡å®ä¾‹å’Œé…ç½®-2">å‡†å¤‡å®ä¾‹å’Œé…ç½®</h3><p>è¦åœ¨åŒä¸€å°è™šæ‹Ÿæœºå¼€å¯3ä¸ªå®ä¾‹ï¼Œå¿…é¡»å‡†å¤‡ä¸‰ä»½ä¸åŒçš„é…ç½®æ–‡ä»¶å’Œç›®å½•ï¼Œé…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¹Ÿå°±æ˜¯å·¥ä½œç›®å½•ã€‚</p><p>æˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œåå­—åˆ†åˆ«å«s1ã€s2ã€s3ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥/tmpç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"><span class="comment"># åˆ›å»ºç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> s1 s2 s3</span><br></pre></td></tr></table></figure><p>å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/95063115012740eeaeacaec303a99618" alt="image-20210701215534714"></p><p>ç„¶åæˆ‘ä»¬åœ¨s1ç›®å½•åˆ›å»ºä¸€ä¸ªsentinel.confæ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢çš„å†…å®¹ï¼š</p><div class="tabs" id="sentinelconf"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#sentinelconf-1">äº‘æœåŠ¡å™¨</button></li><li class="tab"><button type="button" data-href="#sentinelconf-2">è™šæ‹Ÿæœº</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="sentinelconf-1"><ul><li>announce-ip ï¼šéœ€è¦é…ç½®ä¸º 127.0.0.1</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">port 27001</span><br><span class="line">sentinel announce-ip 127.0.0.1</span><br><span class="line">sentinel monitor mymaster 47.120.32.255 7001 2</span><br><span class="line">sentinel down-after-milliseconds mymaster 5000</span><br><span class="line">sentinel failover-timeout mymaster 60000</span><br><span class="line">dir &quot;/tmp/redis/s1&quot;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="sentinelconf-2"><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">port 27001</span><br><span class="line">sentinel announce-ip 192.168.146.101</span><br><span class="line">sentinel monitor mymaster 192.168.146.101 7001 2</span><br><span class="line">sentinel down-after-milliseconds mymaster 5000</span><br><span class="line">sentinel failover-timeout mymaster 60000</span><br><span class="line">dir &quot;/tmp/redis/s1&quot;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p><strong>è§£è¯»</strong>ï¼š</p><ul><li><code>port 27001</code>ï¼šæ˜¯å½“å‰sentinelå®ä¾‹çš„ç«¯å£</li><li><code>sentinel monitor mymaster 192.168.150.101 7001 2</code>ï¼šæŒ‡å®šä¸»èŠ‚ç‚¹ä¿¡æ¯<ul><li><code>mymaster</code>ï¼šä¸»èŠ‚ç‚¹åç§°ï¼Œè‡ªå®šä¹‰ï¼Œä»»æ„å†™</li><li><code>192.168.150.101 7001</code>ï¼šä¸»èŠ‚ç‚¹çš„ipå’Œç«¯å£</li><li><code>2</code>ï¼šé€‰ä¸¾masteræ—¶çš„quorumå€¼</li></ul></li></ul><p>ç„¶åå°†s1/sentinel.confæ–‡ä»¶æ‹·è´åˆ°s2ã€s3ä¸¤ä¸ªç›®å½•ä¸­ï¼ˆåœ¨/tmpç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼ä¸€ï¼šé€ä¸ªæ‹·è´</span></span><br><span class="line"><span class="built_in">cp</span> s1/sentinel.conf s2</span><br><span class="line"><span class="built_in">cp</span> s1/sentinel.conf s3</span><br><span class="line"><span class="comment"># æ–¹å¼äºŒï¼šç®¡é“ç»„åˆå‘½ä»¤ï¼Œä¸€é”®æ‹·è´</span></span><br><span class="line"><span class="built_in">echo</span> s2 s3 | xargs -t -n 1 <span class="built_in">cp</span> s1/sentinel.conf</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹s2ã€s3ä¸¤ä¸ªæ–‡ä»¶å¤¹å†…çš„é…ç½®æ–‡ä»¶ï¼Œå°†ç«¯å£åˆ†åˆ«ä¿®æ”¹ä¸º27002ã€27003ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i -e <span class="string">&#x27;s/27001/27002/g&#x27;</span> -e <span class="string">&#x27;s/s1/s2/g&#x27;</span> s2/sentinel.conf</span><br><span class="line">sed -i -e <span class="string">&#x27;s/27001/27003/g&#x27;</span> -e <span class="string">&#x27;s/s1/s3/g&#x27;</span> s3/sentinel.conf</span><br></pre></td></tr></table></figure><h3 id="qi-dong-1" id="å¯åŠ¨-2">å¯åŠ¨</h3><p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ—¥å¿—ï¼Œæˆ‘ä»¬æ‰“å¼€3ä¸ªsshçª—å£ï¼Œåˆ†åˆ«å¯åŠ¨3ä¸ªrediså®ä¾‹ï¼Œå¯åŠ¨å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬1ä¸ª</span></span><br><span class="line">redis-sentinel s1/sentinel.conf</span><br><span class="line"><span class="comment"># ç¬¬2ä¸ª</span></span><br><span class="line">redis-sentinel s2/sentinel.conf</span><br><span class="line"><span class="comment"># ç¬¬3ä¸ª</span></span><br><span class="line">redis-sentinel s3/sentinel.conf</span><br></pre></td></tr></table></figure><p>å¯åŠ¨åï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/856e9ab9a1c74bc485ad26ffbda166f9" alt="image-20210701220714104"></p><h3 id="ce-shi-1" id="æµ‹è¯•-2">æµ‹è¯•</h3><p>å°è¯•è®©masterèŠ‚ç‚¹7001å®•æœºï¼ŒæŸ¥çœ‹sentinelæ—¥å¿—ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/86176a23f62f4d0398e8fd99f1a897f7" alt="image-20210701222857997"></p><p>æŸ¥çœ‹7003çš„æ—¥å¿—ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/7a735d0502144c268948d1ccc19df5a9" alt="image-20210701223025709"></p><p>æŸ¥çœ‹7002çš„æ—¥å¿—ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/d547e933f844473591814f96b68e858a" alt="image-20210701223131264"></p><h2 id="redis-template" id="RedisTemplate">RedisTemplate</h2><p>åœ¨Sentinelé›†ç¾¤ç›‘ç®¡ä¸‹çš„Redisä¸»ä»é›†ç¾¤ï¼Œå…¶èŠ‚ç‚¹ä¼šå› ä¸ºè‡ªåŠ¨æ•…éšœè½¬ç§»è€Œå‘ç”Ÿå˜åŒ–ï¼ŒRedisçš„å®¢æˆ·ç«¯å¿…é¡»æ„ŸçŸ¥è¿™ç§å˜åŒ–ï¼ŒåŠæ—¶æ›´æ–°è¿æ¥ä¿¡æ¯ã€‚Springçš„RedisTemplateåº•å±‚åˆ©ç”¨lettuceå®ç°äº†èŠ‚ç‚¹çš„æ„ŸçŸ¥å’Œè‡ªåŠ¨åˆ‡æ¢ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæµ‹è¯•æ¥å®ç°RedisTemplateé›†æˆå“¨å…µæœºåˆ¶ã€‚</p><h3 id="dao-ru-demo-gong-cheng" id="å¯¼å…¥Demoå·¥ç¨‹">å¯¼å…¥Demoå·¥ç¨‹</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¼•å…¥è¯¾å‰èµ„æ–™æä¾›çš„Demoå·¥ç¨‹ï¼š</p><h3 id="yin-ru-yi-lai" id="å¼•å…¥ä¾èµ–">å¼•å…¥ä¾èµ–</h3><p>åœ¨é¡¹ç›®çš„pomæ–‡ä»¶ä¸­å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="pei-zhi-redis-di-zhi" id="é…ç½®Redisåœ°å€">é…ç½®Redisåœ°å€</h3><p>ç„¶ååœ¨é…ç½®æ–‡ä»¶application.ymlä¸­æŒ‡å®šredisçš„sentinelç›¸å…³ä¿¡æ¯ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">master:</span> <span class="string">mymaster</span> <span class="comment"># æŒ‡å®šmasteråç§°</span></span><br><span class="line">      <span class="attr">nodes:</span> <span class="comment"># æŒ‡å®šredis-sentinelé›†ç¾¤ä¿¡æ¯</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span><span class="string">:27001</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span><span class="string">:27002</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span><span class="string">:27003</span></span><br></pre></td></tr></table></figure><h3 id="pei-zhi-du-xie-fen-chi" id="é…ç½®è¯»å†™åˆ†ç¦»">é…ç½®è¯»å†™åˆ†ç¦»</h3><ul><li>åœ¨é¡¹ç›®çš„å¯åŠ¨ç±»ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„beanï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> LettuceClientConfigurationBuilderCustomizer <span class="title function_">clientConfigurationBuilderCustomizer</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> clientConfigurationBuilder -&gt; clientConfigurationBuilder.readFrom(ReadFrom.REPLICA_PREFERRED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªbeanä¸­é…ç½®çš„å°±æ˜¯è¯»å†™ç­–ç•¥ï¼ŒåŒ…æ‹¬å››ç§ï¼š</p><ul><li>MASTERï¼šä»ä¸»èŠ‚ç‚¹è¯»å–</li><li>MASTER_PREFERREDï¼šä¼˜å…ˆä»masterèŠ‚ç‚¹è¯»å–ï¼Œmasterä¸å¯ç”¨æ‰è¯»å–replica</li><li>REPLICAï¼šä»slaveï¼ˆreplicaï¼‰èŠ‚ç‚¹è¯»å–</li><li>REPLICA _PREFERREDï¼šä¼˜å…ˆä»slaveï¼ˆreplicaï¼‰èŠ‚ç‚¹è¯»å–ï¼Œæ‰€æœ‰çš„slaveéƒ½ä¸å¯ç”¨æ‰è¯»å–master</li></ul><h1 id="redis-fen-pian-ji-qun">Redisåˆ†ç‰‡é›†ç¾¤</h1><h2 id="da-jian-fen-pian-ji-qun" id="æ­å»ºåˆ†ç‰‡é›†ç¾¤">æ­å»ºåˆ†ç‰‡é›†ç¾¤</h2><p>ä¸»ä»å’Œå“¨å…µå¯ä»¥è§£å†³é«˜å¯ç”¨ã€é«˜å¹¶å‘è¯»çš„é—®é¢˜ã€‚ä½†æ˜¯ä¾ç„¶æœ‰ä¸¤ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼š</p><ul><li><p>æµ·é‡æ•°æ®å­˜å‚¨é—®é¢˜</p></li><li><p>é«˜å¹¶å‘å†™çš„é—®é¢˜</p></li></ul><p>ä½¿ç”¨åˆ†ç‰‡é›†ç¾¤å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¦‚å›¾:</p><p><img src="https://s1.vika.cn/space/2023/03/19/57a77bd748064ed7ab5d5f333d28b285" alt="image-20210725155747294"></p><p>åˆ†ç‰‡é›†ç¾¤ç‰¹å¾ï¼š</p><ul><li><p>é›†ç¾¤ä¸­æœ‰å¤šä¸ªmasterï¼Œæ¯ä¸ªmasterä¿å­˜ä¸åŒæ•°æ®</p></li><li><p>æ¯ä¸ªmasteréƒ½å¯ä»¥æœ‰å¤šä¸ªslaveèŠ‚ç‚¹</p></li><li><p>masterä¹‹é—´é€šè¿‡pingç›‘æµ‹å½¼æ­¤å¥åº·çŠ¶æ€</p></li><li><p>å®¢æˆ·ç«¯è¯·æ±‚å¯ä»¥è®¿é—®é›†ç¾¤ä»»æ„èŠ‚ç‚¹ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«è½¬å‘åˆ°æ­£ç¡®èŠ‚ç‚¹</p></li></ul><h3 id="ji-qun-jie-gou-1" id="é›†ç¾¤ç»“æ„-2">é›†ç¾¤ç»“æ„</h3><p>åˆ†ç‰‡é›†ç¾¤éœ€è¦çš„èŠ‚ç‚¹æ•°é‡è¾ƒå¤šï¼Œè¿™é‡Œæˆ‘ä»¬æ­å»ºä¸€ä¸ªæœ€å°çš„åˆ†ç‰‡é›†ç¾¤ï¼ŒåŒ…å«3ä¸ªmasterèŠ‚ç‚¹ï¼Œæ¯ä¸ªmasteråŒ…å«ä¸€ä¸ªslaveèŠ‚ç‚¹ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/c88e7a5e9c0f46088095411f817c8e7b" alt="image-20210702164116027"></p><p>è¿™é‡Œæˆ‘ä»¬ä¼šåœ¨åŒä¸€å°è™šæ‹Ÿæœºä¸­å¼€å¯6ä¸ªrediså®ä¾‹ï¼Œæ¨¡æ‹Ÿåˆ†ç‰‡é›†ç¾¤ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:center">IP</th><th style="text-align:center">PORT</th><th style="text-align:center">è§’è‰²</th></tr></thead><tbody><tr><td style="text-align:center">192.168.150.101</td><td style="text-align:center">7001</td><td style="text-align:center">master</td></tr><tr><td style="text-align:center">192.168.150.101</td><td style="text-align:center">7002</td><td style="text-align:center">master</td></tr><tr><td style="text-align:center">192.168.150.101</td><td style="text-align:center">7003</td><td style="text-align:center">master</td></tr><tr><td style="text-align:center">192.168.150.101</td><td style="text-align:center">8001</td><td style="text-align:center">slave</td></tr><tr><td style="text-align:center">192.168.150.101</td><td style="text-align:center">8002</td><td style="text-align:center">slave</td></tr><tr><td style="text-align:center">192.168.150.101</td><td style="text-align:center">8003</td><td style="text-align:center">slave</td></tr></tbody></table><h3 id="zhun-bei-shi-li-he-pei-zhi-2" id="å‡†å¤‡å®ä¾‹å’Œé…ç½®-3">å‡†å¤‡å®ä¾‹å’Œé…ç½®</h3><p>åˆ é™¤ä¹‹å‰çš„7001ã€7002ã€7003è¿™å‡ ä¸ªç›®å½•ï¼Œé‡æ–°åˆ›å»ºå‡º7001ã€7002ã€7003ã€8001ã€8002ã€8003ç›®å½•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥/tmpç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"><span class="comment"># åˆ é™¤æ—§çš„ï¼Œé¿å…é…ç½®å¹²æ‰°</span></span><br><span class="line"><span class="built_in">rm</span> -rf 7001 7002 7003</span><br><span class="line"><span class="comment"># åˆ›å»ºç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> 7001 7002 7003 8001 8002 8003</span><br></pre></td></tr></table></figure><p>åœ¨/tmpä¸‹å‡†å¤‡ä¸€ä¸ªæ–°çš„redis.confæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><blockquote><p>æ³¨æ„ï¼šäº‘æœåŠ¡å™¨æ­¤å¤„cluster-config-fileå¡«ï¼š</p></blockquote><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">port 6379</span><br><span class="line"><span class="comment"># å¼€å¯é›†ç¾¤åŠŸèƒ½</span></span><br><span class="line">cluster-enabled yes</span><br><span class="line"><span class="comment"># é›†ç¾¤çš„é…ç½®æ–‡ä»¶åç§°ï¼Œä¸éœ€è¦æˆ‘ä»¬åˆ›å»ºï¼Œç”±redisè‡ªå·±ç»´æŠ¤</span></span><br><span class="line">cluster-config-file /tmp/redis/6379/nodes.conf</span><br><span class="line"><span class="comment"># èŠ‚ç‚¹å¿ƒè·³å¤±è´¥çš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"><span class="comment"># æŒä¹…åŒ–æ–‡ä»¶å­˜æ”¾ç›®å½•</span></span><br><span class="line">dir /tmp/redis/6379</span><br><span class="line"><span class="comment"># ç»‘å®šåœ°å€</span></span><br><span class="line">bind 0.0.0.0</span><br><span class="line"><span class="comment"># è®©redisåå°è¿è¡Œ</span></span><br><span class="line">daemonize yes</span><br><span class="line"><span class="comment"># æ³¨å†Œçš„å®ä¾‹ip</span></span><br><span class="line">replica-announce-ip 47.120.32.255</span><br><span class="line"><span class="comment"># ä¿æŠ¤æ¨¡å¼</span></span><br><span class="line">protected-mode no</span><br><span class="line"><span class="comment"># æ•°æ®åº“æ•°é‡</span></span><br><span class="line">databases 1</span><br><span class="line"><span class="comment"># æ—¥å¿—</span></span><br><span class="line">logfile /tmp/6379/run.log</span><br></pre></td></tr></table></figure><p>å°†è¿™ä¸ªæ–‡ä»¶æ‹·è´åˆ°æ¯ä¸ªç›®å½•ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥/tmpç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"><span class="comment"># æ‰§è¡Œæ‹·è´</span></span><br><span class="line"><span class="built_in">echo</span> 7001 7002 7003 8001 8002 8003 | xargs -t -n 1 <span class="built_in">cp</span> redis.conf</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æ¯ä¸ªç›®å½•ä¸‹çš„redis.confï¼Œå°†å…¶ä¸­çš„6379ä¿®æ”¹ä¸ºä¸æ‰€åœ¨ç›®å½•ä¸€è‡´ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥/tmpç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"><span class="comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;%s\n&#x27;</span> 7001 7002 7003 8001 8002 8003 | xargs -I&#123;&#125; -t sed -i <span class="string">&#x27;s/6379/&#123;&#125;/g&#x27;</span> &#123;&#125;/redis.conf</span><br></pre></td></tr></table></figure><h3 id="qi-dong-2" id="å¯åŠ¨-3">å¯åŠ¨</h3><p>å› ä¸ºå·²ç»é…ç½®äº†åå°å¯åŠ¨æ¨¡å¼ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¯åŠ¨æœåŠ¡ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥/tmpç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"><span class="comment"># ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;%s\n&#x27;</span> 7001 7002 7003 8001 8002 8003 | xargs -I&#123;&#125; -t redis-server &#123;&#125;/redis.conf</span><br></pre></td></tr></table></figure><p>é€šè¿‡psæŸ¥çœ‹çŠ¶æ€ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep redis</span><br></pre></td></tr></table></figure><p>å‘ç°æœåŠ¡éƒ½å·²ç»æ­£å¸¸å¯åŠ¨ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/11780e12c63c4e23a18abfdd8b07dd8b" alt="image-20210702174255799"></p><ul><li>å¦‚æœè¦å…³é—­æ‰€æœ‰è¿›ç¨‹ï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼š</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep redis | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs <span class="built_in">kill</span></span><br></pre></td></tr></table></figure><ul><li>æˆ–è€…ï¼ˆæ¨èè¿™ç§æ–¹å¼ï¼‰ï¼š</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;%s\n&#x27;</span> 7001 7002 7003 8001 8002 8003 | xargs -I&#123;&#125; -t redis-cli -p &#123;&#125; shutdown</span><br></pre></td></tr></table></figure><h3 id="chuang-jian-ji-qun" id="åˆ›å»ºé›†ç¾¤">åˆ›å»ºé›†ç¾¤</h3><p>è™½ç„¶æœåŠ¡å¯åŠ¨äº†ï¼Œä½†æ˜¯ç›®å‰æ¯ä¸ªæœåŠ¡ä¹‹é—´éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰ä»»ä½•å…³è”ã€‚</p><p>æˆ‘ä»¬éœ€è¦æ‰§è¡Œå‘½ä»¤æ¥åˆ›å»ºé›†ç¾¤ï¼Œåœ¨Redis5.0ä¹‹å‰åˆ›å»ºé›†ç¾¤æ¯”è¾ƒéº»çƒ¦ï¼Œ5.0ä¹‹åé›†ç¾¤ç®¡ç†å‘½ä»¤éƒ½é›†æˆåˆ°äº†redis-cliä¸­ã€‚</p><ol><li>Redis5.0ä¹‹å‰</li></ol><p>Redis5.0ä¹‹å‰é›†ç¾¤å‘½ä»¤éƒ½æ˜¯ç”¨rediså®‰è£…åŒ…ä¸‹çš„src/redis-trib.rbæ¥å®ç°çš„ã€‚å› ä¸ºredis-trib.rbæ˜¯æœ‰rubyè¯­è¨€ç¼–å†™çš„æ‰€ä»¥éœ€è¦å®‰è£…rubyç¯å¢ƒã€‚</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">yum -y install zlib ruby rubygems</span><br><span class="line">gem install redis</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡å‘½ä»¤æ¥ç®¡ç†é›†ç¾¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥redisçš„srcç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /tmp/redis-6.2.4/src</span><br><span class="line"><span class="comment"># åˆ›å»ºé›†ç¾¤</span></span><br><span class="line">./redis-trib.rb create --replicas 1 192.168.150.101:7001 192.168.150.101:7002 192.168.150.101:7003 192.168.150.101:8001 192.168.150.101:8002 192.168.150.101:8003</span><br></pre></td></tr></table></figure><ol start="2"><li>Redis5.0ä»¥å</li></ol><p>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Redis6.2.4ç‰ˆæœ¬ï¼Œé›†ç¾¤ç®¡ç†ä»¥åŠé›†æˆåˆ°äº†redis-cliä¸­ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><blockquote><p>æ³¨æ„ï¼šäº‘æœåŠ¡å™¨æ­¤å¤„åœ°å€å¡«ï¼š127.0.0.1</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster create --cluster-replicas 1 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:8001 127.0.0.1:8002 127.0.0.1:8003</span><br></pre></td></tr></table></figure><p>å‘½ä»¤è¯´æ˜ï¼š</p><ul><li><code>redis-cli --cluster</code>æˆ–è€…<code>./redis-trib.rb</code>ï¼šä»£è¡¨é›†ç¾¤æ“ä½œå‘½ä»¤</li><li><code>create</code>ï¼šä»£è¡¨æ˜¯åˆ›å»ºé›†ç¾¤</li><li><code>--replicas 1</code>æˆ–è€…<code>--cluster-replicas 1</code> ï¼šæŒ‡å®šé›†ç¾¤ä¸­æ¯ä¸ªmasterçš„å‰¯æœ¬ä¸ªæ•°ä¸º1ï¼Œæ­¤æ—¶<code>èŠ‚ç‚¹æ€»æ•° Ã· (replicas + 1)</code> å¾—åˆ°çš„å°±æ˜¯masterçš„æ•°é‡ã€‚å› æ­¤èŠ‚ç‚¹åˆ—è¡¨ä¸­çš„å‰nä¸ªå°±æ˜¯masterï¼Œå…¶å®ƒèŠ‚ç‚¹éƒ½æ˜¯slaveèŠ‚ç‚¹ï¼Œéšæœºåˆ†é…åˆ°ä¸åŒmaster</li></ul><p>è¿è¡Œåçš„æ ·å­ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/ec31075c3dad41ecbb8ac761d8570c6c" alt="image-20210702181101969"></p><p>è¿™é‡Œè¾“å…¥yesï¼Œåˆ™é›†ç¾¤å¼€å§‹åˆ›å»ºï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/d37cb339cfe4435eab9a2e03cb277516" alt="image-20210702181215705"></p><p>é€šè¿‡å‘½ä»¤å¯ä»¥æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 7001 cluster nodes</span><br></pre></td></tr></table></figure><p><img src="https://s1.vika.cn/space/2023/03/19/19164674353249f99695362b0a6dd530" alt="image-20210702181922809"></p><h3 id="ce-shi-2" id="æµ‹è¯•-3">æµ‹è¯•</h3><p>å°è¯•è¿æ¥7001èŠ‚ç‚¹ï¼Œå­˜å‚¨ä¸€ä¸ªæ•°æ®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥</span></span><br><span class="line">redis-cli -p 7001</span><br><span class="line"><span class="comment"># å­˜å‚¨æ•°æ®</span></span><br><span class="line"><span class="built_in">set</span> num 123</span><br><span class="line"><span class="comment"># è¯»å–æ•°æ®</span></span><br><span class="line">get num</span><br><span class="line"><span class="comment"># å†æ¬¡å­˜å‚¨</span></span><br><span class="line"><span class="built_in">set</span> a 1</span><br></pre></td></tr></table></figure><p>ç»“æœæ‚²å‰§äº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/0d5b78b07e454e14acdfc323459b4c6b" alt="image-20210702182343979"></p><p>é›†ç¾¤æ“ä½œæ—¶ï¼Œéœ€è¦ç»™<code>redis-cli</code>åŠ ä¸Š<code>-c</code>å‚æ•°æ‰å¯ä»¥ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c -p 7001</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡å¯ä»¥äº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/e2042246ec6e4d409f0746c17b999b3d" alt="image-20210702182602145"></p><h2 id="san-lie-cha-cao" id="æ•£åˆ—æ’æ§½">æ•£åˆ—æ’æ§½</h2><h3 id="cha-cao-yuan-li" id="æ’æ§½åŸç†">æ’æ§½åŸç†</h3><p>Redisä¼šæŠŠæ¯ä¸€ä¸ªmasterèŠ‚ç‚¹æ˜ å°„åˆ°0~16383å…±16384ä¸ªæ’æ§½ï¼ˆhash slotï¼‰ä¸Šï¼ŒæŸ¥çœ‹é›†ç¾¤ä¿¡æ¯æ—¶å°±èƒ½çœ‹åˆ°ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/c3839a6c0bb34af0b6a27ab9e90aee58" alt="image-20210725155820320"></p><p>æ•°æ®keyä¸æ˜¯ä¸èŠ‚ç‚¹ç»‘å®šï¼Œè€Œæ˜¯ä¸æ’æ§½ç»‘å®šã€‚redisä¼šæ ¹æ®keyçš„æœ‰æ•ˆéƒ¨åˆ†è®¡ç®—<code>æ’æ§½å€¼</code>ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š</p><ul><li>keyä¸­åŒ…å«&quot;{}&quot;ï¼Œä¸”â€œ{}â€ä¸­è‡³å°‘åŒ…å«1ä¸ªå­—ç¬¦ï¼Œâ€œ{}â€ä¸­çš„éƒ¨åˆ†æ˜¯æœ‰æ•ˆéƒ¨åˆ†</li><li>keyä¸­ä¸åŒ…å«â€œ{}â€ï¼Œæ•´ä¸ªkeyéƒ½æ˜¯æœ‰æ•ˆéƒ¨åˆ†</li></ul><p><strong>ä¾‹å¦‚</strong>ï¼škeyæ˜¯numï¼Œé‚£ä¹ˆå°±æ ¹æ®numè®¡ç®—ï¼Œå¦‚æœæ˜¯<code>&#123;itcast&#125;num</code>ï¼Œåˆ™æ ¹æ®itcastè®¡ç®—ã€‚è®¡ç®—æ–¹å¼æ˜¯åˆ©ç”¨<code>CRC16ç®—æ³•</code>å¾—åˆ°ä¸€ä¸ª<code>hashå€¼</code>ï¼Œç„¶åå¯¹16384<code>å–ä½™</code>ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯<code>slotå€¼</code>ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/19/4134ea305a1f4287ad98459c117eb429" alt="image-20210725155850200"></p><ul><li><p>å¦‚å›¾ï¼Œåœ¨7001è¿™ä¸ªèŠ‚ç‚¹æ‰§è¡Œset a 1æ—¶ï¼Œå¯¹aåšhashè¿ç®—ï¼Œå¯¹16384å–ä½™ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯15495ï¼Œå› æ­¤è¦å­˜å‚¨åˆ°103èŠ‚ç‚¹ã€‚</p></li><li><p>åˆ°äº†7003åï¼Œæ‰§è¡Œ<code>get num</code>æ—¶ï¼Œå¯¹numåšhashè¿ç®—ï¼Œå¯¹16384å–ä½™ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯2765ï¼Œå› æ­¤éœ€è¦åˆ‡æ¢åˆ°7001èŠ‚ç‚¹</p></li></ul><h3 id="xiao-jie-3" id="å°ç»“-4">å°ç»“</h3><p>Rediså¦‚ä½•åˆ¤æ–­æŸä¸ªkeyåº”è¯¥åœ¨å“ªä¸ªå®ä¾‹ï¼Ÿ</p><ul><li>å°†16384ä¸ªæ’æ§½åˆ†é…åˆ°<code>ä¸åŒ</code>çš„å®ä¾‹</li><li>æ ¹æ®keyçš„æœ‰æ•ˆéƒ¨åˆ†è®¡ç®—å“ˆå¸Œå€¼ï¼Œå¯¹16384<code>å–ä½™</code></li><li><code>ä½™æ•°</code>ä½œä¸ºæ’æ§½ï¼Œå¯»æ‰¾æ’æ§½æ‰€åœ¨<code>å®ä¾‹</code>å³å¯</li></ul><p>å¦‚ä½•å°†åŒä¸€ç±»æ•°æ®å›ºå®šçš„ä¿å­˜åœ¨åŒä¸€ä¸ªRediså®ä¾‹ï¼Ÿ</p><ul><li>è¿™ä¸€ç±»æ•°æ®ä½¿ç”¨<code>ç›¸åŒçš„æœ‰æ•ˆéƒ¨åˆ†</code>ï¼Œä¾‹å¦‚keyéƒ½ä»¥<code>&#123;typeId&#125;</code>ä¸ºå‰ç¼€</li></ul><h2 id="ji-qun-shen-suo" id="é›†ç¾¤ä¼¸ç¼©">é›†ç¾¤ä¼¸ç¼©</h2><p>redis-cli --clusteræä¾›äº†å¾ˆå¤šæ“ä½œé›†ç¾¤çš„å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢æ–¹å¼æŸ¥çœ‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/df1456d613d242cca36a41dc8c9a8122" alt="image-20210725160138290"></p><p>æ¯”å¦‚ï¼Œæ·»åŠ èŠ‚ç‚¹çš„å‘½ä»¤ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/34d98690a3a24de0b8f16414f9276a7d" alt="image-20210725160448139"></p><h3 id="xu-qiu-fen-xi" id="éœ€æ±‚åˆ†æ">éœ€æ±‚åˆ†æ</h3><blockquote><p>éœ€æ±‚ï¼šå‘é›†ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„masterèŠ‚ç‚¹ï¼Œå¹¶å‘å…¶ä¸­å­˜å‚¨ num = 10</p><ul><li>å¯åŠ¨ä¸€ä¸ªæ–°çš„rediså®ä¾‹ï¼Œç«¯å£ä¸º7004</li><li>æ·»åŠ 7004åˆ°ä¹‹å‰çš„é›†ç¾¤ï¼Œå¹¶ä½œä¸ºä¸€ä¸ªmasterèŠ‚ç‚¹</li><li>ç»™7004èŠ‚ç‚¹åˆ†é…æ’æ§½ï¼Œä½¿å¾—numè¿™ä¸ªkeyå¯ä»¥å­˜å‚¨åˆ°7004å®ä¾‹</li></ul></blockquote><p>è¿™é‡Œéœ€è¦ä¸¤ä¸ªæ–°çš„åŠŸèƒ½ï¼š</p><ul><li>æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹åˆ°é›†ç¾¤ä¸­</li><li>å°†éƒ¨åˆ†æ’æ§½åˆ†é…åˆ°æ–°æ’æ§½</li></ul><h3 id="chuang-jian-xin-de-redis-shi-li" id="åˆ›å»ºæ–°çš„rediså®ä¾‹">åˆ›å»ºæ–°çš„rediså®ä¾‹</h3><p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> 7004</span><br></pre></td></tr></table></figure><p>æ‹·è´é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> redis.conf /7004</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed /s/6379/7004/g 7004/redis.conf</span><br></pre></td></tr></table></figure><p>å¯åŠ¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server 7004/redis.conf</span><br></pre></td></tr></table></figure><h3 id="tian-jia-xin-jie-dian-dao-redis" id="æ·»åŠ æ–°èŠ‚ç‚¹åˆ°redis">æ·»åŠ æ–°èŠ‚ç‚¹åˆ°redis</h3><p>æ·»åŠ èŠ‚ç‚¹çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/34d98690a3a24de0b8f16414f9276a7d" alt="image-20210725160448139"></p><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster add-node  192.168.150.101:7004 192.168.150.101:7001</span><br></pre></td></tr></table></figure><p>é€šè¿‡å‘½ä»¤æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 7001 cluster nodes</span><br></pre></td></tr></table></figure><p>å¦‚å›¾ï¼Œ7004åŠ å…¥äº†é›†ç¾¤ï¼Œå¹¶ä¸”é»˜è®¤æ˜¯ä¸€ä¸ªmasterèŠ‚ç‚¹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/1c4d809bab0941bca213f0f45cb60d07" alt="image-20210725161007099"></p><p>ä½†æ˜¯ï¼Œå¯ä»¥çœ‹åˆ°7004èŠ‚ç‚¹çš„æ’æ§½æ•°é‡ä¸º0ï¼Œå› æ­¤æ²¡æœ‰ä»»ä½•æ•°æ®å¯ä»¥å­˜å‚¨åˆ°7004ä¸Š</p><h3 id="zhuan-yi-cha-cao" id="è½¬ç§»æ’æ§½">è½¬ç§»æ’æ§½</h3><p>æˆ‘ä»¬è¦å°†numå­˜å‚¨åˆ°7004èŠ‚ç‚¹ï¼Œå› æ­¤éœ€è¦å…ˆçœ‹çœ‹numçš„æ’æ§½æ˜¯å¤šå°‘ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/6ab6662522304d4aa69501cc233ed8fb" alt="image-20210725161241793"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œnumçš„æ’æ§½ä¸º2765.</p><p>æˆ‘ä»¬å¯ä»¥å°†0~3000çš„æ’æ§½ä»7001è½¬ç§»åˆ°7004ï¼Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/ac278a3aa2c040f6bad71d1a7171a32b" alt="image-20210725161401925"></p><p>å…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š</p><p>å»ºç«‹è¿æ¥ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/57b4ee307b42410c8ca2de5cf88ceeb9" alt="image-20210725161506241"></p><p>å¾—åˆ°ä¸‹é¢çš„åé¦ˆï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/0cd95b6b00514783b4815199faa4dd2d" alt="image-20210725161540841"></p><p>è¯¢é—®è¦ç§»åŠ¨å¤šå°‘ä¸ªæ’æ§½ï¼Œæˆ‘ä»¬è®¡åˆ’æ˜¯3000ä¸ªï¼š</p><p>æ–°çš„é—®é¢˜æ¥äº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/caed168289244af690731d52c99db695" alt="image-20210725161637152"></p><p>é‚£ä¸ªnodeæ¥æ¥æ”¶è¿™äº›æ’æ§½ï¼Ÿï¼Ÿ</p><p>æ˜¾ç„¶æ˜¯7004ï¼Œé‚£ä¹ˆ7004èŠ‚ç‚¹çš„idæ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p><img src="https://s1.vika.cn/space/2023/03/19/c45d4de1f7fb4405bcbe52ed879afa7a" alt="image-20210725161731738"></p><p>å¤åˆ¶è¿™ä¸ªidï¼Œç„¶åæ‹·è´åˆ°åˆšæ‰çš„æ§åˆ¶å°åï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/038d9bc24e1a44cf9ba781b209a5a8f9" alt="image-20210725161817642"></p><p>è¿™é‡Œè¯¢é—®ï¼Œä½ çš„æ’æ§½æ˜¯ä»å“ªé‡Œç§»åŠ¨è¿‡æ¥çš„ï¼Ÿ</p><ul><li>allï¼šä»£è¡¨å…¨éƒ¨ï¼Œä¹Ÿå°±æ˜¯ä¸‰ä¸ªèŠ‚ç‚¹å„è½¬ç§»ä¸€éƒ¨åˆ†</li><li>å…·ä½“çš„idï¼šç›®æ ‡èŠ‚ç‚¹çš„id</li><li>doneï¼šæ²¡æœ‰äº†</li></ul><p>è¿™é‡Œæˆ‘ä»¬è¦ä»7001è·å–ï¼Œå› æ­¤å¡«å†™7001çš„idï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/e72f9472b7334d67865da1b92b8212db" alt="image-20210725162030478"></p><p>å¡«å®Œåï¼Œç‚¹å‡»doneï¼Œè¿™æ ·æ’æ§½è½¬ç§»å°±å‡†å¤‡å¥½äº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/5a5a1e2a8238407da2fdbcf010c7722e" alt="image-20210725162101228"></p><p>ç¡®è®¤è¦è½¬ç§»å—ï¼Ÿè¾“å…¥yesï¼š</p><p>ç„¶åï¼Œé€šè¿‡å‘½ä»¤æŸ¥çœ‹ç»“æœï¼š</p><p><img src="assets/image-20210725162145497.png" alt="image-20210725162145497"></p><p>å¯ä»¥çœ‹åˆ°ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/c2b13989d8ed49a0979d44cadcf8c11e" alt="image-20210725162224058"></p><p>ç›®çš„è¾¾æˆã€‚</p><h3 id="shan-chu-jie-dian" id="åˆ é™¤èŠ‚ç‚¹">åˆ é™¤èŠ‚ç‚¹</h3><ol><li>é¦–å…ˆæŠŠèŠ‚ç‚¹æ‹¥æœ‰çš„æ’æ§½<code>reshard</code>åˆ°å…¶å®ƒèŠ‚ç‚¹ï¼Œç¡®ä¿åˆ é™¤èŠ‚ç‚¹ä¸Šæ²¡æœ‰æ’æ§½</li><li>æ‰§è¡Œ<code>del-node</code> åˆ é™¤èŠ‚ç‚¹</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster reshard 127.0.0.1:7001</span><br><span class="line"></span><br><span class="line">redis-cli --cluster del-node 127.0.0.1:7001 [ID]7004çš„<span class="built_in">id</span></span><br></pre></td></tr></table></figure><h2 id="gu-zhang-zhuan-yi" id="æ•…éšœè½¬ç§»">æ•…éšœè½¬ç§»</h2><p>é›†ç¾¤åˆè¯†çŠ¶æ€æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/e49d2c8b881d421fa7a223ba28d8da50" alt="image-20210727161152065"></p><p>å…¶ä¸­7001ã€7002ã€7003éƒ½æ˜¯masterï¼Œæˆ‘ä»¬è®¡åˆ’è®©7002å®•æœºã€‚</p><h3 id="zi-dong-gu-zhang-zhuan-yi" id="è‡ªåŠ¨æ•…éšœè½¬ç§»">è‡ªåŠ¨æ•…éšœè½¬ç§»</h3><p>å½“é›†ç¾¤ä¸­æœ‰ä¸€ä¸ªmasterå®•æœºä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ç›´æ¥åœæ­¢ä¸€ä¸ªrediså®ä¾‹ï¼Œä¾‹å¦‚7002ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 7002 shutdown</span><br></pre></td></tr></table></figure><p>1ï¼‰é¦–å…ˆæ˜¯è¯¥å®ä¾‹ä¸å…¶å®ƒå®ä¾‹å¤±å»è¿æ¥</p><p>2ï¼‰ç„¶åæ˜¯ç–‘ä¼¼å®•æœºï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/260bed7b5bdf40b88af04f14396d866a" alt="image-20210725162319490"></p><p>3ï¼‰æœ€åæ˜¯ç¡®å®šä¸‹çº¿ï¼Œè‡ªåŠ¨æå‡ä¸€ä¸ªslaveä¸ºæ–°çš„masterï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/9bb5c8600c73453a8cb70ec6274c2109" alt="image-20210725162408979"></p><p>4ï¼‰å½“7002å†æ¬¡å¯åŠ¨ï¼Œå°±ä¼šå˜ä¸ºä¸€ä¸ªslaveèŠ‚ç‚¹äº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/ebd938affc7e45ee8a1e2915c496ebfa" alt="image-20210727160803386"></p><h3 id="shou-dong-gu-zhang-zhuan-yi" id="æ‰‹åŠ¨æ•…éšœè½¬ç§»">æ‰‹åŠ¨æ•…éšœè½¬ç§»</h3><p>åˆ©ç”¨cluster failoverå‘½ä»¤å¯ä»¥æ‰‹åŠ¨è®©é›†ç¾¤ä¸­çš„æŸä¸ªmasterå®•æœºï¼Œåˆ‡æ¢åˆ°æ‰§è¡Œ<code>cluster failover</code>å‘½ä»¤çš„è¿™ä¸ªslaveèŠ‚ç‚¹ï¼Œå®ç°æ— æ„ŸçŸ¥çš„æ•°æ®è¿ç§»ã€‚å…¶æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/611e0097de094a15b3c5bbc9999c28ee" alt="image-20210725162441407"></p><p>è¿™ç§failoverå‘½ä»¤å¯ä»¥æŒ‡å®šä¸‰ç§æ¨¡å¼ï¼š</p><ul><li>ç¼ºçœï¼šé»˜è®¤çš„æµç¨‹ï¼Œå¦‚å›¾1~6æ­©</li><li>forceï¼šçœç•¥äº†å¯¹offsetçš„ä¸€è‡´æ€§æ ¡éªŒ</li><li>takeoverï¼šç›´æ¥æ‰§è¡Œç¬¬5æ­©ï¼Œå¿½ç•¥æ•°æ®ä¸€è‡´æ€§ã€å¿½ç•¥masterçŠ¶æ€å’Œå…¶å®ƒmasterçš„æ„è§</li></ul><blockquote><p><strong>æ¡ˆä¾‹éœ€æ±‚</strong>ï¼šåœ¨7002è¿™ä¸ªslaveèŠ‚ç‚¹æ‰§è¡Œæ‰‹åŠ¨æ•…éšœè½¬ç§»ï¼Œé‡æ–°å¤ºå›masteråœ°ä½</p><p>æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>1ï¼‰åˆ©ç”¨redis-cliè¿æ¥7002è¿™ä¸ªèŠ‚ç‚¹</p><p>2ï¼‰æ‰§è¡Œ<code>cluster failover</code>å‘½ä»¤</p></blockquote><p>å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/7580e63fd6d44f8689d0e60fe0dd1639" alt="image-20210727160037766"></p><p>æ•ˆæœï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/e49d2c8b881d421fa7a223ba28d8da50" alt="image-20210727161152065"></p><h2 id="redis-template-fang-wen-fen-pian-ji-qun" id="RedisTemplateè®¿é—®åˆ†ç‰‡é›†ç¾¤">RedisTemplateè®¿é—®åˆ†ç‰‡é›†ç¾¤</h2><p>RedisTemplateåº•å±‚åŒæ ·åŸºäºlettuceå®ç°äº†åˆ†ç‰‡é›†ç¾¤çš„æ”¯æŒï¼Œè€Œä½¿ç”¨çš„æ­¥éª¤ä¸å“¨å…µæ¨¡å¼åŸºæœ¬ä¸€è‡´ï¼š</p><p>1ï¼‰å¼•å…¥redisçš„starterä¾èµ–</p><p>2ï¼‰é…ç½®åˆ†ç‰‡é›†ç¾¤åœ°å€</p><p>3ï¼‰é…ç½®è¯»å†™åˆ†ç¦»</p><p>ä¸å“¨å…µæ¨¡å¼ç›¸æ¯”ï¼Œå…¶ä¸­åªæœ‰åˆ†ç‰‡é›†ç¾¤çš„é…ç½®æ–¹å¼ç•¥æœ‰å·®å¼‚ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">cluster:</span></span><br><span class="line">      <span class="attr">nodes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span><span class="string">:7001</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span><span class="string">:7002</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span><span class="string">:7003</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span><span class="string">:8001</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span><span class="string">:8002</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span><span class="string">:8003</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Redis æŒä¹…åŒ–ã€ä¸»ä»ã€å“¨å…µã€åˆ†ç‰‡é›†ç¾¤</summary>
    
    
    
    <category term="Java" scheme="https://www.taoyaopc.live/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>è®¡ç®—æœºç»„æˆåŸç†2</title>
    <link href="https://www.taoyaopc.live/posts/cd552799.html"/>
    <id>https://www.taoyaopc.live/posts/cd552799.html</id>
    <published>2023-04-01T04:00:00.000Z</published>
    <updated>2023-04-02T14:08:55.992Z</updated>
    
    
    <summary type="html">ç¬¬2ç« ---è¿ç®—æ–¹æ³•å’Œè¿ç®—å™¨</summary>
    
    
    
    <category term="è®¡ç®—æœºåŸºç¡€" scheme="https://www.taoyaopc.live/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"/>
    
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ç»ƒä¹ é¢˜</title>
    <link href="https://www.taoyaopc.live/posts/8248c3b2.html"/>
    <id>https://www.taoyaopc.live/posts/8248c3b2.html</id>
    <published>2023-03-30T08:30:00.000Z</published>
    <updated>2023-03-30T08:29:25.165Z</updated>
    
    <content type="html"><![CDATA[<h1 id="lian-xi">ç»ƒä¹ </h1><h1 id="shi-jian-fu-za-du">æ—¶é—´å¤æ‚åº¦</h1><p>ç”¨å‡½æ•° $f(n)$ è¡¨ç¤ºç®—æ³•æ•ˆç‡ä¸æ•°æ®è§„æ¨¡çš„å…³ç³»ï¼Œå‡è®¾æ¯æ¬¡è§£å†³é—®é¢˜éœ€è¦ 1 å¾®ç§’ï¼ˆ$10^{-6}$ ç§’ï¼‰ï¼Œè¿›è¡Œä¼°ç®—ï¼š</p><ol><li>å¦‚æœ $f(n) = n^2$ é‚£ä¹ˆ 1 ç§’èƒ½è§£å†³å¤šå°‘æ¬¡é—®é¢˜ï¼Ÿ1 å¤©å‘¢ï¼Ÿ</li><li>å¦‚æœ $f(n) = log_2(n)$  é‚£ä¹ˆ 1 ç§’èƒ½è§£å†³å¤šå°‘æ¬¡é—®é¢˜ï¼Ÿ1 å¤©å‘¢ï¼Ÿ</li><li>å¦‚æœ $f(n) = n!$ é‚£ä¹ˆ 1 ç§’èƒ½è§£å†³å¤šå°‘æ¬¡é—®é¢˜ï¼Ÿ1 å¤©å‘¢ï¼Ÿ</li></ol><p>å‚è€ƒè§£ç­”</p><ol><li>1ç§’ $\sqrt{10^6} = 1000$ æ¬¡ï¼Œ1 å¤© $\sqrt{10^6 * 3600 * 24} \approx 293938$ æ¬¡</li><li>1ç§’ $2^{1,000,000} $ æ¬¡ï¼Œä¸€å¤© $2^{86,400,000,000}$</li><li>æ¨ç®—å¦‚ä¸‹<ul><li>$10! = 3,628,800$ 1ç§’èƒ½è§£å†³ $1,000,000$ æ¬¡ï¼Œå› æ­¤æ¬¡æ•°ä¸º 9 æ¬¡</li><li>$14!=87,178,291,200$ï¼Œä¸€å¤©èƒ½è§£å†³ $86,400,000,000$ æ¬¡ï¼Œå› æ­¤æ¬¡æ•°ä¸º 13 æ¬¡</li></ul></li></ol><h1 id="er-fen-cha-zhao">äºŒåˆ†æŸ¥æ‰¾</h1><ul><li><a href="https://leetcode.cn/problems/sqrtx/">69. x çš„å¹³æ–¹æ ¹ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></li></ul><h3 id="e-01-er-fen-cha-zhao-li-kou-704-ti" id="E01-äºŒåˆ†æŸ¥æ‰¾-åŠ›æ‰£-704-é¢˜">E01. äºŒåˆ†æŸ¥æ‰¾-åŠ›æ‰£ 704 é¢˜</h3><p><strong>è¦ç‚¹</strong>ï¼šå‡è€Œæ²»ä¹‹ï¼Œå¯ä»¥ç”¨é€’å½’æˆ–éé€’å½’å®ç°</p><p>ç»™å®šä¸€ä¸ª n ä¸ªå…ƒç´ æœ‰åºçš„ï¼ˆå‡åºï¼‰æ•´å‹æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ target  ï¼Œå†™ä¸€ä¸ªå‡½æ•°æœç´¢ nums ä¸­çš„ targetï¼Œå¦‚æœç›®æ ‡å€¼å­˜åœ¨è¿”å›ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› -1</p><p>ä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: nums = [-<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">12</span>], target = <span class="number">9</span></span><br><span class="line">è¾“å‡º: <span class="number">4</span></span><br><span class="line">è§£é‡Š: <span class="number">9</span> å‡ºç°åœ¨ nums ä¸­å¹¶ä¸”ä¸‹æ ‡ä¸º <span class="number">4</span></span><br><span class="line">    </span><br><span class="line">è¾“å…¥: nums = [-<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">12</span>], target = <span class="number">2</span></span><br><span class="line">è¾“å‡º: -<span class="number">1</span></span><br><span class="line">è§£é‡Š: <span class="number">2</span> ä¸å­˜åœ¨ nums ä¸­å› æ­¤è¿”å› -<span class="number">1</span>    </span><br></pre></td></tr></table></figure><p><strong>å‚è€ƒç­”æ¡ˆ</strong>ï¼šç•¥ï¼Œå¯ä»¥ç”¨è®²è¿‡çš„ä»»æ„ä¸€ç§äºŒåˆ†æ±‚è§£</p><h3 id="e-02-sou-suo-cha-ru-wei-zhi-li-kou-35-ti" id="E02-æœç´¢æ’å…¥ä½ç½®-åŠ›æ‰£-35-é¢˜">E02. æœç´¢æ’å…¥ä½ç½®-åŠ›æ‰£ 35 é¢˜</h3><p><strong>è¦ç‚¹</strong>ï¼šç†è§£è°ä»£è¡¨æ’å…¥ä½ç½®</p><p>ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„å’Œä¸€ä¸ªç›®æ ‡å€¼</p><ul><li>åœ¨æ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œå¹¶è¿”å›å…¶ç´¢å¼•</li><li>å¦‚æœç›®æ ‡å€¼ä¸å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œè¿”å›å®ƒå°†ä¼šè¢«æŒ‰é¡ºåºæ’å…¥çš„ä½ç½®</li></ul><p>ä¾‹å¦‚</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">è¾“å…¥: nums = [1,3,5,6], target = 5</span></span><br><span class="line"><span class="section">è¾“å‡º: 2</span></span><br><span class="line"></span><br><span class="line"><span class="section">è¾“å…¥: nums = [1,3,5,6], target = 2</span></span><br><span class="line"><span class="section">è¾“å‡º: 1</span></span><br><span class="line"></span><br><span class="line"><span class="section">è¾“å…¥: nums = [1,3,5,6], target = 7</span></span><br><span class="line"><span class="section">è¾“å‡º: 4</span></span><br></pre></td></tr></table></figure><p><strong>å‚è€ƒç­”æ¡ˆ1</strong>ï¼šç”¨äºŒåˆ†æŸ¥æ‰¾åŸºç¡€ç‰ˆä»£ç æ”¹å†™ï¼ŒåŸºç¡€ç‰ˆä¸­ï¼Œæ‰¾åˆ°è¿”å› mï¼Œæ²¡æ‰¾åˆ° i ä»£è¡¨æ’å…¥ç‚¹ï¼Œå› æ­¤æœ‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">searchInsert</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = a.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= j) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; a[m]) &#123;</span><br><span class="line">            j = m - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[m] &lt; target) &#123;</span><br><span class="line">            i = m + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> m;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i; <span class="comment">// åŸå§‹ return -1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å‚è€ƒç­”æ¡ˆ2</strong>ï¼šç”¨äºŒåˆ†æŸ¥æ‰¾å¹³è¡¡ç‰ˆæ”¹å†™ï¼Œå¹³è¡¡ç‰ˆä¸­</p><ul><li>å¦‚æœ target == a[i] è¿”å› i è¡¨ç¤ºæ‰¾åˆ°</li><li>å¦‚æœ target &lt; a[i]ï¼Œä¾‹å¦‚ target = 2ï¼Œa[i] = 3ï¼Œè¿™æ—¶å°±åº”è¯¥åœ¨ i ä½ç½®æ’å…¥ 2</li><li>å¦‚æœ a[i] &lt; targetï¼Œä¾‹å¦‚ a[i] = 3ï¼Œtarget = 4ï¼Œè¿™æ—¶å°±åº”è¯¥åœ¨ i+1 ä½ç½®æ’å…¥ 4</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">searchInsert</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = a.length;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span> &lt; j - i) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; a[m]) &#123;</span><br><span class="line">            j = m;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            i = m;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (target &lt;= a[i]) ? i : i + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// åŸå§‹ (target == a[i]) ? i : -1;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å‚è€ƒç­”æ¡ˆ3</strong>ï¼šç”¨ leftmost ç‰ˆæœ¬è§£ï¼Œè¿”å›å€¼å³ä¸ºæ’å…¥ä½ç½®ï¼ˆå¹¶èƒ½å¤„ç†å…ƒç´ é‡å¤çš„æƒ…å†µï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">searchInsert</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = a.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt;= j) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(target &lt;= a[m]) &#123;</span><br><span class="line">            j = m - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            i = m + <span class="number">1</span>;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-03-sou-suo-kai-shi-jie-shu-wei-zhi-li-kou-34-ti" id="E03-æœç´¢å¼€å§‹ç»“æŸä½ç½®-åŠ›æ‰£-34-é¢˜">E03. æœç´¢å¼€å§‹ç»“æŸä½ç½®-åŠ›æ‰£ 34 é¢˜</h3><p>ç»™ä½ ä¸€ä¸ªæŒ‰ç…§éé€’å‡é¡ºåºæ’åˆ—çš„æ•´æ•°æ•°ç»„ numsï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ targetã€‚è¯·ä½ æ‰¾å‡ºç»™å®šç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚</p><p>å¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨ç›®æ ‡å€¼ targetï¼Œè¿”å› [-1, -1]ã€‚</p><p>ä½ å¿…é¡»è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(log n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜</p><p>ä¾‹å¦‚</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = <span class="comment">[5,7,7,8,8,10]</span>, target = 8</span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[3,4]</span></span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šnums = <span class="comment">[5,7,7,8,8,10]</span>, target = 6</span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[-1,-1]</span></span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šnums = <span class="comment">[]</span>, target = 0</span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[-1,-1]</span></span><br></pre></td></tr></table></figure><p><strong>å‚è€ƒç­”æ¡ˆ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">left</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = a.length - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">candidate</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= j) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; a[m]) &#123;</span><br><span class="line">            j = m - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[m] &lt; target) &#123;</span><br><span class="line">            i = m + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            candidate = m;</span><br><span class="line">            j = m - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> candidate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">right</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = a.length - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">candidate</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= j) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; a[m]) &#123;</span><br><span class="line">            j = m - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[m] &lt; target) &#123;</span><br><span class="line">            i = m + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            candidate = m;</span><br><span class="line">            i = m + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> candidate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] searchRange(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> left(nums, target);</span><br><span class="line">    <span class="keyword">if</span>(x == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[] &#123;-<span class="number">1</span>, -<span class="number">1</span>&#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[] &#123;x, right(nums, target)&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="di-gui-single-recursion">é€’å½’ - single recursion</h1><h3 id="e-03-er-fen-cha-zhao" id="E03-äºŒåˆ†æŸ¥æ‰¾">E03. äºŒåˆ†æŸ¥æ‰¾</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> recursion(a, target, <span class="number">0</span>, a.length - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">recursion</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; j) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (target &lt; a[m]) &#123;</span><br><span class="line">        <span class="keyword">return</span> recursion(a, target, i, m - <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[m] &lt; target) &#123;</span><br><span class="line">        <span class="keyword">return</span> recursion(a, target, m + <span class="number">1</span>, j);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-04-mou-pao-pai-xu" id="E04-å†’æ³¡æ’åº">E04. å†’æ³¡æ’åº</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] a = &#123;<span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">7</span>&#125;;</span><br><span class="line">    bubble(a, <span class="number">0</span>, a.length - <span class="number">1</span>);</span><br><span class="line">    System.out.println(Arrays.toString(a));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bubble</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> low, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(low == high) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> low;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> low; i &lt; high; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] &gt; a[i + <span class="number">1</span>]) &#123;</span><br><span class="line">            swap(a, i, i + <span class="number">1</span>);</span><br><span class="line">            j = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    bubble(a, low, j);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> a[i];</span><br><span class="line">    a[i] = a[j];</span><br><span class="line">    a[j] = t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>low ä¸ high ä¸ºæœªæ’åºèŒƒå›´</li><li>j è¡¨ç¤ºçš„æ˜¯æœªæ’åºçš„è¾¹ç•Œï¼Œä¸‹ä¸€æ¬¡é€’å½’æ—¶çš„ high<ul><li>å‘ç”Ÿäº¤æ¢ï¼Œæ„å‘³ç€æœ‰æ— åºæƒ…å†µ</li><li>æœ€åä¸€æ¬¡äº¤æ¢ï¼ˆä»¥åæ²¡æœ‰æ— åºï¼‰æ—¶ï¼Œå·¦ä¾§ i ä»æ˜¯æ— åºï¼Œå³ä¾§ i+1 å·²ç„¶æœ‰åº</li></ul></li><li>è§†é¢‘ä¸­è®²è§£çš„æ˜¯åªè€ƒè™‘ high è¾¹ç•Œçš„æƒ…å†µï¼Œå‚è€ƒä»¥ä¸Šä»£ç ï¼Œç†è§£åœ¨ low â€¦ high èŒƒå›´å†…çš„å¤„ç†æ–¹æ³•</li></ul><h3 id="e-05-cha-ru-pai-xu" id="E05-æ’å…¥æ’åº">E05. æ’å…¥æ’åº</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] a = &#123;<span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">4</span>&#125;;</span><br><span class="line">    insertion(a, <span class="number">1</span>, a.length - <span class="number">1</span>);</span><br><span class="line">    System.out.println(Arrays.toString(a));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">insertion</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> low, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (low &gt; high) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> low - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> a[low];</span><br><span class="line">    <span class="keyword">while</span> (i &gt;= <span class="number">0</span> &amp;&amp; a[i] &gt; i) &#123;</span><br><span class="line">        a[i + <span class="number">1</span>] = a[i];</span><br><span class="line">        i--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(i + <span class="number">1</span> != low) &#123;</span><br><span class="line">        a[i + <span class="number">1</span>] = t;</span><br><span class="line">    &#125;    </span><br><span class="line">    insertion(a, low + <span class="number">1</span>, high);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å·²æ’åºåŒºåŸŸï¼š[0 â€¦ i â€¦ low-1]</li><li>æœªæ’åºåŒºåŸŸï¼š[low â€¦ high]</li><li>è§†é¢‘ä¸­è®²è§£çš„æ˜¯åªè€ƒè™‘ low è¾¹ç•Œçš„æƒ…å†µï¼Œå‚è€ƒä»¥ä¸Šä»£ç ï¼Œç†è§£ low-1 â€¦  high èŒƒå›´å†…çš„å¤„ç†æ–¹æ³•</li><li>æ‰©å±•ï¼šåˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾ leftmost ç‰ˆæœ¬ï¼Œæ”¹è¿›å¯»æ‰¾æ’å…¥ä½ç½®çš„ä»£ç </li></ul><h3 id="e-06-yue-se-fu-wen-ti-16" id="E06-çº¦ç‘Ÿå¤«é—®é¢˜-16">E06. çº¦ç‘Ÿå¤«é—®é¢˜[^16]</h3><p>$n$ ä¸ªäººæ’æˆåœ†åœˆï¼Œä»å¤´å¼€å§‹æŠ¥æ•°ï¼Œæ¯æ¬¡æ•°åˆ°ç¬¬ $m$ ä¸ªäººï¼ˆ$m$ ä» $1$ å¼€å§‹ï¼‰æ€ä¹‹ï¼Œç»§ç»­ä»ä¸‹ä¸€ä¸ªäººé‡å¤ä»¥ä¸Šè¿‡ç¨‹ï¼Œæ±‚æœ€åæ´»ä¸‹æ¥çš„äººæ˜¯è°ï¼Ÿ</p><p><strong>æ–¹æ³•1</strong></p><p>æ ¹æ®æœ€åçš„å­˜æ´»è€… a å€’æ¨å‡ºå®ƒåœ¨ä¸Šä¸€è½®çš„ç´¢å¼•å·</p><table><thead><tr><th>f(n,m)</th><th>æœ¬è½®ç´¢å¼•</th><th>ä¸ºäº†è®© a æ˜¯è¿™ä¸ªç´¢å¼•ï¼Œä¸Šä¸€è½®åº”å½“è¿™æ ·æ’</th><th>è§„å¾‹</th></tr></thead><tbody><tr><td>f(1,3)</td><td>0</td><td>x x x a</td><td>(0 + 3) % 2</td></tr><tr><td>f(2,3)</td><td>1</td><td>x x x 0 a</td><td>(1 + 3) % 3</td></tr><tr><td>f(3,3)</td><td>1</td><td>x x x 0 a</td><td>(1 + 3) % 4</td></tr><tr><td>f(4,3)</td><td>0</td><td>x x x a</td><td>(0 + 3) % 5</td></tr><tr><td>f(5,3)</td><td>3</td><td>x x x 0 1 2 a</td><td>(3 + 3) % 6</td></tr><tr><td>f(6,3)</td><td>0</td><td>x x x a</td><td></td></tr></tbody></table><p><strong>æ–¹æ³•2</strong></p><p>è®¾ n ä¸ºæ€»äººæ•°ï¼Œm ä¸ºæŠ¥æ•°æ¬¡æ•°ï¼Œè§£è¿”å›çš„æ˜¯è¿™äº›äººçš„ç´¢å¼•ï¼Œä»0å¼€å§‹</p><table><thead><tr><th>f(n, m)</th><th>è§£</th><th>è§„å¾‹</th></tr></thead><tbody><tr><td>f(1, 3)</td><td>0</td><td></td></tr><tr><td>f(2, 3)</td><td>0 1 =&gt; 1</td><td>3%2=1</td></tr><tr><td>f(3, 3)</td><td>0 1 2 =&gt; 0 1</td><td>3%3=0</td></tr><tr><td>f(4, 3)</td><td>0 1 2 3 =&gt; 3 0 1</td><td>3%4=3</td></tr><tr><td>f(5, 3)</td><td>0 1 2 3 4  =&gt; 3 4 0 1</td><td>3%5=3</td></tr><tr><td>f(6, 3)</td><td>0 1 2 3 4 5 =&gt; 3 4 5 0 1</td><td>3%6=3</td></tr></tbody></table><p><strong>ä¸€. æ‰¾å‡ºç­‰ä»·å‡½æ•°</strong></p><p>è§„å¾‹ï¼šä¸‹æ¬¡æŠ¥æ•°çš„èµ·ç‚¹ä¸º $k = m % n$</p><ul><li>é¦–æ¬¡å‡ºåˆ—äººçš„åºå·æ˜¯ $k-1$ï¼Œå‰©ä¸‹çš„çš„ $n-1$ ä¸ªäººé‡æ–°ç»„æˆçº¦ç‘Ÿå¤«ç¯</li><li>ä¸‹æ¬¡ä» $k$ å¼€å§‹æ•°ï¼Œåºå·å¦‚ä¸‹<ul><li>$k,\ k+1, \ â€¦\ ,\ 0,\ 1,\ k-2$ï¼Œå¦‚ä¸Šä¾‹ä¸­ $3\ 4\ 5\ 0\ 1$</li></ul></li></ul><p>è¿™ä¸ªå‡½æ•°ç§°ä¹‹ä¸º $g(n-1,m)$ï¼Œå®ƒçš„æœ€ç»ˆç»“æœä¸ $f(n,m)$ æ˜¯ç›¸åŒçš„ã€‚</p><p><strong>äºŒ. æ‰¾åˆ°æ˜ å°„å‡½æ•°</strong></p><p>ç°åœ¨æƒ³åŠæ³•æ‰¾åˆ° $g(n-1,m)$ ä¸ $f(n-1, m)$ çš„å¯¹åº”å…³ç³»ï¼Œå³<br>$$<br>3 \rightarrow 0 \<br>4 \rightarrow 1 \<br>5 \rightarrow 2 \<br>0 \rightarrow 3 \<br>1 \rightarrow 4 \<br>$$<br>æ˜ å°„å‡½æ•°ä¸º<br>$$<br>mapping(x) =<br>\begin{cases}<br>x-k &amp; x=[kâ€¦n-1] \<br>x+n-k &amp; x=[0â€¦k-2]<br>\end{cases}<br>$$<br>ç­‰ä»·äºä¸‹é¢å‡½æ•°<br>$$<br>mapping(x) = (x + n - k)%{n}<br>$$<br>ä»£å…¥æµ‹è¯•ä¸€ä¸‹<br>$$<br>3 \rightarrow (3+6-3)%6 \rightarrow 0 \<br>4 \rightarrow (4+6-3)%6 \rightarrow 1 \<br>5 \rightarrow (5+6-3)%6 \rightarrow 2 \<br>0 \rightarrow (0+6-3)%6 \rightarrow 3 \<br>1 \rightarrow (1+6-3)%6 \rightarrow 4 \<br>$$<br>ç»¼ä¸Šæœ‰<br>$$<br>f(n-1,m) = mapping(g(n-1,m))<br>$$</p><p><strong>ä¸‰. æ±‚é€†æ˜ å°„å‡½æ•°</strong></p><p>æ˜ å°„å‡½æ•°æ˜¯æ ¹æ® x è®¡ç®— yï¼Œé€†æ˜ å°„å‡½æ•°å³æ ¹æ® y å¾—åˆ° x<br>$$<br>mapping^{-1}(x) = (x + k)%n<br>$$<br>ä»£å…¥æµ‹è¯•ä¸€ä¸‹<br>$$<br>0 \rightarrow (0+3)%6 \rightarrow 3 \<br>1 \rightarrow (1+3)%6 \rightarrow 4 \<br>2 \rightarrow (2+3)%6 \rightarrow 5 \<br>3 \rightarrow (3+3)%6 \rightarrow 0 \<br>4 \rightarrow (4+3)%6 \rightarrow 1 \<br>$$<br>å› æ­¤å¯ä»¥æ±‚å¾—<br>$$<br>g(n-1,m) = mapping^{-1}(f(n-1,m))<br>$$</p><p><strong>å››. é€’æ¨å¼</strong></p><p>ä»£å…¥æ¨å¯¼<br>$$<br>\begin{aligned}<br>f(n,m) = \ &amp; g(n-1,m) \<br>= \ &amp; mapping^{-1}(f(n-1,m)) \<br>= \ &amp; (f(n-1,m) + k) % n \<br>= \ &amp; (f(n-1,m) + m%n) % n \<br>= \ &amp; (f(n-1,m) + m) % n \<br>\end{aligned}<br>$$<br>æœ€åä¸€æ­¥åŒ–ç®€æ˜¯åˆ©ç”¨äº†æ¨¡è¿ç®—æ³•åˆ™</p><p>$(a+b)%n = (a%n + b%n) %n$  ä¾‹å¦‚</p><ul><li>$(6+6)%5 = 2 = (6+6%5)%5$</li><li>$(6+5)%5 = 1 = (6+5%5)%5$</li><li>$(6+4)%5 = 0 = (6+4%5)%5$</li></ul><p>æœ€ç»ˆé€’æ¨å¼<br>$$<br>f(n,m) =<br>\begin{cases}<br>(f(n-1,m) + m) % n &amp; n&gt;1\<br>0 &amp; n = 1<br>\end{cases}<br>$$</p><h1 id="3-4-di-gui-multi-recursion">3.4 é€’å½’ - multi recursion</h1><h3 id="e-02-yi-nuo-ta-13" id="E02-æ±‰è¯ºå¡”-13">E02. æ±‰è¯ºå¡”[^13]</h3><p>Tower of Hanoiï¼Œæ˜¯ä¸€ä¸ªæºäºå°åº¦å¤è€ä¼ è¯´ï¼šå¤§æ¢µå¤©åˆ›å»ºä¸–ç•Œæ—¶åšäº†ä¸‰æ ¹é‡‘åˆšçŸ³æŸ±ï¼Œåœ¨ä¸€æ ¹æŸ±å­ä»ä¸‹å¾€ä¸ŠæŒ‰å¤§å°é¡ºåºæ‘ç€ 64 ç‰‡é»„é‡‘åœ†ç›˜ï¼Œå¤§æ¢µå¤©å‘½ä»¤å©†ç½—é—¨æŠŠåœ†ç›˜é‡æ–°æ‘†æ”¾åœ¨å¦ä¸€æ ¹æŸ±å­ä¸Šï¼Œå¹¶ä¸”è§„å®š</p><ul><li>ä¸€æ¬¡åªèƒ½ç§»åŠ¨ä¸€ä¸ªåœ†ç›˜</li><li>å°åœ†ç›˜ä¸Šä¸èƒ½æ”¾å¤§åœ†ç›˜</li></ul><p>ä¸‹é¢çš„åŠ¨å›¾æ¼”ç¤ºäº†4ç‰‡åœ†ç›˜çš„ç§»åŠ¨æ–¹æ³•</p><p><img src="./imgs/Tower_of_Hanoi_4.gif" alt=""></p><p>ä½¿ç”¨ç¨‹åºä»£ç æ¨¡æ‹Ÿåœ†ç›˜çš„ç§»åŠ¨è¿‡ç¨‹ï¼Œå¹¶ä¼°ç®—å‡ºæ—¶é—´å¤æ‚åº¦</p><p><strong>æ€è·¯</strong></p><ul><li><p>å‡è®¾æ¯æ ¹æŸ±å­æ ‡å· aï¼Œbï¼Œcï¼Œæ¯ä¸ªåœ†ç›˜ç”¨ 1ï¼Œ2ï¼Œ3 â€¦ è¡¨ç¤ºå…¶å¤§å°ï¼Œåœ†ç›˜åˆå§‹åœ¨ aï¼Œè¦ç§»åŠ¨åˆ°çš„ç›®æ ‡æ˜¯ c</p></li><li><p>å¦‚æœåªæœ‰ä¸€ä¸ªåœ†ç›˜ï¼Œæ­¤æ—¶æ˜¯æœ€å°é—®é¢˜ï¼Œå¯ä»¥ç›´æ¥æ±‚è§£</p><ul><li>ç§»åŠ¨åœ†ç›˜1 $a \mapsto c$</li></ul><img src="./imgs/image-20221219090741078.png" alt="image-20221219090741078" style="zoom:50%;" /></li><li><p>å¦‚æœæœ‰ä¸¤ä¸ªåœ†ç›˜ï¼Œé‚£ä¹ˆ</p><ul><li>åœ†ç›˜1 $a \mapsto b$</li><li>åœ†ç›˜2 $a \mapsto c$</li><li>åœ†ç›˜1 $b \mapsto c$</li></ul><img src="./imgs/image-20221219091316225.png" alt="image-20221219091316225" style="zoom:50%;" /></li><li><p>å¦‚æœæœ‰ä¸‰ä¸ªåœ†ç›˜ï¼Œé‚£ä¹ˆ</p><ul><li>åœ†ç›˜12 $a \mapsto b$</li><li>åœ†ç›˜3 $a \mapsto c$</li><li>åœ†ç›˜12 $b \mapsto c$</li></ul><img src="./imgs/image-20221219091930614.png" alt="image-20221219091930614" style="zoom:50%;" /></li><li><p>å¦‚æœæœ‰å››ä¸ªåœ†ç›˜ï¼Œé‚£ä¹ˆ</p><ul><li>åœ†ç›˜ 123 $a \mapsto b$</li><li>åœ†ç›˜4 $a \mapsto c$</li><li>åœ†ç›˜ 123 $b \mapsto c$</li></ul></li></ul><img src="./imgs/image-20221219092537323.png" alt="image-20221219092537323" style="zoom:50%;" /><p><strong>é¢˜è§£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">E02HanoiTower</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">             æº å€Ÿ ç›®</span></span><br><span class="line"><span class="comment">        h(4, a, b, c) -&gt; h(3, a, c, b)</span></span><br><span class="line"><span class="comment">                         a -&gt; c</span></span><br><span class="line"><span class="comment">                         h(3, b, a, c)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> LinkedList&lt;Integer&gt; a = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> LinkedList&lt;Integer&gt; b = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> LinkedList&lt;Integer&gt; c = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">            a.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">h</span><span class="params">(<span class="type">int</span> n, LinkedList&lt;Integer&gt; a, </span></span><br><span class="line"><span class="params">                  LinkedList&lt;Integer&gt; b, </span></span><br><span class="line"><span class="params">                  LinkedList&lt;Integer&gt; c)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        h(n - <span class="number">1</span>, a, c, b);</span><br><span class="line">        c.addLast(a.removeLast());</span><br><span class="line">        print();</span><br><span class="line">        h(n - <span class="number">1</span>, b, a, c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------------&quot;</span>);</span><br><span class="line">        System.out.println(a);</span><br><span class="line">        System.out.println(b);</span><br><span class="line">        System.out.println(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        init(<span class="number">3</span>);</span><br><span class="line">        print();</span><br><span class="line">        h(<span class="number">3</span>, a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-03-yang-hui-san-jiao-6" id="E03-æ¨è¾‰ä¸‰è§’-6">E03. æ¨è¾‰ä¸‰è§’[^6]</h3><p><img src="./imgs/image-20221219172514410.png" alt="image-20221219172514410"></p><p><strong>åˆ†æ</strong></p><p>æŠŠå®ƒæ–œç€çœ‹</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">        <span class="attribute">1</span></span><br><span class="line">      <span class="attribute">1</span>   <span class="number">1</span></span><br><span class="line">    <span class="attribute">1</span>   <span class="number">2</span>   <span class="number">1</span></span><br><span class="line">  <span class="attribute">1</span>   <span class="number">3</span>   <span class="number">3</span>   <span class="number">1</span></span><br><span class="line"><span class="attribute">1</span>   <span class="number">4</span>   <span class="number">6</span>   <span class="number">4</span>   <span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li>è¡Œ $i$ï¼Œåˆ— $j$ï¼Œé‚£ä¹ˆ $[i][j]$ çš„å–å€¼åº”ä¸º $[i-1][j-1] + [i-1][j]$</li><li>å½“ $j=0$ æˆ– $i=j$ æ—¶ï¼Œ$[i][j]$ å–å€¼ä¸º $1$</li></ul><p><strong>é¢˜è§£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; n - <span class="number">1</span>) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;%&quot;</span> + <span class="number">2</span> * (n - <span class="number">1</span> - i) + <span class="string">&quot;s&quot;</span>, <span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i + <span class="number">1</span>; j++) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;%-4d&quot;</span>, element(i, j));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">element</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (j == <span class="number">0</span> || i == j) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> element(i - <span class="number">1</span>, j - <span class="number">1</span>) + element(i - <span class="number">1</span>, j);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŒ–1</strong></p><p>æ˜¯ multiple recursionï¼Œå› æ­¤å¾ˆå¤šé€’å½’è°ƒç”¨æ˜¯é‡å¤çš„ï¼Œä¾‹å¦‚</p><ul><li>recursion(3, 1) åˆ†è§£ä¸º<ul><li>recursion(2, 0) + recursion(2, 1)</li></ul></li><li>è€Œ recursion(3, 2) åˆ†è§£ä¸º<ul><li>recursion(2, 1) + recursion(2, 2)</li></ul></li></ul><p>è¿™é‡Œ recursion(2, 1) å°±é‡å¤è°ƒç”¨äº†ï¼Œäº‹å®ä¸Šå®ƒä¼šé‡å¤å¾ˆå¤šæ¬¡ï¼Œå¯ä»¥ç”¨ static AtomicInteger counter = new AtomicInteger(0) æ¥æŸ¥çœ‹é€’å½’å‡½æ•°çš„è°ƒç”¨æ€»æ¬¡æ•°</p><p>äº‹å®ä¸Šï¼Œå¯ä»¥ç”¨ <strong>memoization</strong> æ¥è¿›è¡Œä¼˜åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print1</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[][] triangle = <span class="keyword">new</span> <span class="title class_">int</span>[n][];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="comment">// æ‰“å°ç©ºæ ¼</span></span><br><span class="line">        triangle[i] = <span class="keyword">new</span> <span class="title class_">int</span>[i + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt;= i; j++) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;%-4d&quot;</span>, element1(triangle, i, j));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">element1</span><span class="params">(<span class="type">int</span>[][] triangle, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (triangle[i][j] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> triangle[i][j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (j == <span class="number">0</span> || i == j) &#123;</span><br><span class="line">        triangle[i][j] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> triangle[i][j];</span><br><span class="line">    &#125;</span><br><span class="line">    triangle[i][j] = element1(triangle, i - <span class="number">1</span>, j - <span class="number">1</span>) + element1(triangle, i - <span class="number">1</span>, j);</span><br><span class="line">    <span class="keyword">return</span> triangle[i][j];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å°†æ•°ç»„ä½œä¸ºé€’å½’å‡½æ•°å†…å¯ä»¥è®¿é—®çš„éå†ï¼Œå¦‚æœ $triangle[i][j]$ å·²ç»æœ‰å€¼ï¼Œè¯´æ˜è¯¥å…ƒç´ å·²ç»è¢«ä¹‹å‰çš„é€’å½’å‡½æ•°è®¡ç®—è¿‡ï¼Œå°±ä¸å¿…é‡å¤è®¡ç®—äº†</li></ul><p><strong>ä¼˜åŒ–2</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print2</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] row = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="comment">// æ‰“å°ç©ºæ ¼</span></span><br><span class="line">        createRow(row, i);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt;= i; j++) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;%-4d&quot;</span>, row[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">createRow</span><span class="params">(<span class="type">int</span>[] row, <span class="type">int</span> i)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">        row[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &gt; <span class="number">0</span>; j--) &#123;</span><br><span class="line">        row[j] = row[j - <span class="number">1</span>] + row[j];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šè¿˜å¯ä»¥é€šè¿‡æ¯ä¸€è¡Œçš„å‰ä¸€é¡¹è®¡ç®—å‡ºä¸‹ä¸€é¡¹ï¼Œä¸å¿…å€ŸåŠ©ä¸Šä¸€è¡Œï¼Œè¿™ä¸æ¨è¾‰ä¸‰è§’çš„å¦ä¸€ä¸ªç‰¹æ€§æœ‰å…³ï¼Œæš‚ä¸å±•å¼€äº†</p></blockquote><p>åŠ›æ‰£å¯¹åº”é¢˜ç›®ï¼Œä½†é€’å½’ä¸é€‚åˆåœ¨åŠ›æ‰£åˆ·é«˜åˆ†ï¼Œå› æ­¤åªåˆ—å‡ºç›¸å…³é¢˜ç›®ï¼Œä¸åšåˆ·é¢˜è®²è§£äº†</p><ul><li><a href="https://leetcode.cn/problems/pascals-triangle/">118. æ¨è¾‰ä¸‰è§’ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></li><li><a href="https://leetcode.cn/problems/pascals-triangle-ii/solution/yang-hui-san-jiao-ii-by-leetcode-solutio-shuk/">119. æ¨è¾‰ä¸‰è§’ II - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></li></ul><h1 id="3-5-lian-biao">3.5 é“¾è¡¨</h1><h3 id="e-01-fan-zhuan-dan-xiang-lian-biao-li-kou-206-ti" id="E01-åè½¬å•å‘é“¾è¡¨-åŠ›æ‰£-206-é¢˜">E01. åè½¬å•å‘é“¾è¡¨-åŠ›æ‰£ 206 é¢˜</h3><p>å¯¹åº”åŠ›æ‰£é¢˜ç›® <a href="https://leetcode.cn/problems/reverse-linked-list/">206. åè½¬é“¾è¡¨ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = <span class="comment">[1,2,3,4,5]</span></span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[5,4,3,2,1]</span></span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼š<span class="comment">[1,2]</span></span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[2,1]</span></span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼š<span class="comment">[]</span></span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[]</span></span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•1</strong></p><p>æ„é€ ä¸€ä¸ªæ–°é“¾è¡¨ï¼Œä»<strong>æ—§é“¾è¡¨</strong>ä¾æ¬¡æ‹¿åˆ°æ¯ä¸ªèŠ‚ç‚¹ï¼Œåˆ›å»ºæ–°èŠ‚ç‚¹æ·»åŠ è‡³<strong>æ–°é“¾è¡¨</strong>å¤´éƒ¨ï¼Œå®Œæˆåæ–°é“¾è¡¨å³æ˜¯å€’åºçš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode o1)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">n1</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> o1;</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">        n1 = <span class="keyword">new</span> <span class="title class_">ListNode</span>(p.val, n1);</span><br><span class="line">        p = p.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯„ä»·ï¼šç®€å•ç›´ç™½ï¼Œå°±æ˜¯å¾—æ–°åˆ›å»ºèŠ‚ç‚¹å¯¹è±¡</p><p><strong>æ–¹æ³•2</strong></p><p>ä¸æ–¹æ³•1 ç±»ä¼¼ï¼Œæ„é€ ä¸€ä¸ªæ–°é“¾è¡¨ï¼Œä»<strong>æ—§é“¾è¡¨å¤´éƒ¨</strong>ç§»é™¤èŠ‚ç‚¹ï¼Œæ·»åŠ åˆ°<strong>æ–°é“¾è¡¨å¤´éƒ¨</strong>ï¼Œå®Œæˆåæ–°é“¾è¡¨å³æ˜¯å€’åºçš„ï¼ŒåŒºåˆ«åœ¨äºåŸé¢˜ç›®æœªæä¾›èŠ‚ç‚¹å¤–å±‚çš„å®¹å™¨ç±»ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªï¼Œå¦å¤–ä¸€ä¸ªåŒºåˆ«æ˜¯å¹¶ä¸å»æ„é€ æ–°èŠ‚ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    ListNode head;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">List</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.head = head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">removeFirst</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">first</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">if</span> (first != <span class="literal">null</span>) &#123;</span><br><span class="line">            head = first.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> first;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFirst</span><span class="params">(ListNode first)</span> &#123;</span><br><span class="line">        first.next = head;</span><br><span class="line">        head = first;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">List</span> <span class="variable">list1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">List</span>(head);</span><br><span class="line">    <span class="type">List</span> <span class="variable">list2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">List</span>(<span class="literal">null</span>);</span><br><span class="line">    ListNode first;</span><br><span class="line">    <span class="keyword">while</span> ((first = list1.removeFirst()) != <span class="literal">null</span>) &#123;</span><br><span class="line">        list2.addFirst(first);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list2.head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯„ä»·ï¼šæ›´åŠ é¢å‘å¯¹è±¡ï¼Œå¦‚æœå®é™…å†™ä»£ç è€Œéåˆ·é¢˜ï¼Œæ›´å¤šä¼šè¿™ä¹ˆåš</p><p><strong>æ–¹æ³•3</strong></p><p>é€’å½’ï¼Œåœ¨<strong>å½’</strong>æ—¶è®© $5 \rightarrow 4$ï¼Œ$4 \rightarrow 3$ â€¦</p><p>é¦–å…ˆï¼Œå†™ä¸€ä¸ªé€’å½’æ–¹æ³•ï¼Œè¿”å›å€¼ç”¨æ¥æ‹¿åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode p)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">null</span> || p.next == <span class="literal">null</span>) &#123; <span class="comment">// ä¸è¶³ä¸¤ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span> p; <span class="comment">// æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">last</span> <span class="operator">=</span> reverseList(p.next);</span><br><span class="line">    <span class="keyword">return</span> last;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ³¨æ„1ï¼šé€’å½’ç»ˆæ­¢æ¡ä»¶æ˜¯ curr.next == nullï¼Œç›®çš„æ˜¯åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹å°±ç»“æŸé€’å½’ï¼Œä¸ä¹‹å‰é€’å½’éå†ä¸ä¸€æ ·</li><li>æ³¨æ„2ï¼šéœ€è¦è€ƒè™‘ç©ºé“¾è¡¨å³ p == null çš„æƒ…å†µ</li></ul><p>å¯ä»¥å…ˆæµ‹è¯•ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ListNode</span> <span class="variable">o5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">5</span>, <span class="literal">null</span>);</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">o4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">4</span>, o5);</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">o3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">3</span>, o4);</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">o2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">2</span>, o3);</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">o1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">1</span>, o2);</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">n1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">E01Leetcode206</span>().reverseList(o1);</span><br><span class="line">System.out.println(n1);</span><br></pre></td></tr></table></figure><p>ä¼šæ‰“å°</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[5]</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢ä¸º<strong>ä¼ªç </strong>è°ƒç”¨è¿‡ç¨‹ï¼Œå‡è®¾èŠ‚ç‚¹åˆ†åˆ«æ˜¯ $1 \rightarrow 2 \rightarrow 3 \rightarrow 4 \rightarrow 5 \rightarrow null$ï¼Œå…ˆå¿½ç•¥è¿”å›å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">reverseList(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">1</span>) &#123;</span><br><span class="line">    reverseList(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">2</span>) &#123;</span><br><span class="line">    reverseList(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">3</span>) &#123;</span><br><span class="line">    reverseList(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">4</span>) &#123;</span><br><span class="line">    reverseList(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">5</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">null</span> || p.next == <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> p; <span class="comment">// è¿”å›5</span></span><br><span class="line">                    &#125;</span><br><span class="line">&#125;</span><br><span class="line">                <span class="comment">// æ­¤æ—¶pæ˜¯4, p.nextæ˜¯5</span></span><br><span class="line">&#125;</span><br><span class="line">            <span class="comment">// æ­¤æ—¶pæ˜¯3, p.nextæ˜¯4</span></span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">// æ­¤æ—¶pæ˜¯2, p.nextæ˜¯3</span></span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// æ­¤æ—¶pæ˜¯1, p.nextæ˜¯2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œä» p = 4 å¼€å§‹ï¼Œè¦è®© $5 \rightarrow 4$ï¼Œ$4 \rightarrow 3$ â€¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">reverseList(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">1</span>) &#123;</span><br><span class="line">    reverseList(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">2</span>) &#123;</span><br><span class="line">    reverseList(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">3</span>) &#123;</span><br><span class="line">    reverseList(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">4</span>) &#123;</span><br><span class="line">    reverseList(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">5</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">null</span> || p.next == <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> p; <span class="comment">// è¿”å›5</span></span><br><span class="line">                    &#125;</span><br><span class="line">&#125;</span><br><span class="line">                <span class="comment">// æ­¤æ—¶pæ˜¯4, p.nextæ˜¯5, è¦è®©5æŒ‡å‘4,ä»£ç å†™æˆ p.next.next=p</span></span><br><span class="line">                <span class="comment">// è¿˜è¦æ³¨æ„4è¦æŒ‡å‘ null, å¦åˆ™å°±æ­»é“¾äº†</span></span><br><span class="line">&#125;</span><br><span class="line">            <span class="comment">// æ­¤æ—¶pæ˜¯3, p.nextæ˜¯4</span></span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">// æ­¤æ—¶pæ˜¯2, p.nextæ˜¯3</span></span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// æ­¤æ—¶pæ˜¯1, p.nextæ˜¯2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆä»£ç ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode p)</span> &#123;    </span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">null</span> || p.next == <span class="literal">null</span>) &#123; <span class="comment">// ä¸è¶³ä¸¤ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span> p; <span class="comment">// æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">last</span> <span class="operator">=</span> reverseList(p.next);</span><br><span class="line">    p.next.next = p;</span><br><span class="line">    p.next = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> last;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Qï¼šä¸ºå•¥ä¸èƒ½åœ¨<strong>é€’</strong>çš„è¿‡ç¨‹ä¸­å€’åºï¼Ÿ</p><p>Aï¼šæ¯”å¦‚</p><ul><li>$ 1 \rightarrow 2 \rightarrow 3 $ å¦‚æœé€’çš„è¿‡ç¨‹ä¸­è®© $2 \rightarrow 1$ é‚£ä¹ˆæ­¤æ—¶ $2 \rightarrow 3$ å°±è¢«è¦†ç›–ï¼Œä¸çŸ¥é“æ¥ä¸‹æ¥é€’ç»™è°</li><li>è€Œå½’çš„æ—¶å€™è®© $3 \rightarrow 2$ ä¸ä¼šå½±å“ä¸Šä¸€å±‚çš„ $1 \rightarrow 2$</li></ul><p>è¯„ä»·ï¼šå•å‘é“¾è¡¨æ²¡æœ‰ prev æŒ‡é’ˆï¼Œä½†åˆ©ç”¨é€’å½’çš„ç‰¹æ€§ã€è®°ä½äº†ã€‘é“¾è¡¨æ¯æ¬¡è°ƒç”¨æ—¶ç›¸é‚»ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯è°</p><p><strong>æ–¹æ³•4</strong></p><p>ä»é“¾è¡¨æ¯æ¬¡æ‹¿åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œå°†å…¶ä»é“¾è¡¨æ–­å¼€ï¼Œæ’å…¥å¤´éƒ¨ï¼Œç›´è‡³å®ƒä¸º null ç»“æŸ</p><ol><li>è®¾ç½®æŒ‡é’ˆ o1(æ—§å¤´)ã€n1(æ–°å¤´)ã€o2(æ—§è€äºŒ)ï¼Œåˆ†åˆ«æŒ‡å‘ç¬¬ä¸€ï¼Œç¬¬ä¸€ï¼Œç¬¬äºŒèŠ‚ç‚¹</li></ol><p>$\frac{n1 \ o1}{1} \rightarrow \frac{o2}{2} \rightarrow 3 \rightarrow 4 \rightarrow 5 \rightarrow null$</p><ol start="2"><li>å°† o2 èŠ‚ç‚¹ä»é“¾è¡¨æ–­å¼€ï¼Œå³ o1 èŠ‚ç‚¹æŒ‡å‘ç¬¬ä¸‰èŠ‚ç‚¹</li></ol><p>$ \frac{n1 \ o1}{1} \rightarrow 3 \rightarrow 4 \rightarrow 5 \rightarrow null$ ï¼Œ$\frac{o2}{2}$</p><ol start="3"><li>o2 èŠ‚ç‚¹é“¾å…¥é“¾è¡¨å¤´éƒ¨ï¼Œå³</li></ol><p>$\frac{o2}{2} \rightarrow \frac{n1 \ o1}{1} \rightarrow 3 \rightarrow 4 \rightarrow 5 \rightarrow null$</p><ol start="4"><li>n1 æŒ‡å‘ o2</li></ol><p>$\frac{n1 \ o2}{2} \rightarrow \frac{o1}{1} \rightarrow 3 \rightarrow 4 \rightarrow 5 \rightarrow null$</p><ol start="5"><li>o2 æŒ‡å‘ o1 çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå³</li></ol><p>$\frac{n1}{2} \rightarrow \frac{o1}{1} \rightarrow \frac{o2}{3} \rightarrow 4 \rightarrow 5 \rightarrow null$</p><ol start="6"><li><p>é‡å¤ä»¥ä¸Š $2\sim5$ æ­¥ï¼Œç›´åˆ° o2 æŒ‡å‘ null</p></li><li><p>è¿˜åº”å½“è€ƒè™‘è¾¹ç•Œæ¡ä»¶ï¼Œå³é“¾è¡¨ä¸­ä¸æ»¡ä¸¤ä¸ªå…ƒç´ æ—¶ï¼Œæ— éœ€èµ°ä»¥ä¸Šé€»è¾‘</p></li></ol><p>å‚è€ƒç­”æ¡ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode o1)</span> &#123;    </span><br><span class="line">    <span class="keyword">if</span> (o1 == <span class="literal">null</span> || o1.next == <span class="literal">null</span>) &#123; <span class="comment">// ä¸è¶³ä¸¤ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span> o1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">o2</span> <span class="operator">=</span> o1.next;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">n1</span> <span class="operator">=</span> o1;</span><br><span class="line">    <span class="keyword">while</span> (o2 != <span class="literal">null</span>) &#123;</span><br><span class="line">        o1.next = o2.next; </span><br><span class="line">        o2.next = n1;</span><br><span class="line">        n1 = o2;</span><br><span class="line">        o2 = o1.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•5</strong></p><p>è¦ç‚¹ï¼šæŠŠé“¾è¡¨åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œæ€è·¯å°±æ˜¯ä¸æ–­ä»é“¾è¡¨2çš„å¤´ï¼Œå¾€é“¾è¡¨1çš„å¤´æ¬ç§»</p><ol><li>n1 æŒ‡å‘ nullï¼Œä»£è¡¨<strong>æ–°é“¾è¡¨</strong>ä¸€å¼€å§‹æ²¡æœ‰å…ƒç´ ï¼Œo1 æŒ‡å‘<strong>åŸé“¾è¡¨</strong>çš„é¦–èŠ‚ç‚¹</li></ol><p>$\frac{n1}{null}$ï¼Œ$\frac{o1}{1} \rightarrow 2 \rightarrow 3 \rightarrow 4 \rightarrow 5 \rightarrow null$</p><ol start="2"><li>å¼€å§‹å¾ªç¯ï¼Œo2 æŒ‡å‘<strong>åŸé“¾è¡¨</strong>æ¬¡èŠ‚ç‚¹</li></ol><p>$\frac{n1}{null}$ï¼Œ$\frac{o1}{1} \rightarrow \frac{o2}{2} \rightarrow 3 \rightarrow 4 \rightarrow 5 \rightarrow null$</p><ol start="3"><li>æ¬ç§»</li></ol><p>$\frac{o1}{1} \rightarrow \frac{n1}{null}$  ï¼Œ $\frac{o2}{2} \rightarrow 3 \rightarrow 4 \rightarrow 5 \rightarrow null$</p><ol start="4"><li>æŒ‡é’ˆå¤ä½</li></ol><p>$\frac{n1}{1} \rightarrow null$ ï¼Œ $\frac{o1 \ o2}{2} \rightarrow 3 \rightarrow 4 \rightarrow 5 \rightarrow null$</p><ol start="5"><li>é‡å¤ $2\sim4$ æ­¥</li><li>å½“ o1 = null æ—¶é€€å‡ºå¾ªç¯</li></ol><p><strong>å‚è€ƒç­”æ¡ˆ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode o1)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (o1 == <span class="literal">null</span> || o1.next == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> o1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">n1</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span> (o1 != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">o2</span> <span class="operator">=</span> o1.next;</span><br><span class="line">        o1.next = n1;</span><br><span class="line">        n1 = o1;</span><br><span class="line">        o1 = o2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯„ä»·ï¼šæœ¬è´¨ä¸Šä¸æ–¹æ³•2 ç›¸åŒï¼Œåªæ˜¯æ–¹æ³•2æ›´ä¸ºé¢å‘å¯¹è±¡</p><h3 id="e-02-gen-ju-zhi-shan-chu-jie-dian-li-kou-203-ti" id="E02-æ ¹æ®å€¼åˆ é™¤èŠ‚ç‚¹-åŠ›æ‰£-203-é¢˜">E02. æ ¹æ®å€¼åˆ é™¤èŠ‚ç‚¹-åŠ›æ‰£ 203 é¢˜</h3><p>ä¾‹å¦‚</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = <span class="comment">[1,2,6,3,6]</span>, val = 6</span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[1,2,3]</span></span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šhead = <span class="comment">[]</span>, val = 1</span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[]</span></span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šhead = <span class="comment">[7,7,7,7]</span>, val = 7</span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[]</span></span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•1</strong></p><p>å›¾ä¸­ s ä»£è¡¨ sentinel å“¨å…µï¼ˆå¦‚æœä¸åŠ å“¨å…µï¼Œåˆ™åˆ é™¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è¦ç‰¹æ®Šå¤„ç†ï¼‰ï¼Œä¾‹å¦‚è¦åˆ é™¤ 6</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p1   p2</span><br><span class="line">s -&gt; <span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">6</span> -&gt; <span class="number">3</span> -&gt; <span class="number">6</span> -&gt; <span class="literal">null</span></span><br></pre></td></tr></table></figure><ul><li>å¦‚æœ p2 ä¸ç­‰äºç›®æ ‡ï¼Œåˆ™ p1ï¼Œp2 ä¸æ–­åç§»</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> p1   p2</span><br><span class="line">s -&gt; <span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">6</span> -&gt; <span class="number">3</span> -&gt; <span class="number">6</span> -&gt; <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">   p1   p2</span><br><span class="line">s -&gt; <span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">6</span> -&gt; <span class="number">3</span> -&gt; <span class="number">6</span> -&gt; <span class="literal">null</span></span><br></pre></td></tr></table></figure><ul><li>p2 == 6ï¼Œåˆ é™¤å®ƒï¼Œæ³¨æ„ p1 æ­¤æ—¶ä¿æŒä¸å˜ï¼Œp2 åç§»</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   p1   p2</span><br><span class="line">s -&gt; <span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">3</span> -&gt; <span class="number">6</span> -&gt; <span class="literal">null</span></span><br></pre></td></tr></table></figure><ul><li>p2 ä¸ç­‰äºç›®æ ‡ï¼Œåˆ™ p1ï¼Œp2 ä¸æ–­åç§»</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">      p1   p2</span><br><span class="line">s -&gt; <span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">3</span> -&gt; <span class="number">6</span> -&gt; <span class="literal">null</span></span><br></pre></td></tr></table></figure><ul><li>p2 == 6ï¼Œåˆ é™¤å®ƒï¼Œæ³¨æ„ p1 æ­¤æ—¶ä¿æŒä¸å˜ï¼Œp2 åç§»</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">      p1   p2</span><br><span class="line">s -&gt; <span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">3</span> -&gt; <span class="literal">null</span></span><br></pre></td></tr></table></figure><ul><li>p2 == null é€€å‡ºå¾ªç¯</li></ul><p>æœ€åä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">removeElements</span><span class="params">(ListNode head, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">sentinel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>, head);</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p1</span> <span class="operator">=</span> sentinel;</span><br><span class="line">    ListNode p2;</span><br><span class="line">    <span class="keyword">while</span> ((p2 = p1.next) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p2.val == val) &#123;</span><br><span class="line">            p1.next = p2.next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p1 = p1.next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sentinel.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•2</strong></p><p>æ€è·¯ï¼Œé€’å½’å‡½æ•°è´Ÿè´£è¿”å›ï¼šä»å½“å‰èŠ‚ç‚¹ï¼ˆæˆ‘ï¼‰å¼€å§‹ï¼Œå®Œæˆåˆ é™¤çš„å­é“¾è¡¨</p><ol><li>è‹¥æˆ‘ä¸ v ç›¸ç­‰ï¼Œåº”è¯¥è¿”å›ä¸‹ä¸€ä¸ªèŠ‚ç‚¹é€’å½’ç»“æœ</li><li>è‹¥æˆ‘ä¸ v ä¸ç­‰ï¼Œåº”è¯¥è¿”å›æˆ‘ï¼Œä½†æˆ‘çš„ next åº”è¯¥æ›´æ–°ï¼ˆè®©æˆ‘èƒ½å¸¦ä¸Šåç»­åˆ è¿‡çš„å­é“¾è¡¨ï¼‰</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">removeElements(ListNode p=<span class="number">1</span>, <span class="type">int</span> v=<span class="number">6</span>)&#123;</span><br><span class="line">    <span class="number">1.</span>next=removeElements(ListNode p=<span class="number">2</span>, <span class="type">int</span> v=<span class="number">6</span>)&#123;</span><br><span class="line">    <span class="number">2.</span>next=removeElements(ListNode p=<span class="number">6</span>, <span class="type">int</span> v=<span class="number">6</span>)&#123;</span><br><span class="line">    removeElements(ListNode p=<span class="number">3</span>, <span class="type">int</span> v=<span class="number">6</span>)&#123;</span><br><span class="line">    <span class="number">3.</span>next=removeElements(ListNode p=<span class="number">6</span>, <span class="type">int</span> v=<span class="number">6</span>)&#123;</span><br><span class="line">    removeElements(ListNode p=<span class="literal">null</span>, <span class="type">int</span> v=<span class="number">6</span>)&#123;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰èŠ‚ç‚¹,è¿”å›</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">removeElements</span><span class="params">(ListNode head, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (head.val == val) &#123;</span><br><span class="line">        <span class="keyword">return</span> removeElements(head.next, val);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        head.next = removeElements(head.next, val);</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-03-shan-chu-dao-shu-jie-dian-li-kou-19-ti" id="E03-åˆ é™¤å€’æ•°èŠ‚ç‚¹-åŠ›æ‰£-19-é¢˜">E03.  åˆ é™¤å€’æ•°èŠ‚ç‚¹-åŠ›æ‰£ 19 é¢˜</h3><p>ä¾‹å¦‚</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = <span class="comment">[1,2,3,4,5]</span>, n = 2</span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[1,2,3,5]</span></span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šhead = <span class="comment">[1]</span>, n = 1</span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[]</span></span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šhead = <span class="comment">[1,2]</span>, n = 1</span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[1]</span></span><br></pre></td></tr></table></figure><p>å¦å¤–é¢˜ç›®æç¤º</p><ul><li>é“¾è¡¨è‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹</li><li>n åªä¼šåœ¨åˆç†èŒƒå›´</li></ul><p><strong>æ–¹æ³•1</strong></p><p>æ€è·¯ï¼Œå†™ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œç”¨æ¥è¿”å›ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å€’æ•°åºå·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">recursion(ListNode p=<span class="number">1</span>, <span class="type">int</span> n=<span class="number">2</span>) &#123;</span><br><span class="line">    recursion(ListNode p=<span class="number">2</span>, <span class="type">int</span> n=<span class="number">2</span>) &#123;</span><br><span class="line">    recursion(ListNode p=<span class="number">3</span>, <span class="type">int</span> n=<span class="number">2</span>) &#123;</span><br><span class="line">    recursion(ListNode p=<span class="number">4</span>, <span class="type">int</span> n=<span class="number">2</span>) &#123;</span><br><span class="line">    recursion(ListNode p=<span class="number">5</span>, <span class="type">int</span> n=<span class="number">2</span>) &#123;</span><br><span class="line">    recursion(ListNode p=<span class="literal">null</span>, <span class="type">int</span> n=<span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// æœ€å†…å±‚åºå·0</span></span><br><span class="line">&#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// ä¸Šä¸€æ¬¡è¿”å›å€¼+1</span></span><br><span class="line">&#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">            <span class="keyword">if</span>(è¿”å›å€¼ == n == <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="comment">// åˆ é™¤ next</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†ä¸Šè¿°ä»£ç æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è‹¥åˆ é™¤çš„æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒæ²¡æœ‰ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤å¯ä»¥åŠ ä¸€ä¸ªå“¨å…µæ¥è§£å†³</p><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">removeNthFromEnd</span><span class="params">(ListNode head, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">sentinel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>, head);</span><br><span class="line">    recursion(sentinel, n);</span><br><span class="line">    <span class="keyword">return</span> sentinel.next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">recursion</span><span class="params">(ListNode p, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">nth</span> <span class="operator">=</span> recursion(p.next, n);</span><br><span class="line">    <span class="keyword">if</span> (nth == n) &#123;</span><br><span class="line">        p.next = p.next.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> nth + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Qï¼šp.next.next ä¸æ€•ç©ºæŒ‡é’ˆå—ï¼Ÿ</p><p>Aï¼š</p><ul><li>p æ˜¯å¾…åˆ é™¤èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœèƒ½é€’å½’å›åˆ° pï¼Œé‚£ä¹ˆ p.next è‚¯å®šæœ‰å€¼ï¼Œä¸ä¼šæ˜¯ null</li><li>ä¸”é¢˜ç›®è¯´æ˜äº† n &gt;=1ï¼Œä¸ä¼šå› ä¸º nth == 0 è€Œè®© p.next æŒ‡å‘æœ€åçš„ null</li></ul><p><strong>æ–¹æ³•2</strong></p><p>å¿«æ…¢æŒ‡é’ˆï¼Œp1 æŒ‡å‘å¾…åˆ èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªï¼Œp2 å…ˆèµ° n + 1 æ­¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">i=<span class="number">0</span></span><br><span class="line">p2</span><br><span class="line">s -&gt; <span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">3</span> -&gt; <span class="number">4</span> -&gt; <span class="number">5</span> -&gt; <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">     i=<span class="number">1</span></span><br><span class="line">     p2</span><br><span class="line">s -&gt; <span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">3</span> -&gt; <span class="number">4</span> -&gt; <span class="number">5</span> -&gt; <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">          i=<span class="number">2</span></span><br><span class="line">          p2</span><br><span class="line">s -&gt; <span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">3</span> -&gt; <span class="number">4</span> -&gt; <span class="number">5</span> -&gt; <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">               i=<span class="number">3</span> ä»æ­¤å¼€å§‹ p1 p2 ä¾æ¬¡å‘å³å¹³ç§», ç›´åˆ° p2 ç§»åŠ¨åˆ°æœ«å°¾</span><br><span class="line">p1             p2</span><br><span class="line">s -&gt; <span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">3</span> -&gt; <span class="number">4</span> -&gt; <span class="number">5</span> -&gt; <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">               p1             p2</span><br><span class="line">s -&gt; <span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">3</span> -&gt; <span class="number">4</span> -&gt; <span class="number">5</span> -&gt; <span class="literal">null</span></span><br></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">removeNthFromEnd</span><span class="params">(ListNode head, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>, head);</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p1</span> <span class="operator">=</span> s;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p2</span> <span class="operator">=</span> s;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n + <span class="number">1</span>; i++) &#123;</span><br><span class="line">        p2 = p2.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (p2 != <span class="literal">null</span>) &#123;</span><br><span class="line">        p1 = p1.next;</span><br><span class="line">        p2 = p2.next;</span><br><span class="line">    &#125;</span><br><span class="line">    p1.next = p1.next.next;</span><br><span class="line">    <span class="keyword">return</span> s.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•3</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">removeNthFromEnd</span><span class="params">(ListNode head, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">Composite</span> <span class="variable">c</span> <span class="operator">=</span> recursion(head, n);</span><br><span class="line">    <span class="keyword">return</span> c.node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Composite</span> &#123;</span><br><span class="line">    ListNode node;</span><br><span class="line">    <span class="type">int</span> nth;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Composite</span><span class="params">(ListNode node, <span class="type">int</span> nth)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.node = node;</span><br><span class="line">        <span class="built_in">this</span>.nth = nth;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Composite <span class="title function_">recursion</span><span class="params">(ListNode p, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Composite</span>(<span class="literal">null</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Composite</span> <span class="variable">c</span> <span class="operator">=</span> recursion(p.next, n);</span><br><span class="line">    <span class="keyword">if</span> (c.nth != n) &#123;</span><br><span class="line">        p.next = c.node;</span><br><span class="line">        c.node = p;</span><br><span class="line">    &#125;</span><br><span class="line">    c.nth +=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-04-you-xu-lian-biao-qu-zhong-li-kou-83-ti" id="E04-æœ‰åºé“¾è¡¨å»é‡-åŠ›æ‰£-83-é¢˜">E04. æœ‰åºé“¾è¡¨å»é‡-åŠ›æ‰£ 83 é¢˜</h3><p>ä¾‹å¦‚</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = <span class="comment">[1,1,2]</span></span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[1,2]</span></span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šhead = <span class="comment">[1,1,2,3,3]</span></span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[1,2,3]</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<strong>é‡å¤å…ƒç´ ä¿ç•™ä¸€ä¸ª</strong></p><p><strong>æ–¹æ³•1</strong></p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p1   p2</span><br><span class="line"><span class="number">1</span> -&gt; <span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">3</span> -&gt; <span class="number">3</span> -&gt; <span class="literal">null</span></span><br></pre></td></tr></table></figure><ul><li>p1.val == p2.val é‚£ä¹ˆåˆ é™¤ p2ï¼Œæ³¨æ„ p1 æ­¤æ—¶ä¿æŒä¸å˜</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p1   p2</span><br><span class="line"><span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">3</span> -&gt; <span class="number">3</span> -&gt; <span class="literal">null</span></span><br></pre></td></tr></table></figure><ul><li>p1.val != p2.val é‚£ä¹ˆ p1ï¼Œp2 å‘åç§»åŠ¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">     p1   p2</span><br><span class="line"><span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">3</span> -&gt; <span class="number">3</span> -&gt; <span class="literal">null</span></span><br><span class="line">         </span><br><span class="line">          p1   p2</span><br><span class="line"><span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">3</span> -&gt; <span class="number">3</span> -&gt; <span class="literal">null</span>     </span><br></pre></td></tr></table></figure><ul><li>p1.val == p2.val é‚£ä¹ˆåˆ é™¤ p2</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">          p1   p2</span><br><span class="line"><span class="number">1</span> -&gt; <span class="number">2</span> -&gt; <span class="number">3</span> -&gt; <span class="literal">null</span>   </span><br></pre></td></tr></table></figure><ul><li>å½“ p2 == null é€€å‡ºå¾ªç¯</li></ul><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">deleteDuplicates</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="comment">// é“¾è¡¨èŠ‚ç‚¹ &lt; 2</span></span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é“¾è¡¨èŠ‚ç‚¹ &gt;= 2</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p1</span> <span class="operator">=</span> head;</span><br><span class="line">    ListNode p2;</span><br><span class="line">    <span class="keyword">while</span> ((p2 = p1.next) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p1.val == p2.val) &#123;</span><br><span class="line">            p1.next = p2.next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p1 = p1.next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•2</strong></p><p>é€’å½’å‡½æ•°è´Ÿè´£è¿”å›ï¼šä»å½“å‰èŠ‚ç‚¹ï¼ˆæˆ‘ï¼‰å¼€å§‹ï¼Œå®Œæˆå»é‡çš„é“¾è¡¨</p><ol><li>è‹¥æˆ‘ä¸ next é‡å¤ï¼Œè¿”å› next</li><li>è‹¥æˆ‘ä¸ next ä¸é‡å¤ï¼Œè¿”å›æˆ‘ï¼Œä½† next åº”å½“æ›´æ–°</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">deleteDuplicates(ListNode p=<span class="number">1</span>) &#123;</span><br><span class="line">    deleteDuplicates(ListNode p=<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="number">1.</span>next=deleteDuplicates(ListNode p=<span class="number">2</span>) &#123;</span><br><span class="line">            <span class="number">2.</span>next=deleteDuplicates(ListNode p=<span class="number">3</span>) &#123;</span><br><span class="line">                deleteDuplicates(ListNode p=<span class="number">3</span>) &#123;</span><br><span class="line"><span class="comment">// åªå‰©ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿”å›</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">                &#125;                </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">deleteDuplicates</span><span class="params">(ListNode p)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">null</span> || p.next == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(p.val == p.next.val) &#123;</span><br><span class="line">        <span class="keyword">return</span> deleteDuplicates(p.next);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        p.next = deleteDuplicates(p.next);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-05-you-xu-lian-biao-qu-zhong-li-kou-82-ti" id="E05-æœ‰åºé“¾è¡¨å»é‡-åŠ›æ‰£-82-é¢˜">E05. æœ‰åºé“¾è¡¨å»é‡-åŠ›æ‰£ 82 é¢˜</h3><p>ä¾‹å¦‚</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = <span class="comment">[1,2,3,3,4,4,5]</span></span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[1,2,5]</span></span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šhead = <span class="comment">[1,1,1,2,3]</span></span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[2,3]</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<strong>é‡å¤å…ƒç´ ä¸€ä¸ªä¸ç•™</strong></p><p><strong>æ–¹æ³•1</strong></p><p>é€’å½’å‡½æ•°è´Ÿè´£è¿”å›ï¼šä»å½“å‰èŠ‚ç‚¹ï¼ˆæˆ‘ï¼‰å¼€å§‹ï¼Œå®Œæˆå»é‡çš„é“¾è¡¨</p><ol><li>è‹¥æˆ‘ä¸ next é‡å¤ï¼Œä¸€ç›´æ‰¾åˆ°ä¸‹ä¸€ä¸ªä¸é‡å¤çš„èŠ‚ç‚¹ï¼Œä»¥å®ƒçš„è¿”å›ç»“æœä¸ºå‡†</li><li>è‹¥æˆ‘ä¸ next ä¸é‡å¤ï¼Œè¿”å›æˆ‘ï¼ŒåŒæ—¶æ›´æ–° next</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">deleteDuplicates(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// æ‰¾ä¸‹ä¸ªä¸é‡å¤çš„</span></span><br><span class="line">deleteDuplicates(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">1</span>) &#123;</span><br><span class="line">        deleteDuplicates(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">1</span>) &#123;</span><br><span class="line">deleteDuplicates(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="number">2.</span>next=deleteDuplicates(<span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">3</span>) &#123;</span><br><span class="line"><span class="comment">// åªå‰©ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿”å›</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">deleteDuplicates</span><span class="params">(ListNode p)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">null</span> || p.next == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (p.val == p.next.val) &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">x</span> <span class="operator">=</span> p.next.next;</span><br><span class="line">        <span class="keyword">while</span> (x != <span class="literal">null</span> &amp;&amp; x.val == p.val) &#123;</span><br><span class="line">            x = x.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> deleteDuplicates(x);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        p.next = deleteDuplicates(p.next);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•2</strong></p><p>p1 æ˜¯å¾…åˆ é™¤çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¯æ¬¡å¾ªç¯å¯¹æ¯” p2ã€p3 çš„å€¼</p><ul><li>å¦‚æœ p2 ä¸ p3 çš„å€¼é‡å¤ï¼Œé‚£ä¹ˆ p3 ç»§ç»­åç§»ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ p2 ä¸é‡å¤çš„èŠ‚ç‚¹ï¼Œp1 æŒ‡å‘ p3 å®Œæˆåˆ é™¤</li><li>å¦‚æœ p2 ä¸ p3 çš„å€¼ä¸é‡å¤ï¼Œp1ï¼Œp2ï¼Œp3 å‘åå¹³ç§»ä¸€ä½ï¼Œç»§ç»­ä¸Šé¢çš„æ“ä½œ</li><li>p2 æˆ– p3 ä¸º null é€€å‡ºå¾ªç¯<ul><li>p2 ä¸º null çš„æƒ…å†µï¼Œæ¯”å¦‚é“¾è¡¨ä¸º 1 1 1 null</li></ul></li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">p1</span> p2 p3</span><br><span class="line"><span class="attribute">s</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, null</span><br><span class="line"></span><br><span class="line"><span class="attribute">p1</span> p2    p3</span><br><span class="line"><span class="attribute">s</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, null</span><br><span class="line"></span><br><span class="line"><span class="attribute">p1</span> p2       p3</span><br><span class="line"><span class="attribute">s</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, null</span><br><span class="line"></span><br><span class="line"><span class="attribute">p1</span> p3</span><br><span class="line"><span class="attribute">s</span>, <span class="number">2</span>, <span class="number">3</span>, null</span><br><span class="line"></span><br><span class="line"><span class="attribute">p1</span> p2 p3</span><br><span class="line"><span class="attribute">s</span>, <span class="number">2</span>, <span class="number">3</span>, null</span><br><span class="line"></span><br><span class="line">   <span class="attribute">p1</span> p2 p3</span><br><span class="line"><span class="attribute">s</span>, <span class="number">2</span>, <span class="number">3</span>, null</span><br></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">deleteDuplicates</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>, head);</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p1</span> <span class="operator">=</span> s;</span><br><span class="line">    ListNode p2;</span><br><span class="line">    ListNode p3;</span><br><span class="line">    <span class="keyword">while</span> ((p2 = p1.next) != <span class="literal">null</span> &amp;&amp; (p3 = p2.next) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p2.val == p3.val) &#123;</span><br><span class="line">            <span class="keyword">while</span> ((p3 = p3.next) != <span class="literal">null</span> </span><br><span class="line">                   &amp;&amp; p3.val == p2.val) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            p1.next = p3;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p1 = p1.next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-06-he-bing-you-xu-lian-biao-li-kou-21-ti" id="E06-åˆå¹¶æœ‰åºé“¾è¡¨-åŠ›æ‰£-21-é¢˜">E06. åˆå¹¶æœ‰åºé“¾è¡¨-åŠ›æ‰£ 21 é¢˜</h3><p>ä¾‹</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šl1 = <span class="comment">[1,2,4]</span>, l2 = <span class="comment">[1,3,4]</span></span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[1,1,2,3,4,4]</span></span><br><span class="line">    </span><br><span class="line">è¾“å…¥ï¼šl1 = <span class="comment">[]</span>, l2 = <span class="comment">[]</span></span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[]</span></span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šl1 = <span class="comment">[]</span>, l2 = <span class="comment">[0]</span></span><br><span class="line">è¾“å‡ºï¼š<span class="comment">[0]</span></span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•1</strong></p><ul><li>è°å°ï¼ŒæŠŠè°é“¾ç»™ pï¼Œp å’Œå°çš„éƒ½å‘åå¹³ç§»ä¸€ä½</li><li>å½“ p1ã€p2 æœ‰ä¸€ä¸ªä¸º nullï¼Œé€€å‡ºå¾ªç¯ï¼ŒæŠŠä¸ä¸º null çš„é“¾ç»™ p</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">p1</span></span><br><span class="line"><span class="attribute">1</span><span class="number">3</span><span class="number">8</span><span class="number">9</span>null</span><br><span class="line"></span><br><span class="line"><span class="attribute">p2</span></span><br><span class="line"><span class="attribute">2</span><span class="number">4</span>null</span><br><span class="line"></span><br><span class="line"><span class="attribute">p</span></span><br><span class="line"><span class="attribute">s</span>null</span><br></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">mergeTwoLists</span><span class="params">(ListNode p1, ListNode p2)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> s;</span><br><span class="line">    <span class="keyword">while</span> (p1 != <span class="literal">null</span> &amp;&amp; p2 != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p1.val &lt; p2.val) &#123;</span><br><span class="line">            p.next = p1;</span><br><span class="line">            p1 = p1.next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p.next = p2;</span><br><span class="line">            p2 = p2.next;</span><br><span class="line">        &#125;</span><br><span class="line">        p = p.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (p1 != <span class="literal">null</span>) &#123;</span><br><span class="line">        p.next = p1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (p2 != <span class="literal">null</span>) &#123;</span><br><span class="line">        p.next = p2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯ä»¥è‡ªè¡ŒéªŒè¯<strong>ä¾‹</strong>ä¸­åä¸¤ç§æƒ…å†µ</li></ul><p><strong>æ–¹æ³•2</strong></p><p>é€’å½’å‡½æ•°åº”è¯¥è¿”å›</p><ul><li>æ›´å°çš„é‚£ä¸ªé“¾è¡¨èŠ‚ç‚¹ï¼Œå¹¶æŠŠå®ƒå‰©ä½™èŠ‚ç‚¹ä¸å¦ä¸€ä¸ªé“¾è¡¨å†æ¬¡é€’å½’</li><li>è¿”å›ä¹‹å‰ï¼Œæ›´æ–°æ­¤èŠ‚ç‚¹çš„ next</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mergeTwoLists(p1=[<span class="number">1</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">9</span>], p2=[<span class="number">2</span>,<span class="number">4</span>]) &#123;</span><br><span class="line">    <span class="number">1.</span>next=mergeTwoLists(p1=[<span class="number">3</span>,<span class="number">8</span>,<span class="number">9</span>], p2=[<span class="number">2</span>,<span class="number">4</span>]) &#123;</span><br><span class="line">        <span class="number">2.</span>next=mergeTwoLists(p1=[<span class="number">3</span>,<span class="number">8</span>,<span class="number">9</span>], p2=[<span class="number">4</span>]) &#123;            </span><br><span class="line">            <span class="number">3.</span>next=mergeTwoLists(p1=[<span class="number">8</span>,<span class="number">9</span>], p2=[<span class="number">4</span>]) &#123;</span><br><span class="line">                <span class="number">4.</span>next=mergeTwoLists(p1=[<span class="number">8</span>,<span class="number">9</span>], p2=<span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> [<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">4</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-07-he-bing-duo-ge-you-xu-lian-biao-li-kou-23-ti" id="E07-åˆå¹¶å¤šä¸ªæœ‰åºé“¾è¡¨-åŠ›æ‰£-23-é¢˜">E07. åˆå¹¶å¤šä¸ªæœ‰åºé“¾è¡¨-åŠ›æ‰£ 23 é¢˜</h3><p>ä¾‹</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šlists = [[<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>],[<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>],[<span class="number">2</span>,<span class="number">6</span>]]</span><br><span class="line">è¾“å‡ºï¼š[<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">è§£é‡Šï¼šé“¾è¡¨æ•°ç»„å¦‚ä¸‹ï¼š</span><br><span class="line">[</span><br><span class="line">  <span class="number">1</span>-&gt;<span class="number">4</span>-&gt;<span class="number">5</span>,</span><br><span class="line">  <span class="number">1</span>-&gt;<span class="number">3</span>-&gt;<span class="number">4</span>,</span><br><span class="line">  <span class="number">2</span>-&gt;<span class="number">6</span></span><br><span class="line">]</span><br><span class="line">å°†å®ƒä»¬åˆå¹¶åˆ°ä¸€ä¸ªæœ‰åºé“¾è¡¨ä¸­å¾—åˆ°ã€‚</span><br><span class="line"><span class="number">1</span>-&gt;<span class="number">1</span>-&gt;<span class="number">2</span>-&gt;<span class="number">3</span>-&gt;<span class="number">4</span>-&gt;<span class="number">4</span>-&gt;<span class="number">5</span>-&gt;<span class="number">6</span></span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•1</strong></p><p>é€’å½’</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">mergeKLists</span><span class="params">(ListNode[] lists)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (lists.length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> merge(lists, <span class="number">0</span>, lists.length - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">split</span><span class="params">(ListNode[] lists, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    System.out.println(i + <span class="string">&quot; &quot;</span> + j);</span><br><span class="line">    <span class="keyword">if</span> (j == i) &#123;</span><br><span class="line">        <span class="keyword">return</span> lists[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> mergeTwoLists(</span><br><span class="line">        split(lists, i, m),</span><br><span class="line">        split(lists, m + <span class="number">1</span>, j)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—æ±‚è§£ï¼Œè¿™ä¸ªæ”¾åœ¨åé¢è®²</p><h3 id="e-08-cha-zhao-lian-biao-zhong-jian-jie-dian-li-kou-876-ti" id="E08-æŸ¥æ‰¾é“¾è¡¨ä¸­é—´èŠ‚ç‚¹-åŠ›æ‰£-876-é¢˜">E08. æŸ¥æ‰¾é“¾è¡¨ä¸­é—´èŠ‚ç‚¹-åŠ›æ‰£ 876 é¢˜</h3><p>ä¾‹å¦‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š<span class="selector-attr">[1,2,3,4,5]</span></span><br><span class="line">è¾“å‡ºï¼šæ­¤åˆ—è¡¨ä¸­çš„ç»“ç‚¹ <span class="number">3</span> (åºåˆ—åŒ–å½¢å¼ï¼š<span class="selector-attr">[3,4,5]</span>)</span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼š<span class="selector-attr">[1,2,3,4,5,6]</span></span><br><span class="line">è¾“å‡ºï¼šæ­¤åˆ—è¡¨ä¸­çš„ç»“ç‚¹ <span class="number">4</span> (åºåˆ—åŒ–å½¢å¼ï¼š<span class="selector-attr">[4,5,6]</span>)</span><br></pre></td></tr></table></figure><ul><li><strong>å¶æ•°</strong>èŠ‚ç‚¹æ—¶ï¼Œä¸­é—´ç‚¹æ˜¯é å³çš„é‚£ä¸ª</li></ul><p>è§£æ³•ï¼šå¿«æ…¢æŒ‡é’ˆï¼Œå¿«æŒ‡é’ˆä¸€æ¬¡èµ°ä¸¤æ­¥ï¼Œæ…¢æŒ‡é’ˆä¸€æ¬¡èµ°ä¸€æ­¥ï¼Œå½“å¿«æŒ‡é’ˆåˆ°é“¾è¡¨ç»“å°¾æ—¶ï¼Œæ…¢æŒ‡é’ˆæ°å¥½èµ°åˆ°é“¾è¡¨çš„ä¸€åŠ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">middleNode</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p1</span> <span class="operator">=</span> head;<span class="comment">// æ…¢æŒ‡é’ˆï¼Œä¸­é—´ç‚¹</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p2</span> <span class="operator">=</span> head;<span class="comment">// å¿«æŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">while</span> (p2 != <span class="literal">null</span> &amp;&amp; p2.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        p1 = p1.next;</span><br><span class="line">        p2 = p2.next;</span><br><span class="line">        p2 = p2.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-09-hui-wen-lian-biao-li-kou-234-ti" id="E09-å›æ–‡é“¾è¡¨-åŠ›æ‰£-234-é¢˜">E09. å›æ–‡é“¾è¡¨-åŠ›æ‰£ 234 é¢˜</h3><p>æ‰€è°“å›æ–‡æŒ‡æ­£ç€è¯»ã€åç€è¯»ï¼Œç»“æœä¸€æ ·ï¼Œä¾‹å¦‚</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[1,2,2,1]</span></span><br><span class="line"><span class="string">[1,2,3,2,1]</span></span><br></pre></td></tr></table></figure><p>å®ƒä»¬éƒ½æ˜¯å›æ–‡é“¾è¡¨ï¼Œä¸æ˜¯å›æ–‡çš„ä¾‹å­</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">[</span><span class="comment">1</span><span class="string">,</span><span class="comment">2</span><span class="string">,</span><span class="comment">3</span><span class="string">,</span><span class="comment">1</span><span class="title">]</span>  <span class="literal">--</span><span class="comment">åè¿‡æ¥</span><span class="literal">--</span>&gt;  <span class="title">[</span><span class="comment">1</span><span class="string">,</span><span class="comment">3</span><span class="string">,</span><span class="comment">2</span><span class="string">,</span><span class="comment">1</span><span class="title">]</span></span><br></pre></td></tr></table></figure><p>è§£æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ­¥éª¤1. æ‰¾ä¸­é—´ç‚¹</span></span><br><span class="line"><span class="comment">    æ­¥éª¤2. ä¸­é—´ç‚¹ååŠä¸ªé“¾è¡¨åè½¬</span></span><br><span class="line"><span class="comment">    æ­¥éª¤3. åè½¬åé“¾è¡¨ä¸åŸé“¾è¡¨é€ä¸€æ¯”è¾ƒ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">middle</span> <span class="operator">=</span> middle(head);</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">newHead</span> <span class="operator">=</span> reverse(middle);</span><br><span class="line">    <span class="keyword">while</span> (newHead != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (newHead.val != head.val) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        newHead = newHead.next;</span><br><span class="line">        head = head.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ListNode <span class="title function_">reverse</span><span class="params">(ListNode o1)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">n1</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span> (o1 != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">o2</span> <span class="operator">=</span> o1.next;</span><br><span class="line">        o1.next = n1;</span><br><span class="line">        n1 = o1;</span><br><span class="line">        o1 = o2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ListNode <span class="title function_">middle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p1</span> <span class="operator">=</span> head; <span class="comment">// æ…¢</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p2</span> <span class="operator">=</span> head; <span class="comment">// å¿«</span></span><br><span class="line">    <span class="keyword">while</span> (p2 != <span class="literal">null</span> &amp;&amp; p2.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        p1 = p1.next;</span><br><span class="line">        p2 = p2.next.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–åè§£æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(ListNode h1)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (h1 == <span class="literal">null</span> || h1.next == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p1</span> <span class="operator">=</span> h1; <span class="comment">// æ…¢æŒ‡é’ˆï¼Œä¸­é—´ç‚¹</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p2</span> <span class="operator">=</span> h1; <span class="comment">// å¿«æŒ‡é’ˆ</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">n1</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">// æ–°å¤´</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">o1</span> <span class="operator">=</span> h1;<span class="comment">// æ—§å¤´</span></span><br><span class="line">    <span class="comment">// å¿«æ…¢æŒ‡é’ˆæ‰¾ä¸­é—´ç‚¹</span></span><br><span class="line">    <span class="keyword">while</span> (p2 != <span class="literal">null</span> &amp;&amp; p2.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        p1 = p1.next;</span><br><span class="line">        p2 = p2.next.next;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åè½¬å‰åŠéƒ¨åˆ†</span></span><br><span class="line">        o1.next = n1;</span><br><span class="line">        n1 = o1;</span><br><span class="line">        o1 = p1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (p2 != <span class="literal">null</span>) &#123; <span class="comment">// èŠ‚ç‚¹æ•°ä¸ºå¥‡æ•°</span></span><br><span class="line">        p1 = p1.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŒæ­¥æ¯”è¾ƒæ–°å¤´å’ŒååŠéƒ¨åˆ†</span></span><br><span class="line">    <span class="keyword">while</span> (n1 != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n1.val != p1.val) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        p1 = p1.next;</span><br><span class="line">        n1 = n1.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-10-huan-xing-lian-biao-li-kou-141-ti" id="E10-ç¯å½¢é“¾è¡¨-åŠ›æ‰£-141-é¢˜">E10. ç¯å½¢é“¾è¡¨-åŠ›æ‰£ 141 é¢˜</h3><p>æœ¬é¢˜ä»¥åŠä¸‹é¢˜ï¼Œå®é™…æ˜¯ Floydâ€™s Tortoise and Hare Algorithm ï¼ˆFloyd é¾Ÿå…”èµ›è·‘ç®—æ³•ï¼‰[^15]</p><blockquote><p>é™¤äº† Floyd åˆ¤ç¯ç®—æ³•å¤–ï¼Œè¿˜æœ‰å…¶å®ƒçš„åˆ¤ç¯ç®—æ³•ï¼Œè¯¦è§ <a href="https://en.wikipedia.org/wiki/Cycle_detection">https://en.wikipedia.org/wiki/Cycle_detection</a></p></blockquote><img src="./imgs/image-20221229190646563.png" alt="image-20221229190646563" style="zoom: 50%;" /><p>å¦‚æœé“¾è¡¨ä¸Šå­˜åœ¨ç¯ï¼Œé‚£ä¹ˆåœ¨ç¯ä¸Šä»¥ä¸åŒé€Ÿåº¦å‰è¿›çš„ä¸¤ä¸ªæŒ‡é’ˆå¿…å®šä¼šåœ¨æŸä¸ªæ—¶åˆ»ç›¸é‡ã€‚ç®—æ³•åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ</p><p>é˜¶æ®µ1</p><ul><li>é¾Ÿä¸€æ¬¡èµ°ä¸€æ­¥ï¼Œå…”å­ä¸€æ¬¡èµ°ä¸¤æ­¥</li><li>å½“å…”å­èƒ½èµ°åˆ°ç»ˆç‚¹æ—¶ï¼Œä¸å­˜åœ¨ç¯</li><li>å½“å…”å­èƒ½è¿½ä¸Šé¾Ÿæ—¶ï¼Œå¯ä»¥åˆ¤æ–­å­˜åœ¨ç¯</li></ul><p>é˜¶æ®µ2</p><ul><li>ä»å®ƒä»¬ç¬¬ä¸€æ¬¡ç›¸é‡å¼€å§‹ï¼Œé¾Ÿå›åˆ°èµ·ç‚¹ï¼Œå…”å­ä¿æŒåŸä½ä¸å˜</li><li>é¾Ÿå’Œå…”å­ä¸€æ¬¡éƒ½èµ°ä¸€æ­¥</li><li>å½“å†æ¬¡ç›¸é‡æ—¶ï¼Œåœ°ç‚¹å°±æ˜¯ç¯çš„å…¥å£</li></ul><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>è®¾èµ·ç‚¹åˆ°å…¥å£èµ° a æ­¥ï¼ˆæœ¬ä¾‹æ˜¯ 7ï¼‰ï¼Œç»•ç¯ä¸€åœˆé•¿åº¦ä¸º bï¼ˆæœ¬ä¾‹æ˜¯ 5ï¼‰ï¼Œ</li><li>é‚£ä¹ˆ<strong>ä»èµ·ç‚¹å¼€å§‹ï¼Œèµ° a + ç»•ç¯ n åœˆï¼Œéƒ½èƒ½æ‰¾åˆ°ç¯å…¥å£</strong></li><li>ç¬¬ä¸€æ¬¡ç›¸é‡æ—¶<ul><li>å…”èµ°äº† a + ç»•ç¯ n åœˆï¼ˆæœ¬ä¾‹ 2 åœˆï¼‰ + kï¼Œk æ˜¯å®ƒä»¬ç›¸é‡è·ç¯å…¥å£ä½ç½®ï¼ˆæœ¬ä¾‹ 3ï¼Œä¸é‡è¦ï¼‰</li><li>é¾Ÿèµ°äº† a + ç»•ç¯ n åœˆï¼ˆæœ¬ä¾‹ 0 åœˆï¼‰ + kï¼Œå½“ç„¶å®ƒç»•çš„åœˆæ•°æ¯”å…”å°‘</li><li>å…”èµ°çš„è·ç¦»æ˜¯é¾Ÿçš„ä¸¤å€ï¼Œæ‰€ä»¥<strong>é¾Ÿèµ°çš„</strong> = å…”èµ°çš„ - é¾Ÿèµ°çš„ = <strong>ç»•ç¯ n åœˆ</strong></li></ul></li><li>è€Œå‰é¢åˆ†æè¿‡ï¼Œå¦‚æœèµ° a + ç»•ç¯ n åœˆï¼Œéƒ½èƒ½æ‰¾åˆ°ç¯å…¥å£ï¼Œå› æ­¤ä»ç›¸é‡ç‚¹å¼€å§‹ï¼Œå†èµ° a æ­¥ï¼Œå°±æ˜¯ç¯å…¥å£</li></ul><p>é˜¶æ®µ1 å‚è€ƒä»£ç ï¼ˆåˆ¤æ–­æ˜¯å¦æœ‰ç¯ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">h</span> <span class="operator">=</span> head; <span class="comment">// å…”</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">t</span> <span class="operator">=</span> head; <span class="comment">// é¾Ÿ</span></span><br><span class="line">    <span class="keyword">while</span> (h != <span class="literal">null</span> &amp;&amp; h.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        t = t.next;</span><br><span class="line">        h = h.next.next;</span><br><span class="line">        <span class="keyword">if</span>(h == t)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-11-huan-xing-lian-biao-li-kou-142-ti" id="E11-ç¯å½¢é“¾è¡¨-åŠ›æ‰£-142-é¢˜">E11. ç¯å½¢é“¾è¡¨-åŠ›æ‰£ 142 é¢˜</h3><p>é˜¶æ®µ2 å‚è€ƒä»£ç ï¼ˆæ‰¾åˆ°ç¯å…¥å£ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">detectCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">t</span> <span class="operator">=</span> head; <span class="comment">// é¾Ÿ</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">h</span> <span class="operator">=</span> head; <span class="comment">// å…”</span></span><br><span class="line">    <span class="keyword">while</span> (h != <span class="literal">null</span> &amp;&amp; h.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        t = t.next;</span><br><span class="line">        h = h.next.next;</span><br><span class="line">        <span class="keyword">if</span> (h == t) &#123;</span><br><span class="line">            t = head;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (h == t) &#123;</span><br><span class="line">                    <span class="keyword">return</span> h;</span><br><span class="line">                &#125;</span><br><span class="line">                h = h.next;</span><br><span class="line">                t = t.next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ex-1-shan-chu-jie-dian-li-kou-237-ti" id="Ex1-åˆ é™¤èŠ‚ç‚¹-åŠ›æ‰£-237-é¢˜">Ex1. åˆ é™¤èŠ‚ç‚¹-åŠ›æ‰£ 237 é¢˜</h3><p>è¿™é“é¢˜ç›®æ¯”è¾ƒç®€å•ï¼Œç•™ç»™å¤§å®¶è‡ªå·±ç»ƒä¹ </p><p>ä¾‹å¦‚</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">9</span>], <span class="keyword">node</span> <span class="title">= 5</span></span><br><span class="line">è¾“å‡ºï¼š[<span class="number">4</span>,<span class="number">1</span>,<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šhead = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">9</span>], <span class="keyword">node</span> <span class="title">= 1</span></span><br><span class="line">è¾“å‡ºï¼š[<span class="number">4</span>,<span class="number">5</span>,<span class="number">9</span>]</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¢«åˆ é™¤çš„èŠ‚ç‚¹<strong>ä¸æ˜¯</strong>æœ«å°¾èŠ‚ç‚¹</p><p><strong>å‚è€ƒç­”æ¡ˆ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ex1Leetcode237</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node å¾…åˆ é™¤èŠ‚ç‚¹, é¢˜ç›®å·²è¯´æ˜è‚¯å®šä¸æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteNode</span><span class="params">(ListNode node)</span> &#123;</span><br><span class="line">        node.val = node.next.val;<span class="comment">// ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å€¼èµ‹å€¼ç»™å¾…&quot;åˆ é™¤&quot;èŠ‚ç‚¹</span></span><br><span class="line">        node.next = node.next.next;<span class="comment">// æŠŠä¸‹ä¸€ä¸ªèŠ‚ç‚¹åˆ é™¤</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">o5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">5</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">o4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">4</span>, o5);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">o3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">3</span>, o4);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">o2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">2</span>, o3);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">o1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">1</span>, o2);</span><br><span class="line">        System.out.println(o1);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">E0xLeetcode237</span>().deleteNode(o3);</span><br><span class="line">        System.out.println(o1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[1,2,3,4,5]</span></span><br><span class="line"><span class="string">[1,2,4,5]</span></span><br></pre></td></tr></table></figure><h3 id="ex-2-gong-wei-lian-biao-li-kou-160-ti" id="Ex2-å…±å°¾é“¾è¡¨-åŠ›æ‰£-160-é¢˜">Ex2. å…±å°¾é“¾è¡¨-åŠ›æ‰£ 160 é¢˜</h3><p>åŸé¢˜å«åš<strong>ç›¸äº¤</strong>é“¾è¡¨ï¼Œä¸ªäººè§‰å¾—ç”¨<strong>å…±å°¾</strong>é“¾è¡¨æ›´å½¢è±¡äº›ï¼Œæ­¤é¢˜æ›´åƒæ˜¯ä¸€é“è„‘ç­‹æ€¥è½¬å¼¯ï¼Œç•™ç»™å¤§å®¶ç»ƒä¹ </p><p>ä¾‹å¦‚ï¼Œä¸‹å›¾çš„ä¸¤ä¸ªé“¾è¡¨ [1, 2, 4, 5] ä¸ [3, 4, 5] å®ƒä»¬ä¸­ [4, 5] æ˜¯ç›¸åŒçš„ï¼Œæ­¤æ—¶åº”è¿”å›èŠ‚ç‚¹ 4</p><p><img src="./imgs/image-20221228081715799.png" alt="image-20221228081715799"></p><p>éå…±å°¾çš„æƒ…å†µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ­¤æ—¶è¿”å› null</p><p><img src="./imgs/image-20221228082002730.png" alt="image-20221228082002730"></p><p>æ€è·¯ï¼Œç§°ä¸¤ä¸ªé“¾è¡¨ä¸º a=[1, 2, 4, 5]ï¼Œb=[3, 4, 5]ï¼Œå›¾ä¸­ç”¨ N ä»£è¡¨ null</p><ol><li>éå† aï¼Œé‡åˆ° null æ—¶æ”¹é“éå† b</li><li>ä¸æ­¤åŒæ—¶ï¼Œéå† bï¼Œé‡åˆ° null æ—¶æ”¹é“éå† a</li><li>åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå¦‚æœ<strong>é‡åˆ°ç›¸åŒ</strong>çš„èŠ‚ç‚¹ï¼Œå³ä¸ºæ‰¾å¯»ç›®æ ‡ï¼Œè¿”å›å³å¯ï¼Œå¦‚ä¸‹å›¾ä¸­çš„ç¬¬äºŒæ¬¡å‡ºç°çš„ 4</li><li>ç›¸åŒèŠ‚ç‚¹åº”è¯¥æ¯”è¾ƒå…¶<strong>å¼•ç”¨å€¼</strong>ï¼Œå›¾ä¸­æ•°å­—åªæ˜¯ä¸ºäº†ä¾¿äºåŒºåˆ†</li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span><span class="number">2</span><span class="number">4</span><span class="number">5</span>N<span class="number">3</span><span class="number">4</span><span class="number">5</span>N</span><br><span class="line"><span class="attribute">3</span><span class="number">4</span><span class="number">5</span>N<span class="number">1</span><span class="number">2</span><span class="number">4</span><span class="number">5</span>N</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸¤ä¸ªé“¾è¡¨é•¿åº¦ç›¸åŒï¼Œåˆ™å¯ä»¥æ›´æ—©æ‰¾åˆ°ç›®æ ‡ï¼Œä¾‹å¦‚ a=[1, 4, 5]ï¼Œb=[3, 4, 5]ï¼Œç¬¬ä¸€æ¬¡å‡ºç° 4 æ—¶ï¼Œå³å¯è¿”å›</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span><span class="number">4</span><span class="number">5</span>N<span class="number">3</span><span class="number">4</span><span class="number">5</span>N</span><br><span class="line"><span class="attribute">3</span><span class="number">4</span><span class="number">5</span>N<span class="number">1</span><span class="number">4</span><span class="number">5</span>N</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯éå…±å°¾çš„æƒ…å†µï¼Œå¦‚ a=[1, 2, 4]ï¼Œb=[3, 5]ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå”¯ä¸€ç›¸ç­‰çš„æƒ…å†µï¼Œæ˜¯éå†åˆ°æœ€åé‚£ä¸ª N æ­¤æ—¶é€€å‡ºå¾ªç¯</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span><span class="number">2</span><span class="number">4</span>N<span class="number">3</span><span class="number">5</span>N</span><br><span class="line"><span class="attribute">3</span><span class="number">5</span>N<span class="number">1</span><span class="number">2</span><span class="number">4</span>N</span><br></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">getIntersectionNode</span><span class="params">(ListNode a, ListNode b)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p1</span> <span class="operator">=</span> a;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p2</span> <span class="operator">=</span> b;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p1 == p2) &#123;</span><br><span class="line">            <span class="keyword">return</span> p1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (p1 == <span class="literal">null</span>) &#123;</span><br><span class="line">            p1 = b;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p1 = p1.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (p2 == <span class="literal">null</span>) &#123;</span><br><span class="line">            p2 = a;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p2 = p2.next;</span><br><span class="line">        &#125;            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-6-shu-zu">3.6 æ•°ç»„</h1><h3 id="e-01-he-bing-you-xu-shu-zu" id="E01-åˆå¹¶æœ‰åºæ•°ç»„">E01. åˆå¹¶æœ‰åºæ•°ç»„</h3><p>å°†æ•°ç»„å†…ä¸¤ä¸ªåŒºé—´å†…çš„æœ‰åºå…ƒç´ åˆå¹¶</p><p>ä¾‹</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[1, 5, 6, 2, 4, 10, 11]</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥è§†ä½œä¸¤ä¸ªæœ‰åºåŒºé—´</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[1, 5, 6]</span> å’Œ <span class="selector-attr">[2, 4, 10, 11]</span></span><br></pre></td></tr></table></figure><p>åˆå¹¶åï¼Œç»“æœä»å­˜å‚¨äºåŸæœ‰ç©ºé—´</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[1, 2, 4, 5, 6, 10, 11]</span></span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•1</strong></p><p>é€’å½’</p><ul><li>æ¯æ¬¡é€’å½’æŠŠæ›´å°çš„å…ƒç´ å¤åˆ¶åˆ°ç»“æœæ•°ç»„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">merge(left=[<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>],right=[<span class="number">2</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">11</span>],a2=[])&#123;</span><br><span class="line">    merge(left=[<span class="number">5</span>,<span class="number">6</span>],right=[<span class="number">2</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">11</span>],a2=[<span class="number">1</span>])&#123;</span><br><span class="line">        merge(left=[<span class="number">5</span>,<span class="number">6</span>],right=[<span class="number">4</span>,<span class="number">10</span>,<span class="number">11</span>],a2=[<span class="number">1</span>,<span class="number">2</span>])&#123;</span><br><span class="line">            merge(left=[<span class="number">5</span>,<span class="number">6</span>],right=[<span class="number">10</span>,<span class="number">11</span>],a2=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>])&#123;</span><br><span class="line">                merge(left=[<span class="number">6</span>],right=[<span class="number">10</span>,<span class="number">11</span>],a2=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>])&#123;</span><br><span class="line">                    merge(left=[],right=[<span class="number">10</span>,<span class="number">11</span>],a2=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>])&#123;</span><br><span class="line"><span class="comment">// æ‹·è´10ï¼Œ11</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] a1, <span class="type">int</span> i, <span class="type">int</span> iEnd, <span class="type">int</span> j, <span class="type">int</span> jEnd,</span></span><br><span class="line"><span class="params">                              <span class="type">int</span>[] a2, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; iEnd) &#123;</span><br><span class="line">        System.arraycopy(a1, j, a2, k, jEnd - j + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (j &gt; jEnd) &#123;</span><br><span class="line">        System.arraycopy(a1, i, a2, k, iEnd - i + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (a1[i] &lt; a1[j]) &#123;</span><br><span class="line">        a2[k] = a1[i];</span><br><span class="line">        merge(a1, i + <span class="number">1</span>, iEnd, j, jEnd, a2, k + <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        a2[k] = a1[j];</span><br><span class="line">        merge(a1, i, iEnd, j + <span class="number">1</span>, jEnd, a2, k + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] a1 = &#123;<span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">11</span>&#125;;</span><br><span class="line"><span class="type">int</span>[] a2 = <span class="keyword">new</span> <span class="title class_">int</span>[a1.length];</span><br><span class="line">merge(a1, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, a2, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•2</strong></p><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] a1, <span class="type">int</span> i, <span class="type">int</span> iEnd,</span></span><br><span class="line"><span class="params">                             <span class="type">int</span> j, <span class="type">int</span> jEnd,</span></span><br><span class="line"><span class="params">                             <span class="type">int</span>[] a2)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> i;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= iEnd &amp;&amp; j &lt;= jEnd) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a1[i] &lt; a1[j]) &#123;</span><br><span class="line">            a2[k] = a1[i];</span><br><span class="line">            i++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            a2[k] = a1[j];</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">        k++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; leftEnd) &#123;</span><br><span class="line">        System.arraycopy(a1, j, a2, k, jEnd - j + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (j &gt; rightEnd) &#123;</span><br><span class="line">        System.arraycopy(a1, i, a2, k, iEnd - i + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] a1 = &#123;<span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">11</span>&#125;;</span><br><span class="line"><span class="type">int</span>[] a2 = <span class="keyword">new</span> <span class="title class_">int</span>[a3.length];</span><br><span class="line">merge(a1, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, a2);</span><br></pre></td></tr></table></figure><p>å½’å¹¶æ’åºä»£ç å¤‡ä»½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">split</span><span class="params">(<span class="type">int</span>[] a1, <span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span>[] a2)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;i=&quot;</span> + i + <span class="string">&quot; j=&quot;</span> + j + <span class="string">&quot; a1=&quot;</span> + Arrays.toString(Arrays.copyOfRange(a1, i, j + <span class="number">1</span>)));</span><br><span class="line">    <span class="keyword">if</span> (i == j) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    split(a1, i, m, a2);</span><br><span class="line">    split(a1, m + <span class="number">1</span>, j, a2);</span><br><span class="line">    <span class="comment">//merge(a1, i, m, m+1, j, a2); // éé€’å½’</span></span><br><span class="line">    <span class="comment">//merge(a1, i, m, m + 1, j, a2, i); // é€’å½’</span></span><br><span class="line">    System.arraycopy(a2, i, a1, i, (j - i + <span class="number">1</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;i=&quot;</span> + i + <span class="string">&quot; m=&quot;</span> + m + <span class="string">&quot; j=&quot;</span> + j + <span class="string">&quot; a1=&quot;</span> + Arrays.toString(a1) + <span class="string">&quot; a2=&quot;</span> + Arrays.toString(a2));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span>[] a1 = &#123;<span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">11</span>&#125;;</span><br><span class="line"><span class="type">int</span>[] a2 = <span class="keyword">new</span> <span class="title class_">int</span>[a1.length];</span><br><span class="line">split(a1, <span class="number">0</span>, a1.length - <span class="number">1</span>, a2);</span><br><span class="line">System.out.println(Arrays.toString(a1));</span><br></pre></td></tr></table></figure><h1 id="3-7-dui-lie">3.7 é˜Ÿåˆ—</h1><h3 id="e-01-er-cha-shu-ceng-xu-bian-li-li-kou-102-ti" id="E01-äºŒå‰æ ‘å±‚åºéå†-åŠ›æ‰£-102-é¢˜">E01. äºŒå‰æ ‘å±‚åºéå†-åŠ›æ‰£ 102 é¢˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        LinkedListQueue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedListQueue</span>&lt;&gt;();</span><br><span class="line">        queue.offer(root);</span><br><span class="line">        <span class="type">int</span> <span class="variable">c1</span> <span class="operator">=</span> <span class="number">1</span>;<span class="comment">// æœ¬å±‚èŠ‚ç‚¹ä¸ªæ•°</span></span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">c2</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// ä¸‹å±‚èŠ‚ç‚¹ä¸ªæ•°</span></span><br><span class="line">            List&lt;Integer&gt; level = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; c1; i++) &#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                level.add(node.val);</span><br><span class="line">                <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                    queue.offer(node.left);</span><br><span class="line">                    c2++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                    queue.offer(node.right);</span><br><span class="line">                    c2++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            c1 = c2;</span><br><span class="line">            result.add(level);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LinkedListQueue</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt; &#123;</span><br><span class="line">            E value;</span><br><span class="line">            Node&lt;E&gt; next;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(E value, Node&lt;E&gt; next)</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.value = value;</span><br><span class="line">                <span class="built_in">this</span>.next = next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Node&lt;E&gt; head = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(<span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">private</span> Node&lt;E&gt; tail = head;</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> <span class="variable">capacity</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            tail.next = head;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">LinkedListQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">LinkedListQueue</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(E value)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Node&lt;E&gt; added = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(value, head);</span><br><span class="line">            tail.next = added;</span><br><span class="line">            tail = added;</span><br><span class="line">            size++;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Node&lt;E&gt; first = head.next;</span><br><span class="line">            head.next = first.next;</span><br><span class="line">            <span class="keyword">if</span> (first == tail) &#123;</span><br><span class="line">                tail = head;</span><br><span class="line">            &#125;</span><br><span class="line">            size--;</span><br><span class="line">            <span class="keyword">return</span> first.value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> head.next.value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> head == tail;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> size == capacity;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ex-1-she-ji-dui-lie-li-kou-622-ti" id="Ex1-è®¾è®¡é˜Ÿåˆ—-åŠ›æ‰£-622-é¢˜">Ex1. è®¾è®¡é˜Ÿåˆ—-åŠ›æ‰£ 622 é¢˜</h3><p>ç”±äºä¸è¯¾å ‚ä¾‹é¢˜å·®åˆ«ä¸å¤§ï¼Œè¿™é‡Œåªç»™å‡ºå‚è€ƒè§£ç­”</p><p>åŸºäºé“¾è¡¨çš„å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ex1Leetcode622</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        <span class="type">int</span> value;</span><br><span class="line">        Node next;</span><br><span class="line">        Node(<span class="type">int</span> value, Node next) &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(-<span class="number">1</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Node</span> <span class="variable">tail</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">capacity</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        tail.next = head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Ex1Leetcode622</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">enQueue</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">added</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(value, head);</span><br><span class="line">        tail.next = added;</span><br><span class="line">        tail = added;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">first</span> <span class="operator">=</span> head.next;</span><br><span class="line">        head.next = first.next;</span><br><span class="line">        <span class="keyword">if</span> (first == tail) &#123;</span><br><span class="line">            tail = head;</span><br><span class="line">        &#125;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">Front</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head.next.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">Rear</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tail.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> head == tail;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == capacity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ul><li>Leetcode çš„å®ç°é‡Œ deQueueï¼ˆå‡ºé˜Ÿï¼‰è¿”å›å€¼æ˜¯å¸ƒå°”å€¼ï¼Œå¹¶ä¸ä¼šè¿”å›é˜Ÿå¤´å…ƒç´ </li><li>å®ƒæœŸæœ›ç”¨æ³•æ˜¯å…ˆç”¨ Front è¿”å›å¯¹å¤´å…ƒç´ ï¼Œå† deQueue å‡ºé˜Ÿ</li></ul><h1 id="3-8-zhan">3.8 æ ˆ</h1><h3 id="e-01-you-xiao-de-gua-hao-li-kou-20-ti" id="E01-æœ‰æ•ˆçš„æ‹¬å·-åŠ›æ‰£-20-é¢˜">E01. æœ‰æ•ˆçš„æ‹¬å·-åŠ›æ‰£ 20 é¢˜</h3><p>ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­å¯èƒ½å‡ºç° <code>[]</code> <code>()</code> å’Œ <code>&#123;&#125;</code> ä¸‰ç§æ‹¬å·ï¼Œåˆ¤æ–­è¯¥æ‹¬å·æ˜¯å¦æœ‰æ•ˆ</p><p>æœ‰æ•ˆçš„ä¾‹å­</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">()<span class="selector-attr">[]</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">([&#123;&#125;])</span><br><span class="line"></span><br><span class="line">()</span><br></pre></td></tr></table></figure><p>æ— æ•ˆçš„ä¾‹å­</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">[)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">(<span class="comment">[)]</span></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">(<span class="comment">[]</span></span></span><br></pre></td></tr></table></figure><p>æ€è·¯</p><ul><li>é‡åˆ°å·¦æ‹¬å·, æŠŠè¦é…å¯¹çš„å³æ‹¬å·æ”¾å…¥æ ˆé¡¶</li><li>é‡åˆ°å³æ‹¬å·, è‹¥æ­¤æ—¶æ ˆä¸ºç©º, è¿”å› falseï¼Œå¦åˆ™æŠŠå®ƒä¸æ ˆé¡¶å…ƒç´ å¯¹æ¯”<ul><li>è‹¥ç›¸ç­‰, æ ˆé¡¶å…ƒç´ å¼¹å‡º, ç»§ç»­å¯¹æ¯”ä¸‹ä¸€ç»„</li><li>è‹¥ä¸ç­‰, æ— æ•ˆæ‹¬å·ç›´æ¥è¿”å› false</li></ul></li><li>å¾ªç¯ç»“æŸ<ul><li>è‹¥æ ˆä¸ºç©º, è¡¨ç¤ºæ‰€æœ‰æ‹¬å·éƒ½é…ä¸Šå¯¹, è¿”å› true</li><li>è‹¥æ ˆä¸ä¸ºç©º, è¡¨ç¤ºå³æ²¡é…å¯¹çš„æ‹¬å·, åº”è¿”å› false</li></ul></li></ul><p>ç­”æ¡ˆï¼ˆç”¨åˆ°äº†è¯¾å ‚æ¡ˆä¾‹ä¸­çš„ ArrayStack ç±»ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    ArrayStack&lt;Character&gt; stack = <span class="keyword">new</span> <span class="title class_">ArrayStack</span>&lt;&gt;(s.length() / <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(i);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="string">&#x27;(&#x27;</span>) &#123;</span><br><span class="line">            stack.push(<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">&#x27;[&#x27;</span>) &#123;</span><br><span class="line">            stack.push(<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">&#x27;&#123;&#x27;</span>) &#123;</span><br><span class="line">            stack.push(<span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!stack.isEmpty() &amp;&amp; stack.peek() == c) &#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> stack.isEmpty();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-02-hou-zhui-biao-da-shi-qiu-zhi-li-kou-120-ti" id="E02-åç¼€è¡¨è¾¾å¼æ±‚å€¼-åŠ›æ‰£-120-é¢˜">E02. åç¼€è¡¨è¾¾å¼æ±‚å€¼-åŠ›æ‰£ 120 é¢˜</h3><p>åç¼€è¡¨è¾¾å¼ä¹Ÿç§°ä¸ºé€†æ³¢å…°è¡¨è¾¾å¼ï¼Œå³è¿ç®—ç¬¦å†™åœ¨åé¢</p><ul><li>ä»å·¦å‘å³è¿›è¡Œè®¡ç®—</li><li>ä¸å¿…è€ƒè™‘è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼Œå³ä¸ç”¨åŒ…å«æ‹¬å·</li></ul><p>ç¤ºä¾‹</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š<span class="built_in">tokens</span> = [<span class="string">&quot;2&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;+&quot;</span>,<span class="string">&quot;3&quot;</span>,<span class="string">&quot;*&quot;</span>]</span><br><span class="line">è¾“å‡ºï¼š<span class="number">9</span></span><br><span class="line">å³ï¼š(<span class="number">2</span> + <span class="number">1</span>) * <span class="number">3</span></span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼š<span class="built_in">tokens</span> = [<span class="string">&quot;4&quot;</span>,<span class="string">&quot;13&quot;</span>,<span class="string">&quot;5&quot;</span>,<span class="string">&quot;/&quot;</span>,<span class="string">&quot;+&quot;</span>]</span><br><span class="line">è¾“å‡ºï¼š<span class="number">6</span></span><br><span class="line">å³ï¼š<span class="number">4</span> + (<span class="number">13</span> / <span class="number">5</span>)</span><br></pre></td></tr></table></figure><p>é¢˜ç›®å‡è®¾</p><ul><li>æ•°å­—éƒ½è§†ä¸ºæ•´æ•°</li><li>æ•°å­—å’Œè¿ç®—ç¬¦ä¸ªæ•°ç»™å®šæ­£ç¡®ï¼Œä¸ä¼šæœ‰é™¤é›¶å‘ç”Ÿ</li></ul><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">evalRPN</span><span class="params">(String[] tokens)</span> &#123;</span><br><span class="line">    LinkedList&lt;Integer&gt; numbers = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String t : tokens) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (t) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;+&quot;</span> -&gt; &#123;</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">b</span> <span class="operator">=</span> numbers.pop();</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">a</span> <span class="operator">=</span> numbers.pop();</span><br><span class="line">                numbers.push(a + b);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;-&quot;</span> -&gt; &#123;</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">b</span> <span class="operator">=</span> numbers.pop();</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">a</span> <span class="operator">=</span> numbers.pop();</span><br><span class="line">                numbers.push(a - b);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;*&quot;</span> -&gt; &#123;</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">b</span> <span class="operator">=</span> numbers.pop();</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">a</span> <span class="operator">=</span> numbers.pop();</span><br><span class="line">                numbers.push(a * b);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;/&quot;</span> -&gt; &#123;</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">b</span> <span class="operator">=</span> numbers.pop();</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">a</span> <span class="operator">=</span> numbers.pop();</span><br><span class="line">                numbers.push(a / b);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">default</span> -&gt; numbers.push(Integer.parseInt(t));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> numbers.pop();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-03-zhong-zhui-biao-da-shi-zhuan-hou-zhui" id="E03-ä¸­ç¼€è¡¨è¾¾å¼è½¬åç¼€">E03. ä¸­ç¼€è¡¨è¾¾å¼è½¬åç¼€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">E03InfixToSuffix</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        æ€è·¯</span></span><br><span class="line"><span class="comment">        1. é‡åˆ°æ•°å­—, æ‹¼ä¸²</span></span><br><span class="line"><span class="comment">        2. é‡åˆ° + - * /</span></span><br><span class="line"><span class="comment">            - ä¼˜å…ˆçº§é«˜äºæ ˆé¡¶è¿ç®—ç¬¦ å…¥æ ˆ</span></span><br><span class="line"><span class="comment">            - å¦åˆ™å°†æ ˆä¸­é«˜çº§æˆ–å¹³çº§è¿ç®—ç¬¦å‡ºæ ˆæ‹¼ä¸², æœ¬è¿ç®—ç¬¦å…¥æ ˆ</span></span><br><span class="line"><span class="comment">        3. éå†å®Œæˆ, æ ˆä¸­å‰©ä½™è¿ç®—ç¬¦å‡ºæ ˆæ‹¼ä¸²</span></span><br><span class="line"><span class="comment">            - å…ˆå‡ºæ ˆ,æ„å‘³ç€ä¼˜å…ˆè¿ç®—</span></span><br><span class="line"><span class="comment">        4. å¸¦ ()</span></span><br><span class="line"><span class="comment">            - å·¦æ‹¬å·ç›´æ¥å…¥æ ˆ</span></span><br><span class="line"><span class="comment">            - å³æ‹¬å·è¦å°†æ ˆä¸­ç›´è‡³å·¦æ‹¬å·ä¸ºæ­¢çš„è¿ç®—ç¬¦å‡ºæ ˆæ‹¼ä¸²</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        |   |</span></span><br><span class="line"><span class="comment">        |   |</span></span><br><span class="line"><span class="comment">        |   |</span></span><br><span class="line"><span class="comment">        _____</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        a+b</span></span><br><span class="line"><span class="comment">        a+b-c</span></span><br><span class="line"><span class="comment">        a+b*c</span></span><br><span class="line"><span class="comment">        a*b+c</span></span><br><span class="line"><span class="comment">        (a+b)*c</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(infixToSuffix(<span class="string">&quot;a+b&quot;</span>));</span><br><span class="line">        System.out.println(infixToSuffix(<span class="string">&quot;a+b-c&quot;</span>));</span><br><span class="line">        System.out.println(infixToSuffix(<span class="string">&quot;a+b*c&quot;</span>));</span><br><span class="line">        System.out.println(infixToSuffix(<span class="string">&quot;a*b-c&quot;</span>));</span><br><span class="line">        System.out.println(infixToSuffix(<span class="string">&quot;(a+b)*c&quot;</span>));</span><br><span class="line">        System.out.println(infixToSuffix(<span class="string">&quot;a+b*c+(d*e+f)*g&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> String <span class="title function_">infixToSuffix</span><span class="params">(String exp)</span> &#123;</span><br><span class="line">        LinkedList&lt;Character&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(exp.length());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; exp.length(); i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> exp.charAt(i);</span><br><span class="line">            <span class="keyword">switch</span> (c) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;/&#x27;</span> -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (stack.isEmpty()) &#123;</span><br><span class="line">                        stack.push(c);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (priority(c) &gt; priority(stack.peek())) &#123;</span><br><span class="line">                            stack.push(c);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">while</span> (!stack.isEmpty() </span><br><span class="line">                                   &amp;&amp; priority(stack.peek()) &gt;= priority(c)) &#123;</span><br><span class="line">                                sb.append(stack.pop());</span><br><span class="line">                            &#125;</span><br><span class="line">                            stack.push(c);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;(&#x27;</span> -&gt; &#123;</span><br><span class="line">                    stack.push(c);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;)&#x27;</span> -&gt; &#123;</span><br><span class="line">                    <span class="keyword">while</span> (!stack.isEmpty() &amp;&amp; stack.peek() != <span class="string">&#x27;(&#x27;</span>) &#123;</span><br><span class="line">                        sb.append(stack.pop());</span><br><span class="line">                    &#125;</span><br><span class="line">                    stack.pop();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">default</span> -&gt; &#123;</span><br><span class="line">                    sb.append(c);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            sb.append(stack.pop());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">priority</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">switch</span> (c) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;(&#x27;</span> -&gt; <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;/&#x27;</span> -&gt; <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;-&#x27;</span> -&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">default</span> -&gt; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;ä¸åˆæ³•å­—ç¬¦:&quot;</span> + c);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-04-shuang-zhan-mo-ni-dui-lie-li-kou-232-ti" id="E04-åŒæ ˆæ¨¡æ‹Ÿé˜Ÿåˆ—-åŠ›æ‰£-232-é¢˜">E04. åŒæ ˆæ¨¡æ‹Ÿé˜Ÿåˆ—-åŠ›æ‰£ 232 é¢˜</h3><p>ç»™åŠ›æ‰£é¢˜ç›®ç”¨çš„<strong>è‡ªå®ç°</strong>æ ˆï¼Œå¯ä»¥å®šä¹‰ä¸ºé™æ€å†…éƒ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ArrayStack</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> E[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> top; <span class="comment">// æ ˆé¡¶æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArrayStack</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.array = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">push</span><span class="params">(E value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        array[top++] = value;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[--top];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[top - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> top == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> top == array.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒè§£ç­”ï¼Œæ³¨æ„ï¼šé¢˜ç›®å·²è¯´æ˜</p><ul><li>è°ƒç”¨ pushã€pop ç­‰æ–¹æ³•çš„æ¬¡æ•°æœ€å¤š 100</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">E04Leetcode232</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        é˜Ÿåˆ—å¤´      é˜Ÿåˆ—å°¾</span></span><br><span class="line"><span class="comment">        s1       s2</span></span><br><span class="line"><span class="comment">        é¡¶   åº•   åº•   é¡¶</span></span><br><span class="line"><span class="comment">                 abc</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        push(a)</span></span><br><span class="line"><span class="comment">        push(b)</span></span><br><span class="line"><span class="comment">        push(c)</span></span><br><span class="line"><span class="comment">        pop()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ArrayStack&lt;Integer&gt; s1 = <span class="keyword">new</span> <span class="title class_">ArrayStack</span>&lt;&gt;(<span class="number">100</span>);</span><br><span class="line">    ArrayStack&lt;Integer&gt; s2 = <span class="keyword">new</span> <span class="title class_">ArrayStack</span>&lt;&gt;(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        s2.push(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s1.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!s2.isEmpty()) &#123;</span><br><span class="line">                s1.push(s2.pop());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s1.pop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s1.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!s2.isEmpty()) &#123;</span><br><span class="line">                s1.push(s2.pop());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s1.peek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> s1.isEmpty() &amp;&amp; s2.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-05-dan-dui-lie-mo-ni-zhan-li-kou-225-ti" id="E05-å•é˜Ÿåˆ—æ¨¡æ‹Ÿæ ˆ-åŠ›æ‰£-225-é¢˜">E05. å•é˜Ÿåˆ—æ¨¡æ‹Ÿæ ˆ-åŠ›æ‰£ 225 é¢˜</h3><p>ç»™åŠ›æ‰£é¢˜ç›®ç”¨çš„<strong>è‡ªå®ç°</strong>é˜Ÿåˆ—ï¼Œå¯ä»¥å®šä¹‰ä¸ºé™æ€å†…éƒ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayQueue3</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> E[] array;</span><br><span class="line">    <span class="type">int</span> <span class="variable">head</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">tail</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArrayQueue3</span><span class="params">(<span class="type">int</span> c)</span> &#123;</span><br><span class="line">        c -= <span class="number">1</span>;</span><br><span class="line">        c |= c &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        c |= c &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        c |= c &gt;&gt; <span class="number">4</span>;</span><br><span class="line">        c |= c &gt;&gt; <span class="number">8</span>;</span><br><span class="line">        c |= c &gt;&gt; <span class="number">16</span>;</span><br><span class="line">        c += <span class="number">1</span>;</span><br><span class="line">        array = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[c];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(E value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;        </span><br><span class="line">        array[tail &amp; (array.length - <span class="number">1</span>)] = value;</span><br><span class="line">        tail++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> array[head &amp; (array.length - <span class="number">1</span>)];</span><br><span class="line">        head++;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[head &amp; (array.length - <span class="number">1</span>)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> head == tail;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tail - head == array.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒè§£ç­”ï¼Œæ³¨æ„ï¼šé¢˜ç›®å·²è¯´æ˜</p><ul><li>è°ƒç”¨ pushã€pop ç­‰æ–¹æ³•çš„æ¬¡æ•°æœ€å¤š 100</li><li>æ¯æ¬¡è°ƒç”¨ pop å’Œ top éƒ½èƒ½ä¿è¯æ ˆä¸ä¸ºç©º</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">E05Leetcode225</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        é˜Ÿåˆ—å¤´     é˜Ÿåˆ—å°¾</span></span><br><span class="line"><span class="comment">        cba</span></span><br><span class="line"><span class="comment">        é¡¶           åº•</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        queue.offer(a)</span></span><br><span class="line"><span class="comment">        queue.offer(b)</span></span><br><span class="line"><span class="comment">        queue.offer(c)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ArrayQueue3&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">ArrayQueue3</span>&lt;&gt;(<span class="number">100</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        queue.offer(x);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            queue.offer(queue.poll());</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> queue.poll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">top</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queue.peek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queue.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-9-shuang-duan-dui-lie">3.9 åŒç«¯é˜Ÿåˆ—</h1><h3 id="e-01-er-cha-shu-z-zi-ceng-xu-bian-li-li-kou-103-ti" id="E01-äºŒå‰æ ‘-Z-å­—å±‚åºéå†-åŠ›æ‰£-103-é¢˜">E01. äºŒå‰æ ‘ Z å­—å±‚åºéå†-åŠ›æ‰£ 103 é¢˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">E01Leetcode103</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">zigzagLevelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        LinkedList&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue.offer(root);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">leftToRight</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">c1</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">c2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            LinkedList&lt;Integer&gt; deque = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; c1; i++) &#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">n</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                <span class="keyword">if</span> (leftToRight) &#123;</span><br><span class="line">                    deque.offerLast(n.val);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    deque.offerFirst(n.val);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (n.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                    queue.offer(n.left);</span><br><span class="line">                    c2++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (n.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                    queue.offer(n.right);</span><br><span class="line">                    c2++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            c1 = c2;</span><br><span class="line">            leftToRight = !leftToRight;</span><br><span class="line">            result.add(deque);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">TreeNode</span>(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">4</span>),</span><br><span class="line">                        <span class="number">2</span>,</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">5</span>)</span><br><span class="line">                ),</span><br><span class="line">                <span class="number">1</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">TreeNode</span>(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">6</span>),</span><br><span class="line">                        <span class="number">3</span>,</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">7</span>)</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; lists = <span class="keyword">new</span> <span class="title class_">E01Leetcode103</span>().zigzagLevelOrder(root);</span><br><span class="line">        <span class="keyword">for</span> (List&lt;Integer&gt; list : lists) &#123;</span><br><span class="line">            System.out.println(list);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ex-1-she-ji-shuang-duan-dui-lie-li-kou-641-ti" id="Ex1-è®¾è®¡åŒç«¯é˜Ÿåˆ—-åŠ›æ‰£-641-é¢˜">Ex1. è®¾è®¡åŒç«¯é˜Ÿåˆ—-åŠ›æ‰£ 641 é¢˜</h3><p>ä¸è¯¾å ‚ä¾‹é¢˜ä¹Ÿæ˜¯å·®åˆ«ä¸å¤§ï¼Œè¯·å‚è€ƒ</p><h1 id="3-10-you-xian-ji-dui-lie">3.10 ä¼˜å…ˆçº§é˜Ÿåˆ—</h1><h3 id="e-01-he-bing-duo-ge-you-xu-lian-biao-li-kou-23-ti" id="E01-åˆå¹¶å¤šä¸ªæœ‰åºé“¾è¡¨-åŠ›æ‰£-23-é¢˜">E01. åˆå¹¶å¤šä¸ªæœ‰åºé“¾è¡¨-åŠ›æ‰£ 23 é¢˜</h3><p>è¿™é“é¢˜ç›®ä¹‹å‰è§£ç­”è¿‡ï¼Œç°åœ¨ç”¨åˆšå­¦çš„ä¼˜å…ˆçº§é˜Ÿåˆ—æ¥å®ç°ä¸€ä¸‹</p><p>é¢˜ç›®ä¸­è¦ä»å°åˆ°å¤§æ’åˆ—ï¼Œå› æ­¤é€‰æ‹©ç”¨å°é¡¶å †æ¥å®ç°ï¼Œè‡ªå®šä¹‰å°é¡¶å †å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinHeap</span> &#123;</span><br><span class="line"></span><br><span class="line">    ListNode[] array;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MinHeap</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        array = <span class="keyword">new</span> <span class="title class_">ListNode</span>[capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">offer</span><span class="params">(ListNode offered)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">child</span> <span class="operator">=</span> size++;</span><br><span class="line">        <span class="type">int</span> <span class="variable">parent</span> <span class="operator">=</span> (child - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">while</span> (child &gt; <span class="number">0</span> &amp;&amp; offered.val &lt; array[parent].val) &#123;</span><br><span class="line">            array[child] = array[parent];</span><br><span class="line">            child = parent;</span><br><span class="line">            parent = (child - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        array[child] = offered;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(<span class="number">0</span>, size - <span class="number">1</span>);</span><br><span class="line">        size--;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">e</span> <span class="operator">=</span> array[size];</span><br><span class="line">        array[size] = <span class="literal">null</span>; <span class="comment">// help GC</span></span><br><span class="line"></span><br><span class="line">        down(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">down</span><span class="params">(<span class="type">int</span> parent)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">2</span> * parent + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> left + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> parent;</span><br><span class="line">        <span class="keyword">if</span> (left &lt; size &amp;&amp; array[left].val &lt; array[min].val) &#123;</span><br><span class="line">            min = left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (right &lt; size &amp;&amp; array[right].val &lt; array[min].val) &#123;</span><br><span class="line">            min = right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (min != parent) &#123;</span><br><span class="line">            swap(min, parent);</span><br><span class="line">            down(min);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">t</span> <span class="operator">=</span> array[i];</span><br><span class="line">        array[i] = array[j];</span><br><span class="line">        array[j] = t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">E01Leetcode23</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">mergeKLists</span><span class="params">(ListNode[] lists)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. ä½¿ç”¨ jdk çš„ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°</span></span><br><span class="line"><span class="comment">//        PriorityQueue&lt;ListNode&gt; queue = new PriorityQueue&lt;&gt;(Comparator.comparingInt(a -&gt; a.val));</span></span><br><span class="line">        <span class="comment">// 2. ä½¿ç”¨è‡ªå®šä¹‰å°é¡¶å †å®ç°</span></span><br><span class="line">        <span class="type">MinHeap</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MinHeap</span>(lists.length);</span><br><span class="line">        <span class="keyword">for</span> (ListNode head : lists) &#123;</span><br><span class="line">            <span class="keyword">if</span> (head != <span class="literal">null</span>) &#123;</span><br><span class="line">                queue.offer(head);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> s;</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">            p.next = node;</span><br><span class="line">            p = node;</span><br><span class="line">            <span class="keyword">if</span> (node.next != <span class="literal">null</span>) &#123;</span><br><span class="line">                queue.offer(node.next);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æé—®ï¼š</p><ul><li>èƒ½å¦å°†æ¯ä¸ªé“¾è¡¨çš„æ‰€æœ‰å…ƒç´ å…¨éƒ¨åŠ å…¥å †ï¼Œå†ä¸€ä¸ªä¸ªä»å †é¡¶ç§»é™¤ï¼Ÿ</li></ul><p>å›ç­”ï¼š</p><ul><li>å¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†å¯¹ç©ºé—´å ç”¨å°±é«˜äº†ï¼Œå †çš„ä¸€ä¸ªä¼˜ç‚¹å°±æ˜¯ç”¨æœ‰é™çš„ç©ºé—´åšäº‹æƒ…</li></ul><h1 id="3-11-dui">3.11 å †</h1><h3 id="e-01-dui-pai-xu" id="E01-å †æ’åº">E01. å †æ’åº</h3><p>ç®—æ³•æè¿°</p><ol><li>heapify å»ºç«‹å¤§é¡¶å †</li><li>å°†å †é¡¶ä¸å †åº•äº¤æ¢ï¼ˆæœ€å¤§å…ƒç´ è¢«äº¤æ¢åˆ°å †åº•ï¼‰ï¼Œç¼©å°å¹¶ä¸‹æ½œè°ƒæ•´å †</li><li>é‡å¤ç¬¬äºŒæ­¥ç›´è‡³å †é‡Œå‰©ä¸€ä¸ªå…ƒç´ </li></ol><p>å¯ä»¥ä½¿ç”¨ä¹‹å‰è¯¾å ‚ä¾‹é¢˜çš„å¤§é¡¶å †æ¥å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] array = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125;;</span><br><span class="line"><span class="type">MaxHeap</span> <span class="variable">maxHeap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MaxHeap</span>(array);</span><br><span class="line">System.out.println(Arrays.toString(maxHeap.array));</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (maxHeap.size &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    maxHeap.swap(<span class="number">0</span>, maxHeap.size - <span class="number">1</span>);</span><br><span class="line">    maxHeap.size--;</span><br><span class="line">    maxHeap.down(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(Arrays.toString(maxHeap.array));</span><br></pre></td></tr></table></figure><h3 id="e-02-shu-zu-zhong-di-k-da-yuan-su-li-kou-215-ti" id="E02-æ•°ç»„ä¸­ç¬¬Kå¤§å…ƒç´ -åŠ›æ‰£-215-é¢˜">E02. æ•°ç»„ä¸­ç¬¬Kå¤§å…ƒç´ -åŠ›æ‰£ 215 é¢˜</h3><p>å°é¡¶å †ï¼ˆå¯åˆ å»ç”¨ä¸åˆ°ä»£ç ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MinHeap</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] array;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MinHeap</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        array = <span class="keyword">new</span> <span class="title class_">int</span>[capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">heapify</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> (size &gt;&gt; <span class="number">1</span>) - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            down(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">        swap(<span class="number">0</span>, size - <span class="number">1</span>);</span><br><span class="line">        size--;</span><br><span class="line">        down(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> array[size];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">poll</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        swap(index, size - <span class="number">1</span>);</span><br><span class="line">        size--;</span><br><span class="line">        down(index);</span><br><span class="line">        <span class="keyword">return</span> array[size];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> array[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(<span class="type">int</span> offered)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (size == array.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        up(offered);</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">replace</span><span class="params">(<span class="type">int</span> replaced)</span> &#123;</span><br><span class="line">        array[<span class="number">0</span>] = replaced;</span><br><span class="line">        down(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">up</span><span class="params">(<span class="type">int</span> offered)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">child</span> <span class="operator">=</span> size;</span><br><span class="line">        <span class="keyword">while</span> (child &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">parent</span> <span class="operator">=</span> (child - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (offered &lt; array[parent]) &#123;</span><br><span class="line">                array[child] = array[parent];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            child = parent;</span><br><span class="line">        &#125;</span><br><span class="line">        array[child] = offered;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">down</span><span class="params">(<span class="type">int</span> parent)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> (parent &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> left + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> parent;</span><br><span class="line">        <span class="keyword">if</span> (left &lt; size &amp;&amp; array[left] &lt; array[min]) &#123;</span><br><span class="line">            min = left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (right &lt; size &amp;&amp; array[right] &lt; array[min]) &#123;</span><br><span class="line">            min = right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (min != parent) &#123;</span><br><span class="line">            swap(min, parent);</span><br><span class="line">            down(min);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº¤æ¢ä¸¤ä¸ªç´¢å¼•å¤„çš„å…ƒç´ </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> array[i];</span><br><span class="line">        array[i] = array[j];</span><br><span class="line">        array[j] = t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢˜è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findKthLargest</span><span class="params">(<span class="type">int</span>[] numbers, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="type">MinHeap</span> <span class="variable">heap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MinHeap</span>(k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">        heap.offer(numbers[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> k; i &lt; numbers.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(numbers[i] &gt; heap.peek())&#123;</span><br><span class="line">            heap.replace(numbers[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> heap.peek();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ±‚æ•°ç»„ä¸­çš„ç¬¬ K å¤§å…ƒç´ ï¼Œä½¿ç”¨å †å¹¶ä¸æ˜¯æœ€ä½³é€‰æ‹©ï¼Œå¯ä»¥é‡‡ç”¨å¿«é€Ÿé€‰æ‹©ç®—æ³•</p></blockquote><h3 id="e-03-shu-ju-liu-zhong-di-k-da-yuan-su-li-kou-703-ti" id="E03-æ•°æ®æµä¸­ç¬¬Kå¤§å…ƒç´ -åŠ›æ‰£-703-é¢˜">E03. æ•°æ®æµä¸­ç¬¬Kå¤§å…ƒç´ -åŠ›æ‰£ 703 é¢˜</h3><p>ä¸Šé¢˜çš„å°é¡¶å †åŠ ä¸€ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MinHeap</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == array.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢˜è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">KthLargest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MinHeap heap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KthLargest</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        heap = <span class="keyword">new</span> <span class="title class_">MinHeap</span>(k);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            add(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(!heap.isFull())&#123;</span><br><span class="line">            heap.offer(val);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(val &gt; heap.peek())&#123;</span><br><span class="line">            heap.replace(val);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> heap.peek();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ±‚æ•°æ®æµä¸­çš„ç¬¬ K å¤§å…ƒç´ ï¼Œä½¿ç”¨å †æœ€åˆé€‚ä¸è¿‡</p></blockquote><h3 id="e-04-shu-ju-liu-de-zhong-wei-shu-li-kou-295-ti" id="E04-æ•°æ®æµçš„ä¸­ä½æ•°-åŠ›æ‰£-295-é¢˜">E04. æ•°æ®æµçš„ä¸­ä½æ•°-åŠ›æ‰£ 295 é¢˜</h3><p>å¯ä»¥æ‰©å®¹çš„ heap, max ç”¨äºæŒ‡å®šæ˜¯å¤§é¡¶å †è¿˜æ˜¯å°é¡¶å †</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Heap</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] array;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    <span class="type">boolean</span> max;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Heap</span><span class="params">(<span class="type">int</span> capacity, <span class="type">boolean</span> max)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.array = <span class="keyword">new</span> <span class="title class_">int</span>[capacity];</span><br><span class="line">        <span class="built_in">this</span>.max = max;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å †é¡¶å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å †é¡¶å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> array[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤å †é¡¶å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å †é¡¶å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">top</span> <span class="operator">=</span> array[<span class="number">0</span>];</span><br><span class="line">        swap(<span class="number">0</span>, size - <span class="number">1</span>);</span><br><span class="line">        size--;</span><br><span class="line">        down(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> top;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤æŒ‡å®šç´¢å¼•å¤„å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index ç´¢å¼•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¢«åˆ é™¤å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">poll</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">deleted</span> <span class="operator">=</span> array[index];</span><br><span class="line">        swap(index, size - <span class="number">1</span>);</span><br><span class="line">        size--;</span><br><span class="line">        down(index);</span><br><span class="line">        <span class="keyword">return</span> deleted;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›¿æ¢å †é¡¶å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> replaced æ–°å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">replace</span><span class="params">(<span class="type">int</span> replaced)</span> &#123;</span><br><span class="line">        array[<span class="number">0</span>] = replaced;</span><br><span class="line">        down(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å †çš„å°¾éƒ¨æ·»åŠ å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> offered æ–°å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">offer</span><span class="params">(<span class="type">int</span> offered)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (size == array.length) &#123;</span><br><span class="line">            grow();</span><br><span class="line">        &#125;</span><br><span class="line">        up(offered);</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">grow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">capacity</span> <span class="operator">=</span> size + (size &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span>[] newArray = <span class="keyword">new</span> <span class="title class_">int</span>[capacity];</span><br><span class="line">        System.arraycopy(array, <span class="number">0</span>,</span><br><span class="line">                newArray, <span class="number">0</span>, size);</span><br><span class="line">        array = newArray;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† offered å…ƒç´ ä¸Šæµ®: ç›´è‡³ offered å°äºçˆ¶å…ƒç´ æˆ–åˆ°å †é¡¶</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">up</span><span class="params">(<span class="type">int</span> offered)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">child</span> <span class="operator">=</span> size;</span><br><span class="line">        <span class="keyword">while</span> (child &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">parent</span> <span class="operator">=</span> (child - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">cmp</span> <span class="operator">=</span> max ? offered &gt; array[parent] : offered &lt; array[parent];</span><br><span class="line">            <span class="keyword">if</span> (cmp) &#123;</span><br><span class="line">                array[child] = array[parent];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            child = parent;</span><br><span class="line">        &#125;</span><br><span class="line">        array[child] = offered;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Heap</span><span class="params">(<span class="type">int</span>[] array, <span class="type">boolean</span> max)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.array = array;</span><br><span class="line">        <span class="built_in">this</span>.size = array.length;</span><br><span class="line">        <span class="built_in">this</span>.max = max;</span><br><span class="line">        heapify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å»ºå †</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">heapify</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚ä½•æ‰¾åˆ°æœ€åè¿™ä¸ªéå¶å­èŠ‚ç‚¹  size / 2 - 1</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size / <span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            down(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† parent ç´¢å¼•å¤„çš„å…ƒç´ ä¸‹æ½œ: ä¸ä¸¤ä¸ªå­©å­è¾ƒå¤§è€…äº¤æ¢, ç›´è‡³æ²¡å­©å­æˆ–å­©å­æ²¡å®ƒå¤§</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">down</span><span class="params">(<span class="type">int</span> parent)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> parent * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> left + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> parent;</span><br><span class="line">        <span class="keyword">if</span> (left &lt; size &amp;&amp; (max ? array[left] &gt; array[min] : array[left] &lt; array[min])) &#123;</span><br><span class="line">            min = left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (right &lt; size &amp;&amp; (max ? array[right] &gt; array[min] : array[right] &lt; array[min])) &#123;</span><br><span class="line">            min = right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (min != parent) &#123; <span class="comment">// æ‰¾åˆ°äº†æ›´å¤§çš„å­©å­</span></span><br><span class="line">            swap(min, parent);</span><br><span class="line">            down(min);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº¤æ¢ä¸¤ä¸ªç´¢å¼•å¤„çš„å…ƒç´ </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> array[i];</span><br><span class="line">        array[i] = array[j];</span><br><span class="line">        array[j] = t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢˜è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">Heap</span> <span class="variable">left</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Heap</span>(<span class="number">10</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="keyword">private</span> <span class="type">Heap</span> <span class="variable">right</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Heap</span>(<span class="number">10</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> ä¸ºäº†ä¿è¯ä¸¤è¾¹æ•°æ®é‡çš„å¹³è¡¡</span></span><br><span class="line"><span class="comment"> &lt;ul&gt;</span></span><br><span class="line"><span class="comment">  &lt;li&gt;ä¸¤è¾¹æ•°æ®ä¸€æ ·æ—¶,åŠ å…¥å·¦è¾¹&lt;/li&gt;</span></span><br><span class="line"><span class="comment">  &lt;li&gt;ä¸¤è¾¹æ•°æ®ä¸ä¸€æ ·æ—¶,åŠ å…¥å³è¾¹&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> &lt;/ul&gt;</span></span><br><span class="line"><span class="comment"> ä½†æ˜¯, éšä¾¿ä¸€ä¸ªæ•°èƒ½ç›´æ¥åŠ å…¥å—?</span></span><br><span class="line"><span class="comment"> &lt;ul&gt;</span></span><br><span class="line"><span class="comment">  &lt;li&gt;åŠ å…¥å·¦è¾¹å‰, åº”è¯¥æŒ‘å³è¾¹æœ€å°çš„åŠ å…¥&lt;/li&gt;</span></span><br><span class="line"><span class="comment">  &lt;li&gt;åŠ å…¥å³è¾¹å‰, åº”è¯¥æŒ‘å·¦è¾¹æœ€å¤§çš„åŠ å…¥&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> &lt;/ul&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addNum</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (left.size() == right.size()) &#123;</span><br><span class="line">        right.offer(num);</span><br><span class="line">        left.offer(right.poll());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        left.offer(num);</span><br><span class="line">        right.offer(left.poll());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;ul&gt;</span></span><br><span class="line"><span class="comment"> *     &lt;li&gt;ä¸¤è¾¹æ•°æ®ä¸€è‡´, å·¦å³å„å–å †é¡¶å…ƒç´ æ±‚å¹³å‡&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *     &lt;li&gt;å·¦è¾¹å¤šä¸€ä¸ª, å–å·¦è¾¹å…ƒç´ &lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">findMedian</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (left.size() == right.size()) &#123;</span><br><span class="line">        <span class="keyword">return</span> (left.peek() + right.peek()) / <span class="number">2.0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> left.peek();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æœ¬é¢˜è¿˜å¯ä»¥ä½¿ç”¨å¹³è¡¡äºŒå‰æœç´¢æ ‘æ±‚è§£ï¼Œä¸è¿‡ä»£ç æ¯”ä¸¤ä¸ªå †å¤æ‚</p></blockquote><h1 id="3-12-er-cha-shu">3.12 äºŒå‰æ ‘</h1><h3 id="e-04-dui-cheng-er-cha-shu-li-kou-101-ti" id="E04-å¯¹ç§°äºŒå‰æ ‘-åŠ›æ‰£-101-é¢˜">E04. å¯¹ç§°äºŒå‰æ ‘-åŠ›æ‰£ 101 é¢˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> check(root.left, root.right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(TreeNode left, TreeNode right)</span> &#123;</span><br><span class="line">    <span class="comment">// è‹¥åŒæ—¶ä¸º null</span></span><br><span class="line">    <span class="keyword">if</span> (left == <span class="literal">null</span> &amp;&amp; right == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è‹¥æœ‰ä¸€ä¸ªä¸º null (æœ‰ä¸Šä¸€è½®ç­›é€‰ï¼Œå¦ä¸€ä¸ªè‚¯å®šä¸ä¸º null)</span></span><br><span class="line">    <span class="keyword">if</span> (left == <span class="literal">null</span> || right == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (left.val != right.val) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> check(left.left, right.right) &amp;&amp; check(left.right, right.left);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç±»ä¼¼é¢˜ç›®ï¼šLeetcode 100 é¢˜ - ç›¸åŒçš„æ ‘</p><h3 id="e-05-er-cha-shu-zui-da-shen-du-li-kou-104-ti" id="E05-äºŒå‰æ ‘æœ€å¤§æ·±åº¦-åŠ›æ‰£-104-é¢˜">E05. äºŒå‰æ ‘æœ€å¤§æ·±åº¦-åŠ›æ‰£ 104 é¢˜</h3><p><strong>ååºéå†æ±‚è§£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment">    1. å¾—åˆ°å·¦å­æ ‘æ·±åº¦, å¾—åˆ°å³å­æ ‘æ·±åº¦, äºŒè€…æœ€å¤§è€…åŠ ä¸€, å°±æ˜¯æœ¬èŠ‚ç‚¹æ·±åº¦</span></span><br><span class="line"><span class="comment">    2. å› ä¸ºéœ€è¦å…ˆå¾—åˆ°å·¦å³å­æ ‘æ·±åº¦, å¾ˆæ˜¾ç„¶æ˜¯ååºéå†å…¸å‹åº”ç”¨</span></span><br><span class="line"><span class="comment">    3. å…³äºæ·±åº¦çš„å®šä¹‰ï¼šä»æ ¹å‡ºå‘, ç¦»æ ¹æœ€è¿œçš„èŠ‚ç‚¹æ€»è¾¹æ•°,</span></span><br><span class="line"><span class="comment">        æ³¨æ„: åŠ›æ‰£é‡Œçš„æ·±åº¦å®šä¹‰è¦å¤šä¸€</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        æ·±åº¦2         æ·±åº¦3         æ·±åº¦1</span></span><br><span class="line"><span class="comment">        1            1            1</span></span><br><span class="line"><span class="comment">       / \          / \</span></span><br><span class="line"><span class="comment">      2   3        2   3</span></span><br><span class="line"><span class="comment">                        \</span></span><br><span class="line"><span class="comment">                         4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// éåŠ›æ‰£é¢˜ç›®æ”¹ä¸ºè¿”å› -1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">d1</span> <span class="operator">=</span> maxDepth(node.left);</span><br><span class="line">    <span class="type">int</span> <span class="variable">d2</span> <span class="operator">=</span> maxDepth(node.right);</span><br><span class="line">    <span class="keyword">return</span> Integer.max(d1, d2) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ååºéå†æ±‚è§£-éé€’å½’</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment">    1. ä½¿ç”¨éé€’å½’ååºéå†, æ ˆçš„æœ€å¤§é«˜åº¦å³ä¸ºæœ€å¤§æ·±åº¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line">    LinkedList&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span> (curr != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">            stack.push(curr);</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> stack.size();</span><br><span class="line">            <span class="keyword">if</span> (size &gt; max) &#123;</span><br><span class="line">                max = size;</span><br><span class="line">            &#125;</span><br><span class="line">            curr = curr.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">peek</span> <span class="operator">=</span> stack.peek();</span><br><span class="line">            <span class="keyword">if</span>(peek.right == <span class="literal">null</span> || peek.right == pop) &#123;</span><br><span class="line">                pop = stack.pop();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                curr = peek.right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å±‚åºéå†æ±‚è§£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment">    1. ä½¿ç”¨å±‚åºéå†, å±‚æ•°å³æœ€å¤§æ·±åº¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    queue.offer(root);</span><br><span class="line">    <span class="type">int</span> <span class="variable">level</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">        level++;</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> queue.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">            <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                queue.offer(node.left);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                queue.offer(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> level;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-06-er-cha-shu-zui-xiao-shen-du-li-kou-111-ti" id="E06-äºŒå‰æ ‘æœ€å°æ·±åº¦-åŠ›æ‰£-111-é¢˜">E06. äºŒå‰æ ‘æœ€å°æ·±åº¦-åŠ›æ‰£ 111 é¢˜</h3><p><strong>ååºéå†æ±‚è§£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">d1</span> <span class="operator">=</span> minDepth(node.left);</span><br><span class="line">    <span class="type">int</span> <span class="variable">d2</span> <span class="operator">=</span> minDepth(node.right);</span><br><span class="line">    <span class="keyword">if</span> (d1 == <span class="number">0</span> || d2 == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d1 + d2 + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Integer.min(d1, d2) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸è¾ƒäºæ±‚æœ€å¤§æ·±åº¦ï¼Œåº”å½“è€ƒè™‘ï¼š</p><ul><li>å½“å³å­æ ‘ä¸º nullï¼Œåº”å½“è¿”å›å·¦å­æ ‘æ·±åº¦åŠ ä¸€</li><li>å½“å·¦å­æ ‘ä¸º nullï¼Œåº”å½“è¿”å›å³å­æ ‘æ·±åº¦åŠ ä¸€</li></ul><p>ä¸Šé¢ä¸¤ç§æƒ…å†µæ»¡è¶³æ—¶ï¼Œä¸åº”è¯¥å†æŠŠä¸º null å­æ ‘çš„æ·±åº¦ 0 å‚ä¸æœ€å°å€¼æ¯”è¾ƒï¼Œä¾‹å¦‚è¿™æ ·</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  1</span><br><span class="line"> /</span><br><span class="line">2</span><br></pre></td></tr></table></figure><ul><li>æ­£ç¡®æ·±åº¦ä¸º 2ï¼Œè‹¥æŠŠä¸º null çš„å³å­æ ‘çš„æ·±åº¦ 0 è€ƒè™‘è¿›æ¥ï¼Œä¼šå¾—åˆ°é”™è¯¯ç»“æœ 1</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"> <span class="string">\</span></span><br><span class="line">  <span class="number">3</span></span><br><span class="line">   <span class="string">\</span></span><br><span class="line">    <span class="number">4</span></span><br></pre></td></tr></table></figure><ul><li>æ­£ç¡®æ·±åº¦ä¸º 3ï¼Œè‹¥æŠŠä¸º null çš„å·¦å­æ ‘çš„æ·±åº¦ 0 è€ƒè™‘è¿›æ¥ï¼Œä¼šå¾—åˆ°é”™è¯¯ç»“æœ 1</li></ul><p><strong>å±‚åºéå†æ±‚è§£</strong></p><p>é‡åˆ°çš„ç¬¬ä¸€ä¸ªå¶å­èŠ‚ç‚¹æ‰€åœ¨å±‚å°±æ˜¯æœ€å°æ·±åº¦</p><p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„æ ‘é‡åˆ°çš„ç¬¬ä¸€ä¸ªå¶å­èŠ‚ç‚¹ 3 æ‰€åœ¨çš„å±‚å°±æ˜¯æœ€å°æ·±åº¦ï¼Œå…¶ä»– 4ï¼Œ7 ç­‰å¶å­èŠ‚ç‚¹æ·±åº¦æ›´æ·±ï¼Œä¹Ÿæ›´æ™šé‡åˆ°</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    1</span><br><span class="line">   / \     </span><br><span class="line"> <span class="number"> 2 </span>  3</span><br><span class="line"> / \</span><br><span class="line">4  <span class="number"> 5 </span></span><br><span class="line">   /</span><br><span class="line"> <span class="number"> 7 </span></span><br></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    queue.offer(root);</span><br><span class="line">    <span class="type">int</span> <span class="variable">level</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">        level++;</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> queue.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">            <span class="keyword">if</span> (node.left == <span class="literal">null</span> &amp;&amp; node.right == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> level;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                queue.offer(node.left);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                queue.offer(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> level;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆç‡ä¼šé«˜äºä¹‹å‰ååºéå†è§£æ³•ï¼Œå› ä¸ºæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¶å­èŠ‚ç‚¹åï¼Œå°±æ— éœ€åç»­çš„å±‚åºéå†äº†</p><h3 id="e-07-fan-zhuan-er-cha-shu-li-kou-226-ti" id="E07-ç¿»è½¬äºŒå‰æ ‘-åŠ›æ‰£-226-é¢˜">E07. ç¿»è½¬äºŒå‰æ ‘-åŠ›æ‰£ 226 é¢˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">invertTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    fn(root);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fn</span><span class="params">(TreeNode node)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">t</span> <span class="operator">=</span> node.left;</span><br><span class="line">    node.left = node.right;</span><br><span class="line">    node.right = t;</span><br><span class="line">    fn(node.left);</span><br><span class="line">    fn(node.right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆäº¤æ¢ã€å†é€’å½’æˆ–æ˜¯å…ˆé€’å½’ã€å†äº¤æ¢éƒ½å¯ä»¥</p><h3 id="e-08-hou-zhui-biao-da-shi-zhuan-er-cha-shu" id="E08-åç¼€è¡¨è¾¾å¼è½¬äºŒå‰æ ‘">E08. åç¼€è¡¨è¾¾å¼è½¬äºŒå‰æ ‘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String val;</span><br><span class="line">    <span class="keyword">public</span> TreeNode left;</span><br><span class="line">    <span class="keyword">public</span> TreeNode right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TreeNode</span><span class="params">(String val)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TreeNode</span><span class="params">(TreeNode left, String val, TreeNode right)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.left = left;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">        <span class="built_in">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    ä¸­ç¼€è¡¨è¾¾å¼           (2-1)*3</span></span><br><span class="line"><span class="comment">    åç¼€ï¼ˆé€†æ³¢å…°ï¼‰è¡¨è¾¾å¼   21-3*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    1.é‡åˆ°æ•°å­—å…¥æ ˆ</span></span><br><span class="line"><span class="comment">    2.é‡åˆ°è¿ç®—ç¬¦, å‡ºæ ˆä¸¤æ¬¡, ä¸å½“å‰èŠ‚ç‚¹å»ºç«‹çˆ¶å­å…³ç³», å½“å‰èŠ‚ç‚¹å…¥æ ˆ</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    æ ˆ</span></span><br><span class="line"><span class="comment">    |   |</span></span><br><span class="line"><span class="comment">    |   |</span></span><br><span class="line"><span class="comment">    |   |</span></span><br><span class="line"><span class="comment">    _____</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    è¡¨è¾¾å¼æ ‘</span></span><br><span class="line"><span class="comment">        *</span></span><br><span class="line"><span class="comment">       / \</span></span><br><span class="line"><span class="comment">      -   3</span></span><br><span class="line"><span class="comment">     / \</span></span><br><span class="line"><span class="comment">    2   1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    21-3*</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">constructExpressionTree</span><span class="params">(String[] tokens)</span> &#123;</span><br><span class="line">    LinkedList&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String t : tokens) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (t) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;/&quot;</span> -&gt; &#123; <span class="comment">// è¿ç®—ç¬¦</span></span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">right</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">left</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(t);</span><br><span class="line">                parent.left = left;</span><br><span class="line">                parent.right = right;</span><br><span class="line">                stack.push(parent);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">default</span> -&gt; &#123; <span class="comment">// æ•°å­—</span></span><br><span class="line">                stack.push(<span class="keyword">new</span> <span class="title class_">TreeNode</span>(t));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> stack.peek();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="e-09-gen-ju-qian-xu-yu-zhong-xu-bian-li-jie-guo-gou-zao-er-cha-shu-li-kou-105-ti" id="E09-æ ¹æ®å‰åºä¸ä¸­åºéå†ç»“æœæ„é€ äºŒå‰æ ‘-åŠ›æ‰£-105-é¢˜">E09. æ ¹æ®å‰åºä¸ä¸­åºéå†ç»“æœæ„é€ äºŒå‰æ ‘-åŠ›æ‰£ 105 é¢˜</h3><ul><li>å…ˆé€šè¿‡å‰åºéå†ç»“æœå®šä½æ ¹èŠ‚ç‚¹</li><li>å†ç»“åˆä¸­åºéå†ç»“æœåˆ‡åˆ†å·¦å³å­æ ‘</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">E09Leetcode105</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        preOrder = &#123;1,2,4,3,6,7&#125;</span></span><br><span class="line"><span class="comment">        inOrder = &#123;4,2,1,6,3,7&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        æ ¹ 1</span></span><br><span class="line"><span class="comment">            pre         in</span></span><br><span class="line"><span class="comment">        å·¦  2,4         4,2</span></span><br><span class="line"><span class="comment">        å³  3,6,7       6,3,7</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        æ ¹ 2</span></span><br><span class="line"><span class="comment">        å·¦ 4</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        æ ¹ 3</span></span><br><span class="line"><span class="comment">        å·¦ 6</span></span><br><span class="line"><span class="comment">        å³ 7</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] preOrder, <span class="type">int</span>[] inOrder)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (preOrder.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ ¹èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">rootValue</span> <span class="operator">=</span> preOrder[<span class="number">0</span>];</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(rootValue);</span><br><span class="line">        <span class="comment">// åŒºåˆ†å·¦å³å­æ ‘</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; inOrder.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (inOrder[i] == rootValue) &#123;</span><br><span class="line">                <span class="comment">// 0 ~ i-1 å·¦å­æ ‘</span></span><br><span class="line">                <span class="comment">// i+1 ~ inOrder.length -1 å³å­æ ‘</span></span><br><span class="line">                <span class="type">int</span>[] inLeft = Arrays.copyOfRange(inOrder, <span class="number">0</span>, i); <span class="comment">// [4,2]</span></span><br><span class="line">                <span class="type">int</span>[] inRight = Arrays.copyOfRange(inOrder, i + <span class="number">1</span>, inOrder.length); <span class="comment">// [6,3,7]</span></span><br><span class="line"></span><br><span class="line">                <span class="type">int</span>[] preLeft = Arrays.copyOfRange(preOrder, <span class="number">1</span>, i + <span class="number">1</span>); <span class="comment">// [2,4]</span></span><br><span class="line">                <span class="type">int</span>[] preRight = Arrays.copyOfRange(preOrder, i + <span class="number">1</span>, inOrder.length); <span class="comment">// [3,6,7]</span></span><br><span class="line"></span><br><span class="line">                root.left = buildTree(preLeft, inLeft); <span class="comment">// 2</span></span><br><span class="line">                root.right = buildTree(preRight, inRight); <span class="comment">// 3</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»£ç å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œæ¶‰åŠæ–°æ•°æ®ç»“æ„ï¼Œä»¥åå®ç°</li></ul><h3 id="e-10-gen-ju-zhong-xu-yu-hou-xu-bian-li-jie-guo-gou-zao-er-cha-shu-li-kou-106-ti" id="E10-æ ¹æ®ä¸­åºä¸ååºéå†ç»“æœæ„é€ äºŒå‰æ ‘-åŠ›æ‰£-106-é¢˜">E10. æ ¹æ®ä¸­åºä¸ååºéå†ç»“æœæ„é€ äºŒå‰æ ‘-åŠ›æ‰£ 106 é¢˜</h3><ul><li>å…ˆé€šè¿‡ååºéå†ç»“æœå®šä½æ ¹èŠ‚ç‚¹</li><li>å†ç»“åˆä¸­åºéå†ç»“æœåˆ‡åˆ†å·¦å³å­æ ‘</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] inOrder, <span class="type">int</span>[] postOrder)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (inOrder.length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ ¹</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">rootValue</span> <span class="operator">=</span> postOrder[postOrder.length - <span class="number">1</span>];</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(rootValue);</span><br><span class="line">    <span class="comment">// åˆ‡åˆ†å·¦å³å­æ ‘</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; inOrder.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (inOrder[i] == rootValue) &#123;</span><br><span class="line">            <span class="type">int</span>[] inLeft = Arrays.copyOfRange(inOrder, <span class="number">0</span>, i);</span><br><span class="line">            <span class="type">int</span>[] inRight = Arrays.copyOfRange(inOrder, i + <span class="number">1</span>, inOrder.length);</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span>[] postLeft = Arrays.copyOfRange(postOrder, <span class="number">0</span>, i);</span><br><span class="line">            <span class="type">int</span>[] postRight = Arrays.copyOfRange(postOrder, i, postOrder.length - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            root.left = buildTree(inLeft, postLeft);</span><br><span class="line">            root.right = buildTree(inRight, postRight);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»£ç å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œæ¶‰åŠæ–°æ•°æ®ç»“æ„ï¼Œä»¥åå®ç°</li></ul><h1 id="fu-lu">é™„å½•</h1><h2 id="can-kao-wen-zhang" id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h2><p>[^1]: <a href="https://www.merriam-webster.com/dictionary/algorithm">â€œDefinition of ALGORITHMâ€</a>. <em>Merriam-Webster Online Dictionary</em>. <a href="https://web.archive.org/web/20200214074446/https://www.merriam-webster.com/dictionary/algorithm">Archived</a> from the original on February 14, 2020. Retrieved November 14, 2019.<br>[^2]: Introduction to Algorithm ä¸­æ–‡è¯‘ä½œã€Šç®—æ³•å¯¼è®ºã€‹<br>[^3]: ä¸»è¦å‚è€ƒæ–‡æ¡£ <a href="https://en.wikipedia.org/wiki/Binary_search_algorithm">https://en.wikipedia.org/wiki/Binary_search_algorithm</a><br>[^4]: å›¾ç‰‡åŠæ¦‚å¿µå‡æ‘˜è‡ª Introduction to Algorithm 4thï¼Œ3.1èŠ‚ï¼Œ3.2 èŠ‚<br>[^5]: å›¾ç‰‡å¼•ç”¨è‡ª wikipedia linkedlist æ¡ç›®ï¼Œ<a href="https://en.wikipedia.org/wiki/Linked_list">https://en.wikipedia.org/wiki/Linked_list</a></p><p>[^6]: ä¹Ÿç§°ä¸º Pascalâ€™s triangle <a href="https://en.wikipedia.org/wiki/Pascal%27s_triangle">https://en.wikipedia.org/wiki/Pascalâ€™s_triangle</a></p><p>[^7]: <a href="https://zhuanlan.zhihu.com/p/257214075">é€’å½’æ±‚è§£æ–æ³¢é‚£å¥‘æ•°åˆ—çš„æ—¶é—´å¤æ‚åº¦â€”â€”å‡ ç§ç®€æ´è¯æ˜ - çŸ¥ä¹ (zhihu.com)</a><br>[^8]: Fibonacci ä»‹ç»ï¼š<a href="https://en.wikipedia.org/wiki/Fibonacci_number">https://en.wikipedia.org/wiki/Fibonacci_number</a><br>[^9]: <a href="https://zhuanlan.zhihu.com/p/165877869">å‡ ç§è®¡ç®—Fibonacciæ•°åˆ—ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ¯”è¾ƒ - çŸ¥ä¹ (zhihu.com)</a><br>[^10]: å‡ ç§æ–æ³¢é‚£å¥‘æ•°åˆ—ç®—æ³•æ¯”è¾ƒ <a href="https://www.nayuki.io/page/fast-fibonacci-algorithms">Fast Fibonacci algorithms (nayuki.io)</a></p><p>[^11]: æˆ‘çŸ¥é“çš„æœ‰ C++ï¼ŒScala<br>[^12]: jdk ç‰ˆæœ¬æœ‰å…³ï¼Œ64 ä½ jdkï¼ŒæŒ‰ 8 å­—èŠ‚å¯¹é½<br>[^13]: æ±‰è¯ºå¡”å›¾ç‰‡èµ„æ–™å‡æ¥è‡ª <a href="https://en.wikipedia.org/wiki/Tower_of_Hanoi">https://en.wikipedia.org/wiki/Tower_of_Hanoi</a><br>[^14]: ä¸ä¸»å®šç†ç±»ä¼¼çš„è¿˜æœ‰ Akraâ€“Bazzi methodï¼Œ<a href="https://en.wikipedia.org/wiki/Akra%E2%80%93Bazzi_method">https://en.wikipedia.org/wiki/Akraâ€“Bazzi_method</a></p><p>[^15]: é¾Ÿå…”èµ›è·‘åŠ¨ç”»æ¥è‡ªäº <a href="https://onestepcode.com/floyd-hare-tortoise-algorithm-demo/">Floydâ€™s Hare and Tortoise Algorithm Demo - One Step! Code (onestepcode.com)</a></p><p>[^16]: Josephus problem ä¸»è¦å‚è€ƒ <a href="https://en.wikipedia.org/wiki/Josephus_problem">https://en.wikipedia.org/wiki/Josephus_problem</a></p><h2 id="luo-xuan-ti-mu" id="è½é€‰é¢˜ç›®">è½é€‰é¢˜ç›®</h2><h3 id="fan-zhuan-zi-fu-shu-zu" id="åè½¬å­—ç¬¦æ•°ç»„">åè½¬å­—ç¬¦æ•°ç»„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">char</span>[] array = <span class="string">&quot;abcde&quot;</span>.toCharArray();</span><br><span class="line">    recursion(array, <span class="number">0</span>, array.length - <span class="number">1</span>);</span><br><span class="line">    System.out.println(Arrays.toString(array));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">recursion</span><span class="params">(<span class="type">char</span>[] array, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= j) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    swap(array, i, j);</span><br><span class="line">    recursion(array, ++i, --j);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">char</span>[] array, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> array[i];</span><br><span class="line">    array[i] = array[j];</span><br><span class="line">    array[j] = c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€æ¬¡äº¤æ¢çš„æ˜¯ array[0] å’Œ array[4]</li><li>ç¬¬äºŒæ¬¡äº¤æ¢çš„æ˜¯ array[1] å’Œ array[3]</li><li>ç¬¬ä¸‰æ¬¡ i = j = 2ï¼Œå¼€å§‹è¿”å›</li><li>å¦‚æœ array.length æ˜¯å¶æ•°ï¼Œåˆ™ä¼šåœ¨ i &gt; j æ—¶è¿”å›</li></ul><h2 id="li-kou-gao-ping-jie-ti-mu-lie-biao" id="åŠ›æ‰£é«˜è¯„ä»·é¢˜ç›®åˆ—è¡¨">åŠ›æ‰£é«˜è¯„ä»·é¢˜ç›®åˆ—è¡¨</h2><p>å¼•ç”¨è‡ª <a href="https://zhuanlan.zhihu.com/p/449686402">é¢è¯•æœ€å¸¸è€ƒçš„ 100 é“ç®—æ³•é¢˜åˆ†ç±»æ•´ç†ï¼ - çŸ¥ä¹ (zhihu.com)</a></p><blockquote><p>å¸¦ âœ”ï¸ æ˜¯æœ¬è¯¾ç¨‹è®²è§£è¿‡çš„</p></blockquote><ul><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/two-sum/">1. Two Sum (ä¸¤æ•°ä¹‹å’Œ)</a></strong>, Easy, 11757 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/add-two-numbers/">2. Add Two Numbers (ä¸¤æ•°ç›¸åŠ )</a></strong>, Medium, 6524 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/longest-substring-without-repeating-characters/">3. Longest Substring Without Repeating Characters (æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²)</a></strong>, Medium, 5845 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/median-of-two-sorted-arrays/">4. Median of Two Sorted Arrays (å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°)</a></strong>, Hard, 4303 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/longest-palindromic-substring/">5. Longest Palindromic Substring (æœ€é•¿å›æ–‡å­ä¸²)</a></strong>, Medium, 3896 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/3sum/">15. 3Sum (ä¸‰æ•°ä¹‹å’Œ)</a></strong>, Medium, 3582 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/maximum-subarray/">53. Maximum Subarray (æœ€å¤§å­åºå’Œ)</a></strong>, Easy, 3533 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/reverse-integer/">7. Reverse Integer (æ•´æ•°åè½¬)</a></strong>, Easy, 2970 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/container-with-most-water/">11. Container With Most Water (ç››æœ€å¤šæ°´çš„å®¹å™¨)</a></strong>, Medium, 2659 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/trapping-rain-water/">42. Trapping Rain Water (æ¥é›¨æ°´)</a></strong>, Hard, 2552 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/valid-parentheses/">20. Valid Parentheses (æœ‰æ•ˆçš„æ‹¬å·)</a></strong>, Easy, 2544 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/regular-expression-matching/">10. Regular Expression Matching (æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…)</a></strong>, Hard, 2273 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/remove-duplicates-from-sorted-array/">26. Remove Duplicates from Sorted Array (åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹)</a></strong>, Easy, 2146 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/single-number/">136. Single Number (åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—)</a></strong>, Easy, 1958 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/generate-parentheses/">22. Generate Parentheses (æ‹¬å·ç”Ÿæˆ)</a></strong>, Medium, 1946 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/reverse-linked-list/">206. Reverse Linked List (åè½¬é“¾è¡¨)</a></strong>, Easy, 1886 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/merge-two-sorted-lists/">21. Merge Two Sorted Lists (åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨)</a></strong>, Easy, 1832 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/climbing-stairs/">70. Climbing Stairs (çˆ¬æ¥¼æ¢¯)</a></strong>, Easy, 1791 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/longest-increasing-subsequence/">300. Longest Increasing Subsequence (æœ€é•¿é€’å¢å­åºåˆ—)</a></strong>, Medium, 1773 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/best-time-to-buy-and-sell-stock/">121. Best Time to Buy and Sell Stock (ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº)</a></strong>, Easy, 1766 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/edit-distance/">72. Edit Distance (ç¼–è¾‘è·ç¦»)</a></strong>, Hard, 1743 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/longest-common-prefix/">14. Longest Common Prefix (æœ€é•¿å…¬å…±å‰ç¼€)</a></strong>, Easy, 1707 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/house-robber/">198. House Robber (æ‰“å®¶åŠ«èˆ)</a></strong>, Medium, 1585 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/palindrome-number/">9. Palindrome Number (å›æ–‡æ•°)</a></strong>, Easy, 1568 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/lru-cache/">146. LRU Cache (LRU ç¼“å­˜æœºåˆ¶)</a></strong>, Medium, 1544 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/remove-nth-node-from-end-of-list/">19. Remove Nth Node From End of List (åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹)</a></strong>, Medium, 1494 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/search-in-rotated-sorted-array/">33. Search in Rotated Sorted Array (æœç´¢æ—‹è½¬æ’åºæ•°ç»„)</a></strong>, Medium, 1493 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/permutations/">46. Permutations (å…¨æ’åˆ—)</a></strong>, Medium, 1484 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/symmetric-tree/">101. Symmetric Tree (å¯¹ç§°äºŒå‰æ ‘)</a></strong>, Easy, 1483 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/largest-rectangle-in-histogram/">84. Largest Rectangle in Histogram (æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢)</a></strong>, Hard, 1472 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/combination-sum/">39. Combination Sum (ç»„åˆæ€»å’Œ)</a></strong>, Medium, 1466 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/roman-to-integer/">13. Roman to Integer (ç½—é©¬æ•°å­—è½¬æ•´æ•°)</a></strong>, Easy, 1436 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/merge-k-sorted-lists/">23. Merge k Sorted Lists (åˆå¹¶Kä¸ªå‡åºé“¾è¡¨)</a></strong>, Hard, 1436 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/letter-combinations-of-a-phone-number/">17. Letter Combinations of a Phone Number (ç”µè¯å·ç çš„å­—æ¯ç»„åˆ)</a></strong>, Medium, 1436 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/coin-change/">322. Coin Change (é›¶é’±å…‘æ¢)</a></strong>, Medium, 1414 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/longest-valid-parentheses/">32. Longest Valid Parentheses (æœ€é•¿æœ‰æ•ˆæ‹¬å·)</a></strong>, Hard, 1400 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/find-the-duplicate-number/">287. Find the Duplicate Number (å¯»æ‰¾é‡å¤æ•°)</a></strong>, Medium, 1325 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-ii/">122. Best Time to Buy and Sell Stock II (ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II)</a></strong>, Easy, 1306 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/intersection-of-two-linked-lists/">160. Intersection of Two Linked Lists (ç›¸äº¤é“¾è¡¨)</a></strong>, Easy, 1302 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/jump-game/">55. Jump Game (è·³è·ƒæ¸¸æˆ)</a></strong>, Medium, 1292 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/minimum-window-substring/">76. Minimum Window Substring (æœ€å°è¦†ç›–å­ä¸²)</a></strong>, Hard, 1280 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/number-of-islands/">200. Number of Islands (å²›å±¿æ•°é‡)</a></strong>, Medium, 1270 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/subsets/">78. Subsets (å­é›†)</a></strong>, Medium, 1269 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/next-permutation/">31. Next Permutation (ä¸‹ä¸€ä¸ªæ’åˆ—)</a></strong>, Medium, 1260 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/unique-binary-search-trees/">96. Unique Binary Search Trees (ä¸åŒçš„äºŒå‰æœç´¢æ ‘)</a></strong>, Medium, 1257 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/sort-list/">148. Sort List (æ’åºé“¾è¡¨)</a></strong>, Medium, 1248 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/">236. Lowest Common Ancestor of a Binary Tree (äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ)</a></strong>, Medium, 1238 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/reverse-nodes-in-k-group/">25. Reverse Nodes in k-Group (K ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨)</a></strong>, Hard, 1230 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/zigzag-conversion/">6. ZigZag Conversion (Z å­—å½¢å˜æ¢)</a></strong>, Medium, 1226 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/maximum-product-subarray/">152. Maximum Product Subarray (ä¹˜ç§¯æœ€å¤§å­æ•°ç»„)</a></strong>, Medium, 1223 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/kth-largest-element-in-an-array/">215. Kth Largest Element in an Array (æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ )</a></strong>, Medium, 1211 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/string-to-integer-atoi/">8. String to Integer (atoi) (å­—ç¬¦ä¸²è½¬æ¢æ•´æ•° (atoi))</a></strong>, Medium, 1168 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/first-missing-positive/">41. First Missing Positive (ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°)</a></strong>, Hard, 1163 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/move-zeroes/">283. Move Zeroes (ç§»åŠ¨é›¶)</a></strong>, Easy, 1162 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/linked-list-cycle/">141. Linked List Cycle (ç¯å½¢é“¾è¡¨)</a></strong>, Easy, 1161 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/validate-binary-search-tree/">98. Validate Binary Search Tree (éªŒè¯äºŒå‰æœç´¢æ ‘)</a></strong>, Medium, 1156 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/binary-tree-maximum-path-sum/">124. Binary Tree Maximum Path Sum (äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ)</a></strong>, Hard, 1152 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal/">105. Construct Binary Tree from Preorder and Inorder Traversal (ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘)</a></strong>, Medium, 1149 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/find-first-and-last-position-of-element-in-sorted-array/">34. Find First and Last Position of Element in Sorted Array (åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®)</a></strong>, Medium, 1137 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/sliding-window-maximum/">239. Sliding Window Maximum (æ»‘åŠ¨çª—å£æœ€å¤§å€¼)</a></strong>, Hard, 1114 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/linked-list-cycle-ii/">142. Linked List Cycle II (ç¯å½¢é“¾è¡¨ II)</a></strong>, Medium, 1097 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/word-break/">139. Word Break (å•è¯æ‹†åˆ†)</a></strong>, Medium, 1097 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/jump-game-ii/">45. Jump Game II (è·³è·ƒæ¸¸æˆ II)</a></strong>, Medium, 1094 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/majority-element/">169. Majority Element (å¤šæ•°å…ƒç´ )</a></strong>, Easy, 1089 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/palindrome-linked-list/">234. Palindrome Linked List (å›æ–‡é“¾è¡¨)</a></strong>, Easy, 1072 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/unique-paths/">62. Unique Paths (ä¸åŒè·¯å¾„)</a></strong>, Medium, 1072 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/rotate-array/">189. Rotate Array (æ—‹è½¬æ•°ç»„)</a></strong>, Medium, 1057 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/binary-tree-inorder-traversal/">94. Binary Tree Inorder Traversal (äºŒå‰æ ‘çš„ä¸­åºéå†)</a></strong>, Easy, 1052 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/merge-intervals/">56. Merge Intervals (åˆå¹¶åŒºé—´)</a></strong>, Medium, 1051 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/merge-sorted-array/">88. Merge Sorted Array (åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„)</a></strong>, Easy, 1041 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/subarray-sum-equals-k/">560. Subarray Sum Equals K (å’Œä¸ºKçš„å­æ•°ç»„)</a></strong>, Medium, 1036 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/perfect-squares/">279. Perfect Squares (å®Œå…¨å¹³æ–¹æ•°)</a></strong>, Medium, 1035 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/search-insert-position/">35. Search Insert Position (æœç´¢æ’å…¥ä½ç½®)</a></strong>, Easy, 1005 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/swap-nodes-in-pairs/">24. Swap Nodes in Pairs (ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹)</a></strong>, Medium, 996 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/maximal-rectangle/">85. Maximal Rectangle (æœ€å¤§çŸ©å½¢)</a></strong>, Hard, 983 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/implement-strstr/">28. Implement strStr() (å®ç° strStr())</a></strong>, Easy, 982 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/reverse-linked-list-ii/">92. Reverse Linked List II (åè½¬é“¾è¡¨ II)</a></strong>, Medium, 980 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/min-stack/">155. Min Stack (æœ€å°æ ˆ)</a></strong>, Easy, 979 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/word-search/">79. Word Search (å•è¯æœç´¢)</a></strong>, Medium, 979 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/remove-element/">27. Remove Element (ç§»é™¤å…ƒç´ )</a></strong>, Easy, 967 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/n-queens/">51. N-Queens (N çš‡å)</a></strong>, Hard, 965 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/sort-colors/">75. Sort Colors (é¢œè‰²åˆ†ç±»)</a></strong>, Medium, 961 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/binary-tree-level-order-traversal/">102. Binary Tree Level Order Traversal (äºŒå‰æ ‘çš„å±‚åºéå†)</a></strong>, Medium, 960 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/rotate-image/">48. Rotate Image (æ—‹è½¬å›¾åƒ)</a></strong>, Medium, 960 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/unique-binary-search-trees-ii/">95. Unique Binary Search Trees II (ä¸åŒçš„äºŒå‰æœç´¢æ ‘ II)</a></strong>, Medium, 955 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/minimum-path-sum/">64. Minimum Path Sum (æœ€å°è·¯å¾„å’Œ)</a></strong>, Medium, 954 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/queue-reconstruction-by-height/">406. Queue Reconstruction by Height (æ ¹æ®èº«é«˜é‡å»ºé˜Ÿåˆ—)</a></strong>, Medium, 947 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/invert-binary-tree/">226. Invert Binary Tree (ç¿»è½¬äºŒå‰æ ‘)</a></strong>, Easy, 941 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/path-sum-iii/">437. Path Sum III (è·¯å¾„æ€»å’Œ III)</a></strong>, Medium, 937 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/maximum-depth-of-binary-tree/">104. Maximum Depth of Binary Tree (äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦)</a></strong>, Easy, 937 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/delete-node-in-a-linked-list/">237. Delete Node in a Linked List (åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹)</a></strong>, Easy, 936 likes âœ”ï¸</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/house-robber-iii/">337. House Robber III (æ‰“å®¶åŠ«èˆ III)</a></strong>, Medium, 929 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/4sum/">18. 4Sum (å››æ•°ä¹‹å’Œ)</a></strong>, Medium, 918 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/decode-ways/">91. Decode Ways (è§£ç æ–¹æ³•)</a></strong>, Medium, 904 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/course-schedule/">207. Course Schedule (è¯¾ç¨‹è¡¨)</a></strong>, Medium, 897 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/sudoku-solver/">37. Sudoku Solver (è§£æ•°ç‹¬)</a></strong>, Hard, 897 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/combine-two-tables/">175. Combine Two Tables (ç»„åˆä¸¤ä¸ªè¡¨)</a></strong>, Easy, 891 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/partition-equal-subset-sum/">416. Partition Equal Subset Sum (åˆ†å‰²ç­‰å’Œå­é›†)</a></strong>, Medium, 886 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/product-of-array-except-self/">238. Product of Array Except Self (é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯)</a></strong>, Medium, 885 likes</li><li><strong><a href="https://link.zhihu.com/?target=https%3A//leetcode-cn.com/problems/flatten-binary-tree-to-linked-list/">114. Flatten Binary Tree to Linked List (äºŒå‰æ ‘å±•å¼€ä¸ºé“¾è¡¨)</a></strong>, Medium, 877 likes âœ”ï¸</li></ul>]]></content>
    
    
    <summary type="html">æ•°æ®ç»“æ„LeetCodeç»ƒä¹ é¢˜</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://www.taoyaopc.live/categories/%E7%AE%97%E6%B3%95/"/>
    
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„Javaç‰ˆ</title>
    <link href="https://www.taoyaopc.live/posts/5ac0137b.html"/>
    <id>https://www.taoyaopc.live/posts/5ac0137b.html</id>
    <published>2023-03-30T08:20:00.000Z</published>
    <updated>2023-03-30T08:29:25.157Z</updated>
    
    <content type="html"><![CDATA[<h1 id="chu-shi-suan-fa">åˆè¯†ç®—æ³•</h1><h2 id="shi-yao-shi-suan-fa" id="ä»€ä¹ˆæ˜¯ç®—æ³•ï¼Ÿ">ä»€ä¹ˆæ˜¯ç®—æ³•ï¼Ÿ</h2><p><strong>å®šä¹‰</strong></p><p>åœ¨æ•°å­¦å’Œè®¡ç®—æœºç§‘å­¦é¢†åŸŸï¼Œç®—æ³•æ˜¯ä¸€ç³»åˆ—æœ‰é™çš„ä¸¥è°¨æŒ‡ä»¤ï¼Œé€šå¸¸ç”¨äºè§£å†³ä¸€ç±»ç‰¹å®šé—®é¢˜æˆ–æ‰§è¡Œè®¡ç®—</p><blockquote><p>In mathematics and computer science, an <strong>algorithm</strong> (/ËˆÃ¦lÉ¡É™rÉªÃ°É™m/) is a finite sequence of rigorous instructions, typically used to solve a class of specific problems or to perform a computation.[^1]</p></blockquote><p><strong>Introduction to Algorithm[^2]</strong></p><p>ä¸æ­£å¼çš„è¯´ï¼Œç®—æ³•å°±æ˜¯ä»»ä½•å®šä¹‰ä¼˜è‰¯çš„è®¡ç®—è¿‡ç¨‹ï¼šæ¥æ”¶ä¸€äº›å€¼ä½œä¸ºè¾“å…¥ï¼Œåœ¨æœ‰é™çš„æ—¶é—´å†…ï¼Œäº§ç”Ÿä¸€äº›å€¼ä½œä¸ºè¾“å‡ºã€‚</p><blockquote><p>Informally, an algorithm is any well-defined computational procedure that takes some value, or set of values, as input and produces some value, or set of values, as output in a finite amount of time.</p></blockquote><h2 id="shi-yao-shi-shu-ju-jie-gou" id="ä»€ä¹ˆæ˜¯æ•°æ®ç»“æ„ï¼Ÿ">ä»€ä¹ˆæ˜¯æ•°æ®ç»“æ„ï¼Ÿ</h2><p><strong>å®šä¹‰</strong></p><p>åœ¨è®¡ç®—æœºç§‘å­¦é¢†åŸŸï¼Œæ•°æ®ç»“æ„æ˜¯ä¸€ç§æ•°æ®ç»„ç»‡ã€ç®¡ç†å’Œå­˜å‚¨æ ¼å¼ï¼Œé€šå¸¸è¢«é€‰æ‹©ç”¨æ¥é«˜æ•ˆè®¿é—®æ•°æ®</p><blockquote><p>In computer science, a <strong>data structure</strong> is a data organization, management, and storage format that is usually chosen for efficient access to data</p></blockquote><p><strong>Introduction to Algorithm[^2]</strong></p><p>æ•°æ®ç»“æ„æ˜¯ä¸€ç§å­˜å‚¨å’Œç»„ç»‡æ•°æ®çš„æ–¹å¼ï¼Œæ—¨åœ¨ä¾¿äºè®¿é—®å’Œä¿®æ”¹</p><blockquote><p>A data structure is a way to store and organize data in order to facilitate access and modifications</p></blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡å¯¹ä¸€ä¸ªéå¸¸è‘—åçš„äºŒåˆ†æŸ¥æ‰¾ç®—æ³•çš„è®²è§£æ¥è®¤è¯†ä¸€ä¸‹ç®—æ³•</p><h2 id="er-fen-cha-zhao-3" id="äºŒåˆ†æŸ¥æ‰¾-3">äºŒåˆ†æŸ¥æ‰¾ [^3]</h2><p>äºŒåˆ†æŸ¥æ‰¾ç®—æ³•ä¹Ÿç§°æŠ˜åŠæŸ¥æ‰¾ï¼Œæ˜¯ä¸€ç§éå¸¸é«˜æ•ˆçš„å·¥ä½œäºæœ‰åºæ•°ç»„çš„æŸ¥æ‰¾ç®—æ³•ã€‚åç»­çš„è¯¾ç¨‹ä¸­è¿˜ä¼šå­¦ä¹ æ›´å¤šçš„æŸ¥æ‰¾ç®—æ³•ï¼Œä½†åœ¨æ­¤ä¹‹å‰ï¼Œä¸å¦¨ç”¨å®ƒä½œä¸ºå…¥é—¨ã€‚</p><h3 id="er-fen-cha-zhao-ji-chu-ban" id="äºŒåˆ†æŸ¥æ‰¾åŸºç¡€ç‰ˆ">äºŒåˆ†æŸ¥æ‰¾åŸºç¡€ç‰ˆ</h3><p>éœ€æ±‚ï¼šåœ¨<strong>æœ‰åº</strong>æ•°ç»„ $A$ å†…ï¼ŒæŸ¥æ‰¾å€¼ $target$</p><ul><li>å¦‚æœæ‰¾åˆ°è¿”å›ç´¢å¼•</li><li>å¦‚æœæ‰¾ä¸åˆ°è¿”å› $-1$</li></ul><table><thead><tr><th>ç®—æ³•æè¿°</th><th></th></tr></thead><tbody><tr><td>å‰æ</td><td>ç»™å®šä¸€ä¸ªå†…å« $n$ ä¸ªå…ƒç´ çš„æœ‰åºæ•°ç»„ $A$ï¼Œæ»¡è¶³ $A_{0}\leq A_{1}\leq A_{2}\leq \cdots \leq A_{n-1}$ï¼Œä¸€ä¸ªå¾…æŸ¥å€¼ $target$</td></tr><tr><td>1</td><td>è®¾ç½® $i=0$ï¼Œ$j=n-1$</td></tr><tr><td>2</td><td>å¦‚æœ $i \gt j$ï¼Œç»“æŸæŸ¥æ‰¾ï¼Œæ²¡æ‰¾åˆ°</td></tr><tr><td>3</td><td>è®¾ç½® $m = floor(\frac {i+j}{2})$ ï¼Œ$m$ ä¸ºä¸­é—´ç´¢å¼•ï¼Œ$floor$ æ˜¯å‘ä¸‹å–æ•´ï¼ˆ$\leq \frac {i+j}{2}$ çš„æœ€å°æ•´æ•°ï¼‰</td></tr><tr><td>4</td><td>å¦‚æœ $target &lt; A_{m}$ è®¾ç½® $j = m - 1$ï¼Œè·³åˆ°ç¬¬2æ­¥</td></tr><tr><td>5</td><td>å¦‚æœ $A_{m} &lt; target$ è®¾ç½® $i = m + 1$ï¼Œè·³åˆ°ç¬¬2æ­¥</td></tr><tr><td>6</td><td>å¦‚æœ $A_{m} = target$ï¼Œç»“æŸæŸ¥æ‰¾ï¼Œæ‰¾åˆ°äº†</td></tr></tbody></table><p>java å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = a.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= j) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; a[m]) &#123;<span class="comment">// åœ¨å·¦è¾¹</span></span><br><span class="line">            j = m - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[m] &lt; target) &#123;<span class="comment">// åœ¨å³è¾¹</span></span><br><span class="line">            i = m + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> m;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>$i,j$ å¯¹åº”ç€æœç´¢åŒºé—´ $[0,a.length-1]$ï¼ˆæ³¨æ„æ˜¯é—­åˆçš„åŒºé—´ï¼‰ï¼Œ$i&lt;=j$ æ„å‘³ç€æœç´¢åŒºé—´å†…è¿˜æœ‰æœªæ¯”è¾ƒçš„å…ƒç´ ï¼Œ$i,j$ æŒ‡å‘çš„å…ƒç´ ä¹Ÿå¯èƒ½æ˜¯æ¯”è¾ƒçš„ç›®æ ‡<ul><li>æ€è€ƒï¼šå¦‚æœä¸åŠ  $i==j$ è¡Œä¸è¡Œï¼Ÿ</li><li>å›ç­”ï¼šä¸è¡Œï¼Œå› ä¸ºè¿™æ„å‘³ç€ $i,j$ æŒ‡å‘çš„å…ƒç´ ä¼šæ¼è¿‡æ¯”è¾ƒ</li></ul></li><li>$m$ å¯¹åº”ç€ä¸­é—´ä½ç½®ï¼Œä¸­é—´ä½ç½®å·¦è¾¹å’Œå³è¾¹çš„å…ƒç´ å¯èƒ½ä¸ç›¸ç­‰ï¼ˆå·®ä¸€ä¸ªï¼‰ï¼Œä¸ä¼šå½±å“ç»“æœ</li><li>å¦‚æœæŸæ¬¡æœªæ‰¾åˆ°ï¼Œé‚£ä¹ˆç¼©å°åçš„åŒºé—´å†…ä¸åŒ…å« $m$</li></ul><h3 id="er-fen-cha-zhao-gai-bian-ban" id="äºŒåˆ†æŸ¥æ‰¾æ”¹å˜ç‰ˆ">äºŒåˆ†æŸ¥æ‰¾æ”¹å˜ç‰ˆ</h3><p>å¦ä¸€ç§å†™æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = a.length;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; a[m]) &#123;<span class="comment">// åœ¨å·¦è¾¹</span></span><br><span class="line">            j = m;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[m] &lt; target) &#123;<span class="comment">// åœ¨å³è¾¹</span></span><br><span class="line">            i = m + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> m;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>$i,j$ å¯¹åº”ç€æœç´¢åŒºé—´ $[0,a.length)$ï¼ˆæ³¨æ„æ˜¯å·¦é—­å³å¼€çš„åŒºé—´ï¼‰ï¼Œ$i&lt;j$ æ„å‘³ç€æœç´¢åŒºé—´å†…è¿˜æœ‰æœªæ¯”è¾ƒçš„å…ƒç´ ï¼Œ$j$ æŒ‡å‘çš„<strong>ä¸€å®šä¸æ˜¯</strong>æŸ¥æ‰¾ç›®æ ‡<ul><li>æ€è€ƒï¼šä¸ºå•¥è¿™æ¬¡ä¸åŠ  $i==j$ çš„æ¡ä»¶äº†ï¼Ÿ</li><li>å›ç­”ï¼šè¿™å› $j$ æŒ‡å‘çš„ä¸æ˜¯æŸ¥æ‰¾ç›®æ ‡ï¼Œå¦‚æœè¿˜åŠ  $i==j$ æ¡ä»¶ï¼Œå°±æ„å‘³ç€ $j$ æŒ‡å‘çš„è¿˜ä¼šå†æ¬¡æ¯”è¾ƒï¼Œæ‰¾ä¸åˆ°æ—¶ï¼Œä¼šæ­»å¾ªç¯</li></ul></li><li>å¦‚æœæŸæ¬¡è¦ç¼©å°å³è¾¹ç•Œï¼Œé‚£ä¹ˆ $j=m$ï¼Œå› ä¸ºæ­¤æ—¶çš„ $m$ å·²ç»<strong>ä¸æ˜¯</strong>æŸ¥æ‰¾ç›®æ ‡äº†</li></ul><h3 id="heng-liang-suan-fa-hao-pi" id="è¡¡é‡ç®—æ³•å¥½å">è¡¡é‡ç®—æ³•å¥½å</h3><p><strong>æ—¶é—´å¤æ‚åº¦</strong></p><p>ä¸‹é¢çš„æŸ¥æ‰¾ç®—æ³•ä¹Ÿèƒ½å¾—å‡ºä¸ä¹‹å‰äºŒåˆ†æŸ¥æ‰¾ä¸€æ ·çš„ç»“æœï¼Œé‚£ä½ èƒ½è¯´å‡ºå®ƒå·®åœ¨å“ªé‡Œå—ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        i &lt; a.length;</span><br><span class="line">        i++</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] == k) &#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€ƒè™‘æœ€åæƒ…å†µä¸‹ï¼ˆæ²¡æ‰¾åˆ°ï¼‰ä¾‹å¦‚ <code>[1,2,3,4]</code> æŸ¥æ‰¾ 5</p><ul><li><code>int i = 0</code> åªæ‰§è¡Œä¸€æ¬¡</li><li><code>i &lt; a.length</code> å—æ•°ç»„å…ƒç´ ä¸ªæ•° $n$ çš„å½±å“ï¼Œæ¯”è¾ƒ $n+1$ æ¬¡</li><li><code>i++</code> å—æ•°ç»„å…ƒç´ ä¸ªæ•° $n$ çš„å½±å“ï¼Œè‡ªå¢ $n$ æ¬¡</li><li><code>a[i] == k</code> å—å…ƒç´ ä¸ªæ•° $n$ çš„å½±å“ï¼Œæ¯”è¾ƒ $n$ æ¬¡</li><li><code>return -1</code>ï¼Œæ‰§è¡Œä¸€æ¬¡</li></ul><p>ç²—ç•¥è®¤ä¸ºæ¯è¡Œä»£ç æ‰§è¡Œæ—¶é—´æ˜¯ $t$ï¼Œå‡è®¾ $n=4$ é‚£ä¹ˆ</p><ul><li>æ€»æ‰§è¡Œæ—¶é—´æ˜¯ $(1+4+1+4+4+1)*t = 15t$</li><li>å¯ä»¥æ¨å¯¼å‡ºæ›´ä¸€èˆ¬åœ°å…¬å¼ä¸ºï¼Œ$T = (3*n+3)t$</li></ul><p>å¦‚æœå¥—ç”¨äºŒåˆ†æŸ¥æ‰¾ç®—æ³•ï¼Œè¿˜æ˜¯ <code>[1,2,3,4]</code> æŸ¥æ‰¾ 5</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = a.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= j) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; a[m]) &#123;<span class="comment">// åœ¨å·¦è¾¹</span></span><br><span class="line">            j = m - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[m] &lt; target) &#123;<span class="comment">// åœ¨å³è¾¹</span></span><br><span class="line">            i = m + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> m;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>int i = 0, j = a.length - 1</code> å„æ‰§è¡Œ 1 æ¬¡</p></li><li><p><code>i &lt;= j</code> æ¯”è¾ƒ $floor(\log_{2}(n)+1)$ å†åŠ  1 æ¬¡</p></li><li><p><code>(i + j) &gt;&gt;&gt; 1</code> è®¡ç®— $floor(\log_{2}(n)+1)$ æ¬¡</p></li><li><p>æ¥ä¸‹æ¥ <code>if() else if() else</code> ä¼šæ‰§è¡Œ $3* floor(\log_{2}(n)+1)$ æ¬¡ï¼Œåˆ†åˆ«ä¸º</p><ul><li>if æ¯”è¾ƒ</li><li>else if æ¯”è¾ƒ</li><li>else if æ¯”è¾ƒæˆç«‹åçš„èµ‹å€¼è¯­å¥</li></ul></li><li><p><code>return -1</code>ï¼Œæ‰§è¡Œä¸€æ¬¡</p></li></ul><p>ç»“æœï¼š</p><ul><li>æ€»æ‰§è¡Œæ—¶é—´ä¸º $(2 + (1+3) + 3 + 3 * 3 +1)*t = 19t$</li><li>æ›´ä¸€èˆ¬åœ°å…¬å¼ä¸º $(4 + 5 * floor(\log_{2}(n)+1))*t$</li></ul><blockquote><p><strong>æ³¨æ„ï¼š</strong></p><p>å·¦ä¾§æœªæ‰¾åˆ°å’Œå³ä¾§æœªæ‰¾åˆ°ç»“æœä¸ä¸€æ ·ï¼Œè¿™é‡Œä¸åšåˆ†æ</p></blockquote><p>ä¸¤ä¸ªç®—æ³•æ¯”è¾ƒï¼Œå¯ä»¥çœ‹åˆ° $n$ åœ¨è¾ƒå°çš„æ—¶å€™ï¼ŒäºŒè€…èŠ±è´¹çš„æ¬¡æ•°å·®ä¸å¤š</p><img src="https://s1.vika.cn/space/2023/03/30/a34b1df9154a4f5e96a3725e1114fc52" alt="image-20221108095747933" style="zoom:50%;" /><p>ä½†éšç€ $n$ è¶Šæ¥è¶Šå¤§ï¼Œæ¯”å¦‚è¯´ $n=1000$ æ—¶ï¼Œç”¨äºŒåˆ†æŸ¥æ‰¾ç®—æ³•ï¼ˆçº¢è‰²ï¼‰ä¹Ÿå°±æ˜¯ $54t$ï¼Œè€Œè“è‰²ç®—æ³•åˆ™éœ€è¦ $3003t$</p><img src="https://s1.vika.cn/space/2023/03/30/ffbd5198ccf94a1db9f6b02663bcb084" alt="image-20221108100014451" style="zoom:50%;" /><blockquote><p>ç”»å›¾é‡‡ç”¨çš„æ˜¯ <a href="https://www.desmos.com/calculator?lang=zh-CN">Desmos | å›¾å½¢è®¡ç®—å™¨</a></p></blockquote><p>è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œ<strong>æ—¶é—´å¤æ‚åº¦</strong>æ˜¯ç”¨æ¥è¡¡é‡ï¼šä¸€ä¸ªç®—æ³•çš„æ‰§è¡Œï¼Œéšæ•°æ®è§„æ¨¡å¢å¤§ï¼Œè€Œå¢é•¿çš„æ—¶é—´æˆæœ¬</p><ul><li>ä¸ä¾èµ–äºç¯å¢ƒå› ç´ </li></ul><p>å¦‚ä½•è¡¨ç¤ºæ—¶é—´å¤æ‚åº¦å‘¢ï¼Ÿ</p><ul><li><p>å‡è®¾ç®—æ³•è¦å¤„ç†çš„æ•°æ®è§„æ¨¡æ˜¯ $n$ï¼Œä»£ç æ€»çš„æ‰§è¡Œè¡Œæ•°ç”¨å‡½æ•° $f(n)$ æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼š</p><ul><li>çº¿æ€§æŸ¥æ‰¾ç®—æ³•çš„å‡½æ•° $f(n) = 3*n + 3$</li><li>äºŒåˆ†æŸ¥æ‰¾ç®—æ³•çš„å‡½æ•° $f(n) = (floor(log_2(n)) + 1) * 5 + 4$</li></ul></li><li><p>ä¸ºäº†å¯¹ $f(n)$ è¿›è¡ŒåŒ–ç®€ï¼Œåº”å½“æŠ“ä½ä¸»è¦çŸ›ç›¾ï¼Œæ‰¾åˆ°ä¸€ä¸ªå˜åŒ–è¶‹åŠ¿ä¸ä¹‹ç›¸è¿‘çš„è¡¨ç¤ºæ³•</p></li></ul><p><strong>å¤§ $O$ è¡¨ç¤ºæ³•[^4]</strong></p><p><img src="https://s1.vika.cn/space/2023/03/30/1cbc4d3eeb084d55b5b89f287115bc07" alt="image-20221108103846566"></p><p>å…¶ä¸­</p><ul><li>$c, c_1, c_2$ éƒ½ä¸ºä¸€ä¸ªå¸¸æ•°</li><li>$f(n)$ æ˜¯å®é™…æ‰§è¡Œä»£ç è¡Œæ•°ä¸ n çš„å‡½æ•°</li><li>$g(n)$ æ˜¯ç»è¿‡åŒ–ç®€ï¼Œå˜åŒ–è¶‹åŠ¿ä¸ $f(n)$ ä¸€è‡´çš„ n çš„å‡½æ•°</li></ul><p><strong>æ¸è¿›ä¸Šç•Œ</strong></p><p>æ¸è¿›ä¸Šç•Œï¼ˆasymptotic upper boundï¼‰ï¼šä»æŸä¸ªå¸¸æ•° $n_0$å¼€å§‹ï¼Œ$c*g(n)$ æ€»æ˜¯ä½äº $f(n)$ ä¸Šæ–¹ï¼Œé‚£ä¹ˆè®°ä½œ $O(g(n))$</p><ul><li>ä»£è¡¨ç®—æ³•æ‰§è¡Œçš„æœ€å·®æƒ…å†µ</li></ul><p>ä¾‹1</p><ul><li>$f(n) = 3*n+3$</li><li>$g(n) = n$</li><li>å– $c=4$ï¼Œåœ¨$n_0=3$ ä¹‹åï¼Œ$g(n)$ å¯ä»¥ä½œä¸º $f(n)$ çš„æ¸è¿›ä¸Šç•Œï¼Œå› æ­¤è¡¨ç¤ºæ³•å†™ä½œ $O(n)$</li></ul><p>ä¾‹2</p><ul><li>$f(n) = 5*floor(log_2(n)) + 9$</li><li>$g(n) = log_2(n)$</li><li>$O(log_2(n))$</li></ul><p>å·²çŸ¥ $f(n)$ æ¥è¯´ï¼Œæ±‚ $g(n)$</p><ul><li>è¡¨è¾¾å¼ä¸­ç›¸ä¹˜çš„å¸¸é‡ï¼Œå¯ä»¥çœç•¥ï¼Œå¦‚<ul><li>$f(n) = 100*n^2$ ä¸­çš„ $100$</li></ul></li><li>å¤šé¡¹å¼ä¸­æ•°é‡è§„æ¨¡æ›´å°ï¼ˆä½æ¬¡é¡¹ï¼‰çš„è¡¨è¾¾å¼ï¼Œå¦‚<ul><li>$f(n)=n^2+n$ ä¸­çš„ $n$</li><li>$f(n) = n^3 + n^2$ ä¸­çš„ $n^2$</li></ul></li><li>ä¸åŒåº•æ•°çš„å¯¹æ•°ï¼Œæ¸è¿›ä¸Šç•Œå¯ä»¥ç”¨ä¸€ä¸ªå¯¹æ•°å‡½æ•° $\log n$ è¡¨ç¤º<ul><li>ä¾‹å¦‚ï¼š$log_2(n)$ å¯ä»¥æ›¿æ¢ä¸º $log_{10}(n)$ï¼Œå› ä¸º $log_2(n) = \frac{log_{10}(n)}{log_{10}(2)}$ï¼Œç›¸ä¹˜çš„å¸¸é‡ $\frac{1}{log_{10}(2)}$ å¯ä»¥çœç•¥</li></ul></li><li>ç±»ä¼¼çš„ï¼Œå¯¹æ•°çš„å¸¸æ•°æ¬¡å¹‚å¯çœç•¥<ul><li>å¦‚ï¼š$log(n^c) = c * log(n)$</li></ul></li></ul><p><strong>å¸¸è§å¤§ $O$ è¡¨ç¤ºæ³•</strong></p><p><img src="https://s1.vika.cn/space/2023/03/30/c195ef889ca04a1da0bdc83ff29026e4" alt="image-20221108114915524"></p><p>æŒ‰æ—¶é—´å¤æ‚åº¦ä»ä½åˆ°é«˜</p><ul><li>é»‘è‰²æ¨ªçº¿ $O(1)$ï¼Œå¸¸é‡æ—¶é—´ï¼Œæ„å‘³ç€ç®—æ³•æ—¶é—´å¹¶ä¸éšæ•°æ®è§„æ¨¡è€Œå˜åŒ–</li><li>ç»¿è‰² $O(log(n))$ï¼Œå¯¹æ•°æ—¶é—´</li><li>è“è‰² $O(n)$ï¼Œçº¿æ€§æ—¶é—´ï¼Œç®—æ³•æ—¶é—´ä¸æ•°æ®è§„æ¨¡æˆæ­£æ¯”</li><li>æ©™è‰² $O(n*log(n))$ï¼Œæ‹Ÿçº¿æ€§æ—¶é—´</li><li>çº¢è‰² $O(n^2)$ å¹³æ–¹æ—¶é—´</li><li>é»‘è‰²æœä¸Š $O(2^n)$ æŒ‡æ•°æ—¶é—´</li><li>æ²¡ç”»å‡ºæ¥çš„ $O(n!)$</li></ul><p><strong>æ¸è¿›ä¸‹ç•Œ</strong></p><p>æ¸è¿›ä¸‹ç•Œï¼ˆasymptotic lower boundï¼‰ï¼šä»æŸä¸ªå¸¸æ•° $n_0$å¼€å§‹ï¼Œ$c*g(n)$ æ€»æ˜¯ä½äº $f(n)$ ä¸‹æ–¹ï¼Œé‚£ä¹ˆè®°ä½œ $\Omega(g(n))$</p><p><strong>æ¸è¿›ç´§ç•Œ</strong></p><p>æ¸è¿›ç´§ç•Œï¼ˆasymptotic tight boundsï¼‰ï¼šä»æŸä¸ªå¸¸æ•° $n_0$å¼€å§‹ï¼Œ$f(n)$ æ€»æ˜¯åœ¨ $c_1<em>g(n)$ å’Œ $c_2</em>g(n)$ ä¹‹é—´ï¼Œé‚£ä¹ˆè®°ä½œ $\Theta(g(n))$</p><p><strong>ç©ºé—´å¤æ‚åº¦</strong></p><p>ä¸æ—¶é—´å¤æ‚åº¦ç±»ä¼¼ï¼Œä¸€èˆ¬ä¹Ÿä½¿ç”¨å¤§ $O$ è¡¨ç¤ºæ³•æ¥è¡¡é‡ï¼šä¸€ä¸ªç®—æ³•æ‰§è¡Œéšæ•°æ®è§„æ¨¡å¢å¤§ï¼Œè€Œå¢é•¿çš„<strong>é¢å¤–</strong>ç©ºé—´æˆæœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearchBasic</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = a.length - <span class="number">1</span>;    <span class="comment">// è®¾ç½®æŒ‡é’ˆå’Œåˆå€¼</span></span><br><span class="line">    <span class="keyword">while</span> (i &lt;= j) &#123;                <span class="comment">// i~j èŒƒå›´å†…æœ‰ä¸œè¥¿</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(target &lt; a[m]) &#123;         <span class="comment">// ç›®æ ‡åœ¨å·¦è¾¹</span></span><br><span class="line">            j = m - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[m] &lt; target) &#123; <span class="comment">// ç›®æ ‡åœ¨å³è¾¹</span></span><br><span class="line">            i = m + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;                    <span class="comment">// æ‰¾åˆ°äº†</span></span><br><span class="line">            <span class="keyword">return</span> m;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>äºŒåˆ†æŸ¥æ‰¾æ€§èƒ½</strong></p><p>ä¸‹é¢åˆ†æäºŒåˆ†æŸ¥æ‰¾ç®—æ³•çš„æ€§èƒ½</p><p>æ—¶é—´å¤æ‚åº¦</p><ul><li>æœ€åæƒ…å†µï¼š$O(\log n)$</li><li>æœ€å¥½æƒ…å†µï¼šå¦‚æœå¾…æŸ¥æ‰¾å…ƒç´ æ°å¥½åœ¨æ•°ç»„ä¸­å¤®ï¼Œåªéœ€è¦å¾ªç¯ä¸€æ¬¡ $O(1)$</li></ul><p>ç©ºé—´å¤æ‚åº¦</p><ul><li>éœ€è¦å¸¸æ•°ä¸ªæŒ‡é’ˆ $i,j,m$ï¼Œå› æ­¤é¢å¤–å ç”¨çš„ç©ºé—´æ˜¯ $O(1)$</li></ul><h3 id="er-fen-cha-zhao-ping-heng-ban" id="äºŒåˆ†æŸ¥æ‰¾å¹³è¡¡ç‰ˆ">äºŒåˆ†æŸ¥æ‰¾å¹³è¡¡ç‰ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearchBalance</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = a.length;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span> &lt; j - i) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; a[m]) &#123;</span><br><span class="line">            j = m;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            i = m;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (a[i] == target) ? i : -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€æƒ³ï¼š</p><ol><li>å·¦é—­å³å¼€çš„åŒºé—´ï¼Œ$i$ æŒ‡å‘çš„å¯èƒ½æ˜¯ç›®æ ‡ï¼Œè€Œ $j$ æŒ‡å‘çš„ä¸æ˜¯ç›®æ ‡</li><li>ä¸å¥¢æœ›å¾ªç¯å†…é€šè¿‡ $m$ æ‰¾å‡ºç›®æ ‡, ç¼©å°åŒºé—´ç›´è‡³å‰© 1 ä¸ª, å‰©ä¸‹çš„è¿™ä¸ªå¯èƒ½å°±æ˜¯è¦æ‰¾çš„ï¼ˆé€šè¿‡ $i$ï¼‰<ul><li>$j - i &gt; 1$ çš„å«ä¹‰æ˜¯ï¼Œåœ¨èŒƒå›´å†…å¾…æ¯”è¾ƒçš„å…ƒç´ ä¸ªæ•° &gt; 1</li></ul></li><li>æ”¹å˜ $i$ è¾¹ç•Œæ—¶ï¼Œå®ƒæŒ‡å‘çš„å¯èƒ½æ˜¯ç›®æ ‡ï¼Œå› æ­¤ä¸èƒ½ $m+1$</li><li>å¾ªç¯å†…çš„å¹³å‡æ¯”è¾ƒæ¬¡æ•°å‡å°‘äº†</li><li>æ—¶é—´å¤æ‚åº¦ $\Theta(log(n))$</li></ol><h3 id="er-fen-cha-zhao-java-ban" id="äºŒåˆ†æŸ¥æ‰¾-Java-ç‰ˆ">äºŒåˆ†æŸ¥æ‰¾ Java ç‰ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearch0</span><span class="params">(<span class="type">long</span>[] a, <span class="type">int</span> fromIndex, <span class="type">int</span> toIndex,</span></span><br><span class="line"><span class="params">                                     <span class="type">long</span> key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> fromIndex;</span><br><span class="line">    <span class="type">int</span> <span class="variable">high</span> <span class="operator">=</span> toIndex - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (low &lt;= high) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (low + high) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">midVal</span> <span class="operator">=</span> a[mid];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (midVal &lt; key)</span><br><span class="line">            low = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (midVal &gt; key)</span><br><span class="line">            high = mid - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> mid; <span class="comment">// key found</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -(low + <span class="number">1</span>);  <span class="comment">// key not found.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¾‹å¦‚ $[1,3,5,6]$ è¦æ’å…¥ $2$ é‚£ä¹ˆå°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªä½ç½®ï¼Œè¿™ä¸ªä½ç½®å·¦ä¾§å…ƒç´ éƒ½æ¯”å®ƒå°<ul><li>ç­‰å¾ªç¯ç»“æŸï¼Œè‹¥æ²¡æ‰¾åˆ°ï¼Œlow å·¦ä¾§å…ƒç´ è‚¯å®šéƒ½æ¯” target å°ï¼Œå› æ­¤ low å³æ’å…¥ç‚¹</li></ul></li><li>æ’å…¥ç‚¹å–è´Ÿæ˜¯ä¸ºäº†ä¸æ‰¾åˆ°æƒ…å†µåŒºåˆ†</li><li>-1 æ˜¯ä¸ºäº†æŠŠç´¢å¼• 0 ä½ç½®çš„æ’å…¥ç‚¹ä¸æ‰¾åˆ°çš„æƒ…å†µè¿›è¡ŒåŒºåˆ†</li></ul><h3 id="leftmost-yu-rightmost" id="Leftmost-ä¸-Rightmost">Leftmost ä¸ Rightmost</h3><p>æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›è¿”å›çš„æ˜¯æœ€å·¦ä¾§çš„é‡å¤å…ƒç´ ï¼Œå¦‚æœç”¨ Basic äºŒåˆ†æŸ¥æ‰¾</p><ul><li><p>å¯¹äºæ•°ç»„ $[1, 2, 3, 4, 4, 5, 6, 7]$ï¼ŒæŸ¥æ‰¾å…ƒç´ 4ï¼Œç»“æœæ˜¯ç´¢å¼•3</p></li><li><p>å¯¹äºæ•°ç»„ $[1, 2, 4, 4, 4, 5, 6, 7]$ï¼ŒæŸ¥æ‰¾å…ƒç´ 4ï¼Œç»“æœä¹Ÿæ˜¯ç´¢å¼•3ï¼Œå¹¶ä¸æ˜¯æœ€å·¦ä¾§çš„å…ƒç´ </p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearchLeftmost1</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = a.length - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">candidate</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= j) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; a[m]) &#123;</span><br><span class="line">            j = m - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[m] &lt; target) &#123;</span><br><span class="line">            i = m + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            candidate = m; <span class="comment">// è®°å½•å€™é€‰ä½ç½®</span></span><br><span class="line">            j = m - <span class="number">1</span>;     <span class="comment">// ç»§ç»­å‘å·¦</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> candidate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå¸Œæœ›è¿”å›çš„æ˜¯æœ€å³ä¾§å…ƒç´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearchRightmost1</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = a.length - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">candidate</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= j) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; a[m]) &#123;</span><br><span class="line">            j = m - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[m] &lt; target) &#123;</span><br><span class="line">            i = m + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            candidate = m; <span class="comment">// è®°å½•å€™é€‰ä½ç½®</span></span><br><span class="line">            i = m + <span class="number">1</span>;   <span class="comment">// ç»§ç»­å‘å³</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> candidate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨</strong></p><p>å¯¹äº Leftmost ä¸ Rightmostï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªæ¯” -1 æ›´æœ‰ç”¨çš„å€¼</p><p>Leftmost æ”¹ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearchLeftmost</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = a.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= j) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (target &lt;= a[m]) &#123;</span><br><span class="line">            j = m - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            i = m + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>leftmost è¿”å›å€¼çš„å¦ä¸€å±‚å«ä¹‰ï¼š$\lt target$ çš„å…ƒç´ ä¸ªæ•°</li><li>å°äºç­‰äºä¸­é—´å€¼ï¼Œéƒ½è¦å‘å·¦æ‰¾</li></ul><p>Rightmost æ”¹ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearchRightmost</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = a.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= j) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (target &lt; a[m]) &#123;</span><br><span class="line">            j = m - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            i = m + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¤§äºç­‰äºä¸­é—´å€¼ï¼Œéƒ½è¦å‘å³æ‰¾</li></ul><p>å‡ ä¸ªåè¯</p><p><img src="https://s1.vika.cn/space/2023/03/30/75cc1675174b4d089fbe00db76688c83" alt="image-20221125174155058"></p><p><strong>èŒƒå›´æŸ¥è¯¢</strong>ï¼š</p><ul><li>æŸ¥è¯¢ $x \lt 4$ï¼Œ$0 â€¦ leftmost(4) - 1$</li><li>æŸ¥è¯¢ $x \leq 4$ï¼Œ$0 â€¦ rightmost(4)$</li><li>æŸ¥è¯¢ $4 \lt x$ï¼Œ$rightmost(4) + 1 â€¦ \infty $</li><li>æŸ¥è¯¢ $4 \leq x$ï¼Œ $leftmost(4) â€¦ \infty$</li><li>æŸ¥è¯¢ $4 \leq x \leq 7$ï¼Œ$leftmost(4) â€¦ rightmost(7)$</li><li>æŸ¥è¯¢ $4 \lt x \lt 7$ï¼Œ$rightmost(4)+1 â€¦ leftmost(7)-1$</li></ul><p><strong>æ±‚æ’å</strong>ï¼š$leftmost(target) + 1$</p><ul><li>$target$ å¯ä»¥ä¸å­˜åœ¨ï¼Œå¦‚ï¼š$leftmost(5)+1 = 6$</li><li>$target$ ä¹Ÿå¯ä»¥å­˜åœ¨ï¼Œå¦‚ï¼š$leftmost(4)+1 = 3$</li></ul><p><strong>æ±‚å‰ä»»ï¼ˆpredecessorï¼‰</strong>ï¼š$leftmost(target) - 1$</p><ul><li>$leftmost(3) - 1 = 1$ï¼Œå‰ä»» $a_1 = 2$</li><li>$leftmost(4) - 1 = 1$ï¼Œå‰ä»» $a_1 = 2$</li></ul><p><strong>æ±‚åä»»ï¼ˆsuccessorï¼‰</strong>ï¼š$rightmost(target)+1$</p><ul><li>$rightmost(5) + 1 = 5$ï¼Œåä»» $a_5 = 7$</li><li>$rightmost(4) + 1 = 5$ï¼Œåä»» $a_5 = 7$</li></ul><p><strong>æ±‚æœ€è¿‘é‚»å±…</strong>ï¼š</p><ul><li>å‰ä»»å’Œåä»»è·ç¦»æ›´è¿‘è€…</li></ul><h1 id="ji-chu-shu-ju-jie-gou">åŸºç¡€æ•°æ®ç»“æ„</h1><h1 id="shu-zu">æ•°ç»„</h1><h2 id="gai-shu" id="æ¦‚è¿°">æ¦‚è¿°</h2><p><strong>å®šä¹‰</strong></p><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œæ•°ç»„æ˜¯ç”±ä¸€ç»„å…ƒç´ ï¼ˆå€¼æˆ–å˜é‡ï¼‰ç»„æˆçš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªå…ƒç´ æœ‰è‡³å°‘ä¸€ä¸ªç´¢å¼•æˆ–é”®æ¥æ ‡è¯†</p><blockquote><p>In computer science, an <strong>array</strong> is a data structure consisting of a collection of <em>elements</em> (values or variables), each identified by at least one <em>array index</em> or <em>key</em></p></blockquote><p>å› ä¸ºæ•°ç»„å†…çš„å…ƒç´ æ˜¯<strong>è¿ç»­å­˜å‚¨</strong>çš„ï¼Œæ‰€ä»¥æ•°ç»„ä¸­å…ƒç´ çš„åœ°å€ï¼Œå¯ä»¥é€šè¿‡å…¶ç´¢å¼•è®¡ç®—å‡ºæ¥ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] array = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br></pre></td></tr></table></figure><p>çŸ¥é“äº†æ•°ç»„çš„<strong>æ•°æ®</strong>èµ·å§‹åœ°å€ $BaseAddress$ï¼Œå°±å¯ä»¥ç”±å…¬å¼ $BaseAddress + i * size$ è®¡ç®—å‡ºç´¢å¼• $i$ å…ƒç´ çš„åœ°å€</p><ul><li>$i$ å³ç´¢å¼•ï¼Œåœ¨ Javaã€C ç­‰è¯­è¨€éƒ½æ˜¯ä» 0 å¼€å§‹</li><li>$size$ æ˜¯æ¯ä¸ªå…ƒç´ å ç”¨å­—èŠ‚ï¼Œä¾‹å¦‚ $int$ å  $4$ï¼Œ$double$ å  $8$</li></ul><p><strong>å°æµ‹è¯•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] array = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br></pre></td></tr></table></figure><p>å·²çŸ¥ array çš„<strong>æ•°æ®</strong>çš„èµ·å§‹åœ°å€æ˜¯ 0x7138f94c8ï¼Œé‚£ä¹ˆå…ƒç´  3 çš„åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ</p><blockquote><p>ç­”ï¼š0x7138f94c8 + 2 * 1 = 0x7138f94ca</p></blockquote><p><strong>ç©ºé—´å ç”¨</strong></p><p>Java ä¸­æ•°ç»„ç»“æ„ä¸º</p><ul><li>8 å­—èŠ‚ markword</li><li>4 å­—èŠ‚ class æŒ‡é’ˆï¼ˆå‹ç¼© class æŒ‡é’ˆçš„æƒ…å†µï¼‰</li><li>4 å­—èŠ‚ æ•°ç»„å¤§å°ï¼ˆå†³å®šäº†æ•°ç»„æœ€å¤§å®¹é‡æ˜¯ $2^{32}$ï¼‰</li><li>æ•°ç»„å…ƒç´  + å¯¹é½å­—èŠ‚ï¼ˆjava ä¸­æ‰€æœ‰å¯¹è±¡å¤§å°éƒ½æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€[^12]ï¼Œä¸è¶³çš„è¦ç”¨å¯¹é½å­—èŠ‚è¡¥è¶³ï¼‰</li></ul><p>ä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] array = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br></pre></td></tr></table></figure><p>çš„å¤§å°ä¸º 40 ä¸ªå­—èŠ‚ï¼Œç»„æˆå¦‚ä¸‹</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">8 </span>+ <span class="number">4</span> + <span class="number">4</span> + <span class="number">5</span>*<span class="number">4</span> + <span class="number">4</span>(alignment)</span><br></pre></td></tr></table></figure><p><strong>éšæœºè®¿é—®æ€§èƒ½</strong></p><p>å³æ ¹æ®ç´¢å¼•æŸ¥æ‰¾å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ $O(1)$</p><h2 id="dong-tai-shu-zu" id="åŠ¨æ€æ•°ç»„">åŠ¨æ€æ•°ç»„</h2><p><strong>java ç‰ˆæœ¬</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicArray</span> <span class="keyword">implements</span> <span class="title class_">Iterable</span>&lt;Integer&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// é€»è¾‘å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">capacity</span> <span class="operator">=</span> <span class="number">8</span>; <span class="comment">// å®¹é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] array = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘æœ€åä½ç½® [size] æ·»åŠ å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element å¾…æ·»åŠ å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> element)</span> &#123;</span><br><span class="line">        add(size, element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘ [0 .. size] ä½ç½®æ·»åŠ å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index   ç´¢å¼•ä½ç½®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element å¾…æ·»åŠ å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> element)</span> &#123;</span><br><span class="line">        checkAndGrow();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ é€»è¾‘</span></span><br><span class="line">        <span class="keyword">if</span> (index &gt;= <span class="number">0</span> &amp;&amp; index &lt; size) &#123;</span><br><span class="line">            <span class="comment">// å‘åæŒªåŠ¨, ç©ºå‡ºå¾…æ’å…¥ä½ç½®</span></span><br><span class="line">            System.arraycopy(array, index,</span><br><span class="line">                    array, index + <span class="number">1</span>, size - index);</span><br><span class="line">        &#125;</span><br><span class="line">        array[index] = element;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkAndGrow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å®¹é‡æ£€æŸ¥</span></span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            array = <span class="keyword">new</span> <span class="title class_">int</span>[capacity];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (size == capacity) &#123;</span><br><span class="line">            <span class="comment">// è¿›è¡Œæ‰©å®¹, 1.5 1.618 2</span></span><br><span class="line">            capacity += capacity &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span>[] newArray = <span class="keyword">new</span> <span class="title class_">int</span>[capacity];</span><br><span class="line">            System.arraycopy(array, <span class="number">0</span>,</span><br><span class="line">                    newArray, <span class="number">0</span>, size);</span><br><span class="line">            array = newArray;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä» [0 .. size) èŒƒå›´åˆ é™¤å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index ç´¢å¼•ä½ç½®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¢«åˆ é™¤å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123; <span class="comment">// [0..size)</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">removed</span> <span class="operator">=</span> array[index];</span><br><span class="line">        <span class="keyword">if</span> (index &lt; size - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// å‘å‰æŒªåŠ¨</span></span><br><span class="line">            System.arraycopy(array, index + <span class="number">1</span>,</span><br><span class="line">                    array, index, size - index - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> removed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index ç´¢å¼•ä½ç½®, åœ¨ [0..size) åŒºé—´å†…</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¯¥ç´¢å¼•ä½ç½®çš„å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> array[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éå†æ–¹æ³•1</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> consumer éå†è¦æ‰§è¡Œçš„æ“ä½œ, å…¥å‚: æ¯ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foreach</span><span class="params">(Consumer&lt;Integer&gt; consumer)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="comment">// æä¾› array[i]</span></span><br><span class="line">            <span class="comment">// è¿”å› void</span></span><br><span class="line">            consumer.accept(array[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éå†æ–¹æ³•2 - è¿­ä»£å™¨éå†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;Integer&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123; <span class="comment">// æœ‰æ²¡æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">                <span class="keyword">return</span> i &lt; size;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Integer <span class="title function_">next</span><span class="params">()</span> &#123; <span class="comment">// è¿”å›å½“å‰å…ƒç´ ,å¹¶ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">                <span class="keyword">return</span> array[i++];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éå†æ–¹æ³•3 - stream éå†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> stream æµ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> IntStream <span class="title function_">stream</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> IntStream.of(Arrays.copyOfRange(array, <span class="number">0</span>, size));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™äº›æ–¹æ³•å®ç°ï¼Œéƒ½ç®€åŒ–äº† index çš„æœ‰æ•ˆæ€§åˆ¤æ–­ï¼Œå‡è®¾è¾“å…¥çš„ index éƒ½æ˜¯åˆæ³•çš„</li></ul><p><strong>æ’å…¥æˆ–åˆ é™¤æ€§èƒ½</strong></p><p>å¤´éƒ¨ä½ç½®ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ $O(n)$</p><p>ä¸­é—´ä½ç½®ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ $O(n)$</p><p>å°¾éƒ¨ä½ç½®ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ $O(1)$ï¼ˆå‡æ‘Šæ¥è¯´ï¼‰</p><h2 id="er-wei-shu-zu" id="äºŒç»´æ•°ç»„">äºŒç»´æ•°ç»„</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[][] array = &#123;</span><br><span class="line">    &#123;<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>&#125;,</span><br><span class="line">    &#123;<span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>&#125;,</span><br><span class="line">    &#123;<span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å†…å­˜å›¾å¦‚ä¸‹</p><img src="https://s1.vika.cn/space/2023/03/30/2688d5e4e6b44e6fa9c182fadc884461" alt="image-20221104114132056" style="zoom:67%;" /><ul><li><p>äºŒç»´æ•°ç»„å  32 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­ array[0]ï¼Œarray[1]ï¼Œarray[2] ä¸‰ä¸ªå…ƒç´ åˆ†åˆ«ä¿å­˜äº†æŒ‡å‘ä¸‰ä¸ªä¸€ç»´æ•°ç»„çš„å¼•ç”¨</p></li><li><p>ä¸‰ä¸ªä¸€ç»´æ•°ç»„å„å  40 ä¸ªå­—èŠ‚</p></li><li><p>å®ƒä»¬åœ¨å†…å±‚å¸ƒå±€ä¸Šæ˜¯<strong>è¿ç»­</strong>çš„</p></li></ul><p>æ›´ä¸€èˆ¬çš„ï¼Œå¯¹ä¸€ä¸ªäºŒç»´æ•°ç»„ $Array[m][n]$</p><ul><li>$m$ æ˜¯å¤–å±‚æ•°ç»„çš„é•¿åº¦ï¼Œå¯ä»¥çœ‹ä½œ row è¡Œ</li><li>$n$ æ˜¯å†…å±‚æ•°ç»„çš„é•¿åº¦ï¼Œå¯ä»¥çœ‹ä½œ column åˆ—</li><li>å½“è®¿é—® $Array[i][j]$ï¼Œ$0\leq i \lt m, 0\leq j \lt n$æ—¶ï¼Œå°±ç›¸å½“äº<ul><li>å…ˆæ‰¾åˆ°ç¬¬ $i$ ä¸ªå†…å±‚æ•°ç»„ï¼ˆè¡Œï¼‰</li><li>å†æ‰¾åˆ°æ­¤å†…å±‚æ•°ç»„ä¸­ç¬¬ $j$ ä¸ªå…ƒç´ ï¼ˆåˆ—ï¼‰</li></ul></li></ul><p><strong>å°æµ‹è¯•</strong></p><p>Java ç¯å¢ƒä¸‹ï¼ˆä¸è€ƒè™‘ç±»æŒ‡é’ˆå’Œå¼•ç”¨å‹ç¼©ï¼Œæ­¤ä¸ºé»˜è®¤æƒ…å†µï¼‰ï¼Œæœ‰ä¸‹é¢çš„äºŒç»´æ•°ç»„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[][] array = &#123;</span><br><span class="line">    &#123;<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>&#125;,</span><br><span class="line">    &#123;<span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>&#125;,</span><br><span class="line">    &#123;<span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å·²çŸ¥ array <strong>å¯¹è±¡</strong>èµ·å§‹åœ°å€æ˜¯ 0x1000ï¼Œé‚£ä¹ˆ 23 è¿™ä¸ªå…ƒç´ çš„åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ</p><blockquote><p>ç­”ï¼š</p><ul><li>èµ·å§‹åœ°å€ 0x1000</li><li>å¤–å±‚æ•°ç»„å¤§å°ï¼š16å­—èŠ‚å¯¹è±¡å¤´ + 3å…ƒç´  * æ¯ä¸ªå¼•ç”¨4å­—èŠ‚ + 4 å¯¹é½å­—èŠ‚ = 32 = 0x20</li><li>ç¬¬ä¸€ä¸ªå†…å±‚æ•°ç»„å¤§å°ï¼š16å­—èŠ‚å¯¹è±¡å¤´ + 5å…ƒç´  * æ¯ä¸ªbyte1å­—èŠ‚ + 3 å¯¹é½å­—èŠ‚ = 24 = 0x18</li><li>ç¬¬äºŒä¸ªå†…å±‚æ•°ç»„ï¼Œ16å­—èŠ‚å¯¹è±¡å¤´ = 0x10ï¼Œå¾…æŸ¥æ‰¾å…ƒç´ ç´¢å¼•ä¸º 2</li><li>æœ€åç»“æœ = 0x1000 + 0x20 + 0x18 + 0x10 + 2*1 = 0x104a</li></ul></blockquote><h2 id="ju-bu-xing-yuan-li" id="å±€éƒ¨æ€§åŸç†">å±€éƒ¨æ€§åŸç†</h2><p>è¿™é‡Œåªè®¨è®ºç©ºé—´å±€éƒ¨æ€§</p><ul><li>cpu è¯»å–å†…å­˜ï¼ˆé€Ÿåº¦æ…¢ï¼‰æ•°æ®åï¼Œä¼šå°†å…¶æ”¾å…¥é«˜é€Ÿç¼“å­˜ï¼ˆé€Ÿåº¦å¿«ï¼‰å½“ä¸­ï¼Œå¦‚æœåæ¥çš„è®¡ç®—å†ç”¨åˆ°æ­¤æ•°æ®ï¼Œåœ¨ç¼“å­˜ä¸­èƒ½è¯»åˆ°çš„è¯ï¼Œå°±ä¸å¿…è¯»å†…å­˜äº†</li><li>ç¼“å­˜çš„æœ€å°å­˜å‚¨å•ä½æ˜¯ç¼“å­˜è¡Œï¼ˆcache lineï¼‰ï¼Œä¸€èˆ¬æ˜¯ 64 bytesï¼Œä¸€æ¬¡è¯»çš„æ•°æ®å°‘äº†ä¸åˆ’ç®—å•Šï¼Œå› æ­¤æœ€å°‘è¯» 64 bytes å¡«æ»¡ä¸€ä¸ªç¼“å­˜è¡Œï¼Œå› æ­¤è¯»å…¥æŸä¸ªæ•°æ®æ—¶ä¹Ÿä¼šè¯»å–å…¶<strong>ä¸´è¿‘çš„æ•°æ®</strong>ï¼Œè¿™å°±æ˜¯æ‰€è°“<strong>ç©ºé—´å±€éƒ¨æ€§</strong></li></ul><p><strong>å¯¹æ•ˆç‡çš„å½±å“</strong></p><p>æ¯”è¾ƒä¸‹é¢ ij å’Œ ji ä¸¤ä¸ªæ–¹æ³•çš„æ‰§è¡Œæ•ˆç‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> <span class="number">1000000</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">columns</span> <span class="operator">=</span> <span class="number">14</span>;</span><br><span class="line"><span class="type">int</span>[][] a = <span class="keyword">new</span> <span class="title class_">int</span>[rows][columns];</span><br><span class="line"></span><br><span class="line"><span class="type">StopWatch</span> <span class="variable">sw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">sw.start(<span class="string">&quot;ij&quot;</span>);</span><br><span class="line">ij(a, rows, columns);</span><br><span class="line">sw.stop();</span><br><span class="line">sw.start(<span class="string">&quot;ji&quot;</span>);</span><br><span class="line">ji(a, rows, columns);</span><br><span class="line">sw.stop();</span><br><span class="line">System.out.println(sw.prettyPrint());</span><br></pre></td></tr></table></figure><p>ij æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ij</span><span class="params">(<span class="type">int</span>[][] a, <span class="type">int</span> rows, <span class="type">int</span> columns)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; rows; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; columns; j++) &#123;</span><br><span class="line">            sum += a[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ji æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ji</span><span class="params">(<span class="type">int</span>[][] a, <span class="type">int</span> rows, <span class="type">int</span> columns)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; columns; j++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; rows; i++) &#123;</span><br><span class="line">            sum += a[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">0</span><br><span class="line"><span class="section">StopWatch &#x27;&#x27;: running time = 96283300 ns</span></span><br><span class="line"><span class="section">---------------------------------------------</span></span><br><span class="line"><span class="section">ns         %     Task name</span></span><br><span class="line"><span class="section">---------------------------------------------</span></span><br><span class="line">016196200  017%  ij</span><br><span class="line">080087100  083%  ji</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° ij çš„æ•ˆç‡æ¯” ji å¿«å¾ˆå¤šï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>ç¼“å­˜æ˜¯æœ‰é™çš„ï¼Œå½“æ–°æ•°æ®æ¥äº†åï¼Œä¸€äº›æ—§çš„ç¼“å­˜è¡Œæ•°æ®å°±ä¼šè¢«è¦†ç›–</li><li>å¦‚æœä¸èƒ½å……åˆ†åˆ©ç”¨ç¼“å­˜çš„æ•°æ®ï¼Œå°±ä¼šé€ æˆæ•ˆç‡ä½ä¸‹</li></ul><p>ä»¥ ji æ‰§è¡Œä¸ºä¾‹ï¼Œç¬¬ä¸€æ¬¡å†…å¾ªç¯è¦è¯»å…¥ $[0,0]$ è¿™æ¡æ•°æ®ï¼Œç”±äºå±€éƒ¨æ€§åŸç†ï¼Œè¯»å…¥ $[0,0]$ çš„åŒæ—¶ä¹Ÿè¯»å…¥äº† $[0,1] â€¦ [0,13]$ï¼Œå¦‚å›¾æ‰€ç¤º</p><p><img src="https://s1.vika.cn/space/2023/03/30/f8a4fcb9f7e844f1991fab0c963d532d" alt="image-20221104164329026"></p><p>ä½†å¾ˆé—æ†¾ï¼Œç¬¬äºŒæ¬¡å†…å¾ªç¯è¦çš„æ˜¯ $[1,0]$ è¿™æ¡æ•°æ®ï¼Œç¼“å­˜ä¸­æ²¡æœ‰ï¼Œäºæ˜¯å†è¯»å…¥äº†ä¸‹å›¾çš„æ•°æ®</p><p><img src="https://s1.vika.cn/space/2023/03/30/be510202f05a454faec2d32255ec7542" alt="image-20221104164716282"></p><p>è¿™æ˜¾ç„¶æ˜¯ä¸€ç§æµªè´¹ï¼Œå› ä¸º $[0,1] â€¦ [0,13]$ åŒ…æ‹¬ $[1,1] â€¦ [1,13]$ è¿™äº›æ•°æ®è™½ç„¶è¯»å…¥äº†ç¼“å­˜ï¼Œå´æ²¡æœ‰åŠæ—¶ç”¨ä¸Šï¼Œè€Œç¼“å­˜çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œç­‰æ‰§è¡Œåˆ°ç¬¬ä¹æ¬¡å†…å¾ªç¯æ—¶</p><p><img src="https://s1.vika.cn/space/2023/03/30/7ddcb9d1ef174aef9fed74cd7ae0a2d0" alt="image-20221104164947154"></p><p>ç¼“å­˜çš„ç¬¬ä¸€è¡Œæ•°æ®å·²ç»è¢«æ–°çš„æ•°æ® $[8,0] â€¦ [8,13]$ è¦†ç›–æ‰äº†ï¼Œä»¥åå¦‚æœå†æƒ³è¯»ï¼Œæ¯”å¦‚ $[0,1]$ï¼Œåˆå¾—åˆ°å†…å­˜å»è¯»äº†</p><p>åŒç†å¯ä»¥åˆ†æ ij å‡½æ•°åˆ™èƒ½å……åˆ†åˆ©ç”¨å±€éƒ¨æ€§åŸç†åŠ è½½åˆ°çš„ç¼“å­˜æ•°æ®</p><p><strong>ä¸¾ä¸€åä¸‰</strong></p><ol><li><p>I/O è¯»å†™æ—¶åŒæ ·å¯ä»¥ä½“ç°å±€éƒ¨æ€§åŸç†</p></li><li><p>æ•°ç»„å¯ä»¥å……åˆ†åˆ©ç”¨å±€éƒ¨æ€§åŸç†ï¼Œé‚£ä¹ˆé“¾è¡¨å‘¢ï¼Ÿ</p><blockquote><p>ç­”ï¼šé“¾è¡¨ä¸è¡Œï¼Œå› ä¸ºé“¾è¡¨çš„å…ƒç´ å¹¶éç›¸é‚»å­˜å‚¨</p></blockquote></li></ol><h2 id="yue-jie-jian-cha" id="è¶Šç•Œæ£€æŸ¥">è¶Šç•Œæ£€æŸ¥</h2><p>java ä¸­å¯¹æ•°ç»„å…ƒç´ çš„è¯»å†™éƒ½æœ‰è¶Šç•Œæ£€æŸ¥ï¼Œç±»ä¼¼äºä¸‹é¢çš„ä»£ç </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">is_within_bounds</span><span class="params">(<span class="type">int</span> index)</span> <span class="type">const</span>        </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> &lt;= index &amp;&amp; index &lt; <span class="built_in">length</span>(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»£ç ä½ç½®ï¼š<code>openjdk\src\hotspot\share\oops\arrayOop.hpp</code></li></ul><p>åªä¸è¿‡æ­¤æ£€æŸ¥ä»£ç ï¼Œä¸éœ€è¦ç”±ç¨‹åºå‘˜è‡ªå·±æ¥è°ƒç”¨ï¼ŒJVM ä¼šå¸®æˆ‘ä»¬è°ƒç”¨</p><h1 id="lian-biao">é“¾è¡¨</h1><h2 id="gai-shu-1" id="æ¦‚è¿°-2">æ¦‚è¿°</h2><p><strong>å®šä¹‰</strong></p><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œé“¾è¡¨æ˜¯æ•°æ®å…ƒç´ çš„çº¿æ€§é›†åˆï¼Œå…¶æ¯ä¸ªå…ƒç´ éƒ½æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå…ƒç´ å­˜å‚¨ä¸Šå¹¶ä¸è¿ç»­</p><blockquote><p>In computer science, a <strong>linked list</strong> is a linear collection of data elements whose order is not given by their physical placement in memory. Instead, each element points to the next.</p></blockquote><p>å¯ä»¥åˆ†ç±»ä¸º[^5]</p><ul><li>å•å‘é“¾è¡¨ï¼Œæ¯ä¸ªå…ƒç´ åªçŸ¥é“å…¶ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯è°</li></ul><p><img src="https://s1.vika.cn/space/2023/03/30/f1802ddec40042f58d810763d6f5aafa" alt="image-20221110083407176"></p><ul><li>åŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªå…ƒç´ çŸ¥é“å…¶ä¸Šä¸€ä¸ªå…ƒç´ å’Œä¸‹ä¸€ä¸ªå…ƒç´ </li></ul><p><img src="https://s1.vika.cn/space/2023/03/30/580758e16601493a97b89ffdeff1f573" alt="image-20221110083427372"></p><ul><li>å¾ªç¯é“¾è¡¨ï¼Œé€šå¸¸çš„é“¾è¡¨å°¾èŠ‚ç‚¹ tail æŒ‡å‘çš„éƒ½æ˜¯ nullï¼Œè€Œå¾ªç¯é“¾è¡¨çš„ tail æŒ‡å‘çš„æ˜¯å¤´èŠ‚ç‚¹ head</li></ul><p><img src="https://s1.vika.cn/space/2023/03/30/e9535f8bf9bd4ea0a8f54f985fa9ce9b" alt="image-20221110083538273"></p><p>é“¾è¡¨å†…è¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„èŠ‚ç‚¹ç§°ä¸ºå“¨å…µï¼ˆSentinelï¼‰èŠ‚ç‚¹ï¼Œä¹Ÿå«åšå“‘å…ƒï¼ˆ Dummyï¼‰èŠ‚ç‚¹ï¼Œå®ƒä¸å­˜å‚¨æ•°æ®ï¼Œé€šå¸¸ç”¨ä½œå¤´å°¾ï¼Œç”¨æ¥ç®€åŒ–è¾¹ç•Œåˆ¤æ–­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://s1.vika.cn/space/2023/03/30/1a7eef3dd54b4d4bac88a163664b0616" alt="image-20221110084611550"></p><p><strong>éšæœºè®¿é—®æ€§èƒ½</strong></p><p>æ ¹æ® index æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ $O(n)$</p><p><strong>æ’å…¥æˆ–åˆ é™¤æ€§èƒ½</strong></p><ul><li>èµ·å§‹ä½ç½®ï¼š$O(1)$</li><li>ç»“æŸä½ç½®ï¼šå¦‚æœå·²çŸ¥ tail å°¾èŠ‚ç‚¹æ˜¯ $O(1)$ï¼Œä¸çŸ¥é“ tail å°¾èŠ‚ç‚¹æ˜¯ $O(n)$</li><li>ä¸­é—´ä½ç½®ï¼šæ ¹æ® index æŸ¥æ‰¾æ—¶é—´ + $O(1)$</li></ul><h2 id="dan-xiang-lian-biao" id="å•å‘é“¾è¡¨">å•å‘é“¾è¡¨</h2><p>æ ¹æ®å•å‘é“¾è¡¨çš„å®šä¹‰ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªå­˜å‚¨ value å’Œ next æŒ‡é’ˆçš„ç±» Nodeï¼Œå’Œä¸€ä¸ªæè¿°å¤´éƒ¨èŠ‚ç‚¹çš„å¼•ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedList</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Node head; <span class="comment">// å¤´éƒ¨èŠ‚ç‚¹</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123; <span class="comment">// èŠ‚ç‚¹ç±»</span></span><br><span class="line">        <span class="type">int</span> value;</span><br><span class="line">        Node next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> value, Node next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Node å®šä¹‰ä¸ºå†…éƒ¨ç±»ï¼Œæ˜¯ä¸ºäº†å¯¹å¤–<strong>éšè—</strong>å®ç°ç»†èŠ‚ï¼Œæ²¡å¿…è¦è®©ç±»çš„ä½¿ç”¨è€…å…³å¿ƒ Node ç»“æ„</li><li>å®šä¹‰ä¸º static å†…éƒ¨ç±»ï¼Œæ˜¯å› ä¸º Node <strong>ä¸éœ€è¦</strong>ä¸ SinglyLinkedList å®ä¾‹ç›¸å…³ï¼Œå¤šä¸ª SinglyLinkedListå®ä¾‹èƒ½å…±ç”¨ Node ç±»å®šä¹‰</li></ul><p><strong>å¤´éƒ¨æ·»åŠ </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedList</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFirst</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.head = <span class="keyword">new</span> <span class="title class_">Node</span>(value, <span class="built_in">this</span>.head);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœ this.head == nullï¼Œæ–°å¢èŠ‚ç‚¹æŒ‡å‘ nullï¼Œå¹¶ä½œä¸ºæ–°çš„ this.head</li><li>å¦‚æœ this.head != nullï¼Œæ–°å¢èŠ‚ç‚¹æŒ‡å‘åŸæ¥çš„ this.headï¼Œå¹¶ä½œä¸ºæ–°çš„ this.head<ul><li>æ³¨æ„èµ‹å€¼æ“ä½œæ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦</li></ul></li></ul><p><strong>while éå†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedList</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">curr</span> <span class="operator">=</span> <span class="built_in">this</span>.head;</span><br><span class="line">        <span class="keyword">while</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// åšä¸€äº›äº‹</span></span><br><span class="line">            curr = curr.next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>for éå†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedList</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">curr</span> <span class="operator">=</span> <span class="built_in">this</span>.head; curr != <span class="literal">null</span>; curr = curr.next) &#123;</span><br><span class="line">            <span class="comment">// åšä¸€äº›äº‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»¥ä¸Šä¸¤ç§éå†éƒ½å¯ä»¥æŠŠ<strong>è¦åšçš„äº‹</strong>ä»¥ Consumer å‡½æ•°çš„æ–¹å¼ä¼ é€’è¿›æ¥<ul><li>Consumer çš„è§„åˆ™æ˜¯<strong>ä¸€ä¸ªå‚æ•°</strong>ï¼Œ<strong>æ— è¿”å›å€¼</strong>ï¼Œå› æ­¤åƒ System.out::println æ–¹æ³•ç­‰éƒ½æ˜¯ Consumer</li><li>è°ƒç”¨ Consumer æ—¶ï¼Œå°†å½“å‰èŠ‚ç‚¹ curr.value ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒ</li></ul></li></ul><p><strong>è¿­ä»£å™¨éå†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedList</span> <span class="keyword">implements</span> <span class="title class_">Iterable</span>&lt;Integer&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">NodeIterator</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;Integer&gt; &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">curr</span> <span class="operator">=</span> head;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> curr != <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Integer <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> curr.value;</span><br><span class="line">            curr = curr.next;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;Integer&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">NodeIterator</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>hasNext ç”¨æ¥åˆ¤æ–­æ˜¯å¦è¿˜æœ‰å¿…è¦è°ƒç”¨ next</li><li>next åšä¸¤ä»¶äº‹<ul><li>è¿”å›å½“å‰èŠ‚ç‚¹çš„ value</li><li>æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</li></ul></li><li>NodeIterator è¦å®šä¹‰ä¸º<strong>é static å†…éƒ¨ç±»</strong>ï¼Œæ˜¯å› ä¸ºå®ƒä¸ SinglyLinkedList å®ä¾‹ç›¸å…³ï¼Œæ˜¯å¯¹æŸä¸ª SinglyLinkedList å®ä¾‹çš„è¿­ä»£</li></ul><p><strong>é€’å½’éå†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedList</span> <span class="keyword">implements</span> <span class="title class_">Iterable</span>&lt;Integer&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">        recursion(<span class="built_in">this</span>.head);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">recursion</span><span class="params">(Node curr)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (curr == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å‰é¢åšäº›äº‹</span></span><br><span class="line">        recursion(curr.next);</span><br><span class="line">        <span class="comment">// åé¢åšäº›äº‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å°¾éƒ¨æ·»åŠ </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedList</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">private</span> Node <span class="title function_">findLast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.head == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node curr;</span><br><span class="line">        <span class="keyword">for</span> (curr = <span class="built_in">this</span>.head; curr.next != <span class="literal">null</span>; ) &#123;</span><br><span class="line">            curr = curr.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> curr;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">last</span> <span class="operator">=</span> findLast();</span><br><span class="line">        <span class="keyword">if</span> (last == <span class="literal">null</span>) &#123;</span><br><span class="line">            addFirst(value);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        last.next = <span class="keyword">new</span> <span class="title class_">Node</span>(value, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ³¨æ„ï¼Œæ‰¾æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œç»ˆæ­¢æ¡ä»¶æ˜¯ curr.next == null</li><li>åˆ†æˆä¸¤ä¸ªæ–¹æ³•æ˜¯ä¸ºäº†ä»£ç æ¸…æ™°ï¼Œè€Œä¸” findLast() ä¹‹åè¿˜èƒ½å¤ç”¨</li></ul><p><strong>å°¾éƒ¨æ·»åŠ å¤šä¸ª</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedList</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> first, <span class="type">int</span>... rest)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Node</span> <span class="variable">sublist</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(first, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">Node</span> <span class="variable">curr</span> <span class="operator">=</span> sublist;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> value : rest) &#123;</span><br><span class="line">            curr.next = <span class="keyword">new</span> <span class="title class_">Node</span>(value, <span class="literal">null</span>);</span><br><span class="line">            curr = curr.next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Node</span> <span class="variable">last</span> <span class="operator">=</span> findLast();</span><br><span class="line">        <span class="keyword">if</span> (last == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.head = sublist;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        last.next = sublist;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å…ˆä¸²æˆä¸€ä¸² sublist</li><li>å†ä½œä¸ºä¸€ä¸ªæ•´ä½“æ·»åŠ </li></ul><p><strong>æ ¹æ®ç´¢å¼•è·å–</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedList</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="keyword">private</span> Node <span class="title function_">findNode</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">curr</span> <span class="operator">=</span> <span class="built_in">this</span>.head; curr != <span class="literal">null</span>; curr = curr.next, i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (index == i) &#123;</span><br><span class="line">                <span class="keyword">return</span> curr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> IllegalArgumentException <span class="title function_">illegalIndex</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(String.format(<span class="string">&quot;index [%d] ä¸åˆæ³•%n&quot;</span>, index));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> findNode(index);</span><br><span class="line">        <span class="keyword">if</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> node.value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åŒæ ·ï¼Œåˆ†æ–¹æ³•å¯ä»¥å®ç°å¤ç”¨</li></ul><p><strong>æ’å…¥</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedList</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">            addFirst(value);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> findNode(index - <span class="number">1</span>); <span class="comment">// æ‰¾åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="literal">null</span>) &#123; <span class="comment">// æ‰¾ä¸åˆ°</span></span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">        prev.next = <span class="keyword">new</span> <span class="title class_">Node</span>(value, prev.next);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ’å…¥åŒ…æ‹¬ä¸‹é¢çš„åˆ é™¤ï¼Œéƒ½å¿…é¡»æ‰¾åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹</li></ul><p><strong>åˆ é™¤</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedList</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.head != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.head = <span class="built_in">this</span>.head.next;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> findNode(index - <span class="number">1</span>);</span><br><span class="line">        Node curr;</span><br><span class="line">        <span class="keyword">if</span> (prev != <span class="literal">null</span> &amp;&amp; (curr = prev.next) != <span class="literal">null</span>) &#123;</span><br><span class="line">            prev.next = curr.next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ª if å—å¯¹åº”ç€ removeFirst æƒ…å†µ</li><li>æœ€åä¸€ä¸ª if å—å¯¹åº”ç€è‡³å°‘å¾—ä¸¤ä¸ªèŠ‚ç‚¹çš„æƒ…å†µ<ul><li>ä¸ä»…ä»…åˆ¤æ–­ä¸Šä¸€ä¸ªèŠ‚ç‚¹éç©ºï¼Œè¿˜è¦ä¿è¯å½“å‰èŠ‚ç‚¹éç©º</li></ul></li></ul><h2 id="dan-xiang-lian-biao-dai-shao-bing" id="å•å‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰">å•å‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰</h2><p>è§‚å¯Ÿä¹‹å‰å•å‘é“¾è¡¨çš„å®ç°ï¼Œå‘ç°æ¯ä¸ªæ–¹æ³•å†…å‡ ä¹éƒ½æœ‰åˆ¤æ–­æ˜¯ä¸æ˜¯ head è¿™æ ·çš„ä»£ç ï¼Œèƒ½ä¸èƒ½ç®€åŒ–å‘¢ï¼Ÿ</p><p>ç”¨ä¸€ä¸ªä¸å‚ä¸æ•°æ®å­˜å‚¨çš„ç‰¹æ®Š Node ä½œä¸ºå“¨å…µï¼Œå®ƒä¸€èˆ¬è¢«ç§°ä¸ºå“¨å…µæˆ–å“‘å…ƒï¼Œæ‹¥æœ‰å“¨å…µèŠ‚ç‚¹çš„é“¾è¡¨ç§°ä¸ºå¸¦å¤´é“¾è¡¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedListSentinel</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Node</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(Integer.MIN_VALUE, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å…·ä½“å­˜ä»€ä¹ˆå€¼æ— æ‰€è°“ï¼Œå› ä¸ºä¸ä¼šç”¨åˆ°å®ƒçš„å€¼</li></ul><p>åŠ å…¥å“¨å…µèŠ‚ç‚¹åï¼Œä»£ç ä¼šå˜å¾—æ¯”è¾ƒç®€å•ï¼Œå…ˆçœ‹å‡ ä¸ªå·¥å…·æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedListSentinel</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ ¹æ®ç´¢å¼•è·å–èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> Node <span class="title function_">findNode</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">curr</span> <span class="operator">=</span> <span class="built_in">this</span>.head; curr != <span class="literal">null</span>; curr = curr.next, i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == index) &#123;</span><br><span class="line">                <span class="keyword">return</span> curr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> Node <span class="title function_">findLast</span><span class="params">()</span> &#123;</span><br><span class="line">        Node curr;</span><br><span class="line">        <span class="keyword">for</span> (curr = <span class="built_in">this</span>.head; curr.next != <span class="literal">null</span>; ) &#123;</span><br><span class="line">            curr = curr.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> curr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>findNode ä¸ä¹‹å‰ç±»ä¼¼ï¼Œåªæ˜¯ i åˆå§‹å€¼è®¾ç½®ä¸º -1 å¯¹åº”å“¨å…µï¼Œå®é™…ä¼ å…¥çš„ index ä¹Ÿæ˜¯ $[-1, \infty)$</li><li>findLast ç»ä¸ä¼šè¿”å› null äº†ï¼Œå°±ç®—æ²¡æœ‰å…¶å®ƒèŠ‚ç‚¹ï¼Œä¹Ÿä¼šè¿”å›å“¨å…µä½œä¸ºæœ€åä¸€ä¸ªèŠ‚ç‚¹</li></ul><p>è¿™æ ·ï¼Œä»£ç ç®€åŒ–ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedListSentinel</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">last</span> <span class="operator">=</span> findLast();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        æ”¹åŠ¨å‰</span></span><br><span class="line"><span class="comment">        if (last == null) &#123;</span></span><br><span class="line"><span class="comment">            this.head = new Node(value, null);</span></span><br><span class="line"><span class="comment">            return;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        last.next = <span class="keyword">new</span> <span class="title class_">Node</span>(value, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        æ”¹åŠ¨å‰</span></span><br><span class="line"><span class="comment">        if (index == 0) &#123;</span></span><br><span class="line"><span class="comment">            this.head = new Node(value, this.head);</span></span><br><span class="line"><span class="comment">            return;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">// index ä¼ å…¥ 0 æ—¶ï¼Œè¿”å›çš„æ˜¯å“¨å…µ</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> findNode(index - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (prev != <span class="literal">null</span>) &#123;</span><br><span class="line">            prev.next = <span class="keyword">new</span> <span class="title class_">Node</span>(value, prev.next);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        æ”¹åŠ¨å‰</span></span><br><span class="line"><span class="comment">        if (index == 0) &#123;</span></span><br><span class="line"><span class="comment">            if (this.head != null) &#123;</span></span><br><span class="line"><span class="comment">                this.head = this.head.next;</span></span><br><span class="line"><span class="comment">                return;</span></span><br><span class="line"><span class="comment">            &#125; else &#123;</span></span><br><span class="line"><span class="comment">                throw illegalIndex(index);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">// index ä¼ å…¥ 0 æ—¶ï¼Œè¿”å›çš„æ˜¯å“¨å…µ</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> findNode(index - <span class="number">1</span>);</span><br><span class="line">        Node curr;</span><br><span class="line">        <span class="keyword">if</span> (prev != <span class="literal">null</span> &amp;&amp; (curr = prev.next) != <span class="literal">null</span>) &#123;</span><br><span class="line">            prev.next = curr.next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFirst</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        æ”¹åŠ¨å‰</span></span><br><span class="line"><span class="comment">        this.head = new Node(value, this.head);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"><span class="built_in">this</span>.head.next = <span class="keyword">new</span> <span class="title class_">Node</span>(value, <span class="built_in">this</span>.head.next);</span><br><span class="line">        <span class="comment">// ä¹Ÿå¯ä»¥è§†ä¸º insert çš„ç‰¹ä¾‹, å³ insert(0, value);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯¹äºåˆ é™¤ï¼Œå‰é¢è¯´äº†ã€æœ€åä¸€ä¸ª if å—å¯¹åº”ç€è‡³å°‘å¾—ä¸¤ä¸ªèŠ‚ç‚¹çš„æƒ…å†µã€‘ï¼Œç°åœ¨æœ‰äº†å“¨å…µï¼Œå°±å‡‘è¶³äº†ä¸¤ä¸ªèŠ‚ç‚¹</li></ul><h2 id="shuang-xiang-lian-biao-dai-shao-bing" id="åŒå‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰">åŒå‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoublyLinkedListSentinel</span> <span class="keyword">implements</span> <span class="title class_">Iterable</span>&lt;Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Node head;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Node tail;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DoublyLinkedListSentinel</span><span class="params">()</span> &#123;</span><br><span class="line">        head = <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="literal">null</span>, <span class="number">666</span>, <span class="literal">null</span>);</span><br><span class="line">        tail = <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="literal">null</span>, <span class="number">888</span>, <span class="literal">null</span>);</span><br><span class="line">        head.next = tail;</span><br><span class="line">        tail.prev = head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node <span class="title function_">findNode</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> head; p != tail; p = p.next, i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == index) &#123;</span><br><span class="line">                <span class="keyword">return</span> p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFirst</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        insert(<span class="number">0</span>, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeFirst</span><span class="params">()</span> &#123;</span><br><span class="line">        remove(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> tail.prev;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">added</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(prev, value, tail);</span><br><span class="line">        prev.next = added;</span><br><span class="line">        tail.prev = added;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeLast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">removed</span> <span class="operator">=</span> tail.prev;</span><br><span class="line">        <span class="keyword">if</span> (removed == head) &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> removed.prev;</span><br><span class="line">        prev.next = tail;</span><br><span class="line">        tail.prev = prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> findNode(index - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> prev.next;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">inserted</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(prev, value, next);</span><br><span class="line">        prev.next = inserted;</span><br><span class="line">        next.prev = inserted;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> findNode(index - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">removed</span> <span class="operator">=</span> prev.next;</span><br><span class="line">        <span class="keyword">if</span> (removed == tail) &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> removed.next;</span><br><span class="line">        prev.next = next;</span><br><span class="line">        next.prev = prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IllegalArgumentException <span class="title function_">illegalIndex</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">                String.format(<span class="string">&quot;index [%d] ä¸åˆæ³•%n&quot;</span>, index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;Integer&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> head.next;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != tail;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Integer <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> p.value;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        Node prev;</span><br><span class="line">        <span class="type">int</span> value;</span><br><span class="line">        Node next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(Node prev, <span class="type">int</span> value, Node next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.prev = prev;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="huan-xing-lian-biao-dai-shao-bing" id="ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰">ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰</h2><p>åŒå‘ç¯å½¢é“¾è¡¨å¸¦å“¨å…µï¼Œè¿™æ—¶å“¨å…µ<strong>æ—¢ä½œä¸ºå¤´ï¼Œä¹Ÿä½œä¸ºå°¾</strong></p><p><img src="https://s1.vika.cn/space/2023/03/30/23e1d2c35ed0429a9da8fd4965e16954" alt="image-20221229144232651"></p><p><img src="https://s1.vika.cn/space/2023/03/30/3ef23e65798843e3969100d6d4a17b32" alt="image-20221229143756065"></p><p><img src="./imgs/image-20221229153338425.png" alt="image-20221229153338425"></p><p><img src="./imgs/image-20221229154248800.png" alt="image-20221229154248800"></p><p>å‚è€ƒå®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoublyLinkedListSentinel</span> <span class="keyword">implements</span> <span class="title class_">Iterable</span>&lt;Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;Integer&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;&gt;() &#123;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> sentinel.next;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != sentinel;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Integer <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> p.value;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        Node prev;</span><br><span class="line">        <span class="type">int</span> value;</span><br><span class="line">        Node next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(Node prev, <span class="type">int</span> value, Node next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.prev = prev;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">sentinel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="literal">null</span>, -<span class="number">1</span>, <span class="literal">null</span>); <span class="comment">// å“¨å…µ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DoublyLinkedListSentinel</span><span class="params">()</span> &#123;</span><br><span class="line">        sentinel.next = sentinel;</span><br><span class="line">        sentinel.prev = sentinel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ åˆ°ç¬¬ä¸€ä¸ª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å¾…æ·»åŠ å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFirst</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> sentinel.next;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> sentinel;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">added</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(prev, value, next);</span><br><span class="line">        prev.next = added;</span><br><span class="line">        next.prev = added;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ åˆ°æœ€åä¸€ä¸ª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å¾…æ·»åŠ å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> sentinel.prev;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> sentinel;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">added</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(prev, value, next);</span><br><span class="line">        prev.next = added;</span><br><span class="line">        next.prev = added;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤ç¬¬ä¸€ä¸ª</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeFirst</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">removed</span> <span class="operator">=</span> sentinel.next;</span><br><span class="line">        <span class="keyword">if</span> (removed == sentinel) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;éæ³•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">a</span> <span class="operator">=</span> sentinel;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">b</span> <span class="operator">=</span> removed.next;</span><br><span class="line">        a.next = b;</span><br><span class="line">        b.prev = a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤æœ€åä¸€ä¸ª</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeLast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">removed</span> <span class="operator">=</span> sentinel.prev;</span><br><span class="line">        <span class="keyword">if</span> (removed == sentinel) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;éæ³•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">a</span> <span class="operator">=</span> removed.prev;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">b</span> <span class="operator">=</span> sentinel;</span><br><span class="line">        a.next = b;</span><br><span class="line">        b.prev = a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®å€¼åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;å‡å®š value åœ¨é“¾è¡¨ä¸­ä½œä¸º key, æœ‰å”¯ä¸€æ€§&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å¾…åˆ é™¤å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeByValue</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">removed</span> <span class="operator">=</span> findNodeByValue(value);</span><br><span class="line">        <span class="keyword">if</span> (removed != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> removed.prev;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> removed.next;</span><br><span class="line">            prev.next = next;</span><br><span class="line">            next.prev = prev;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node <span class="title function_">findNodeByValue</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> sentinel.next;</span><br><span class="line">        <span class="keyword">while</span> (p != sentinel) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p.value == value) &#123;</span><br><span class="line">                <span class="keyword">return</span> p;</span><br><span class="line">            &#125;</span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="di-gui">é€’å½’</h1><h2 id="gai-shu-2" id="æ¦‚è¿°-3">æ¦‚è¿°</h2><p><strong>å®šä¹‰</strong></p><p>è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œé€’å½’æ˜¯ä¸€ç§è§£å†³è®¡ç®—é—®é¢˜çš„æ–¹æ³•ï¼Œå…¶ä¸­è§£å†³æ–¹æ¡ˆå–å†³äºåŒä¸€ç±»é—®é¢˜çš„æ›´å°å­é›†</p><blockquote><p>In computer science, <strong>recursion</strong> is a method of solving a computational problem where the solution depends on solutions to smaller instances of the same problem.</p></blockquote><p>æ¯”å¦‚å•é“¾è¡¨é€’å½’éå†çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">f</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;before:&quot;</span> + node.value)</span><br><span class="line">    f(node.next);</span><br><span class="line">    println(<span class="string">&quot;after:&quot;</span> + node.value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ol><li>è‡ªå·±è°ƒç”¨è‡ªå·±ï¼Œå¦‚æœè¯´æ¯ä¸ªå‡½æ•°å¯¹åº”ç€ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè‡ªå·±è°ƒç”¨è‡ªå·±æ„å‘³ç€è§£å†³æ–¹æ¡ˆæ˜¯ä¸€æ ·çš„ï¼ˆæœ‰è§„å¾‹çš„ï¼‰</li><li>æ¯æ¬¡è°ƒç”¨ï¼Œå‡½æ•°å¤„ç†çš„æ•°æ®ä¼šè¾ƒä¸Šæ¬¡ç¼©å‡ï¼ˆå­é›†ï¼‰ï¼Œè€Œä¸”æœ€åä¼šç¼©å‡è‡³æ— éœ€ç»§ç»­é€’å½’</li><li>å†…å±‚å‡½æ•°è°ƒç”¨ï¼ˆå­é›†å¤„ç†ï¼‰å®Œæˆï¼Œå¤–å±‚å‡½æ•°æ‰èƒ½ç®—è°ƒç”¨å®Œæˆ</li></ol><p><strong>åŸç†</strong></p><p>å‡è®¾é“¾è¡¨ä¸­æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼Œvalue åˆ†åˆ«ä¸º 1ï¼Œ2ï¼Œ3ï¼Œä»¥ä¸Šä»£ç çš„æ‰§è¡Œæµç¨‹å°±ç±»ä¼¼äºä¸‹é¢çš„<strong>ä¼ªç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1 -&gt; 2 -&gt; 3 -&gt; null  f(1)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">f</span><span class="params">(Node node = <span class="number">1</span>)</span> &#123;</span><br><span class="line">    println(<span class="string">&quot;before:&quot;</span> + node.value) <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">f</span><span class="params">(Node node = <span class="number">2</span>)</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;before:&quot;</span> + node.value) <span class="comment">// 2</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">f</span><span class="params">(Node node = <span class="number">3</span>)</span> &#123;</span><br><span class="line">            println(<span class="string">&quot;before:&quot;</span> + node.value) <span class="comment">// 3</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">f</span><span class="params">(Node node = <span class="literal">null</span>)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(node == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            println(<span class="string">&quot;after:&quot;</span> + node.value) <span class="comment">// 3</span></span><br><span class="line">        &#125;</span><br><span class="line">        println(<span class="string">&quot;after:&quot;</span> + node.value) <span class="comment">// 2</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;after:&quot;</span> + node.value) <span class="comment">// 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ€è·¯</strong></p><ol><li>ç¡®å®šèƒ½å¦ä½¿ç”¨é€’å½’æ±‚è§£</li><li>æ¨å¯¼å‡ºé€’æ¨å…³ç³»ï¼Œå³çˆ¶é—®é¢˜ä¸å­é—®é¢˜çš„å…³ç³»ï¼Œä»¥åŠé€’å½’çš„ç»“æŸæ¡ä»¶</li></ol><p>ä¾‹å¦‚ä¹‹å‰éå†é“¾è¡¨çš„é€’æ¨å…³ç³»ä¸º<br>$$<br>f(n) =<br>\begin{cases}<br>åœæ­¢&amp; n = null \<br>f(n.next) &amp; n \neq null<br>\end{cases}<br>$$</p><ul><li>æ·±å…¥åˆ°æœ€é‡Œå±‚å«åš<strong>é€’</strong></li><li>ä»æœ€é‡Œå±‚å‡ºæ¥å«åš<strong>å½’</strong></li><li>åœ¨<strong>é€’</strong>çš„è¿‡ç¨‹ä¸­ï¼Œå¤–å±‚å‡½æ•°å†…çš„å±€éƒ¨å˜é‡ï¼ˆä»¥åŠæ–¹æ³•å‚æ•°ï¼‰å¹¶æœªæ¶ˆå¤±ï¼Œ<strong>å½’</strong>çš„æ—¶å€™è¿˜å¯ä»¥ç”¨åˆ°</li></ul><h2 id="dan-lu-di-gui-single-recursion" id="å•è·¯é€’å½’-Single-Recursion">å•è·¯é€’å½’ Single Recursion</h2><p><strong>E01. é˜¶ä¹˜</strong></p><p>ç”¨é€’å½’æ–¹æ³•æ±‚é˜¶ä¹˜</p><ul><li><p>é˜¶ä¹˜çš„å®šä¹‰ $n!= 1â‹…2â‹…3â‹¯(n-2)â‹…(n-1)â‹…n$ï¼Œå…¶ä¸­ $n$ ä¸ºè‡ªç„¶æ•°ï¼Œå½“ç„¶ $0! = 1$</p></li><li><p>é€’æ¨å…³ç³»</p></li></ul><p>$$<br>f(n) =<br>\begin{cases}<br>1 &amp; n = 1\<br>n * f(n-1) &amp; n &gt; 1<br>\end{cases}<br>$$</p><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n * f(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹†è§£<strong>ä¼ªç </strong>å¦‚ä¸‹ï¼Œå‡è®¾ n åˆå§‹å€¼ä¸º 3</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">f(<span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">3</span>) &#123; <span class="comment">// è§£å†³ä¸äº†,é€’</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span> * f(<span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">2</span>) &#123; <span class="comment">// è§£å†³ä¸äº†,ç»§ç»­é€’</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * f(<span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (n == <span class="number">1</span>) &#123; <span class="comment">// å¯ä»¥è§£å†³, å¼€å§‹å½’</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>E02. åå‘æ‰“å°å­—ç¬¦ä¸²</strong></p><p>ç”¨é€’å½’åå‘æ‰“å°å­—ç¬¦ä¸²ï¼Œn ä¸ºå­—ç¬¦åœ¨æ•´ä¸ªå­—ç¬¦ä¸² str ä¸­çš„ç´¢å¼•ä½ç½®</p><ul><li><strong>é€’</strong>ï¼šn ä» 0 å¼€å§‹ï¼Œæ¯æ¬¡ n + 1ï¼Œä¸€ç›´é€’åˆ° n == str.length() - 1</li><li><strong>å½’</strong>ï¼šä» n == str.length() å¼€å§‹å½’ï¼Œä»å½’æ‰“å°ï¼Œè‡ªç„¶æ˜¯é€†åºçš„</li></ul><p>é€’æ¨å…³ç³»<br>$$<br>f(n) =<br>\begin{cases}<br>åœæ­¢ &amp; n = str.length() \<br>f(n+1) &amp; 0 \leq n \leq str.length() - 1<br>\end{cases}<br>$$<br>ä»£ç ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reversePrint</span><span class="params">(String str, <span class="type">int</span> index)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (index == str.length()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    reversePrint(str, index + <span class="number">1</span>);</span><br><span class="line">    System.out.println(str.charAt(index));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹†è§£<strong>ä¼ªç </strong>å¦‚ä¸‹ï¼Œå‡è®¾å­—ç¬¦ä¸²ä¸º â€œabcâ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">reversePrint</span><span class="params">(String str, <span class="type">int</span> index = <span class="number">0</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">reversePrint</span><span class="params">(String str, <span class="type">int</span> index = <span class="number">1</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">reversePrint</span><span class="params">(String str, <span class="type">int</span> index = <span class="number">2</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">reversePrint</span><span class="params">(String str, <span class="type">int</span> index = <span class="number">3</span>)</span> &#123; </span><br><span class="line">                <span class="keyword">if</span> (index == str.length()) &#123;</span><br><span class="line">                    <span class="keyword">return</span>; <span class="comment">// å¼€å§‹å½’</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(str.charAt(index)); <span class="comment">// æ‰“å° c</span></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(str.charAt(index)); <span class="comment">// æ‰“å° b</span></span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(str.charAt(index)); <span class="comment">// æ‰“å° a</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="duo-lu-di-gui-multi-recursion" id="å¤šè·¯é€’å½’-Multi-Recursion">å¤šè·¯é€’å½’ Multi Recursion</h2><p><strong>E01. æ–æ³¢é‚£å¥‘æ•°åˆ—</strong></p><ul><li>ä¹‹å‰çš„ä¾‹å­æ˜¯æ¯ä¸ªé€’å½’å‡½æ•°åªåŒ…å«ä¸€ä¸ªè‡ªèº«çš„è°ƒç”¨ï¼Œè¿™ç§°ä¹‹ä¸º single recursion</li><li>å¦‚æœæ¯ä¸ªé€’å½’å‡½æ•°ä¾‹åŒ…å«å¤šä¸ªè‡ªèº«è°ƒç”¨ï¼Œç§°ä¹‹ä¸º multi recursion</li></ul><p><strong>é€’æ¨å…³ç³»</strong><br>$$<br>f(n) =<br>\begin{cases}<br>0 &amp; n=0 \<br>1 &amp; n=1 \<br>f(n-1) + f(n-2) &amp; n&gt;1<br>\end{cases}<br>$$</p><p>ä¸‹é¢çš„è¡¨æ ¼åˆ—å‡ºäº†æ•°åˆ—çš„å‰å‡ é¡¹</p><table><thead><tr><th><em>F</em>0</th><th><em>F</em>1</th><th><em>F</em>2</th><th><em>F</em>3</th><th><em>F</em>4</th><th><em>F</em>5</th><th><em>F</em>6</th><th><em>F</em>7</th><th><em>F</em>8</th><th><em>F</em>9</th><th><em>F</em>10</th><th><em>F</em>11</th><th><em>F</em>12</th><th><em>F</em>13</th></tr></thead><tbody><tr><td>0</td><td>1</td><td>1</td><td>2</td><td>3</td><td>5</td><td>8</td><td>13</td><td>21</td><td>34</td><td>55</td><td>89</td><td>144</td><td>233</td></tr></tbody></table><p><strong>å®ç°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> f(n - <span class="number">1</span>) + f(n - <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œæµç¨‹</strong></p><p><img src="https://s1.vika.cn/space/2023/03/30/421c4ac4250a47af97dab4417e1b643e" alt=""></p><ul><li>ç»¿è‰²ä»£è¡¨æ­£åœ¨æ‰§è¡Œï¼ˆå¯¹åº”é€’ï¼‰ï¼Œç°è‰²ä»£è¡¨æ‰§è¡Œç»“æŸï¼ˆå¯¹åº”å½’ï¼‰</li><li>é€’ä¸åˆ°å¤´ï¼Œä¸èƒ½å½’ï¼Œå¯¹åº”ç€æ·±åº¦ä¼˜å…ˆæœç´¢</li></ul><p><strong>æ—¶é—´å¤æ‚åº¦</strong></p><ul><li>é€’å½’çš„æ¬¡æ•°ä¹Ÿç¬¦åˆæ–æ³¢é‚£å¥‘è§„å¾‹ï¼Œ$2 * f(n+1)-1$</li><li>æ—¶é—´å¤æ‚åº¦æ¨å¯¼è¿‡ç¨‹<ul><li>æ–æ³¢é‚£å¥‘é€šé¡¹å…¬å¼ $f(n) = \frac{1}{\sqrt{5}}*({\frac{1+\sqrt{5}}{2}}^n - {\frac{1-\sqrt{5}}{2}}^n)$</li><li>ç®€åŒ–ä¸ºï¼š$f(n) = \frac{1}{2.236}*({1.618}^n - {(-0.618)}^n)$</li><li>å¸¦å…¥é€’å½’æ¬¡æ•°å…¬å¼ $2*\frac{1}{2.236}*({1.618}^{n+1} - {(-0.618)}^{n+1})-1$</li><li>æ—¶é—´å¤æ‚åº¦ä¸º $\Theta(1.618^n)$</li></ul></li></ul><blockquote><ol><li>æ›´å¤š Fibonacci å‚è€ƒ[^8][^9][^10]</li><li>ä»¥ä¸Šæ—¶é—´å¤æ‚åº¦åˆ†æï¼Œæœªè€ƒè™‘å¤§æ•°ç›¸åŠ çš„å› ç´ </li></ol></blockquote><p><strong>å˜ä½“1 - å…”å­é—®é¢˜[^8]</strong></p><p><img src="https://s1.vika.cn/space/2023/03/30/c012cb14c655421aa083563c51d69788" alt="image-20221110155655827"></p><ul><li>ç¬¬ä¸€ä¸ªæœˆï¼Œæœ‰ä¸€å¯¹æœªæˆç†Ÿçš„å…”å­ï¼ˆé»‘è‰²ï¼Œæ³¨æ„å›¾ä¸­ä¸ªå¤´è¾ƒå°ï¼‰</li><li>ç¬¬äºŒä¸ªæœˆï¼Œå®ƒä»¬æˆç†Ÿ</li><li>ç¬¬ä¸‰ä¸ªæœˆï¼Œå®ƒä»¬èƒ½äº§ä¸‹ä¸€å¯¹æ–°çš„å°å…”å­ï¼ˆè“è‰²ï¼‰</li><li>æ‰€æœ‰å…”å­éµå¾ªç›¸åŒè§„å¾‹ï¼Œæ±‚ç¬¬ $n$ ä¸ªæœˆçš„å…”å­æ•°</li></ul><p><strong>åˆ†æ</strong></p><p>å…”å­é—®é¢˜å¦‚ä½•ä¸æ–æ³¢é‚£å¥‘è”ç³»èµ·æ¥å‘¢ï¼Ÿè®¾ç¬¬ n ä¸ªæœˆå…”å­æ•°ä¸º $f(n)$</p><ul><li>$f(n)$ = ä¸Šä¸ªæœˆå…”å­æ•° + æ–°ç”Ÿçš„å°å…”å­æ•°</li><li>è€Œã€æ–°ç”Ÿçš„å°å…”å­æ•°ã€‘å®é™…å°±æ˜¯ã€ä¸Šä¸ªæœˆæˆç†Ÿçš„å…”å­æ•°ã€‘</li><li>å› ä¸ºéœ€è¦ä¸€ä¸ªæœˆå…”å­å°±æˆç†Ÿï¼Œæ‰€ä»¥ã€ä¸Šä¸ªæœˆæˆç†Ÿçš„å…”å­æ•°ã€‘ä¹Ÿå°±æ˜¯ã€ä¸Šä¸Šä¸ªæœˆçš„å…”å­æ•°ã€‘</li><li>ä¸Šä¸ªæœˆå…”å­æ•°ï¼Œå³ $f(n-1)$</li><li>ä¸Šä¸Šä¸ªæœˆçš„å…”å­æ•°ï¼Œå³ $f(n-2)$</li></ul><p>å› æ­¤æœ¬è´¨è¿˜æ˜¯æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œåªæ˜¯ä»å…¶ç¬¬ä¸€é¡¹å¼€å§‹</p><p><strong>å˜ä½“2 - é’è›™çˆ¬æ¥¼æ¢¯</strong></p><ul><li>æ¥¼æ¢¯æœ‰ $n$ é˜¶</li><li>é’è›™è¦çˆ¬åˆ°æ¥¼é¡¶ï¼Œå¯ä»¥ä¸€æ¬¡è·³ä¸€é˜¶ï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡è·³ä¸¤é˜¶</li><li>åªèƒ½å‘ä¸Šè·³ï¼Œé—®æœ‰å¤šå°‘ç§è·³æ³•</li></ul><p><strong>åˆ†æ</strong></p><table><thead><tr><th>n</th><th>è·³æ³•</th><th>è§„å¾‹</th></tr></thead><tbody><tr><td>1</td><td>(1)</td><td>æš‚æ—¶çœ‹ä¸å‡º</td></tr><tr><td>2</td><td>(1,1)  (2)</td><td>æš‚æ—¶çœ‹ä¸å‡º</td></tr><tr><td>3</td><td>(1,1,1)  (1,2)  (2,1)</td><td>æš‚æ—¶çœ‹ä¸å‡º</td></tr><tr><td>4</td><td>(1,1,1,1)    (1,2,1)    (2,1,1)<br />(1,1,2)  (2,2)</td><td>æœ€åä¸€è·³ï¼Œè·³ä¸€ä¸ªå°é˜¶çš„ï¼ŒåŸºäºf(3)<br />æœ€åä¸€è·³ï¼Œè·³ä¸¤ä¸ªå°é˜¶çš„ï¼ŒåŸºäºf(2)</td></tr><tr><td>5</td><td>â€¦</td><td>â€¦</td></tr></tbody></table><ul><li><p>å› æ­¤æœ¬è´¨ä¸Šè¿˜æ˜¯æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œåªæ˜¯ä»å…¶ç¬¬äºŒé¡¹å¼€å§‹</p></li><li><p>å¯¹åº” leetcode é¢˜ç›® <a href="https://leetcode.cn/problems/climbing-stairs/">70. çˆ¬æ¥¼æ¢¯ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p></li></ul><h2 id="di-gui-you-hua-ji-yi-fa" id="é€’å½’ä¼˜åŒ–-è®°å¿†æ³•">é€’å½’ä¼˜åŒ–-è®°å¿†æ³•</h2><p>ä¸Šè¿°ä»£ç å­˜åœ¨å¾ˆå¤šé‡å¤çš„è®¡ç®—ï¼Œä¾‹å¦‚æ±‚ $f(5)$ é€’å½’åˆ†è§£è¿‡ç¨‹</p><p><img src="https://s1.vika.cn/space/2023/03/30/adb5c89b7ad34d3d8c4a3f3bf6e87b83" alt="image-20221207092417933"></p><p>å¯ä»¥çœ‹åˆ°ï¼ˆé¢œè‰²ç›¸åŒçš„æ˜¯é‡å¤çš„ï¼‰ï¼š</p><ul><li>$f(3)$ é‡å¤äº† 2 æ¬¡</li><li>$f(2)$ é‡å¤äº† 3 æ¬¡</li><li>$f(1)$ é‡å¤äº† 5 æ¬¡</li><li>$f(0)$ é‡å¤äº† 3 æ¬¡</li></ul><p>éšç€  $n$ çš„å¢å¤§ï¼Œé‡å¤æ¬¡æ•°éå¸¸å¯è§‚ï¼Œå¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿ</p><p><strong>Memoization</strong> è®°å¿†æ³•ï¼ˆä¹Ÿç§°å¤‡å¿˜å½•ï¼‰æ˜¯ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œé€šè¿‡å­˜å‚¨å‡½æ•°è°ƒç”¨ç»“æœï¼ˆé€šå¸¸æ¯”è¾ƒæ˜‚è´µï¼‰ï¼Œå½“å†æ¬¡å‡ºç°ç›¸åŒçš„è¾“å…¥ï¼ˆå­é—®é¢˜ï¼‰æ—¶ï¼Œå°±èƒ½å®ç°åŠ é€Ÿæ•ˆæœï¼Œæ”¹è¿›åçš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">13</span>;</span><br><span class="line">    <span class="type">int</span>[] cache = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">    Arrays.fill(cache, -<span class="number">1</span>);</span><br><span class="line">    cache[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    cache[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    System.out.println(f(cache, n));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span>[] cache, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cache[n] != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> cache[n];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cache[n] = f(cache, n - <span class="number">1</span>) + f(cache, n - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> cache[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–åçš„å›¾ç¤ºï¼Œåªè¦ç»“æœè¢«ç¼“å­˜ï¼Œå°±<strong>ä¸ä¼šæ‰§è¡Œå…¶å­é—®é¢˜</strong></p><p><img src="https://s1.vika.cn/space/2023/03/30/8550bb0685024a24981cd6d3c790011f" alt="image-20221213173225807"></p><ul><li>æ”¹è¿›åçš„æ—¶é—´å¤æ‚åº¦ä¸º $O(n)$</li><li>è¯·è‡ªè¡ŒéªŒè¯æ”¹è¿›åçš„æ•ˆæœ</li><li>è¯·è‡ªè¡Œåˆ†ææ”¹è¿›åçš„ç©ºé—´å¤æ‚åº¦</li></ul><blockquote><p><strong>æ³¨æ„</strong></p><ol><li>è®°å¿†æ³•æ˜¯åŠ¨æ€è§„åˆ’çš„ä¸€ç§æƒ…å†µï¼Œå¼ºè°ƒçš„æ˜¯è‡ªé¡¶å‘ä¸‹çš„è§£å†³</li><li>è®°å¿†æ³•çš„æœ¬è´¨æ˜¯ç©ºé—´æ¢æ—¶é—´</li></ol></blockquote><h2 id="di-gui-you-hua-wei-di-gui" id="é€’å½’ä¼˜åŒ–-å°¾é€’å½’">é€’å½’ä¼˜åŒ–-å°¾é€’å½’</h2><p><strong>çˆ†æ ˆ</strong></p><p>ç”¨é€’å½’åš $n + (n-1) + (n-2) â€¦ + 1$</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">sum</span><span class="params">(<span class="type">long</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n + sum(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘çš„æœºå™¨ä¸Š  $n = 12000$ æ—¶ï¼Œçˆ†æ ˆäº†</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Exception <span class="built_in">in</span> thread <span class="string">&quot;main&quot;</span> java.lang.StackOverflowError</span><br><span class="line"><span class="built_in">at</span> <span class="keyword">Test</span>.<span class="built_in">sum</span>(<span class="keyword">Test</span>.java:<span class="number">10</span>)</span><br><span class="line"><span class="built_in">at</span> <span class="keyword">Test</span>.<span class="built_in">sum</span>(<span class="keyword">Test</span>.java:<span class="number">10</span>)</span><br><span class="line"><span class="built_in">at</span> <span class="keyword">Test</span>.<span class="built_in">sum</span>(<span class="keyword">Test</span>.java:<span class="number">10</span>)</span><br><span class="line"><span class="built_in">at</span> <span class="keyword">Test</span>.<span class="built_in">sum</span>(<span class="keyword">Test</span>.java:<span class="number">10</span>)</span><br><span class="line"><span class="built_in">at</span> <span class="keyword">Test</span>.<span class="built_in">sum</span>(<span class="keyword">Test</span>.java:<span class="number">10</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ˜¯éœ€è¦æ¶ˆè€—ä¸€å®šçš„æ ˆå†…å­˜çš„ï¼Œè¿™äº›å†…å­˜ç”¨æ¥å­˜å‚¨æ–¹æ³•å‚æ•°ã€æ–¹æ³•å†…å±€éƒ¨å˜é‡ã€è¿”å›åœ°å€ç­‰ç­‰</li><li>æ–¹æ³•è°ƒç”¨å ç”¨çš„å†…å­˜éœ€è¦ç­‰åˆ°<strong>æ–¹æ³•ç»“æŸæ—¶</strong>æ‰ä¼šé‡Šæ”¾</li><li>è€Œé€’å½’è°ƒç”¨æˆ‘ä»¬ä¹‹å‰è®²è¿‡ï¼Œä¸åˆ°æœ€æ·±ä¸ä¼šå›å¤´ï¼Œæœ€å†…å±‚æ–¹æ³•æ²¡å®Œæˆä¹‹å‰ï¼Œå¤–å±‚æ–¹æ³•éƒ½ç»“æŸä¸äº†<ul><li>ä¾‹å¦‚ï¼Œ$sum(3)$ è¿™ä¸ªæ–¹æ³•å†…æœ‰ä¸ªéœ€è¦æ‰§è¡Œ $3 + sum(2)$ï¼Œ$sum(2)$ æ²¡è¿”å›å‰ï¼ŒåŠ å·å‰é¢çš„ $3$ ä¸èƒ½é‡Šæ”¾</li><li>çœ‹ä¸‹é¢ä¼ªç </li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">sum</span><span class="params">(<span class="type">long</span> n = <span class="number">3</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span> + <span class="type">long</span> <span class="title function_">sum</span><span class="params">(<span class="type">long</span> n = <span class="number">2</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> + <span class="type">long</span> <span class="title function_">sum</span><span class="params">(<span class="type">long</span> n = <span class="number">1</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å°¾è°ƒç”¨</strong></p><p>å¦‚æœå‡½æ•°çš„æœ€åä¸€æ­¥æ˜¯è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆç§°ä¸ºå°¾è°ƒç”¨ï¼Œä¾‹å¦‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">b</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ä¸‰æ®µä»£ç <strong>ä¸èƒ½</strong>å«åšå°¾è°ƒç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> c = <span class="title function_">b</span>()</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å› ä¸ºæœ€åä¸€æ­¥å¹¶éè°ƒç”¨å‡½æ•°</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">b</span>() + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æœ€åä¸€æ­¥æ‰§è¡Œçš„æ˜¯åŠ æ³•</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">b</span>() + x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æœ€åä¸€æ­¥æ‰§è¡Œçš„æ˜¯åŠ æ³•</li></ul><p><strong>ä¸€äº›è¯­è¨€</strong>[^11]çš„ç¼–è¯‘å™¨èƒ½å¤Ÿå¯¹å°¾è°ƒç”¨åšä¼˜åŒ–ï¼Œä¾‹å¦‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// åšå‰é¢çš„äº‹</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">b</span>() </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// åšå‰é¢çš„äº‹</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">c</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">c</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1000</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">a</span>()</span><br></pre></td></tr></table></figure><p>æ²¡ä¼˜åŒ–ä¹‹å‰çš„<strong>ä¼ªç </strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">c</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1000</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–å<strong>ä¼ªç </strong>å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">a</span>()</span><br><span class="line"><span class="title function_">b</span>()</span><br><span class="line"><span class="title function_">c</span>()</span><br></pre></td></tr></table></figure><p>ä¸ºä½•å°¾é€’å½’æ‰èƒ½ä¼˜åŒ–ï¼Ÿ</p><p>è°ƒç”¨ a æ—¶</p><ul><li>a è¿”å›æ—¶å‘ç°ï¼šæ²¡ä»€ä¹ˆå¯ç•™ç»™ b çš„ï¼Œå°†æ¥è¿”å›çš„ç»“æœ b æä¾›å°±å¯ä»¥äº†ï¼Œç”¨ä¸ç€æˆ‘ a äº†ï¼Œæˆ‘çš„å†…å­˜å°±å¯ä»¥é‡Šæ”¾</li></ul><p>è°ƒç”¨ b æ—¶</p><ul><li>b è¿”å›æ—¶å‘ç°ï¼šæ²¡ä»€ä¹ˆå¯ç•™ç»™ c çš„ï¼Œå°†æ¥è¿”å›çš„ç»“æœ c æä¾›å°±å¯ä»¥äº†ï¼Œç”¨ä¸ç€æˆ‘ b äº†ï¼Œæˆ‘çš„å†…å­˜å°±å¯ä»¥é‡Šæ”¾</li></ul><p>å¦‚æœè°ƒç”¨ a æ—¶</p><ul><li>ä¸æ˜¯å°¾è°ƒç”¨ï¼Œä¾‹å¦‚ return b() + 1ï¼Œé‚£ä¹ˆ a å°±ä¸èƒ½æå‰ç»“æŸï¼Œå› ä¸ºå®ƒè¿˜å¾—åˆ©ç”¨ b çš„ç»“æœåšåŠ æ³•</li></ul><p><strong>å°¾é€’å½’</strong></p><p>å°¾é€’å½’æ˜¯å°¾è°ƒç”¨çš„ä¸€ç§ç‰¹ä¾‹ï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€æ­¥æ‰§è¡Œçš„æ˜¯åŒä¸€ä¸ªå‡½æ•°</p><p><strong>å°¾é€’å½’é¿å…çˆ†æ ˆ</strong></p><p>å®‰è£… Scala</p><p><img src="https://s1.vika.cn/space/2023/03/30/49871e0c61a644e2a14b51a970436ad2" alt="image-20221111122709227"></p><p>Scala å…¥é—¨</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;Hello Scala&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Scala æ˜¯ java çš„è¿‘äº²ï¼Œjava ä¸­çš„ç±»éƒ½å¯ä»¥æ‹¿æ¥é‡ç”¨</li><li>ç±»å‹æ˜¯æ”¾åœ¨å˜é‡åé¢çš„</li><li>Unit è¡¨ç¤ºæ— è¿”å›å€¼ï¼Œç±»ä¼¼äº void</li><li>ä¸éœ€è¦ä»¥åˆ†å·ä½œä¸ºç»“å°¾ï¼Œå½“ç„¶åŠ ä¸Šä¹Ÿå¯¹</li></ul><p>è¿˜æ˜¯å…ˆå†™ä¸€ä¸ªä¼šçˆ†æ ˆçš„å‡½æ•°</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span></span>(n: <span class="type">Long</span>): <span class="type">Long</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n + sum(n - <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Scala æœ€åä¸€è¡Œä»£ç è‹¥ä½œä¸ºè¿”å›å€¼ï¼Œå¯ä»¥çœç•¥ return</li></ul><p>ä¸å‡ºæ‰€æ–™ï¼Œåœ¨ $n = 11000$ æ—¶ï¼Œè¿˜æ˜¯å‡ºäº†å¼‚å¸¸</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">println(sum(<span class="number">11000</span>))</span><br><span class="line"></span><br><span class="line"><span class="type">Exception</span> in thread <span class="string">&quot;main&quot;</span> java.lang.<span class="type">StackOverflowError</span></span><br><span class="line">at <span class="type">Main</span>$.sum(<span class="type">Main</span>.scala:<span class="number">25</span>)</span><br><span class="line">at <span class="type">Main</span>$.sum(<span class="type">Main</span>.scala:<span class="number">25</span>)</span><br><span class="line">at <span class="type">Main</span>$.sum(<span class="type">Main</span>.scala:<span class="number">25</span>)</span><br><span class="line">at <span class="type">Main</span>$.sum(<span class="type">Main</span>.scala:<span class="number">25</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºä»¥ä¸Šä»£ç ï¼Œè¿˜ä¸æ˜¯å°¾è°ƒç”¨ï¼Œè¦æƒ³æˆä¸ºå°¾è°ƒç”¨ï¼Œé‚£ä¹ˆï¼š</p><ol><li>æœ€åä¸€è¡Œä»£ç ï¼Œå¿…é¡»æ˜¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨</li><li>å†…å±‚å‡½æ•°å¿…é¡»<strong>æ‘†è„±</strong>ä¸å¤–å±‚å‡½æ•°çš„å…³ç³»ï¼Œå†…å±‚å‡½æ•°<strong>æ‰§è¡Œå</strong>ä¸ä¾èµ–äºå¤–å±‚çš„å˜é‡æˆ–å¸¸é‡</li></ol><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span></span>(n: <span class="type">Long</span>): <span class="type">Long</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n + sum(n - <span class="number">1</span>)  <span class="comment">// ä¾èµ–äºå¤–å±‚å‡½æ•°çš„ n å˜é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä½•è®©å®ƒæ‰§è¡Œåå°±æ‘†è„±å¯¹ n çš„ä¾èµ–å‘¢ï¼Ÿ</p><ul><li>ä¸èƒ½ç­‰é€’å½’å›æ¥å†åšåŠ æ³•ï¼Œé‚£æ ·å°±å¿…é¡»ä¿ç•™å¤–å±‚çš„ n</li><li>æŠŠ n å½“åšå†…å±‚å‡½æ•°çš„ä¸€ä¸ªå‚æ•°ä¼ è¿›å»ï¼Œè¿™æ—¶ n å°±å±äºå†…å±‚å‡½æ•°äº†</li><li>ä¼ å‚æ—¶å°±å®Œæˆç´¯åŠ , ä¸å¿…ç­‰å›æ¥æ—¶ç´¯åŠ </li></ul><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>(<span class="built_in">n</span> - <span class="number">1</span>, <span class="built_in">n</span> + ç´¯åŠ å™¨)</span><br></pre></td></tr></table></figure><p>æ”¹å†™åä»£ç å¦‚ä¸‹</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@tailrec</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span></span>(n: <span class="type">Long</span>, accumulator: <span class="type">Long</span>): <span class="type">Long</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + accumulator</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> sum(n - <span class="number">1</span>, n + accumulator)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>accumulator ä½œä¸ºç´¯åŠ å™¨</li><li>@tailrec æ³¨è§£æ˜¯ scala æä¾›çš„ï¼Œç”¨æ¥æ£€æŸ¥æ–¹æ³•æ˜¯å¦ç¬¦åˆå°¾é€’å½’</li><li>è¿™å› sum(10000000, 0) ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œæ‰“å° 50000005000000</li></ul><p>æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼Œä»¥<strong>ä¼ªç </strong>è¡¨ç¤º $sum(4, 0)$</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¦–æ¬¡è°ƒç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span></span>(n = <span class="number">4</span>, accumulator = <span class="number">0</span>): <span class="type">Long</span> = &#123;</span><br><span class="line">    <span class="keyword">return</span> sum(<span class="number">4</span> - <span class="number">1</span>, <span class="number">4</span> + accumulator)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥ä¸‹æ¥è°ƒç”¨å†…å±‚ sum, ä¼ å‚æ—¶å°±å®Œæˆäº†ç´¯åŠ , ä¸å¿…ç­‰å›æ¥æ—¶ç´¯åŠ ï¼Œå½“å†…å±‚ sum è°ƒç”¨åï¼Œå¤–å±‚ sum ç©ºé—´æ²¡å¿…è¦ä¿ç•™</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span></span>(n = <span class="number">3</span>, accumulator = <span class="number">4</span>): <span class="type">Long</span> = &#123;</span><br><span class="line">    <span class="keyword">return</span> sum(<span class="number">3</span> - <span class="number">1</span>, <span class="number">3</span> + accumulator)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§ç»­è°ƒç”¨å†…å±‚ sum</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span></span>(n = <span class="number">2</span>, accumulator = <span class="number">7</span>): <span class="type">Long</span> = &#123;</span><br><span class="line">    <span class="keyword">return</span> sum(<span class="number">2</span> - <span class="number">1</span>, <span class="number">2</span> + accumulator)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§ç»­è°ƒç”¨å†…å±‚ sum, è¿™æ˜¯æœ€åçš„ sum è°ƒç”¨å®Œå°±è¿”å›æœ€åç»“æœ 10, å‰é¢æ‰€æœ‰å…¶å®ƒ sum çš„ç©ºé—´æ—©å·²é‡Šæ”¾</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span></span>(n = <span class="number">1</span>, accumulator = <span class="number">9</span>): <span class="type">Long</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span> == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + accumulator</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬è´¨ä¸Šï¼Œå°¾é€’å½’ä¼˜åŒ–æ˜¯å°†å‡½æ•°çš„<strong>é€’å½’</strong>è°ƒç”¨ï¼Œå˜æˆäº†å‡½æ•°çš„<strong>å¾ªç¯</strong>è°ƒç”¨</p><p><strong>æ”¹å¾ªç¯é¿å…çˆ†æ ˆ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">100000000</span>;</span><br><span class="line">    <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> n; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">        sum += i;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="di-gui-shi-jian-fu-za-du-master-theorem-14" id="é€’å½’æ—¶é—´å¤æ‚åº¦-Master-theorem-14">é€’å½’æ—¶é—´å¤æ‚åº¦-Master theorem[^14]</h2><p>è‹¥æœ‰é€’å½’å¼<br>$$<br>T(n) = aT(\frac{n}{b}) + f(n)<br>$$<br>å…¶ä¸­</p><ul><li>$T(n)$ æ˜¯é—®é¢˜çš„è¿è¡Œæ—¶é—´ï¼Œ$n$ æ˜¯æ•°æ®è§„æ¨¡</li><li>$a$ æ˜¯å­é—®é¢˜ä¸ªæ•°</li><li>$T(\frac{n}{b})$ æ˜¯å­é—®é¢˜è¿è¡Œæ—¶é—´ï¼Œæ¯ä¸ªå­é—®é¢˜è¢«æ‹†æˆåŸé—®é¢˜æ•°æ®è§„æ¨¡çš„ $\frac{n}{b}$</li><li>$f(n)$ æ˜¯é™¤é€’å½’å¤–æ‰§è¡Œçš„è®¡ç®—</li></ul><p>ä»¤ $x = \log_{b}{a}$ï¼Œå³ $x = \log_{å­é—®é¢˜ç¼©å°å€æ•°}{å­é—®é¢˜ä¸ªæ•°}$</p><p>é‚£ä¹ˆ<br>$$<br>T(n) =<br>\begin{cases}<br>\Theta(n^x) &amp; f(n) = O(n^c) å¹¶ä¸” c \lt x\<br>\Theta(n^x\log{n}) &amp; f(n) = \Theta(n^x)\<br>\Theta(n^c) &amp; f(n) = \Omega(n^c) å¹¶ä¸” c \gt x<br>\end{cases}<br>$$</p><p><strong>ä¾‹1</strong></p><p>$T(n) = 2T(\frac{n}{2}) + n^4$</p><ul><li>æ­¤æ—¶ $x = 1 &lt; 4$ï¼Œç”±åè€…å†³å®šæ•´ä¸ªæ—¶é—´å¤æ‚åº¦ $\Theta(n^4)$</li><li>å¦‚æœè§‰å¾—å¯¹æ•°ä¸å¥½ç®—ï¼Œå¯ä»¥æ¢ä¸ºæ±‚ã€$b$ çš„å‡ æ¬¡æ–¹èƒ½ç­‰äº $a$ã€‘</li></ul><p><strong>ä¾‹2</strong></p><p>$T(n) = T(\frac{7n}{10}) + n$</p><ul><li>$a=1, b=\frac{10}{7}, x=0, c=1$</li><li>æ­¤æ—¶ $x = 0 &lt; 1$ï¼Œç”±åè€…å†³å®šæ•´ä¸ªæ—¶é—´å¤æ‚åº¦ $\Theta(n)$</li></ul><p><strong>ä¾‹3</strong></p><p>$T(n) = 16T(\frac{n}{4}) + n^2$</p><ul><li>$a=16, b=4, x=2, c=2$</li><li>æ­¤æ—¶ $x=2 = c$ï¼Œæ—¶é—´å¤æ‚åº¦ $\Theta(n^2 \log{n})$</li></ul><p><strong>ä¾‹4</strong></p><p>$T(n)=7T(\frac{n}{3}) + n^2$</p><ul><li>$a=7, b=3, x=1.?, c=2$</li><li>æ­¤æ—¶ $x = \log_{3}{7} &lt; 2$ï¼Œç”±åè€…å†³å®šæ•´ä¸ªæ—¶é—´å¤æ‚åº¦ $\Theta(n^2)$</li></ul><p><strong>ä¾‹5</strong></p><p>$T(n) = 7T(\frac{n}{2}) + n^2$</p><ul><li>$a=7, b=2, x=2.?, c=2$</li><li>æ­¤æ—¶ $x = log_2{7} &gt; 2$ï¼Œç”±å‰è€…å†³å®šæ•´ä¸ªæ—¶é—´å¤æ‚åº¦ $\Theta(n^{\log_2{7}})$</li></ul><p><strong>ä¾‹6</strong></p><p>$T(n) = 2T(\frac{n}{4}) + \sqrt{n}$</p><ul><li>$a=2, b=4, x = 0.5, c=0.5$</li><li>æ­¤æ—¶ $x = 0.5 = c$ï¼Œæ—¶é—´å¤æ‚åº¦ $\Theta(\sqrt{n}\ \log{n})$</li></ul><p><strong>ä¾‹7. äºŒåˆ†æŸ¥æ‰¾é€’å½’</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> target, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; j) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (i + j) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (target &lt; a[m]) &#123;</span><br><span class="line">        <span class="keyword">return</span> f(a, target, i, m - <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[m] &lt; target) &#123;</span><br><span class="line">        <span class="keyword">return</span> f(a, target, m + <span class="number">1</span>, j);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å­é—®é¢˜ä¸ªæ•° $a = 1$</li><li>å­é—®é¢˜æ•°æ®è§„æ¨¡ç¼©å°å€æ•° $b = 2$</li><li>é™¤é€’å½’å¤–æ‰§è¡Œçš„è®¡ç®—æ˜¯å¸¸æ•°çº§ $c=0$</li></ul><p>$T(n) = T(\frac{n}{2}) + n^0$</p><ul><li>æ­¤æ—¶ $x=0 = c$ï¼Œæ—¶é—´å¤æ‚åº¦ $\Theta(\log{n})$</li></ul><p><strong>ä¾‹8. å½’å¹¶æ’åºé€’å½’</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">void split(B[], i, j, A[])</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (j - i &lt;= <span class="number">1</span>)                    </span><br><span class="line">        <span class="keyword">return</span>;                                </span><br><span class="line">    m = (i + j) / <span class="number">2</span>;             </span><br><span class="line">    </span><br><span class="line">    // é€’å½’</span><br><span class="line">    split(A, i, m, B);  </span><br><span class="line">    split(A, m, j, B); </span><br><span class="line">    </span><br><span class="line">    // åˆå¹¶</span><br><span class="line">    merge(B, i, m, j, A);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å­é—®é¢˜ä¸ªæ•° $a=2$</li><li>å­é—®é¢˜æ•°æ®è§„æ¨¡ç¼©å°å€æ•° $b=2$</li><li>é™¤é€’å½’å¤–ï¼Œä¸»è¦æ—¶é—´èŠ±åœ¨åˆå¹¶ä¸Šï¼Œå®ƒå¯ä»¥ç”¨ $f(n) = n$ è¡¨ç¤º</li></ul><p>$T(n) = 2T(\frac{n}{2}) + n$</p><ul><li>æ­¤æ—¶ $x=1=c$ï¼Œæ—¶é—´å¤æ‚åº¦ $\Theta(n\log{n})$</li></ul><p><strong>ä¾‹9. å¿«é€Ÿæ’åºé€’å½’</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">algorithm quicksort(A, lo, hi) <span class="keyword">is</span> </span><br><span class="line">  <span class="keyword">if</span> lo &gt;= hi || lo &lt; <span class="number">0</span> then </span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  </span><br><span class="line">  // åˆ†åŒº</span><br><span class="line">  p := partition(A, lo, hi) </span><br><span class="line">  </span><br><span class="line">  // é€’å½’</span><br><span class="line">  quicksort(A, lo, p - <span class="number">1</span>) </span><br><span class="line">  quicksort(A, p + <span class="number">1</span>, hi) </span><br></pre></td></tr></table></figure><ul><li>å­é—®é¢˜ä¸ªæ•° $a=2$</li><li>å­é—®é¢˜æ•°æ®è§„æ¨¡ç¼©å°å€æ•°<ul><li>å¦‚æœåˆ†åŒºåˆ†çš„å¥½ï¼Œ$b=2$</li><li>å¦‚æœåˆ†åŒºæ²¡åˆ†å¥½ï¼Œä¾‹å¦‚åˆ†åŒº1 çš„æ•°æ®æ˜¯ 0ï¼Œåˆ†åŒº 2 çš„æ•°æ®æ˜¯ $n-1$</li></ul></li><li>é™¤é€’å½’å¤–ï¼Œä¸»è¦æ—¶é—´èŠ±åœ¨åˆ†åŒºä¸Šï¼Œå®ƒå¯ä»¥ç”¨ $f(n) = n$ è¡¨ç¤º</li></ul><p>æƒ…å†µ1 - åˆ†åŒºåˆ†çš„å¥½</p><p>$T(n) = 2T(\frac{n}{2}) + n$</p><ul><li>æ­¤æ—¶ $x=1=c$ï¼Œæ—¶é—´å¤æ‚åº¦ $\Theta(n\log{n})$</li></ul><p>æƒ…å†µ2 - åˆ†åŒºæ²¡åˆ†å¥½</p><p>$T(n) = T(n-1) + T(1) + n$</p><ul><li>æ­¤æ—¶ä¸èƒ½ç”¨ä¸»å®šç†æ±‚è§£</li></ul><h2 id="di-gui-shi-jian-fu-za-du-zhan-kai-qiu-jie" id="é€’å½’æ—¶é—´å¤æ‚åº¦-å±•å¼€æ±‚è§£">é€’å½’æ—¶é—´å¤æ‚åº¦-å±•å¼€æ±‚è§£</h2><p>åƒä¸‹é¢çš„é€’å½’å¼ï¼Œéƒ½ä¸èƒ½ç”¨ä¸»å®šç†æ±‚è§£</p><p><strong>ä¾‹1 - é€’å½’æ±‚å’Œ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">sum</span><span class="params">(<span class="type">long</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n + sum(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>$T(n) = T(n-1) + c$ï¼Œ$T(1) = c$</p><p>ä¸‹é¢ä¸ºå±•å¼€è¿‡ç¨‹</p><p>$T(n) = T(n-2) + c + c$</p><p>$T(n) = T(n-3) + c + c + c$</p><p>â€¦</p><p>$T(n) = T(n-(n-1)) + (n-1)c$</p><ul><li>å…¶ä¸­ $T(n-(n-1))$ å³ $T(1)$</li><li>å¸¦å…¥æ±‚å¾— $T(n) = c + (n-1)c = nc$</li></ul><p>æ—¶é—´å¤æ‚åº¦ä¸º $O(n)$</p><p><strong>ä¾‹2 - é€’å½’å†’æ³¡æ’åº</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">bubble</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">0</span> == high) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; high; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] &gt; a[i + <span class="number">1</span>]) &#123;</span><br><span class="line">            swap(a, i, i + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    bubble(a, high - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>$T(n) = T(n-1) + n$ï¼Œ$T(1) = c$</p><p>ä¸‹é¢ä¸ºå±•å¼€è¿‡ç¨‹</p><p>$T(n) = T(n-2) + (n-1) + n$</p><p>$T(n) = T(n-3) + (n-2) + (n-1) + n$</p><p>â€¦</p><p>$T(n) = T(1) + 2 + â€¦ + n = T(1) + (n-1)\frac{2+n}{2} = c + \frac{n^2}{2} + \frac{n}{2} -1$</p><p>æ—¶é—´å¤æ‚åº¦ $O(n^2)$</p><blockquote><p>æ³¨ï¼š</p><ul><li>ç­‰å·®æ•°åˆ—æ±‚å’Œä¸º $ä¸ªæ•°*\frac{\verté¦–é¡¹-æœ«é¡¹\vert}{2}$</li></ul></blockquote><p><strong>ä¾‹3 - é€’å½’å¿«æ’</strong></p><p>å¿«é€Ÿæ’åºåˆ†åŒºæ²¡åˆ†å¥½çš„æç«¯æƒ…å†µ</p><p>$T(n) = T(n-1) + T(1) + n$ï¼Œ$T(1) = c$</p><p>$T(n) = T(n-1) + c + n$</p><p>ä¸‹é¢ä¸ºå±•å¼€è¿‡ç¨‹</p><p>$T(n) = T(n-2) + c + (n-1) + c + n$</p><p>$T(n) = T(n-3) + c + (n-2) + c + (n-1) + c + n$</p><p>â€¦</p><p>$T(n) = T(n-(n-1)) + (n-1)c + 2+â€¦+n = \frac{n^2}{2} + \frac{2cn+n}{2} -1$</p><p>æ—¶é—´å¤æ‚åº¦ $O(n^2)$</p><p>ä¸ä¼šæ¨å¯¼çš„åŒå­¦å¯ä»¥è¿›å…¥ <a href="https://www.wolframalpha.com/">https://www.wolframalpha.com/</a></p><ul><li>ä¾‹1 è¾“å…¥ f(n) = f(n - 1) + c, f(1) = c</li><li>ä¾‹2 è¾“å…¥ f(n) = f(n - 1) + n, f(1) = c</li><li>ä¾‹3 è¾“å…¥ f(n) = f(n - 1) + n + c, f(1) = c</li></ul><h1 id="dui-lie">é˜Ÿåˆ—</h1><h2 id="gai-shu-3" id="æ¦‚è¿°-4">æ¦‚è¿°</h2><p>è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œqueue æ˜¯ä»¥é¡ºåºçš„æ–¹å¼ç»´æŠ¤çš„ä¸€ç»„æ•°æ®é›†åˆï¼Œåœ¨ä¸€ç«¯æ·»åŠ æ•°æ®ï¼Œä»å¦ä¸€ç«¯ç§»é™¤æ•°æ®ã€‚ä¹ æƒ¯æ¥è¯´ï¼Œæ·»åŠ çš„ä¸€ç«¯ç§°ä¸º<strong>å°¾</strong>ï¼Œç§»é™¤çš„ä¸€ç«¯ç§°ä¸º<strong>å¤´</strong>ï¼Œå°±å¦‚åŒç”Ÿæ´»ä¸­çš„æ’é˜Ÿä¹°å•†å“</p><blockquote><p>In computer science, a <strong>queue</strong> is a collection of entities that are maintained in a sequence and can be modified by  the addition of entities at one end of the sequence and the removal of  entities from the other end of the sequence</p></blockquote><p>å…ˆå®šä¹‰ä¸€ä¸ªç®€åŒ–çš„é˜Ÿåˆ—æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Queue</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é˜Ÿåˆ—å°¾æ’å…¥å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å¾…æ’å…¥å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ’å…¥æˆåŠŸè¿”å› true, æ’å…¥å¤±è´¥è¿”å› false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(E value)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»å¯¹åˆ—å¤´è·å–å€¼, å¹¶ç§»é™¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœé˜Ÿåˆ—éç©ºè¿”å›å¯¹å¤´å€¼, å¦åˆ™è¿”å› null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    E <span class="title function_">poll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»å¯¹åˆ—å¤´è·å–å€¼, ä¸ç§»é™¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœé˜Ÿåˆ—éç©ºè¿”å›å¯¹å¤´å€¼, å¦åˆ™è¿”å› null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    E <span class="title function_">peek</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç©ºè¿”å› true, å¦åˆ™è¿”å› false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦å·²æ»¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ»¡è¿”å› true, å¦åˆ™è¿”å› false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="lian-biao-shi-xian" id="é“¾è¡¨å®ç°">é“¾è¡¨å®ç°</h2><p>ä¸‹é¢ä»¥<strong>å•å‘ç¯å½¢å¸¦å“¨å…µ</strong>é“¾è¡¨æ–¹å¼æ¥å®ç°é˜Ÿåˆ—</p><p><img src="https://s1.vika.cn/space/2023/03/30/31c24fdb3c8a46a4bfc3fe9ee59162c3" alt="image-20221230150105089"></p><p><img src="./imgs/image-20221230150141318.png" alt="image-20221230150141318"></p><p><img src="./imgs/image-20221230150153271.png" alt="image-20221230150153271"></p><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListQueue</span>&lt;E&gt;</span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">Queue</span>&lt;E&gt;, Iterable&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt; &#123;</span><br><span class="line">        E value;</span><br><span class="line">        Node&lt;E&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(E value, Node&lt;E&gt; next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node&lt;E&gt; head = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(<span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">private</span> Node&lt;E&gt; tail = head;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">capacity</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        tail.next = head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LinkedListQueue</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LinkedListQueue</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(E value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; added = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(value, head);</span><br><span class="line">        tail.next = added;</span><br><span class="line">        tail = added;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; first = head.next;</span><br><span class="line">        head.next = first.next;</span><br><span class="line">        <span class="keyword">if</span> (first == tail) &#123;</span><br><span class="line">            tail = head;</span><br><span class="line">        &#125;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> first.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head.next.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> head == tail;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;E&gt;() &#123;</span><br><span class="line">            Node&lt;E&gt; p = head.next;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != head;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> p.value;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="huan-xing-shu-zu-shi-xian" id="ç¯å½¢æ•°ç»„å®ç°">ç¯å½¢æ•°ç»„å®ç°</h2><p><strong>å¥½å¤„</strong></p><ol><li>å¯¹æ¯”æ™®é€šæ•°ç»„ï¼Œèµ·ç‚¹å’Œç»ˆç‚¹æ›´ä¸ºè‡ªç”±ï¼Œä¸ç”¨è€ƒè™‘æ•°æ®ç§»åŠ¨</li><li>â€œç¯â€æ„å‘³ç€ä¸ä¼šå­˜åœ¨ã€è¶Šç•Œã€‘é—®é¢˜</li><li>æ•°ç»„æ€§èƒ½æ›´ä½³</li><li>ç¯å½¢æ•°ç»„æ¯”è¾ƒé€‚åˆå®ç°æœ‰ç•Œé˜Ÿåˆ—ã€RingBuffer ç­‰</li></ol><p><img src="https://s1.vika.cn/space/2023/03/30/9c8cfdd2eb5c42c4bfbf0c72d6135cd8" alt="image-20221228175413998"></p><p><strong>ä¸‹æ ‡è®¡ç®—</strong></p><p>ä¾‹å¦‚ï¼Œæ•°ç»„é•¿åº¦æ˜¯ 5ï¼Œå½“å‰ä½ç½®æ˜¯ 3 ï¼Œå‘å‰èµ° 2 æ­¥ï¼Œæ­¤æ—¶ä¸‹æ ‡ä¸º $(3 + 2)%5 = 0$</p><p><img src="https://s1.vika.cn/space/2023/03/30/75e516e9271e4761abbb3071f9f44cfc" alt="image-20221228180357257"></p><p>$$<br>(cur + step) % length<br>$$</p><ul><li>cur å½“å‰æŒ‡é’ˆä½ç½®</li><li>step å‰è¿›æ­¥æ•°</li><li>length æ•°ç»„é•¿åº¦</li></ul><blockquote><p>æ³¨æ„ï¼š</p><ul><li>å¦‚æœ step = 1ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡èµ°ä¸€æ­¥ï¼Œå¯ä»¥åœ¨ &gt;= length æ—¶é‡ç½®ä¸º 0 å³å¯</li></ul></blockquote><p><strong>åˆ¤æ–­ç©º</strong></p><p><img src="https://s1.vika.cn/space/2023/03/30/5d9c1a5a1f7941da8c279173b33a3462" alt="image-20221231081009018"></p><p><strong>åˆ¤æ–­æ»¡</strong></p><p><img src="https://s1.vika.cn/space/2023/03/30/97f1c044a480428dbe94ca75536e0419" alt="image-20221231080909475"></p><p>æ»¡ä¹‹åçš„ç­–ç•¥å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚å†³å®š</p><ul><li>ä¾‹å¦‚æˆ‘ä»¬è¦å®ç°çš„ç¯å½¢é˜Ÿåˆ—ï¼Œæ»¡ä¹‹åå°±æ‹’ç»å…¥é˜Ÿ</li></ul><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayQueue</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Queue</span>&lt;E&gt;, Iterable&lt;E&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">head</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">tail</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> E[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> length;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArrayQueue</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        length = capacity + <span class="number">1</span>;</span><br><span class="line">        array = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[length];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(E value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        array[tail] = value;</span><br><span class="line">        tail = (tail + <span class="number">1</span>) % length;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> array[head];</span><br><span class="line">        head = (head + <span class="number">1</span>) % length;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[head];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tail == head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (tail + <span class="number">1</span>) % length == head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;E&gt;() &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> head;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != tail;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> array[p];</span><br><span class="line">                p = (p + <span class="number">1</span>) % array.length;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ¤æ–­ç©ºã€æ»¡æ–¹æ³•2</strong></p><p>å¼•å…¥ size</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayQueue2</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Queue</span>&lt;E&gt;, Iterable&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">head</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">tail</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> E[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> capacity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArrayQueue2</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">        array = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(E value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        array[tail] = value;</span><br><span class="line">        tail = (tail + <span class="number">1</span>) % capacity;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> array[head];</span><br><span class="line">        head = (head + <span class="number">1</span>) % capacity;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[head];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;E&gt;() &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> head;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != tail;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> array[p];</span><br><span class="line">                p = (p + <span class="number">1</span>) % capacity;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ¤æ–­ç©ºã€æ»¡æ–¹æ³•3</strong></p><ul><li><p>head å’Œ tail ä¸æ–­é€’å¢ï¼Œç”¨åˆ°ç´¢å¼•æ—¶ï¼Œå†ç”¨å®ƒä»¬è¿›è¡Œè®¡ç®—ï¼Œä¸¤ä¸ªé—®é¢˜</p><ul><li><p>å¦‚ä½•ä¿è¯ head å’Œ tail è‡ªå¢è¶…è¿‡æ­£æ•´æ•°æœ€å¤§å€¼çš„æ­£ç¡®æ€§</p></li><li><p>å¦‚ä½•è®©å–æ¨¡è¿ç®—æ€§èƒ½æ›´é«˜</p></li></ul></li><li><p>ç­”æ¡ˆï¼šè®© capacity ä¸º 2 çš„å¹‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayQueue3</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Queue</span>&lt;E&gt;, Iterable&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">head</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">tail</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> E[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> capacity;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArrayQueue3</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ((capacity &amp; capacity - <span class="number">1</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;capacity å¿…é¡»ä¸º 2 çš„å¹‚&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">        array = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="built_in">this</span>.capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(E value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        array[tail &amp; capacity - <span class="number">1</span>] = value;</span><br><span class="line">        tail++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> array[head &amp; capacity - <span class="number">1</span>];</span><br><span class="line">        head++;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[head &amp; capacity - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tail - head == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tail - head == capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;E&gt;() &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> head;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != tail;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> array[p &amp; capacity - <span class="number">1</span>];</span><br><span class="line">                p++;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="zhan">æ ˆ</h1><h2 id="gai-shu-4" id="æ¦‚è¿°-5">æ¦‚è¿°</h2><p>è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œ<strong>stack</strong> æ˜¯ä¸€ç§çº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œåªèƒ½åœ¨å…¶ä¸€ç«¯æ·»åŠ æ•°æ®å’Œç§»é™¤æ•°æ®ã€‚ä¹ æƒ¯æ¥è¯´ï¼Œè¿™ä¸€ç«¯ç§°ä¹‹ä¸º<strong>æ ˆé¡¶</strong>ï¼Œå¦ä¸€ç«¯ä¸èƒ½æ“ä½œæ•°æ®çš„ç§°ä¹‹ä¸º<strong>æ ˆåº•</strong>ï¼Œå°±å¦‚åŒç”Ÿæ´»ä¸­çš„ä¸€æ‘ä¹¦</p><p>å…ˆæä¾›ä¸€ä¸ªæ ˆæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Stack</span>&lt;E&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘æ ˆé¡¶å‹å…¥å…ƒç´ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å¾…å‹å…¥å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å‹å…¥æˆåŠŸè¿”å› true, å¦åˆ™è¿”å› false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">push</span><span class="params">(E value)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»æ ˆé¡¶å¼¹å‡ºå…ƒç´ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ ˆéç©ºè¿”å›æ ˆé¡¶å…ƒç´ , æ ˆä¸ºç©ºè¿”å› null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    E <span class="title function_">pop</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›æ ˆé¡¶å…ƒç´ , ä¸å¼¹å‡º</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ ˆéç©ºè¿”å›æ ˆé¡¶å…ƒç´ , æ ˆä¸ºç©ºè¿”å› null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    E <span class="title function_">peek</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç©ºè¿”å› true, å¦åˆ™è¿”å› false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­æ ˆæ˜¯å¦å·²æ»¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ»¡è¿”å› true, å¦åˆ™è¿”å› false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="lian-biao-shi-xian-1" id="é“¾è¡¨å®ç°-2">é“¾è¡¨å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListStack</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Stack</span>&lt;E&gt;, Iterable&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> capacity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Node&lt;E&gt; head = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(<span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LinkedListStack</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">push</span><span class="params">(E value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        head.next = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(value, head.next);</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; first = head.next;</span><br><span class="line">        head.next = first.next;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> first.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head.next.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> head.next == <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;E&gt;() &#123;</span><br><span class="line">            Node&lt;E&gt; p = head.next;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> p.value;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt; &#123;</span><br><span class="line">        E value;</span><br><span class="line">        Node&lt;E&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(E value, Node&lt;E&gt; next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="shu-zu-shi-xian" id="æ•°ç»„å®ç°">æ•°ç»„å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayStack</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Stack</span>&lt;E&gt;, Iterable&lt;E&gt;&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> E[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">top</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArrayStack</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.array = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">push</span><span class="params">(E value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        array[top++] = value;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[--top];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[top-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> top == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> top == array.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;E&gt;() &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> top;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p &gt; <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> array[--p];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ying-yong" id="åº”ç”¨">åº”ç”¨</h2><p>æ¨¡æ‹Ÿå¦‚ä¸‹æ–¹æ³•è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;main1&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;main2&quot;</span>);</span><br><span class="line">    method1();</span><br><span class="line">    method2();</span><br><span class="line">    System.out.println(<span class="string">&quot;main3&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;method1&quot;</span>);</span><br><span class="line">    method3();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;method2&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;method3&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¨¡æ‹Ÿä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CPU</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Frame</span> &#123;</span><br><span class="line">        <span class="type">int</span> exit;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Frame</span><span class="params">(<span class="type">int</span> exit)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.exit = exit;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">// æ¨¡æ‹Ÿç¨‹åºè®¡æ•°å™¨ Program counter</span></span><br><span class="line">    <span class="keyword">static</span> ArrayStack&lt;Frame&gt; stack = <span class="keyword">new</span> <span class="title class_">ArrayStack</span>&lt;&gt;(<span class="number">100</span>); <span class="comment">// æ¨¡æ‹Ÿæ–¹æ³•è°ƒç”¨æ ˆ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        stack.push(<span class="keyword">new</span> <span class="title class_">Frame</span>(-<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (pc) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span> -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;main1&quot;</span>);</span><br><span class="line">                    pc++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span> -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;main2&quot;</span>);</span><br><span class="line">                    pc++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span> -&gt; &#123;</span><br><span class="line">                    stack.push(<span class="keyword">new</span> <span class="title class_">Frame</span>(pc + <span class="number">1</span>));</span><br><span class="line">                    pc = <span class="number">100</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span> -&gt; &#123;</span><br><span class="line">                    stack.push(<span class="keyword">new</span> <span class="title class_">Frame</span>(pc + <span class="number">1</span>));</span><br><span class="line">                    pc = <span class="number">200</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">5</span> -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;main3&quot;</span>);</span><br><span class="line">                    pc = stack.pop().exit;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">100</span> -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;method1&quot;</span>);</span><br><span class="line">                    stack.push(<span class="keyword">new</span> <span class="title class_">Frame</span>(pc + <span class="number">1</span>));</span><br><span class="line">                    pc = <span class="number">300</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">101</span> -&gt; &#123;</span><br><span class="line">                    pc = stack.pop().exit;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">200</span> -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;method2&quot;</span>);</span><br><span class="line">                    pc = stack.pop().exit;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">300</span> -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;method3&quot;</span>);</span><br><span class="line">                    pc = stack.pop().exit;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="shuang-duan-dui-lie">åŒç«¯é˜Ÿåˆ—</h1><h2 id="gai-shu-5" id="æ¦‚è¿°-6">æ¦‚è¿°</h2><p>åŒç«¯é˜Ÿåˆ—ã€é˜Ÿåˆ—ã€æ ˆå¯¹æ¯”</p><table><thead><tr><th></th><th>å®šä¹‰</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>é˜Ÿåˆ—</td><td>ä¸€ç«¯åˆ é™¤ï¼ˆå¤´ï¼‰å¦ä¸€ç«¯æ·»åŠ ï¼ˆå°¾ï¼‰</td><td>First In First Out</td></tr><tr><td>æ ˆ</td><td>ä¸€ç«¯åˆ é™¤å’Œæ·»åŠ ï¼ˆé¡¶ï¼‰</td><td>Last In First Out</td></tr><tr><td>åŒç«¯é˜Ÿåˆ—</td><td>ä¸¤ç«¯éƒ½å¯ä»¥åˆ é™¤ã€æ·»åŠ </td><td></td></tr><tr><td>ä¼˜å…ˆçº§é˜Ÿåˆ—</td><td></td><td>ä¼˜å…ˆçº§é«˜è€…å…ˆå‡ºé˜Ÿ</td></tr><tr><td>å»¶æ—¶é˜Ÿåˆ—</td><td></td><td>æ ¹æ®å»¶æ—¶æ—¶é—´ç¡®å®šä¼˜å…ˆçº§</td></tr><tr><td>å¹¶å‘éé˜»å¡é˜Ÿåˆ—</td><td>é˜Ÿåˆ—ç©ºæˆ–æ»¡æ—¶ä¸é˜»å¡</td><td></td></tr><tr><td>å¹¶å‘é˜»å¡é˜Ÿåˆ—</td><td>é˜Ÿåˆ—ç©ºæ—¶åˆ é™¤é˜»å¡ã€é˜Ÿåˆ—æ»¡æ—¶æ·»åŠ é˜»å¡</td><td></td></tr></tbody></table><blockquote><p>æ³¨1ï¼š</p><ul><li>Java ä¸­ LinkedList å³ä¸ºå…¸å‹åŒç«¯é˜Ÿåˆ—å®ç°ï¼Œä¸è¿‡å®ƒåŒæ—¶å®ç°äº† Queue æ¥å£ï¼Œä¹Ÿæä¾›äº†æ ˆçš„ push pop ç­‰æ–¹æ³•</li></ul><p>æ³¨2ï¼š</p><ul><li><p>ä¸åŒè¯­è¨€ï¼Œæ“ä½œåŒç«¯é˜Ÿåˆ—çš„æ–¹æ³•å‘½åæœ‰æ‰€ä¸åŒï¼Œå‚è§ä¸‹è¡¨</p><table><thead><tr><th>æ“ä½œ</th><th>Java</th><th>JavaScript</th><th>C++</th><th>leetCode 641</th></tr></thead><tbody><tr><td>å°¾éƒ¨æ’å…¥</td><td>offerLast</td><td>push</td><td>push_back</td><td>insertLast</td></tr><tr><td>å¤´éƒ¨æ’å…¥</td><td>offerFirst</td><td>unshift</td><td>push_front</td><td>insertFront</td></tr><tr><td>å°¾éƒ¨ç§»é™¤</td><td>pollLast</td><td>pop</td><td>pop_back</td><td>deleteLast</td></tr><tr><td>å¤´éƒ¨ç§»é™¤</td><td>pollFirst</td><td>shift</td><td>pop_front</td><td>deleteFront</td></tr><tr><td>å°¾éƒ¨è·å–</td><td>peekLast</td><td>at(-1)</td><td>back</td><td>getRear</td></tr><tr><td>å¤´éƒ¨è·å–</td><td>peekFirst</td><td>at(0)</td><td>front</td><td>getFront</td></tr></tbody></table></li><li><p>åæ§½ä¸€ä¸‹ leetCode å‘½åæ¯”è¾ƒ low</p></li><li><p>å¸¸è§çš„å•è¯è¿˜æœ‰ enqueue å…¥é˜Ÿã€dequeue å‡ºé˜Ÿ</p></li></ul></blockquote><p><strong>æ¥å£å®šä¹‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Deque</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">offerFirst</span><span class="params">(E e)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">offerLast</span><span class="params">(E e)</span>;</span><br><span class="line"></span><br><span class="line">    E <span class="title function_">pollFirst</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    E <span class="title function_">pollLast</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    E <span class="title function_">peekFirst</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    E <span class="title function_">peekLast</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="lian-biao-shi-xian-2" id="é“¾è¡¨å®ç°-3">é“¾è¡¨å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŸºäºç¯å½¢é“¾è¡¨çš„åŒç«¯é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;E&gt; å…ƒç´ ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListDeque</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Deque</span>&lt;E&gt;, Iterable&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offerFirst</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        Node&lt;E&gt; a = sentinel;</span><br><span class="line">        Node&lt;E&gt; b = sentinel.next;</span><br><span class="line">        Node&lt;E&gt; offered = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(a, e, b);</span><br><span class="line">        a.next = offered;</span><br><span class="line">        b.prev = offered;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offerLast</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        Node&lt;E&gt; a = sentinel.prev;</span><br><span class="line">        Node&lt;E&gt; b = sentinel;</span><br><span class="line">        Node&lt;E&gt; offered = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(a, e, b);</span><br><span class="line">        a.next = offered;</span><br><span class="line">        b.prev = offered;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">pollFirst</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; a = sentinel;</span><br><span class="line">        Node&lt;E&gt; polled = sentinel.next;</span><br><span class="line">        Node&lt;E&gt; b = polled.next;</span><br><span class="line">        a.next = b;</span><br><span class="line">        b.prev = a;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> polled.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">pollLast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; polled = sentinel.prev;</span><br><span class="line">        Node&lt;E&gt; a = polled.prev;</span><br><span class="line">        Node&lt;E&gt; b = sentinel;</span><br><span class="line">        a.next = b;</span><br><span class="line">        b.prev = a;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> polled.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peekFirst</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sentinel.next.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peekLast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sentinel.prev.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;E&gt;() &#123;</span><br><span class="line">            Node&lt;E&gt; p = sentinel.next;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != sentinel;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> p.value;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt; &#123;</span><br><span class="line">        Node&lt;E&gt; prev;</span><br><span class="line">        E value;</span><br><span class="line">        Node&lt;E&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(Node&lt;E&gt; prev, E value, Node&lt;E&gt; next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.prev = prev;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Node&lt;E&gt; sentinel = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="type">int</span> capacity;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LinkedListDeque</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        sentinel.next = sentinel;</span><br><span class="line">        sentinel.prev = sentinel;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="shu-zu-shi-xian-1" id="æ•°ç»„å®ç°-2">æ•°ç»„å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŸºäºå¾ªç¯æ•°ç»„å®ç°, ç‰¹ç‚¹</span></span><br><span class="line"><span class="comment"> * &lt;ul&gt;</span></span><br><span class="line"><span class="comment"> *     &lt;li&gt;tail åœä¸‹æ¥çš„ä½ç½®ä¸å­˜å‚¨, ä¼šæµªè´¹ä¸€ä¸ªä½ç½®&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;E&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayDeque1</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Deque</span>&lt;E&gt;, Iterable&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">                    h</span></span><br><span class="line"><span class="comment">            t</span></span><br><span class="line"><span class="comment">        0   1   2   3</span></span><br><span class="line"><span class="comment">        b           a</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offerFirst</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        head = dec(head, array.length);</span><br><span class="line">        array[head] = e;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offerLast</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        array[tail] = e;</span><br><span class="line">        tail = inc(tail, array.length);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">pollFirst</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">E</span> <span class="variable">e</span> <span class="operator">=</span> array[head];</span><br><span class="line">        array[head] = <span class="literal">null</span>;</span><br><span class="line">        head = inc(head, array.length);</span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">pollLast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        tail = dec(tail, array.length);</span><br><span class="line">        <span class="type">E</span> <span class="variable">e</span> <span class="operator">=</span> array[tail];</span><br><span class="line">        array[tail] = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peekFirst</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[head];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peekLast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[dec(tail, array.length)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> head == tail;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (tail &gt; head) &#123;</span><br><span class="line">            <span class="keyword">return</span> tail - head == array.length - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tail &lt; head) &#123;</span><br><span class="line">            <span class="keyword">return</span> head - tail == <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;E&gt;() &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> head;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != tail;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">E</span> <span class="variable">e</span> <span class="operator">=</span> array[p];</span><br><span class="line">                p = inc(p, array.length);</span><br><span class="line">                <span class="keyword">return</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    E[] array;</span><br><span class="line">    <span class="type">int</span> head;</span><br><span class="line">    <span class="type">int</span> tail;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArrayDeque1</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        array = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[capacity + <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">inc</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i + <span class="number">1</span> &gt;= length) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">dec</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i - <span class="number">1</span> &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> length - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•°ç»„å®ç°ä¸­ï¼Œå¦‚æœå­˜å‚¨çš„æ˜¯åŸºæœ¬ç±»å‹ï¼Œé‚£ä¹ˆæ— éœ€è€ƒè™‘å†…å­˜é‡Šæ”¾ï¼Œä¾‹å¦‚</p><p><img src="https://s1.vika.cn/space/2023/03/30/a842c5ff42404b35977b9eaa27457462" alt="image-20230110084245095"></p><p>ä½†å¦‚æœå­˜å‚¨çš„æ˜¯å¼•ç”¨ç±»å‹ï¼Œåº”å½“è®¾ç½®è¯¥ä½ç½®çš„å¼•ç”¨ä¸º nullï¼Œä»¥ä¾¿å†…å­˜åŠæ—¶é‡Šæ”¾</p><p><img src="https://s1.vika.cn/space/2023/03/30/7b340cebf18e458cab78c2e1bcdb99fc" alt="image-20230110084632543"></p><h1 id="you-xian-ji-dui-lie">ä¼˜å…ˆçº§é˜Ÿåˆ—</h1><h2 id="wu-xu-shu-zu-shi-xian" id="æ— åºæ•°ç»„å®ç°">æ— åºæ•°ç»„å®ç°</h2><p><strong>è¦ç‚¹</strong></p><ol><li>å…¥é˜Ÿä¿æŒé¡ºåº</li><li>å‡ºé˜Ÿå‰æ‰¾åˆ°ä¼˜å…ˆçº§æœ€é«˜çš„å‡ºé˜Ÿï¼Œç›¸å½“äºä¸€æ¬¡é€‰æ‹©æ’åº</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PriorityQueue1</span>&lt;E <span class="keyword">extends</span> <span class="title class_">Priority</span>&gt; <span class="keyword">implements</span> <span class="title class_">Queue</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    Priority[] array;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PriorityQueue1</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        array = <span class="keyword">new</span> <span class="title class_">Priority</span>[capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// O(1)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        array[size++] = e;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›ä¼˜å…ˆçº§æœ€é«˜çš„ç´¢å¼•å€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">selectMax</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (array[i].priority() &gt; array[max].priority()) &#123;</span><br><span class="line">                max = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// O(n)</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> selectMax();</span><br><span class="line">        <span class="type">E</span> <span class="variable">e</span> <span class="operator">=</span> (E) array[max];</span><br><span class="line">        remove(max);</span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; size - <span class="number">1</span>) &#123;</span><br><span class="line">            System.arraycopy(array, index + <span class="number">1</span>,</span><br><span class="line">                    array, index, size - <span class="number">1</span> - index);</span><br><span class="line">        &#125;</span><br><span class="line">        array[--size] = <span class="literal">null</span>; <span class="comment">// help GC</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> selectMax();</span><br><span class="line">        <span class="keyword">return</span> (E) array[max];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == array.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è§†é¢‘ä¸­å¿˜è®°äº† help GCï¼Œæ³¨æ„ä¸€ä¸‹</li></ul><h2 id="you-xu-shu-zu-shi-xian" id="æœ‰åºæ•°ç»„å®ç°">æœ‰åºæ•°ç»„å®ç°</h2><p><strong>è¦ç‚¹</strong></p><ol><li>å…¥é˜Ÿåæ’å¥½åºï¼Œä¼˜å…ˆçº§æœ€é«˜çš„æ’åˆ—åœ¨å°¾éƒ¨</li><li>å‡ºé˜Ÿåªéœ€åˆ é™¤å°¾éƒ¨å…ƒç´ å³å¯</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PriorityQueue2</span>&lt;E <span class="keyword">extends</span> <span class="title class_">Priority</span>&gt; <span class="keyword">implements</span> <span class="title class_">Queue</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    Priority[] array;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PriorityQueue2</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        array = <span class="keyword">new</span> <span class="title class_">Priority</span>[capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// O(n)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        insert(e);</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸€è½®æ’å…¥æ’åº</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &gt;= <span class="number">0</span> &amp;&amp; array[i].priority() &gt; e.priority()) &#123;</span><br><span class="line">            array[i + <span class="number">1</span>] = array[i];</span><br><span class="line">            i--;</span><br><span class="line">        &#125;</span><br><span class="line">        array[i + <span class="number">1</span>] = e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// O(1)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">E</span> <span class="variable">e</span> <span class="operator">=</span> (E) array[size - <span class="number">1</span>];</span><br><span class="line">        array[--size] = <span class="literal">null</span>; <span class="comment">// help GC</span></span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (E) array[size - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == array.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="dui-shi-xian" id="å †å®ç°">å †å®ç°</h2><p>è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå †æ˜¯ä¸€ç§åŸºäºæ ‘çš„æ•°æ®ç»“æ„ï¼Œé€šå¸¸ç”¨<strong>å®Œå…¨äºŒå‰æ ‘</strong>å®ç°ã€‚å †çš„ç‰¹æ€§å¦‚ä¸‹</p><ul><li>åœ¨å¤§é¡¶å †ä¸­ï¼Œä»»æ„èŠ‚ç‚¹ C ä¸å®ƒçš„çˆ¶èŠ‚ç‚¹ P ç¬¦åˆ $P.value \geq C.value$</li><li>è€Œå°é¡¶å †ä¸­ï¼Œä»»æ„èŠ‚ç‚¹ C ä¸å®ƒçš„çˆ¶èŠ‚ç‚¹ P ç¬¦åˆ $P.value \leq C.value$</li><li>æœ€é¡¶å±‚çš„èŠ‚ç‚¹ï¼ˆæ²¡æœ‰çˆ¶äº²ï¼‰ç§°ä¹‹ä¸º root æ ¹èŠ‚ç‚¹</li></ul><blockquote><p>In computer science, a <strong>heap</strong> is a specialized tree-based data structure which is essentially an almost complete tree that satisfies the <strong>heap property</strong>: in a <em>max heap</em>, for any given node C, if P is a parent node of C, then the <em>key</em> (the <em>value</em>) of P is greater than or equal to the key of C. In a <em>min heap</em>, the key of P is less than or equal to the key of C. The node at the â€œtopâ€ of the heap (with no parents) is called the <strong>root</strong> node</p></blockquote><p>ä¾‹1 - æ»¡äºŒå‰æ ‘ï¼ˆFull Binary Treeï¼‰ç‰¹ç‚¹ï¼šæ¯ä¸€å±‚éƒ½æ˜¯å¡«æ»¡çš„</p><p><img src="https://s1.vika.cn/space/2023/03/30/adb536704ea64a11b8b15275133100ef" alt="image-20230112171444699"></p><p>ä¾‹2 - å®Œå…¨äºŒå‰æ ‘ï¼ˆComplete Binary Treeï¼‰ç‰¹ç‚¹ï¼šæœ€åä¸€å±‚å¯èƒ½æœªå¡«æ»¡ï¼Œé å·¦å¯¹é½</p><p><img src="https://s1.vika.cn/space/2023/03/30/a70aedd59f4042ec8abe8f20fd5fbbae" alt="image-20230112171917135"></p><p>ä¾‹3 - å¤§é¡¶å †</p><p><img src="https://s1.vika.cn/space/2023/03/30/b92521a240f24600b0895a2bb87f78e2" alt="image-20230112170242265"></p><p>ä¾‹4 - å°é¡¶å †</p><p><img src="https://s1.vika.cn/space/2023/03/30/da8c012baabc43548a8e2cf0bc4fa992" alt="image-20230112171236067"></p><p>å®Œå…¨äºŒå‰æ ‘å¯ä»¥ä½¿ç”¨æ•°ç»„æ¥è¡¨ç¤º</p><p><img src="https://s1.vika.cn/space/2023/03/30/3618bd7645b247fe85eb21a4807f138d" alt="image-20230112174351649"></p><p>ç‰¹å¾</p><ul><li>å¦‚æœä»ç´¢å¼• 0 å¼€å§‹å­˜å‚¨èŠ‚ç‚¹æ•°æ®<ul><li>èŠ‚ç‚¹ $i$ çš„çˆ¶èŠ‚ç‚¹ä¸º $floor((i-1)/2)$ï¼Œå½“ $i&gt;0$ æ—¶</li><li>èŠ‚ç‚¹ $i$ çš„å·¦å­èŠ‚ç‚¹ä¸º $2i+1$ï¼Œå³å­èŠ‚ç‚¹ä¸º $2i+2$ï¼Œå½“ç„¶å®ƒä»¬å¾— $&lt; size$</li></ul></li><li>å¦‚æœä»ç´¢å¼• 1 å¼€å§‹å­˜å‚¨èŠ‚ç‚¹æ•°æ®<ul><li>èŠ‚ç‚¹ $i$ çš„çˆ¶èŠ‚ç‚¹ä¸º $floor(i/2)$ï¼Œå½“ $i &gt; 1$ æ—¶</li><li>èŠ‚ç‚¹ $i$ çš„å·¦å­èŠ‚ç‚¹ä¸º $2i$ï¼Œå³å­èŠ‚ç‚¹ä¸º $2i+1$ï¼ŒåŒæ ·å¾— $&lt; size$</li></ul></li></ul><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PriorityQueue4</span>&lt;E <span class="keyword">extends</span> <span class="title class_">Priority</span>&gt; <span class="keyword">implements</span> <span class="title class_">Queue</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    Priority[] array;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PriorityQueue4</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        array = <span class="keyword">new</span> <span class="title class_">Priority</span>[capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(E offered)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">child</span> <span class="operator">=</span> size++;</span><br><span class="line">        <span class="type">int</span> <span class="variable">parent</span> <span class="operator">=</span> (child - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">while</span> (child &gt; <span class="number">0</span> &amp;&amp; offered.priority() &gt; array[parent].priority()) &#123;</span><br><span class="line">            array[child] = array[parent];</span><br><span class="line">            child = parent;</span><br><span class="line">            parent = (child - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        array[child] = offered;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">Priority</span> <span class="variable">t</span> <span class="operator">=</span> array[i];</span><br><span class="line">        array[i] = array[j];</span><br><span class="line">        array[j] = t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(<span class="number">0</span>, size - <span class="number">1</span>);</span><br><span class="line">        size--;</span><br><span class="line">        <span class="type">Priority</span> <span class="variable">e</span> <span class="operator">=</span> array[size];</span><br><span class="line">        array[size] = <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        shiftDown(<span class="number">0</span>);        </span><br><span class="line">        <span class="keyword">return</span> (E) e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">shiftDown</span><span class="params">(<span class="type">int</span> parent)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">2</span> * parent + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> left + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> parent;</span><br><span class="line">        <span class="keyword">if</span> (left &lt; size &amp;&amp; array[left].priority() &gt; array[max].priority()) &#123;</span><br><span class="line">            max = left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (right &lt; size &amp;&amp; array[right].priority() &gt; array[max].priority()) &#123;</span><br><span class="line">            max = right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (max != parent) &#123;</span><br><span class="line">            swap(max, parent);</span><br><span class="line">            shiftDown(max);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (E) array[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == array.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="zu-sai-dui-lie">é˜»å¡é˜Ÿåˆ—</h1><p>ä¹‹å‰çš„é˜Ÿåˆ—åœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½ä¸èƒ½å¾ˆå¥½åœ°å·¥ä½œï¼Œä¾‹å¦‚</p><ol><li>å¤§éƒ¨åˆ†åœºæ™¯è¦æ±‚åˆ†ç¦»å‘é˜Ÿåˆ—æ”¾å…¥ï¼ˆç”Ÿäº§è€…ï¼‰ã€ä»é˜Ÿåˆ—æ‹¿å‡ºï¼ˆæ¶ˆè´¹è€…ï¼‰ä¸¤ä¸ªè§’è‰²ã€å®ƒä»¬å¾—ç”±ä¸åŒçš„çº¿ç¨‹æ¥æ‹…å½“ï¼Œè€Œä¹‹å‰çš„å®ç°æ ¹æœ¬æ²¡æœ‰è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜</li><li>é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆåœ¨ä¹‹å‰çš„å®ç°é‡Œä¼šè¿”å› nullï¼Œå¦‚æœå°±æ˜¯ç¡¬è¦æ‹¿åˆ°ä¸€ä¸ªå…ƒç´ å‘¢ï¼Ÿåªèƒ½ä¸æ–­å¾ªç¯å°è¯•</li><li>é˜Ÿåˆ—ä¸ºæ»¡ï¼Œé‚£ä¹ˆå†ä¹‹å‰çš„å®ç°é‡Œä¼šè¿”å› falseï¼Œå¦‚æœå°±æ˜¯ç¡¬è¦å¡å…¥ä¸€ä¸ªå…ƒç´ å‘¢ï¼Ÿåªèƒ½ä¸æ–­å¾ªç¯å°è¯•</li></ol><p>å› æ­¤æˆ‘ä»¬éœ€è¦è§£å†³çš„é—®é¢˜æœ‰</p><ol><li>ç”¨é”ä¿è¯çº¿ç¨‹å®‰å…¨</li><li>ç”¨æ¡ä»¶å˜é‡è®©<strong>ç­‰å¾…éç©ºçº¿ç¨‹</strong>ä¸<strong>ç­‰å¾…ä¸æ»¡çº¿ç¨‹</strong>è¿›å…¥<strong>ç­‰å¾…</strong>çŠ¶æ€ï¼Œè€Œä¸æ˜¯ä¸æ–­å¾ªç¯å°è¯•ï¼Œè®© CPU ç©ºè½¬</li></ol><p>æœ‰åŒå­¦å¯¹çº¿ç¨‹å®‰å…¨è¿˜æ²¡æœ‰è¶³å¤Ÿçš„è®¤è¯†ï¼Œä¸‹é¢ä¸¾ä¸€ä¸ªåä¾‹ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½è¦æ‰§è¡Œå…¥é˜Ÿæ“ä½œï¼ˆå‡ ä¹åœ¨åŒä¸€æ—¶åˆ»ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestThreadUnsafe</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String[] array = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">tail</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">offer</span><span class="params">(String e)</span> &#123;</span><br><span class="line">        array[tail] = e;</span><br><span class="line">        tail++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.toString(array);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TestThreadUnsafe</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestThreadUnsafe</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt; queue.offer(<span class="string">&quot;e1&quot;</span>), <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt; queue.offer(<span class="string">&quot;e2&quot;</span>), <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œçš„æ—¶é—´åºåˆ—å¦‚ä¸‹ï¼Œå‡è®¾åˆå§‹çŠ¶æ€ tail = 0ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ç”±äº CPU åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´åˆ‡æ¢ï¼Œé€ æˆäº†æŒ‡ä»¤äº¤é”™</p><table><thead><tr><th>çº¿ç¨‹1</th><th>çº¿ç¨‹2</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>array[tail]=e1</td><td></td><td>çº¿ç¨‹1 å‘ tail ä½ç½®åŠ å…¥ e1 è¿™ä¸ªå…ƒç´ ï¼Œä½†è¿˜æ²¡æ¥å¾—åŠæ‰§è¡Œ  tail++</td></tr><tr><td></td><td>array[tail]=e2</td><td>çº¿ç¨‹2 å‘ tail ä½ç½®åŠ å…¥ e2 è¿™ä¸ªå…ƒç´ ï¼Œè¦†ç›–æ‰äº† e1</td></tr><tr><td></td><td>tail++</td><td>tail è‡ªå¢ä¸º1</td></tr><tr><td>tail++</td><td></td><td>tail è‡ªå¢ä¸º2</td></tr><tr><td></td><td></td><td>æœ€åçŠ¶æ€ tail ä¸º 2ï¼Œæ•°ç»„ä¸º [e2, null, null â€¦]</td></tr></tbody></table><p>ç³Ÿç³•çš„æ˜¯ï¼Œç”±äºæŒ‡ä»¤äº¤é”™çš„é¡ºåºä¸åŒï¼Œå¾—åˆ°çš„ç»“æœä¸æ­¢ä»¥ä¸Šä¸€ç§ï¼Œå®è§‚ä¸Šé€ æˆæ··ä¹±çš„æ•ˆæœ</p><h2 id="dan-suo-shi-xian" id="å•é”å®ç°">å•é”å®ç°</h2><p>Java ä¸­è¦é˜²æ­¢ä»£ç æ®µäº¤é”™æ‰§è¡Œï¼Œéœ€è¦ä½¿ç”¨é”ï¼Œæœ‰ä¸¤ç§é€‰æ‹©</p><ul><li>synchronized ä»£ç å—ï¼Œå±äºå…³é”®å­—çº§åˆ«æä¾›é”ä¿æŠ¤ï¼ŒåŠŸèƒ½å°‘</li><li>ReentrantLock ç±»ï¼ŒåŠŸèƒ½ä¸°å¯Œ</li></ul><p>ä»¥ ReentrantLock ä¸ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">offer</span><span class="params">(String e)</span> &#123;</span><br><span class="line">    lock.lockInterruptibly();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        array[tail] = e;</span><br><span class="line">        tail++;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªè¦ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œä¸Šæ®µä»£ç æ—¶ï¼Œé”å¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼Œå°±èƒ½ä¿è¯ try å—å†…çš„ä»£ç çš„æ‰§è¡Œä¸ä¼šå‡ºç°æŒ‡ä»¤äº¤é”™ç°è±¡ï¼Œå³æ‰§è¡Œé¡ºåºåªå¯èƒ½æ˜¯ä¸‹é¢ä¸¤ç§æƒ…å†µä¹‹ä¸€</p><table><thead><tr><th>çº¿ç¨‹1</th><th>çº¿ç¨‹2</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>lock.lockInterruptibly()</td><td></td><td>t1å¯¹é”å¯¹è±¡ä¸Šé”</td></tr><tr><td>array[tail]=e1</td><td></td><td></td></tr><tr><td></td><td>lock.lockInterruptibly()</td><td>å³ä½¿ CPU åˆ‡æ¢åˆ°çº¿ç¨‹2ï¼Œä½†ç”±äºt1å·²ç»å¯¹è¯¥å¯¹è±¡ä¸Šé”ï¼Œå› æ­¤çº¿ç¨‹2å¡åœ¨è¿™å„¿è¿›ä¸å»</td></tr><tr><td>tail++</td><td></td><td>åˆ‡æ¢å›çº¿ç¨‹1 æ‰§è¡Œåç»­ä»£ç </td></tr><tr><td>lock.unlock()</td><td></td><td>çº¿ç¨‹1 è§£é”</td></tr><tr><td></td><td>array[tail]=e2</td><td>çº¿ç¨‹2 æ­¤æ—¶æ‰èƒ½è·å¾—é”ï¼Œæ‰§è¡Œå®ƒçš„ä»£ç </td></tr><tr><td></td><td>tail++</td><td></td></tr></tbody></table><ul><li>å¦ä¸€ç§æƒ…å†µæ˜¯çº¿ç¨‹2 å…ˆè·å¾—é”ï¼Œçº¿ç¨‹1 è¢«æŒ¡åœ¨å¤–é¢</li><li>è¦æ˜ç™½<strong>ä¿æŠ¤çš„æœ¬è´¨</strong>ï¼Œæœ¬ä¾‹ä¸­æ˜¯ä¿æŠ¤çš„æ˜¯ tail ä½ç½®è¯»å†™çš„å®‰å…¨</li></ul><p>äº‹æƒ…è¿˜æ²¡æœ‰å®Œï¼Œä¸Šé¢çš„ä¾‹å­æ˜¯é˜Ÿåˆ—è¿˜æ²¡æœ‰æ”¾æ»¡çš„æƒ…å†µï¼Œè€ƒè™‘ä¸‹é¢çš„ä»£ç ï¼ˆè¿™å›é”åŒæ—¶ä¿æŠ¤äº† tail å’Œ size çš„è¯»å†™å®‰å…¨ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"><span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">offer</span><span class="params">(String e)</span> &#123;</span><br><span class="line">    lock.lockInterruptibly();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(isFull()) &#123;</span><br><span class="line">            <span class="comment">// æ»¡äº†æ€ä¹ˆåŠ?</span></span><br><span class="line">        &#125;</span><br><span class="line">        array[tail] = e;</span><br><span class="line">        tail++;</span><br><span class="line">        </span><br><span class="line">        size++;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> size == array.length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹å‰æ˜¯è¿”å› false è¡¨ç¤ºæ·»åŠ å¤±è´¥ï¼Œå‰é¢åˆ†æè¿‡æƒ³è¾¾åˆ°è¿™ä¹ˆä¸€ç§æ•ˆæœï¼š</p><ul><li>åœ¨é˜Ÿåˆ—æ»¡æ—¶ï¼Œä¸æ˜¯ç«‹åˆ»è¿”å›ï¼Œè€Œæ˜¯å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…</li><li>ä»€ä¹ˆæ—¶å€™é˜Ÿåˆ—ä¸æ»¡äº†ï¼Œå†å”¤é†’è¿™ä¸ªç­‰å¾…çš„çº¿ç¨‹ï¼Œä»ä¸Šæ¬¡çš„ä»£ç å¤„ç»§ç»­å‘ä¸‹è¿è¡Œ</li></ul><p>ReentrantLock å¯ä»¥é…åˆæ¡ä»¶å˜é‡æ¥å®ç°ï¼Œä»£ç è¿›åŒ–ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"><span class="type">Condition</span> <span class="variable">tailWaits</span> <span class="operator">=</span> lock.newCondition(); <span class="comment">// æ¡ä»¶å˜é‡</span></span><br><span class="line"><span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">offer</span><span class="params">(String e)</span> &#123;</span><br><span class="line">    lock.lockInterruptibly();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (isFull()) &#123;</span><br><span class="line">            tailWaits.await();<span class="comment">// å½“é˜Ÿåˆ—æ»¡æ—¶, å½“å‰çº¿ç¨‹è¿›å…¥ tailWaits ç­‰å¾…</span></span><br><span class="line">        &#125;</span><br><span class="line">        array[tail] = e;</span><br><span class="line">        tail++;</span><br><span class="line">        </span><br><span class="line">        size++;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> size == array.length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ¡ä»¶å˜é‡åº•å±‚ä¹Ÿæ˜¯ä¸ªé˜Ÿåˆ—ï¼Œç”¨æ¥å­˜å‚¨è¿™äº›éœ€è¦ç­‰å¾…çš„çº¿ç¨‹ï¼Œå½“é˜Ÿåˆ—æ»¡äº†ï¼Œå°±ä¼šå°† offer çº¿ç¨‹åŠ å…¥æ¡ä»¶é˜Ÿåˆ—ï¼Œå¹¶æš‚æ—¶é‡Šæ”¾é”</li><li>å°†æ¥æˆ‘ä»¬çš„é˜Ÿåˆ—å¦‚æœä¸æ»¡äº†ï¼ˆç”± poll çº¿ç¨‹é‚£è¾¹å¾—çŸ¥ï¼‰å¯ä»¥è°ƒç”¨ tailWaits.signal() æ¥å”¤é†’ tailWaits ä¸­é¦–ä¸ªç­‰å¾…çš„çº¿ç¨‹ï¼Œè¢«å”¤é†’çš„çº¿ç¨‹ä¼šå†æ¬¡æŠ¢åˆ°é”ï¼Œä»ä¸Šæ¬¡ await å¤„ç»§ç»­å‘ä¸‹è¿è¡Œ</li></ul><p>æ€è€ƒä¸ºä½•è¦ç”¨ while è€Œä¸æ˜¯ ifï¼Œè®¾é˜Ÿåˆ—å®¹é‡æ˜¯ 3</p><table><thead><tr><th>æ“ä½œå‰</th><th>offer(4)</th><th>offer(5)</th><th>poll()</th><th>æ“ä½œå</th></tr></thead><tbody><tr><td>[1 2 3]</td><td>é˜Ÿåˆ—æ»¡ï¼Œè¿›å…¥tailWaits ç­‰å¾…</td><td></td><td></td><td>[1 2 3]</td></tr><tr><td>[1 2 3]</td><td></td><td></td><td>å–èµ° 1ï¼Œé˜Ÿåˆ—ä¸æ»¡ï¼Œå”¤é†’çº¿ç¨‹</td><td>[2 3]</td></tr><tr><td>[2 3]</td><td></td><td>æŠ¢å…ˆè·å¾—é”ï¼Œå‘ç°ä¸æ»¡ï¼Œæ”¾å…¥ 5</td><td></td><td>[2 3 5]</td></tr><tr><td>[2 3 5]</td><td>ä»ä¸Šæ¬¡ç­‰å¾…å¤„ç›´æ¥å‘ä¸‹æ‰§è¡Œ</td><td></td><td></td><td>[2 3 5 ?]</td></tr></tbody></table><p>å…³é”®ç‚¹ï¼š</p><ul><li>ä» tailWaits ä¸­å”¤é†’çš„çº¿ç¨‹ï¼Œä¼šä¸æ–°æ¥çš„ offer çš„çº¿ç¨‹äº‰æŠ¢é”ï¼Œè°èƒ½æŠ¢åˆ°æ˜¯ä¸ä¸€å®šçš„ï¼Œå¦‚æœåè€…å…ˆæŠ¢åˆ°ï¼Œå°±ä¼šå¯¼è‡´æ¡ä»¶åˆå‘ç”Ÿå˜åŒ–</li><li>è¿™ç§æƒ…å†µç§°ä¹‹ä¸º<strong>è™šå‡å”¤é†’</strong>ï¼Œå”¤é†’ååº”è¯¥é‡æ–°æ£€æŸ¥æ¡ä»¶ï¼Œçœ‹æ˜¯ä¸æ˜¯å¾—é‡æ–°è¿›å…¥ç­‰å¾…</li></ul><p>æœ€åçš„å®ç°ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å•é”å®ç°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;E&gt; å…ƒç´ ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlockingQueue1</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">BlockingQueue</span>&lt;E&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> E[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">head</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">tail</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BlockingQueue1</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        array = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="type">Condition</span> <span class="variable">tailWaits</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="type">Condition</span> <span class="variable">headWaits</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">offer</span><span class="params">(E e)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lockInterruptibly();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (isFull()) &#123;</span><br><span class="line">                tailWaits.await();</span><br><span class="line">            &#125;</span><br><span class="line">            array[tail] = e;</span><br><span class="line">            <span class="keyword">if</span> (++tail == array.length) &#123;</span><br><span class="line">                tail = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            size++;</span><br><span class="line">            headWaits.signal();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">offer</span><span class="params">(E e, <span class="type">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lockInterruptibly();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">t</span> <span class="operator">=</span> TimeUnit.MILLISECONDS.toNanos(timeout);</span><br><span class="line">            <span class="keyword">while</span> (isFull()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (t &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                t = tailWaits.awaitNanos(t);</span><br><span class="line">            &#125;</span><br><span class="line">            array[tail] = e;</span><br><span class="line">            <span class="keyword">if</span> (++tail == array.length) &#123;</span><br><span class="line">                tail = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            size++;</span><br><span class="line">            headWaits.signal();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lockInterruptibly();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (isEmpty()) &#123;</span><br><span class="line">                headWaits.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">E</span> <span class="variable">e</span> <span class="operator">=</span> array[head];</span><br><span class="line">            array[head] = <span class="literal">null</span>; <span class="comment">// help GC</span></span><br><span class="line">            <span class="keyword">if</span> (++head == array.length) &#123;</span><br><span class="line">                head = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            size--;</span><br><span class="line">            tailWaits.signal();</span><br><span class="line">            <span class="keyword">return</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == array.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>public void offer(E e, long timeout) throws InterruptedException æ˜¯å¸¦è¶…æ—¶çš„ç‰ˆæœ¬ï¼Œå¯ä»¥åªç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè€Œä¸æ˜¯æ°¸ä¹…ç­‰ä¸‹å»ï¼Œç±»ä¼¼çš„ poll ä¹Ÿå¯ä»¥åšå¸¦è¶…æ—¶çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªç•™ç»™å¤§å®¶äº†</li></ul><blockquote><p><strong>æ³¨æ„</strong></p><ul><li>JDK ä¸­ BlockingQueue æ¥å£çš„æ–¹æ³•å‘½åä¸æˆ‘çš„ç¤ºä¾‹æœ‰äº›å·®å¼‚<ul><li>æ–¹æ³• offer(E e) æ˜¯éé˜»å¡çš„å®ç°ï¼Œé˜»å¡å®ç°æ–¹æ³•ä¸º put(E e)</li><li>æ–¹æ³• poll() æ˜¯éé˜»å¡çš„å®ç°ï¼Œé˜»å¡å®ç°æ–¹æ³•ä¸º take()</li></ul></li></ul></blockquote><h2 id="shuang-suo-shi-xian" id="åŒé”å®ç°">åŒé”å®ç°</h2><p>å•é”çš„ç¼ºç‚¹åœ¨äºï¼š</p><ul><li>ç”Ÿäº§å’Œæ¶ˆè´¹å‡ ä¹æ˜¯ä¸å†²çªçš„ï¼Œå”¯ä¸€å†²çªçš„æ˜¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å®ƒä»¬æœ‰å¯èƒ½åŒæ—¶ä¿®æ”¹ size</li><li>å†²çªçš„ä¸»è¦æ˜¯ç”Ÿäº§è€…ä¹‹é—´ï¼šå¤šä¸ª offer çº¿ç¨‹ä¿®æ”¹ tail</li><li>å†²çªçš„è¿˜æœ‰æ¶ˆè´¹è€…ä¹‹é—´ï¼šå¤šä¸ª poll çº¿ç¨‹ä¿®æ”¹ head</li></ul><p>å¦‚æœå¸Œæœ›è¿›ä¸€æ­¥æé«˜æ€§èƒ½ï¼Œå¯ä»¥ç”¨ä¸¤æŠŠé”</p><ul><li>ä¸€æŠŠé”ä¿æŠ¤ tail</li><li>å¦ä¸€æŠŠé”ä¿æŠ¤ head</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReentrantLock</span> <span class="variable">headLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();  <span class="comment">// ä¿æŠ¤ head çš„é”</span></span><br><span class="line"><span class="type">Condition</span> <span class="variable">headWaits</span> <span class="operator">=</span> headLock.newCondition(); <span class="comment">// é˜Ÿåˆ—ç©ºæ—¶ï¼Œéœ€è¦ç­‰å¾…çš„çº¿ç¨‹é›†åˆ</span></span><br><span class="line"></span><br><span class="line"><span class="type">ReentrantLock</span> <span class="variable">tailLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();  <span class="comment">// ä¿æŠ¤ tail çš„é”</span></span><br><span class="line"><span class="type">Condition</span> <span class="variable">tailWaits</span> <span class="operator">=</span> tailLock.newCondition(); <span class="comment">// é˜Ÿåˆ—æ»¡æ—¶ï¼Œéœ€è¦ç­‰å¾…çš„çº¿ç¨‹é›†åˆ</span></span><br></pre></td></tr></table></figure><p>å…ˆçœ‹çœ‹ offer æ–¹æ³•çš„åˆæ­¥å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">offer</span><span class="params">(E e)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    tailLock.lockInterruptibly();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—æ»¡ç­‰å¾…</span></span><br><span class="line">        <span class="keyword">while</span> (isFull()) &#123;</span><br><span class="line">            tailWaits.await();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸æ»¡åˆ™å…¥é˜Ÿ</span></span><br><span class="line">        array[tail] = e;</span><br><span class="line">        <span class="keyword">if</span> (++tail == array.length) &#123;</span><br><span class="line">            tail = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¿®æ”¹ size ï¼ˆæœ‰é—®é¢˜ï¼‰</span></span><br><span class="line">        size++;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        tailLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„ç¼ºç‚¹æ˜¯ size å¹¶ä¸å— tailLock ä¿æŠ¤ï¼ŒtailLock ä¸ headLock æ˜¯ä¸¤æŠŠä¸åŒçš„é”ï¼Œå¹¶ä¸èƒ½å®ç°äº’æ–¥çš„æ•ˆæœã€‚å› æ­¤ï¼Œsize éœ€è¦ç”¨ä¸‹é¢çš„ä»£ç ä¿è¯åŸå­æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AtomicInteger</span> <span class="variable">size</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);   <span class="comment">// ä¿æŠ¤ size çš„åŸå­å˜é‡</span></span><br><span class="line"></span><br><span class="line">size.getAndIncrement(); <span class="comment">// è‡ªå¢</span></span><br><span class="line">size.getAndDecrement(); <span class="comment">// è‡ªå‡</span></span><br></pre></td></tr></table></figure><p>ä»£ç ä¿®æ”¹ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">offer</span><span class="params">(E e)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    tailLock.lockInterruptibly();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—æ»¡ç­‰å¾…</span></span><br><span class="line">        <span class="keyword">while</span> (isFull()) &#123;</span><br><span class="line">            tailWaits.await();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸æ»¡åˆ™å…¥é˜Ÿ</span></span><br><span class="line">        array[tail] = e;</span><br><span class="line">        <span class="keyword">if</span> (++tail == array.length) &#123;</span><br><span class="line">            tail = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¿®æ”¹ size</span></span><br><span class="line">        size.getAndIncrement();</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        tailLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹ç§°åœ°ï¼Œå¯ä»¥å†™å‡º poll æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    E e;</span><br><span class="line">    headLock.lockInterruptibly();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—ç©ºç­‰å¾…</span></span><br><span class="line">        <span class="keyword">while</span> (isEmpty()) &#123;</span><br><span class="line">            headWaits.await();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸ç©ºåˆ™å‡ºé˜Ÿ</span></span><br><span class="line">        e = array[head];</span><br><span class="line">        <span class="keyword">if</span> (++head == array.length) &#123;</span><br><span class="line">            head = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¿®æ”¹ size</span></span><br><span class="line">        size.getAndDecrement();</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        headLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ¥çœ‹ä¸€ä¸ªéš¾é¢˜ï¼Œå°±æ˜¯å¦‚ä½•é€šçŸ¥ headWaits å’Œ tailWaits ä¸­ç­‰å¾…çš„çº¿ç¨‹ï¼Œæ¯”å¦‚ poll æ–¹æ³•æ‹¿èµ°ä¸€ä¸ªå…ƒç´ ï¼Œé€šçŸ¥ tailWaitsï¼šæˆ‘æ‹¿èµ°ä¸€ä¸ªï¼Œä¸æ»¡äº†å™¢ï¼Œä½ ä»¬å¯ä»¥æ”¾äº†ï¼Œå› æ­¤ä»£ç æ”¹ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    E e;</span><br><span class="line">    headLock.lockInterruptibly();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—ç©ºç­‰å¾…</span></span><br><span class="line">        <span class="keyword">while</span> (isEmpty()) &#123;</span><br><span class="line">            headWaits.await();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸ç©ºåˆ™å‡ºé˜Ÿ</span></span><br><span class="line">        e = array[head];</span><br><span class="line">        <span class="keyword">if</span> (++head == array.length) &#123;</span><br><span class="line">            head = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¿®æ”¹ size</span></span><br><span class="line">        size.getAndDecrement();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é€šçŸ¥ tailWaits ä¸æ»¡ï¼ˆæœ‰é—®é¢˜ï¼‰</span></span><br><span class="line">        tailWaits.signal();</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        headLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜åœ¨äºè¦ä½¿ç”¨è¿™äº›æ¡ä»¶å˜é‡çš„ await()ï¼Œ signal() ç­‰æ–¹æ³•éœ€è¦å…ˆè·å¾—ä¸ä¹‹å…³è”çš„é”ï¼Œä¸Šé¢çš„ä»£ç è‹¥ç›´æ¥è¿è¡Œä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalMonitorStateException</span><br></pre></td></tr></table></figure><p>é‚£æœ‰åŒå­¦è¯´ï¼ŒåŠ ä¸Šé”ä¸å°±è¡Œäº†å—ï¼Œäºæ˜¯å†™å‡ºäº†ä¸‹é¢çš„ä»£ç </p><p><img src="https://s1.vika.cn/space/2023/03/30/0e648d2789674c95af79da50d9f8b1ec" alt="image-20230208160343493"></p><p>å‘ç°ä»€ä¹ˆé—®é¢˜äº†ï¼Ÿä¸¤æŠŠé”è¿™ä¹ˆåµŒå¥—ä½¿ç”¨ï¼Œéå¸¸å®¹æ˜“å‡ºç°æ­»é”ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><p><img src="https://s1.vika.cn/space/2023/03/30/0ba3185cf530499ba4f1d6d1c48d74b7" alt="image-20230208160143386"></p><p>å› æ­¤å¾—é¿å…åµŒå¥—ï¼Œä¸¤æ®µåŠ é”çš„ä»£ç å˜æˆäº†ä¸‹é¢å¹³çº§çš„æ ·å­</p><p><img src="https://s1.vika.cn/space/2023/03/30/591a629be97c4fb38f4f9956b15b99c2" alt="image-20230208162857435"></p><p>æ€§èƒ½è¿˜å¯ä»¥è¿›ä¸€æ­¥æå‡</p><ol><li><p>ä»£ç è°ƒæ•´å offer å¹¶æ²¡æœ‰åŒæ—¶è·å– tailLock å’Œ headLock ä¸¤æŠŠé”ï¼Œå› æ­¤ä¸¤æ¬¡åŠ é”ä¹‹é—´ä¼šæœ‰<strong>ç©ºéš™</strong>ï¼Œè¿™ä¸ªç©ºéš™å†…å¯èƒ½æœ‰å…¶å®ƒçš„ offer çº¿ç¨‹æ·»åŠ äº†æ›´å¤šçš„å…ƒç´ ï¼Œé‚£ä¹ˆè¿™äº›çº¿ç¨‹éƒ½è¦æ‰§è¡Œ signal()ï¼Œé€šçŸ¥ poll çº¿ç¨‹é˜Ÿåˆ—éç©ºå—ï¼Ÿ</p><ul><li>æ¯æ¬¡è°ƒç”¨ signal() éƒ½éœ€è¦è¿™äº› offer çº¿ç¨‹å…ˆè·å¾— headLock é”ï¼Œæˆæœ¬è¾ƒé«˜ï¼Œè¦æƒ³æ³•å‡å°‘ offer çº¿ç¨‹è·å¾— headLock é”çš„æ¬¡æ•°</li><li>å¯ä»¥åŠ ä¸€ä¸ªæ¡ä»¶ï¼šå½“ offer å¢åŠ å‰é˜Ÿåˆ—ä¸ºç©ºï¼Œå³ä» 0 å˜åŒ–åˆ°ä¸ç©ºï¼Œæ‰ç”±æ­¤ offer çº¿ç¨‹æ¥é€šçŸ¥ headWaitsï¼Œå…¶å®ƒæƒ…å†µä¸å½’å®ƒç®¡</li></ul></li><li><p>é˜Ÿåˆ—ä» 0 å˜åŒ–åˆ°ä¸ç©ºï¼Œä¼šå”¤é†’ä¸€ä¸ªç­‰å¾…çš„ poll çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹è¢«å”¤é†’åï¼Œè‚¯å®šèƒ½æ‹¿åˆ° headLock é”ï¼Œå› æ­¤å®ƒå…·å¤‡äº†å”¤é†’ headWaits ä¸Šå…¶å®ƒ poll çº¿ç¨‹çš„å…ˆå†³æ¡ä»¶ã€‚å¦‚æœæ£€æŸ¥å‡ºæ­¤æ—¶æœ‰å…¶å®ƒ offer çº¿ç¨‹æ–°å¢äº†å…ƒç´ ï¼ˆä¸ç©ºï¼Œä½†ä¸æ˜¯ä»0å˜åŒ–è€Œæ¥ï¼‰ï¼Œé‚£ä¹ˆä¸å¦¨ç”±æ­¤ poll çº¿ç¨‹æ¥å”¤é†’å…¶å®ƒ poll çº¿ç¨‹</p></li></ol><p>è¿™ä¸ªæŠ€å·§è¢«ç§°ä¹‹ä¸ºçº§è”é€šçŸ¥ï¼ˆcascading notifiesï¼‰ï¼Œç±»ä¼¼çš„åŸå› </p><ol start="3"><li>åœ¨ poll æ—¶é˜Ÿåˆ—ä»æ»¡å˜åŒ–åˆ°ä¸æ»¡ï¼Œæ‰ç”±æ­¤ poll çº¿ç¨‹æ¥å”¤é†’ä¸€ä¸ªç­‰å¾…çš„ offer çº¿ç¨‹ï¼Œç›®çš„ä¹Ÿæ˜¯ä¸ºäº†å‡å°‘ poll çº¿ç¨‹å¯¹ tailLock ä¸Šé”æ¬¡æ•°ï¼Œå‰©ä¸‹ç­‰å¾…çš„ offer çº¿ç¨‹ç”±è¿™ä¸ª offer çº¿ç¨‹é—´æ¥å”¤é†’</li></ol><p>æœ€ç»ˆçš„ä»£ç ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlockingQueue2</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">BlockingQueue</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> E[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">head</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">tail</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">size</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="type">ReentrantLock</span> <span class="variable">headLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="type">Condition</span> <span class="variable">headWaits</span> <span class="operator">=</span> headLock.newCondition();</span><br><span class="line">    <span class="type">ReentrantLock</span> <span class="variable">tailLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="type">Condition</span> <span class="variable">tailWaits</span> <span class="operator">=</span> tailLock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BlockingQueue2</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.array = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">offer</span><span class="params">(E e)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> c;</span><br><span class="line">        tailLock.lockInterruptibly();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (isFull()) &#123;</span><br><span class="line">                tailWaits.await();</span><br><span class="line">            &#125;</span><br><span class="line">            array[tail] = e;</span><br><span class="line">            <span class="keyword">if</span> (++tail == array.length) &#123;</span><br><span class="line">                tail = <span class="number">0</span>;</span><br><span class="line">            &#125;            </span><br><span class="line">            c = size.getAndIncrement();</span><br><span class="line">            <span class="comment">// a. é˜Ÿåˆ—ä¸æ»¡, ä½†ä¸æ˜¯ä»æ»¡-&gt;ä¸æ»¡, ç”±æ­¤offerçº¿ç¨‹å”¤é†’å…¶å®ƒofferçº¿ç¨‹</span></span><br><span class="line">            <span class="keyword">if</span> (c + <span class="number">1</span> &lt; array.length) &#123;</span><br><span class="line">                tailWaits.signal();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            tailLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// b. ä»0-&gt;ä¸ç©º, ç”±æ­¤offerçº¿ç¨‹å”¤é†’ç­‰å¾…çš„pollçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</span><br><span class="line">            headLock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                headWaits.signal();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                headLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        E e;</span><br><span class="line">        <span class="type">int</span> c;</span><br><span class="line">        headLock.lockInterruptibly();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (isEmpty()) &#123;</span><br><span class="line">                headWaits.await(); </span><br><span class="line">            &#125;</span><br><span class="line">            e = array[head]; </span><br><span class="line">            <span class="keyword">if</span> (++head == array.length) &#123;</span><br><span class="line">                head = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            c = size.getAndDecrement();</span><br><span class="line">            <span class="comment">// b. é˜Ÿåˆ—ä¸ç©º, ä½†ä¸æ˜¯ä»0å˜åŒ–åˆ°ä¸ç©ºï¼Œç”±æ­¤pollçº¿ç¨‹é€šçŸ¥å…¶å®ƒpollçº¿ç¨‹</span></span><br><span class="line">            <span class="keyword">if</span> (c &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                headWaits.signal();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            headLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// a. ä»æ»¡-&gt;ä¸æ»¡, ç”±æ­¤pollçº¿ç¨‹å”¤é†’ç­‰å¾…çš„offerçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> (c == array.length) &#123;</span><br><span class="line">            tailLock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                tailWaits.signal();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                tailLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size.get() == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size.get() == array.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒé”å®ç°çš„éå¸¸ç²¾å·§ï¼Œæ®è¯´ä½œè€… Doug Lea èŠ±äº†ä¸€å¹´çš„æ—¶é—´æ‰å®Œå–„äº†æ­¤æ®µä»£ç </p><h1 id="dui">å †</h1><p>ä»¥å¤§é¡¶å †ä¸ºä¾‹ï¼Œç›¸å¯¹äºä¹‹å‰çš„ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå¢åŠ äº†å †åŒ–ç­‰æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MaxHeap</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] array;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MaxHeap</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.array = <span class="keyword">new</span> <span class="title class_">int</span>[capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å †é¡¶å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å †é¡¶å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> array[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤å †é¡¶å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å †é¡¶å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">top</span> <span class="operator">=</span> array[<span class="number">0</span>];</span><br><span class="line">        swap(<span class="number">0</span>, size - <span class="number">1</span>);</span><br><span class="line">        size--;</span><br><span class="line">        down(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> top;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤æŒ‡å®šç´¢å¼•å¤„å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index ç´¢å¼•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¢«åˆ é™¤å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">poll</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">deleted</span> <span class="operator">=</span> array[index];</span><br><span class="line">        swap(index, size - <span class="number">1</span>);</span><br><span class="line">        size--;</span><br><span class="line">        down(index);</span><br><span class="line">        <span class="keyword">return</span> deleted;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›¿æ¢å †é¡¶å…ƒç´ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> replaced æ–°å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">replace</span><span class="params">(<span class="type">int</span> replaced)</span> &#123;</span><br><span class="line">        array[<span class="number">0</span>] = replaced;</span><br><span class="line">        down(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å †çš„å°¾éƒ¨æ·»åŠ å…ƒç´ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> offered æ–°å…ƒç´ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ˜¯å¦æ·»åŠ æˆåŠŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(<span class="type">int</span> offered)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (size == array.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        up(offered);</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† offered å…ƒç´ ä¸Šæµ®: ç›´è‡³ offered å°äºçˆ¶å…ƒç´ æˆ–åˆ°å †é¡¶</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">up</span><span class="params">(<span class="type">int</span> offered)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">child</span> <span class="operator">=</span> size;</span><br><span class="line">        <span class="keyword">while</span> (child &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">parent</span> <span class="operator">=</span> (child - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (offered &gt; array[parent]) &#123;</span><br><span class="line">                array[child] = array[parent];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            child = parent;</span><br><span class="line">        &#125;</span><br><span class="line">        array[child] = offered;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MaxHeap</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.array = array;</span><br><span class="line">        <span class="built_in">this</span>.size = array.length;</span><br><span class="line">        heapify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å»ºå †</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">heapify</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚ä½•æ‰¾åˆ°æœ€åè¿™ä¸ªéå¶å­èŠ‚ç‚¹  size / 2 - 1</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size / <span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            down(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°† parent ç´¢å¼•å¤„çš„å…ƒç´ ä¸‹æ½œ: ä¸ä¸¤ä¸ªå­©å­è¾ƒå¤§è€…äº¤æ¢, ç›´è‡³æ²¡å­©å­æˆ–å­©å­æ²¡å®ƒå¤§</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">down</span><span class="params">(<span class="type">int</span> parent)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> parent * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> left + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> parent;</span><br><span class="line">        <span class="keyword">if</span> (left &lt; size &amp;&amp; array[left] &gt; array[max]) &#123;</span><br><span class="line">            max = left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (right &lt; size &amp;&amp; array[right] &gt; array[max]) &#123;</span><br><span class="line">            max = right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (max != parent) &#123; <span class="comment">// æ‰¾åˆ°äº†æ›´å¤§çš„å­©å­</span></span><br><span class="line">            swap(max, parent);</span><br><span class="line">            down(max);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº¤æ¢ä¸¤ä¸ªç´¢å¼•å¤„çš„å…ƒç´ </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> array[i];</span><br><span class="line">        array[i] = array[j];</span><br><span class="line">        array[j] = t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] array = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125;;</span><br><span class="line">        <span class="type">MaxHeap</span> <span class="variable">maxHeap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MaxHeap</span>(array);</span><br><span class="line">        System.out.println(Arrays.toString(maxHeap.array));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å»ºå †</strong></p><p>Floyd å»ºå †ç®—æ³•ä½œè€…ï¼ˆä¹Ÿæ˜¯ä¹‹å‰é¾Ÿå…”èµ›è·‘åˆ¤ç¯ä½œè€…ï¼‰ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/30/4dd4561786f6436199cd00573622a1be" alt="image-20230213095110902"></p><ol><li>æ‰¾åˆ°æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹</li><li>ä»åå‘å‰ï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œä¸‹æ½œ</li></ol><p>ä¸€äº›è§„å¾‹</p><ul><li>ä¸€æ£µæ»¡äºŒå‰æ ‘èŠ‚ç‚¹ä¸ªæ•°ä¸º $2^h-1$ï¼Œå¦‚ä¸‹ä¾‹ä¸­é«˜åº¦ $h=3$ èŠ‚ç‚¹æ•°æ˜¯ $2^3-1=7$</li><li>éå¶å­èŠ‚ç‚¹èŒƒå›´ä¸º $[0, size/2-1]$</li></ul><p>ç®—æ³•æ—¶é—´å¤æ‚åº¦åˆ†æ</p><p><img src="https://s1.vika.cn/space/2023/03/30/ca64d8034ea14264bc9ea78901e1fc82" alt="image-20230213114024607"></p><p>ä¸‹é¢çœ‹äº¤æ¢æ¬¡æ•°çš„æ¨å¯¼ï¼šè®¾èŠ‚ç‚¹é«˜åº¦ä¸º 3</p><table><thead><tr><th></th><th>æœ¬å±‚èŠ‚ç‚¹æ•°</th><th>é«˜åº¦</th><th>ä¸‹æ½œæœ€å¤šäº¤æ¢æ¬¡æ•°ï¼ˆé«˜åº¦-1ï¼‰</th></tr></thead><tbody><tr><td>4567 è¿™å±‚</td><td>4</td><td>1</td><td>0</td></tr><tr><td>23è¿™å±‚</td><td>2</td><td>2</td><td>1</td></tr><tr><td>1è¿™å±‚</td><td>1</td><td>3</td><td>2</td></tr></tbody></table><p>æ¯ä¸€å±‚çš„äº¤æ¢æ¬¡æ•°ä¸ºï¼š$èŠ‚ç‚¹ä¸ªæ•°*æ­¤èŠ‚ç‚¹äº¤æ¢æ¬¡æ•°$ï¼Œæ€»çš„äº¤æ¢æ¬¡æ•°ä¸º<br>$$<br>\begin{aligned}<br>&amp; 4 * 0 + 2 * 1 + 1 * 2 \</p><p>&amp; \frac{8}{2}*0 + \frac{8}{4}*1 + \frac{8}{8}*2 \</p><p>&amp; \frac{8}{2^1}*0 + \frac{8}{2^2}*1 + \frac{8}{2^3}*2\</p><p>\end{aligned}<br>$$<br>å³<br>$$<br>\sum_{i=1}^{h}(\frac{2^h}{2^i}*(i-1))<br>$$<br>åœ¨ <a href="https://www.wolframalpha.com/">https://www.wolframalpha.com/</a> è¾“å…¥</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Sum</span>[\(<span class="number">40</span>)Divide[Power[<span class="number">2</span>,x],Power[<span class="number">2</span>,i]]*\(<span class="number">40</span>)i-<span class="number">1</span>\(<span class="number">41</span>)\(<span class="number">41</span>),&#123;i,<span class="number">1</span>,x&#125;]</span><br></pre></td></tr></table></figure><p>æ¨å¯¼å‡º<br>$$<br>2^h -h -1<br>$$<br>å…¶ä¸­ $2^h \approx n$ï¼Œ$h \approx \log_2{n}$ï¼Œå› æ­¤æœ‰æ—¶é—´å¤æ‚åº¦ $O(n)$</p><h1 id="er-cha-shu">äºŒå‰æ ‘</h1><p>äºŒå‰æ ‘æ˜¯è¿™ä¹ˆä¸€ç§æ ‘çŠ¶ç»“æ„ï¼šæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­©å­ï¼Œå·¦å­©å­å’Œå³å­©å­</p><p>é‡è¦çš„äºŒå‰æ ‘ç»“æ„</p><ul><li>å®Œå…¨äºŒå‰æ ‘ï¼ˆcomplete binary treeï¼‰æ˜¯ä¸€ç§äºŒå‰æ ‘ç»“æ„ï¼Œé™¤æœ€åä¸€å±‚ä»¥å¤–ï¼Œæ¯ä¸€å±‚éƒ½å¿…é¡»å¡«æ»¡ï¼Œå¡«å……æ—¶è¦éµä»å…ˆå·¦åå³</li><li>å¹³è¡¡äºŒå‰æ ‘ï¼ˆbalance binary treeï¼‰æ˜¯ä¸€ç§äºŒå‰æ ‘ç»“æ„ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦ç›¸å·®ä¸è¶…è¿‡ 1</li></ul><h2 id="cun-chu" id="å­˜å‚¨">å­˜å‚¨</h2><p>å­˜å‚¨æ–¹å¼åˆ†ä¸ºä¸¤ç§</p><ol><li>å®šä¹‰æ ‘èŠ‚ç‚¹ä¸å·¦ã€å³å­©å­å¼•ç”¨ï¼ˆTreeNodeï¼‰</li><li>ä½¿ç”¨æ•°ç»„ï¼Œå‰é¢è®²å †æ—¶ç”¨è¿‡ï¼Œè‹¥ä»¥ 0 ä½œä¸ºæ ‘çš„æ ¹ï¼Œç´¢å¼•å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¡ç®—<ul><li>çˆ¶ = floor((å­ - 1) / 2)</li><li>å·¦å­©å­ = çˆ¶ * 2 + 1</li><li>å³å­©å­ = çˆ¶ * 2 + 2</li></ul></li></ol><h2 id="bian-li" id="éå†">éå†</h2><p>éå†ä¹Ÿåˆ†ä¸ºä¸¤ç§</p><ol><li>å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBreadth-first orderï¼‰ï¼šå°½å¯èƒ½å…ˆè®¿é—®è·ç¦»æ ¹æœ€è¿‘çš„èŠ‚ç‚¹ï¼Œä¹Ÿç§°ä¸ºå±‚åºéå†</li><li>æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDepth-first orderï¼‰ï¼šå¯¹äºäºŒå‰æ ‘ï¼Œå¯ä»¥è¿›ä¸€æ­¥åˆ†æˆä¸‰ç§ï¼ˆè¦æ·±å…¥åˆ°å¶å­èŠ‚ç‚¹ï¼‰<ol><li>pre-order å‰åºéå†ï¼Œå¯¹äºæ¯ä¸€æ£µå­æ ‘ï¼Œå…ˆè®¿é—®è¯¥èŠ‚ç‚¹ï¼Œç„¶åæ˜¯å·¦å­æ ‘ï¼Œæœ€åæ˜¯å³å­æ ‘</li><li>in-order ä¸­åºéå†ï¼Œå¯¹äºæ¯ä¸€æ£µå­æ ‘ï¼Œå…ˆè®¿é—®å·¦å­æ ‘ï¼Œç„¶åæ˜¯è¯¥èŠ‚ç‚¹ï¼Œæœ€åæ˜¯å³å­æ ‘</li><li>post-order ååºéå†ï¼Œå¯¹äºæ¯ä¸€æ£µå­æ ‘ï¼Œå…ˆè®¿é—®å·¦å­æ ‘ï¼Œç„¶åæ˜¯å³å­æ ‘ï¼Œæœ€åæ˜¯è¯¥èŠ‚ç‚¹</li></ol></li></ol><h3 id="yan-du-you-xian" id="å¹¿åº¦ä¼˜å…ˆ">å¹¿åº¦ä¼˜å…ˆ</h3><p><img src="https://s1.vika.cn/space/2023/03/30/2a14b3daca8249808d8090805ceead75" alt="image-20230216153607396"></p><table><thead><tr><th>æœ¬è½®å¼€å§‹æ—¶é˜Ÿåˆ—</th><th>æœ¬è½®è®¿é—®èŠ‚ç‚¹</th></tr></thead><tbody><tr><td>[1]</td><td>1</td></tr><tr><td>[2, 3]</td><td>2</td></tr><tr><td>[3, 4]</td><td>3</td></tr><tr><td>[4, 5, 6]</td><td>4</td></tr><tr><td>[5, 6]</td><td>5</td></tr><tr><td>[6, 7, 8]</td><td>6</td></tr><tr><td>[7, 8]</td><td>7</td></tr><tr><td>[8]</td><td>8</td></tr><tr><td>[]</td><td></td></tr></tbody></table><ol><li>åˆå§‹åŒ–ï¼Œå°†æ ¹èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—</li><li>å¾ªç¯å¤„ç†é˜Ÿåˆ—ä¸­æ¯ä¸ªèŠ‚ç‚¹ï¼Œç›´è‡³é˜Ÿåˆ—ä¸ºç©º</li><li>æ¯æ¬¡å¾ªç¯å†…å¤„ç†èŠ‚ç‚¹åï¼Œå°†å®ƒçš„å­©å­èŠ‚ç‚¹ï¼ˆå³ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ï¼‰åŠ å…¥é˜Ÿåˆ—</li></ol><blockquote><p>æ³¨æ„</p><ul><li><p>ä»¥ä¸Šç”¨é˜Ÿåˆ—æ¥å±‚åºéå†æ˜¯é’ˆå¯¹  TreeNode è¿™ç§æ–¹å¼è¡¨ç¤ºçš„äºŒå‰æ ‘</p></li><li><p>å¯¹äºæ•°ç»„è¡¨ç°çš„äºŒå‰æ ‘ï¼Œåˆ™ç›´æ¥éå†æ•°ç»„å³å¯ï¼Œè‡ªç„¶ä¸ºå±‚åºéå†çš„é¡ºåº</p></li></ul></blockquote><h3 id="shen-du-you-xian" id="æ·±åº¦ä¼˜å…ˆ">æ·±åº¦ä¼˜å…ˆ</h3><p><img src="https://s1.vika.cn/space/2023/03/30/1b5b07565dc04a1aab3bcfe21e35d0ef" alt="image-20230221110443230"></p><table><thead><tr><th>æ ˆæš‚å­˜</th><th>å·²å¤„ç†</th><th>å‰åºéå†</th><th>ä¸­åºéå†</th></tr></thead><tbody><tr><td>[1]</td><td>1 âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤</td><td>1</td><td></td></tr><tr><td>[1, 2]</td><td>2âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤<br />1âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤</td><td>2</td><td></td></tr><tr><td>[1, 2, 4]</td><td>4âœ”ï¸ å·¦âœ”ï¸ å³âœ”ï¸<br />2âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤<br />1âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤</td><td>4</td><td>4</td></tr><tr><td>[1, 2]</td><td>2âœ”ï¸ å·¦âœ”ï¸ å³âœ”ï¸<br />1âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤</td><td></td><td>2</td></tr><tr><td>[1]</td><td>1âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤</td><td></td><td>1</td></tr><tr><td>[1, 3]</td><td>3âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤<br />1âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤</td><td>3</td><td></td></tr><tr><td>[1, 3, 5]</td><td>5âœ”ï¸ å·¦âœ”ï¸ å³âœ”ï¸<br />3âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤<br />1âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤</td><td>5</td><td>5</td></tr><tr><td>[1, 3]</td><td>3âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤<br />1âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤</td><td></td><td>3</td></tr><tr><td>[1, 3, 6]</td><td>6âœ”ï¸ å·¦âœ”ï¸ å³âœ”ï¸<br />3âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤<br />1âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤</td><td>6</td><td>6</td></tr><tr><td>[1, 3]</td><td>3âœ”ï¸ å·¦âœ”ï¸ å³âœ”ï¸<br />1âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤</td><td></td><td></td></tr><tr><td>[1]</td><td>1âœ”ï¸ å·¦âœ”ï¸ å³âœ”ï¸</td><td></td><td></td></tr><tr><td>[]</td><td></td><td></td><td></td></tr></tbody></table><h3 id="di-gui-shi-xian" id="é€’å½’å®ç°">é€’å½’å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;h3&gt;å‰åºéå†&lt;/h3&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> node èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">preOrder</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.print(node.val + <span class="string">&quot;\t&quot;</span>); <span class="comment">// å€¼</span></span><br><span class="line">    preOrder(node.left); <span class="comment">// å·¦</span></span><br><span class="line">    preOrder(node.right); <span class="comment">// å³</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;h3&gt;ä¸­åºéå†&lt;/h3&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> node èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">inOrder</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    inOrder(node.left); <span class="comment">// å·¦</span></span><br><span class="line">    System.out.print(node.val + <span class="string">&quot;\t&quot;</span>); <span class="comment">// å€¼</span></span><br><span class="line">    inOrder(node.right); <span class="comment">// å³</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;h3&gt;ååºéå†&lt;/h3&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> node èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">postOrder</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    postOrder(node.left); <span class="comment">// å·¦</span></span><br><span class="line">    postOrder(node.right); <span class="comment">// å³</span></span><br><span class="line">    System.out.print(node.val + <span class="string">&quot;\t&quot;</span>); <span class="comment">// å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="fei-di-gui-shi-xian" id="éé€’å½’å®ç°">éé€’å½’å®ç°</h3><p><strong>å‰åºéå†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">LinkedListStack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedListStack</span>&lt;&gt;();</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!stack.isEmpty() || curr != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        stack.push(curr);</span><br><span class="line">        System.out.println(curr);</span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">        curr = pop.right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸­åºéå†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">LinkedListStack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedListStack</span>&lt;&gt;();</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!stack.isEmpty() || curr != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        stack.push(curr);</span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">        System.out.println(pop);</span><br><span class="line">        curr = pop.right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ååºéå†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">LinkedListStack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedListStack</span>&lt;&gt;();</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!stack.isEmpty() || curr != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        stack.push(curr);</span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">peek</span> <span class="operator">=</span> stack.peek();</span><br><span class="line">        <span class="keyword">if</span> (peek.right == <span class="literal">null</span> || peek.right == pop) &#123;</span><br><span class="line">            pop = stack.pop();</span><br><span class="line">            System.out.println(pop);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            curr = peek.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºååºéå†ï¼Œå‘å›èµ°æ—¶ï¼Œéœ€è¦å¤„ç†å®Œå³å­æ ‘æ‰èƒ½ pop å‡ºæ ˆã€‚å¦‚ä½•çŸ¥é“å³å­æ ‘å¤„ç†å®Œæˆå‘¢ï¼Ÿ</p><ul><li><p>å¦‚æœæ ˆé¡¶å…ƒç´ çš„ $right \equiv null$ è¡¨ç¤ºæ²¡å•¥å¯å¤„ç†çš„ï¼Œå¯ä»¥å‡ºæ ˆ</p></li><li><p>å¦‚æœæ ˆé¡¶å…ƒç´ çš„ $right \neq null$ï¼Œ</p><ul><li>é‚£ä¹ˆä½¿ç”¨ lastPop è®°å½•æœ€è¿‘å‡ºæ ˆçš„èŠ‚ç‚¹ï¼Œå³è¡¨ç¤ºä»è¿™ä¸ªèŠ‚ç‚¹å‘å›èµ°</li><li>å¦‚æœæ ˆé¡¶å…ƒç´ çš„ $right==lastPop$ æ­¤æ—¶åº”å½“å‡ºæ ˆ</li></ul></li></ul><p>å¯¹äºå‰ã€ä¸­ä¸¤ç§éå†ï¼Œå®é™…ä»¥ä¸Šä»£ç ä»å³å­æ ‘å‘å›èµ°æ—¶ï¼Œå¹¶æœªèµ°å®Œå…¨ç¨‹ï¼ˆstack æå‰å‡ºæ ˆäº†ï¼‰ååºéå†ä»¥ä¸Šä»£ç æ˜¯èµ°å®Œå…¨ç¨‹äº†</p><p><strong>ç»Ÿä¸€å†™æ³•</strong></p><p>ä¸‹é¢æ˜¯ä¸€ç§ç»Ÿä¸€çš„å†™æ³•ï¼Œä¾æ®ååºéå†ä¿®æ”¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">LinkedList&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root; <span class="comment">// ä»£è¡¨å½“å‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// æœ€è¿‘ä¸€æ¬¡å¼¹æ ˆçš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">while</span> (curr != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        colorPrintln(<span class="string">&quot;å‰: &quot;</span> + curr.val, <span class="number">31</span>);</span><br><span class="line">        stack.push(curr); <span class="comment">// å‹å…¥æ ˆï¼Œä¸ºäº†è®°ä½å›æ¥çš„è·¯</span></span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">peek</span> <span class="operator">=</span> stack.peek();</span><br><span class="line">        <span class="comment">// å³å­æ ‘å¯ä»¥ä¸å¤„ç†, å¯¹ä¸­åºæ¥è¯´, è¦åœ¨å³å­æ ‘å¤„ç†ä¹‹å‰æ‰“å°</span></span><br><span class="line">        <span class="keyword">if</span> (peek.right == <span class="literal">null</span>) &#123;</span><br><span class="line">            colorPrintln(<span class="string">&quot;ä¸­: &quot;</span> + peek.val, <span class="number">36</span>);</span><br><span class="line">            pop = stack.pop();</span><br><span class="line">            colorPrintln(<span class="string">&quot;å: &quot;</span> + pop.val, <span class="number">34</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å³å­æ ‘å¤„ç†å®Œæˆ, å¯¹ä¸­åºæ¥è¯´, æ— éœ€æ‰“å°</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (peek.right == pop) &#123;</span><br><span class="line">            pop = stack.pop();</span><br><span class="line">            colorPrintln(<span class="string">&quot;å: &quot;</span> + pop.val, <span class="number">34</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å³å­æ ‘å¾…å¤„ç†, å¯¹ä¸­åºæ¥è¯´, è¦åœ¨å³å­æ ‘å¤„ç†ä¹‹å‰æ‰“å°</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            colorPrintln(<span class="string">&quot;ä¸­: &quot;</span> + peek.val, <span class="number">36</span>);</span><br><span class="line">            curr = peek.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">colorPrintln</span><span class="params">(String origin, <span class="type">int</span> color)</span> &#123;</span><br><span class="line">    System.out.printf(<span class="string">&quot;\033[%dm%s\033[0m%n&quot;</span>, color, origin);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€å¼ å›¾æ¼”ç¤ºä¸‰ç§éå†</p><p><img src="https://s1.vika.cn/space/2023/03/30/c303e97bbc8447ccb578a432c92a060f" alt="Sorted_binary_tree_ALL_RGB.svg"></p><ul><li>çº¢è‰²ï¼šå‰åºéå†é¡ºåº</li><li>ç»¿è‰²ï¼šä¸­åºéå†é¡ºåº</li><li>è“è‰²ï¼šåç»­éå†é¡ºåº</li></ul>]]></content>
    
    
    <summary type="html">åŸºæœ¬æ•°æ®ç»“æ„ä»‹ç»</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://www.taoyaopc.live/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="Java" scheme="https://www.taoyaopc.live/tags/Java/"/>
    
    <category term="ç®—æ³•" scheme="https://www.taoyaopc.live/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Rediså®æˆ˜ç¯‡2</title>
    <link href="https://www.taoyaopc.live/posts/741809b2.html"/>
    <id>https://www.taoyaopc.live/posts/741809b2.html</id>
    <published>2023-03-29T08:30:00.000Z</published>
    <updated>2023-04-04T14:55:25.757Z</updated>
    
    <content type="html"><![CDATA[<h1 id="miao-sha-you-hua">ç§’æ€ä¼˜åŒ–</h1><h2 id="miao-sha-you-hua-yi-bu-miao-sha-si-lu" id="ç§’æ€ä¼˜åŒ–-å¼‚æ­¥ç§’æ€æ€è·¯">ç§’æ€ä¼˜åŒ–-å¼‚æ­¥ç§’æ€æ€è·¯</h2><p>æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ä¸‹å•æµç¨‹</p><p>å½“ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼Œæ­¤æ—¶ä¼šè¯·æ±‚nginxï¼Œnginxä¼šè®¿é—®åˆ°tomcatï¼Œè€Œtomcatä¸­çš„ç¨‹åºï¼Œä¼šè¿›è¡Œä¸²è¡Œæ“ä½œï¼Œåˆ†æˆå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤</p><ol><li><p>æŸ¥è¯¢ä¼˜æƒ å·</p></li><li><p>åˆ¤æ–­ç§’æ€åº“å­˜æ˜¯å¦è¶³å¤Ÿ</p></li><li><p>æŸ¥è¯¢è®¢å•</p></li><li><p>æ ¡éªŒæ˜¯å¦æ˜¯ä¸€äººä¸€å•</p></li><li><p>æ‰£å‡åº“å­˜</p></li><li><p>åˆ›å»ºè®¢å•</p></li></ol><p>åœ¨è¿™å…­æ­¥æ“ä½œä¸­ï¼Œåˆæœ‰å¾ˆå¤šæ“ä½œæ˜¯è¦å»æ“ä½œæ•°æ®åº“çš„ï¼Œè€Œä¸”è¿˜æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œ è¿™æ ·å°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºæ‰§è¡Œçš„å¾ˆæ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼‚æ­¥ç¨‹åºæ‰§è¡Œï¼Œé‚£ä¹ˆå¦‚ä½•åŠ é€Ÿå‘¢ï¼Ÿ</p><p>åœ¨è¿™é‡Œç¬”è€…æƒ³ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹è¯¾ç¨‹å†…æ²¡æœ‰çš„æ€è·¯ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å°ä¼™ä¼´è¿™ä¹ˆæƒ³ï¼Œ</p><ul><li>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å¯ä»¥ä½¿ç”¨å¼‚æ­¥ç¼–æ’æ¥åšï¼Œæˆ–è€…è¯´æˆ‘å¼€å¯Nå¤šçº¿ç¨‹ï¼ŒNå¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒæŸ¥è¯¢ä¼˜æƒ å·ï¼Œä¸€ä¸ªæ‰§è¡Œåˆ¤æ–­æ‰£å‡åº“å­˜ï¼Œä¸€ä¸ªå»åˆ›å»ºè®¢å•ç­‰ç­‰ï¼Œç„¶åå†ç»Ÿä¸€åšè¿”å›ï¼Œ</li><li>è¿™ç§åšæ³•å’Œè¯¾ç¨‹ä¸­æœ‰å“ªç§å¥½å‘¢ï¼Ÿ<ul><li>ç­”æ¡ˆæ˜¯è¯¾ç¨‹ä¸­çš„å¥½ï¼Œå› ä¸ºå¦‚æœä½ é‡‡ç”¨æˆ‘åˆšè¯´çš„æ–¹å¼ï¼Œå¦‚æœè®¿é—®çš„äººå¾ˆå¤šï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯èƒ½ä¸€ä¸‹å­å°±è¢«æ¶ˆè€—å®Œäº†ï¼Œ</li><li>è€Œä¸”ä½ ä½¿ç”¨ä¸Šè¿°æ–¹æ¡ˆï¼Œæœ€å¤§çš„ç‰¹ç‚¹åœ¨äºï¼Œ<u>ä½ è§‰å¾—æ—¶æ•ˆæ€§ä¼šéå¸¸é‡è¦</u>ï¼Œ</li><li>ä½†æ˜¯ä½ æƒ³æƒ³æ˜¯å—ï¼Ÿå¹¶ä¸æ˜¯ï¼Œæ¯”å¦‚<u>æˆ‘åªè¦ç¡®å®šä»–èƒ½åšè¿™ä»¶äº‹ï¼Œç„¶åæˆ‘åè¾¹æ…¢æ…¢åšå°±å¯ä»¥äº†ï¼Œæˆ‘å¹¶ä¸éœ€è¦ä»–ä¸€å£æ°”åšå®Œè¿™ä»¶äº‹ï¼Œ</u></li><li>æ‰€ä»¥æˆ‘ä»¬åº”å½“é‡‡ç”¨çš„æ˜¯è¯¾ç¨‹ä¸­ï¼Œ<u>ç±»ä¼¼æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼</u>æ¥å®Œæˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œè€Œä¸æ˜¯ä½¿ç”¨çº¿ç¨‹æ± æˆ–è€…æ˜¯å¼‚æ­¥ç¼–æ’çš„æ–¹å¼æ¥å®Œæˆè¿™ä¸ªéœ€æ±‚</li></ul></li></ul><p><img src="https://s1.vika.cn/space/2023/04/01/baef856bfdc545509138a989c38dd90a" alt="1653560986599"></p><p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>ï¼šæˆ‘ä»¬å°†è€—æ—¶æ¯”è¾ƒçŸ­çš„é€»è¾‘åˆ¤æ–­æ”¾å…¥åˆ°redisä¸­ï¼Œ</p><ul><li>æ¯”å¦‚æ˜¯å¦åº“å­˜è¶³å¤Ÿï¼Œæ¯”å¦‚æ˜¯å¦ä¸€äººä¸€å•ï¼Œè¿™æ ·çš„æ“ä½œï¼Œåªè¦è¿™ç§é€»è¾‘å¯ä»¥å®Œæˆï¼Œå°±æ„å‘³ç€æˆ‘ä»¬æ˜¯ä¸€å®šå¯ä»¥ä¸‹å•å®Œæˆçš„ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›è¡Œå¿«é€Ÿçš„é€»è¾‘åˆ¤æ–­ï¼Œæ ¹æœ¬å°±ä¸ç”¨ç­‰ä¸‹å•é€»è¾‘èµ°å®Œï¼Œæˆ‘ä»¬ç›´æ¥ç»™ç”¨æˆ·è¿”å›æˆåŠŸï¼Œ</li><li>å†åœ¨åå°å¼€ä¸€ä¸ªçº¿ç¨‹ï¼Œåå°çº¿ç¨‹æ…¢æ…¢çš„å»æ‰§è¡Œqueueé‡Œè¾¹çš„æ¶ˆæ¯ï¼Œè¿™æ ·ç¨‹åºä¸å°±è¶…çº§å¿«äº†å—ï¼Ÿè€Œä¸”ä¹Ÿä¸ç”¨æ‹…å¿ƒçº¿ç¨‹æ± æ¶ˆè€—æ®†å°½çš„é—®é¢˜ï¼Œå› ä¸ºè¿™é‡Œæˆ‘ä»¬çš„ç¨‹åºä¸­å¹¶æ²¡æœ‰æ‰‹åŠ¨ä½¿ç”¨ä»»ä½•çº¿ç¨‹æ± ï¼Œ</li></ul><p>å½“ç„¶è¿™é‡Œè¾¹æœ‰ä¸¤ä¸ªéš¾ç‚¹</p><ol><li><p>ç¬¬ä¸€ä¸ªéš¾ç‚¹æ˜¯æˆ‘ä»¬æ€ä¹ˆåœ¨redisä¸­å»å¿«é€Ÿæ ¡éªŒä¸€äººä¸€å•ï¼Œè¿˜æœ‰åº“å­˜åˆ¤æ–­</p></li><li><p>ç¬¬äºŒä¸ªéš¾ç‚¹æ˜¯ç”±äºæˆ‘ä»¬æ ¡éªŒå’Œtomctä¸‹å•æ˜¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•çŸ¥é“åˆ°åº•å“ªä¸ªå•ä»–æœ€åæ˜¯å¦æˆåŠŸï¼Œæˆ–è€…æ˜¯ä¸‹å•å®Œæˆï¼Œä¸ºäº†å®Œæˆè¿™ä»¶äº‹æˆ‘ä»¬åœ¨redisæ“ä½œå®Œä¹‹åï¼Œæˆ‘ä»¬ä¼šå°†ä¸€äº›ä¿¡æ¯è¿”å›ç»™å‰ç«¯ï¼ŒåŒæ—¶ä¹Ÿä¼šæŠŠè¿™äº›ä¿¡æ¯ä¸¢åˆ°å¼‚æ­¥queueä¸­å»ï¼Œåç»­æ“ä½œä¸­ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªidæ¥æŸ¥è¯¢æˆ‘ä»¬tomcatä¸­çš„ä¸‹å•é€»è¾‘æ˜¯å¦å®Œæˆäº†ã€‚</p></li></ol><p><img src="https://s1.vika.cn/space/2023/04/01/8a9eca85ecbf4dfbaa5fe4981f5936da" alt="1653561657295"></p><p>æˆ‘ä»¬ç°åœ¨æ¥çœ‹çœ‹æ•´ä½“æ€è·¯ï¼š</p><ul><li>å½“ç”¨æˆ·ä¸‹å•ä¹‹åï¼Œåˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³åªéœ€è¦å¯¼redisä¸­å»æ ¹æ®keyæ‰¾å¯¹åº”çš„valueæ˜¯å¦å¤§äº0å³å¯ï¼Œ</li><li>å¦‚æœä¸å……è¶³ï¼Œåˆ™ç›´æ¥ç»“æŸï¼Œå¦‚æœå……è¶³ï¼Œç»§ç»­åœ¨redisä¸­åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å¯ä»¥ä¸‹å•ï¼Œ</li><li>å¦‚æœseté›†åˆä¸­æ²¡æœ‰è¿™æ¡æ•°æ®ï¼Œè¯´æ˜ä»–å¯ä»¥ä¸‹å•ï¼Œå¦‚æœseté›†åˆä¸­æ²¡æœ‰è¿™æ¡è®°å½•ï¼Œåˆ™å°†userIdå’Œä¼˜æƒ å·å­˜å…¥åˆ°redisä¸­ï¼Œå¹¶ä¸”è¿”å›0ï¼Œ</li><li>æ•´ä¸ªè¿‡ç¨‹éœ€è¦ä¿è¯æ˜¯åŸå­æ€§çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨luaæ¥æ“ä½œ</li></ul><p>å½“ä»¥ä¸Šåˆ¤æ–­é€»è¾‘èµ°å®Œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­å½“å‰redisä¸­è¿”å›çš„ç»“æœæ˜¯å¦æ˜¯0 ï¼Œå¦‚æœæ˜¯0ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥ä¸‹å•ï¼Œåˆ™å°†ä¹‹å‰è¯´çš„ä¿¡æ¯å­˜å…¥åˆ°åˆ°queueä¸­å»ï¼Œç„¶åè¿”å›ï¼Œç„¶åå†æ¥ä¸ªçº¿ç¨‹å¼‚æ­¥çš„ä¸‹å•ï¼Œå‰ç«¯å¯ä»¥é€šè¿‡è¿”å›çš„è®¢å•idæ¥åˆ¤æ–­æ˜¯å¦ä¸‹å•æˆåŠŸã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/01/b39dc8c049214c5e8433adc188b4e694" alt="1653562234886"></p><h2 id="miao-sha-you-hua-redis-wan-cheng-miao-sha-zi-ge-pan-duan" id="ç§’æ€ä¼˜åŒ–-Rediså®Œæˆç§’æ€èµ„æ ¼åˆ¤æ–­">ç§’æ€ä¼˜åŒ–-Rediså®Œæˆç§’æ€èµ„æ ¼åˆ¤æ–­</h2><blockquote><p>éœ€æ±‚ï¼š</p><ul><li><p>æ–°å¢ç§’æ€ä¼˜æƒ åˆ¸çš„åŒæ—¶ï¼Œå°†ä¼˜æƒ åˆ¸ä¿¡æ¯ä¿å­˜åˆ°Redisä¸­</p></li><li><p>åŸºäºLuaè„šæœ¬ï¼Œåˆ¤æ–­ç§’æ€åº“å­˜ã€ä¸€äººä¸€å•ï¼Œå†³å®šç”¨æˆ·æ˜¯å¦æŠ¢è´­æˆåŠŸ</p></li><li><p>å¦‚æœæŠ¢è´­æˆåŠŸï¼Œå°†ä¼˜æƒ åˆ¸idå’Œç”¨æˆ·idå°è£…åå­˜å…¥é˜»å¡é˜Ÿåˆ—</p></li><li><p>å¼€å¯çº¿ç¨‹ä»»åŠ¡ï¼Œä¸æ–­ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä¿¡æ¯ï¼Œå®ç°å¼‚æ­¥ä¸‹å•åŠŸèƒ½</p></li></ul></blockquote><p><img src="https://s1.vika.cn/space/2023/04/01/f881939ad99f47549222489607cebcf8" alt="1656080546603"></p><div class="tabs" id="ç§’æ€ä¼˜åŒ–"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#ç§’æ€ä¼˜åŒ–-1">æ·»åŠ ç§’æ€åˆ¸åˆ°Redisä¸­</button></li><li class="tab"><button type="button" data-href="#ç§’æ€ä¼˜åŒ–-2">å®Œæ•´luaè¡¨è¾¾å¼</button></li><li class="tab"><button type="button" data-href="#ç§’æ€ä¼˜åŒ–-3">åç»­æ­¥éª¤</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="ç§’æ€ä¼˜åŒ–-1"><ul><li>æ–°å¢ç§’æ€ä¼˜æƒ åˆ¸çš„åŒæ—¶ï¼Œå°†ä¼˜æƒ åˆ¸ä¿¡æ¯ä¿å­˜åˆ°Redisä¸­</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSeckillVoucher</span><span class="params">(Voucher voucher)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜ä¼˜æƒ åˆ¸</span></span><br><span class="line">    save(voucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€ä¿¡æ¯</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">seckillVoucher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SeckillVoucher</span>();</span><br><span class="line">    seckillVoucher.setVoucherId(voucher.getId());</span><br><span class="line">    seckillVoucher.setStock(voucher.getStock());</span><br><span class="line">    seckillVoucher.setBeginTime(voucher.getBeginTime());</span><br><span class="line">    seckillVoucher.setEndTime(voucher.getEndTime());</span><br><span class="line">    seckillVoucherService.save(seckillVoucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€åº“å­˜åˆ°Redisä¸­</span></span><br><span class="line">    <span class="comment">//SECKILL_STOCK_KEY è¿™ä¸ªå˜é‡å®šä¹‰åœ¨RedisConstansä¸­</span></span><br><span class="line">    <span class="comment">//private static final String SECKILL_STOCK_KEY =&quot;seckill:stock:&quot;</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(SECKILL_STOCK_KEY + voucher.getId(), voucher.getStock().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ç§’æ€ä¼˜åŒ–-2"><ul><li><p>åŸºäºLuaè„šæœ¬ï¼Œåˆ¤æ–­ç§’æ€åº“å­˜ã€ä¸€äººä¸€å•ï¼Œå†³å®šç”¨æˆ·æ˜¯å¦æŠ¢è´­æˆåŠŸ</p></li><li><p>å¦‚æœæŠ¢è´­æˆåŠŸï¼Œå°†ä¼˜æƒ åˆ¸idå’Œç”¨æˆ·idå°è£…åå­˜å…¥é˜»å¡é˜Ÿåˆ—</p></li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.å‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="comment">-- 1.1.ä¼˜æƒ åˆ¸id</span></span><br><span class="line"><span class="keyword">local</span> voucherId = ARGV[<span class="number">1</span>]</span><br><span class="line"><span class="comment">-- 1.2.ç”¨æˆ·id</span></span><br><span class="line"><span class="keyword">local</span> userId = ARGV[<span class="number">2</span>]</span><br><span class="line"><span class="comment">-- 1.3.è®¢å•id</span></span><br><span class="line"><span class="keyword">local</span> orderId = ARGV[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2.æ•°æ®key</span></span><br><span class="line"><span class="comment">-- 2.1.åº“å­˜key</span></span><br><span class="line"><span class="keyword">local</span> stockKey = <span class="string">&#x27;seckill:stock:&#x27;</span> .. voucherId</span><br><span class="line"><span class="comment">-- 2.2.è®¢å•key</span></span><br><span class="line"><span class="keyword">local</span> orderKey = <span class="string">&#x27;seckill:order:&#x27;</span> .. voucherId</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3.è„šæœ¬ä¸šåŠ¡</span></span><br><span class="line"><span class="comment">-- 3.1.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ get stockKey</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">tonumber</span>(redis.call(<span class="string">&#x27;get&#x27;</span>, stockKey)) &lt;= <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 3.2.åº“å­˜ä¸è¶³ï¼Œè¿”å›1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 3.2.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸‹å• SISMEMBER orderKey userId</span></span><br><span class="line"><span class="keyword">if</span>(redis.call(<span class="string">&#x27;sismember&#x27;</span>, orderKey, userId) == <span class="number">1</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 3.3.å­˜åœ¨ï¼Œè¯´æ˜æ˜¯é‡å¤ä¸‹å•ï¼Œè¿”å›2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 3.4.æ‰£åº“å­˜ incrby stockKey -1</span></span><br><span class="line">redis.call(<span class="string">&#x27;incrby&#x27;</span>, stockKey, <span class="number">-1</span>)</span><br><span class="line"><span class="comment">-- 3.5.ä¸‹å•ï¼ˆä¿å­˜ç”¨æˆ·ï¼‰sadd orderKey userId</span></span><br><span class="line">redis.call(<span class="string">&#x27;sadd&#x27;</span>, orderKey, userId)</span><br><span class="line"><span class="comment">-- 3.6.å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ï¼Œ XADD stream.orders * k1 v1 k2 v2 ...</span></span><br><span class="line">redis.call(<span class="string">&#x27;xadd&#x27;</span>, <span class="string">&#x27;stream.orders&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;userId&#x27;</span>, userId, <span class="string">&#x27;voucherId&#x27;</span>, voucherId, <span class="string">&#x27;id&#x27;</span>, orderId)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>å½“ä»¥ä¸Šluaè¡¨è¾¾å¼æ‰§è¡Œå®Œæ¯•åï¼Œå‰©ä¸‹çš„å°±æ˜¯æ ¹æ®æ­¥éª¤3,4æ¥æ‰§è¡Œæˆ‘ä»¬æ¥ä¸‹æ¥çš„ä»»åŠ¡äº†</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="ç§’æ€ä¼˜åŒ–-3"><ul><li>å¼€å¯çº¿ç¨‹ä»»åŠ¡ï¼Œä¸æ–­ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä¿¡æ¯ï¼Œå®ç°å¼‚æ­¥ä¸‹å•åŠŸèƒ½</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">    <span class="comment">//è·å–ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    <span class="comment">// 1.æ‰§è¡Œluaè„šæœ¬</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> stringRedisTemplate.execute(</span><br><span class="line">            SECKILL_SCRIPT,</span><br><span class="line">            Collections.emptyList(),</span><br><span class="line">            voucherId.toString(), userId.toString(), String.valueOf(orderId)</span><br><span class="line">    );</span><br><span class="line">    <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> result.intValue();</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0</span></span><br><span class="line">    <span class="keyword">if</span> (r != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 2.1.ä¸ä¸º0 ï¼Œä»£è¡¨æ²¡æœ‰è´­ä¹°èµ„æ ¼</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(r == <span class="number">1</span> ? <span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span> : <span class="string">&quot;ä¸èƒ½é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//TODO ä¿å­˜é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="comment">// 3.è¿”å›è®¢å•id</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="miao-sha-you-hua-ji-yu-zu-sai-dui-lie-shi-xian-miao-sha-you-hua" id="ç§’æ€ä¼˜åŒ–-åŸºäºé˜»å¡é˜Ÿåˆ—å®ç°ç§’æ€ä¼˜åŒ–">ç§’æ€ä¼˜åŒ–-åŸºäºé˜»å¡é˜Ÿåˆ—å®ç°ç§’æ€ä¼˜åŒ–</h2><p><strong>VoucherOrderServiceImpl</strong></p><p>ä¿®æ”¹ä¸‹å•åŠ¨ä½œï¼Œç°åœ¨æˆ‘ä»¬å»ä¸‹å•æ—¶ï¼Œæ˜¯é€šè¿‡luaè¡¨è¾¾å¼å»åŸå­æ‰§è¡Œåˆ¤æ–­é€»è¾‘ï¼Œ</p><ul><li>å¦‚æœåˆ¤æ–­æˆ‘å‡ºæ¥ä¸ä¸º0 ï¼Œåˆ™è¦ä¹ˆæ˜¯åº“å­˜ä¸è¶³ï¼Œè¦ä¹ˆæ˜¯é‡å¤ä¸‹å•ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œ</li><li>å¦‚æœæ˜¯0ï¼Œåˆ™æŠŠä¸‹å•çš„é€»è¾‘ä¿å­˜åˆ°é˜Ÿåˆ—ä¸­å»ï¼Œç„¶åå¼‚æ­¥æ‰§è¡Œ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> BlockingQueue&lt;VoucherOrder&gt; orderTasks = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line"><span class="keyword">private</span> <span class="type">ExecutorService</span> <span class="variable">SECKILL_ORDER_EXECUTOR</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    SECKILL_ORDER_EXECUTOR.submit(<span class="keyword">new</span> <span class="title class_">VoucherOrderHandler</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 1. è·å–é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯</span></span><br><span class="line">                <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> orderTasks.take();</span><br><span class="line">                <span class="comment">// 2. åˆ›å»ºè®¢å•</span></span><br><span class="line">                handleVoucherOrder(voucherOrder);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleVoucherOrder</span><span class="params">(VoucherOrder voucherOrder)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> voucherOrder.getUserId();</span><br><span class="line">    <span class="comment">// 2. åˆ›å»ºé”å¯¹è±¡</span></span><br><span class="line">    <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;lock:order:&quot;</span> + userId);</span><br><span class="line">    <span class="comment">// 3. è·å–é”</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock();</span><br><span class="line">    <span class="comment">// 4. åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span>(!isLock) &#123;</span><br><span class="line">        <span class="comment">// è·å–é”å¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯æˆ–é‡è¯•</span></span><br><span class="line">        log.error(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        proxy.createVoucherOrder(voucherOrder);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> IVoucherOrderService proxy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 1. æ‰§è¡Œluaè„šæœ¬</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> stringRedisTemplate.execute(</span><br><span class="line">            SECKILL_SCRIPT,</span><br><span class="line">            Collections.emptyList(),</span><br><span class="line">            voucherId.toString(), userId.toString()</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 2. åˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> result.intValue();</span><br><span class="line">    <span class="keyword">if</span>(r != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 2.1 ä¸ä¸º0ï¼Œä»£è¡¨æ²¡æœ‰è´­ä¹°èµ„æ ¼</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(r == <span class="number">1</span> ? <span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span> : <span class="string">&quot;ä¸èƒ½é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.2 ä¸º0ï¼Œæœ‰è´­ä¹°èµ„æ ¼ï¼ŒæŠŠä¸‹å•ä¿¡æ¯ä¿å­˜åˆ°é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="comment">// 2.3 åˆ›å»ºè®¢å•</span></span><br><span class="line">    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">    <span class="comment">// 2.4 è®¢å•id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    voucherOrder.setId(orderId);</span><br><span class="line">    <span class="comment">// 2.5 ç”¨æˆ·id</span></span><br><span class="line">    voucherOrder.setUserId(userId);</span><br><span class="line">    <span class="comment">// 2.6 ä»£é‡‘åˆ¸id</span></span><br><span class="line">    voucherOrder.setVoucherId(voucherId);</span><br><span class="line">    <span class="comment">// 2.7 æ”¾å…¥é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">    orderTasks.add(voucherOrder);</span><br><span class="line">    <span class="comment">// 3. è·å–ä»£ç†å¯¹è±¡</span></span><br><span class="line">    proxy = (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">    <span class="comment">// 3. è¿”å›è®¢å•idâ€˜</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createVoucherOrder</span><span class="params">(VoucherOrder voucherOrder)</span> &#123;</span><br><span class="line">    <span class="comment">// 5. ä¸€äººä¸€å•</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> voucherOrder.getUserId();</span><br><span class="line">    <span class="comment">// 5.1 æŸ¥è¯¢è®¢å•</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()).count();</span><br><span class="line">    <span class="comment">// 5.2 åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">        log.error(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 6. æ‰£å‡åº“å­˜</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>)</span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()).gt(<span class="string">&quot;stock&quot;</span>, <span class="number">0</span>)</span><br><span class="line">            .update();</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="comment">// æ‰£æ¬¾å¤±è´¥</span></span><br><span class="line">        log.error(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    save(voucherOrder);</span><br><span class="line">    <span class="comment">// 8. è¿”å›è®¢å•id</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å°æ€»ç»“ï¼š</strong></p><p>ç§’æ€ä¸šåŠ¡çš„ä¼˜åŒ–æ€è·¯æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>å…ˆåˆ©ç”¨Rediså®Œæˆåº“å­˜ä½™é‡ã€ä¸€äººä¸€å•åˆ¤æ–­ï¼Œå®ŒæˆæŠ¢å•ä¸šåŠ¡</li><li>å†å°†ä¸‹å•ä¸šåŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—ï¼Œåˆ©ç”¨ç‹¬ç«‹çº¿ç¨‹å¼‚æ­¥ä¸‹å•</li><li>åŸºäºé˜»å¡é˜Ÿåˆ—çš„å¼‚æ­¥ç§’æ€å­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿ<ul><li>å†…å­˜é™åˆ¶é—®é¢˜</li><li>æ•°æ®å®‰å…¨é—®é¢˜</li></ul></li></ul><h1 id="redis-xiao-xi-dui-lie">Redisæ¶ˆæ¯é˜Ÿåˆ—</h1><h2 id="redis-xiao-xi-dui-lie-ren-shi-xiao-xi-dui-lie" id="Redisæ¶ˆæ¯é˜Ÿåˆ—-è®¤è¯†æ¶ˆæ¯é˜Ÿåˆ—">Redisæ¶ˆæ¯é˜Ÿåˆ—-è®¤è¯†æ¶ˆæ¯é˜Ÿåˆ—</h2><p>ä»€ä¹ˆæ˜¯<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šå­—é¢æ„æ€å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚æœ€ç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹åŒ…æ‹¬3ä¸ªè§’è‰²ï¼š</p><ul><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šå­˜å‚¨å’Œç®¡ç†æ¶ˆæ¯ï¼Œä¹Ÿè¢«ç§°ä¸ºæ¶ˆæ¯ä»£ç†ï¼ˆMessage Brokerï¼‰</li><li>ç”Ÿäº§è€…ï¼šå‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—</li><li>æ¶ˆè´¹è€…ï¼šä»æ¶ˆæ¯é˜Ÿåˆ—è·å–æ¶ˆæ¯å¹¶å¤„ç†æ¶ˆæ¯</li></ul><p><strong>Redis</strong>æä¾›äº†ä¸‰ç§ä¸åŒçš„æ–¹å¼æ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p><ul><li>list ç»“æ„ï¼šåŸºäºList ç»“æ„æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—</li><li>PubSubï¼šåŸºæœ¬çš„ç‚¹å¯¹ç‚¹æ¶ˆæ¯æ¨¡å‹</li><li>Streamï¼šæ¯”è¾ƒå®Œå–„çš„æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹</li></ul><p><img src="https://s1.vika.cn/space/2023/04/02/572e7815f0c540e694ee4eaea7c0e396" alt="1653574849336"></p><p>ä½¿ç”¨é˜Ÿåˆ—çš„å¥½å¤„åœ¨äº **è§£è€¦ï¼š**æ‰€è°“è§£è€¦ï¼Œ</p><ul><li>ä¸¾ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­å°±æ˜¯ï¼šå¿«é€’å‘˜(ç”Ÿäº§è€…)æŠŠå¿«é€’æ”¾åˆ°å¿«é€’æŸœé‡Œè¾¹(Message Queue)å»ï¼Œ</li><li>æˆ‘ä»¬(æ¶ˆè´¹è€…)ä»å¿«é€’æŸœé‡Œè¾¹å»æ‹¿ä¸œè¥¿ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥ï¼Œ<ul><li>å¦‚æœè€¦åˆï¼Œé‚£ä¹ˆè¿™ä¸ªå¿«é€’å‘˜ç›¸å½“äºç›´æ¥æŠŠå¿«é€’äº¤ç»™ä½ ï¼Œè¿™äº‹å›ºç„¶å¥½ï¼Œ</li><li>ä½†æ˜¯ä¸‡ä¸€ä½ ä¸åœ¨å®¶ï¼Œé‚£ä¹ˆå¿«é€’å‘˜å°±ä¼šä¸€ç›´ç­‰ä½ ï¼Œè¿™å°±æµªè´¹äº†å¿«é€’å‘˜çš„æ—¶é—´ï¼Œæ‰€ä»¥è¿™ç§æ€æƒ³åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ï¼Œæ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚</li></ul></li></ul><p>è¿™ç§åœºæ™¯åœ¨æˆ‘ä»¬ç§’æ€ä¸­å°±å˜æˆäº†ï¼š</p><ul><li>æˆ‘ä»¬ä¸‹å•ä¹‹åï¼Œåˆ©ç”¨rediså»è¿›è¡Œæ ¡éªŒä¸‹å•æ¡ä»¶ï¼Œå†é€šè¿‡é˜Ÿåˆ—æŠŠæ¶ˆæ¯å‘é€å‡ºå»ï¼Œ</li><li>ç„¶åå†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å»æ¶ˆè´¹è¿™ä¸ªæ¶ˆæ¯ï¼Œå®Œæˆè§£è€¦ï¼ŒåŒæ—¶ä¹ŸåŠ å¿«æˆ‘ä»¬çš„å“åº”é€Ÿåº¦ã€‚</li></ul><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›ç°æˆçš„mqï¼Œæ¯”å¦‚kafkaï¼Œrabbitmqç­‰ç­‰ï¼Œä½†æ˜¯å‘¢ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…mqï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨redisæä¾›çš„mqæ–¹æ¡ˆï¼Œé™ä½æˆ‘ä»¬çš„éƒ¨ç½²å’Œå­¦ä¹ æˆæœ¬ã€‚</p><h2 id="redis-xiao-xi-dui-lie-ji-yu-list-shi-xian-xiao-xi-dui-lie" id="Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—">Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—</h2><p><strong>åŸºäºListç»“æ„æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—</strong></p><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ï¼Œå­—é¢æ„æ€å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚</p><ul><li>è€ŒRedisçš„listæ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¾ˆå®¹æ˜“æ¨¡æ‹Ÿå‡ºé˜Ÿåˆ—æ•ˆæœã€‚</li></ul><p>é˜Ÿåˆ—æ˜¯å…¥å£å’Œå‡ºå£ä¸åœ¨ä¸€è¾¹ï¼Œ</p><ul><li>å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ï¼šLPUSH ç»“åˆ RPOPã€æˆ–è€… RPUSH ç»“åˆ LPOPæ¥å®ç°ã€‚</li><li>ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œå½“é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯æ—¶RPOPæˆ–LPOPæ“ä½œä¼šè¿”å›nullï¼Œå¹¶ä¸åƒJVMçš„é˜»å¡é˜Ÿåˆ—é‚£æ ·ä¼šé˜»å¡å¹¶ç­‰å¾…æ¶ˆæ¯ã€‚å› æ­¤è¿™é‡Œåº”è¯¥<u>ä½¿ç”¨BRPOPæˆ–è€…BLPOPæ¥å®ç°é˜»å¡æ•ˆæœ</u>ã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/04/02/3faf92e1c1094e2799e8a78f0037dc2a" alt="1653575176451"></p><p>åŸºäºListçš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ<br>ä¼˜ç‚¹ï¼š</p><ul><li>åˆ©ç”¨Rediså­˜å‚¨ï¼Œä¸å—é™äºJVMå†…å­˜ä¸Šé™</li><li>åŸºäºRedisçš„æŒä¹…åŒ–æœºåˆ¶ï¼Œæ•°æ®å®‰å…¨æ€§æœ‰ä¿è¯</li><li>å¯ä»¥æ»¡è¶³æ¶ˆæ¯æœ‰åºæ€§</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ— æ³•é¿å…æ¶ˆæ¯ä¸¢å¤±</li><li>åªæ”¯æŒå•æ¶ˆè´¹è€…</li></ul><h2 id="redis-xiao-xi-dui-lie-ji-yu-pub-sub-de-xiao-xi-dui-lie" id="Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—">Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—</h2><p>PubSubï¼ˆå‘å¸ƒè®¢é˜…ï¼‰æ˜¯Redis2.0ç‰ˆæœ¬å¼•å…¥çš„æ¶ˆæ¯ä¼ é€’æ¨¡å‹ã€‚</p><ul><li><p>é¡¾åæ€ä¹‰ï¼Œæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªchannelï¼Œç”Ÿäº§è€…å‘å¯¹åº”channelå‘é€æ¶ˆæ¯åï¼Œæ‰€æœ‰è®¢é˜…è€…éƒ½èƒ½æ”¶åˆ°ç›¸å…³æ¶ˆæ¯ã€‚</p></li><li><p><code>SUBSCRIBE channel [channel]</code> ï¼šè®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“</p></li><li><p><code>PUBLISH channel msg</code> ï¼šå‘ä¸€ä¸ªé¢‘é“å‘é€æ¶ˆæ¯</p></li><li><p><code>PSUBSCRIBE pattern[pattern]</code> ï¼šè®¢é˜…ä¸patternæ ¼å¼åŒ¹é…çš„æ‰€æœ‰é¢‘é“</p></li></ul><p><img src="https://s1.vika.cn/space/2023/04/02/5491fba2a6fc403c8b88edbc2385f9eb" alt="1653575506373"></p><p>åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ<br>ä¼˜ç‚¹ï¼š</p><ul><li>é‡‡ç”¨å‘å¸ƒè®¢é˜…æ¨¡å‹ï¼Œæ”¯æŒå¤šç”Ÿäº§ã€å¤šæ¶ˆè´¹</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ä¸æ”¯æŒæ•°æ®æŒä¹…åŒ–</li><li>æ— æ³•é¿å…æ¶ˆæ¯ä¸¢å¤±</li><li>æ¶ˆæ¯å †ç§¯æœ‰ä¸Šé™ï¼Œè¶…å‡ºæ—¶æ•°æ®ä¸¢å¤±</li></ul><h2 id="redis-xiao-xi-dui-lie-ji-yu-stream-de-xiao-xi-dui-lie" id="Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—">Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—</h2><blockquote><p>Stream æ˜¯ Redis 5.0 å¼•å…¥çš„ä¸€ç§æ–°æ•°æ®ç±»å‹ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªåŠŸèƒ½éå¸¸å®Œå–„çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p></blockquote><p>å‘é€æ¶ˆæ¯çš„å‘½ä»¤ï¼š<code>XADD</code></p><p><img src="https://s1.vika.cn/space/2023/04/02/e08d14a9be7d40e78192e6f50a022635" alt="1653577301737"></p><p>ä¾‹å¦‚ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/02/4a4aea78b1864398b3f1a03e0804ccfd" alt="1653577349691"></p><p>è¯»å–æ¶ˆæ¯çš„æ–¹å¼ä¹‹ä¸€ï¼š<code>XREAD</code></p><p><img src="https://s1.vika.cn/space/2023/04/02/61a3ae3f9580472aaa2e8d4168a6e608" alt="1653577445413"></p><p>ä¾‹å¦‚ï¼Œä½¿ç”¨XREADè¯»å–ç¬¬ä¸€ä¸ªæ¶ˆæ¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/02/b02fad5f37614eee83ef08f5f6ffe293" alt="1653577643629"></p><p>XREADé˜»å¡æ–¹å¼ï¼Œè¯»å–æœ€æ–°çš„æ¶ˆæ¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/02/5ed6bf794629463eab6f4a842c110c50" alt="1653577659166"></p><p>åœ¨ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ªç¯çš„è°ƒç”¨XREADé˜»å¡æ–¹å¼æ¥æŸ¥è¯¢æœ€æ–°æ¶ˆæ¯ï¼Œä»è€Œå®ç°æŒç»­ç›‘å¬é˜Ÿåˆ—çš„æ•ˆæœï¼Œä¼ªä»£ç å¦‚ä¸‹</p><p><img src="https://s1.vika.cn/space/2023/04/02/1504517e2e5c47d285b71dd01270d40d" alt="1653577689129"></p><blockquote><p>æ³¨æ„ï¼šå½“æˆ‘ä»¬æŒ‡å®šèµ·å§‹IDä¸º$æ—¶ï¼Œä»£è¡¨è¯»å–æœ€æ–°çš„æ¶ˆæ¯ï¼Œå¦‚æœæˆ‘ä»¬å¤„ç†ä¸€æ¡æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­ï¼Œåˆæœ‰è¶…è¿‡1æ¡ä»¥ä¸Šçš„æ¶ˆæ¯åˆ°è¾¾é˜Ÿåˆ—ï¼Œåˆ™ä¸‹æ¬¡è·å–æ—¶ä¹Ÿåªèƒ½è·å–åˆ°æœ€æ–°çš„ä¸€æ¡ï¼Œä¼šå‡ºç°æ¼è¯»æ¶ˆæ¯çš„é—®é¢˜</p></blockquote><p>STREAMç±»å‹æ¶ˆæ¯é˜Ÿåˆ—çš„XREADå‘½ä»¤ç‰¹ç‚¹ï¼š</p><ul><li>æ¶ˆæ¯å¯å›æº¯</li><li>ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…è¯»å–</li><li>å¯ä»¥é˜»å¡è¯»å–</li><li>æœ‰æ¶ˆæ¯æ¼è¯»çš„é£é™©</li></ul><h2 id="redis-xiao-xi-dui-lie-ji-yu-stream-de-xiao-xi-dui-lie-xiao-fei-zhe-zu" id="Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆè´¹è€…ç»„">Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆè´¹è€…ç»„</h2><blockquote><p>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰ï¼šå°†å¤šä¸ªæ¶ˆè´¹è€…åˆ’åˆ†åˆ°ä¸€ä¸ªç»„ä¸­ï¼Œç›‘å¬åŒä¸€ä¸ªé˜Ÿåˆ—ã€‚å…·å¤‡ä¸‹åˆ—ç‰¹ç‚¹ï¼š</p></blockquote><ul><li>æ¶ˆæ¯åˆ†æµï¼šé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼š<code>åˆ†æµ</code>ç»™ç»„å†…çš„ä¸åŒæ¶ˆè´¹è€…ï¼Œè€Œä¸æ˜¯é‡å¤æ¶ˆè´¹ï¼Œä»è€ŒåŠ å¿«æ¶ˆæ¯å¤„ç†çš„é€Ÿåº¦</li><li>æ¶ˆæ¯æ ‡ç¤ºï¼šæ¶ˆè´¹è€…ä¼šç»´æŠ¤ä¸€ä¸ª<code>æ ‡ç¤º</code>ï¼Œè®°å½•<code>æœ€åä¸€ä¸ª</code>è¢«å¤„ç†çš„æ¶ˆæ¯ï¼Œå“ªæ€•æ¶ˆè´¹è€…å®•æœºé‡å¯ï¼Œè¿˜ä¼š<code>ä»æ ‡ç¤ºä¹‹åè¯»å–æ¶ˆæ¯</code>ã€‚ç¡®ä¿æ¯ä¸€ä¸ªæ¶ˆæ¯éƒ½ä¼šè¢«æ¶ˆè´¹ã€‚</li><li>æ¶ˆæ¯ç¡®è®¤ï¼šæ¶ˆè´¹è€…è·å–æ¶ˆæ¯åï¼Œæ¶ˆæ¯å¤„äº<code>pendingçŠ¶æ€</code>ï¼Œå¹¶å­˜å…¥ä¸€ä¸ª<code>pending-list</code>ã€‚å½“å¤„ç†å®Œæˆåéœ€è¦<code>é€šè¿‡XACKæ¥ç¡®è®¤æ¶ˆæ¯</code>ï¼Œæ ‡è®°æ¶ˆæ¯ä¸ºå·²å¤„ç†ï¼Œæ‰ä¼šä»pending-list<code>ç§»é™¤</code>ã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/04/02/4bff779d9ce44a8ca3ed5c679d203c3f" alt="1653577801668"></p><p>åˆ›å»ºæ¶ˆè´¹è€…ç»„ï¼š<code>XGROUP CREATE key groupName ID [MKSTREAM]</code></p><ul><li>keyï¼šé˜Ÿåˆ—åç§°</li><li>groupNameï¼šæ¶ˆè´¹è€…ç»„åç§°</li><li>IDï¼šèµ·å§‹IDæ ‡ç¤ºï¼Œ$ä»£è¡¨é˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ªæ¶ˆæ¯ï¼Œ0åˆ™ä»£è¡¨é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªæ¶ˆæ¯</li><li>MKSTREAMï¼šé˜Ÿåˆ—ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»ºé˜Ÿåˆ—</li></ul><p>å…¶å®ƒå¸¸è§å‘½ä»¤ï¼š</p><p><strong>åˆ é™¤æŒ‡å®šçš„æ¶ˆè´¹è€…ç»„</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP DESTORY key groupName</span><br></pre></td></tr></table></figure><p><strong>ç»™æŒ‡å®šçš„æ¶ˆè´¹è€…ç»„æ·»åŠ æ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP CREATECONSUMER key groupname consumername</span><br></pre></td></tr></table></figure><p><strong>åˆ é™¤æ¶ˆè´¹è€…ç»„ä¸­çš„æŒ‡å®šæ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP DELCONSUMER key groupname consumername</span><br></pre></td></tr></table></figure><p><strong>ä»æ¶ˆè´¹è€…ç»„è¯»å–æ¶ˆæ¯</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key ...] ID [ID ...]</span><br></pre></td></tr></table></figure><ul><li>groupï¼šæ¶ˆè´¹ç»„åç§°</li><li>consumerï¼šæ¶ˆè´¹è€…åç§°ï¼Œå¦‚æœæ¶ˆè´¹è€…ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…</li><li>countï¼šæœ¬æ¬¡æŸ¥è¯¢çš„æœ€å¤§æ•°é‡</li><li>BLOCK millisecondsï¼šå½“æ²¡æœ‰æ¶ˆæ¯æ—¶æœ€é•¿ç­‰å¾…æ—¶é—´</li><li>NOACKï¼šæ— éœ€æ‰‹åŠ¨ACKï¼Œè·å–åˆ°æ¶ˆæ¯åè‡ªåŠ¨ç¡®è®¤</li><li>STREAMS keyï¼šæŒ‡å®šé˜Ÿåˆ—åç§°</li><li>IDï¼šè·å–æ¶ˆæ¯çš„èµ·å§‹IDï¼š<ul><li>â€œ&gt;â€ï¼šä»ä¸‹ä¸€ä¸ªæœªæ¶ˆè´¹çš„æ¶ˆæ¯å¼€å§‹</li><li>å…¶å®ƒï¼šæ ¹æ®æŒ‡å®šidä»pending-listä¸­è·å–å·²æ¶ˆè´¹ä½†æœªç¡®è®¤çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚0ï¼Œæ˜¯ä»pending-listä¸­çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯å¼€å§‹</li></ul></li></ul><p>æ¶ˆè´¹è€…ç›‘å¬æ¶ˆæ¯çš„åŸºæœ¬æ€è·¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/02/b7b031e7a0c74b0585ae910e07177f67" alt="image-20230402123835974"></p><p>STREAMç±»å‹æ¶ˆæ¯é˜Ÿåˆ—çš„XREADGROUPå‘½ä»¤ç‰¹ç‚¹ï¼š</p><ul><li>æ¶ˆæ¯å¯å›æº¯</li><li>å¯ä»¥å¤šæ¶ˆè´¹è€…äº‰æŠ¢æ¶ˆæ¯ï¼ŒåŠ å¿«æ¶ˆè´¹é€Ÿåº¦</li><li>å¯ä»¥é˜»å¡è¯»å–</li><li>æ²¡æœ‰æ¶ˆæ¯æ¼è¯»çš„é£é™©</li><li>æœ‰æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼Œä¿è¯æ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡</li></ul><p>æœ€åæˆ‘ä»¬æ¥ä¸ªå°å¯¹æ¯”</p><p><img src="https://s1.vika.cn/space/2023/04/02/b4677604aeaf480e93e6d820f97307da" alt="1653578560691"></p><h2 id="ji-yu-redis-de-stream-jie-gou-zuo-wei-xiao-xi-dui-lie-shi-xian-yi-bu-miao-sha-xia-dan" id="åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•">åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•</h2><blockquote><p>éœ€æ±‚ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªStreamç±»å‹çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåä¸ºstream.orders</li><li>ä¿®æ”¹ä¹‹å‰çš„ç§’æ€ä¸‹å•Luaè„šæœ¬ï¼Œåœ¨è®¤å®šæœ‰æŠ¢è´­èµ„æ ¼åï¼Œç›´æ¥å‘stream.ordersä¸­æ·»åŠ æ¶ˆæ¯ï¼Œå†…å®¹åŒ…å«voucherIdã€userIdã€orderId</li><li>é¡¹ç›®å¯åŠ¨æ—¶ï¼Œå¼€å¯ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œå°è¯•è·å–stream.ordersä¸­çš„æ¶ˆæ¯ï¼Œå®Œæˆä¸‹å•\</li></ul></blockquote><p>ä¿®æ”¹luaè¡¨è¾¾å¼,æ–°å¢3.6</p><div class="tabs" id="luacorrect"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#luacorrect-1">luaè¡¨è¾¾å¼æ–°å¢éƒ¨åˆ†</button></li><li class="tab"><button type="button" data-href="#luacorrect-2">å®Œæ•´luaè¡¨è¾¾å¼</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="luacorrect-1"><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 3.5.ä¸‹å•ï¼ˆä¿å­˜ç”¨æˆ·ï¼‰sadd orderKey userId</span></span><br><span class="line">redis.call(<span class="string">&#x27;sadd&#x27;</span>, orderKey, userId)</span><br><span class="line"><span class="comment">-- 3.6.å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ï¼Œ XADD stream.orders * k1 v1 k2 v2 ...</span></span><br><span class="line">redis.call(<span class="string">&#x27;xadd&#x27;</span>, <span class="string">&#x27;stream.orders&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;userId&#x27;</span>, userId, <span class="string">&#x27;voucherId&#x27;</span>, voucherId, <span class="string">&#x27;id&#x27;</span>, orderId)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="luacorrect-2"><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.å‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="comment">-- 1.1.ä¼˜æƒ åˆ¸id</span></span><br><span class="line"><span class="keyword">local</span> voucherId = ARGV[<span class="number">1</span>]</span><br><span class="line"><span class="comment">-- 1.2.ç”¨æˆ·id</span></span><br><span class="line"><span class="keyword">local</span> userId = ARGV[<span class="number">2</span>]</span><br><span class="line"><span class="comment">-- 1.3.è®¢å•id</span></span><br><span class="line"><span class="keyword">local</span> orderId = ARGV[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2.æ•°æ®key</span></span><br><span class="line"><span class="comment">-- 2.1.åº“å­˜key</span></span><br><span class="line"><span class="keyword">local</span> stockKey = <span class="string">&#x27;seckill:stock:&#x27;</span> .. voucherId</span><br><span class="line"><span class="comment">-- 2.2.è®¢å•key</span></span><br><span class="line"><span class="keyword">local</span> orderKey = <span class="string">&#x27;seckill:order:&#x27;</span> .. voucherId</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3.è„šæœ¬ä¸šåŠ¡</span></span><br><span class="line"><span class="comment">-- 3.1.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ get stockKey</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">tonumber</span>(redis.call(<span class="string">&#x27;get&#x27;</span>, stockKey)) &lt;= <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 3.2.åº“å­˜ä¸è¶³ï¼Œè¿”å›1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 3.2.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸‹å• SISMEMBER orderKey userId</span></span><br><span class="line"><span class="keyword">if</span>(redis.call(<span class="string">&#x27;sismember&#x27;</span>, orderKey, userId) == <span class="number">1</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 3.3.å­˜åœ¨ï¼Œè¯´æ˜æ˜¯é‡å¤ä¸‹å•ï¼Œè¿”å›2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 3.4.æ‰£åº“å­˜ incrby stockKey -1</span></span><br><span class="line">redis.call(<span class="string">&#x27;incrby&#x27;</span>, stockKey, <span class="number">-1</span>)</span><br><span class="line"><span class="comment">-- 3.5.ä¸‹å•ï¼ˆä¿å­˜ç”¨æˆ·ï¼‰sadd orderKey userId</span></span><br><span class="line">redis.call(<span class="string">&#x27;sadd&#x27;</span>, orderKey, userId)</span><br><span class="line"><span class="comment">-- 3.6.å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ï¼Œ XADD stream.orders * k1 v1 k2 v2 ...</span></span><br><span class="line">redis.call(<span class="string">&#x27;xadd&#x27;</span>, <span class="string">&#x27;stream.orders&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;userId&#x27;</span>, userId, <span class="string">&#x27;voucherId&#x27;</span>, voucherId, <span class="string">&#x27;id&#x27;</span>, orderId)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>é¡¹ç›®å¯åŠ¨æ—¶ï¼Œå¼€å¯ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œå°è¯•è·å–stream.ordersä¸­çš„æ¶ˆæ¯ï¼Œå®Œæˆä¸‹å•</p><div class="tabs" id="correctvoucher"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#correctvoucher-1">VoucherOrderHandler</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="correctvoucher-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">SECKILL_ORDER_EXECUTOR</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    SECKILL_ORDER_EXECUTOR.submit(<span class="keyword">new</span> <span class="title class_">VoucherOrderHandler</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;stream.orders&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 1. è·å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯ XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS stream.orders &gt;</span></span><br><span class="line">                List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                        Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                        StreamReadOptions.empty().count(<span class="number">1</span>).block(Duration.ofSeconds(<span class="number">2</span>)),</span><br><span class="line">                        StreamOffset.create(queueName, ReadOffset.lastConsumed())</span><br><span class="line">                );</span><br><span class="line">                <span class="comment">// 2. åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">                <span class="keyword">if</span> (list == <span class="literal">null</span> || list.isEmpty()) &#123;</span><br><span class="line">                    <span class="comment">// 2.1 å¦‚æœè·å–å¤±è´¥ï¼Œè¯´æ˜æ²¡æœ‰æ¶ˆæ¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 3. è§£ææ¶ˆæ¯ä¸­çš„è®¢å•ä¿¡æ¯</span></span><br><span class="line">                MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="number">0</span>);</span><br><span class="line">                log.warn(<span class="string">&quot;mapRecord = &quot;</span> + record);</span><br><span class="line">                Map&lt;Object, Object&gt; values = record.getValue();</span><br><span class="line">                <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(values, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">                <span class="comment">// 4. å¦‚æœè·å–æˆåŠŸï¼Œå¯ä»¥ä¸‹å•</span></span><br><span class="line">                handleVoucherOrder(voucherOrder);</span><br><span class="line">                <span class="comment">// 5. ACKç¡®è®¤ SACK stream.orders g1 id</span></span><br><span class="line">                stringRedisTemplate.opsForStream().acknowledge(queueName, <span class="string">&quot;g1&quot;</span>, record.getId());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">                handlePendingList();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handlePendingList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. è·å–pending-listä¸­çš„è®¢å•ä¿¡æ¯ XREADGROUP GROUP g1 c1 COUNT 1 STREAMS stream.orders 0</span></span><br><span class="line">            List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                    Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                    StreamReadOptions.empty().count(<span class="number">1</span>),</span><br><span class="line">                    StreamOffset.create(queueName, ReadOffset.from(<span class="string">&quot;0&quot;</span>))</span><br><span class="line">            );</span><br><span class="line">            <span class="comment">// 2. åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">            <span class="keyword">if</span> (list == <span class="literal">null</span> || list.isEmpty()) &#123;</span><br><span class="line">                <span class="comment">// 2.1 å¦‚æœè·å–å¤±è´¥ï¼Œè¯´æ˜æ²¡æœ‰æ¶ˆæ¯ï¼Œç»“æŸå¾ªç¯</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 3. è§£ææ¶ˆæ¯ä¸­çš„è®¢å•ä¿¡æ¯</span></span><br><span class="line">            MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="number">0</span>);</span><br><span class="line">            log.warn(<span class="string">&quot;mapRecord = &quot;</span> + record);</span><br><span class="line">            Map&lt;Object, Object&gt; values = record.getValue();</span><br><span class="line">            <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(values, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">            <span class="comment">// 4. å¦‚æœè·å–æˆåŠŸï¼Œå¯ä»¥ä¸‹å•</span></span><br><span class="line">            handleVoucherOrder(voucherOrder);</span><br><span class="line">            <span class="comment">// 5. ACKç¡®è®¤ SACK stream.orders g1 id</span></span><br><span class="line">            stringRedisTemplate.opsForStream().acknowledge(queueName, <span class="string">&quot;g1&quot;</span>, record.getId());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å¤„ç†pending-listå¼‚å¸¸&quot;</span>, e);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">20</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleVoucherOrder</span><span class="params">(VoucherOrder voucherOrder)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> voucherOrder.getUserId();</span><br><span class="line">    <span class="comment">// 2. åˆ›å»ºé”å¯¹è±¡</span></span><br><span class="line">    <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;lock:order:&quot;</span> + userId);</span><br><span class="line">    <span class="comment">// 3. è·å–é”</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock();</span><br><span class="line">    <span class="comment">// 4. åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">        <span class="comment">// è·å–é”å¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯æˆ–é‡è¯•</span></span><br><span class="line">        log.error(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        proxy.createVoucherOrder(voucherOrder);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> IVoucherOrderService proxy;</span><br></pre></td></tr></table></figure><!-- endab --><!-- tab å®Œæ•´VoucherOrderServiceImplä»£ç  --><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;VoucherOrderMapper, VoucherOrder&gt; <span class="keyword">implements</span> <span class="title class_">IVoucherOrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ISeckillVoucherService seckillVoucherService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisIdWorker redisIdWorker;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Long&gt; SECKILL_SCRIPT;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        SECKILL_SCRIPT = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;();</span><br><span class="line">        SECKILL_SCRIPT.setLocation(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;seckill.lua&quot;</span>));</span><br><span class="line">        SECKILL_SCRIPT.setResultType(Long.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// private BlockingQueue&lt;VoucherOrder&gt; orderTasks = new ArrayBlockingQueue&lt;&gt;(1024 * 1024);</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">SECKILL_ORDER_EXECUTOR</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        SECKILL_ORDER_EXECUTOR.submit(<span class="keyword">new</span> <span class="title class_">VoucherOrderHandler</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;stream.orders&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 1. è·å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯ XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS stream.orders &gt;</span></span><br><span class="line">                    List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                            Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                            StreamReadOptions.empty().count(<span class="number">1</span>).block(Duration.ofSeconds(<span class="number">2</span>)),</span><br><span class="line">                            StreamOffset.create(queueName, ReadOffset.lastConsumed())</span><br><span class="line">                    );</span><br><span class="line">                    <span class="comment">// 2. åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">                    <span class="keyword">if</span> (list == <span class="literal">null</span> || list.isEmpty()) &#123;</span><br><span class="line">                        <span class="comment">// 2.1 å¦‚æœè·å–å¤±è´¥ï¼Œè¯´æ˜æ²¡æœ‰æ¶ˆæ¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯</span></span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 3. è§£ææ¶ˆæ¯ä¸­çš„è®¢å•ä¿¡æ¯</span></span><br><span class="line">                    MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="number">0</span>);</span><br><span class="line">                    log.warn(<span class="string">&quot;mapRecord = &quot;</span> + record);</span><br><span class="line">                    Map&lt;Object, Object&gt; values = record.getValue();</span><br><span class="line">                    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(values, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">                    <span class="comment">// 4. å¦‚æœè·å–æˆåŠŸï¼Œå¯ä»¥ä¸‹å•</span></span><br><span class="line">                    handleVoucherOrder(voucherOrder);</span><br><span class="line">                    <span class="comment">// 5. ACKç¡®è®¤ SACK stream.orders g1 id</span></span><br><span class="line">                    stringRedisTemplate.opsForStream().acknowledge(queueName, <span class="string">&quot;g1&quot;</span>, record.getId());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">                    handlePendingList();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handlePendingList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 1. è·å–pending-listä¸­çš„è®¢å•ä¿¡æ¯ XREADGROUP GROUP g1 c1 COUNT 1 STREAMS stream.orders 0</span></span><br><span class="line">                List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                        Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                        StreamReadOptions.empty().count(<span class="number">1</span>),</span><br><span class="line">                        StreamOffset.create(queueName, ReadOffset.from(<span class="string">&quot;0&quot;</span>))</span><br><span class="line">                );</span><br><span class="line">                <span class="comment">// 2. åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">                <span class="keyword">if</span> (list == <span class="literal">null</span> || list.isEmpty()) &#123;</span><br><span class="line">                    <span class="comment">// 2.1 å¦‚æœè·å–å¤±è´¥ï¼Œè¯´æ˜æ²¡æœ‰æ¶ˆæ¯ï¼Œç»“æŸå¾ªç¯</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 3. è§£ææ¶ˆæ¯ä¸­çš„è®¢å•ä¿¡æ¯</span></span><br><span class="line">                MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="number">0</span>);</span><br><span class="line">                log.warn(<span class="string">&quot;mapRecord = &quot;</span> + record);</span><br><span class="line">                Map&lt;Object, Object&gt; values = record.getValue();</span><br><span class="line">                <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(values, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">                <span class="comment">// 4. å¦‚æœè·å–æˆåŠŸï¼Œå¯ä»¥ä¸‹å•</span></span><br><span class="line">                handleVoucherOrder(voucherOrder);</span><br><span class="line">                <span class="comment">// 5. ACKç¡®è®¤ SACK stream.orders g1 id</span></span><br><span class="line">                stringRedisTemplate.opsForStream().acknowledge(queueName, <span class="string">&quot;g1&quot;</span>, record.getId());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;å¤„ç†pending-listå¼‚å¸¸&quot;</span>, e);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">20</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleVoucherOrder</span><span class="params">(VoucherOrder voucherOrder)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. è·å–ç”¨æˆ·</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> voucherOrder.getUserId();</span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºé”å¯¹è±¡</span></span><br><span class="line">        <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;lock:order:&quot;</span> + userId);</span><br><span class="line">        <span class="comment">// 3. è·å–é”</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock();</span><br><span class="line">        <span class="comment">// 4. åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">            <span class="comment">// è·å–é”å¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯æˆ–é‡è¯•</span></span><br><span class="line">            log.error(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            proxy.createVoucherOrder(voucherOrder);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IVoucherOrderService proxy;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç”¨æˆ·</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="comment">// è·å–è®¢å•id</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        <span class="comment">// 1. æ‰§è¡Œluaè„šæœ¬</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> stringRedisTemplate.execute(</span><br><span class="line">                SECKILL_SCRIPT,</span><br><span class="line">                Collections.emptyList(),</span><br><span class="line">                voucherId.toString(), userId.toString(), String.valueOf(orderId)</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// 2. åˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> result.intValue();</span><br><span class="line">        <span class="keyword">if</span> (r != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 2.1 ä¸ä¸º0ï¼Œä»£è¡¨æ²¡æœ‰è´­ä¹°èµ„æ ¼</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(r == <span class="number">1</span> ? <span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span> : <span class="string">&quot;ä¸èƒ½é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. è·å–ä»£ç†å¯¹è±¡</span></span><br><span class="line">        proxy = (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">        <span class="comment">// 3. è¿”å›è®¢å•idâ€˜</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createVoucherOrder</span><span class="params">(VoucherOrder voucherOrder)</span> &#123;</span><br><span class="line">        <span class="comment">// 5. ä¸€äººä¸€å•</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> voucherOrder.getUserId();</span><br><span class="line">        <span class="comment">// 5.1 æŸ¥è¯¢è®¢å•</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()).count();</span><br><span class="line">        <span class="comment">// 5.2 åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">            log.error(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6. æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>)</span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()).gt(<span class="string">&quot;stock&quot;</span>, <span class="number">0</span>)</span><br><span class="line">                .update();</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            <span class="comment">// æ‰£æ¬¾å¤±è´¥</span></span><br><span class="line">            log.error(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        save(voucherOrder);</span><br><span class="line">        <span class="comment">// 8. è¿”å›è®¢å•id</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1 id="da-ren-tan-dian">è¾¾äººæ¢åº—</h1><h2 id="da-ren-tan-dian-fa-bu-tan-dian-bi-ji" id="è¾¾äººæ¢åº—-å‘å¸ƒæ¢åº—ç¬”è®°">è¾¾äººæ¢åº—-å‘å¸ƒæ¢åº—ç¬”è®°</h2><p>å‘å¸ƒæ¢åº—ç¬”è®°</p><p>æ¢åº—ç¬”è®°ç±»ä¼¼ç‚¹è¯„ç½‘ç«™çš„è¯„ä»·ï¼Œå¾€å¾€æ˜¯å›¾æ–‡ç»“åˆã€‚å¯¹åº”çš„è¡¨æœ‰ä¸¤ä¸ªï¼š</p><ul><li>tb_blogï¼šæ¢åº—ç¬”è®°è¡¨ï¼ŒåŒ…å«ç¬”è®°ä¸­çš„æ ‡é¢˜ã€æ–‡å­—ã€å›¾ç‰‡ç­‰</li><li>tb_blog_commentsï¼šå…¶ä»–ç”¨æˆ·å¯¹æ¢åº—ç¬”è®°çš„è¯„ä»·</li></ul><p><strong>å…·ä½“å‘å¸ƒæµç¨‹</strong></p><p><img src="https://s1.vika.cn/space/2023/04/02/40e7c1f76f674c99bbf68116a07b616e" alt="1653578992639"></p><p><strong>ä¸Šä¼ æ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;blog&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">uploadImage</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile image)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–åŸå§‹æ–‡ä»¶åç§°</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> image.getOriginalFilename();</span><br><span class="line">            <span class="comment">// ç”Ÿæˆæ–°æ–‡ä»¶å</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> createNewFileName(originalFilename);</span><br><span class="line">            <span class="comment">// ä¿å­˜æ–‡ä»¶</span></span><br><span class="line">            image.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(SystemConstants.IMAGE_UPLOAD_DIR, fileName));</span><br><span class="line">            <span class="comment">// è¿”å›ç»“æœ</span></span><br><span class="line">            log.debug(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œ&#123;&#125;&quot;</span>, fileName);</span><br><span class="line">            <span class="keyword">return</span> Result.ok(fileName);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šåŒå­¦ä»¬åœ¨æ“ä½œæ—¶ï¼Œéœ€è¦ä¿®æ”¹SystemConstants.IMAGE_UPLOAD_DIR è‡ªå·±å›¾ç‰‡æ‰€åœ¨çš„åœ°å€ï¼Œåœ¨å®é™…å¼€å‘ä¸­å›¾ç‰‡ä¸€èˆ¬ä¼šæ”¾åœ¨nginxä¸Šæˆ–è€…æ˜¯äº‘å­˜å‚¨ä¸Šã€‚</p></blockquote><p><strong>BlogController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/blog&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IBlogService blogService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">saveBlog</span><span class="params">(<span class="meta">@RequestBody</span> Blog blog)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">        blog.setUpdateTime(user.getId());</span><br><span class="line">        <span class="comment">//ä¿å­˜æ¢åº—åšæ–‡</span></span><br><span class="line">        blogService.saveBlog(blog);</span><br><span class="line">        <span class="comment">//è¿”å›id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(blog.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="da-ren-tan-dian-cha-kan-tan-dian-bi-ji" id="è¾¾äººæ¢åº—-æŸ¥çœ‹æ¢åº—ç¬”è®°">è¾¾äººæ¢åº—-æŸ¥çœ‹æ¢åº—ç¬”è®°</h2><p>å®ç°æŸ¥çœ‹å‘å¸ƒæ¢åº—ç¬”è®°çš„æ¥å£</p><p><img src="https://s1.vika.cn/space/2023/04/02/167590f3bfab4944828fb8a9f58589b9" alt="1653579931626"></p><p>å®ç°ä»£ç ï¼š</p><p><strong>BlogServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢blog</span></span><br><span class="line">    <span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> getById(id);</span><br><span class="line">    <span class="keyword">if</span> (blog == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç¬”è®°ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.æŸ¥è¯¢blogæœ‰å…³çš„ç”¨æˆ·</span></span><br><span class="line">    queryBlogUser(blog);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> Result.ok(blog);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="da-ren-tan-dian-dian-zan-gong-neng" id="è¾¾äººæ¢åº—-ç‚¹èµåŠŸèƒ½">è¾¾äººæ¢åº—-ç‚¹èµåŠŸèƒ½</h2><p>åˆå§‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/likes/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogLikes</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//ä¿®æ”¹ç‚¹èµæ•°é‡</span></span><br><span class="line">    blogService.update().setSql(<span class="string">&quot;liked = liked +1 &quot;</span>).eq(<span class="string">&quot;id&quot;</span>,id).update();</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜åˆ†æï¼šè¿™ç§æ–¹å¼ä¼šå¯¼è‡´ä¸€ä¸ªç”¨æˆ·æ— é™ç‚¹èµï¼Œæ˜æ˜¾æ˜¯ä¸åˆç†çš„</p><p>é€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨çš„é€»è¾‘ï¼Œå‘èµ·è¯·æ±‚åªæ˜¯ç»™æ•°æ®åº“+1ï¼Œæ‰€ä»¥æ‰ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜</p><p><img src="https://s1.vika.cn/space/2023/04/02/9176e340aec943bb80fc00cf6df783c9" alt="1653581590453"></p><p>å®Œå–„ç‚¹èµåŠŸèƒ½</p><blockquote><p>éœ€æ±‚ï¼š</p><ul><li>åŒä¸€ä¸ªç”¨æˆ·åªèƒ½ç‚¹èµä¸€æ¬¡ï¼Œå†æ¬¡ç‚¹å‡»åˆ™å–æ¶ˆç‚¹èµ</li><li>å¦‚æœå½“å‰ç”¨æˆ·å·²ç»ç‚¹èµï¼Œåˆ™ç‚¹èµæŒ‰é’®é«˜äº®æ˜¾ç¤ºï¼ˆå‰ç«¯å·²å®ç°ï¼Œåˆ¤æ–­å­—æ®µBlogç±»çš„isLikeå±æ€§ï¼‰</li></ul></blockquote><p>å®ç°æ­¥éª¤ï¼š</p><ul><li>ç»™Blogç±»ä¸­æ·»åŠ ä¸€ä¸ª<code>isLikeå­—æ®µ</code>ï¼Œæ ‡ç¤ºæ˜¯å¦è¢«å½“å‰ç”¨æˆ·ç‚¹èµ</li><li>ä¿®æ”¹ç‚¹èµåŠŸèƒ½ï¼Œåˆ©ç”¨<code>Redisçš„seté›†åˆ</code>åˆ¤æ–­æ˜¯å¦ç‚¹èµè¿‡ï¼Œæœªç‚¹èµè¿‡åˆ™ç‚¹èµæ•°<code>+1</code>ï¼Œå·²ç‚¹èµè¿‡åˆ™ç‚¹èµæ•°<code>-1</code></li><li>ä¿®æ”¹æ ¹æ®idæŸ¥è¯¢Blogçš„ä¸šåŠ¡ï¼Œåˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦ç‚¹èµè¿‡ï¼Œ<code>èµ‹å€¼ç»™isLikeå­—æ®µ</code></li><li>ä¿®æ”¹åˆ†é¡µæŸ¥è¯¢Blogä¸šåŠ¡ï¼Œåˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦<code>ç‚¹èµ</code>è¿‡ï¼Œèµ‹å€¼ç»™isLikeå­—æ®µ</li></ul><p>ä¸ºä»€ä¹ˆé‡‡ç”¨seté›†åˆï¼š</p><ul><li>å› ä¸ºæˆ‘ä»¬çš„æ•°æ®æ˜¯ä¸èƒ½é‡å¤çš„ï¼Œå½“ç”¨æˆ·æ“ä½œè¿‡ä¹‹åï¼Œæ— è®ºä»–æ€ä¹ˆæ“ä½œï¼Œéƒ½æ˜¯</li></ul><p>å…·ä½“æ­¥éª¤ï¼š</p><ol><li>åœ¨Blog æ·»åŠ ä¸€ä¸ªå­—æ®µ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> Boolean isLike;</span><br></pre></td></tr></table></figure><ol start="2"><li>ä¿®æ”¹ä»£ç </li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">likeBlog</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 2. åˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;blog:liked:&quot;</span> + id;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">isMember</span> <span class="operator">=</span> stringRedisTemplate.opsForSet().isMember(key, userId.toString());</span><br><span class="line">    <span class="keyword">if</span>(BooleanUtil.isFalse(isMember)) &#123;</span><br><span class="line">        <span class="comment">// 3. å¦‚æœä¸ºç‚¹èµï¼Œå¯ä»¥ç‚¹èµ</span></span><br><span class="line">        <span class="comment">// 3.1 æ•°æ®åº“ç‚¹èµæ•° + 1</span></span><br><span class="line">        <span class="comment">// 3.2 ä¿å­˜ç”¨æˆ·åˆ°Redisçš„seté›†åˆ</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked + 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">        <span class="keyword">if</span>(isSuccess) &#123;</span><br><span class="line">            stringRedisTemplate.opsForSet().add(key, userId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 4. å¦‚æœå·²ç»ç‚¹èµï¼Œå–æ¶ˆç‚¹èµ</span></span><br><span class="line">        <span class="comment">// 4.1 æ•°æ®åº“ç‚¹èµæ•° -1</span></span><br><span class="line">        <span class="comment">// 4.2 æŠŠç”¨æˆ·ä»redisçš„seté›†åˆç§»é™¤</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked - 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">        <span class="keyword">if</span>(isSuccess) &#123;</span><br><span class="line">            stringRedisTemplate.opsForSet().remove(key, userId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹å®Œæ¯•ä¹‹åï¼Œé¡µé¢ä¸Šè¿˜ä¸èƒ½ç«‹å³æ˜¾ç¤ºç‚¹èµå®Œæ¯•çš„åæœï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹æŸ¥è¯¢Blogä¸šåŠ¡ï¼Œåˆ¤æ–­Blogæ˜¯å¦è¢«å½“å‰ç”¨æˆ·ç‚¹èµè¿‡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. æŸ¥è¯¢blog</span></span><br><span class="line">    <span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> getById(id);</span><br><span class="line">    <span class="keyword">if</span>(blog == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç¬”è®°ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. æŸ¥è¯¢blogæœ‰å…³çš„ç”¨æˆ·</span></span><br><span class="line">    queryBlogByUser(blog);</span><br><span class="line">    <span class="comment">// 3. æŸ¥è¯¢blogæ˜¯å¦è¢«ç‚¹èµ</span></span><br><span class="line">    isBlogLiked(blog);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(blog);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">isBlogLiked</span><span class="params">(Blog blog)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 2. åˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;blog:liked:&quot;</span> + blog.getId();</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">isMember</span> <span class="operator">=</span> stringRedisTemplate.opsForSet().isMember(key, userId.toString());</span><br><span class="line">    blog.setIsLike(BooleanUtil.isTrue(isMember));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">queryBlogByUser</span><span class="params">(Blog blog)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> blog.getUserId();</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(userId);</span><br><span class="line">    blog.setName(user.getNickName());</span><br><span class="line">    blog.setIcon(user.getIcon());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryHotBlog</span><span class="params">(Integer current)</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®ç”¨æˆ·æŸ¥è¯¢</span></span><br><span class="line">    Page&lt;Blog&gt; page = query()</span><br><span class="line">            .orderByDesc(<span class="string">&quot;liked&quot;</span>)</span><br><span class="line">            .page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, SystemConstants.MAX_PAGE_SIZE));</span><br><span class="line">    <span class="comment">// è·å–å½“å‰é¡µæ•°æ®</span></span><br><span class="line">    List&lt;Blog&gt; records = page.getRecords();</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    records.forEach(blog -&gt; &#123;</span><br><span class="line">        <span class="built_in">this</span>.queryBlogByUser(blog);</span><br><span class="line">        <span class="built_in">this</span>.isBlogLiked(blog);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="da-ren-tan-dian-dian-zan-pai-xing-bang" id="è¾¾äººæ¢åº—-ç‚¹èµæ’è¡Œæ¦œ">è¾¾äººæ¢åº—-ç‚¹èµæ’è¡Œæ¦œ</h2><blockquote><p>åœ¨æ¢åº—ç¬”è®°çš„è¯¦æƒ…é¡µé¢ï¼Œåº”è¯¥æŠŠç»™è¯¥ç¬”è®°ç‚¹èµçš„äººæ˜¾ç¤ºå‡ºæ¥ï¼Œæ¯”å¦‚æœ€æ—©ç‚¹èµçš„TOP5ï¼Œå½¢æˆç‚¹èµæ’è¡Œæ¦œï¼š</p></blockquote><ul><li>ä¹‹å‰çš„ç‚¹èµæ˜¯æ”¾åˆ°seté›†åˆï¼Œä½†æ˜¯seté›†åˆæ˜¯ä¸èƒ½æ’åºçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼Œå’±ä»¬å¯ä»¥é‡‡ç”¨ä¸€ä¸ªå¯ä»¥æ’åºçš„seté›†åˆï¼Œå°±æ˜¯å’±ä»¬çš„sortedSet</li></ul><p><img src="https://s1.vika.cn/space/2023/04/02/957ae0f3b163405e94e34c18f348b08a" alt="1653805077118"></p><p>æˆ‘ä»¬æ¥ä¸‹æ¥æ¥å¯¹æ¯”ä¸€ä¸‹è¿™äº›é›†åˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</p><ul><li><p>æ‰€æœ‰ç‚¹èµçš„äººï¼Œéœ€è¦æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“ä½¿ç”¨setæˆ–è€…æ˜¯sortedSet</p></li><li><p>å…¶æ¬¡æˆ‘ä»¬éœ€è¦æ’åºï¼Œå°±å¯ä»¥ç›´æ¥é”å®šä½¿ç”¨sortedSetå•¦</p></li></ul><p><img src="https://s1.vika.cn/space/2023/04/02/0a80f8aa96c94a6ab517798a71bcc305" alt="1653805203758"></p><p><strong>ä¿®æ”¹ä»£ç </strong></p><ul><li><strong>BlogServiceImpl</strong></li></ul><p>ç‚¹èµé€»è¾‘ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">isBlogLiked</span><span class="params">(Blog blog)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">    <span class="keyword">if</span>(user == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·æœªç™»å½•ï¼Œæ— éœ€æŸ¥è¯¢æ˜¯å¦ç‚¹èµ</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> user.getId();</span><br><span class="line">    <span class="comment">// 2. åˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> BLOG_LIKED_KEY + blog.getId();</span><br><span class="line">    <span class="type">Double</span> <span class="variable">score</span> <span class="operator">=</span> stringRedisTemplate.opsForZSet().score(key, userId.toString());</span><br><span class="line">    blog.setIsLike(score != <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">likeBlog</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 2. åˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> BLOG_LIKED_KEY + id;</span><br><span class="line">    <span class="type">Double</span> <span class="variable">score</span> <span class="operator">=</span> stringRedisTemplate.opsForZSet().score(key, userId.toString());</span><br><span class="line">    <span class="keyword">if</span>(score == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 3. å¦‚æœä¸ºç‚¹èµï¼Œå¯ä»¥ç‚¹èµ</span></span><br><span class="line">        <span class="comment">// 3.1 æ•°æ®åº“ç‚¹èµæ•° + 1</span></span><br><span class="line">        <span class="comment">// 3.2 ä¿å­˜ç”¨æˆ·åˆ°Redisçš„seté›†åˆ zadd key value score</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked + 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">        <span class="keyword">if</span>(isSuccess) &#123;</span><br><span class="line">            stringRedisTemplate.opsForZSet().add(key, userId.toString(), System.currentTimeMillis());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 4. å¦‚æœå·²ç»ç‚¹èµï¼Œå–æ¶ˆç‚¹èµ</span></span><br><span class="line">        <span class="comment">// 4.1 æ•°æ®åº“ç‚¹èµæ•° -1</span></span><br><span class="line">        <span class="comment">// 4.2 æŠŠç”¨æˆ·ä»redisçš„seté›†åˆç§»é™¤</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked - 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">        <span class="keyword">if</span>(isSuccess) &#123;</span><br><span class="line">            stringRedisTemplate.opsForZSet().remove(key, userId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‚¹èµåˆ—è¡¨æŸ¥è¯¢åˆ—è¡¨</p><p>BlogController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/likes/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogLikes</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> blogService.queryBlogLikes(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BlogService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogLikes</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> BLOG_LIKED_KEY + id;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢top5çš„ç‚¹èµç”¨æˆ· zrange key 0 4</span></span><br><span class="line">    Set&lt;String&gt; top5 = stringRedisTemplate.opsForZSet().range(key, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">if</span> (top5 == <span class="literal">null</span> || top5.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.è§£æå‡ºå…¶ä¸­çš„ç”¨æˆ·id</span></span><br><span class="line">    List&lt;Long&gt; ids = top5.stream().map(Long::valueOf).collect(Collectors.toList());</span><br><span class="line">    <span class="type">String</span> <span class="variable">idStr</span> <span class="operator">=</span> StrUtil.join(<span class="string">&quot;,&quot;</span>, ids);</span><br><span class="line">    <span class="comment">// 3.æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ç”¨æˆ· WHERE id IN ( 5 , 1 ) ORDER BY FIELD(id, 5, 1)</span></span><br><span class="line">    List&lt;UserDTO&gt; userDTOS = userService.query()</span><br><span class="line">            .in(<span class="string">&quot;id&quot;</span>, ids).last(<span class="string">&quot;ORDER BY FIELD(id,&quot;</span> + idStr + <span class="string">&quot;)&quot;</span>).list()</span><br><span class="line">            .stream()</span><br><span class="line">            .map(user -&gt; BeanUtil.copyProperties(user, UserDTO.class))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// 4.è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(userDTOS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="hao-you-guan-zhu">å¥½å‹å…³æ³¨</h1><h2 id="hao-you-guan-zhu-guan-zhu-he-qu-xiao-guan-zhu" id="å¥½å‹å…³æ³¨-å…³æ³¨å’Œå–æ¶ˆå…³æ³¨">å¥½å‹å…³æ³¨-å…³æ³¨å’Œå–æ¶ˆå…³æ³¨</h2><p>é’ˆå¯¹ç”¨æˆ·çš„æ“ä½œï¼šå¯ä»¥å¯¹ç”¨æˆ·è¿›è¡Œå…³æ³¨å’Œå–æ¶ˆå…³æ³¨åŠŸèƒ½ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/02/e00e6c792aaa4d90b2253ed293738b4b" alt="1653806140822"></p><p>å®ç°æ€è·¯ï¼š</p><blockquote><p>éœ€æ±‚ï¼šåŸºäºè¯¥è¡¨æ•°æ®ç»“æ„ï¼Œå®ç°ä¸¤ä¸ªæ¥å£ï¼š</p><ul><li>å…³æ³¨å’Œå–å…³æ¥å£</li><li>åˆ¤æ–­æ˜¯å¦å…³æ³¨çš„æ¥å£</li></ul></blockquote><p>å…³æ³¨æ˜¯Userä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯åšä¸»ä¸ç²‰ä¸çš„å…³ç³»ï¼Œæ•°æ®åº“ä¸­æœ‰ä¸€å¼ tb_followè¡¨æ¥æ ‡ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `tb_follow` (</span><br><span class="line">  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#x27;ä¸»é”®&#x27;,</span><br><span class="line">  `user_id` bigint unsigned NOT NULL COMMENT &#x27;ç”¨æˆ·id&#x27;,</span><br><span class="line">  `follow_user_id` bigint unsigned NOT NULL COMMENT &#x27;å…³è”çš„ç”¨æˆ·id&#x27;,</span><br><span class="line">  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci ROW_FORMAT=COMPACT;</span><br></pre></td></tr></table></figure><p>æ³¨æ„: è¿™é‡Œéœ€è¦æŠŠä¸»é”®ä¿®æ”¹ä¸ºè‡ªå¢é•¿ï¼Œç®€åŒ–å¼€å‘ã€‚</p><p>FollowController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…³æ³¨</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/&#123;id&#125;/&#123;isFollow&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long followUserId, <span class="meta">@PathVariable(&quot;isFollow&quot;)</span> Boolean isFollow)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> followService.follow(followUserId, isFollow);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å–æ¶ˆå…³æ³¨</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/or/not/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">isFollow</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long followUserId)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> followService.isFollow(followUserId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>FollowService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(Long followUserId, Boolean isFollow)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 1. åˆ¤æ–­åˆ°åº•æ˜¯å…³æ³¨è¿˜æ˜¯å–å…³</span></span><br><span class="line">    <span class="keyword">if</span>(isFollow) &#123;</span><br><span class="line">        <span class="comment">// 2.å…³æ³¨ï¼Œæ–°å¢æ•°æ®</span></span><br><span class="line">        <span class="type">Follow</span> <span class="variable">follow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Follow</span>();</span><br><span class="line">        follow.setUserId(userId);</span><br><span class="line">        follow.setFollowUserId(followUserId);</span><br><span class="line">        save(follow);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 3. å–å…³ï¼Œåˆ é™¤ delete from tb_follow where userId = ? and follow_user_id = ?</span></span><br><span class="line">        remove(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Follow&gt;().eq(<span class="string">&quot;user_id&quot;</span>, userId)</span><br><span class="line">                .eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">isFollow</span><span class="params">(Long followUserId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. æŸ¥è¯¢æ˜¯å¦å…³æ³¨ select * from tb_follow where user_id = ? and follow_user_id = ?</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId).count();</span><br><span class="line">    <span class="comment">// 3. åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(count &gt; <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="hao-you-guan-zhu-gong-tong-guan-zhu" id="å¥½å‹å…³æ³¨-å…±åŒå…³æ³¨">å¥½å‹å…³æ³¨-å…±åŒå…³æ³¨</h2><p>æƒ³è¦å»çœ‹å…±åŒå…³æ³¨çš„å¥½å‹ï¼Œéœ€è¦é¦–å…ˆè¿›å…¥åˆ°è¿™ä¸ªé¡µé¢ï¼Œè¿™ä¸ªé¡µé¢ä¼šå‘èµ·ä¸¤ä¸ªè¯·æ±‚</p><ol><li><p>å»æŸ¥è¯¢ç”¨æˆ·çš„è¯¦æƒ…</p></li><li><p>å»æŸ¥è¯¢ç”¨æˆ·çš„ç¬”è®°</p></li></ol><p>ä»¥ä¸Šä¸¤ä¸ªåŠŸèƒ½å’Œå…±åŒå…³æ³¨æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå°†ç¬”è®°ä¸­çš„ä»£ç æ‹·è´åˆ°ideaä¸­å°±å¯ä»¥å®ç°è¿™ä¸¤ä¸ªåŠŸèƒ½äº†ï¼Œæˆ‘ä»¬çš„é‡ç‚¹åœ¨äºå…±åŒå…³æ³¨åŠŸèƒ½ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/02/15caac40ed9841e8a243609d5538f33d" alt="1653806706296"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserController æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long userId)</span>&#123;</span><br><span class="line"><span class="comment">// æŸ¥è¯¢è¯¦æƒ…</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(userId);</span><br><span class="line"><span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserDTO.class);</span><br><span class="line"><span class="comment">// è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> Result.ok(userDTO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BlogController  æ ¹æ®idæŸ¥è¯¢åšä¸»çš„æ¢åº—ç¬”è®°</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/of/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogByUserId</span><span class="params">(</span></span><br><span class="line"><span class="params"><span class="meta">@RequestParam(value = &quot;current&quot;, defaultValue = &quot;1&quot;)</span> Integer current,</span></span><br><span class="line"><span class="params"><span class="meta">@RequestParam(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line"><span class="comment">// æ ¹æ®ç”¨æˆ·æŸ¥è¯¢</span></span><br><span class="line">Page&lt;Blog&gt; page = blogService.query()</span><br><span class="line">.eq(<span class="string">&quot;user_id&quot;</span>, id).page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, SystemConstants.MAX_PAGE_SIZE));</span><br><span class="line"><span class="comment">// è·å–å½“å‰é¡µæ•°æ®</span></span><br><span class="line">List&lt;Blog&gt; records = page.getRecords();</span><br><span class="line"><span class="keyword">return</span> Result.ok(records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å…±åŒå…³æ³¨å¦‚ä½•å®ç°ï¼š</p><blockquote><p>éœ€æ±‚ï¼šåˆ©ç”¨Redisä¸­æ°å½“çš„æ•°æ®ç»“æ„ï¼Œå®ç°å…±åŒå…³æ³¨åŠŸèƒ½ã€‚åœ¨åšä¸»ä¸ªäººé¡µé¢å±•ç¤ºå‡ºå½“å‰ç”¨æˆ·ä¸åšä¸»çš„å…±åŒå…³æ³¨å‘¢ã€‚</p></blockquote><p>å½“ç„¶æ˜¯ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰å­¦ä¹ è¿‡çš„seté›†åˆå’¯ï¼Œ</p><ul><li>åœ¨seté›†åˆä¸­ï¼Œæœ‰äº¤é›†å¹¶é›†è¡¥é›†çš„apiï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸¤äººçš„å…³æ³¨çš„äººåˆ†åˆ«æ”¾å…¥åˆ°ä¸€ä¸ªseté›†åˆä¸­ï¼Œç„¶åå†é€šè¿‡apiå»æŸ¥çœ‹è¿™ä¸¤ä¸ªseté›†åˆä¸­çš„äº¤é›†æ•°æ®ã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/04/02/795c3a192fe54459ace50b4f2809cdc5" alt="1653806973212"></p><p>æˆ‘ä»¬å…ˆæ¥æ”¹é€ å½“å‰çš„å…³æ³¨åˆ—è¡¨</p><ul><li>æ”¹é€ åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨ç”¨æˆ·å…³æ³¨äº†æŸä½ç”¨æˆ·åï¼Œéœ€è¦å°†æ•°æ®æ”¾å…¥åˆ°seté›†åˆä¸­ï¼Œæ–¹ä¾¿åç»­è¿›è¡Œå…±åŒå…³æ³¨ï¼ŒåŒæ—¶å½“å–æ¶ˆå…³æ³¨æ—¶ï¼Œä¹Ÿéœ€è¦ä»seté›†åˆä¸­è¿›è¡Œåˆ é™¤</li></ul><p><strong>FollowServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(Long followUserId, Boolean isFollow)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">    <span class="comment">// 1.åˆ¤æ–­åˆ°åº•æ˜¯å…³æ³¨è¿˜æ˜¯å–å…³</span></span><br><span class="line">    <span class="keyword">if</span> (isFollow) &#123;</span><br><span class="line">        <span class="comment">// 2.å…³æ³¨ï¼Œæ–°å¢æ•°æ®</span></span><br><span class="line">        <span class="type">Follow</span> <span class="variable">follow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Follow</span>();</span><br><span class="line">        follow.setUserId(userId);</span><br><span class="line">        follow.setFollowUserId(followUserId);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(follow);</span><br><span class="line">        <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">            <span class="comment">// æŠŠå…³æ³¨ç”¨æˆ·çš„idï¼Œæ”¾å…¥redisçš„seté›†åˆ sadd userId followerUserId</span></span><br><span class="line">            stringRedisTemplate.opsForSet().add(key, followUserId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 3.å–å…³ï¼Œåˆ é™¤ delete from tb_follow where user_id = ? and follow_user_id = ?</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> remove(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Follow&gt;()</span><br><span class="line">                .eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId));</span><br><span class="line">        <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">            <span class="comment">// æŠŠå…³æ³¨ç”¨æˆ·çš„idä»Redisé›†åˆä¸­ç§»é™¤</span></span><br><span class="line">            stringRedisTemplate.opsForSet().remove(key, followUserId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å…·ä½“çš„å…³æ³¨ä»£ç ï¼š</strong></p><p>FollowServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">followCommons</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">    <span class="comment">// 2.æ±‚äº¤é›†</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key2</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + id;</span><br><span class="line">    Set&lt;String&gt; intersect = stringRedisTemplate.opsForSet().intersect(key, key2);</span><br><span class="line">    <span class="keyword">if</span> (intersect == <span class="literal">null</span> || intersect.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// æ— äº¤é›†</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.è§£æidé›†åˆ</span></span><br><span class="line">    List&lt;Long&gt; ids = intersect.stream().map(Long::valueOf).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// 4.æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    List&lt;UserDTO&gt; users = userService.listByIds(ids)</span><br><span class="line">            .stream()</span><br><span class="line">            .map(user -&gt; BeanUtil.copyProperties(user, UserDTO.class))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="hao-you-guan-zhu-feed-liu-shi-xian-fang-an" id="å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ¡ˆ">å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ¡ˆ</h2><p>å½“æˆ‘ä»¬å…³æ³¨äº†ç”¨æˆ·åï¼Œè¿™ä¸ªç”¨æˆ·å‘äº†åŠ¨æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æŠŠè¿™äº›æ•°æ®æ¨é€ç»™ç”¨æˆ·ï¼Œ</p><ul><li>è¿™ä¸ªéœ€æ±‚ï¼Œå…¶å®æˆ‘ä»¬åˆæŠŠä»–å«åšFeedæµï¼Œå…³æ³¨æ¨é€ä¹Ÿå«åšFeedæµï¼Œç›´è¯‘ä¸ºæŠ•å–‚ã€‚</li><li>ä¸ºç”¨æˆ·æŒç»­çš„æä¾›â€œæ²‰æµ¸å¼â€çš„ä½“éªŒï¼Œé€šè¿‡æ— é™ä¸‹æ‹‰åˆ·æ–°è·å–æ–°çš„ä¿¡æ¯ã€‚</li></ul><p>å¯¹äºä¼ ç»Ÿçš„æ¨¡å¼çš„å†…å®¹è§£é”ï¼šæˆ‘ä»¬æ˜¯éœ€è¦ç”¨æˆ·å»é€šè¿‡æœç´¢å¼•æ“æˆ–è€…æ˜¯å…¶ä»–çš„æ–¹å¼å»è§£é”æƒ³è¦çœ‹çš„å†…å®¹</p><p><img src="https://s1.vika.cn/space/2023/04/02/c642238f6f8243bca8da89b731126510" alt="1653808641260"></p><p>å¯¹äºæ–°å‹çš„Feedæµçš„çš„æ•ˆæœï¼šä¸éœ€è¦æˆ‘ä»¬ç”¨æˆ·å†å»æ¨é€ä¿¡æ¯ï¼Œè€Œæ˜¯ç³»ç»Ÿåˆ†æç”¨æˆ·åˆ°åº•æƒ³è¦ä»€ä¹ˆï¼Œç„¶åç›´æ¥æŠŠå†…å®¹æ¨é€ç»™ç”¨æˆ·ï¼Œä»è€Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ›´åŠ çš„èŠ‚çº¦æ—¶é—´ï¼Œä¸ç”¨ä¸»åŠ¨å»å¯»æ‰¾ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/02/6c9796f908e34d16b4924919dceb5f4d" alt="1653808993693"></p><p>Feedæµçš„å®ç°æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p><p>Feedæµäº§å“æœ‰ä¸¤ç§å¸¸è§æ¨¡å¼ï¼š</p><ol><li><p>Timelineï¼šä¸åšå†…å®¹ç­›é€‰ï¼Œç®€å•çš„æŒ‰ç…§å†…å®¹å‘å¸ƒæ—¶é—´æ’åºï¼Œå¸¸ç”¨äºå¥½å‹æˆ–å…³æ³¨ã€‚ä¾‹å¦‚æœ‹å‹åœˆ</p><ul><li><p>ä¼˜ç‚¹ï¼šä¿¡æ¯å…¨é¢ï¼Œä¸ä¼šæœ‰ç¼ºå¤±ã€‚å¹¶ä¸”å®ç°ä¹Ÿç›¸å¯¹ç®€å•</p></li><li><p>ç¼ºç‚¹ï¼šä¿¡æ¯å™ªéŸ³è¾ƒå¤šï¼Œç”¨æˆ·ä¸ä¸€å®šæ„Ÿå…´è¶£ï¼Œå†…å®¹è·å–æ•ˆç‡ä½</p></li></ul></li><li><p>æ™ºèƒ½æ’åºï¼šåˆ©ç”¨æ™ºèƒ½ç®—æ³•å±è”½æ‰è¿è§„çš„ã€ç”¨æˆ·ä¸æ„Ÿå…´è¶£çš„å†…å®¹ã€‚æ¨é€ç”¨æˆ·æ„Ÿå…´è¶£ä¿¡æ¯æ¥å¸å¼•ç”¨æˆ·</p><ul><li><p>ä¼˜ç‚¹ï¼šæŠ•å–‚ç”¨æˆ·æ„Ÿå…´è¶£ä¿¡æ¯ï¼Œç”¨æˆ·ç²˜åº¦å¾ˆé«˜ï¼Œå®¹æ˜“æ²‰è¿·</p></li><li><p>ç¼ºç‚¹ï¼šå¦‚æœç®—æ³•ä¸ç²¾å‡†ï¼Œå¯èƒ½èµ·åˆ°åä½œç”¨</p></li></ul></li></ol><p>æœ¬ä¾‹ä¸­çš„ä¸ªäººé¡µé¢ï¼Œæ˜¯åŸºäºå…³æ³¨çš„å¥½å‹æ¥åšFeedæµï¼Œå› æ­¤é‡‡ç”¨Timelineçš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼çš„å®ç°æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</p><p>æˆ‘ä»¬æœ¬æ¬¡é’ˆå¯¹å¥½å‹çš„æ“ä½œï¼Œé‡‡ç”¨çš„å°±æ˜¯<code>Timeline</code>çš„æ–¹å¼ï¼Œåªéœ€è¦æ‹¿åˆ°æˆ‘ä»¬å…³æ³¨ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç„¶åæŒ‰ç…§æ—¶é—´æ’åºå³å¯ï¼Œå› æ­¤é‡‡ç”¨Timelineçš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼çš„å®ç°æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</p><ul><li>æ‹‰æ¨¡å¼</li><li>æ¨æ¨¡å¼</li><li>æ¨æ‹‰ç»“åˆ</li></ul><ol><li><strong>æ‹‰æ¨¡å¼</strong>ï¼šä¹Ÿå«åšè¯»æ‰©æ•£</li></ol><p>è¯¥æ¨¡å¼çš„æ ¸å¿ƒå«ä¹‰å°±æ˜¯ï¼šå½“å¼ ä¸‰å’Œæå››å’Œç‹äº”å‘äº†æ¶ˆæ¯åï¼Œéƒ½ä¼šä¿å­˜åœ¨è‡ªå·±çš„é‚®ç®±ä¸­ï¼Œ</p><ul><li><p>å‡è®¾èµµå…­è¦è¯»å–ä¿¡æ¯ï¼Œé‚£ä¹ˆä»–ä¼šä»è¯»å–ä»–è‡ªå·±çš„æ”¶ä»¶ç®±ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šä»ä»–å…³æ³¨çš„äººç¾¤ä¸­ï¼ŒæŠŠä»–å…³æ³¨äººçš„ä¿¡æ¯å…¨éƒ¨éƒ½è¿›è¡Œæ‹‰å–ï¼Œç„¶ååœ¨è¿›è¡Œæ’åº</p></li><li><p>ä¼˜ç‚¹ï¼šæ¯”è¾ƒèŠ‚çº¦ç©ºé—´ï¼Œå› ä¸ºèµµå…­åœ¨è¯»ä¿¡æ¯æ—¶ï¼Œå¹¶æ²¡æœ‰é‡å¤è¯»å–ï¼Œè€Œä¸”è¯»å–å®Œä¹‹åå¯ä»¥æŠŠä»–çš„æ”¶ä»¶ç®±è¿›è¡Œæ¸…æ¥šã€‚</p></li><li><p>ç¼ºç‚¹ï¼šæ¯”è¾ƒå»¶è¿Ÿï¼Œå½“ç”¨æˆ·è¯»å–æ•°æ®æ—¶æ‰å»å…³æ³¨çš„äººé‡Œè¾¹å»è¯»å–æ•°æ®ï¼Œå‡è®¾ç”¨æˆ·å…³æ³¨äº†å¤§é‡çš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šæ‹‰å–æµ·é‡çš„å†…å®¹ï¼Œå¯¹æœåŠ¡å™¨å‹åŠ›å·¨å¤§ã€‚</p></li></ul><p><img src="https://s1.vika.cn/space/2023/04/02/41794f3331e7443d937b49488f49f3ea" alt="1653809450816"></p><ol start="2"><li><strong>æ¨æ¨¡å¼</strong>ï¼šä¹Ÿå«åšå†™æ‰©æ•£ã€‚</li></ol><p>æ¨æ¨¡å¼æ˜¯æ²¡æœ‰å†™é‚®ç®±çš„ï¼Œå½“å¼ ä¸‰å†™äº†ä¸€ä¸ªå†…å®¹ï¼Œæ­¤æ—¶ä¼šä¸»åŠ¨çš„æŠŠå¼ ä¸‰å†™çš„å†…å®¹å‘é€åˆ°ä»–çš„ç²‰ä¸æ”¶ä»¶ç®±ä¸­å»ï¼Œ</p><ul><li><p>å‡è®¾æ­¤æ—¶æå››å†æ¥è¯»å–ï¼Œå°±ä¸ç”¨å†å»ä¸´æ—¶æ‹‰å–äº†</p></li><li><p>ä¼˜ç‚¹ï¼šæ—¶æ•ˆå¿«ï¼Œä¸ç”¨ä¸´æ—¶æ‹‰å–</p></li><li><p>ç¼ºç‚¹ï¼šå†…å­˜å‹åŠ›å¤§ï¼Œå‡è®¾ä¸€ä¸ªå¤§Vå†™ä¿¡æ¯ï¼Œå¾ˆå¤šäººå…³æ³¨ä»–ï¼Œ å°±ä¼šå†™å¾ˆå¤šåˆ†æ•°æ®åˆ°ç²‰ä¸é‚£è¾¹å»</p></li></ul><p><img src="https://s1.vika.cn/space/2023/04/02/d629e571c14e47e293154f1ce2f1948f" alt="1653809875208"></p><ol start="3"><li><strong>æ¨æ‹‰ç»“åˆæ¨¡å¼</strong>ï¼šä¹Ÿå«åšè¯»å†™æ··åˆï¼Œå…¼å…·æ¨å’Œæ‹‰ä¸¤ç§æ¨¡å¼çš„ä¼˜ç‚¹ã€‚</li></ol><p>æ¨æ‹‰æ¨¡å¼æ˜¯ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œç«™åœ¨å‘ä»¶äººè¿™ä¸€æ®µï¼Œ</p><ul><li>å¦‚æœæ˜¯ä¸ªæ™®é€šçš„äººï¼Œé‚£ä¹ˆæˆ‘ä»¬é‡‡ç”¨å†™æ‰©æ•£çš„æ–¹å¼ï¼Œç›´æ¥æŠŠæ•°æ®å†™å…¥åˆ°ä»–çš„ç²‰ä¸ä¸­å»ï¼Œå› ä¸ºæ™®é€šçš„äººä»–çš„ç²‰ä¸å…³æ³¨é‡æ¯”è¾ƒå°ï¼Œæ‰€ä»¥è¿™æ ·åšæ²¡æœ‰å‹åŠ›ï¼Œ</li><li>å¦‚æœæ˜¯å¤§Vï¼Œé‚£ä¹ˆä»–æ˜¯ç›´æ¥å°†æ•°æ®å…ˆå†™å…¥åˆ°ä¸€ä»½åˆ°å‘ä»¶ç®±é‡Œè¾¹å»ï¼Œç„¶åå†ç›´æ¥å†™ä¸€ä»½åˆ°æ´»è·ƒç²‰ä¸æ”¶ä»¶ç®±é‡Œè¾¹å»ï¼Œ</li><li>ç°åœ¨ç«™åœ¨æ”¶ä»¶äººè¿™ç«¯æ¥çœ‹ï¼Œå¦‚æœæ˜¯æ´»è·ƒç²‰ä¸ï¼Œé‚£ä¹ˆå¤§Vå’Œæ™®é€šçš„äººå‘çš„éƒ½ä¼šç›´æ¥å†™å…¥åˆ°è‡ªå·±æ”¶ä»¶ç®±é‡Œè¾¹æ¥ï¼Œè€Œå¦‚æœæ˜¯æ™®é€šçš„ç²‰ä¸ï¼Œç”±äºä»–ä»¬ä¸Šçº¿ä¸æ˜¯å¾ˆé¢‘ç¹ï¼Œæ‰€ä»¥ç­‰ä»–ä»¬ä¸Šçº¿æ—¶ï¼Œå†ä»å‘ä»¶ç®±é‡Œè¾¹å»æ‹‰ä¿¡æ¯ã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/04/02/5287de8ad98247efb3a0e10cf185dfba" alt="1653812346852"></p><p><strong>ä¸‰ç§å®ç°æ–¹æ¡ˆå¯¹æ¯”</strong>ï¼š</p><table><thead><tr><th></th><th><strong>æ‹‰æ¨¡å¼</strong></th><th><strong>æ¨æ¨¡å¼</strong></th><th><strong>æ¨æ‹‰ç»“åˆ</strong></th></tr></thead><tbody><tr><td><strong>å†™æ¯”ä¾‹</strong></td><td>ä½</td><td>é«˜</td><td>ä¸­</td></tr><tr><td><strong>è¯»æ¯”ä¾‹</strong></td><td>é«˜</td><td>ä½</td><td>ä¸­</td></tr><tr><td><strong>ç”¨æˆ·è¯»å–å»¶è¿Ÿ</strong></td><td>é«˜</td><td>ä½</td><td>ä½</td></tr><tr><td><strong>å®ç°éš¾åº¦</strong></td><td>å¤æ‚</td><td>ç®€å•</td><td>å¾ˆå¤æ‚</td></tr><tr><td><strong>ä½¿ç”¨åœºæ™¯</strong></td><td>å¾ˆå°‘ä½¿ç”¨</td><td>ç”¨æˆ·é‡å°‘ã€æ²¡æœ‰å¤§V</td><td>è¿‡åƒä¸‡çš„ç”¨æˆ·é‡ï¼Œæœ‰å¤§V</td></tr></tbody></table><h2 id="hao-you-guan-zhu-tui-song-dao-fen-si-shou-jian-xiang" id="å¥½å‹å…³æ³¨-æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±">å¥½å‹å…³æ³¨-æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±</h2><blockquote><p>éœ€æ±‚ï¼š</p><ul><li>ä¿®æ”¹æ–°å¢æ¢åº—ç¬”è®°çš„ä¸šåŠ¡ï¼Œåœ¨ä¿å­˜blogåˆ°æ•°æ®åº“çš„åŒæ—¶ï¼Œæ¨é€åˆ°ç²‰ä¸çš„æ”¶ä»¶ç®±</li><li>æ”¶ä»¶ç®±æ»¡è¶³å¯ä»¥æ ¹æ®æ—¶é—´æˆ³æ’åºï¼Œå¿…é¡»ç”¨Redisçš„æ•°æ®ç»“æ„å®ç°</li><li>æŸ¥è¯¢æ”¶ä»¶ç®±æ•°æ®æ—¶ï¼Œå¯ä»¥å®ç°åˆ†é¡µæŸ¥è¯¢</li></ul></blockquote><p>Feedæµä¸­çš„æ•°æ®ä¼šä¸æ–­æ›´æ–°ï¼Œæ‰€ä»¥æ•°æ®çš„è§’æ ‡ä¹Ÿåœ¨å˜åŒ–ï¼Œå› æ­¤ä¸èƒ½é‡‡ç”¨ä¼ ç»Ÿçš„åˆ†é¡µæ¨¡å¼ã€‚</p><ul><li>ä¼ ç»Ÿäº†åˆ†é¡µåœ¨feedæµæ˜¯ä¸é€‚ç”¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°æ®ä¼šéšæ—¶å‘ç”Ÿå˜åŒ–</li></ul><p>å‡è®¾åœ¨t1 æ—¶åˆ»ï¼Œæˆ‘ä»¬å»è¯»å–ç¬¬ä¸€é¡µï¼Œæ­¤æ—¶<code>page = 1 ï¼Œsize = 5 </code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‹¿åˆ°çš„å°±æ˜¯<code>10~6 </code>è¿™å‡ æ¡è®°å½•ï¼Œ</p><ul><li>å‡è®¾ç°åœ¨<code>t2</code>æ—¶å€™åˆå‘å¸ƒäº†ä¸€æ¡è®°å½•ï¼Œæ­¤æ—¶<code>t3</code> æ—¶åˆ»ï¼Œæˆ‘ä»¬æ¥è¯»å–ç¬¬äºŒé¡µï¼Œè¯»å–ç¬¬äºŒé¡µä¼ å…¥çš„å‚æ•°æ˜¯<code>page=2</code> ï¼Œ<code>size=5</code> ï¼Œ</li><li>é‚£ä¹ˆæ­¤æ—¶è¯»å–åˆ°çš„ç¬¬äºŒé¡µå®é™…ä¸Šæ˜¯ä»<code>6 </code>å¼€å§‹ï¼Œç„¶åæ˜¯<code>6~2</code> ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯»å–åˆ°äº†é‡å¤çš„æ•°æ®ï¼Œ</li><li>æ‰€ä»¥feedæµçš„åˆ†é¡µï¼Œä¸èƒ½é‡‡ç”¨åŸå§‹æ–¹æ¡ˆæ¥åšã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/04/02/0f494e1034cc41299af1f2b45c1f078f" alt="1653813047671"></p><p>Feedæµçš„<strong>æ»šåŠ¨åˆ†é¡µ</strong></p><p>æˆ‘ä»¬éœ€è¦è®°å½•æ¯æ¬¡æ“ä½œçš„æœ€åä¸€æ¡ï¼Œç„¶åä»è¿™ä¸ªä½ç½®å¼€å§‹å»è¯»å–æ•°æ®</p><p><strong>ä¸¾ä¸ªä¾‹å­</strong>ï¼šæˆ‘ä»¬ä»<code>t1</code>æ—¶åˆ»å¼€å§‹ï¼Œæ‹¿ç¬¬ä¸€é¡µæ•°æ®ï¼Œæ‹¿åˆ°äº†<code>10~6</code>ï¼Œç„¶åè®°å½•ä¸‹å½“å‰æœ€åä¸€æ¬¡æ‹¿å–çš„è®°å½•ï¼Œå°±æ˜¯6ï¼Œ</p><ul><li><code>t2</code>æ—¶åˆ»å‘å¸ƒäº†æ–°çš„è®°å½•ï¼Œæ­¤æ—¶è¿™ä¸ª<code>11</code>æ”¾åˆ°æœ€é¡¶ä¸Šï¼Œä½†æ˜¯ä¸ä¼šå½±å“æˆ‘ä»¬ä¹‹å‰è®°å½•çš„<code>6</code>ï¼Œ</li><li>æ­¤æ—¶<code>t3</code>æ—¶åˆ»æ¥æ‹¿ç¬¬äºŒé¡µï¼Œç¬¬äºŒé¡µè¿™ä¸ªæ—¶å€™æ‹¿æ•°æ®ï¼Œè¿˜æ˜¯ä»<code>6</code>åä¸€ç‚¹çš„<code>5</code>å»æ‹¿ï¼Œå°±æ‹¿åˆ°äº†<code>5-1</code>çš„è®°å½•ã€‚</li><li>æˆ‘ä»¬è¿™ä¸ªåœ°æ–¹å¯ä»¥é‡‡ç”¨<code>sortedSet</code>æ¥åšï¼Œå¯ä»¥è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œå¹¶ä¸”è¿˜å¯ä»¥è®°å½•å½“å‰è·å–æ•°æ®æ—¶é—´æˆ³æœ€å°å€¼ï¼Œå°±å¯ä»¥å®ç°æ»šåŠ¨åˆ†é¡µäº†</li></ul><p><img src="https://s1.vika.cn/space/2023/04/02/aad1fac589804789b1dce4756b2e9f6b" alt="1653813462834"></p><blockquote><p>æ ¸å¿ƒçš„æ„æ€ï¼šå°±æ˜¯æˆ‘ä»¬åœ¨ä¿å­˜å®Œæ¢åº—ç¬”è®°åï¼Œè·å¾—åˆ°å½“å‰ç¬”è®°çš„ç²‰ä¸ï¼Œç„¶åæŠŠæ•°æ®æ¨é€åˆ°ç²‰ä¸çš„redisä¸­å»ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveBlog</span><span class="params">(Blog blog)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">    blog.setUserId(user.getId());</span><br><span class="line">    <span class="comment">// 2.ä¿å­˜æ¢åº—ç¬”è®°</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(blog);</span><br><span class="line">    <span class="keyword">if</span>(!isSuccess)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ–°å¢ç¬”è®°å¤±è´¥!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.æŸ¥è¯¢ç¬”è®°ä½œè€…çš„æ‰€æœ‰ç²‰ä¸ select * from tb_follow where follow_user_id = ?</span></span><br><span class="line">    List&lt;Follow&gt; follows = followService.query().eq(<span class="string">&quot;follow_user_id&quot;</span>, user.getId()).list();</span><br><span class="line">    <span class="comment">// 4.æ¨é€ç¬”è®°idç»™æ‰€æœ‰ç²‰ä¸</span></span><br><span class="line">    <span class="keyword">for</span> (Follow follow : follows) &#123;</span><br><span class="line">        <span class="comment">// 4.1.è·å–ç²‰ä¸id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> follow.getUserId();</span><br><span class="line">        <span class="comment">// 4.2.æ¨é€</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> FEED_KEY + userId;</span><br><span class="line">        stringRedisTemplate.opsForZSet().add(key, blog.getId().toString(), System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.è¿”å›id</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(blog.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="hao-you-guan-zhu-shi-xian-fen-ye-cha-xun-shou-you-xiang" id="å¥½å‹å…³æ³¨-å®ç°åˆ†é¡µæŸ¥è¯¢æ”¶é‚®ç®±">å¥½å‹å…³æ³¨-å®ç°åˆ†é¡µæŸ¥è¯¢æ”¶é‚®ç®±</h2><blockquote><p>éœ€æ±‚ï¼šåœ¨ä¸ªäººä¸»é¡µçš„â€œå…³æ³¨â€å¡ç‰‡ä¸­ï¼ŒæŸ¥è¯¢å¹¶å±•ç¤ºæ¨é€çš„Blogä¿¡æ¯ï¼š</p></blockquote><p>å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p><ol><li><p>æ¯æ¬¡æŸ¥è¯¢å®Œæˆåï¼Œæˆ‘ä»¬è¦åˆ†æå‡ºæŸ¥è¯¢å‡ºæ•°æ®çš„æœ€å°æ—¶é—´æˆ³ï¼Œè¿™ä¸ªå€¼ä¼šä½œä¸ºä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„æ¡ä»¶</p></li><li><p>æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸ä¸Šä¸€æ¬¡æŸ¥è¯¢ç›¸åŒçš„æŸ¥è¯¢ä¸ªæ•°ä½œä¸ºåç§»é‡ï¼Œä¸‹æ¬¡æŸ¥è¯¢æ—¶ï¼Œè·³è¿‡è¿™äº›æŸ¥è¯¢è¿‡çš„æ•°æ®ï¼Œæ‹¿åˆ°æˆ‘ä»¬éœ€è¦çš„æ•°æ®</p></li></ol><p>ç»¼ä¸Šï¼šæˆ‘ä»¬çš„è¯·æ±‚å‚æ•°ä¸­å°±éœ€è¦æºå¸¦ <code>lastId</code>ï¼šä¸Šä¸€æ¬¡æŸ¥è¯¢çš„<code>æœ€å°æ—¶é—´æˆ³</code> å’Œ<code>åç§»é‡</code>è¿™ä¸¤ä¸ªå‚æ•°ã€‚</p><p>è¿™ä¸¤ä¸ªå‚æ•°ç¬¬ä¸€æ¬¡ä¼šç”±å‰ç«¯æ¥æŒ‡å®šï¼Œä»¥åçš„æŸ¥è¯¢å°±æ ¹æ®åå°ç»“æœä½œä¸ºæ¡ä»¶ï¼Œå†æ¬¡ä¼ é€’åˆ°åå°ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/02/98199814ea304d97b2fa12fa886fa6b8" alt="1653819821591"></p><ol><li>å®šä¹‰å‡ºæ¥å…·ä½“çš„è¿”å›å€¼å®ä½“ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScrollResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;?&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Long minTime;</span><br><span class="line">    <span class="keyword">private</span> Integer offset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>BlogController</strong></p><p>æ³¨æ„ï¼šRequestParam è¡¨ç¤ºæ¥å—urlåœ°å€æ ä¼ å‚çš„æ³¨è§£ï¼Œå½“æ–¹æ³•ä¸Šå‚æ•°çš„åç§°å’Œurlåœ°å€æ ä¸ç›¸åŒæ—¶ï¼Œå¯ä»¥é€šè¿‡RequestParam æ¥è¿›è¡ŒæŒ‡å®š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/of/follow&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogOfFollow</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam(&quot;lastId&quot;)</span> Long max, <span class="meta">@RequestParam(value = &quot;offset&quot;, defaultValue = &quot;0&quot;)</span> Integer offset)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> blogService.queryBlogOfFollow(max, offset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>BlogServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogOfFollow</span><span class="params">(Long max, Integer offset)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 2.æŸ¥è¯¢æ”¶ä»¶ç®± ZREVRANGEBYSCORE key Max Min LIMIT offset count</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> FEED_KEY + userId;</span><br><span class="line">    Set&lt;ZSetOperations.TypedTuple&lt;String&gt;&gt; typedTuples = stringRedisTemplate.opsForZSet()</span><br><span class="line">        .reverseRangeByScoreWithScores(key, <span class="number">0</span>, max, offset, <span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 3.éç©ºåˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (typedTuples == <span class="literal">null</span> || typedTuples.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.è§£ææ•°æ®ï¼šblogIdã€minTimeï¼ˆæ—¶é—´æˆ³ï¼‰ã€offset</span></span><br><span class="line">    List&lt;Long&gt; ids = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(typedTuples.size());</span><br><span class="line">    <span class="type">long</span> <span class="variable">minTime</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// 2</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">os</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">// 2</span></span><br><span class="line">    <span class="keyword">for</span> (ZSetOperations.TypedTuple&lt;String&gt; tuple : typedTuples) &#123; <span class="comment">// 5 4 4 2 2</span></span><br><span class="line">        <span class="comment">// 4.1.è·å–id</span></span><br><span class="line">        ids.add(Long.valueOf(tuple.getValue()));</span><br><span class="line">        <span class="comment">// 4.2.è·å–åˆ†æ•°(æ—¶é—´æˆ³ï¼‰</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> tuple.getScore().longValue();</span><br><span class="line">        <span class="keyword">if</span>(time == minTime)&#123;</span><br><span class="line">            os++;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            minTime = time;</span><br><span class="line">            os = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">os = minTime == max ? os : os + offset;</span><br><span class="line">    <span class="comment">// 5.æ ¹æ®idæŸ¥è¯¢blog</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">idStr</span> <span class="operator">=</span> StrUtil.join(<span class="string">&quot;,&quot;</span>, ids);</span><br><span class="line">    List&lt;Blog&gt; blogs = query().in(<span class="string">&quot;id&quot;</span>, ids).last(<span class="string">&quot;ORDER BY FIELD(id,&quot;</span> + idStr + <span class="string">&quot;)&quot;</span>).list();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Blog blog : blogs) &#123;</span><br><span class="line">        <span class="comment">// 5.1.æŸ¥è¯¢blogæœ‰å…³çš„ç”¨æˆ·</span></span><br><span class="line">        queryBlogUser(blog);</span><br><span class="line">        <span class="comment">// 5.2.æŸ¥è¯¢blogæ˜¯å¦è¢«ç‚¹èµ</span></span><br><span class="line">        isBlogLiked(blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.å°è£…å¹¶è¿”å›</span></span><br><span class="line">    <span class="type">ScrollResult</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScrollResult</span>();</span><br><span class="line">    r.setList(blogs);</span><br><span class="line">    r.setOffset(os);</span><br><span class="line">    r.setMinTime(minTime);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result.ok(r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="fu-jin-shang-hu">é™„è¿‘å•†æˆ·</h1><h2 id="fu-jin-shang-hu-geo-shu-ju-jie-gou-de-ji-ben-yong-fa" id="é™„è¿‘å•†æˆ·-GEOæ•°æ®ç»“æ„çš„åŸºæœ¬ç”¨æ³•">é™„è¿‘å•†æˆ·-GEOæ•°æ®ç»“æ„çš„åŸºæœ¬ç”¨æ³•</h2><p>GEOå°±æ˜¯Geolocationçš„ç®€å†™å½¢å¼ï¼Œä»£è¡¨åœ°ç†åæ ‡ã€‚Redisåœ¨3.2ç‰ˆæœ¬ä¸­åŠ å…¥äº†å¯¹GEOçš„æ”¯æŒï¼Œå…è®¸å­˜å‚¨åœ°ç†åæ ‡ä¿¡æ¯ï¼Œå¸®åŠ©æˆ‘ä»¬æ ¹æ®ç»çº¬åº¦æ¥æ£€ç´¢æ•°æ®ã€‚å¸¸è§çš„å‘½ä»¤æœ‰ï¼š</p><ul><li><code>GEOADD</code>ï¼šæ·»åŠ ä¸€ä¸ªåœ°ç†ç©ºé—´ä¿¡æ¯ï¼ŒåŒ…å«ï¼šç»åº¦ï¼ˆlongitudeï¼‰ã€çº¬åº¦ï¼ˆlatitudeï¼‰ã€å€¼ï¼ˆmemberï¼‰</li><li><code>GEODIST</code>ï¼šè®¡ç®—æŒ‡å®šçš„ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»å¹¶è¿”å›</li><li><code>GEOHASH</code>ï¼šå°†æŒ‡å®šmemberçš„åæ ‡è½¬ä¸ºhashå­—ç¬¦ä¸²å½¢å¼å¹¶è¿”å›</li><li><code>GEOPOS</code>ï¼šè¿”å›æŒ‡å®šmemberçš„åæ ‡</li><li><code>GEORADIUS</code>ï¼šæŒ‡å®šåœ†å¿ƒã€åŠå¾„ï¼Œæ‰¾åˆ°è¯¥åœ†å†…åŒ…å«çš„æ‰€æœ‰memberï¼Œå¹¶æŒ‰ç…§ä¸åœ†å¿ƒä¹‹é—´çš„è·ç¦»æ’åºåè¿”å›ã€‚6.ä»¥åå·²åºŸå¼ƒ</li><li><code>GEOSEARCH</code>ï¼šåœ¨æŒ‡å®šèŒƒå›´å†…æœç´¢memberï¼Œå¹¶æŒ‰ç…§ä¸æŒ‡å®šç‚¹ä¹‹é—´çš„è·ç¦»æ’åºåè¿”å›ã€‚èŒƒå›´å¯ä»¥æ˜¯åœ†å½¢æˆ–çŸ©å½¢ã€‚6.2.æ–°åŠŸèƒ½</li><li><code>GEOSEARCHSTORE</code>ï¼šä¸GEOSEARCHåŠŸèƒ½ä¸€è‡´ï¼Œä¸è¿‡å¯ä»¥æŠŠç»“æœå­˜å‚¨åˆ°ä¸€ä¸ªæŒ‡å®šçš„keyã€‚ 6.2.æ–°åŠŸèƒ½</li></ul><h2 id="fu-jin-shang-hu-dao-ru-dian-pu-shu-ju-dao-geo" id="é™„è¿‘å•†æˆ·-å¯¼å…¥åº—é“ºæ•°æ®åˆ°GEO">é™„è¿‘å•†æˆ·-å¯¼å…¥åº—é“ºæ•°æ®åˆ°GEO</h2><p>å…·ä½“åœºæ™¯è¯´æ˜ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/04/c2b6e45d08624d36bd05d681832c61c7" alt="1653822036941"></p><p>å½“æˆ‘ä»¬ç‚¹å‡»ç¾é£Ÿä¹‹åï¼Œä¼šå‡ºç°ä¸€ç³»åˆ—çš„å•†å®¶ï¼Œå•†å®¶ä¸­å¯ä»¥æŒ‰ç…§å¤šç§æ’åºæ–¹å¼ï¼Œæˆ‘ä»¬æ­¤æ—¶å…³æ³¨çš„æ˜¯è·ç¦»ï¼Œ</p><ul><li>è¿™ä¸ªåœ°æ–¹å°±éœ€è¦ä½¿ç”¨åˆ°æˆ‘ä»¬çš„GEOï¼Œå‘åå°ä¼ å…¥å½“å‰appæ”¶é›†çš„åœ°å€(æˆ‘ä»¬æ­¤å¤„æ˜¯å†™æ­»çš„) ï¼Œ</li><li>ä»¥å½“å‰åæ ‡ä½œä¸ºåœ†å¿ƒï¼ŒåŒæ—¶ç»‘å®šç›¸åŒçš„åº—å®¶ç±»å‹typeï¼Œä»¥åŠåˆ†é¡µä¿¡æ¯ï¼ŒæŠŠè¿™å‡ ä¸ªæ¡ä»¶ä¼ å…¥åå°ï¼Œåå°æŸ¥è¯¢å‡ºå¯¹åº”çš„æ•°æ®å†è¿”å›ã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/04/04/79d24a6571e547138b4f0ed6797d9026" alt="1653822021827"></p><p>æˆ‘ä»¬è¦åšçš„äº‹æƒ…æ˜¯ï¼šå°†æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®å¯¼å…¥åˆ°redisä¸­å»ï¼Œredisä¸­çš„GEOï¼Œ</p><ul><li>GEOåœ¨redisä¸­å°±<code>ä¸€ä¸ªmenber</code>å’Œ<code>ä¸€ä¸ªç»çº¬åº¦</code>ï¼Œæˆ‘ä»¬æŠŠxå’Œyè½´ä¼ å…¥åˆ°redisåšçš„ç»çº¬åº¦ä½ç½®å»ï¼Œ</li><li>ä½†æˆ‘ä»¬ä¸èƒ½æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½æ”¾å…¥åˆ°menberä¸­å»ï¼Œæ¯•ç«Ÿä½œä¸ºredisæ˜¯ä¸€ä¸ªå†…å­˜çº§æ•°æ®åº“ï¼Œå¦‚æœå­˜æµ·é‡æ•°æ®ï¼Œredisè¿˜æ˜¯åŠ›ä¸ä»å¿ƒï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™ä¸ªåœ°æ–¹å­˜å‚¨ä»–çš„<code>id</code>å³å¯ã€‚</li></ul><p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨redisä¸­å¹¶æ²¡æœ‰å­˜å‚¨typeï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•æ ¹æ®typeæ¥å¯¹æ•°æ®è¿›è¡Œç­›é€‰ï¼Œ</p><ul><li>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‰ç…§å•†æˆ·ç±»å‹åšåˆ†ç»„ï¼Œç±»å‹ç›¸åŒçš„å•†æˆ·ä½œä¸ºåŒä¸€ç»„ï¼Œä»¥<code>typeIdä¸ºkey</code>å­˜å…¥åŒä¸€ä¸ªGEOé›†åˆä¸­å³å¯</li></ul><p><strong>ä»£ç </strong></p><p><code>Map&lt;Long, List&lt;Shop&gt;&gt; map = list.stream().collect(Collectors.groupingBy(Shop::getTypeId));</code></p><ul><li>å¯ä»¥æ ¹æ®typeIdå¯¹ list é›†åˆè¿›è¡Œåˆ†ç»„å½¢æˆä¸€ä¸ªmapé›†åˆ</li></ul><p>HmDianPingApplicationTests</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">loadShopData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢åº—é“ºä¿¡æ¯</span></span><br><span class="line">    List&lt;Shop&gt; list = shopService.list();</span><br><span class="line">    <span class="comment">// 2.æŠŠåº—é“ºåˆ†ç»„ï¼ŒæŒ‰ç…§typeIdåˆ†ç»„ï¼ŒtypeIdä¸€è‡´çš„æ”¾åˆ°ä¸€ä¸ªé›†åˆ</span></span><br><span class="line">    Map&lt;Long, List&lt;Shop&gt;&gt; map = list.stream().collect(Collectors.groupingBy(Shop::getTypeId));</span><br><span class="line">    <span class="comment">// 3.åˆ†æ‰¹å®Œæˆå†™å…¥Redis</span></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;Long, List&lt;Shop&gt;&gt; entry : map.entrySet()) &#123;</span><br><span class="line">        <span class="comment">// 3.1.è·å–ç±»å‹id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">typeId</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> SHOP_GEO_KEY + typeId;</span><br><span class="line">        <span class="comment">// 3.2.è·å–åŒç±»å‹çš„åº—é“ºçš„é›†åˆ</span></span><br><span class="line">        List&lt;Shop&gt; value = entry.getValue();</span><br><span class="line">        List&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; locations = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(value.size());</span><br><span class="line">        <span class="comment">// 3.3.å†™å…¥redis GEOADD key ç»åº¦ çº¬åº¦ member</span></span><br><span class="line">        <span class="keyword">for</span> (Shop shop : value) &#123;</span><br><span class="line">            <span class="comment">// stringRedisTemplate.opsForGeo().add(key, new Point(shop.getX(), shop.getY()), shop.getId().toString());</span></span><br><span class="line">            locations.add(<span class="keyword">new</span> <span class="title class_">RedisGeoCommands</span>.GeoLocation&lt;&gt;(</span><br><span class="line">                    shop.getId().toString(),</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">Point</span>(shop.getX(), shop.getY())</span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line">        stringRedisTemplate.opsForGeo().add(key, locations);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="fu-jin-shang-hu-shi-xian-fu-jin-shang-hu-gong-neng" id="é™„è¿‘å•†æˆ·-å®ç°é™„è¿‘å•†æˆ·åŠŸèƒ½">é™„è¿‘å•†æˆ·-å®ç°é™„è¿‘å•†æˆ·åŠŸèƒ½</h2><p>SpringDataRedisçš„2.3.9ç‰ˆæœ¬å¹¶ä¸æ”¯æŒRedis 6.2æä¾›çš„GEOSEARCHå‘½ä»¤ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æç¤ºå…¶ç‰ˆæœ¬ï¼Œä¿®æ”¹è‡ªå·±çš„POM</p><p>ç¬¬ä¸€æ­¥ï¼šå¯¼å…¥pom</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.1.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼š</p><p>ShopController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/of/type&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryShopByType</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(&quot;typeId&quot;)</span> Integer typeId,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(value = &quot;current&quot;, defaultValue = &quot;1&quot;)</span> Integer current,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(value = &quot;x&quot;, required = false)</span> Double x,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(value = &quot;y&quot;, required = false)</span> Double y</span></span><br><span class="line"><span class="params">)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> shopService.queryShopByType(typeId, current, x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ShopServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">queryShopByType</span><span class="params">(Integer typeId, Integer current, Double x, Double y)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.åˆ¤æ–­æ˜¯å¦éœ€è¦æ ¹æ®åæ ‡æŸ¥è¯¢</span></span><br><span class="line">        <span class="keyword">if</span> (x == <span class="literal">null</span> || y == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// ä¸éœ€è¦åæ ‡æŸ¥è¯¢ï¼ŒæŒ‰æ•°æ®åº“æŸ¥è¯¢</span></span><br><span class="line">            Page&lt;Shop&gt; page = query()</span><br><span class="line">                    .eq(<span class="string">&quot;type_id&quot;</span>, typeId)</span><br><span class="line">                    .page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, SystemConstants.DEFAULT_PAGE_SIZE));</span><br><span class="line">            <span class="comment">// è¿”å›æ•°æ®</span></span><br><span class="line">            <span class="keyword">return</span> Result.ok(page.getRecords());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.è®¡ç®—åˆ†é¡µå‚æ•°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">from</span> <span class="operator">=</span> (current - <span class="number">1</span>) * SystemConstants.DEFAULT_PAGE_SIZE;</span><br><span class="line">        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> current * SystemConstants.DEFAULT_PAGE_SIZE;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.æŸ¥è¯¢redisã€æŒ‰ç…§è·ç¦»æ’åºã€åˆ†é¡µã€‚ç»“æœï¼šshopIdã€distance</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> SHOP_GEO_KEY + typeId;</span><br><span class="line">        GeoResults&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; results = stringRedisTemplate.opsForGeo() <span class="comment">// GEOSEARCH key BYLONLAT x y BYRADIUS 10 WITHDISTANCE</span></span><br><span class="line">                .search(</span><br><span class="line">                        key,</span><br><span class="line">                        GeoReference.fromCoordinate(x, y),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Distance</span>(<span class="number">5000</span>),</span><br><span class="line">                        RedisGeoCommands.GeoSearchCommandArgs.newGeoSearchArgs().includeDistance().limit(end)</span><br><span class="line">                );</span><br><span class="line">        <span class="comment">// 4.è§£æå‡ºid</span></span><br><span class="line">        <span class="keyword">if</span> (results == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;GeoResult&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt;&gt; list = results.getContent();</span><br><span class="line">        <span class="keyword">if</span> (list.size() &lt;= from) &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰ä¸‹ä¸€é¡µäº†ï¼Œç»“æŸ</span></span><br><span class="line">            <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.1.æˆªå– from ~ endçš„éƒ¨åˆ†</span></span><br><span class="line">        List&lt;Long&gt; ids = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list.size());</span><br><span class="line">        Map&lt;String, Distance&gt; distanceMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(list.size());</span><br><span class="line">        list.stream().skip(from).forEach(result -&gt; &#123;</span><br><span class="line">            <span class="comment">// 4.2.è·å–åº—é“ºid</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">shopIdStr</span> <span class="operator">=</span> result.getContent().getName();</span><br><span class="line">            ids.add(Long.valueOf(shopIdStr));</span><br><span class="line">            <span class="comment">// 4.3.è·å–è·ç¦»</span></span><br><span class="line">            <span class="type">Distance</span> <span class="variable">distance</span> <span class="operator">=</span> result.getDistance();</span><br><span class="line">            distanceMap.put(shopIdStr, distance);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 5.æ ¹æ®idæŸ¥è¯¢Shop</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">idStr</span> <span class="operator">=</span> StrUtil.join(<span class="string">&quot;,&quot;</span>, ids);</span><br><span class="line">        List&lt;Shop&gt; shops = query().in(<span class="string">&quot;id&quot;</span>, ids).last(<span class="string">&quot;ORDER BY FIELD(id,&quot;</span> + idStr + <span class="string">&quot;)&quot;</span>).list();</span><br><span class="line">        <span class="keyword">for</span> (Shop shop : shops) &#123;</span><br><span class="line">            shop.setDistance(distanceMap.get(shop.getId().toString()).getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6.è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(shops);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="yong-hu-qian-dao">ç”¨æˆ·ç­¾åˆ°</h1><h2 id="yong-hu-qian-dao-bit-map-gong-neng-yan-shi" id="ç”¨æˆ·ç­¾åˆ°-BitMapåŠŸèƒ½æ¼”ç¤º">ç”¨æˆ·ç­¾åˆ°-BitMapåŠŸèƒ½æ¼”ç¤º</h2><p>æˆ‘ä»¬é’ˆå¯¹ç­¾åˆ°åŠŸèƒ½å®Œå…¨å¯ä»¥é€šè¿‡mysqlæ¥å®Œæˆï¼Œæ¯”å¦‚è¯´ä»¥ä¸‹è¿™å¼ è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `tb_sign` (</span><br><span class="line">  `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT &#x27;ä¸»é”®&#x27;,</span><br><span class="line">  `user_id` bigint unsigned NOT NULL COMMENT &#x27;ç”¨æˆ·id&#x27;,</span><br><span class="line">  `year` year NOT NULL COMMENT &#x27;ç­¾åˆ°çš„å¹´&#x27;,</span><br><span class="line">  `month` tinyint NOT NULL COMMENT &#x27;ç­¾åˆ°çš„æœˆ&#x27;,</span><br><span class="line">  `date` date NOT NULL COMMENT &#x27;ç­¾åˆ°çš„æ—¥æœŸ&#x27;,</span><br><span class="line">  `is_backup` tinyint unsigned DEFAULT NULL COMMENT &#x27;æ˜¯å¦è¡¥ç­¾&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci ROW_FORMAT=COMPACT;</span><br></pre></td></tr></table></figure><p>ç”¨æˆ·ä¸€æ¬¡ç­¾åˆ°ï¼Œå°±æ˜¯ä¸€æ¡è®°å½•ï¼Œ</p><ul><li><p>å‡å¦‚æœ‰1000ä¸‡ç”¨æˆ·ï¼Œå¹³å‡æ¯äººæ¯å¹´ç­¾åˆ°æ¬¡æ•°ä¸º10æ¬¡ï¼Œåˆ™è¿™å¼ è¡¨ä¸€å¹´çš„æ•°æ®é‡ä¸º 1äº¿æ¡</p></li><li><p>æ¯ç­¾åˆ°ä¸€æ¬¡éœ€è¦ä½¿ç”¨ï¼ˆ8 + 8 + 1 + 1 + 3 + 1ï¼‰å…±22 å­—èŠ‚çš„å†…å­˜ï¼Œä¸€ä¸ªæœˆåˆ™æœ€å¤šéœ€è¦600å¤šå­—èŠ‚</p></li></ul><p>æˆ‘ä»¬å¦‚ä½•èƒ½å¤Ÿç®€åŒ–ä¸€ç‚¹å‘¢ï¼Ÿ</p><ul><li>å…¶å®å¯ä»¥è€ƒè™‘å°æ—¶å€™ä¸€ä¸ªæŒºå¸¸è§çš„æ–¹æ¡ˆï¼Œå°±æ˜¯å°æ—¶å€™ï¼Œå’±ä»¬å‡†å¤‡ä¸€å¼ å°å°çš„å¡ç‰‡ï¼Œä½ åªè¦ç­¾åˆ°å°±æ‰“ä¸Šä¸€ä¸ªå‹¾ï¼Œæˆ‘æœ€ååˆ¤æ–­ä½ æ˜¯å¦ç­¾åˆ°ï¼Œå…¶å®åªéœ€è¦åˆ°å°å¡ç‰‡ä¸Šçœ‹ä¸€çœ‹å°±çŸ¥é“äº†</li></ul><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç±»ä¼¼è¿™æ ·çš„æ–¹æ¡ˆæ¥å®ç°æˆ‘ä»¬çš„ç­¾åˆ°éœ€æ±‚ã€‚</p><ul><li><p>æˆ‘ä»¬æŒ‰æœˆæ¥ç»Ÿè®¡ç”¨æˆ·ç­¾åˆ°ä¿¡æ¯ï¼Œç­¾åˆ°è®°å½•ä¸º1ï¼Œæœªç­¾åˆ°åˆ™è®°å½•ä¸º0.</p></li><li><p>æŠŠæ¯ä¸€ä¸ªbitä½å¯¹åº”å½“æœˆçš„æ¯ä¸€å¤©ï¼Œå½¢æˆäº†æ˜ å°„å…³ç³»ã€‚ç”¨0å’Œ1æ ‡ç¤ºä¸šåŠ¡çŠ¶æ€ï¼Œè¿™ç§æ€è·¯å°±ç§°ä¸ºä½å›¾ï¼ˆBitMapï¼‰ã€‚è¿™æ ·æˆ‘ä»¬å°±ç”¨æå°çš„ç©ºé—´ï¼Œæ¥å®ç°äº†å¤§é‡æ•°æ®çš„è¡¨ç¤º</p></li></ul><p>Redisä¸­æ˜¯åˆ©ç”¨stringç±»å‹æ•°æ®ç»“æ„å®ç°<code>BitMap</code>ï¼Œå› æ­¤æœ€å¤§ä¸Šé™æ˜¯512Mï¼Œè½¬æ¢ä¸ºbitåˆ™æ˜¯ 2^32ä¸ªbitä½ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/04/55700ba2fa054f9492090d088f80d673" alt="1653824498278"></p><p>BitMapçš„æ“ä½œå‘½ä»¤æœ‰ï¼š</p><ul><li><code>SETBIT</code>ï¼šå‘æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰å­˜å…¥ä¸€ä¸ª0æˆ–1</li><li><code>GETBIT</code> ï¼šè·å–æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰çš„bitå€¼</li><li><code>BITCOUNT</code> ï¼šç»Ÿè®¡BitMapä¸­å€¼ä¸º1çš„bitä½çš„æ•°é‡</li><li><code>BITFIELD</code> ï¼šæ“ä½œï¼ˆæŸ¥è¯¢ã€ä¿®æ”¹ã€è‡ªå¢ï¼‰BitMapä¸­bitæ•°ç»„ä¸­çš„æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰çš„å€¼</li><li><code>BITFIELD_RO</code> ï¼šè·å–BitMapä¸­bitæ•°ç»„ï¼Œå¹¶ä»¥åè¿›åˆ¶å½¢å¼è¿”å›</li><li><code>BITOP</code> ï¼šå°†å¤šä¸ªBitMapçš„ç»“æœåšä½è¿ç®—ï¼ˆä¸ ã€æˆ–ã€å¼‚æˆ–ï¼‰</li><li><code>BITPOS</code> ï¼šæŸ¥æ‰¾bitæ•°ç»„ä¸­æŒ‡å®šèŒƒå›´å†…ç¬¬ä¸€ä¸ª0æˆ–1å‡ºç°çš„ä½ç½®</li></ul><h2 id="yong-hu-qian-dao-shi-xian-qian-dao-gong-neng" id="ç”¨æˆ·ç­¾åˆ°-å®ç°ç­¾åˆ°åŠŸèƒ½">ç”¨æˆ·ç­¾åˆ°-å®ç°ç­¾åˆ°åŠŸèƒ½</h2><blockquote><p>éœ€æ±‚ï¼šå®ç°ç­¾åˆ°æ¥å£ï¼Œå°†å½“å‰ç”¨æˆ·å½“å¤©ç­¾åˆ°ä¿¡æ¯ä¿å­˜åˆ°Redisä¸­</p></blockquote><p><strong>æ€è·¯</strong>ï¼š</p><ul><li><p>æˆ‘ä»¬å¯ä»¥æŠŠå¹´å’Œæœˆä½œä¸ºbitMapçš„keyï¼Œç„¶åä¿å­˜åˆ°ä¸€ä¸ªbitMapä¸­ï¼Œ</p></li><li><p>æ¯æ¬¡ç­¾åˆ°å°±åˆ°å¯¹åº”çš„ä½ä¸ŠæŠŠæ•°å­—ä»0å˜æˆ1ï¼Œåªè¦å¯¹åº”æ˜¯1ï¼Œå°±è¡¨æ˜è¯´æ˜è¿™ä¸€å¤©å·²ç»ç­¾åˆ°äº†ï¼Œåä¹‹åˆ™æ²¡æœ‰ç­¾åˆ°ã€‚</p></li></ul><p>æˆ‘ä»¬é€šè¿‡æ¥å£æ–‡æ¡£å‘ç°ï¼Œæ­¤æ¥å£å¹¶æ²¡æœ‰ä¼ é€’ä»»ä½•çš„å‚æ•°ï¼Œæ²¡æœ‰å‚æ•°æ€ä¹ˆç¡®å®æ˜¯å“ªä¸€å¤©ç­¾åˆ°å‘¢ï¼Ÿè¿™ä¸ªå¾ˆå®¹æ˜“ï¼Œå¯ä»¥é€šè¿‡åå°ä»£ç ç›´æ¥è·å–å³å¯ï¼Œç„¶ååˆ°å¯¹åº”çš„åœ°å€ä¸Šå»ä¿®æ”¹bitMapã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/04/5a0dc0f882834709ab3d5ae558870502" alt="1653833970361"></p><p><strong>ä»£ç </strong></p><p><strong>UserController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/sign&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sign</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> userService.sign();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>UserServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sign</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 2.è·å–æ—¥æœŸ</span></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">    <span class="comment">// 3.æ‹¼æ¥key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">keySuffix</span> <span class="operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;:yyyyMM&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> USER_SIGN_KEY + userId + keySuffix;</span><br><span class="line">    <span class="comment">// 4.è·å–ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">dayOfMonth</span> <span class="operator">=</span> now.getDayOfMonth();</span><br><span class="line">    <span class="comment">// 5.å†™å…¥Redis SETBIT key offset 1</span></span><br><span class="line">    stringRedisTemplate.opsForValue().setBit(key, dayOfMonth - <span class="number">1</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="yong-hu-qian-dao-qian-dao-tong-ji" id="ç”¨æˆ·ç­¾åˆ°-ç­¾åˆ°ç»Ÿè®¡">ç”¨æˆ·ç­¾åˆ°-ç­¾åˆ°ç»Ÿè®¡</h2><p>**é—®é¢˜1ï¼š**ä»€ä¹ˆå«åšè¿ç»­ç­¾åˆ°å¤©æ•°ï¼Ÿ<br>ä»æœ€åä¸€æ¬¡ç­¾åˆ°å¼€å§‹å‘å‰ç»Ÿè®¡ï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€æ¬¡æœªç­¾åˆ°ä¸ºæ­¢ï¼Œè®¡ç®—æ€»çš„ç­¾åˆ°æ¬¡æ•°ï¼Œå°±æ˜¯è¿ç»­ç­¾åˆ°å¤©æ•°ã€‚</p><p><img src="https://s1.vika.cn/space/2023/04/04/3943edb72d4b4b62a7f82cafcc6f6df8" alt="1653834455899"></p><p>Javaé€»è¾‘ä»£ç ï¼š</p><ul><li>è·å¾—å½“å‰è¿™ä¸ªæœˆçš„æœ€åä¸€æ¬¡ç­¾åˆ°æ•°æ®ï¼Œ</li><li>å®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç„¶åä¸åœçš„<code>å‘å‰</code>ç»Ÿè®¡ï¼Œç›´åˆ°è·å¾—ç¬¬ä¸€ä¸ª<code>é0</code>çš„æ•°å­—å³å¯ï¼Œ</li><li>æ¯å¾—åˆ°ä¸€ä¸ª<code>é0</code>çš„æ•°å­—è®¡æ•°å™¨<code>+1</code>ï¼Œç›´åˆ°éå†å®Œæ‰€æœ‰çš„æ•°æ®ï¼Œå°±å¯ä»¥è·å¾—å½“å‰æœˆçš„ç­¾åˆ°æ€»å¤©æ•°äº†</li></ul><p>**é—®é¢˜2ï¼š**å¦‚ä½•å¾—åˆ°æœ¬æœˆåˆ°ä»Šå¤©ä¸ºæ­¢çš„æ‰€æœ‰ç­¾åˆ°æ•°æ®ï¼Ÿ</p><p><code>BITFIELD key GET u[dayOfMonth] 0</code></p><p>å‡è®¾ä»Šå¤©æ˜¯10å·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä»å½“å‰æœˆçš„ç¬¬ä¸€å¤©å¼€å§‹ï¼Œè·å¾—åˆ°å½“å‰è¿™ä¸€å¤©çš„ä½æ•°ï¼Œæ˜¯10å·ï¼Œé‚£ä¹ˆå°±æ˜¯10ä½ï¼Œå»æ‹¿è¿™æ®µæ—¶é—´çš„æ•°æ®ï¼Œå°±èƒ½æ‹¿åˆ°æ‰€æœ‰çš„æ•°æ®äº†ï¼Œé‚£ä¹ˆè¿™10å¤©é‡Œè¾¹ç­¾åˆ°äº†å¤šå°‘æ¬¡å‘¢ï¼Ÿç»Ÿè®¡æœ‰å¤šå°‘ä¸ª1å³å¯ã€‚</p><p><strong>é—®é¢˜3ï¼šå¦‚ä½•ä»åå‘å‰éå†æ¯ä¸ªbitä½ï¼Ÿ</strong></p><p><code>æ³¨æ„</code>ï¼šbitMapè¿”å›çš„æ•°æ®æ˜¯10è¿›åˆ¶ï¼Œ</p><ul><li>é‚£å‡å¦‚è¯´è¿”å›ä¸€ä¸ªæ•°å­—8ï¼Œé‚£ä¹ˆæˆ‘å“ªå„¿çŸ¥é“åˆ°åº•å“ªäº›æ˜¯0ï¼Œå“ªäº›æ˜¯1å‘¢ï¼Ÿ</li><li>æˆ‘ä»¬åªéœ€è¦è®©å¾—åˆ°çš„10è¿›åˆ¶æ•°å­—å’Œ1åšä¸è¿ç®—å°±å¯ä»¥äº†ï¼Œå› ä¸º1åªæœ‰é‡è§1 æ‰æ˜¯1ï¼Œå…¶ä»–æ•°å­—éƒ½æ˜¯0 ï¼Œ</li><li>æˆ‘ä»¬æŠŠç­¾åˆ°ç»“æœå’Œ1è¿›è¡Œ<code>ä¸</code>æ“ä½œï¼Œæ¯<code>ä¸</code>ä¸€æ¬¡ï¼Œå°±æŠŠç­¾åˆ°ç»“æœ<code>å‘å³ç§»åŠ¨ä¸€ä½</code>ï¼ˆ<code>&gt;&gt;</code>ï¼‰ï¼Œä¾æ¬¡å†…æ¨ï¼Œæˆ‘ä»¬å°±èƒ½å®Œæˆé€ä¸ªéå†çš„æ•ˆæœäº†ã€‚</li></ul><blockquote><p>éœ€æ±‚ï¼šå®ç°ä¸‹é¢æ¥å£ï¼Œç»Ÿè®¡å½“å‰ç”¨æˆ·æˆªæ­¢å½“å‰æ—¶é—´åœ¨æœ¬æœˆçš„è¿ç»­ç­¾åˆ°å¤©æ•°</p></blockquote><p>æœ‰ç”¨æˆ·å’Œæœ‰æ—¶é—´æˆ‘ä»¬å°±å¯ä»¥ç»„ç»‡å‡ºå¯¹åº”çš„keyï¼Œæ­¤æ—¶å°±èƒ½æ‰¾åˆ°è¿™ä¸ªç”¨æˆ·æˆªæ­¢è¿™å¤©çš„æ‰€æœ‰ç­¾åˆ°è®°å½•ï¼Œå†æ ¹æ®è¿™å¥—ç®—æ³•ï¼Œå°±èƒ½ç»Ÿè®¡å‡ºæ¥ä»–è¿ç»­ç­¾åˆ°çš„æ¬¡æ•°äº†</p><p><img src="https://s1.vika.cn/space/2023/04/04/a00a5b51c49c47fa8c94a3815fd5457f" alt="1653835784444"></p><p>ä»£ç </p><p><strong>UserController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/sign/count&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">signCount</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userService.signCount();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>UserServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">signCount</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 2.è·å–æ—¥æœŸ</span></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">    <span class="comment">// 3.æ‹¼æ¥key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">keySuffix</span> <span class="operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;:yyyyMM&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> USER_SIGN_KEY + userId + keySuffix;</span><br><span class="line">    <span class="comment">// 4.è·å–ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">dayOfMonth</span> <span class="operator">=</span> now.getDayOfMonth();</span><br><span class="line">    <span class="comment">// 5.è·å–æœ¬æœˆæˆªæ­¢ä»Šå¤©ä¸ºæ­¢çš„æ‰€æœ‰çš„ç­¾åˆ°è®°å½•ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªåè¿›åˆ¶çš„æ•°å­— BITFIELD sign:5:202203 GET u14 0</span></span><br><span class="line">    List&lt;Long&gt; result = stringRedisTemplate.opsForValue().bitField(</span><br><span class="line">            key,</span><br><span class="line">            BitFieldSubCommands.create()</span><br><span class="line">                    .get(BitFieldSubCommands.BitFieldType.unsigned(dayOfMonth)).valueAt(<span class="number">0</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">null</span> || result.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// æ²¡æœ‰ä»»ä½•ç­¾åˆ°ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">num</span> <span class="operator">=</span> result.get(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (num == <span class="literal">null</span> || num == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 6.å¾ªç¯éå†</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// 6.1.è®©è¿™ä¸ªæ•°å­—ä¸1åšä¸è¿ç®—ï¼Œå¾—åˆ°æ•°å­—çš„æœ€åä¸€ä¸ªbitä½  // åˆ¤æ–­è¿™ä¸ªbitä½æ˜¯å¦ä¸º0</span></span><br><span class="line">        <span class="keyword">if</span> ((num &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸º0ï¼Œè¯´æ˜æœªç­¾åˆ°ï¼Œç»“æŸ</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸ä¸º0ï¼Œè¯´æ˜å·²ç­¾åˆ°ï¼Œè®¡æ•°å™¨+1</span></span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æŠŠæ•°å­—å³ç§»ä¸€ä½ï¼ŒæŠ›å¼ƒæœ€åä¸€ä¸ªbitä½ï¼Œç»§ç»­ä¸‹ä¸€ä¸ªbitä½</span></span><br><span class="line">        num &gt;&gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="e-wai-jia-can-guan-yu-shi-yong-bitmap-lai-jie-jue-huan-cun-chuan-tou-de-fang-an" id="é¢å¤–åŠ é¤-å…³äºä½¿ç”¨bitmapæ¥è§£å†³ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆ">é¢å¤–åŠ é¤-å…³äºä½¿ç”¨bitmapæ¥è§£å†³ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆ</h2><p>å›é¡¾<strong>ç¼“å­˜ç©¿é€</strong>ï¼š</p><ul><li>å‘èµ·äº†ä¸€ä¸ªæ•°æ®åº“ä¸å­˜åœ¨çš„ï¼Œredisé‡Œè¾¹ä¹Ÿä¸å­˜åœ¨çš„æ•°æ®ï¼Œé€šå¸¸ä½ å¯ä»¥æŠŠä»–çœ‹æˆä¸€ä¸ªæ”»å‡»</li></ul><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p>åˆ¤æ–­id&lt;0</p></li><li><p>å¦‚æœæ•°æ®åº“æ˜¯ç©ºï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥å¾€redisé‡Œè¾¹æŠŠè¿™ä¸ªç©ºæ•°æ®ç¼“å­˜èµ·æ¥</p></li></ul><p>ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šé‡åˆ°çš„é—®é¢˜æ˜¯å¦‚æœç”¨æˆ·è®¿é—®çš„æ˜¯idä¸å­˜åœ¨çš„æ•°æ®ï¼Œåˆ™æ­¤æ—¶å°±æ— æ³•ç”Ÿæ•ˆ</p><p>ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆï¼šé‡åˆ°çš„é—®é¢˜æ˜¯ï¼šå¦‚æœæ˜¯ä¸åŒçš„idé‚£å°±å¯ä»¥é˜²æ­¢ä¸‹æ¬¡è¿‡æ¥ç›´å‡»æ•°æ®</p><p>æ‰€ä»¥æˆ‘ä»¬å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p><ul><li>æˆ‘ä»¬å¯ä»¥å°†æ•°æ®åº“çš„æ•°æ®ï¼Œæ‰€å¯¹åº”çš„<code>id</code>å†™å…¥åˆ°ä¸€ä¸ª<code>listé›†åˆ</code>ä¸­ï¼Œ</li><li>å½“ç”¨æˆ·è¿‡æ¥è®¿é—®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç›´æ¥å»åˆ¤æ–­listä¸­<code>æ˜¯å¦åŒ…å«</code>å½“å‰çš„è¦æŸ¥è¯¢çš„æ•°æ®ï¼Œ<ul><li>å¦‚æœè¯´ç”¨æˆ·è¦æŸ¥è¯¢çš„idæ•°æ®å¹¶<code>ä¸åœ¨</code>listé›†åˆä¸­ï¼Œåˆ™<code>ç›´æ¥è¿”å›</code>ï¼Œ</li><li>å¦‚æœlistä¸­<code>åŒ…å«</code>å¯¹åº”æŸ¥è¯¢çš„idæ•°æ®ï¼Œåˆ™è¯´æ˜ä¸æ˜¯ä¸€æ¬¡ç¼“å­˜ç©¿é€æ•°æ®ï¼Œåˆ™<code>ç›´æ¥æ”¾è¡Œ</code>ã€‚</li></ul></li></ul><p><img src="https://s1.vika.cn/space/2023/04/04/1fcb1ae1707c4e3ba1ee7bb37511ecea" alt="1653836416586"></p><p>ç°åœ¨çš„é—®é¢˜æ˜¯è¿™ä¸ªä¸»é”®å…¶å®å¹¶æ²¡æœ‰é‚£ä¹ˆçŸ­ï¼Œè€Œæ˜¯å¾ˆé•¿çš„ä¸€ä¸ª ä¸»é”®</p><ul><li><p>å“ªæ€•ä½ å•ç‹¬å»æå–è¿™ä¸ªä¸»é”®ï¼Œä½†æ˜¯åœ¨11å¹´å·¦å³ï¼Œæ·˜å®çš„å•†å“æ€»é‡å°±å·²ç»è¶…è¿‡10äº¿ä¸ª</p></li><li><p>æ‰€ä»¥å¦‚æœé‡‡ç”¨ä»¥ä¸Šæ–¹æ¡ˆï¼Œè¿™ä¸ªlistä¹Ÿä¼šå¾ˆå¤§ï¼Œ</p></li><li><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨bitmapæ¥å‡å°‘listçš„å­˜å‚¨ç©ºé—´</p></li></ul><p>æˆ‘ä»¬å¯ä»¥æŠŠlistæ•°æ®æŠ½è±¡æˆä¸€ä¸ªéå¸¸å¤§çš„bitmapï¼Œ</p><ul><li><p>æˆ‘ä»¬ä¸å†ä½¿ç”¨listï¼Œè€Œæ˜¯å°†dbä¸­çš„idæ•°æ®åˆ©ç”¨å“ˆå¸Œæ€æƒ³ï¼Œæ¯”å¦‚ï¼š</p></li><li><p><code>id % bitmap.size  =</code> ç®—å‡ºå½“å‰è¿™ä¸ªidå¯¹åº”åº”è¯¥è½åœ¨<code>bitmap</code>çš„å“ªä¸ªç´¢å¼•ä¸Šï¼Œç„¶åå°†è¿™ä¸ªå€¼ä»<code>0</code>å˜æˆ<code>1</code>ï¼Œ</p></li><li><p>ç„¶åå½“ç”¨æˆ·æ¥æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ­¤æ—¶å·²ç»æ²¡æœ‰äº†listï¼Œè®©ç”¨æˆ·ç”¨ä»–æŸ¥è¯¢çš„<code>id</code>å»ç”¨ç›¸åŒçš„<code>å“ˆå¸Œç®—æ³•</code>ï¼Œ ç®—å‡ºæ¥å½“å‰è¿™ä¸ªidåº”å½“è½åœ¨bitmapçš„<code>å“ªä¸€ä½</code>ï¼Œ</p></li><li><p>ç„¶ååˆ¤æ–­è¿™ä¸€ä½æ˜¯<code>0</code>ï¼Œè¿˜æ˜¯<code>1</code>ï¼Œ</p><ul><li>å¦‚æœæ˜¯<code>0</code>åˆ™è¡¨æ˜è¿™ä¸€ä½ä¸Šçš„æ•°æ®ä¸€å®š<code>ä¸å­˜åœ¨</code>ï¼Œ</li><li>é‡‡ç”¨è¿™ç§æ–¹å¼æ¥å¤„ç†ï¼Œéœ€è¦é‡ç‚¹è€ƒè™‘ä¸€ä¸ªäº‹æƒ…ï¼Œå°±æ˜¯<code>è¯¯å·®ç‡</code>ï¼Œ<ul><li>æ‰€è°“çš„è¯¯å·®ç‡å°±æ˜¯æŒ‡å½“å‘ç”Ÿ<code>å“ˆå¸Œå†²çª</code>çš„æ—¶å€™ï¼Œäº§ç”Ÿçš„è¯¯å·®ã€‚</li></ul></li></ul></li></ul><p><img src="https://s1.vika.cn/space/2023/04/04/1693d6e2f4c44d5db019ca0749265694" alt="1653836578970"></p><h1 id="uv-tong-ji">UVç»Ÿè®¡</h1><h2 id="uv-tong-ji-hyper-log-log" id="UVç»Ÿè®¡-HyperLogLog">UVç»Ÿè®¡-HyperLogLog</h2><p>é¦–å…ˆæˆ‘ä»¬ææ‡‚ä¸¤ä¸ªæ¦‚å¿µï¼š</p><ul><li><p><strong>UV</strong>ï¼šå…¨ç§°<code>Unique Visito</code>rï¼Œä¹Ÿå«<code>ç‹¬ç«‹è®¿å®¢é‡</code>ï¼Œ</p><ul><li>æ˜¯æŒ‡é€šè¿‡äº’è”ç½‘è®¿é—®ã€æµè§ˆè¿™ä¸ªç½‘é¡µçš„è‡ªç„¶äººã€‚</li><li>1å¤©å†…åŒä¸€ä¸ªç”¨æˆ·å¤šæ¬¡è®¿é—®è¯¥ç½‘ç«™ï¼Œåªè®°å½•1æ¬¡ã€‚</li></ul></li><li><p><strong>PV</strong>ï¼šå…¨ç§°<code>Page View</code>ï¼Œä¹Ÿå«<code>é¡µé¢è®¿é—®é‡</code>æˆ–<code>ç‚¹å‡»é‡</code>ï¼Œ</p><ul><li>ç”¨æˆ·æ¯è®¿é—®ç½‘ç«™çš„ä¸€ä¸ªé¡µé¢ï¼Œè®°å½•1æ¬¡PVï¼Œç”¨æˆ·å¤šæ¬¡æ‰“å¼€é¡µé¢ï¼Œåˆ™è®°å½•å¤šæ¬¡PVã€‚</li><li>å¾€å¾€ç”¨æ¥è¡¡é‡ç½‘ç«™çš„æµé‡ã€‚</li></ul></li></ul><p>é€šå¸¸æ¥è¯´PVä¼šæ¯”UVå¤§å¾ˆå¤šï¼Œ</p><ul><li>æ‰€ä»¥è¡¡é‡åŒä¸€ä¸ªç½‘ç«™çš„è®¿é—®é‡ï¼Œæˆ‘ä»¬éœ€è¦ç»¼åˆè€ƒè™‘å¾ˆå¤šå› ç´ ï¼Œ</li><li>æ‰€ä»¥æˆ‘ä»¬åªæ˜¯å•çº¯çš„æŠŠè¿™ä¸¤ä¸ªå€¼ä½œä¸ºä¸€ä¸ªå‚è€ƒå€¼</li></ul><p>UVç»Ÿè®¡åœ¨æœåŠ¡ç«¯åšä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œ</p><ul><li>å› ä¸ºè¦åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦å·²ç»ç»Ÿè®¡è¿‡äº†ï¼Œéœ€è¦å°†ç»Ÿè®¡è¿‡çš„ç”¨æˆ·ä¿¡æ¯ä¿å­˜ã€‚</li><li>ä½†æ˜¯å¦‚æœæ¯ä¸ªè®¿é—®çš„ç”¨æˆ·éƒ½ä¿å­˜åˆ°Redisä¸­ï¼Œæ•°æ®é‡ä¼šéå¸¸ææ€–ï¼Œé‚£æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</li></ul><p>**Hyperloglog(HLL)**æ˜¯ä»Loglogç®—æ³•æ´¾ç”Ÿçš„æ¦‚ç‡ç®—æ³•ï¼Œ</p><ul><li>ç”¨äºç¡®å®šéå¸¸å¤§çš„é›†åˆçš„åŸºæ•°ï¼Œè€Œä¸éœ€è¦å­˜å‚¨å…¶æ‰€æœ‰å€¼ã€‚</li><li>ç›¸å…³ç®—æ³•åŸç†å¤§å®¶å¯ä»¥å‚è€ƒï¼š<a href="https://juejin.cn/post/6844903785744056333#heading-0">https://juejin.cn/post/6844903785744056333#heading-0</a></li></ul><p><strong>Redis</strong>ä¸­çš„HLLæ˜¯åŸºäº<code>string</code>ç»“æ„å®ç°çš„ï¼Œ</p><ul><li>å•ä¸ªHLLçš„å†…å­˜<strong>æ°¸è¿œå°äº16kb</strong>ï¼Œ<strong>å†…å­˜å ç”¨ä½</strong>çš„ä»¤äººå‘æŒ‡ï¼ä½œä¸ºä»£ä»·ï¼Œ</li><li>å…¶æµ‹é‡ç»“æœæ˜¯æ¦‚ç‡æ€§çš„ï¼Œ<strong>æœ‰å°äº0.81ï¼…çš„è¯¯å·®</strong>ã€‚ä¸è¿‡å¯¹äºUVç»Ÿè®¡æ¥è¯´ï¼Œè¿™å®Œå…¨å¯ä»¥å¿½ç•¥ã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/04/04/ed5a3e2fdad246c0a1f09e226e700b18" alt="1653837988985"></p><h2 id="uv-tong-ji-ce-shi-bai-mo-shu-ju-de-tong-ji" id="UVç»Ÿè®¡-æµ‹è¯•ç™¾ä¸‡æ•°æ®çš„ç»Ÿè®¡">UVç»Ÿè®¡-æµ‹è¯•ç™¾ä¸‡æ•°æ®çš„ç»Ÿè®¡</h2><blockquote><p>æµ‹è¯•æ€è·¯ï¼šæˆ‘ä»¬ç›´æ¥åˆ©ç”¨å•å…ƒæµ‹è¯•ï¼Œå‘HyperLogLogä¸­æ·»åŠ 100ä¸‡æ¡æ•°æ®ï¼Œçœ‹çœ‹å†…å­˜å ç”¨å’Œç»Ÿè®¡æ•ˆæœå¦‚ä½•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testHyperLogLog</span><span class="params">()</span> &#123;</span><br><span class="line">    String[] values = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">1000</span>];</span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">        j = i % <span class="number">1000</span>;</span><br><span class="line">        values[j] = <span class="string">&quot;user_&quot;</span> + i;</span><br><span class="line">        <span class="keyword">if</span>(j == <span class="number">999</span>) &#123;</span><br><span class="line">            <span class="comment">// å‘é€åˆ°Redis</span></span><br><span class="line">            stringRedisTemplate.opsForHyperLogLog().add(<span class="string">&quot;hl2&quot;</span>, values);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç»Ÿè®¡æ•°é‡</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">hl2</span> <span class="operator">=</span> stringRedisTemplate.opsForHyperLogLog().size(<span class="string">&quot;hl2&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;hl2 == &quot;</span> + hl2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡æµ‹è¯•ï¼šæˆ‘ä»¬ä¼šå‘ç”Ÿä»–çš„è¯¯å·®æ˜¯åœ¨å…è®¸èŒƒå›´å†…ï¼Œå¹¶ä¸”å†…å­˜å ç”¨æå°</p><p>3452168</p><p>3468792</p><hr><p>= 16.23kb</p>]]></content>
    
    
    <summary type="html">é»‘é©¬ç‚¹è¯„é¡¹ç›®å®æˆ˜ï¼šæ¶ˆæ¯é˜Ÿåˆ—ã€åŠŸèƒ½å®ç°</summary>
    
    
    
    <category term="Java" scheme="https://www.taoyaopc.live/categories/Java/"/>
    
    
    <category term="Java" scheme="https://www.taoyaopc.live/tags/Java/"/>
    
    <category term="Redis" scheme="https://www.taoyaopc.live/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼</title>
    <link href="https://www.taoyaopc.live/posts/364ea8cc.html"/>
    <id>https://www.taoyaopc.live/posts/364ea8cc.html</id>
    <published>2023-03-28T10:30:00.000Z</published>
    <updated>2023-04-11T02:25:36.266Z</updated>
    
    <content type="html"><![CDATA[<h1 id="jian-dan-gong-han-mo-shi">ç®€å•å·¥å‚æ¨¡å¼</h1><p><strong>ç®€å•å·¥å‚æ¨¡å¼</strong>ï¼šæ˜¯æŒ‡ç”±ä¸€ä¸ªå·¥å‚å¯¹è±¡å†³å®šåˆ›å»ºå“ªä¸€ç§äº§å“ç±»çš„å®ä¾‹ï¼Œ</p><ul><li>ä½†å®ƒä¸å±äº23ç§å¸¸ç”¨è®¾è®¡æ¨¡å¼ï¼Œ</li><li>ç®€å•å·¥å‚æ¨¡å¼é€‚ç”¨äºå·¥å‚ç±»è´Ÿè´£åˆ›å»ºçš„å¯¹è±¡è¾ƒå°‘çš„åœºæ™¯ï¼Œ</li><li>ä¸”å®¢æˆ·ç«¯åªéœ€è¦ä¼ å…¥å·¥å‚ç±»çš„å‚æ•°ï¼Œå¯¹äºå¦‚ä½•åˆ›å»ºå¯¹è±¡ä¸éœ€è¦å…³å¿ƒã€‚</li></ul><h2 id="dai-ma-shi-li" id="ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹</h2><p><strong>èƒŒæ™¯</strong>ï¼šç°åœ¨æœ‰ä¸ªå­¦æ ¡ï¼Œå¼€è®¾æœ‰Javaæ¶æ„ã€å¤§æ•°æ®ã€äººå·¥æ™ºèƒ½ç­‰è¯¾ç¨‹ï¼Œå·²ç»å½¢æˆäº†ä¸€ä¸ªç”Ÿæ€ã€‚</p><ul><li>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè¯¾ç¨‹æ ‡å‡†ICourseæ¥å£ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICourse</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½•åˆ¶è§†é¢‘</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å†åˆ›å»ºä¸€ä¸ªJavaè¯¾ç¨‹çš„å®ç°JavaCourseç±»:</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaCourse</span> <span class="keyword">implements</span> <span class="title class_">ICourse</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å½•åˆ¶Javaè¯¾ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬è¿™æ ·å‡è®¾å®¢æˆ·ç«¯è°ƒç”¨ä»£ç ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ICourse</span> <span class="variable">course</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JavaCourse</span>();</span><br><span class="line">        course.record();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ</p><ul><li>çˆ¶ç±»ICourseæŒ‡å‘å­ç±»JavaCourseçš„å¼•ç”¨ï¼Œ</li><li>åº”ç”¨å±‚ä»£ç éœ€è¦ä¾èµ–JavaCourseï¼Œ</li><li>å¦‚æœä¸šåŠ¡æ‰©å±•ï¼Œç»§ç»­å¢åŠ PythonCourseç”šè‡³æ›´å¤šè¯¾ç¨‹ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯çš„ä¾èµ–ä¼šå˜å¾—è¶Šæ¥è¶Šè‡ƒè‚¿ã€‚</li><li>å› æ­¤ï¼Œæˆ‘ä»¬<code>è¦æƒ³åŠæ³•æŠŠè¿™ç§ä¾èµ–å‡å¼±ï¼ŒæŠŠåˆ›å»ºç»†èŠ‚éšè—èµ·æ¥</code>ã€‚<ul><li>è™½ç„¶åœ¨ç›®å‰çš„ä»£ç ä¸­ï¼Œåˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹å¹¶ä¸å¤æ‚ï¼Œä½†ä»ä»£ç è®¾è®¡çš„äº¤ä»˜æ¥è®²ï¼Œä¸æ˜“äºæ‰©å±•ã€‚</li></ul></li></ul><h2 id="cai-yong-jian-dan-gong-han-mo-shi-gai-zao" id="é‡‡ç”¨ç®€å•å·¥å‚æ¨¡å¼æ”¹é€ ">é‡‡ç”¨ç®€å•å·¥å‚æ¨¡å¼æ”¹é€ </h2><blockquote><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç”¨ç®€å•å·¥å‚æ¨¡å¼å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼š</p></blockquote><ul><li>å­¦æ ¡å¢åŠ äº†pythonè¯¾ç¨‹ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PythonCourse</span> <span class="keyword">implements</span> <span class="title class_">ICourse</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å½•åˆ¶Pythonè¯¾ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºå·¥å‚ç±»ï¼šCourseFactoryï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CourseFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ICourse <span class="title function_">creat</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;java&quot;</span>.equals(name))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JavaCourse</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;python&quot;</span>.equals(name))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PythonCourse</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹å®¢æˆ·ç«¯è°ƒç”¨ä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CourseFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CourseFactory</span>();</span><br><span class="line">        factory.creat(<span class="string">&quot;java&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è°ƒç”¨æ–¹ä¾¿æˆ‘ä»¬å¯ä»¥å°†å·¥å‚çš„æ–¹æ³•è½¬ä¸ºé™æ€æ–¹æ³•ï¼Œ</p><ul><li>å®¢æˆ·ç«¯è°ƒç”¨å˜ç®€å•äº†ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„ä¸šåŠ¡ç»§ç»­æ‹“å±•ï¼Œè¦å¢åŠ å‰ç«¯è¯¾ç¨‹ï¼Œ</li><li>é‚£ä¹ˆå·¥å‚ä¸­çš„create()æ–¹æ³•å°±è¦æ¯æ¬¡éƒ½æ ¹æ®äº§å“ä¿®æ”¹ä»£ç é€»è¾‘ï¼Œä¸ç¬¦åˆ<a href="https://so.csdn.net/so/search?q=%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99&amp;spm=1001.2101.3001.7020">å¼€é—­åŸåˆ™</a>ã€‚</li><li>å› æ­¤ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹ç®€å•å·¥å‚æ¨¡å¼ç»§ç»­ä¼˜åŒ–ï¼Œè¿™æ¬¡æˆ‘ä»¬é‡‡ç”¨åå°„ä¼˜åŒ–ï¼š</li></ul><h2 id="you-hua-gong-han-fang-fa-fan-she" id="ä¼˜åŒ–å·¥å‚æ–¹æ³•ï¼ˆåå°„ã€Â·Â·Â·ï¼‰">ä¼˜åŒ–å·¥å‚æ–¹æ³•ï¼ˆåå°„ã€Â·Â·Â·ï¼‰</h2><div class="tabs" id="newinstance"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#newinstance-1">CourseFactory</button></li><li class="tab"><button type="button" data-href="#newinstance-2">å®¢æˆ·ç«¯è°ƒç”¨ä»£ç </button></li><li class="tab"><button type="button" data-href="#newinstance-3">å·¥å‚æ–¹æ³•å†ä¼˜åŒ–</button></li><li class="tab"><button type="button" data-href="#newinstance-4">å®¢æˆ·ç«¯è°ƒç”¨</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="newinstance-1"><p>ä¼˜åŒ–ä¹‹åï¼Œäº§å“ä¸æ–­ä¸°å¯Œçš„è¿‡ç¨‹ä¸­ä¸éœ€è¦ä¿®æ”¹CourseFactoryä¸­çš„ä»£ç ã€‚</p><ul><li><code>(ICourse) Class.forName(className).newInstance()</code> è·å–å½“å‰å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CourseFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ICourse <span class="title function_">creat</span><span class="params">(String className)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(!(<span class="literal">null</span>==className||<span class="string">&quot;&quot;</span>.equals(className)))&#123;</span><br><span class="line">                <span class="keyword">return</span> (ICourse) Class.forName(className).newInstance();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="newinstance-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CourseFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CourseFactory</span>();</span><br><span class="line">        <span class="type">ICourse</span> <span class="variable">course</span> <span class="operator">=</span> factory.creat(<span class="string">&quot;com.è®¾è®¡æ¨¡å¼.ç®€å•å·¥å‚.JavaCourse&quot;</span>);</span><br><span class="line">        course.record();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="newinstance-3"><p>ä½†æ˜¯è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œæ–¹æ³•å‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œå¯æ§æ€§æœ‰å¾…æç¤ºï¼Œè€Œä¸”è¿˜éœ€è¦å¼ºåˆ¶è½¬å‹ï¼Œå†ä¿®æ”¹ä¸€ä¸‹å·¥å‚ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CourseFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ICourse <span class="title function_">creat</span><span class="params">(Class &lt;? extends ICourse&gt; clazz)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> != clazz)&#123;</span><br><span class="line">                <span class="keyword">return</span> clazz.newInstance();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çœ‹èµ·æ¥å°±æ¯”è¾ƒæ¥è¿‘Springä¸­çš„ä½¿ç”¨äº†ï¼š</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="newinstance-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CourseFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CourseFactory</span>();</span><br><span class="line">        <span class="type">ICourse</span> <span class="variable">course</span> <span class="operator">=</span> factory.creat(JavaCourse.class);</span><br><span class="line">        course.record();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="que-dian" id="ç¼ºç‚¹">ç¼ºç‚¹</h2><p>ç®€å•å·¥å‚æ¨¡å¼ä¹Ÿæœ‰ä»–çš„ç¼ºç‚¹ï¼š<code>å·¥å‚ç±»çš„èŒè´£ç›¸å¯¹è¿‡é‡ï¼Œä¸æ˜“äºæ‰©å±•è¿‡äºå¤æ‚çš„äº§å“ç»“æ„ã€‚</code></p><h1 id="gong-han-fang-fa-mo-shi-factory-method">å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰</h1><p><strong>å·¥å‚æ–¹æ³•æ¨¡å¼</strong>ï¼šæŒ‡å®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†è®©å®ç°è¿™ä¸ªæ¥å£çš„ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ï¼Œ</p><ul><li>å·¥å‚æ–¹æ³•æ¨¡å¼è®©ç±»çš„å®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»ä¸­è¿›è¡Œã€‚</li><li>åœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­ç”¨æˆ·åªéœ€è¦å…³å¿ƒæ‰€éœ€äº§å“å¯¹åº”çš„å·¥å‚ï¼Œæ— éœ€å…³å¿ƒåˆ›å»ºç»†èŠ‚ï¼Œ</li><li>è€Œä¸”åŠ å…¥æ–°äº§å“æ—¶ç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li><li>å·¥å‚æ–¹æ³•æ¨¡å¼ä¸»è¦è§£å†³äº§å“æ‰©å±•çš„é—®é¢˜ã€‚</li></ul><h2 id="shu-ben-xiang-guan-miao-shu" id="ä¹¦æœ¬ç›¸å…³æè¿°">ä¹¦æœ¬ç›¸å…³æè¿°</h2><ol><li><p>æ¨¡å¼åï¼šå·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œåˆç§°ä¸ºè™šæ„é€ å™¨æ¨¡å¼</p></li><li><p>æ„å›¾ï¼š</p><ul><li>å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚</li><li>å·¥å‚æ–¹æ³•ä½¿ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å…¶å­ç±»</li></ul></li><li><p>é€‚ç”¨æ€§ï¼š</p><ol><li>å½“ä¸€ä¸ªç±»ä¸çŸ¥é“å®ƒæ‰€å¿…é¡»åˆ›å»ºçš„å¯¹è±¡çš„ç±»çš„æ—¶å€™ï¼›</li><li>å½“ä¸€ä¸ªç±»å¸Œæœ›ç”±å®ƒçš„å­ç±»æ¥æŒ‡å®šå®ƒæ‰€åˆ›å»ºçš„å¯¹è±¡çš„æ—¶å€™ï¼›</li><li>å½“ç±»å°†åˆ›å»ºå¯¹è±¡çš„èŒè´£å§”æ‰˜ç»™å¤šä¸ªå¸®åŠ©å­ç±»ä¸­çš„æŸä¸€ä¸ªï¼Œå¹¶ä¸”ä½ å¸Œæœ›å°†å“ªä¸€ä¸ªå¸®åŠ©å­ç±»æ˜¯ä»£ç†è€…è¿™ä¸€ä¿¡æ¯å±€éƒ¨åŒ–çš„æ—¶å€™</li></ol></li><li><p>ç»“æ„å›¾ï¼ˆUMLï¼‰ï¼š</p></li><li><p>æ•ˆæœï¼š</p><ol><li>ç”¨å·¥å‚æ–¹æ³•åœ¨ä¸€ä¸ªç±»çš„å†…éƒ¨åˆ›å»ºå¯¹è±¡é€šå¸¸æ¯”ç›´æ¥åˆ›å»ºå¯¹è±¡æ›´çµæ´»ã€‚<ul><li>å·¥å‚æ–¹æ³•æ¨¡å¼ä¹Ÿä¸å†ä¸ç‰¹å®šåº”ç”¨æœ‰å…³çš„ç±»ç»‘å®šåˆ°ä»£ç ä¸­ï¼›</li><li>ä»£ç ä»…å¤„ç† <code>Product</code> æ¥å£ï¼›</li><li>å› æ­¤å®ƒå¯ä»¥ä¸ç”¨æˆ·å®šä¹‰çš„ä»»ä½•ConcreteProductç±»ä¸€èµ·ä½¿ç”¨</li></ul></li><li>å®ƒå¯ä»¥è¿æ¥å¹³è¡Œçš„ç±»å±‚æ¬¡ã€‚</li><li>æ½œåœ¨ç¼ºç‚¹ï¼šæ¯åˆ›å»ºä¸€ä¸ªç‰¹å®šçš„å¯¹è±¡ï¼ˆPhoneï¼‰ï¼Œå°±ä¸å¾—ä¸åˆ›å»ºç›¸åº”çš„å·¥å‚ç±»ï¼ˆPhoneFactoryï¼‰.<ul><li>å·¥å‚ç±»ä¼šéå¸¸å¤š</li></ul></li></ol></li><li><p>ç¤ºä¾‹ï¼šè§ä¸‹</p></li></ol><p>åœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­ï¼Œéšç€äº§å“é“¾çš„ä¸°å¯Œï¼Œ</p><ul><li>å¦‚æœæ¯ä¸ªè¯¾ç¨‹çš„åˆ›å»ºé€»è¾‘éƒ½æœ‰åŒºåˆ«ï¼Œåˆ™å·¥å‚çš„èŒè´£ä¼šå˜å¾—è¶Šæ¥è¶Šå¤šï¼Œæœ‰ç‚¹åƒä¸‡èƒ½å·¥å‚ï¼Œä¸ä¾¿äºç»´æŠ¤ã€‚</li><li>æ ¹æ®å•ä¸€èŒè´£åŸåˆ™æˆ‘ä»¬å°†èŒèƒ½ç»§ç»­æ‹†åˆ†ï¼Œä¸“äººå¹²ä¸“äº‹ã€‚<ul><li>Javaè¯¾ç¨‹ç”±Javaå·¥å‚åˆ›å»ºï¼Œ</li><li>Pythonè¯¾ç¨‹ç”±Pythonå·¥å‚åˆ›å»ºï¼Œ</li><li>å¯¹å·¥å‚æœ¬èº«ä¹Ÿåšä¸€ä¸ªæŠ½è±¡ã€‚</li></ul></li></ul><h2 id="dai-ma-shi-li-1" id="ä»£ç ç¤ºä¾‹-2">ä»£ç ç¤ºä¾‹</h2><ol><li>å…ˆåˆ›å»ºICourseFactoryæ¥å£ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICourseFactory</span> &#123;</span><br><span class="line">    ICourse <span class="title function_">creat</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å†åˆ†åˆ«åˆ›å»ºå­å·¥å‚ï¼ŒJavaCourseFactoryç±»å’ŒPythonCourseFactoryç±»ï¼š</li></ol><div class="tabs" id="class"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#class-1">JavaCourFactory</button></li><li class="tab"><button type="button" data-href="#class-2">PythonCourseFactory</button></li><li class="tab"><button type="button" data-href="#class-3">Courseå®ä½“ç±»</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="class-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaCourseFactory</span> <span class="keyword">implements</span> <span class="title class_">ICourseFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ICourse <span class="title function_">creat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JavaCourse</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="class-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PythonCourseFactory</span> <span class="keyword">implements</span> <span class="title class_">ICourseFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ICourse <span class="title function_">creat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PythonCourse</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="class-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICourse</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½•åˆ¶è§†é¢‘</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaCourse</span> <span class="keyword">implements</span> <span class="title class_">ICourse</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å½•åˆ¶Javaè¯¾ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PythonCourse</span> <span class="keyword">implements</span> <span class="title class_">ICourse</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å½•åˆ¶Pythonè¯¾ç¨‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><ol start="3"><li>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ICourseFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PythonCourseFactory</span>();</span><br><span class="line">        <span class="type">ICourse</span> <span class="variable">course</span> <span class="operator">=</span> factory.creat();</span><br><span class="line">        course.record();</span><br><span class="line"></span><br><span class="line">        factory = <span class="keyword">new</span> <span class="title class_">JavaCourseFactory</span>();</span><br><span class="line">        course = factory.creat();</span><br><span class="line">        course.record();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="zong-jie" id="æ€»ç»“">æ€»ç»“</h2><ul><li>å·¥å‚æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š<br>ï¼ˆ1ï¼‰åˆ›å»ºå¯¹è±¡éœ€è¦å¤§é‡é‡å¤çš„ä»£ç ã€‚<br>ï¼ˆ2ï¼‰å®¢æˆ·ç«¯ï¼ˆåº”ç”¨å±‚ï¼‰ä¸ä¾èµ–äº§å“ç±»å®ä¾‹å¦‚ä½•è¢«åˆ›å»ºã€å¦‚ä½•è¢«å®ç°ç­‰ç»†èŠ‚ã€‚<br>ï¼ˆ3ï¼‰ä¸€ä¸ªç±»é€šè¿‡å…¶å­ç±»æ¥æŒ‡å®šåˆ›å»ºå“ªä¸ªå¯¹è±¡ã€‚</li><li>å·¥å‚æ–¹æ³•æ¨¡å¼ä¹Ÿæœ‰ç¼ºç‚¹ï¼š<br>ï¼ˆ1ï¼‰ç±»çš„ä¸ªæ•°å®¹æ˜“è¿‡å¤šï¼Œå¢åŠ å¤æ‚åº¦ã€‚<br>ï¼ˆ2ï¼‰å¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦</li></ul><h1 id="chou-xiang-gong-han-mo-shi">æŠ½è±¡å·¥å‚æ¨¡å¼</h1><p><strong>æŠ½è±¡å·¥å‚æ¨¡å¼</strong>ï¼šæ˜¯æŒ‡æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œæ— éœ€æŒ‡å®šä»–ä»¬çš„å…·ä½“ç±»ã€‚</p><ul><li>å®¢æˆ·ç«¯ï¼ˆåº”ç”¨å±‚ï¼‰ä¸ä¾èµ–äºäº§å“å®ä½“ç±»å¦‚ä½•è¢«åˆ›å»ºã€å¦‚ä½•è¢«å®ç°ç­‰ç»†èŠ‚ï¼Œ</li><li>å¼ºè°ƒçš„æ˜¯ä¸€ç³»åˆ—ç›¸å…³çš„äº§å“å¯¹è±¡ï¼ˆå±äºåŒä¸€äº§å“æ—ï¼‰ä¸€èµ·ä½¿ç”¨åˆ›å»ºå¯¹è±¡éœ€è¦å¤§é‡é‡å¤çš„ä»£ç ã€‚</li><li>éœ€è¦æä¾›ä¸€ä¸ªäº§å“ç±»çš„åº“ï¼Œæ‰€æœ‰çš„äº§å“ä»¥åŒæ ·çš„æ¥å£å‡ºç°ï¼Œä»è€Œä½¿å®¢æˆ·ç«¯ä¸ä¾èµ–äºå…·ä½“å®ç°ã€‚</li></ul><h2 id="dai-ma-shi-li-2" id="ä»£ç ç¤ºä¾‹-3">ä»£ç ç¤ºä¾‹</h2><p>å­¦æ ¡æœ‰äº†ç¬¬ä¸‰æœŸä¼˜åŒ–ï¼š</p><ul><li>æ¯ä¸ªè¯¾ç¨‹ä¸ä»…è¦æä¾›è¯¾ç¨‹çš„å½•æ’­è§†é¢‘ï¼Œè¿˜è¦æä¾›è¯¾å ‚ç¬”è®°ï¼Œ</li><li>ç”šè‡³è¿˜è¦æœ‰æºç æ‰èƒ½æ„æˆä¸€ä¸ªå®Œæ•´çš„è¯¾ç¨‹ã€‚</li></ul><ol><li>åœ¨äº§å“ç­‰çº§ä¸­æ–°å¢ä¸¤ä¸ªäº§å“ï¼šIVideoå½•æ’­è§†é¢‘å’ŒINodeè¯¾å ‚ç¬”è®°æ¥å£ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IVideo</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">record</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">INote</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>ç„¶ååˆ›å»ºä¸€ä¸ªæŠ½è±¡å·¥å‚ç±»CourseFactoryï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠ½è±¡å·¥å‚æ˜¯ç”¨æˆ·çš„ä¸»å…¥å£</span></span><br><span class="line"><span class="comment"> * æ˜¯Springä¸­åº”ç”¨æœ€å¹¿æ³›çš„ä¸€ç§è®¾è®¡æ¨¡å¼</span></span><br><span class="line"><span class="comment"> * æ˜“äºæ‰©å±•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CourseFactory</span> &#123;</span><br><span class="line">    INote <span class="title function_">createNote</span><span class="params">()</span>;</span><br><span class="line">    IVideo <span class="title function_">createViedo</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºJavaäº§å“æ—</li></ol><div class="tabs" id="javaclass"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#javaclass-1">JavaVideo</button></li><li class="tab"><button type="button" data-href="#javaclass-2">JavaNote</button></li><li class="tab"><button type="button" data-href="#javaclass-3">JavaCourseFactory</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="javaclass-1"><p>æ‰©å±•Javaè§†é¢‘ç±»JavaVideo</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaVideo</span> <span class="keyword">implements</span> <span class="title class_">IVideo</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å½•åˆ¶Javaè§†é¢‘&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="javaclass-2"><p>æ‰©å±•äº§å“ç­‰çº§Javaè¯¾å ‚ç¬”è®°ç±»JavaNoteï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaNote</span> <span class="keyword">implements</span> <span class="title class_">INote</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¼–å†™Javaç¬”è®°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="javaclass-3"><p>åˆ›å»ºJavaäº§å“æ—çš„å·¥å‚JavaCourseFactoryï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaCourseFactory</span> <span class="keyword">implements</span> <span class="title class_">CourseFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> INote <span class="title function_">createNote</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JavaNote</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IVideo <span class="title function_">createViedo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JavaVideo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><ol start="4"><li>ç„¶ååˆ›å»ºPythonäº§å“ï¼š</li></ol><div class="tabs" id="javaclass"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#javaclass-1">PythonVideo</button></li><li class="tab"><button type="button" data-href="#javaclass-2">PythonNote</button></li><li class="tab"><button type="button" data-href="#javaclass-3">PythonCourseFactory</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="javaclass-1"><p>æ‰©å±•Pythonè§†é¢‘ç±»PythonVideo</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PythonVideo</span> <span class="keyword">implements</span> <span class="title class_">IVideo</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å½•åˆ¶pythonè§†é¢‘&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="javaclass-2"><p>æ‰©å±•äº§å“ç­‰çº§Pythonè¯¾å ‚ç¬”è®°ç±»PythonNoteï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PythonNote</span> <span class="keyword">implements</span> <span class="title class_">INote</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¼–å†™pythonç¬”è®°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="javaclass-3"><p>ç„¶ååˆ›å»ºPythonäº§å“æ—çš„å…·ä½“å·¥å‚PythonCourseFactoryï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PythonCourseFaactory</span> <span class="keyword">implements</span> <span class="title class_">CourseFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> INote <span class="title function_">createNote</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PythonNote</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IVideo <span class="title function_">createViedo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PythonVideo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><ol start="5"><li>æ¥çœ‹å®¢æˆ·ç«¯è°ƒç”¨ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">JavaCourseFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JavaCourseFactory</span>();</span><br><span class="line">        factory.createNote().edit();</span><br><span class="line">        factory.createViedo().record();</span><br><span class="line">        <span class="type">PythonCourseFaactory</span> <span class="variable">factory2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PythonCourseFaactory</span>();</span><br><span class="line">        factory2.createNote().edit();</span><br><span class="line">        factory2.createViedo().record();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å®Œæ•´çš„æè¿°äº†ä¸¤ä¸ªäº§å“æ—Javaå’Œpythonè¯¾ç¨‹ï¼Œä¹Ÿæè¿°äº†ä¸¤ä¸ªäº§å“æ©æµè§†é¢‘å’Œç¬”è®°ã€‚</p><ul><li>æŠ½è±¡å·¥å‚æ¨¡å¼å®Œç¾ä¸”æ¸…æ™°çš„æè¿°äº†è¿™æ ·ä¸€å±‚å¤æ‚çš„å…³ç³»ï¼Œ</li><li>ä½†æ˜¯å¦‚æœæˆ‘ä»¬å†ç»§ç»­æ‰©å±•äº§å“ç­‰çº§å‘¢ï¼Œå°†æºç ä¹ŸåŠ å…¥è¯¾ç¨‹ï¼Œ</li><li>é‚£ä¹ˆæˆ‘ä»¬çš„ä»£ç ä»æŠ½è±¡å·¥å‚åˆ°å…·ä½“å·¥å‚å…¨éƒ¨éƒ½è¦è°ƒæ•´ï¼Œä½†å¾ˆæ˜¾ç„¶ä¸ç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li><li>æ‰€ä»¥æŠ½è±¡å·¥å‚æ¨¡å¼ä¹Ÿæ˜¯æœ‰ç¼ºç‚¹çš„ï¼š<ul><li>ï¼ˆ1ï¼‰è§„å®šäº†æ‰€æœ‰å¯èƒ½è¢«åˆ›å»ºçš„äº§å“é›†åˆï¼Œäº§å“æ—ä¸­æ‰©å±•æ–°çš„äº§å“å›°éš¾ï¼Œéœ€è¦ä¿®æ”¹æŠ½è±¡å·¥å‚çš„æ¥å£ã€‚</li><li>ï¼ˆ2ï¼‰å¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦ã€‚</li><li>ä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬åƒä¸‡ä¸èƒ½â€œçŠ¯å¼ºè¿«ç—‡â€ç”šè‡³æœ‰æ´ç™–ã€‚<ul><li>å®é™…éœ€æ±‚ä¸­ï¼Œäº§å“ç­‰çº§ç»“æ„å‡çº§æ˜¯ä¸€ä»¶éå¸¸æ­£å¸¸çš„äº‹æƒ…ã€‚</li><li>åªè¦ä¸é¢‘ç¹çš„å‡çº§ï¼Œæ ¹æ®å®é™…æƒ…å†µå¯ä»¥ä¸éµå¾ªå¼€é—­åŸåˆ™ã€‚ä»£ç æ¯åŠå¹´æˆ–è€…ä¸€å¹´å‡çº§ä¸€æ¬¡æœ‰ä½•ä¸å¯ï¼Ÿ</li></ul></li></ul></li></ul><h1 id="gua-pei-qi-mo-shi-adapter">é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰</h1><h2 id="shu-ben-xiang-guan-miao-shu-1" id="ä¹¦æœ¬ç›¸å…³æè¿°-2">ä¹¦æœ¬ç›¸å…³æè¿°</h2><ol><li><p>æ„å›¾ï¼šå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£</p><ul><li>é€‚é…å™¨æ¨¡å¼èƒ½ä½¿åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œ</li></ul></li><li><p>é€‚ç”¨æ€§ï¼š</p><ol><li>å½“ä½ æƒ³ä½¿ç”¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç±»ï¼Œè€Œä»–çš„æ¥å£ä¸ç¬¦åˆä½ çš„éœ€æ±‚ã€‚</li><li>ä½ æƒ³åˆ›å»ºä¸€ä¸ªå¯ä»¥å¤ç”¨çš„ç±»ï¼Œè¯¥ç±»å¯ä»¥ä¸å…¶å®ƒä¸ç›¸å…³çš„ç±»æˆ–ä¸å¯é¢„è§çš„ç±»ï¼ˆå³é‚£äº›æ¥å£å¯èƒ½ä¸ä¸€å®šå…¼å®¹çš„ç±»ï¼‰ååŒå·¥ä½œ</li><li>ï¼ˆä»…é€‚ç”¨ä¸å¯¹è±¡é€‚é…å™¨ï¼‰ä½ æƒ³ä½¿ç”¨ä¸€äº›å·²ç»å­˜åœ¨çš„å­ç±»ï¼Œä½†æ˜¯ä¸å¯èƒ½å¯¹æ¯ä¸€ä¸ªéƒ½è¿›è¡Œå­ç±»åŒ–ä»¥åŒ¹é…ä»–ä»¬çš„æ¥å£ã€‚å¯¹è±¡é€‚é…å™¨å¯ä»¥é€‚é…å®ƒçš„çˆ¶ç±»æ¥å£</li></ol></li><li><p>ç»“æ„å‚ä¸è€…</p></li><li><p>æ•ˆæœï¼š</p></li><li></li></ol><p><strong>é€‚é…å™¨æ¨¡å¼</strong>ï¼ˆAdapter Design Patternï¼‰ï¼š</p><ul><li>è¿™ä¸ªæ¨¡å¼å°±æ˜¯ç”¨æ¥åšé€‚é…çš„ï¼Œå®ƒå°†ä¸å…¼å®¹çš„æ¥å£è½¬æ¢ä¸ºå¯å…¼å®¹çš„æ¥å£</li><li>è®©åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„ç±»å¯ä»¥ä¸€èµ·å·¥ä½œ</li></ul><p>é€‚é…å™¨æ¨¡å¼å³ä¸¤ç§å®ç°æ–¹å¼ï¼š</p><ul><li>ç±»é€‚é…å™¨ï¼šå®ç”¨ç»§æ‰¿å…³ç³»æ¥å®ç°</li><li>å¯¹è±¡é€‚é…å™¨ï¼šä½¿ç”¨ç»„åˆå…³ç³»æ¥å®ç°ã€‚</li></ul><h2 id="lei-gua-pei-qi" id="ç±»é€‚é…å™¨">ç±»é€‚é…å™¨</h2><p>ç±»é€‚é…å™¨ï¼šåŸºäºç»§æ‰¿</p><ul><li>ä»£ç ç¤ºä¾‹ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ITarget</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">f1</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">f2</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">fc</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Adaptee</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fa</span><span class="params">()</span> &#123;...&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fb</span><span class="params">()</span> &#123;...&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fc</span><span class="params">()</span> &#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Adptor</span> <span class="keyword">extends</span> <span class="title class_">Adaptee</span> <span class="keyword">implements</span> <span class="title class_">Itarget</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.fa();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.fb();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ­¤å¤„fc() ä¸éœ€è¦å®ç°ï¼Œç›´æ¥ç»§æ‰¿è‡ªAdapteeï¼Œè¿™æ˜¯è·Ÿå¯¹è±¡é€‚é…å™¨çš„æœ€å¤§ä¸åŒ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="dui-xiang-gua-pei-qi" id="å¯¹è±¡é€‚é…å™¨">å¯¹è±¡é€‚é…å™¨</h2><p>å¯¹è±¡é€‚é…å™¨ï¼šåŸºäºç»„åˆ</p><ul><li>ä»£ç ç¤ºä¾‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ITarget</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">f1</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">f2</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">fc</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Adaptee</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fa</span><span class="params">()</span> &#123;...&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fb</span><span class="params">()</span> &#123;...&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fc</span><span class="params">()</span> &#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Adptor</span> <span class="keyword">implements</span> <span class="title class_">Itarget</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Adaptee adaptee;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Adaptor</span><span class="params">(Adaptee adaptee)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.adaptee = adaptee;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f1</span><span class="params">()</span> &#123;</span><br><span class="line">        adaptee.fa(); <span class="comment">//å§”æ‰˜ç»™Adaptee</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é‡æ–°å®ç°f2()...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fc</span><span class="params">()</span> &#123;</span><br><span class="line">        adaptee.fc();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="liang-zhe-de-bi-jiao-yu-xuan-ze" id="ä¸¤è€…çš„æ¯”è¾ƒä¸é€‰æ‹©">ä¸¤è€…çš„æ¯”è¾ƒä¸é€‰æ‹©</h2><p>é’ˆå¯¹è¿™ä¸¤ç§å®ç°æ–¹å¼ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œåˆ°åº•è¯¥å¦‚ä½•é€‰æ‹©ä½¿ç”¨å“ªä¸€ç§</p><p><strong>åˆ¤å®šæ ‡å‡†</strong>ä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p><ul><li>ä¸€ä¸ªæ˜¯Adapteeæ¥å£çš„æ ¼å¼ï¼Œ</li><li>å¦ä¸€ä¸ªæ˜¯Adapteeå’ŒItargetçš„å¥‘åˆç¨‹åº¦</li></ul><p><strong>å…·ä½“è¯´æ˜</strong>ï¼š</p><ol><li>å¦‚æœAdapteeæ¥å£<code>å¹¶ä¸å¤š</code>ï¼Œé‚£ä¸¤ç§å®ç°æ–¹å¼<code>éƒ½å¯ä»¥</code></li><li>å¦‚æœAdapteeæ¥å£<code>å¾ˆå¤š</code>ï¼Œè€Œä¸”Adapteeå’ŒITargetæ¥å£å®šä¹‰å¤§éƒ¨åˆ†<code>éƒ½ç›¸åŒ</code>ï¼Œé‚£æ¨èä½¿ç”¨<code>ç±»é€‚é…å™¨</code><ul><li>å› ä¸ºAdaptorå¤ç”¨çˆ¶ç±»Apdapteeçš„æ¥å£ï¼Œæ¯”èµ·å¯¹è±¡é€‚é…å™¨çš„å®ç°æ–¹å¼ï¼ŒAdaptorçš„ä»£ç é‡è¦å°‘ä¸€äº›ã€‚</li></ul></li><li>å¦‚æœAdapteeçš„æ¥å£<code>å¾ˆå¤š</code>ï¼Œè€Œä¸”Adapteeå’ŒITargetæ¥å£å®šä¹‰å¤§éƒ¨åˆ†<code>éƒ½ä¸ç›¸åŒ</code>ï¼Œé‚£æ¨èä½¿ç”¨<code>å¯¹è±¡é€‚é…å™¨</code><ul><li>å› ä¸ºç»„åˆç»“æ„ç›¸å¯¹äºç»§æ‰¿æ›´åŠ çµæ´»</li></ul></li></ol><h2 id="gua-pei-qi-ying-yong-chang-jing-zong-jie" id="é€‚é…å™¨åº”ç”¨åœºæ™¯æ€»ç»“">é€‚é…å™¨åº”ç”¨åœºæ™¯æ€»ç»“</h2><p>é€‚é…å™¨æ¨¡å¼å¯ä»¥çœ‹ä½œä¸€ç§ â€œè¡¥å¿æ¨¡å¼â€ ï¼Œç”¨æ¥ä¸ä¹…è®¾è®¡ä¸Šçš„ç¼ºé™·ã€‚</p><ul><li>å¦‚æœåœ¨è®¾è®¡åˆæœŸï¼Œå°±èƒ½åè°ƒè§„é¿æ¥å£ä¸å…¼å®¹çš„é—®é¢˜ï¼Œé‚£è¿™ç§æ¨¡å¼å°±æ²¡æœ‰åº”ç”¨çš„æœºä¼šäº†ã€‚</li></ul><h3 id="feng-zhuang-you-que-xian-de-jie-kou-she-ji" id="å°è£…æœ‰ç¼ºé™·çš„æ¥å£è®¾è®¡">å°è£…æœ‰ç¼ºé™·çš„æ¥å£è®¾è®¡</h3><p>å‡è®¾ä¸€ç±»çš„å¤–éƒ¨ç³»ç»Ÿåœ¨æ¥å£è®¾è®¡æ–¹é¢æœ‰ç¼ºé™·ï¼ˆæ¯”å¦‚åŒ…å«å¤§é‡çš„é™æ€æ–¹æ³•ï¼‰ï¼Œå¼•å…¥ä¹‹åæ…§å½±å“åˆ°æˆ‘ä»¬è‡ªèº«ä»£ç çš„å¯æµ‹è¯•æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CD</span> &#123; <span class="comment">// è¿™ä¸ªç±»æ¥è‡ªå¤–éƒ¨sdkï¼Œæˆ‘ä»¬æ— æƒä¿®æ”¹å®ƒçš„ä»£ç </span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">staticFunction1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">uglyNamingFunction2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tooManyParamsFunction3</span><span class="params">(<span class="type">int</span> paramA, <span class="type">int</span> paramB, ...)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    publci <span class="keyword">void</span> <span class="title function_">lowPerformanceFunction4</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ç±»é€‚é…å™¨æ¨¡å¼è¿›è¡Œé‡æ„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ITarget</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">function1</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">function2</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">function3</span><span class="params">(ParamsWrapperDefinition paramWrapper)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">function4</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ³¨æ„ï¼šç±»é€‚é…å™¨ç±»çš„å‘½åä¸ä¸€å®šéå¾—æœ«å°¾å¸¦Adaptor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CDAdaptor</span> <span class="keyword">extends</span> <span class="title class_">CD</span> <span class="keyword">implements</span> <span class="title class_">ITarget</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">function1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.staticFunction1();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">function2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.uglyNamingFunction2();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">function3</span><span class="params">(ParamsWrapperDefinition paramsWrapper)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.tooManyParamsFUnction3(paramsWrapper.getParamA(), ...);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">function4</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ... reimplement it ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="tong-yi-duo-ge-lei-de-jie-kou-she-ji" id="ç»Ÿä¸€å¤šä¸ªç±»çš„æ¥å£è®¾è®¡">ç»Ÿä¸€å¤šä¸ªç±»çš„æ¥å£è®¾è®¡</h3><p>æŸä¸ªåŠŸèƒ½çš„å®ç°ä¾èµ–å¤šä¸ªå¤–éƒ¨ç³»ç»Ÿã€‚</p><ul><li>é€šè¿‡é€‚é…å™¨æ¨¡å¼ï¼Œå°†ä»–ä»¬çš„æ¥å£é€‚é…ä¸ºç»Ÿä¸€çš„æ¥å£å®šä¹‰ï¼Œ</li><li>ç„¶åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¤šæ€çš„ç‰¹æ€§æ¥æœç”¨ä»£ç é€»è¾‘</li></ul><p><strong>å¤–éƒ¨ç³»ç»Ÿ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ASensitiveWordsFilter</span> &#123; <span class="comment">// Aæ•æ„Ÿè¯è¿‡æ»¤ç³»ç»Ÿæä¾›çš„æ¥å£</span></span><br><span class="line">    <span class="comment">// text æ˜¯åŸå§‹æ–‡æœ¬ï¼Œå‡½æ•°è¾“å‡ºç”¨***æ›¿æ¢æ•æ„Ÿè¯ä¹‹åçš„æ–‡æœ¬</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">filterSexyWords</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">filterPoliticalWords</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BSensitiveWordsFilter</span> &#123; <span class="comment">// B æ•æ„Ÿè¯è¿‡æ»¤ç³»ç»Ÿæä¾›çš„æ¥å£</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">filter</span><span class="params">(String text, String mask)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CSensitiveWordsFilter</span> &#123; <span class="comment">// C æ•æ„Ÿè¯è¿‡æ»¤ç³»ç»Ÿæä¾›çš„æ¥å£</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">filter</span><span class="params">(String text, String mask)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="tabs" id="é€‚é…å™¨"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#é€‚é…å™¨-1">RiskManagement(æœªä½¿ç”¨é€‚é…å™¨)</button></li><li class="tab"><button type="button" data-href="#é€‚é…å™¨-2">ä½¿ç”¨å</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="é€‚é…å™¨-1"><ul><li>æœªä½¿ç”¨é€‚é…å™¨æ¨¡å¼ä¹‹å‰çš„ä»£ç ï¼šä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œæ‰©å±•æ€§ä¸å¥½</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RiskManagement</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">ASensitiveWordsFilter</span> <span class="variable">aFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ASensitiveWordsFilter</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">BSensitiveWordsFilter</span> <span class="variable">bFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BSensitiveWordsFilter</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">CSensitiveWordsFilter</span> <span class="variable">cFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CSensitiveWordsFilter</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">filterSensitiveWords</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">maskedText</span> <span class="operator">=</span> aFilter.filterSexyWords(text);</span><br><span class="line">        maskedText = aFilter.filterPoliticalWords(maskedText);</span><br><span class="line">        maskedText = bFilter.filter(maskedText);</span><br><span class="line">        maskedText = cFilter.filter(maskedText, <span class="string">&quot;***&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> maskedText;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="é€‚é…å™¨-2"><ul><li>æ‰©å±•æ€§æ›´å¥½ï¼Œæ›´åŠ ç¬¦åˆå¼€æ”¾â€”é—­åˆåŸåˆ™ï¼Œå¦‚æœæ·»åŠ ä¸€ä¸ªæ–°çš„æ•æ„Ÿè¯è¿‡æ»¤ç³»ç»Ÿï¼Œ</li><li>è¿™ä¸ªç±»å®Œå…¨ä¸éœ€è¦æ”¹åŠ¨ï¼›è€Œä¸”åŸºäºæ¥å£è€ŒéåŸºäºå®ç°ç¼–ç¨‹ï¼Œä»£ç çš„å¯æµ‹è¯•æ€§æ›´å¥½</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RiskManagement</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;ISensitiveWordsFilter&gt; filterList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSensitiveWordsFilter</span><span class="params">(ISensitiveWordsFilter filter)</span> &#123;</span><br><span class="line">        filter.add(filter);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">filterSensitiveWords</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">maskedText</span> <span class="operator">=</span> text;</span><br><span class="line">        <span class="keyword">for</span>(ISensitiveWordsFilter filter : filterList) &#123;</span><br><span class="line">            maskedText = filter.filter(maskedText);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maskedText;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><ul><li>ä½¿ç”¨ç±»é€‚é…å™¨æ¨¡å¼è¿›è¡Œæ”¹é€ </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ISensitiveWordsFilter</span> &#123;</span><br><span class="line">    String <span class="title function_">filter</span><span class="params">(String text)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ASensitiveWordsFilterAdaptor</span> <span class="keyword">implements</span> <span class="title class_">ISensitiveWordsFilter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ASensitiveWordsFilter aFilter;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">filter</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">maskedText</span> <span class="operator">=</span> aFilter.filterSexyWords(text);</span><br><span class="line">        maskedText = aFilter.filterPoliticalWords(maskedText);</span><br><span class="line">        <span class="keyword">return</span> maskedText;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... æ­¤å¤„çœç•¥Bã€CSensitiveWordsFilterAdaptor</span></span><br></pre></td></tr></table></figure><ul><li>æ‰©å±•æ€§æ›´å¥½ï¼Œæ›´åŠ ç¬¦åˆå¼€æ”¾â€”é—­åˆåŸåˆ™ï¼Œå¦‚æœæ·»åŠ ä¸€ä¸ªæ–°çš„æ•æ„Ÿè¯è¿‡æ»¤ç³»ç»Ÿï¼Œ</li><li>è¿™ä¸ªç±»å®Œå…¨ä¸éœ€è¦æ”¹åŠ¨ï¼›è€Œä¸”åŸºäºæ¥å£è€ŒéåŸºäºå®ç°ç¼–ç¨‹ï¼Œä»£ç çš„å¯æµ‹è¯•æ€§æ›´å¥½</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RiskManagement</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;ISensitiveWordsFilter&gt; filterList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSensitiveWordsFilter</span><span class="params">(ISensitiveWordsFilter filter)</span> &#123;</span><br><span class="line">        filter.add(filter);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">filterSensitiveWords</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">maskedText</span> <span class="operator">=</span> text;</span><br><span class="line">        <span class="keyword">for</span>(ISensitiveWordsFilter filter : filterList) &#123;</span><br><span class="line">            maskedText = filter.filter(maskedText);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maskedText;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ti-huan-yi-lai-de-wai-bu-xi-tong" id="æ›¿æ¢ä¾èµ–çš„å¤–éƒ¨ç³»ç»Ÿ">æ›¿æ¢ä¾èµ–çš„å¤–éƒ¨ç³»ç»Ÿ</h3><p>å½“æˆ‘ä»¬æŠŠé¡¹ç›®ä¸­ä¾èµ–çš„ä¸€ä¸ªå¤–éƒ¨ç³»ç»Ÿæ›¿æ¢ä¸ºå¦ä¸€ä¸ªå¤–éƒ¨ç³»ç»Ÿçš„æ—¶å€™ï¼Œ</p><ul><li>åˆ©ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œå¯ä»¥å‡å°‘å¯¹ä»£ç çš„æ”¹åŠ¨</li></ul><p><strong>å¤–éƒ¨ç³»ç»ŸA</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤–éƒ¨ç³»ç»ŸA</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IA</span>() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">fa</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> <span class="keyword">implements</span> <span class="title class_">IA</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fa</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œå¤–éƒ¨ç³»ç»ŸAçš„ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> IA a;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Demo</span><span class="params">(IA a)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.a = a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Demo</span> <span class="variable">d</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>(<span class="keyword">new</span> <span class="title class_">A</span>());</span><br></pre></td></tr></table></figure><ul><li>å°†å¤–éƒ¨ç³»ç»ŸAæ›¿æ¢æˆå¤–éƒ¨ç³»ç»ŸB</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤–éƒ¨ç³»ç»ŸB</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IB</span>() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">fb</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BAdaptor</span> <span class="keyword">implements</span> <span class="title class_">IA</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> IB b;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BAdaptor</span><span class="params">(B b)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.b = b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fa</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        b.fb();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å€ŸåŠ©BAdaptoråï¼ŒDemoçš„ä»£ç ä¸­ï¼Œè°ƒç”¨IAæ¥å£çš„åœ°æ–¹éƒ½æ— éœ€æ”¹åŠ¨ï¼Œ</li><li>åªéœ€è¦å°†BAdaptorå¦‚ä¸‹æ³¨å…¥åˆ°Demoå³å¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Demo</span> <span class="variable">d</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>(<span class="keyword">new</span> <span class="title class_">BAdaptor</span>(<span class="keyword">new</span> <span class="title class_">B</span>));</span><br></pre></td></tr></table></figure><h2 id="dai-li-qiao-jie-zhuang-shi-qi-gua-pei-qi-de-qu-bie" id="ä»£ç†ã€æ¡¥æ¥ã€è£…é¥°å™¨ã€é€‚é…å™¨çš„åŒºåˆ«">ä»£ç†ã€æ¡¥æ¥ã€è£…é¥°å™¨ã€é€‚é…å™¨çš„åŒºåˆ«</h2><table><thead><tr><th style="text-align:center">è®¾è®¡æ¨¡å¼</th><th style="text-align:left">åŒºåˆ«</th></tr></thead><tbody><tr><td style="text-align:center">æ¡¥æ¥æ¨¡å¼</td><td style="text-align:left">æ¡¥æ¥æ¨¡å¼çš„ç›®çš„æ˜¯å°†æ¥å£éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œè€Œè®©å®ƒä»¬å¯ä»¥è¾ƒä¸ºå®¹æ˜“ã€ç‹¬ç«‹åœ°åŠ ä»¥æ”¹å˜ã€‚</td></tr><tr><td style="text-align:center">è£…é¥°å™¨æ¨¡å¼</td><td style="text-align:left">è£…é¥°å™¨æ¨¡å¼åœ¨ä¸æ”¹å˜åŸå§‹ç±»æ¥å£çš„æƒ…å†µä¸‹ï¼Œå¯¹åŸå§‹ç±»åŠŸèƒ½è¿›è¡Œå¢å¼ºï¼Œå¹¶ä¸”æ”¯æŒå¤šä¸ªè£…é¥°å™¨çš„åµŒå¥—ä½¿ç”¨ã€‚</td></tr><tr><td style="text-align:center">ä»£ç†æ¨¡å¼</td><td style="text-align:left">ä»£ç†æ¨¡å¼åœ¨ä¸æ”¹å˜åŸå§‹ç±»æ¥å£çš„æ¡ä»¶ä¸‹ï¼Œä¸ºåŸå§‹ç±»å®šä¹‰ä¸€ä¸ªä»£ç†ç±»ï¼Œä¸»è¦ç›®çš„æ˜¯æ§åˆ¶è®¿é—®ï¼Œè€ŒéåŠ å¼ºåŠŸèƒ½ï¼Œè¿™æ˜¯å®ƒè·Ÿè£…é¥°å™¨æ¨¡å¼æœ€å¤§çš„ä¸åŒ</td></tr><tr><td style="text-align:center"><code>é€‚é…å™¨æ¨¡å¼</code></td><td style="text-align:left">é€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§æ—¶å€™çš„è¡¥æ•‘ç­–ç•¥ï¼Œé€‚é…å™¨æä¾›è·ŸåŸå§‹ç±»ä¸åŒçš„æ¥å£ï¼Œè€Œä»£ç†æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼æä¾›çš„éƒ½æ˜¯è·ŸåŸæ¥ç±»ç›¸åŒçš„æ¥å£</td></tr></tbody></table><h1 id="ce-lue-mo-shi-strategy">ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰</h1><h2 id="shu-ben-jie-shao" id="ä¹¦æœ¬ä»‹ç»">ä¹¦æœ¬ä»‹ç»</h2><ol><li><p>æ„å›¾ï¼šå®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•ï¼ŒæŠŠä»–ä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿ä»–ä»¬å¯ä»¥ç›¸äº’æ›¿æ¢</p><ul><li>è¯¥æ¨¡å¼æ˜¯çš„ç®—æ³•å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·è€Œå˜åŒ–</li></ul></li><li><p>é€‚ç”¨æ€§</p><ol><li>å¦‚æœåœ¨ä¸€ä¸ªç³»ç»Ÿé‡Œæœ‰è®¸å¤šç±»ï¼Œè¿™äº›ç±»ä¹‹é—´çš„åŒºåˆ«ä»…åœ¨äºå®ƒä»¬çš„è¡Œä¸ºï¼Œé‚£ä¹ˆä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°è®©ä¸€ä¸ªå¯¹è±¡åœ¨è®¸å¤šè¡Œä¸ºä¸­é€‰æ‹©ä¸€ç§è¡Œä¸ºã€‚</li><li>ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§ï¼Œé‚£ä¹ˆè¿™äº›ç®—æ³•å¯ä»¥åŒ…è£…åˆ°ä¸€ä¸ªä¸ªçš„å…·ä½“ç®—æ³•ç±»é‡Œé¢ï¼Œè€Œè¿™äº›å…·ä½“ç®—æ³•ç±»éƒ½æœ‰ä¸€ä¸ªæŠ½è±¡ç®—æ³•ç±»çš„å­ç±»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›å…·ä½“ç®—æ³•ç±»å‡æœ‰ç»Ÿä¸€çš„æ¥å£ï¼Œç”±äºå¤šæ€æ€§ï¼Œå®¢æˆ·å¯ä»¥é€‰æ‹©ä½¿ç”¨ä»»ä½•ä¸€ä¸ªå…·ä½“ç®—æ³•ç±»ï¼Œå¹¶æ”¯æŒæœ‰ä¸€ä¸ªæ•°æ®ç±»å‹æ˜¯æŠ½è±¡ç®—æ³•ç±»çš„å¯¹è±¡ã€‚</li><li>ç®—æ³•ä½¿ç”¨ç”¨æˆ·ä¸åº”è¯¥çŸ¥é“çš„æ•°æ®ã€‚å¯ä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼Œä»¥é¿å…æš´éœ²å¤æ‚çš„ä¸ç®—æ³•ç›¸å…³çš„æ•°æ®ç»“æ„</li><li>ä¸€ä¸ªç±»å®šä¹‰äº†å¤šç§è¡Œä¸ºï¼Œå¹¶ä¸”è¿™äº›è¡Œä¸ºåœ¨è¿™ä¸ªç±»çš„æ“ä½œä¸­ä»¥å¤šä¸ªæ¡ä»¶è¯­å¥çš„å½¢å¼å‡ºç°ã€‚æ­¤æ—¶ä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼ŒæŠŠè¿™äº›è¡Œä¸ºè½¬ç§»åˆ°ç›¸åº”çš„å…·ä½“ç­–ç•¥ç±»é‡Œé¢ï¼Œå°±å¯ä»¥é¿å…ä½¿ç”¨éš¾ä»¥ç»´æŠ¤çš„å¤šé‡æ¡ä»¶é€‰æ‹©è¯­å¥ã€‚</li></ol></li><li><p>ç»“æ„å‚ä¸è€…ï¼š</p></li><li><p>æ•ˆæœï¼šç­–ç•¥æ¨¡å¼æœ‰ä¸‹é¢çš„ä¸€äº›ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼š</p><ol><li>Strategy ç±»å±‚æ¬¡ä¸Šä¸ºä¸Šä¸‹æ–‡ç¯å¢ƒå®šä¹‰äº†ä¸€ç³»åˆ—çš„å¯ä¾›é‡ç”¨çš„ç®—æ³•æˆ–è¡Œä¸ºã€‚</li><li>ä¸€ä¸ªæ›¿ä»£ç»§æ‰¿çš„æ–¹æ³•</li><li>æ¶ˆé™¤äº†ä¸€äº›æ¡ä»¶è¯­å¥</li><li>ç­–ç•¥æ¨¡å¼å¯ä»¥æä¾›ç›¸åŒè¡Œä¸ºçš„ä¸åŒå®ç°</li><li>å®¢æˆ·å¿…é¡»äº†è§£ä¸åŒçš„ç­–ç•¥</li><li>æ— è®ºå„ä¸ªå…·ä½“ç­–ç•¥å®ç°çš„ç®—æ³•æ˜¯ç®€å•è¿˜æ˜¯å¤æ‚ï¼Œä»–ä»¬éƒ½å…±äº«ç­–ç•¥å®šä¹‰çš„æ¥å£ã€‚</li><li>ç­–ç•¥å¢åŠ äº†ä¸€ä¸ªåº”ç”¨ä¸­çš„å¯¹è±¡çš„æ•°ç›®ã€‚</li></ol></li><li><p>ç¤ºä¾‹ï¼šå¦‚ä¸‹</p></li></ol><p>æ¯”å¦‚è¯´å¯¹è±¡çš„æŸä¸ªè¡Œä¸ºï¼Œåœ¨ä¸åŒåœºæ™¯ä¸­æœ‰ä¸åŒçš„å®ç°æ–¹å¼ï¼Œ</p><ul><li>è¿™æ ·å°±å¯ä»¥å°†è¿™äº›å®ç°æ–¹å¼å®šä¹‰æˆä¸€ç»„<strong>ç­–ç•¥</strong>ï¼Œæ¯ä¸ªå®ç°ç±»å¯¹åº”ä¸€ä¸ªç­–ç•¥ï¼Œ</li><li>åœ¨ä¸åŒçš„åœºæ™¯å°±ä½¿ç”¨ä¸åŒçš„å®ç°ç±»ï¼Œå¹¶ä¸”å¯ä»¥è‡ªç”±åˆ‡æ¢ç­–ç•¥ã€‚</li></ul><p>ç­–ç•¥æ¨¡å¼çš„<u>ç»“æ„å›¾</u>å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/06/232c617adaa6403caf81ef19cae7eb8f" alt="img"></p><p>ç­–ç•¥æ¨¡å¼éœ€è¦ä¸€ä¸ªç­–ç•¥æ¥å£ï¼Œ</p><ul><li>ä¸åŒçš„ç­–ç•¥å®ç°ä¸åŒçš„å®ç°ç±»ï¼Œåœ¨å…·ä½“ä¸šåŠ¡ç¯å¢ƒä¸­ä»…æŒæœ‰è¯¥ç­–ç•¥æ¥å£ï¼Œ</li><li>æ ¹æ®ä¸åŒçš„åœºæ™¯æ˜¯å“¦é‚£ä¸ªä¸åŒçš„å®ç°ç±»å³å¯</li></ul><blockquote><p>æ³¨æ„ï¼šé¢å‘æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é¢å‘å®ç°</p></blockquote><h2 id="ce-lue-mo-shi-de-you-que-dian" id="ç­–ç•¥æ¨¡å¼çš„ä¼˜ç¼ºç‚¹">ç­–ç•¥æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2><p><strong>ç­–ç•¥æ¨¡å¼çš„ä¼˜ç‚¹</strong>ï¼š</p><ol><li>å¹²æ‰ç¹ççš„ ifã€switch åˆ¤æ–­é€»è¾‘</li><li>ä»£ç ä¼˜é›…ã€å¯å¤ç”¨ã€å¯è¯»æ€§å¥½</li><li>ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œæ‰©å±•æ€§å¥½ã€ä¾¿äºç»´æŠ¤</li></ol><p><strong>ç­–ç•¥æ¨¡å¼çš„ç¼ºç‚¹</strong>ï¼š</p><ol><li>ç­–ç•¥å¦‚æœå¾ˆå¤šçš„è¯ï¼Œä¼šé€ æˆç­–ç•¥ç±»è†¨èƒ€</li><li>ä½¿ç”¨è€…å¿…é¡»æ¸…æ¥šæ‰€æœ‰çš„ç­–ç•¥ç±»åŠå…¶ç”¨é€”</li></ol><h2 id="shi-li-fen-xi" id="å®ä¾‹åˆ†æ">å®ä¾‹åˆ†æ</h2><p>ä¸¾ä¸ªå®é™…çš„ä¾‹å­ï¼Œxxå…¬å¸æ˜¯åšæ”¯ä»˜çš„ï¼Œæ ¹æ®ä¸åŒçš„å®¢æˆ·ç±»å‹ä¼šæœ‰ä¸åŒçš„æ”¯ä»˜æ–¹å¼å’Œæ”¯ä»˜äº§å“ï¼Œæ¯”å¦‚ï¼š</p><ul><li><p>ä¿¡ç”¨å¡</p></li><li><p>æœ¬åœ°æ”¯ä»˜</p><ul><li>æœ¬åœ°æ”¯ä»˜åœ¨ä¸­å›½åˆæœ‰å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®ã€äº‘é—ªä»˜ã€ç­‰æ›´å¤šç¬¬ä¸‰æ–¹æ”¯ä»˜å…¬å¸</li></ul></li></ul><p>è¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼äº†</p><ol><li>å®šä¹‰ç­–ç•¥æ¥å£</li></ol><ul><li>å®šä¹‰ä¸€ä¸ªç­–ç•¥æ¥å£ï¼Œæ‰€æœ‰æ”¯ä»˜æ–¹å¼çš„æ¥å£</li></ul><p><strong>ç­–ç•¥æ¥å£</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IPayment</span> &#123;</span><br><span class="line">    PayResult <span class="title function_">pay</span><span class="params">(Order order)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è®¢å•ä¿¡æ¯ç±»</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * é‡‘é¢</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> amount; </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ”¯ä»˜ç±»å‹</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String paymentType;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿”å›ç»“æœç±»</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span> </span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayResult</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ”¯ä»˜ç»“æœ</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å®šä¹‰å„ç§ç­–ç•¥</li></ol><ul><li>å®šä¹‰å„ç§æ”¯ä»˜ç­–ç•¥ï¼Œå¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®ã€äº‘é—ªä»˜ç­‰æ”¯ä»˜å®ç°ç±»éƒ½å®ç°è¿™ä¸ªæ¥å£</li></ul><div class="tabs" id="paytype"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#paytype-1">å¾®ä¿¡æ”¯ä»˜</button></li><li class="tab"><button type="button" data-href="#paytype-2">æ”¯ä»˜å®æ”¯ä»˜</button></li><li class="tab"><button type="button" data-href="#paytype-3">äº‘é—ªä»˜</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="paytype-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;WechatPay&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatPay</span> <span class="keyword">implements</span> <span class="title class_">IPayment</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PayResult <span class="title function_">pay</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PayResult</span>(<span class="string">&quot;å¾®ä¿¡æ”¯ä»˜æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="paytype-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;Alipay&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Alipay</span> <span class="keyword">implements</span> <span class="title class_">IPayment</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PayResult <span class="title function_">pay</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PayResult</span>(<span class="string">&quot;æ”¯ä»˜å®æ”¯ä»˜æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="paytype-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;UnionPay&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnionPay</span> <span class="keyword">implements</span> <span class="title class_">IPayment</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PayResult <span class="title function_">pay</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PayResult</span>(<span class="string">&quot;äº‘é—ªä»˜æ”¯ä»˜æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>è¿™é‡Œæˆ‘æŠŠæ‰€æœ‰æ”¯ä»˜æ–¹å¼ç±»éƒ½ç”¨ @Service æ³¨è§£ç”Ÿæˆ Bean æ”¾å…¥ Spring Bean å®¹å™¨ä¸­äº†ï¼Œåœ¨ä½¿ç”¨ç­–ç•¥çš„æ—¶å€™å°±ä¸ç”¨ new æ”¯ä»˜å¯¹è±¡äº†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Beanï¼Œè¿™æ ·æ›´è´´è¿‘ä¸šåŠ¡ã€‚</p><ol start="3"><li>ä½¿ç”¨ç­–ç•¥</li></ol><p>æœ‰çš„æ–‡ç« ä½¿ç”¨äº†æšä¸¾ã€HashMap çš„æ–¹å¼æ¥æ ¹æ®ç­–ç•¥åç§°æ˜ å°„ç­–ç•¥å®ç°ç±» ï¼Œè¿™æ ·æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œ</p><ul><li>ä½†åœ¨ä½¿ç”¨äº† Spring æ¡†æ¶çš„é¡¹ç›®è¿˜æ˜¯æœ‰ç‚¹å¤šæ­¤ä¸€ä¸¾ï¼Œ</li><li>å®Œå…¨å¯ä»¥å‘æŒ¥ Spring æ¡†æ¶çš„ä¼˜åŠ¿ï¼Œä½¿ç”¨ Bean åç§°å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„ç­–ç•¥å®ç°ç±»äº†ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¯ä»˜æ¥å£</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> amount</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paymentType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/pay&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> PayResult <span class="title function_">pay</span><span class="params">(<span class="meta">@RequestParam(&quot;amount&quot;)</span> <span class="type">int</span> amount,</span></span><br><span class="line"><span class="params">                    <span class="meta">@RequestParam(&quot;paymentType&quot;)</span> String paymentType)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setAmount(amount);</span><br><span class="line">        order.setPaymentType(paymentType);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¹æ®æ”¯ä»˜ç±»å‹è·å–å¯¹åº”çš„ç­–ç•¥ bean</span></span><br><span class="line">        <span class="type">IPayment</span> <span class="variable">payment</span> <span class="operator">=</span> applicationContext.getBean(order.getPaymentType(), IPayment.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å§‹æ”¯ä»˜</span></span><br><span class="line">        <span class="type">PayResult</span> <span class="variable">payResult</span> <span class="operator">=</span> payment.pay(order);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> payResult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ce-lue-mo-shi-zai-jdk-zhong-de-ying-yong" id="ç­–ç•¥æ¨¡å¼åœ¨JDKä¸­çš„åº”ç”¨">ç­–ç•¥æ¨¡å¼åœ¨JDKä¸­çš„åº”ç”¨</h2><h3 id="xian-cheng-chi-zhong-de-ju-jue-ce-lue" id="çº¿ç¨‹æ± ä¸­çš„æ‹’ç»ç­–ç•¥">çº¿ç¨‹æ± ä¸­çš„æ‹’ç»ç­–ç•¥</h3><p>çº¿ç¨‹æ± çš„æ„é€ ä¸­æœ‰ä¸€ä¸ªæ‹’ç»ç­–ç•¥å‚æ•°ï¼Œé»˜è®¤æ˜¯é»˜è®¤æ‹’ç»ç­–ç•¥ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/06/3c1f4897197f4b17816483d91f339d7f" alt="image-20230406104524945"></p><p>å…¶å®å°±æ˜¯ä¸€ä¸ªç­–ç•¥æ¥å£ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/06/b7ed597a0b2c458aa24c7900f575769c" alt="image-20230406104633358"></p><p>ä¸‹é¢æœ‰å‡ ç§æ‹’ç»ç­–ç•¥çš„å®ç°ï¼š</p><p><img src="https://s1.vika.cn/space/2023/04/06/b550743018e64584a7b2e1f331ea2395" alt="image-20210329161322406"></p><h3 id="bi-jiao-qi" id="æ¯”è¾ƒå™¨">æ¯”è¾ƒå™¨</h3><h1 id="men-mian-mo-shi-facade">é—¨é¢æ¨¡å¼ï¼ˆFacadeï¼‰</h1><h1 id="guan-cha-zhe-mo-shi-observer">è§‚å¯Ÿè€…æ¨¡å¼(Observer)</h1><h1 id="dai-li-mo-shi-proxy">ä»£ç†æ¨¡å¼ï¼ˆproxyï¼‰</h1>]]></content>
    
    
    <summary type="html">springå¸¸è§è®¾è®¡æ¨¡å¼</summary>
    
    
    
    <category term="ç¼–ç¨‹æ€æƒ³æ–¹æ³•" scheme="https://www.taoyaopc.live/categories/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%E6%96%B9%E6%B3%95/"/>
    
    
    <category term="Java" scheme="https://www.taoyaopc.live/tags/Java/"/>
    
    <category term="Spring" scheme="https://www.taoyaopc.live/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Rediså®æˆ˜ç¯‡1</title>
    <link href="https://www.taoyaopc.live/posts/a6b15897.html"/>
    <id>https://www.taoyaopc.live/posts/a6b15897.html</id>
    <published>2023-03-25T08:30:00.000Z</published>
    <updated>2023-03-29T14:34:04.006Z</updated>
    
    <content type="html"><![CDATA[<h1 id="kai-pian-dao-du">å¼€ç¯‡å¯¼è¯»</h1><p>äº²çˆ±çš„å°ä¼™ä¼´ä»¬å¤§å®¶å¥½ï¼Œé©¬ä¸Šå’±ä»¬å°±å¼€å§‹å®æˆ˜ç¯‡çš„å†…å®¹äº†ï¼Œç›¸ä¿¡é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œå°ä¼™ä¼´ä»¬å°±èƒ½ç†è§£å„ç§redisçš„ä½¿ç”¨å•¦ï¼Œæ¥ä¸‹æ¥å’±ä»¬æ¥ä¸€èµ·çœ‹çœ‹å®æˆ˜ç¯‡æˆ‘ä»¬è¦å­¦ä¹ ä¸€äº›ä»€ä¹ˆæ ·çš„å†…å®¹</p><ul><li>çŸ­ä¿¡ç™»å½•</li></ul><p>è¿™ä¸€å—æˆ‘ä»¬ä¼šä½¿ç”¨rediså…±äº«sessionæ¥å®ç°</p><ul><li>å•†æˆ·æŸ¥è¯¢ç¼“å­˜</li></ul><p>é€šè¿‡æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬ä¼šç†è§£<strong>ç¼“å­˜å‡»ç©¿ï¼Œç¼“å­˜ç©¿é€ï¼Œç¼“å­˜é›ªå´©</strong>ç­‰é—®é¢˜ï¼Œè®©å°ä¼™ä¼´çš„å¯¹äºè¿™äº›æ¦‚å¿µçš„ç†è§£ä¸ä»…ä»…æ˜¯åœç•™åœ¨æ¦‚å¿µä¸Šï¼Œæ›´æ˜¯èƒ½åœ¨ä»£ç ä¸­çœ‹åˆ°å¯¹åº”çš„å†…å®¹</p><ul><li>ä¼˜æƒ å·ç§’æ€</li></ul><p>é€šè¿‡æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥å­¦ä¼šRedisçš„è®¡æ•°å™¨åŠŸèƒ½ï¼Œ ç»“åˆLuaå®Œæˆé«˜æ€§èƒ½çš„redisæ“ä½œï¼ŒåŒæ—¶å­¦ä¼šRedisåˆ†å¸ƒå¼é”çš„åŸç†ï¼ŒåŒ…æ‹¬Redisçš„ä¸‰ç§æ¶ˆæ¯é˜Ÿåˆ—</p><ul><li>é™„è¿‘çš„å•†æˆ·</li></ul><p>æˆ‘ä»¬åˆ©ç”¨Redisçš„GEOHashæ¥å®Œæˆå¯¹äºåœ°ç†åæ ‡çš„æ“ä½œ</p><ul><li>UVç»Ÿè®¡</li></ul><p>ä¸»è¦æ˜¯ä½¿ç”¨Redisæ¥å®Œæˆç»Ÿè®¡åŠŸèƒ½</p><ul><li>ç”¨æˆ·ç­¾åˆ°</li></ul><p>ä½¿ç”¨Redisçš„BitMapæ•°æ®ç»Ÿè®¡åŠŸèƒ½</p><ul><li>å¥½å‹å…³æ³¨</li></ul><p>åŸºäºSeté›†åˆçš„å…³æ³¨ã€å–æ¶ˆå…³æ³¨ï¼Œå…±åŒå…³æ³¨ç­‰ç­‰åŠŸèƒ½ï¼Œè¿™ä¸€å—çŸ¥è¯†å’±ä»¬ä¹‹å‰å°±è®²è¿‡ï¼Œè¿™æ¬¡æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æ¥ä½¿ç”¨ä¸€ä¸‹</p><ul><li>æ‰“äººæ¢åº—</li></ul><p>åŸºäºListæ¥å®Œæˆç‚¹èµåˆ—è¡¨çš„æ“ä½œï¼ŒåŒæ—¶åŸºäºSortedSetæ¥å®Œæˆç‚¹èµçš„æ’è¡Œæ¦œåŠŸèƒ½</p><p>ä»¥ä¸Šè¿™äº›å†…å®¹å’±ä»¬ç»Ÿç»Ÿéƒ½ä¼šç»™å°ä¼™ä¼´ä»¬è®²è§£æ¸…æ¥šï¼Œè®©å¤§å®¶å……åˆ†ç†è§£å¦‚ä½•ä½¿ç”¨Redis</p><p><img src="https://s1.vika.cn/space/2023/03/25/25bdf3f5c02c4d32b899c26a18d3640d" alt="1653056228879"></p><h1 id="duan-xin-deng-lu">çŸ­ä¿¡ç™»å½•</h1><h2 id="dao-ru-hei-ma-dian-ping-xiang-mu" id="å¯¼å…¥é»‘é©¬ç‚¹è¯„é¡¹ç›®">å¯¼å…¥é»‘é©¬ç‚¹è¯„é¡¹ç›®</h2><h3 id="dao-ru-sql" id="å¯¼å…¥SQL">å¯¼å…¥SQL</h3><p><img src="https://s1.vika.cn/space/2023/03/25/8d03e29d9d204472a34743d71c117e76" alt="1653057872536"></p><h4 id="you-guan-dang-qian-mo-xing" id="æœ‰å…³å½“å‰æ¨¡å‹">æœ‰å…³å½“å‰æ¨¡å‹</h4><p>æ‰‹æœºæˆ–è€… app ç«¯å‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚æˆ‘ä»¬çš„nginxæœåŠ¡å™¨ï¼ŒnginxåŸºäºä¸ƒå±‚æ¨¡å‹èµ°çš„äº‹HTTPåè®®ï¼Œå¯ä»¥å®ç°åŸºäºLuaç›´æ¥ç»•å¼€tomcatè®¿é—®redisï¼Œä¹Ÿå¯ä»¥ä½œä¸ºé™æ€èµ„æºæœåŠ¡å™¨ï¼Œè½»æ¾æ‰›ä¸‹ä¸Šä¸‡å¹¶å‘ï¼Œ è´Ÿè½½å‡è¡¡åˆ°ä¸‹æ¸¸tomcatæœåŠ¡å™¨ï¼Œæ‰“æ•£æµé‡ï¼Œ</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ä¸€å°4æ ¸8Gçš„tomcatï¼Œåœ¨ä¼˜åŒ–å’Œå¤„ç†ç®€å•ä¸šåŠ¡çš„åŠ æŒä¸‹ï¼Œå¤§ä¸äº†å°±å¤„ç†1000å·¦å³çš„å¹¶å‘ï¼Œ ç»è¿‡nginxçš„è´Ÿè½½å‡è¡¡åˆ†æµåï¼Œåˆ©ç”¨é›†ç¾¤æ”¯æ’‘èµ·æ•´ä¸ªé¡¹ç›®ï¼ŒåŒæ—¶nginxåœ¨éƒ¨ç½²äº†å‰ç«¯é¡¹ç›®åï¼Œæ›´æ˜¯å¯ä»¥åšåˆ°åŠ¨é™åˆ†ç¦»ï¼Œè¿›ä¸€æ­¥é™ä½tomcatæœåŠ¡çš„å‹åŠ›ï¼Œè¿™äº›åŠŸèƒ½éƒ½å¾—é nginxèµ·ä½œç”¨ï¼Œæ‰€ä»¥nginxæ˜¯æ•´ä¸ªé¡¹ç›®ä¸­é‡è¦çš„ä¸€ç¯ã€‚</p><p>åœ¨tomcatæ”¯æ’‘èµ·å¹¶å‘æµé‡åï¼Œæˆ‘ä»¬å¦‚æœè®©tomcatç›´æ¥å»è®¿é—®Mysqlï¼Œæ ¹æ®ç»éªŒMysqlä¼ä¸šçº§æœåŠ¡å™¨åªè¦ä¸Šç‚¹å¹¶å‘ï¼Œä¸€èˆ¬æ˜¯16æˆ–32 æ ¸å¿ƒcpuï¼Œ32 æˆ–64Gå†…å­˜ï¼Œåƒä¼ä¸šçº§mysqlåŠ ä¸Šå›ºæ€ç¡¬ç›˜èƒ½å¤Ÿæ”¯æ’‘çš„å¹¶å‘ï¼Œå¤§æ¦‚å°±æ˜¯4000èµ·~7000å·¦å³ï¼Œä¸Šä¸‡å¹¶å‘ï¼Œ ç¬é—´å°±ä¼šè®©MysqlæœåŠ¡å™¨çš„cpuï¼Œç¡¬ç›˜å…¨éƒ¨æ‰“æ»¡ï¼Œå®¹æ˜“å´©æºƒï¼Œ</p><p>æ‰€ä»¥æˆ‘ä»¬åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¼šé€‰æ‹©ä½¿ç”¨mysqlé›†ç¾¤ï¼ŒåŒæ—¶ä¸ºäº†è¿›ä¸€æ­¥é™ä½Mysqlçš„å‹åŠ›ï¼ŒåŒæ—¶å¢åŠ è®¿é—®çš„æ€§èƒ½ï¼Œæˆ‘ä»¬ä¹Ÿä¼šåŠ å…¥Redisï¼ŒåŒæ—¶ä½¿ç”¨Redisé›†ç¾¤ä½¿å¾—Rediså¯¹å¤–æä¾›æ›´å¥½çš„æœåŠ¡ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/25/ea6f73f2c2dd48fa80d1020b1b4d1527" alt="1653059409865"></p><h3 id="dao-ru-hou-duan-xiang-mu" id="å¯¼å…¥åç«¯é¡¹ç›®">å¯¼å…¥åç«¯é¡¹ç›®</h3><p>åœ¨èµ„æ–™ä¸­æä¾›äº†ä¸€ä¸ªé¡¹ç›®æºç ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/25/bab6471a8ffc40798bfd04a9f7c5bf8f" alt="1653060237073"></p><h3 id="dao-ru-qian-duan-gong-cheng" id="å¯¼å…¥å‰ç«¯å·¥ç¨‹">å¯¼å…¥å‰ç«¯å·¥ç¨‹</h3><p><img src="https://s1.vika.cn/space/2023/03/25/d15402a3154140a79314f4ec5bbeecbf" alt="1653060337562"></p><h3 id="yun-xing-qian-duan-xiang-mu" id="è¿è¡Œå‰ç«¯é¡¹ç›®">è¿è¡Œå‰ç«¯é¡¹ç›®</h3><p><img src="https://s1.vika.cn/space/2023/03/25/6faad7f1ac98457baba2b4809ce54e7c" alt="1653060588190"></p><h2 id="ji-yu-session-shi-xian-deng-lu-liu-cheng" id="åŸºäºSessionå®ç°ç™»å½•æµç¨‹">åŸºäºSessionå®ç°ç™»å½•æµç¨‹</h2><p><strong>å‘é€éªŒè¯ç ï¼š</strong></p><p>ç”¨æˆ·åœ¨æäº¤æ‰‹æœºå·åï¼Œä¼šæ ¡éªŒæ‰‹æœºå·æ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸åˆæ³•ï¼Œåˆ™è¦æ±‚ç”¨æˆ·é‡æ–°è¾“å…¥æ‰‹æœºå·</p><p>å¦‚æœæ‰‹æœºå·åˆæ³•ï¼Œåå°æ­¤æ—¶ç”Ÿæˆå¯¹åº”çš„éªŒè¯ç ï¼ŒåŒæ—¶å°†éªŒè¯ç è¿›è¡Œä¿å­˜ï¼Œç„¶åå†é€šè¿‡çŸ­ä¿¡çš„æ–¹å¼å°†éªŒè¯ç å‘é€ç»™ç”¨æˆ·</p><p><strong>çŸ­ä¿¡éªŒè¯ç ç™»å½•ã€æ³¨å†Œï¼š</strong></p><p>ç”¨æˆ·å°†éªŒè¯ç å’Œæ‰‹æœºå·è¿›è¡Œè¾“å…¥ï¼Œåå°ä»sessionä¸­æ‹¿åˆ°å½“å‰éªŒè¯ç ï¼Œç„¶åå’Œç”¨æˆ·è¾“å…¥çš„éªŒè¯ç è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™æ— æ³•é€šè¿‡æ ¡éªŒï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™åå°æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œåˆ™ä¸ºç”¨æˆ·åˆ›å»ºè´¦å·ä¿¡æ¯ï¼Œä¿å­˜åˆ°æ•°æ®åº“ï¼Œæ— è®ºæ˜¯å¦å­˜åœ¨ï¼Œéƒ½ä¼šå°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°sessionä¸­ï¼Œæ–¹ä¾¿åç»­è·å¾—å½“å‰ç™»å½•ä¿¡æ¯</p><p><strong>æ ¡éªŒç™»å½•çŠ¶æ€:</strong></p><p>ç”¨æˆ·åœ¨è¯·æ±‚æ—¶å€™ï¼Œä¼šä»cookieä¸­æºå¸¦è€…JsessionIdåˆ°åå°ï¼Œåå°é€šè¿‡JsessionIdä»sessionä¸­æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰sessionä¿¡æ¯ï¼Œåˆ™è¿›è¡Œæ‹¦æˆªï¼Œå¦‚æœæœ‰sessionä¿¡æ¯ï¼Œåˆ™å°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°threadLocalä¸­ï¼Œå¹¶ä¸”æ”¾è¡Œ</p><p><img src="https://s1.vika.cn/space/2023/03/25/f76b30ec90fe4082848dac05e75129cf" alt="1653066208144"></p><h3 id="thread-local" id="ThreadLocal">ThreadLocal</h3><ul><li><p>æ˜¯ä¸€ä¸ªçº¿ç¨‹åŸŸå¯¹è±¡</p></li><li><p>å¯ä»¥æŠŠç”¨æˆ·æ•°æ®ä¿å­˜åˆ°çº¿ç¨‹å†…éƒ¨ï¼Œå³çº¿ç¨‹ä¼šåˆ›å»ºä¸€ä¸ªmapå¯¹è±¡ä¿å­˜æ•°æ®</p></li><li><p>è¿™æ ·æ¯ä¸€ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ç©ºé—´ï¼Œç”¨æˆ·ä¹‹é—´ä¸ç›¸äº’å¹²æ‰°ï¼ˆçº¿ç¨‹å¹²æ‰°ï¼‰</p></li><li><p>åç»­éœ€è¦ç”¨æˆ·ä¿¡æ¯å³å¯ä»ä¸­å»é™¤</p></li></ul><h3 id="shi-xian-fa-song-duan-xin-yan-zheng-ma-gong-neng" id="å®ç°å‘é€çŸ­ä¿¡éªŒè¯ç åŠŸèƒ½">å®ç°å‘é€çŸ­ä¿¡éªŒè¯ç åŠŸèƒ½</h3><p><strong>é¡µé¢æµç¨‹</strong></p><p><img src="https://s1.vika.cn/space/2023/03/25/1efa14c17643428a8fdf4b08f72cfca5" alt="1653067054461"></p><p><strong>å…·ä½“ä»£ç å¦‚ä¸‹</strong></p><p><strong>è´´å¿ƒå°æç¤ºï¼š</strong></p><p>å…·ä½“é€»è¾‘ä¸Šæ–‡å·²ç»åˆ†æï¼Œæˆ‘ä»¬ä»…ä»…åªéœ€è¦æŒ‰ç…§æç¤ºçš„é€»è¾‘å†™å‡ºä»£ç å³å¯ã€‚</p><ul><li>å‘é€éªŒè¯ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sendCode</span><span class="params">(String phone, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line">    <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line">        <span class="comment">// 2.å¦‚æœä¸ç¬¦åˆï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.ç¬¦åˆï¼Œç”ŸæˆéªŒè¯ç </span></span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> RandomUtil.randomNumbers(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.ä¿å­˜éªŒè¯ç åˆ° session</span></span><br><span class="line">    session.setAttribute(<span class="string">&quot;code&quot;</span>,code);</span><br><span class="line">    <span class="comment">// 5.å‘é€éªŒè¯ç </span></span><br><span class="line">    log.debug(<span class="string">&quot;å‘é€çŸ­ä¿¡éªŒè¯ç æˆåŠŸï¼ŒéªŒè¯ç ï¼š&#123;&#125;&quot;</span>, code);</span><br><span class="line">    <span class="comment">// è¿”å›ok</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç™»å½•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> loginForm.getPhone();</span><br><span class="line">    <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line">        <span class="comment">// 2.å¦‚æœä¸ç¬¦åˆï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.æ ¡éªŒéªŒè¯ç </span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">cacheCode</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> loginForm.getCode();</span><br><span class="line">    <span class="keyword">if</span>(cacheCode == <span class="literal">null</span> || !cacheCode.toString().equals(code))&#123;</span><br><span class="line">         <span class="comment">//3.ä¸ä¸€è‡´ï¼ŒæŠ¥é”™</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¸€è‡´ï¼Œæ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> query().eq(<span class="string">&quot;phone&quot;</span>, phone).one();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">//ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º</span></span><br><span class="line">        user =  createUserWithPhone(phone);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//7.ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°sessionä¸­</span></span><br><span class="line">    session.setAttribute(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="shi-xian-deng-lu-lan-jie-gong-neng" id="å®ç°ç™»å½•æ‹¦æˆªåŠŸèƒ½">å®ç°ç™»å½•æ‹¦æˆªåŠŸèƒ½</h3><p><strong>æ¸©é¦¨å°è´´å£«ï¼štomcatçš„è¿è¡ŒåŸç†</strong></p><p><img src="https://s1.vika.cn/space/2023/03/25/75647b34d0064590b4e2d5e4592bab8e" alt="1653068196656"></p><p>å½“ç”¨æˆ·å‘èµ·è¯·æ±‚æ—¶ï¼Œä¼šè®¿é—®æˆ‘ä»¬åƒtomcatæ³¨å†Œçš„ç«¯å£ï¼Œä»»ä½•ç¨‹åºæƒ³è¦è¿è¡Œï¼Œéƒ½éœ€è¦æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å½“å‰ç«¯å£å·è¿›è¡Œç›‘å¬ï¼Œtomcatä¹Ÿä¸ä¾‹å¤–ï¼Œå½“ç›‘å¬çº¿ç¨‹çŸ¥é“ç”¨æˆ·æƒ³è¦å’Œtomcatè¿æ¥è¿æ¥æ—¶ï¼Œé‚£ä¼šç”±ç›‘å¬çº¿ç¨‹åˆ›å»ºsocketè¿æ¥ï¼Œsocketéƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œç”¨æˆ·é€šè¿‡socketåƒäº’ç›¸ä¼ é€’æ•°æ®ï¼Œå½“tomcatç«¯çš„socketæ¥å—åˆ°æ•°æ®åï¼Œæ­¤æ—¶ç›‘å¬çº¿ç¨‹ä¼šä»tomcatçš„çº¿ç¨‹æ± ä¸­å–å‡ºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç”¨æˆ·è¯·æ±‚ï¼Œ</p><p>åœ¨æˆ‘ä»¬çš„æœåŠ¡éƒ¨ç½²åˆ°tomcatåï¼Œçº¿ç¨‹ä¼šæ‰¾åˆ°ç”¨æˆ·æƒ³è¦è®¿é—®çš„å·¥ç¨‹ï¼Œç„¶åç”¨è¿™ä¸ªçº¿ç¨‹è½¬å‘åˆ°å·¥ç¨‹ä¸­çš„controllerï¼Œserviceï¼Œdaoä¸­ï¼Œå¹¶ä¸”è®¿é—®å¯¹åº”çš„DBï¼Œåœ¨ç”¨æˆ·æ‰§è¡Œå®Œè¯·æ±‚åï¼Œå†ç»Ÿä¸€è¿”å›ï¼Œå†æ‰¾åˆ°tomcatç«¯çš„socketï¼Œå†å°†æ•°æ®å†™å›åˆ°ç”¨æˆ·ç«¯çš„socketï¼Œå®Œæˆè¯·æ±‚å’Œå“åº”</p><p>é€šè¿‡ä»¥ä¸Šè®²è§£ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ æ¯ä¸ªç”¨æˆ·å…¶å®å¯¹åº”éƒ½æ˜¯å»æ‰¾tomcatçº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆå·¥ä½œçš„ï¼Œ ä½¿ç”¨å®Œæˆåå†è¿›è¡Œå›æ”¶ï¼Œæ—¢ç„¶æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥åœ¨æ¯ä¸ªç”¨æˆ·å»è®¿é—®æˆ‘ä»¬çš„å·¥ç¨‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨threadlocalæ¥åšåˆ°çº¿ç¨‹éš”ç¦»ï¼Œæ¯ä¸ªçº¿ç¨‹æ“ä½œè‡ªå·±çš„ä¸€ä»½æ•°æ®</p><blockquote><p><strong>æ¸©é¦¨å°è´´å£«ï¼šå…³äºthreadlocal</strong></p></blockquote><p>å¦‚æœå°ä¼™ä¼´ä»¬çœ‹è¿‡threadLocalçš„æºç ï¼Œä½ ä¼šå‘ç°åœ¨threadLocalä¸­ï¼Œæ— è®ºæ˜¯ä»–çš„putæ–¹æ³•å’Œä»–çš„getæ–¹æ³•ï¼Œ éƒ½æ˜¯å…ˆä»è·å¾—å½“å‰ç”¨æˆ·çš„çº¿ç¨‹ï¼Œç„¶åä»çº¿ç¨‹ä¸­å–å‡ºçº¿ç¨‹çš„æˆå‘˜å˜é‡mapï¼Œåªè¦çº¿ç¨‹ä¸ä¸€æ ·ï¼Œmapå°±ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥åšåˆ°çº¿ç¨‹éš”ç¦»</p><p><img src="https://s1.vika.cn/space/2023/03/25/89334cb1e2564d44ba78df13338bb732" alt="1653068874258"></p><p>æ‹¦æˆªå™¨ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="comment">//1.è·å–session</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="comment">//2.è·å–sessionä¸­çš„ç”¨æˆ·</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="comment">//3.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">              <span class="comment">//4.ä¸å­˜åœ¨ï¼Œæ‹¦æˆªï¼Œè¿”å›401çŠ¶æ€ç </span></span><br><span class="line">              response.setStatus(<span class="number">401</span>);</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//5.å­˜åœ¨ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°Threadlocal</span></span><br><span class="line">        UserHolder.saveUser((User)user);</span><br><span class="line">        <span class="comment">//6.æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æ‹¦æˆªå™¨ç”Ÿæ•ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// ç™»å½•æ‹¦æˆªå™¨</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">                .excludePathPatterns(</span><br><span class="line">                        <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/voucher/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop-type/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/upload/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/login&quot;</span></span><br><span class="line">                ).order(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// tokenåˆ·æ–°çš„æ‹¦æˆªå™¨</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">RefreshTokenInterceptor</span>(stringRedisTemplate)).addPathPatterns(<span class="string">&quot;/**&quot;</span>).order(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="yin-cang-yong-hu-min-gan-xin-xi" id="éšè—ç”¨æˆ·æ•æ„Ÿä¿¡æ¯">éšè—ç”¨æˆ·æ•æ„Ÿä¿¡æ¯</h3><p>æˆ‘ä»¬é€šè¿‡æµè§ˆå™¨è§‚å¯Ÿåˆ°æ­¤æ—¶ç”¨æˆ·çš„å…¨éƒ¨ä¿¡æ¯éƒ½åœ¨ï¼Œè¿™æ ·æä¸ºä¸é è°±ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“åœ¨è¿”å›ç”¨æˆ·ä¿¡æ¯ä¹‹å‰ï¼Œå°†ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯è¿›è¡Œéšè—ï¼Œé‡‡ç”¨çš„æ ¸å¿ƒæ€è·¯å°±æ˜¯ä¹¦å†™ä¸€ä¸ªUserDtoå¯¹è±¡ï¼Œè¿™ä¸ªUserDtoå¯¹è±¡å°±æ²¡æœ‰æ•æ„Ÿä¿¡æ¯äº†ï¼Œæˆ‘ä»¬åœ¨è¿”å›å‰ï¼Œå°†æœ‰ç”¨æˆ·æ•æ„Ÿä¿¡æ¯çš„Userå¯¹è±¡è½¬åŒ–æˆæ²¡æœ‰æ•æ„Ÿä¿¡æ¯çš„UserDtoå¯¹è±¡ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿé¿å…è¿™ä¸ªå°´å°¬çš„é—®é¢˜äº†</p><p><strong>åœ¨ç™»å½•æ–¹æ³•å¤„ä¿®æ”¹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//7.ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°sessionä¸­</span></span><br><span class="line">session.setAttribute(<span class="string">&quot;user&quot;</span>, BeanUtils.copyProperties(user,UserDTO.class));</span><br></pre></td></tr></table></figure><p><strong>åœ¨æ‹¦æˆªå™¨å¤„ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//5.å­˜åœ¨ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°Threadlocal</span></span><br><span class="line">UserHolder.saveUser((UserDTO) user);</span><br></pre></td></tr></table></figure><p><strong>åœ¨UserHolderå¤„ï¼šå°†userå¯¹è±¡æ¢æˆUserDTO</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserHolder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;UserDTO&gt; tl = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(UserDTO user)</span>&#123;</span><br><span class="line">        tl.set(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserDTO <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tl.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeUser</span><span class="params">()</span>&#123;</span><br><span class="line">        tl.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="session-gong-xiang-wen-ti" id="sessionå…±äº«é—®é¢˜">sessionå…±äº«é—®é¢˜</h3><p><strong>æ ¸å¿ƒæ€è·¯åˆ†æï¼š</strong></p><p>æ¯ä¸ªtomcatä¸­éƒ½æœ‰ä¸€ä»½å±äºè‡ªå·±çš„session,å‡è®¾ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ç¬¬ä¸€å°tomcatï¼Œå¹¶ä¸”æŠŠè‡ªå·±çš„ä¿¡æ¯å­˜æ”¾åˆ°ç¬¬ä¸€å°æœåŠ¡å™¨çš„sessionä¸­ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡è¿™ä¸ªç”¨æˆ·è®¿é—®åˆ°äº†ç¬¬äºŒå°tomcatï¼Œé‚£ä¹ˆåœ¨ç¬¬äºŒå°æœåŠ¡å™¨ä¸Šï¼Œè‚¯å®šæ²¡æœ‰ç¬¬ä¸€å°æœåŠ¡å™¨å­˜æ”¾çš„sessionï¼Œæ‰€ä»¥æ­¤æ—¶ æ•´ä¸ªç™»å½•æ‹¦æˆªåŠŸèƒ½å°±ä¼šå‡ºç°é—®é¢˜ï¼Œæˆ‘ä»¬èƒ½å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæ—©æœŸçš„æ–¹æ¡ˆæ˜¯sessionæ‹·è´ï¼Œå°±æ˜¯è¯´è™½ç„¶æ¯ä¸ªtomcatä¸Šéƒ½æœ‰ä¸åŒçš„sessionï¼Œä½†æ˜¯æ¯å½“ä»»æ„ä¸€å°æœåŠ¡å™¨çš„sessionä¿®æ”¹æ—¶ï¼Œéƒ½ä¼šåŒæ­¥ç»™å…¶ä»–çš„TomcatæœåŠ¡å™¨çš„sessionï¼Œè¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥å®ç°sessionçš„å…±äº«äº†</p><p>ä½†æ˜¯è¿™ç§æ–¹æ¡ˆå…·æœ‰ä¸¤ä¸ªå¤§é—®é¢˜</p><p>1ã€æ¯å°æœåŠ¡å™¨ä¸­éƒ½æœ‰å®Œæ•´çš„ä¸€ä»½sessionæ•°æ®ï¼ŒæœåŠ¡å™¨å‹åŠ›è¿‡å¤§ã€‚</p><p>2ã€sessionæ‹·è´æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å»¶è¿Ÿ</p><p>æ‰€ä»¥å’±ä»¬åæ¥é‡‡ç”¨çš„æ–¹æ¡ˆéƒ½æ˜¯åŸºäºredisæ¥å®Œæˆï¼Œæˆ‘ä»¬æŠŠsessionæ¢æˆredisï¼Œredisæ•°æ®æœ¬èº«å°±æ˜¯å…±äº«çš„ï¼Œå°±å¯ä»¥é¿å…sessionå…±äº«çš„é—®é¢˜äº†</p><p><img src="https://s1.vika.cn/space/2023/03/25/7c30e358bb1f494796114e296bde943b" alt="1653069893050"></p><h2 id="redis-dai-ti-session-de-ye-wu-liu-cheng" id="Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹">Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹</h2><h3 id="she-ji-key-de-jie-gou" id="è®¾è®¡keyçš„ç»“æ„">è®¾è®¡keyçš„ç»“æ„</h3><p>é¦–å…ˆæˆ‘ä»¬è¦æ€è€ƒä¸€ä¸‹åˆ©ç”¨redisæ¥å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆåˆ°åº•ä½¿ç”¨å“ªç§ç»“æ„å‘¢ï¼Ÿç”±äºå­˜å…¥çš„æ•°æ®æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨Stringï¼Œæˆ–è€…æ˜¯ä½¿ç”¨å“ˆå¸Œï¼Œå¦‚ä¸‹å›¾ï¼Œå¦‚æœä½¿ç”¨Stringï¼ŒåŒå­¦ä»¬æ³¨æ„ä»–çš„valueï¼Œç”¨å¤šå ç”¨ä¸€ç‚¹ç©ºé—´ï¼Œå¦‚æœä½¿ç”¨å“ˆå¸Œï¼Œåˆ™ä»–çš„valueä¸­åªä¼šå­˜å‚¨ä»–æ•°æ®æœ¬èº«ï¼Œå¦‚æœä¸æ˜¯ç‰¹åˆ«åœ¨æ„å†…å­˜ï¼Œå…¶å®ä½¿ç”¨Stringå°±å¯ä»¥å•¦ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/25/f943cb63bc194d0491d8b231ad98410a" alt="1653319261433"></p><h3 id="she-ji-key-de-ju-ti-xi-jie" id="è®¾è®¡keyçš„å…·ä½“ç»†èŠ‚">è®¾è®¡keyçš„å…·ä½“ç»†èŠ‚</h3><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Stringç»“æ„ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„keyï¼Œvalueé”®å€¼å¯¹çš„æ–¹å¼ï¼Œä½†æ˜¯å…³äºkeyçš„å¤„ç†ï¼Œsessionä»–æ˜¯æ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„sessionï¼Œä½†æ˜¯redisçš„keyæ˜¯å…±äº«çš„ï¼Œå’±ä»¬å°±ä¸èƒ½ä½¿ç”¨codeäº†</p><p>åœ¨è®¾è®¡è¿™ä¸ªkeyçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹‹å‰è®²è¿‡éœ€è¦æ»¡è¶³ä¸¤ç‚¹</p><p>1ã€keyè¦å…·æœ‰å”¯ä¸€æ€§</p><p>2ã€keyè¦æ–¹ä¾¿æºå¸¦</p><p>å¦‚æœæˆ‘ä»¬é‡‡ç”¨phoneï¼šæ‰‹æœºå·è¿™ä¸ªçš„æ•°æ®æ¥å­˜å‚¨å½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å¦‚æœæŠŠè¿™æ ·çš„æ•æ„Ÿæ•°æ®å­˜å‚¨åˆ°redisä¸­å¹¶ä¸”ä»é¡µé¢ä¸­å¸¦è¿‡æ¥æ¯•ç«Ÿä¸å¤ªåˆé€‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åå°ç”Ÿæˆä¸€ä¸ªéšæœºä¸²tokenï¼Œç„¶åè®©å‰ç«¯å¸¦æ¥è¿™ä¸ªtokenå°±èƒ½å®Œæˆæˆ‘ä»¬çš„æ•´ä½“é€»è¾‘äº†</p><h3 id="zheng-ti-fang-wen-liu-cheng" id="æ•´ä½“è®¿é—®æµç¨‹">æ•´ä½“è®¿é—®æµç¨‹</h3><p>å½“æ³¨å†Œå®Œæˆåï¼Œç”¨æˆ·å»ç™»å½•ä¼šå»æ ¡éªŒç”¨æˆ·æäº¤çš„æ‰‹æœºå·å’ŒéªŒè¯ç ï¼Œæ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œä¸å­˜åœ¨åˆ™æ–°å»ºï¼Œæœ€åå°†ç”¨æˆ·æ•°æ®ä¿å­˜åˆ°redisï¼Œå¹¶ä¸”ç”Ÿæˆtokenä½œä¸ºredisçš„keyï¼Œå½“æˆ‘ä»¬æ ¡éªŒç”¨æˆ·æ˜¯å¦ç™»å½•æ—¶ï¼Œä¼šå»æºå¸¦ç€tokenè¿›è¡Œè®¿é—®ï¼Œä»redisä¸­å–å‡ºtokenå¯¹åº”çš„valueï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ‹¦æˆªï¼Œå¦‚æœå­˜åœ¨åˆ™å°†å…¶ä¿å­˜åˆ°threadLocalä¸­ï¼Œå¹¶ä¸”æ”¾è¡Œã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/25/9d48300a79544feda9a48e543626b0c3" alt="1653319474181"></p><h2 id="ji-yu-redis-shi-xian-duan-xin-deng-lu" id="åŸºäºRediså®ç°çŸ­ä¿¡ç™»å½•">åŸºäºRediså®ç°çŸ­ä¿¡ç™»å½•</h2><p>è¿™é‡Œå…·ä½“é€»è¾‘å°±ä¸åˆ†æäº†ï¼Œä¹‹å‰å’±ä»¬å·²ç»é‡ç‚¹åˆ†æè¿‡è¿™ä¸ªé€»è¾‘å•¦ã€‚</p><p><strong>LoginIntercepterä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginInterceptor</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1. è·å–è¯·æ±‚å¤´ä¸­çš„token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(token)) &#123;</span><br><span class="line">            <span class="comment">// ä¸å­˜åœ¨ï¼Œæ‹¦æˆªï¼Œè¿”å›401çŠ¶æ€ç </span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2. åŸºäºtokenè·å–redisä¸­çš„ç”¨æˆ·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstants.LOGIN_USER_KEY + token;</span><br><span class="line">        Map&lt;Object, Object&gt; userMap = stringRedisTemplate.opsForHash()</span><br><span class="line">                .entries(key);</span><br><span class="line">        <span class="comment">// 3. åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(userMap.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// 4. ä¸å­˜åœ¨ï¼Œæ‹¦æˆª, è¿”å›401</span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5. å°†æŸ¥è¯¢åˆ°çš„Hashæ•°æ®è½¬ä¸ºUserDTOå¯¹è±¡</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(userMap, <span class="keyword">new</span> <span class="title class_">UserDTO</span>(), <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 6. å­˜åœ¨ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°ThreadLocal</span></span><br><span class="line">        UserHolder.saveUser(userDTO);</span><br><span class="line">        <span class="comment">// 7. åˆ·æ–°toeknæœ‰æ•ˆæœŸ</span></span><br><span class="line">        stringRedisTemplate.expire(key, RedisConstants.LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">// 8. æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// ç§»é™¤ç”¨æˆ·</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>UserServiceImplä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> loginForm.getPhone();</span><br><span class="line">    <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line">        <span class="comment">// 2.å¦‚æœä¸ç¬¦åˆï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.ä»redisè·å–éªŒè¯ç å¹¶æ ¡éªŒ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">cacheCode</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(LOGIN_CODE_KEY + phone);</span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> loginForm.getCode();</span><br><span class="line">    <span class="keyword">if</span> (cacheCode == <span class="literal">null</span> || !cacheCode.equals(code)) &#123;</span><br><span class="line">        <span class="comment">// ä¸ä¸€è‡´ï¼ŒæŠ¥é”™</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.ä¸€è‡´ï¼Œæ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ· select * from tb_user where phone = ?</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> query().eq(<span class="string">&quot;phone&quot;</span>, phone).one();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 6.ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°ç”¨æˆ·å¹¶ä¿å­˜</span></span><br><span class="line">        user = createUserWithPhone(phone);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7.ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° redisä¸­</span></span><br><span class="line">    <span class="comment">// 7.1.éšæœºç”Ÿæˆtokenï¼Œä½œä¸ºç™»å½•ä»¤ç‰Œ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> UUID.randomUUID().toString(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// 7.2.å°†Userå¯¹è±¡è½¬ä¸ºHashMapå­˜å‚¨</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserDTO.class);</span><br><span class="line">    Map&lt;String, Object&gt; userMap = BeanUtil.beanToMap(userDTO, <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(),</span><br><span class="line">            CopyOptions.create()</span><br><span class="line">                    .setIgnoreNullValue(<span class="literal">true</span>)</span><br><span class="line">                    .setFieldValueEditor((fieldName, fieldValue) -&gt; fieldValue.toString()));</span><br><span class="line">    <span class="comment">// 7.3.å­˜å‚¨</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">tokenKey</span> <span class="operator">=</span> LOGIN_USER_KEY + token;</span><br><span class="line">    stringRedisTemplate.opsForHash().putAll(tokenKey, userMap);</span><br><span class="line">    <span class="comment">// 7.4.è®¾ç½®tokenæœ‰æ•ˆæœŸ</span></span><br><span class="line">    stringRedisTemplate.expire(tokenKey, LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8.è¿”å›token</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(token);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="jie-jue-zhuang-tai-deng-lu-shua-xin-wen-ti" id="è§£å†³çŠ¶æ€ç™»å½•åˆ·æ–°é—®é¢˜">è§£å†³çŠ¶æ€ç™»å½•åˆ·æ–°é—®é¢˜</h2><h3 id="chu-shi-fang-an-si-lu-zong-jie" id="åˆå§‹æ–¹æ¡ˆæ€è·¯æ€»ç»“ï¼š">åˆå§‹æ–¹æ¡ˆæ€è·¯æ€»ç»“ï¼š</h3><p>åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œä»–ç¡®å®å¯ä»¥ä½¿ç”¨å¯¹åº”è·¯å¾„çš„æ‹¦æˆªï¼ŒåŒæ—¶åˆ·æ–°ç™»å½•tokenä»¤ç‰Œçš„å­˜æ´»æ—¶é—´ï¼Œä½†æ˜¯ç°åœ¨è¿™ä¸ªæ‹¦æˆªå™¨ä»–åªæ˜¯æ‹¦æˆªéœ€è¦è¢«æ‹¦æˆªçš„è·¯å¾„ï¼Œå‡è®¾å½“å‰ç”¨æˆ·è®¿é—®äº†ä¸€äº›ä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ‹¦æˆªå™¨å°±ä¸ä¼šç”Ÿæ•ˆï¼Œæ‰€ä»¥æ­¤æ—¶ä»¤ç‰Œåˆ·æ–°çš„åŠ¨ä½œå®é™…ä¸Šå°±ä¸ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ¡ˆä»–æ˜¯å­˜åœ¨é—®é¢˜çš„</p><p><img src="https://s1.vika.cn/space/2023/03/25/fa59257f3a9449ddad760383935d9d20" alt="1653320822964"></p><h3 id="you-hua-fang-an" id="ä¼˜åŒ–æ–¹æ¡ˆ">ä¼˜åŒ–æ–¹æ¡ˆ</h3><p>æ—¢ç„¶ä¹‹å‰çš„æ‹¦æˆªå™¨æ— æ³•å¯¹ä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ç”Ÿæ•ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œåœ¨ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ä¸­æ‹¦æˆªæ‰€æœ‰çš„è·¯å¾„ï¼ŒæŠŠç¬¬äºŒä¸ªæ‹¦æˆªå™¨åšçš„äº‹æƒ…æ”¾å…¥åˆ°ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ä¸­ï¼ŒåŒæ—¶åˆ·æ–°ä»¤ç‰Œï¼Œå› ä¸ºç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨æœ‰äº†threadLocalçš„æ•°æ®ï¼Œæ‰€ä»¥æ­¤æ—¶ç¬¬äºŒä¸ªæ‹¦æˆªå™¨åªéœ€è¦åˆ¤æ–­æ‹¦æˆªå™¨ä¸­çš„userå¯¹è±¡æ˜¯å¦å­˜åœ¨å³å¯ï¼Œå®Œæˆæ•´ä½“åˆ·æ–°åŠŸèƒ½ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/25/12f6446c27124c10871acf408cdbb306" alt="1653320764547"></p><h3 id="dai-ma" id="ä»£ç ">ä»£ç </h3><p><strong>RefreshTokenInterceptor</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefreshTokenInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RefreshTokenInterceptor</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–è¯·æ±‚å¤´ä¸­çš„token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(token)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.åŸºäºTOKENè·å–redisä¸­çš„ç”¨æˆ·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span>  <span class="operator">=</span> LOGIN_USER_KEY + token;</span><br><span class="line">        Map&lt;Object, Object&gt; userMap = stringRedisTemplate.opsForHash().entries(key);</span><br><span class="line">        <span class="comment">// 3.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (userMap.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5.å°†æŸ¥è¯¢åˆ°çš„hashæ•°æ®è½¬ä¸ºUserDTO</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(userMap, <span class="keyword">new</span> <span class="title class_">UserDTO</span>(), <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 6.å­˜åœ¨ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° ThreadLocal</span></span><br><span class="line">        UserHolder.saveUser(userDTO);</span><br><span class="line">        <span class="comment">// 7.åˆ·æ–°tokenæœ‰æ•ˆæœŸ</span></span><br><span class="line">        stringRedisTemplate.expire(key, LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">// 8.æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// ç§»é™¤ç”¨æˆ·</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>LoginInterceptor</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1.åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªï¼ˆThreadLocalä¸­æ˜¯å¦æœ‰ç”¨æˆ·ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (UserHolder.getUser() == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰ï¼Œéœ€è¦æ‹¦æˆªï¼Œè®¾ç½®çŠ¶æ€ç </span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="comment">// æ‹¦æˆª</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æœ‰ç”¨æˆ·ï¼Œåˆ™æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="shang-hu-cha-xun-huan-cun">å•†æˆ·æŸ¥è¯¢ç¼“å­˜</h1><h2 id="shi-yao-shi-huan-cun" id="ä»€ä¹ˆæ˜¯ç¼“å­˜">ä»€ä¹ˆæ˜¯ç¼“å­˜?</h2><p><strong>å‰è¨€</strong>:<strong>ä»€ä¹ˆæ˜¯ç¼“å­˜?</strong></p><p>å°±åƒè‡ªè¡Œè½¦,è¶Šé‡è½¦çš„é¿éœ‡å™¨<img src="https://s1.vika.cn/space/2023/03/25/556ab0eda84c4481aa9d95304a331a8d" alt=""></p><p>ä¸¾ä¸ªä¾‹å­:è¶Šé‡è½¦,å±±åœ°è‡ªè¡Œè½¦,éƒ½æ‹¥æœ‰&quot;é¿éœ‡å™¨&quot;,<strong>é˜²æ­¢</strong>è½¦ä½“åŠ é€Ÿåå› æƒ¯æ€§,åœ¨é…·ä¼¼&quot;U&quot;å­—æ¯çš„åœ°å½¢ä¸Šé£è·ƒ,ç¡¬ç€é™†å¯¼è‡´çš„<strong>æŸå®³</strong>,åƒä¸ªå¼¹ç°§ä¸€æ ·;</p><p>åŒæ ·,å®é™…å¼€å‘ä¸­,ç³»ç»Ÿä¹Ÿéœ€è¦&quot;é¿éœ‡å™¨&quot;,é˜²æ­¢è¿‡é«˜çš„æ•°æ®è®¿é—®çŒ›å†²ç³»ç»Ÿ,å¯¼è‡´å…¶æ“ä½œçº¿ç¨‹æ— æ³•åŠæ—¶å¤„ç†ä¿¡æ¯è€Œç˜«ç—ª;</p><p>è¿™åœ¨å®é™…å¼€å‘ä¸­å¯¹ä¼ä¸šè®²,å¯¹äº§å“å£ç¢‘,ç”¨æˆ·è¯„ä»·éƒ½æ˜¯è‡´å‘½çš„;æ‰€ä»¥ä¼ä¸šéå¸¸é‡è§†ç¼“å­˜æŠ€æœ¯;</p><blockquote><p><strong>ç¼“å­˜(<strong>Cache),å°±æ˜¯æ•°æ®äº¤æ¢çš„</strong>ç¼“å†²åŒº</strong>,ä¿—ç§°çš„ç¼“å­˜å°±æ˜¯<strong>ç¼“å†²åŒºå†…çš„æ•°æ®</strong>,ä¸€èˆ¬ä»æ•°æ®åº“ä¸­è·å–,å­˜å‚¨äºæœ¬åœ°ä»£ç (ä¾‹å¦‚:</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä¾‹<span class="number">1</span>:Static <span class="keyword">final</span> ConcurrentHashMap&lt;K,V&gt; map = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(); æœ¬åœ°ç”¨äºé«˜å¹¶å‘</span><br><span class="line"></span><br><span class="line">ä¾‹<span class="number">2</span>:<span class="keyword">static</span> <span class="keyword">final</span> Cache&lt;K,V&gt; USER_CACHE = CacheBuilder.newBuilder().build(); ç”¨äºredisç­‰ç¼“å­˜</span><br><span class="line"></span><br><span class="line">ä¾‹<span class="number">3</span>:Static <span class="keyword">final</span> Map&lt;K,V&gt; map =  <span class="keyword">new</span> <span class="title class_">HashMap</span>(); æœ¬åœ°ç¼“å­˜</span><br></pre></td></tr></table></figure><p>ç”±äºå…¶è¢«<strong>Static</strong>ä¿®é¥°,æ‰€ä»¥éšç€ç±»çš„åŠ è½½è€Œè¢«åŠ è½½åˆ°<strong>å†…å­˜ä¹‹ä¸­</strong>,ä½œä¸ºæœ¬åœ°ç¼“å­˜,ç”±äºå…¶åˆè¢«<strong>final</strong>ä¿®é¥°,æ‰€ä»¥å…¶å¼•ç”¨(ä¾‹3:map)å’Œå¯¹è±¡(ä¾‹3:new HashMap())ä¹‹é—´çš„å…³ç³»æ˜¯å›ºå®šçš„,ä¸èƒ½æ”¹å˜,å› æ­¤ä¸ç”¨æ‹…å¿ƒèµ‹å€¼(=)å¯¼è‡´ç¼“å­˜å¤±æ•ˆ;</p><h3 id="wei-shi-yao-yao-shi-yong-huan-cun" id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¼“å­˜">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¼“å­˜</h3><p>ä¸€å¥è¯:å› ä¸º<strong>é€Ÿåº¦å¿«,å¥½ç”¨</strong></p><p>ç¼“å­˜æ•°æ®å­˜å‚¨äºä»£ç ä¸­,è€Œä»£ç è¿è¡Œåœ¨å†…å­˜ä¸­,å†…å­˜çš„è¯»å†™æ€§èƒ½è¿œé«˜äºç£ç›˜,ç¼“å­˜å¯ä»¥å¤§å¤§é™ä½<strong>ç”¨æˆ·è®¿é—®å¹¶å‘é‡å¸¦æ¥çš„</strong>æœåŠ¡å™¨è¯»å†™å‹åŠ›</p><p>å®é™…å¼€å‘è¿‡ç¨‹ä¸­,ä¼ä¸šçš„æ•°æ®é‡,å°‘åˆ™å‡ åä¸‡,å¤šåˆ™å‡ åƒä¸‡,è¿™ä¹ˆå¤§æ•°æ®é‡,å¦‚æœæ²¡æœ‰ç¼“å­˜æ¥ä½œä¸º&quot;é¿éœ‡å™¨&quot;,ç³»ç»Ÿæ˜¯å‡ ä¹æ’‘ä¸ä½çš„,æ‰€ä»¥ä¼ä¸šä¼šå¤§é‡è¿ç”¨åˆ°ç¼“å­˜æŠ€æœ¯;</p><p>ä½†æ˜¯ç¼“å­˜ä¹Ÿä¼šå¢åŠ ä»£ç å¤æ‚åº¦å’Œè¿è¥çš„æˆæœ¬:</p><p><img src="https://s1.vika.cn/space/2023/03/25/9b86b1a4ebc74b14819aa431967f1aeb" alt=""></p><h3 id="ru-he-shi-yong-huan-cun" id="å¦‚ä½•ä½¿ç”¨ç¼“å­˜">å¦‚ä½•ä½¿ç”¨ç¼“å­˜</h3><p>å®é™…å¼€å‘ä¸­,ä¼šæ„ç­‘å¤šçº§ç¼“å­˜æ¥ä½¿ç³»ç»Ÿè¿è¡Œé€Ÿåº¦è¿›ä¸€æ­¥æå‡,ä¾‹å¦‚:æœ¬åœ°ç¼“å­˜ä¸redisä¸­çš„ç¼“å­˜å¹¶å‘ä½¿ç”¨</p><p><strong>æµè§ˆå™¨ç¼“å­˜</strong>ï¼šä¸»è¦æ˜¯å­˜åœ¨äºæµè§ˆå™¨ç«¯çš„ç¼“å­˜</p><p>**åº”ç”¨å±‚ç¼“å­˜ï¼š**å¯ä»¥åˆ†ä¸ºtomcatæœ¬åœ°ç¼“å­˜ï¼Œæ¯”å¦‚ä¹‹å‰æåˆ°çš„mapï¼Œæˆ–è€…æ˜¯ä½¿ç”¨redisä½œä¸ºç¼“å­˜</p><p>**æ•°æ®åº“ç¼“å­˜ï¼š**åœ¨æ•°æ®åº“ä¸­æœ‰ä¸€ç‰‡ç©ºé—´æ˜¯ buffer poolï¼Œå¢æ”¹æŸ¥æ•°æ®éƒ½ä¼šå…ˆåŠ è½½åˆ°mysqlçš„ç¼“å­˜ä¸­</p><p>**CPUç¼“å­˜ï¼š**å½“ä»£è®¡ç®—æœºæœ€å¤§çš„é—®é¢˜æ˜¯ cpuæ€§èƒ½æå‡äº†ï¼Œä½†å†…å­˜è¯»å†™é€Ÿåº¦æ²¡æœ‰è·Ÿä¸Šï¼Œæ‰€ä»¥ä¸ºäº†é€‚åº”å½“ä¸‹çš„æƒ…å†µï¼Œå¢åŠ äº†cpuçš„L1ï¼ŒL2ï¼ŒL3çº§çš„ç¼“å­˜</p><p><img src="https://s1.vika.cn/space/2023/03/25/cde956517164493a861d0dc9654c3ea8" alt=""></p><h2 id="tian-jia-shang-hu-huan-cun" id="æ·»åŠ å•†æˆ·ç¼“å­˜">æ·»åŠ å•†æˆ·ç¼“å­˜</h2><p>åœ¨æˆ‘ä»¬æŸ¥è¯¢å•†æˆ·ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥æ“ä½œä»æ•°æ®åº“ä¸­å»è¿›è¡ŒæŸ¥è¯¢çš„ï¼Œå¤§è‡´é€»è¾‘æ˜¯è¿™æ ·ï¼Œç›´æ¥æŸ¥è¯¢æ•°æ®åº“é‚£è‚¯å®šæ…¢å’¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¢åŠ ç¼“å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryShopById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//è¿™é‡Œæ˜¯ç›´æ¥æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">    <span class="keyword">return</span> shopService.queryById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="huan-cun-mo-xing-he-si-lu" id="ç¼“å­˜æ¨¡å‹å’Œæ€è·¯">ç¼“å­˜æ¨¡å‹å’Œæ€è·¯</h3><p>æ ‡å‡†çš„æ“ä½œæ–¹å¼å°±æ˜¯æŸ¥è¯¢æ•°æ®åº“ä¹‹å‰å…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜æ•°æ®å­˜åœ¨ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­è¿”å›ï¼Œå¦‚æœç¼“å­˜æ•°æ®ä¸å­˜åœ¨ï¼Œå†æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå°†æ•°æ®å­˜å…¥redisã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/25/5a9477907d55491e9483f14b08a82b91" alt="1653322097736"></p><h3 id="dai-ma-ru-xia" id="ä»£ç å¦‚ä¸‹">ä»£ç å¦‚ä¸‹</h3><p>ä»£ç æ€è·¯ï¼šå¦‚æœç¼“å­˜æœ‰ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå­˜å…¥redisã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/25/d4955de60ea64d16b76c44d02519a6b6" alt="1653322190155"></p><h3 id="chen-re-da-tie" id="è¶çƒ­æ‰“é“">è¶çƒ­æ‰“é“</h3><ul><li>å®Œæˆäº†å•†æˆ·ç¼“å­˜ï¼Œä¸‹é¢å®ç°å•†æˆ·ç±»å‹ç¼“å­˜ï¼ˆä½¿ç”¨Listï¼‰</li></ul><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">ShopTypeController</button></li><li class="tab"><button type="button" data-href="#test4-2">IShopTypeService</button></li><li class="tab"><button type="button" data-href="#test4-3">ShopTypeServiceImpl</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryTypeList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> typeService.listShopTypes();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Result <span class="title function_">listShopTypes</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">listShopTypes</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1. ä»redisä¸­æŸ¥è¯¢å•†é“ºç±»å‹ç¼“å­˜</span></span><br><span class="line">    List&lt;String&gt; lists = stringRedisTemplate.opsForList().range(CACHE_SHOPTYPE_KEY, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 2. å­˜åœ¨ï¼Œåˆ™è¿”å›æ•°æ®</span></span><br><span class="line">    <span class="keyword">if</span>(!lists.isEmpty()) &#123;</span><br><span class="line">        List&lt;ShopType&gt; shopTypeList = lists.stream().map((item) -&gt; &#123;</span><br><span class="line">            <span class="type">ShopType</span> <span class="variable">shopType</span> <span class="operator">=</span> JSONUtil.toBean(item, ShopType.class);</span><br><span class="line">            <span class="keyword">return</span> shopType;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> Result.ok(shopTypeList);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. ä¸å­˜åœ¨ï¼ŒæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">    List&lt;ShopType&gt; shopTypeList = list();</span><br><span class="line">    <span class="keyword">if</span>(shopTypeList == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;å•†é“ºç±»å‹ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. å†™å…¥redis</span></span><br><span class="line">    List&lt;String&gt; shopJsonList = shopTypeList.stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> JSONUtil.toJsonStr(item);</span><br><span class="line">        <span class="keyword">return</span> shopJson;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    stringRedisTemplate.opsForList().leftPushAll(CACHE_SHOPTYPE_KEY, shopJsonList);</span><br><span class="line">    <span class="comment">// 5. è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(shopTypeList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="huan-cun-geng-xin-ce-lue" id="ç¼“å­˜æ›´æ–°ç­–ç•¥">ç¼“å­˜æ›´æ–°ç­–ç•¥</h2><p>ç¼“å­˜æ›´æ–°æ˜¯redisä¸ºäº†èŠ‚çº¦å†…å­˜è€Œè®¾è®¡å‡ºæ¥çš„ä¸€ä¸ªä¸œè¥¿ï¼Œä¸»è¦æ˜¯å› ä¸ºå†…å­˜æ•°æ®å®è´µï¼Œå½“æˆ‘ä»¬å‘redisæ’å…¥å¤ªå¤šæ•°æ®ï¼Œæ­¤æ—¶å°±å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®è¿‡å¤šï¼Œæ‰€ä»¥redisä¼šå¯¹éƒ¨åˆ†æ•°æ®è¿›è¡Œæ›´æ–°ï¼Œæˆ–è€…æŠŠä»–å«ä¸ºæ·˜æ±°æ›´åˆé€‚ã€‚</p><p>**å†…å­˜æ·˜æ±°ï¼š**redisè‡ªåŠ¨è¿›è¡Œï¼Œå½“rediså†…å­˜è¾¾åˆ°å’±ä»¬è®¾å®šçš„max-memeryçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è§¦å‘æ·˜æ±°æœºåˆ¶ï¼Œæ·˜æ±°æ‰ä¸€äº›ä¸é‡è¦çš„æ•°æ®(å¯ä»¥è‡ªå·±è®¾ç½®ç­–ç•¥æ–¹å¼)</p><p>**è¶…æ—¶å‰”é™¤ï¼š**å½“æˆ‘ä»¬ç»™redisè®¾ç½®äº†è¿‡æœŸæ—¶é—´ttlä¹‹åï¼Œredisä¼šå°†è¶…æ—¶çš„æ•°æ®è¿›è¡Œåˆ é™¤ï¼Œæ–¹ä¾¿å’±ä»¬ç»§ç»­ä½¿ç”¨ç¼“å­˜</p><p>**ä¸»åŠ¨æ›´æ–°ï¼š**æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è°ƒç”¨æ–¹æ³•æŠŠç¼“å­˜åˆ æ‰ï¼Œé€šå¸¸ç”¨äºè§£å†³ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´é—®é¢˜</p><p><img src="https://s1.vika.cn/space/2023/03/25/ac97f027923740d6b8c04fcebc089c96" alt="1653322506393"></p><h3 id="shu-ju-ku-huan-cun-bu-yi-zhi-jie-jue-fang-an" id="æ•°æ®åº“ç¼“å­˜ä¸ä¸€è‡´è§£å†³æ–¹æ¡ˆï¼š">æ•°æ®åº“ç¼“å­˜ä¸ä¸€è‡´è§£å†³æ–¹æ¡ˆï¼š</h3><p>ç”±äºæˆ‘ä»¬çš„<strong>ç¼“å­˜çš„æ•°æ®æºæ¥è‡ªäºæ•°æ®åº“</strong>,è€Œæ•°æ®åº“çš„<strong>æ•°æ®æ˜¯ä¼šå‘ç”Ÿå˜åŒ–çš„</strong>,å› æ­¤,å¦‚æœå½“æ•°æ®åº“ä¸­<strong>æ•°æ®å‘ç”Ÿå˜åŒ–,è€Œç¼“å­˜å´æ²¡æœ‰åŒæ­¥</strong>,æ­¤æ—¶å°±ä¼šæœ‰<strong>ä¸€è‡´æ€§é—®é¢˜å­˜åœ¨</strong>,</p><ul><li><p>å…¶åæœæ˜¯:ç”¨æˆ·ä½¿ç”¨ç¼“å­˜ä¸­çš„è¿‡æ—¶æ•°æ®,å°±ä¼šäº§ç”Ÿç±»ä¼¼å¤šçº¿ç¨‹æ•°æ®å®‰å…¨é—®é¢˜,ä»è€Œå½±å“ä¸šåŠ¡,äº§å“å£ç¢‘ç­‰;</p></li><li><p>æ€ä¹ˆè§£å†³å‘¢ï¼Ÿæœ‰å¦‚ä¸‹å‡ ç§æ–¹æ¡ˆ</p></li><li><ol><li>Cache Aside Pattern äººå·¥ç¼–ç æ–¹å¼ï¼šç¼“å­˜è°ƒç”¨è€…åœ¨æ›´æ–°å®Œæ•°æ®åº“åå†å»æ›´æ–°ç¼“å­˜ï¼Œä¹Ÿç§°ä¹‹ä¸ºåŒå†™æ–¹æ¡ˆ</li><li>Read/Write Through Pattern : ç”±ç³»ç»Ÿæœ¬èº«å®Œæˆï¼Œæ•°æ®åº“ä¸ç¼“å­˜çš„é—®é¢˜äº¤ç”±ç³»ç»Ÿæœ¬èº«å»å¤„ç†</li><li>Write Behind Caching Pattern ï¼šè°ƒç”¨è€…åªæ“ä½œç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹å»å¼‚æ­¥å¤„ç†æ•°æ®åº“ï¼Œå®ç°æœ€ç»ˆä¸€è‡´</li></ol></li></ul><h3 id="shu-ju-ku-he-huan-cun-bu-yi-zhi-cai-yong-shi-yao-fang-an" id="æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´é‡‡ç”¨ä»€ä¹ˆæ–¹æ¡ˆ">æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´é‡‡ç”¨ä»€ä¹ˆæ–¹æ¡ˆ</h3><p>ç»¼åˆè€ƒè™‘ä½¿ç”¨æ–¹æ¡ˆä¸€ï¼Œä½†æ˜¯æ–¹æ¡ˆä¸€è°ƒç”¨è€…å¦‚ä½•å¤„ç†å‘¢ï¼Ÿè¿™é‡Œæœ‰å‡ ä¸ªé—®é¢˜</p><p>æ“ä½œç¼“å­˜å’Œæ•°æ®åº“æ—¶æœ‰<strong>ä¸‰ä¸ªé—®é¢˜</strong>éœ€è¦è€ƒè™‘ï¼š</p><p><strong>å¦‚æœé‡‡ç”¨ç¬¬ä¸€ä¸ªæ–¹æ¡ˆï¼Œ</strong></p><ul><li>é‚£ä¹ˆå‡è®¾æˆ‘ä»¬æ¯æ¬¡æ“ä½œæ•°æ®åº“åï¼Œéƒ½æ“ä½œç¼“å­˜ï¼Œä½†æ˜¯ä¸­é—´å¦‚æœæ²¡æœ‰äººæŸ¥è¯¢ï¼Œé‚£ä¹ˆè¿™ä¸ªæ›´æ–°åŠ¨ä½œå®é™…ä¸Šåªæœ‰æœ€åä¸€æ¬¡ç”Ÿæ•ˆï¼Œä¸­é—´çš„æ›´æ–°åŠ¨ä½œæ„ä¹‰å¹¶ä¸å¤§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç¼“å­˜åˆ é™¤ï¼Œç­‰å¾…å†æ¬¡æŸ¥è¯¢æ—¶ï¼Œå°†ç¼“å­˜ä¸­çš„æ•°æ®åŠ è½½å‡ºæ¥</li></ul><ol><li><p>åˆ é™¤ç¼“å­˜è¿˜æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ</p><ul><li><p>æ›´æ–°ç¼“å­˜ï¼šæ¯æ¬¡æ›´æ–°æ•°æ®åº“éƒ½æ›´æ–°ç¼“å­˜ï¼Œæ— æ•ˆå†™æ“ä½œè¾ƒå¤š</p></li><li><p>åˆ é™¤ç¼“å­˜ï¼šæ›´æ–°æ•°æ®åº“æ—¶è®©ç¼“å­˜å¤±æ•ˆï¼ŒæŸ¥è¯¢æ—¶å†æ›´æ–°ç¼“å­˜</p></li></ul></li><li><p>å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“çš„æ“ä½œçš„åŒæ—¶æˆåŠŸæˆ–å¤±è´¥ï¼Ÿ</p><ul><li><p>å•ä½“ç³»ç»Ÿï¼Œå°†ç¼“å­˜ä¸æ•°æ®åº“æ“ä½œæ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡</p></li><li><p>åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåˆ©ç”¨TCCç­‰åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ</p></li></ul></li></ol><ul><li>åº”è¯¥å…·ä½“æ“ä½œç¼“å­˜è¿˜æ˜¯æ“ä½œæ•°æ®åº“ï¼Œæˆ‘ä»¬åº”å½“æ˜¯<strong>å…ˆæ“ä½œæ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</strong>ï¼Œ</li><li>åŸå› åœ¨äºï¼Œå¦‚æœä½ é€‰æ‹©ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œåœ¨ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘æ¥è®¿é—®æ—¶ï¼Œå‡è®¾çº¿ç¨‹1å…ˆæ¥ï¼Œä»–å…ˆæŠŠç¼“å­˜åˆ äº†ï¼Œæ­¤æ—¶çº¿ç¨‹2è¿‡æ¥ï¼Œä»–æŸ¥è¯¢ç¼“å­˜æ•°æ®å¹¶ä¸å­˜åœ¨ï¼Œæ­¤æ—¶ä»–å†™å…¥ç¼“å­˜ï¼Œ</li><li>å½“ä»–å†™å…¥ç¼“å­˜åï¼Œçº¿ç¨‹1å†æ‰§è¡Œæ›´æ–°åŠ¨ä½œæ—¶ï¼Œå®é™…ä¸Šå†™å…¥çš„å°±æ˜¯æ—§çš„æ•°æ®ï¼Œæ–°çš„æ•°æ®è¢«æ—§æ•°æ®è¦†ç›–äº†ã€‚</li></ul><ol start="3"><li><p>å…ˆæ“ä½œç¼“å­˜è¿˜æ˜¯å…ˆæ“ä½œæ•°æ®åº“ï¼Ÿ</p><ul><li><p>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ“ä½œæ•°æ®åº“</p></li><li><p>å…ˆæ“ä½œæ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</p></li></ul></li></ol><p><img src="https://s1.vika.cn/space/2023/03/25/e9abca4a745f4c0e848313334450a960" alt="1653323595206"></p><h3 id="huan-cun-geng-xin-de-zui-jia-shi-jian-fang-an" id="ç¼“å­˜æ›´æ–°çš„æœ€ä½³å®è·µæ–¹æ¡ˆ">ç¼“å­˜æ›´æ–°çš„æœ€ä½³å®è·µæ–¹æ¡ˆ</h3><ol><li>ä½ä¸€è‡´æ€§éœ€æ±‚ï¼šä½¿ç”¨Redisè‡ªå¸¦çš„å†…å­˜æ·˜æ±°æœºåˆ¶</li><li>é«˜ä¸€è‡´æ€§éœ€æ±‚ï¼šä¸»åŠ¨æ›´æ–°ï¼Œå¹¶ä»¥è¶…æ—¶å‰”é™¤ä½œä¸ºå…œåº•æ–¹æ¡ˆ<ul><li>è¯»æ“ä½œï¼š<ul><li>ç¼“å­˜å‘½ä¸­åˆ™ç›´æ¥è¿”å›</li><li>ç¼“å­˜æœªå‘½ä¸­åˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå¹¶å†™å…¥ç¼“å­˜ï¼Œè®¾å®šè¶…æ—¶æ—¶é—´</li></ul></li><li>å†™æ“ä½œ<ul><li>å…ˆå†™æ•°æ®åº“ï¼Œç„¶åå†åˆ é™¤ç¼“å­˜</li><li>è¦ç¡®ä¿æ•°æ®åº“ä¸ç¼“å­˜æ“ä½œçš„åŸå­æ€§</li></ul></li></ul></li></ol><h2 id="shi-xian-shang-pu-he-huan-cun-yu-shu-ju-ku-shuang-xie-yi-zhi" id="å®ç°å•†é“ºå’Œç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´">å®ç°å•†é“ºå’Œç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´</h2><p>æ ¸å¿ƒæ€è·¯å¦‚ä¸‹ï¼š</p><blockquote><p>ä¿®æ”¹ShopControllerä¸­çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ»¡è¶³ä¸‹é¢çš„éœ€æ±‚ï¼š</p><ul><li><p>æ ¹æ®idæŸ¥è¯¢åº—é“ºæ—¶ï¼Œå¦‚æœç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå°†æ•°æ®åº“ç»“æœå†™å…¥ç¼“å­˜ï¼Œå¹¶è®¾ç½®è¶…æ—¶æ—¶é—´</p></li><li><p>æ ¹æ®idä¿®æ”¹åº—é“ºæ—¶ï¼Œå…ˆä¿®æ”¹æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</p></li></ul></blockquote><div class="tabs" id="test"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test-1">ShopController</button></li><li class="tab"><button type="button" data-href="#test-2">ShopServiceImpl</button></li><li class="tab"><button type="button" data-href="#test-3">PostManæµ‹è¯•ç¤ºä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">updateShop</span><span class="params">(<span class="meta">@RequestBody</span> Shop shop)</span> &#123;</span><br><span class="line">    <span class="comment">// å†™å…¥æ•°æ®åº“</span></span><br><span class="line">    <span class="keyword">return</span> shopService.update(shop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(Shop shop)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> shop.getId();</span><br><span class="line">    <span class="keyword">if</span>(id == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº—é“ºidä¸èƒ½ä¸ºç©º&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1. æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">    updateById(shop);</span><br><span class="line">    <span class="comment">// 2. åˆ é™¤ç¼“å­˜</span></span><br><span class="line">    stringRedisTemplate.delete(CACHE_SHOP_KEY + shop.getId());</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test-3"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;area&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¤§å…³&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;openHours&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10:10-22:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sold&quot;</span><span class="punctuation">:</span> <span class="number">4215</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;äº¬åè·¯é”¦æ˜Œæ–‡åè‹‘29å·&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;comments&quot;</span><span class="punctuation">:</span> <span class="number">3035</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;avgPrice&quot;</span><span class="punctuation">:</span> <span class="number">80</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span> <span class="number">37</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;102èŒ¶é¤å…&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;typeId&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>ä»£ç åˆ†æï¼šé€šè¿‡ä¹‹å‰çš„æ·˜æ±°ï¼Œæˆ‘ä»¬ç¡®å®šäº†é‡‡ç”¨åˆ é™¤ç­–ç•¥ï¼Œæ¥è§£å†³åŒå†™é—®é¢˜ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹äº†æ•°æ®ä¹‹åï¼Œç„¶åæŠŠç¼“å­˜ä¸­çš„æ•°æ®è¿›è¡Œåˆ é™¤ï¼ŒæŸ¥è¯¢æ—¶å‘ç°ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™ä¼šä»mysqlä¸­åŠ è½½æœ€æ–°çš„æ•°æ®ï¼Œä»è€Œé¿å…æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜</p><h2 id="huan-cun-chuan-tou-wen-ti-de-jie-jue-si-lu" id="ç¼“å­˜ç©¿é€é—®é¢˜çš„è§£å†³æ€è·¯">ç¼“å­˜ç©¿é€é—®é¢˜çš„è§£å†³æ€è·¯</h2><blockquote><p>ç¼“å­˜ç©¿é€ ï¼šç¼“å­˜ç©¿é€æ˜¯æŒ‡å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­å’Œæ•°æ®åº“ä¸­éƒ½ä¸å­˜åœ¨ï¼Œè¿™æ ·ç¼“å­˜æ°¸è¿œä¸ä¼šç”Ÿæ•ˆï¼Œè¿™äº›è¯·æ±‚éƒ½ä¼šæ‰“åˆ°æ•°æ®åº“ã€‚</p></blockquote><p>å¸¸è§çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ul><li>ç¼“å­˜ç©ºå¯¹è±¡<ul><li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç»´æŠ¤æ–¹ä¾¿</li><li>ç¼ºç‚¹ï¼š<ul><li>é¢å¤–çš„å†…å­˜æ¶ˆè€—</li><li>å¯èƒ½é€ æˆçŸ­æœŸçš„ä¸ä¸€è‡´</li></ul></li></ul></li><li>å¸ƒéš†è¿‡æ»¤<ul><li>ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨è¾ƒå°‘ï¼Œæ²¡æœ‰å¤šä½™key</li><li>ç¼ºç‚¹ï¼š<ul><li>å®ç°å¤æ‚</li><li>å­˜åœ¨è¯¯åˆ¤å¯èƒ½</li></ul></li></ul></li></ul><ul><li><p><strong>ç¼“å­˜ç©ºå¯¹è±¡æ€è·¯åˆ†æ</strong>ï¼šå½“æˆ‘ä»¬å®¢æˆ·ç«¯è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œå…ˆè¯·æ±‚redisï¼Œä½†æ˜¯æ­¤æ—¶redisä¸­æ²¡æœ‰æ•°æ®ï¼Œæ­¤æ—¶ä¼šè®¿é—®åˆ°æ•°æ®åº“ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®ç©¿é€äº†ç¼“å­˜ï¼Œç›´å‡»æ•°æ®åº“ï¼Œ</p></li><li><p>æˆ‘ä»¬éƒ½çŸ¥é“æ•°æ®åº“èƒ½å¤Ÿæ‰¿è½½çš„å¹¶å‘ä¸å¦‚redisè¿™ä¹ˆé«˜ï¼Œå¦‚æœå¤§é‡çš„è¯·æ±‚åŒæ—¶è¿‡æ¥è®¿é—®è¿™ç§ä¸å­˜åœ¨çš„æ•°æ®ï¼Œè¿™äº›è¯·æ±‚å°±éƒ½ä¼šè®¿é—®åˆ°æ•°æ®åº“ï¼Œ</p></li><li><p>ç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å“ªæ€•è¿™ä¸ªæ•°æ®åœ¨æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¹ŸæŠŠè¿™ä¸ªæ•°æ®å­˜å…¥åˆ°redisä¸­å»ï¼Œè¿™æ ·ï¼Œä¸‹æ¬¡ç”¨æˆ·è¿‡æ¥è®¿é—®è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œé‚£ä¹ˆåœ¨redisä¸­ä¹Ÿèƒ½æ‰¾åˆ°è¿™ä¸ªæ•°æ®å°±ä¸ä¼šè¿›å…¥åˆ°ç¼“å­˜äº†</p></li><li><p><strong>å¸ƒéš†è¿‡æ»¤</strong>ï¼šå¸ƒéš†è¿‡æ»¤å™¨å…¶å®é‡‡ç”¨çš„æ˜¯å“ˆå¸Œæ€æƒ³æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ</p><ul><li>é€šè¿‡ä¸€ä¸ªåºå¤§çš„äºŒè¿›åˆ¶æ•°ç»„ï¼Œèµ°å“ˆå¸Œæ€æƒ³å»åˆ¤æ–­å½“å‰è¿™ä¸ªè¦æŸ¥è¯¢çš„è¿™ä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œ</li><li>å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­å­˜åœ¨ï¼Œåˆ™æ”¾è¡Œï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå»è®¿é—®redisï¼Œå“ªæ€•æ­¤æ—¶redisä¸­çš„æ•°æ®è¿‡æœŸäº†ï¼Œ</li><li>ä½†æ˜¯æ•°æ®åº“ä¸­ä¸€å®šå­˜åœ¨è¿™ä¸ªæ•°æ®ï¼Œåœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥è¿™ä¸ªæ•°æ®åï¼Œå†å°†å…¶æ”¾å…¥åˆ°redisä¸­ï¼Œ</li><li>å‡è®¾å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­è¿™ä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›</li></ul></li></ul><p>è¿™ç§æ–¹å¼ä¼˜ç‚¹åœ¨äºèŠ‚çº¦å†…å­˜ç©ºé—´ï¼Œå­˜åœ¨è¯¯åˆ¤ï¼Œè¯¯åˆ¤åŸå› åœ¨äºï¼šå¸ƒéš†è¿‡æ»¤å™¨èµ°çš„æ˜¯å“ˆå¸Œæ€æƒ³ï¼Œåªè¦æ˜¯å“ˆå¸Œæ€æƒ³ï¼Œå°±å¯èƒ½å­˜åœ¨å“ˆå¸Œå†²çª</p><p><img src="https://s1.vika.cn/space/2023/03/25/4d3ea2011da844e79c8d1325f92760bc" alt="1653326156516"></p><h2 id="bian-ma-jie-jue-shang-pin-cha-xun-de-huan-cun-chuan-tou-wen-ti" id="ç¼–ç è§£å†³å•†å“æŸ¥è¯¢çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼š">ç¼–ç è§£å†³å•†å“æŸ¥è¯¢çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼š</h2><p>æ ¸å¿ƒæ€è·¯å¦‚ä¸‹ï¼š</p><ul><li><p>åœ¨åŸæ¥çš„é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬å¦‚æœå‘ç°è¿™ä¸ªæ•°æ®åœ¨mysqlä¸­ä¸å­˜åœ¨ï¼Œç›´æ¥å°±è¿”å›404äº†ï¼Œè¿™æ ·æ˜¯ä¼šå­˜åœ¨ç¼“å­˜ç©¿é€é—®é¢˜çš„</p></li><li><p>ç°åœ¨çš„é€»è¾‘ä¸­ï¼šå¦‚æœè¿™ä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¸ä¼šè¿”å›404 ï¼Œ</p><ul><li>è¿˜æ˜¯ä¼šæŠŠè¿™ä¸ªæ•°æ®å†™å…¥åˆ°Redisä¸­ï¼Œå¹¶ä¸”å°†valueè®¾ç½®ä¸ºç©ºï¼Œ</li><li>å†æ¬¡å‘èµ·æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬å¦‚æœå‘ç°å‘½ä¸­ä¹‹åï¼Œåˆ¤æ–­è¿™ä¸ªvalueæ˜¯å¦æ˜¯nullï¼Œ</li><li>å¦‚æœæ˜¯nullï¼Œåˆ™æ˜¯ä¹‹å‰å†™å…¥çš„æ•°æ®ï¼Œè¯æ˜æ˜¯ç¼“å­˜ç©¿é€æ•°æ®ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ç›´æ¥è¿”å›æ•°æ®ã€‚</li></ul></li></ul><p><img src="https://s1.vika.cn/space/2023/03/25/f1934e2662eb41cdac4f80e93c2d13b0" alt="1653327124561"></p><p>æ ¸å¿ƒï¼šä¿®æ”¹ShopServiceImplä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> CACHE_SHOP_KEY + id;</span><br><span class="line">    <span class="comment">// 1. ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">// 2. åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isNotBlank(shopJson)) &#123;</span><br><span class="line">        <span class="comment">// 3. å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> JSONUtil.toBean(shopJson, Shop.class);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å‘½ä¸­çš„æ˜¯å¦æ˜¯ç©ºå€¼</span></span><br><span class="line">+    <span class="keyword">if</span>(shopJson != <span class="literal">null</span>) &#123;</span><br><span class="line">+        <span class="comment">// è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">+        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº—é“ºä¿¡æ¯ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">+    &#125;</span><br><span class="line">    <span class="comment">// 4. ä¸å­˜åœ¨ï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">    <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> getById(id);</span><br><span class="line">    <span class="comment">// 5. ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">    <span class="keyword">if</span>(shop == <span class="literal">null</span>) &#123;</span><br><span class="line">+        <span class="comment">// å°†ç©ºå€¼å†™å…¥redis</span></span><br><span class="line">+        stringRedisTemplate.opsForValue().set(key, <span class="string">&quot;&quot;</span>, CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº—é“ºä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 6. å­˜åœ¨ï¼Œå†™å…¥redis</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(shop), CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">    <span class="comment">// 7. è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å°æ€»ç»“ï¼š</strong></p><p>ç¼“å­˜ç©¿é€äº§ç”Ÿçš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>ç”¨æˆ·è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­å’Œæ•°æ®åº“ä¸­éƒ½ä¸å­˜åœ¨ï¼Œä¸æ–­å‘èµ·è¿™æ ·çš„è¯·æ±‚ï¼Œç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§å‹åŠ›</li></ul><p>ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ</p><ul><li>ç¼“å­˜nullå€¼</li><li>å¸ƒéš†è¿‡æ»¤</li><li>å¢å¼ºidçš„å¤æ‚åº¦ï¼Œé¿å…è¢«çŒœæµ‹idè§„å¾‹</li><li>åšå¥½æ•°æ®çš„åŸºç¡€æ ¼å¼æ ¡éªŒ</li><li>åŠ å¼ºç”¨æˆ·æƒé™æ ¡éªŒ</li><li>åšå¥½çƒ­ç‚¹å‚æ•°çš„é™æµ</li></ul><h2 id="huan-cun-xue-beng-wen-ti-ji-jie-jue-si-lu" id="ç¼“å­˜é›ªå´©é—®é¢˜åŠè§£å†³æ€è·¯">ç¼“å­˜é›ªå´©é—®é¢˜åŠè§£å†³æ€è·¯</h2><blockquote><p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨åŒä¸€æ—¶æ®µå¤§é‡çš„ç¼“å­˜keyåŒæ—¶å¤±æ•ˆæˆ–è€…RedisæœåŠ¡å®•æœºï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾æ•°æ®åº“ï¼Œå¸¦æ¥å·¨å¤§å‹åŠ›ã€‚</p></blockquote><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ç»™ä¸åŒçš„Keyçš„TTLæ·»åŠ éšæœºå€¼ï¼Œè®©å…¶åœ¨ä¸åŒæ—¶é—´æ®µåˆ†æ‰¹å¤±æ•ˆ</li><li>åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§ï¼ˆä½¿ç”¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªå“¨å…µ(<code>Sentinel</code>)å®ä¾‹ç»„æˆçš„ç³»ç»Ÿï¼Œå¯¹redisèŠ‚ç‚¹è¿›è¡Œç›‘æ§ï¼Œåœ¨ä¸»èŠ‚ç‚¹å‡ºç°æ•…éšœçš„æƒ…å†µä¸‹ï¼Œèƒ½å°†ä»èŠ‚ç‚¹ä¸­çš„ä¸€ä¸ªå‡çº§ä¸ºä¸»èŠ‚ç‚¹ï¼Œè¿›è¡Œæ•…éšœè½¬ä¹‰ï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚ ï¼‰</li><li>ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥</li><li>ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜ï¼ˆæµè§ˆå™¨è®¿é—®é™æ€èµ„æºæ—¶ï¼Œä¼˜å…ˆè¯»å–æµè§ˆå™¨æœ¬åœ°ç¼“å­˜ï¼›è®¿é—®éé™æ€èµ„æºï¼ˆajaxæŸ¥è¯¢æ•°æ®ï¼‰æ—¶ï¼Œè®¿é—®æœåŠ¡ç«¯ï¼›è¯·æ±‚åˆ°è¾¾Nginxåï¼Œä¼˜å…ˆè¯»å–Nginxæœ¬åœ°ç¼“å­˜ï¼›å¦‚æœNginxæœ¬åœ°ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™å»ç›´æ¥æŸ¥è¯¢Redisï¼ˆä¸ç»è¿‡Tomcatï¼‰ï¼›å¦‚æœRedisæŸ¥è¯¢æœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢Tomcatï¼›è¯·æ±‚è¿›å…¥Tomcatåï¼Œä¼˜å…ˆæŸ¥è¯¢JVMè¿›ç¨‹ç¼“å­˜ï¼›å¦‚æœJVMè¿›ç¨‹ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“ï¼‰</li></ul><p><img src="https://s1.vika.cn/space/2023/03/25/153788d9be894746a3c2cae5461ef4ad" alt="1653327884526"></p><h2 id="huan-cun-ji-chuan-wen-ti-ji-jie-jue-si-lu" id="ç¼“å­˜å‡»ç©¿é—®é¢˜åŠè§£å†³æ€è·¯">ç¼“å­˜å‡»ç©¿é—®é¢˜åŠè§£å†³æ€è·¯</h2><blockquote><p>ç¼“å­˜å‡»ç©¿é—®é¢˜ä¹Ÿå«çƒ­ç‚¹Keyé—®é¢˜ï¼Œå°±æ˜¯ä¸€ä¸ªè¢«é«˜å¹¶å‘è®¿é—®å¹¶ä¸”ç¼“å­˜é‡å»ºä¸šåŠ¡è¾ƒå¤æ‚çš„keyçªç„¶å¤±æ•ˆäº†ï¼Œæ— æ•°çš„è¯·æ±‚è®¿é—®ä¼šåœ¨ç¬é—´ç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§çš„å†²å‡»ã€‚</p></blockquote><p>å¸¸è§çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ul><li>äº’æ–¥é”</li><li>é€»è¾‘è¿‡æœŸ</li></ul><p>é€»è¾‘åˆ†æï¼šå‡è®¾çº¿ç¨‹1åœ¨æŸ¥è¯¢ç¼“å­˜ä¹‹åï¼Œæœ¬æ¥åº”è¯¥å»æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åæŠŠè¿™ä¸ªæ•°æ®é‡æ–°åŠ è½½åˆ°ç¼“å­˜çš„ï¼Œ</p><ul><li>æ­¤æ—¶åªè¦çº¿ç¨‹1èµ°å®Œè¿™ä¸ªé€»è¾‘ï¼Œå…¶ä»–çº¿ç¨‹å°±éƒ½èƒ½ä»ç¼“å­˜ä¸­åŠ è½½è¿™äº›æ•°æ®äº†ï¼Œ</li><li>ä½†æ˜¯å‡è®¾åœ¨çº¿ç¨‹1æ²¡æœ‰èµ°å®Œçš„æ—¶å€™ï¼Œåç»­çš„çº¿ç¨‹2ï¼Œçº¿ç¨‹3ï¼Œçº¿ç¨‹4åŒæ—¶è¿‡æ¥è®¿é—®å½“å‰è¿™ä¸ªæ–¹æ³•ï¼Œ</li><li>é‚£ä¹ˆè¿™äº›çº¿ç¨‹éƒ½ä¸èƒ½ä»ç¼“å­˜ä¸­æŸ¥è¯¢åˆ°æ•°æ®ï¼Œé‚£ä¹ˆä»–ä»¬å°±ä¼šåŒä¸€æ—¶åˆ»æ¥è®¿é—®æŸ¥è¯¢ç¼“å­˜ï¼Œéƒ½æ²¡æŸ¥åˆ°ï¼Œ</li><li>æ¥ç€åŒä¸€æ—¶é—´å»è®¿é—®æ•°æ®åº“ï¼ŒåŒæ—¶çš„å»æ‰§è¡Œæ•°æ®åº“ä»£ç ï¼Œå¯¹æ•°æ®åº“è®¿é—®å‹åŠ›è¿‡å¤§</li></ul><p><img src="https://s1.vika.cn/space/2023/03/25/0d6144b49324480f9d7f6901829faf13" alt="1653328022622"></p><h3 id="jie-jue-fang-an-yi-shi-yong-suo-lai-jie-jue" id="è§£å†³æ–¹æ¡ˆä¸€ã€ä½¿ç”¨é”æ¥è§£å†³ï¼š">è§£å†³æ–¹æ¡ˆä¸€ã€ä½¿ç”¨é”æ¥è§£å†³ï¼š</h3><p>å› ä¸ºé”èƒ½å®ç°äº’æ–¥æ€§ã€‚</p><ul><li>å‡è®¾çº¿ç¨‹è¿‡æ¥ï¼Œåªèƒ½ä¸€ä¸ªäººä¸€ä¸ªäººçš„æ¥è®¿é—®æ•°æ®åº“ï¼Œä»è€Œé¿å…å¯¹äºæ•°æ®åº“è®¿é—®å‹åŠ›è¿‡å¤§ï¼Œ</li><li>ä½†è¿™ä¹Ÿä¼šå½±å“æŸ¥è¯¢çš„æ€§èƒ½ï¼Œå› ä¸ºæ­¤æ—¶ä¼šè®©æŸ¥è¯¢çš„æ€§èƒ½ä»å¹¶è¡Œå˜æˆäº†ä¸²è¡Œï¼Œ</li><li>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨tryLockæ–¹æ³• + double checkæ¥è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚</li></ul><p>å‡è®¾ç°åœ¨çº¿ç¨‹1è¿‡æ¥è®¿é—®ï¼Œ</p><ul><li>ä»–æŸ¥è¯¢ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œä½†æ˜¯æ­¤æ—¶ä»–è·å¾—åˆ°äº†é”çš„èµ„æºï¼Œé‚£ä¹ˆçº¿ç¨‹1å°±ä¼šä¸€ä¸ªäººå»æ‰§è¡Œé€»è¾‘ï¼Œ</li><li>å‡è®¾ç°åœ¨çº¿ç¨‹2è¿‡æ¥ï¼Œçº¿ç¨‹2åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¹¶æ²¡æœ‰è·å¾—åˆ°é”ï¼Œé‚£ä¹ˆçº¿ç¨‹2å°±å¯ä»¥è¿›è¡Œåˆ°ä¼‘çœ ï¼Œ</li><li>ç›´åˆ°çº¿ç¨‹1æŠŠé”é‡Šæ”¾åï¼Œçº¿ç¨‹2è·å¾—åˆ°é”ï¼Œç„¶åå†æ¥æ‰§è¡Œé€»è¾‘ï¼Œæ­¤æ—¶å°±èƒ½å¤Ÿä»ç¼“å­˜ä¸­æ‹¿åˆ°æ•°æ®äº†ã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/03/25/0157f826baf148d5a92add4476249610" alt="1653328288627"></p><h3 id="jie-jue-fang-an-er-luo-ji-guo-qi-fang-an" id="è§£å†³æ–¹æ¡ˆäºŒã€é€»è¾‘è¿‡æœŸæ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆäºŒã€é€»è¾‘è¿‡æœŸæ–¹æ¡ˆ</h3><p>æ–¹æ¡ˆåˆ†æï¼šæˆ‘ä»¬ä¹‹æ‰€ä»¥ä¼šå‡ºç°è¿™ä¸ªç¼“å­˜å‡»ç©¿é—®é¢˜ï¼Œä¸»è¦åŸå› æ˜¯åœ¨äºæˆ‘ä»¬å¯¹keyè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œ</p><ul><li>å‡è®¾æˆ‘ä»¬ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå…¶å®å°±ä¸ä¼šæœ‰ç¼“å­˜å‡»ç©¿çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·æ•°æ®ä¸å°±ä¸€ç›´å ç”¨æˆ‘ä»¬å†…å­˜äº†å—ï¼Œ</li></ul><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨é€»è¾‘è¿‡æœŸæ–¹æ¡ˆã€‚</p><ul><li>æˆ‘ä»¬æŠŠè¿‡æœŸæ—¶é—´è®¾ç½®åœ¨ redisçš„valueä¸­ï¼Œ</li><li>æ³¨æ„ï¼šè¿™ä¸ªè¿‡æœŸæ—¶é—´å¹¶ä¸ä¼šç›´æ¥ä½œç”¨äºredisï¼Œè€Œæ˜¯æˆ‘ä»¬åç»­é€šè¿‡é€»è¾‘å»å¤„ç†ã€‚<ul><li>å‡è®¾çº¿ç¨‹1å»æŸ¥è¯¢ç¼“å­˜ï¼Œç„¶åä»valueä¸­åˆ¤æ–­å‡ºæ¥å½“å‰çš„æ•°æ®å·²ç»è¿‡æœŸäº†ï¼Œæ­¤æ—¶çº¿ç¨‹1å»è·å¾—äº’æ–¥é”ï¼Œ</li><li>é‚£ä¹ˆå…¶ä»–çº¿ç¨‹ä¼šè¿›è¡Œé˜»å¡ï¼Œè·å¾—äº†é”çš„çº¿ç¨‹1ä»–ä¼šå¼€å¯ä¸€ä¸ª æ–°çº¿ç¨‹2å»è¿›è¡Œ ä»¥å‰çš„é‡æ„æ•°æ®çš„é€»è¾‘ï¼Œç›´åˆ°æ–°å¼€çš„çº¿ç¨‹å®Œæˆè¿™ä¸ªé€»è¾‘åï¼Œæ‰é‡Šæ”¾é”ï¼Œ è€Œçº¿ç¨‹1ç›´æ¥è¿›è¡Œè¿”å›ï¼Œ</li><li>å‡è®¾ç°åœ¨çº¿ç¨‹3è¿‡æ¥è®¿é—®ï¼Œç”±äºçº¿ç¨‹2æŒæœ‰ç€é”ï¼Œæ‰€ä»¥çº¿ç¨‹3æ— æ³•è·å¾—é”ï¼Œ</li><li>çº¿ç¨‹3ä¹Ÿç›´æ¥è¿”å›æ•°æ®ï¼Œåªæœ‰ç­‰åˆ°æ–°å¼€çš„çº¿ç¨‹2æŠŠé‡å»ºæ•°æ®æ„å»ºå®Œåï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½èµ°è¿”å›æ­£ç¡®çš„æ•°æ®ã€‚</li></ul></li></ul><p>è¿™ç§æ–¹æ¡ˆå·§å¦™åœ¨äºï¼Œå¼‚æ­¥çš„æ„å»ºç¼“å­˜ï¼Œç¼ºç‚¹åœ¨äºåœ¨æ„å»ºå®Œç¼“å­˜ä¹‹å‰ï¼Œè¿”å›çš„éƒ½æ˜¯è„æ•°æ®ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/25/96bd3bb81713497d9b79c4dc69dc1cef" alt="1653328663897"></p><p>è¿›è¡Œå¯¹æ¯”</p><p>**äº’æ–¥é”æ–¹æ¡ˆï¼š**ç”±äºä¿è¯äº†äº’æ–¥æ€§ï¼Œæ‰€ä»¥æ•°æ®ä¸€è‡´ï¼Œä¸”å®ç°ç®€å•ï¼Œå› ä¸ºä»…ä»…åªéœ€è¦åŠ ä¸€æŠŠé”è€Œå·²ï¼Œä¹Ÿæ²¡å…¶ä»–çš„äº‹æƒ…éœ€è¦æ“å¿ƒï¼Œæ‰€ä»¥æ²¡æœ‰é¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼Œç¼ºç‚¹åœ¨äºæœ‰é”å°±æœ‰æ­»é”é—®é¢˜çš„å‘ç”Ÿï¼Œä¸”åªèƒ½ä¸²è¡Œæ‰§è¡Œæ€§èƒ½è‚¯å®šå—åˆ°å½±å“</p><p><strong>é€»è¾‘è¿‡æœŸæ–¹æ¡ˆï¼š</strong> çº¿ç¨‹è¯»å–è¿‡ç¨‹ä¸­ä¸éœ€è¦ç­‰å¾…ï¼Œæ€§èƒ½å¥½ï¼Œæœ‰ä¸€ä¸ªé¢å¤–çš„çº¿ç¨‹æŒæœ‰é”å»è¿›è¡Œé‡æ„æ•°æ®ï¼Œä½†æ˜¯åœ¨é‡æ„æ•°æ®å®Œæˆå‰ï¼Œå…¶ä»–çš„çº¿ç¨‹åªèƒ½è¿”å›ä¹‹å‰çš„æ•°æ®ï¼Œä¸”å®ç°èµ·æ¥éº»çƒ¦</p><p><img src="https://s1.vika.cn/space/2023/03/25/412d24bfae2b42c6a3f2c0914ef4ee09" alt="1653357522914"></p><h3 id="li-yong-hu-chi-suo-jie-jue-huan-cun-ji-chuan-wen-ti" id="åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜">åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</h3><p>æ ¸å¿ƒæ€è·¯ï¼š</p><ul><li>ç›¸è¾ƒäºåŸæ¥ä»ç¼“å­˜ä¸­æŸ¥è¯¢ä¸åˆ°æ•°æ®åç›´æ¥æŸ¥è¯¢æ•°æ®åº“è€Œè¨€ï¼Œ</li><li>ç°åœ¨çš„æ–¹æ¡ˆæ˜¯ è¿›è¡ŒæŸ¥è¯¢ä¹‹åï¼Œ<ul><li>å¦‚æœä»ç¼“å­˜æ²¡æœ‰æŸ¥è¯¢åˆ°æ•°æ®ï¼Œåˆ™è¿›è¡Œäº’æ–¥é”çš„è·å–ï¼Œ</li><li>è·å–äº’æ–¥é”åï¼Œåˆ¤æ–­æ˜¯å¦è·å¾—åˆ°äº†é”ï¼Œå¦‚æœæ²¡æœ‰è·å¾—åˆ°ï¼Œåˆ™ä¼‘çœ ï¼Œ</li><li>è¿‡ä¸€ä¼šå†è¿›è¡Œå°è¯•ï¼Œç›´åˆ°è·å–åˆ°é”ä¸ºæ­¢ï¼Œæ‰èƒ½è¿›è¡ŒæŸ¥è¯¢</li></ul></li></ul><p>å¦‚æœè·å–åˆ°äº†é”çš„çº¿ç¨‹ï¼Œå†å»è¿›è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥è¯¢åå°†æ•°æ®å†™å…¥redisï¼Œå†é‡Šæ”¾é”ï¼Œè¿”å›æ•°æ®ï¼Œåˆ©ç”¨äº’æ–¥é”å°±èƒ½ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œæ“ä½œæ•°æ®åº“çš„é€»è¾‘ï¼Œé˜²æ­¢ç¼“å­˜å‡»ç©¿</p><blockquote><p>éœ€æ±‚ï¼šä¿®æ”¹æ ¹æ®idæŸ¥è¯¢å•†é“ºçš„ä¸šåŠ¡ï¼ŒåŸºäºäº’æ–¥é”æ–¹å¼æ¥è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</p></blockquote><p><img src="https://s1.vika.cn/space/2023/03/25/36521673c95947e9bc932a76286f5944" alt="1653357860001"></p><div class="tabs" id="lock"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#lock-1">æ“ä½œé”</button></li><li class="tab"><button type="button" data-href="#lock-2">é€»è¾‘ä»£ç </button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="lock-1"><p><strong>æ“ä½œé”çš„ä»£ç ï¼š</strong></p><p>æ ¸å¿ƒæ€è·¯å°±æ˜¯åˆ©ç”¨redisçš„setnxæ–¹æ³•æ¥è¡¨ç¤ºè·å–é”ï¼Œ</p><ul><li>è¯¥æ–¹æ³•å«ä¹‰æ˜¯redisä¸­å¦‚æœæ²¡æœ‰è¿™ä¸ªkeyï¼Œåˆ™æ’å…¥æˆåŠŸï¼Œè¿”å›1ï¼Œåœ¨stringRedisTemplateä¸­è¿”å›trueï¼Œ</li><li>å¦‚æœæœ‰è¿™ä¸ªkeyåˆ™æ’å…¥å¤±è´¥ï¼Œåˆ™è¿”å›0ï¼Œåœ¨stringRedisTemplateè¿”å›falseï¼Œ</li><li>æˆ‘ä»¬å¯ä»¥é€šè¿‡trueï¼Œæˆ–è€…æ˜¯falseï¼Œæ¥è¡¨ç¤ºæ˜¯å¦æœ‰çº¿ç¨‹æˆåŠŸæ’å…¥keyï¼ŒæˆåŠŸæ’å…¥çš„keyçš„çº¿ç¨‹æˆ‘ä»¬è®¤ä¸ºä»–å°±æ˜¯è·å¾—åˆ°é”çš„çº¿ç¨‹ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="string">&quot;1&quot;</span>, LOCK_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">    <span class="keyword">return</span> BooleanUtil.isTrue(flag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    stringRedisTemplate.delete(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="lock-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// ç¼“å­˜ç©¿é€</span></span><br><span class="line">    <span class="comment">// Shop shop = queryWithPassThrough(id);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿</span></span><br><span class="line">    <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> queryWithMutex(id);</span><br><span class="line">    <span class="keyword">if</span>(shop == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº—é“ºä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Shop <span class="title function_">queryWithMutex</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> CACHE_SHOP_KEY + id;</span><br><span class="line">    <span class="comment">// 1. ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">// 2. åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isNotBlank(shopJson)) &#123;</span><br><span class="line">        <span class="comment">// 3. å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> JSONUtil.toBean(shopJson, Shop.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å‘½ä¸­çš„æ˜¯å¦æ˜¯ç©ºå€¼</span></span><br><span class="line">    <span class="keyword">if</span>(shopJson != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. å®ç°ç¼“å­˜é‡å»º</span></span><br><span class="line">    <span class="comment">// 4.1 è·å–äº’æ–¥é”</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> LOCK_SHOP_KEY + id;</span><br><span class="line">    <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">        <span class="comment">// 4.2 åˆ¤æ–­æ˜¯å¦è·å–æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span>(!isLock) &#123;</span><br><span class="line">            <span class="comment">// 4.3 å¤±è´¥ï¼Œåˆ™ä¼‘çœ å¹¶é‡è¯•</span></span><br><span class="line">            Thread.sleep(<span class="number">50</span>);</span><br><span class="line">            <span class="keyword">return</span> queryWithMutex(id);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.4 å†æ¬¡æ£€æµ‹redisç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™æ— éœ€é‡å»ºç¼“å­˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">shopJsonAgain</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span>(shopJsonAgain != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> JSONUtil.toBean(shopJsonAgain, Shop.class);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.5 Redisç¼“å­˜ä¸å­˜åœ¨ï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">        shop = getById(id);</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿé‡å»ºçš„å»¶æ—¶</span></span><br><span class="line">        Thread.sleep(<span class="number">200</span>);</span><br><span class="line">        <span class="comment">// 5. ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">        <span class="keyword">if</span>(shop == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å°†ç©ºå€¼å†™å…¥redis</span></span><br><span class="line">            stringRedisTemplate.opsForValue().set(key, <span class="string">&quot;&quot;</span>, CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6. å­˜åœ¨ï¼Œå†™å…¥redis</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(shop), CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 7. é‡Šæ”¾äº’æ–¥é”</span></span><br><span class="line">        unlock(lockKey);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 8. è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> shop;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="li-yong-luo-ji-guo-qi-jie-jue-huan-cun-ji-chuan-wen-ti" id="åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜">åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</h3><blockquote><p><strong>éœ€æ±‚ï¼šä¿®æ”¹æ ¹æ®idæŸ¥è¯¢å•†é“ºçš„ä¸šåŠ¡ï¼ŒåŸºäºé€»è¾‘è¿‡æœŸæ–¹å¼æ¥è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</strong></p></blockquote><p>æ€è·¯åˆ†æï¼šå½“ç”¨æˆ·å¼€å§‹æŸ¥è¯¢redisæ—¶ï¼Œåˆ¤æ–­æ˜¯å¦å‘½ä¸­ï¼Œ</p><ul><li>å¦‚æœæ²¡æœ‰å‘½ä¸­åˆ™ç›´æ¥è¿”å›ç©ºæ•°æ®ï¼Œä¸æŸ¥è¯¢æ•°æ®åº“ï¼Œ</li><li>è€Œä¸€æ—¦å‘½ä¸­åï¼Œå°†valueå–å‡ºï¼Œåˆ¤æ–­valueä¸­çš„è¿‡æœŸæ—¶é—´æ˜¯å¦æ»¡è¶³ï¼Œ<ul><li>å¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œåˆ™ç›´æ¥è¿”å›redisä¸­çš„æ•°æ®ï¼Œ</li><li>å¦‚æœè¿‡æœŸï¼Œåˆ™åœ¨å¼€å¯ç‹¬ç«‹çº¿ç¨‹åç›´æ¥è¿”å›ä¹‹å‰çš„æ•°æ®ï¼Œç‹¬ç«‹çº¿ç¨‹å»é‡æ„æ•°æ®ï¼Œé‡æ„å®Œæˆåé‡Šæ”¾äº’æ–¥é”ã€‚</li></ul></li></ul><p><img src="https://s1.vika.cn/space/2023/03/25/68c5cd33e1c4426eada76191a22a3281" alt="1653360308731"></p><p>å¦‚æœå°è£…æ•°æ®ï¼šå› ä¸ºç°åœ¨redisä¸­å­˜å‚¨çš„æ•°æ®çš„valueéœ€è¦å¸¦ä¸Šè¿‡æœŸæ—¶é—´ï¼Œæ­¤æ—¶è¦ä¹ˆä½ å»ä¿®æ”¹åŸæ¥çš„å®ä½“ç±»ï¼Œè¦ä¹ˆä½ </p><p><strong>æ­¥éª¤ä¸€ã€</strong></p><p>æ–°å»ºä¸€ä¸ªå®ä½“ç±»ï¼Œæˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒä¸ªæ–¹æ¡ˆï¼Œè¿™ä¸ªæ–¹æ¡ˆï¼Œå¯¹åŸæ¥ä»£ç æ²¡æœ‰ä¾µå…¥æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisData</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime expireTime;</span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤äºŒã€</strong></p><p>åœ¨<strong>ShopServiceImpl</strong> æ–°å¢æ­¤æ–¹æ³•ï¼Œåˆ©ç”¨å•å…ƒæµ‹è¯•è¿›è¡Œç¼“å­˜é¢„çƒ­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveShop2Redis</span><span class="params">(Long id, Long expireSeconds)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// 1. æŸ¥è¯¢åº—é“ºæ•°æ®</span></span><br><span class="line">    <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> getById(id);</span><br><span class="line">    Thread.sleep(<span class="number">200</span>);</span><br><span class="line">    <span class="comment">// 2. å°è£…é€»è¾‘è¿‡æœŸæ—¶é—´</span></span><br><span class="line">    <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisData</span>();</span><br><span class="line">    redisData.setData(shop);</span><br><span class="line">    redisData.setExpireTime(LocalDateTime.now().plusSeconds(expireSeconds));</span><br><span class="line">    <span class="comment">// 3. å†™å…¥redis</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(CACHE_SHOP_KEY + id, JSONUtil.toJsonStr(redisData));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åœ¨æµ‹è¯•ç±»ä¸­</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSaveShop</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    shopService.saveShop2Redis(<span class="number">1L</span>, <span class="number">10L</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤ä¸‰ï¼šæ­£å¼ä»£ç </strong></p><p>ShopServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">CACHE_REBUILD_EXECUTOR</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Shop <span class="title function_">queryWithLogicalExpire</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> CACHE_SHOP_KEY + id;</span><br><span class="line">    <span class="comment">// 1. ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">// 2. åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isBlank(shopJson)) &#123;</span><br><span class="line">        <span class="comment">// 3. ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. å‘½ä¸­ï¼Œéœ€è¦å…ˆæŠŠjsonååºåˆ—åŒ–æœªå¯¹è±¡</span></span><br><span class="line">    <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> JSONUtil.toBean(shopJson, RedisData.class);</span><br><span class="line">    <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> JSONUtil.toBean((JSONObject) redisData.getData(), Shop.class);</span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">expireTime</span> <span class="operator">=</span> redisData.getExpireTime();</span><br><span class="line">    <span class="comment">// 5. åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">    <span class="keyword">if</span>(expireTime.isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// 5.1 æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›åº—é“ºä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> shop;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.2 å·²è¿‡æœŸï¼Œéœ€è¦ç¼“å­˜é‡å»º</span></span><br><span class="line">    <span class="comment">// 6. ç¼“å­˜é‡å»º</span></span><br><span class="line">    <span class="comment">// 6.1 è·å–äº’æ–¥é”</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> LOCK_SHOP_KEY + id;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">    <span class="comment">// 6.2 åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span>(isLock) &#123;</span><br><span class="line">        <span class="comment">// 6.3 å†æ¬¡æ£€æµ‹redisç¼“å­˜æ˜¯å¦è¿‡æœŸï¼ŒåšDoubleCheck</span></span><br><span class="line">        <span class="keyword">if</span>(expireTime.isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="keyword">return</span> shop;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6.4 æˆåŠŸï¼Œå¼€å¯ç‹¬ç«‹çº¿ç¨‹ï¼Œå®ç°ç¼“å­˜é‡å»º</span></span><br><span class="line">        CACHE_REBUILD_EXECUTOR.submit(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// é‡å»ºç¼“å­˜</span></span><br><span class="line">                <span class="built_in">this</span>.saveShop2Redis(id, <span class="number">20L</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">                unlock(lockKey);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.5 è¿”å›è¿‡æœŸçš„å•†é“ºä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">return</span> shop;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="feng-zhuang-redis-gong-ju-lei" id="å°è£…Rediså·¥å…·ç±»">å°è£…Rediså·¥å…·ç±»</h2><p>åŸºäºStringRedisTemplateå°è£…ä¸€ä¸ªç¼“å­˜å·¥å…·ç±»ï¼Œæ»¡è¶³ä¸‹åˆ—éœ€æ±‚ï¼š</p><ul><li><p>æ–¹æ³•1ï¼šå°†ä»»æ„Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå¹¶å­˜å‚¨åœ¨stringç±»å‹çš„keyä¸­ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®TTLè¿‡æœŸæ—¶é—´</p><ul><li>public void set()</li></ul></li><li><p>æ–¹æ³•2ï¼šå°†ä»»æ„Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå¹¶å­˜å‚¨åœ¨stringç±»å‹çš„keyä¸­ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®é€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œç”¨äºå¤„ç†ç¼“å­˜å‡»ç©¿é—®é¢˜</p><ul><li>public void setWithLogicalExpire()</li></ul></li><li><p>æ–¹æ³•3ï¼šæ ¹æ®æŒ‡å®šçš„keyæŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶ååºåˆ—åŒ–ä¸ºæŒ‡å®šç±»å‹ï¼Œåˆ©ç”¨ç¼“å­˜ç©ºå€¼çš„æ–¹å¼è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜</p><ul><li>public &lt;R, ID&gt; R queryWithPassThrough()</li></ul></li><li><p>æ–¹æ³•4ï¼šæ ¹æ®æŒ‡å®šçš„keyæŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶ååºåˆ—åŒ–ä¸ºæŒ‡å®šç±»å‹ï¼Œéœ€è¦åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</p><ul><li>public &lt;R, ID&gt; R queryWithLogicalExpire()</li></ul></li></ul><p>å°†é€»è¾‘è¿›è¡Œå°è£…</p><div class="tabs" id="cacheclient"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#cacheclient-1">set</button></li><li class="tab"><button type="button" data-href="#cacheclient-2">queryWithPassThrough</button></li><li class="tab"><button type="button" data-href="#cacheclient-3">queryWithLogicalExpire</button></li><li class="tab"><button type="button" data-href="#cacheclient-4">å®Œæ•´ä»£ç </button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="cacheclient-1"><ul><li>å°è£…è®¾ç½®ç¼“å­˜æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, Object value, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">    stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(value), time, unit);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWithLogicalExpire</span><span class="params">(String key, Object value, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®é€»è¾‘è¿‡æœŸ</span></span><br><span class="line">    <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisData</span>();</span><br><span class="line">    redisData.setData(value);</span><br><span class="line"> redisData.setExpireTime(LocalDateTime.now().plusSeconds(unit.toSeconds(time)));</span><br><span class="line">    <span class="comment">// å†™å…¥Redis</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(redisData));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="cacheclient-2"><ul><li>å°è£…ç¼“å­˜å‡»ç©¿è§£å†³æ–¹æ¡ˆ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;R, ID&gt; R <span class="title function_">queryWithPassThrough</span><span class="params">(</span></span><br><span class="line"><span class="params">        String keyPrefix, ID id, Class&lt;R&gt; type, Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keyPrefix + id;</span><br><span class="line">    <span class="comment">// 1. ä»redisä¸­æŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">// 2. åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span>(StrUtil.isNotBlank(json)) &#123;</span><br><span class="line">        <span class="comment">// 3. å­˜åœ¨ï¼Œåˆ™è¿”å›æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> JSONUtil.toBean(json, type);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å‘½ä¸­çš„æ˜¯å¦æ˜¯ç©ºå€¼</span></span><br><span class="line">    <span class="keyword">if</span>(json != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. ä¸å­˜åœ¨ï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">    <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> dbFallback.apply(id);</span><br><span class="line">    <span class="comment">// 5. ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">    <span class="keyword">if</span>(r == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å°†ç©ºå€¼å†™å…¥redis</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, <span class="string">&quot;&quot;</span>, CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 6. å­˜åœ¨ï¼Œå†™å…¥redis</span></span><br><span class="line">    <span class="built_in">this</span>.set(key, r, time, unit);</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="cacheclient-3"><ul><li>å°è£…é€»è¾‘è¿‡æœŸè§£å†³æ–¹æ¡ˆ</li><li>æ­¤å¤„é‡‡ç”¨äº†ï¼š<ul><li>&lt;R, ID&gt; æ³›å‹ï¼ŒFunction&lt;ID, R&gt; æ–¹æ³•</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">CACHE_REBUILD_EXECUTOR</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> &lt;R, ID&gt; R <span class="title function_">queryWithLogicalExpire</span><span class="params">(String keyPrefix, ID id,</span></span><br><span class="line"><span class="params">                                        Class&lt;R&gt; type, Function&lt;ID, R&gt; dbFallBack, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keyPrefix + id;</span><br><span class="line">    <span class="comment">// 1. ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">// 2. åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isBlank(shopJson)) &#123;</span><br><span class="line">        <span class="comment">// 3. ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. å‘½ä¸­ï¼Œéœ€è¦å…ˆæŠŠjsonååºåˆ—åŒ–æœªå¯¹è±¡</span></span><br><span class="line">    <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> JSONUtil.toBean(shopJson, RedisData.class);</span><br><span class="line">    <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> JSONUtil.toBean((JSONObject) redisData.getData(), type);</span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">expireTime</span> <span class="operator">=</span> redisData.getExpireTime();</span><br><span class="line">    <span class="comment">// 5. åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">    <span class="keyword">if</span>(expireTime.isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// 5.1 æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›åº—é“ºä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.2 å·²è¿‡æœŸï¼Œéœ€è¦ç¼“å­˜é‡å»º</span></span><br><span class="line">    <span class="comment">// 6. ç¼“å­˜é‡å»º</span></span><br><span class="line">    <span class="comment">// 6.1 è·å–äº’æ–¥é”</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> LOCK_SHOP_KEY + id;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">    <span class="comment">// 6.2 åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span>(isLock) &#123;</span><br><span class="line">        <span class="comment">// 6.3 å†æ¬¡æ£€æµ‹redisç¼“å­˜æ˜¯å¦è¿‡æœŸï¼ŒåšDoubleCheck</span></span><br><span class="line">        <span class="keyword">if</span>(expireTime.isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="keyword">return</span> r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6.4 æˆåŠŸï¼Œå¼€å¯ç‹¬ç«‹çº¿ç¨‹ï¼Œå®ç°ç¼“å­˜é‡å»º</span></span><br><span class="line">        CACHE_REBUILD_EXECUTOR.submit(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">                <span class="type">R</span> <span class="variable">r1</span> <span class="operator">=</span> dbFallBack.apply(id);</span><br><span class="line">                <span class="comment">// å†™å…¥redis</span></span><br><span class="line">                <span class="built_in">this</span>.setWithLogicalExpire(key, r1, time, unit);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">                unlock(lockKey);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.5 è¿”å›è¿‡æœŸçš„å•†é“ºä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="string">&quot;1&quot;</span>, LOCK_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">    <span class="keyword">return</span> BooleanUtil.isTrue(flag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    stringRedisTemplate.delete(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="cacheclient-4"><ul><li>CacheClient</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CacheClient</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, Object value, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(value), time, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWithLogicalExpire</span><span class="params">(String key, Object value, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®é€»è¾‘è¿‡æœŸ</span></span><br><span class="line">        <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisData</span>();</span><br><span class="line">        redisData.setData(value);</span><br><span class="line">        redisData.setExpireTime(LocalDateTime.now().plusSeconds(unit.toSeconds(time)));</span><br><span class="line">        <span class="comment">// å†™å…¥Redis</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(redisData));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;R, ID&gt; R <span class="title function_">queryWithPassThrough</span><span class="params">(</span></span><br><span class="line"><span class="params">            String keyPrefix, ID id, Class&lt;R&gt; type, Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keyPrefix + id;</span><br><span class="line">        <span class="comment">// 1. ä»redisä¸­æŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">// 2. åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isNotBlank(json)) &#123;</span><br><span class="line">            <span class="comment">// 3. å­˜åœ¨ï¼Œåˆ™è¿”å›æ•°æ®</span></span><br><span class="line">            <span class="keyword">return</span> JSONUtil.toBean(json, type);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­å‘½ä¸­çš„æ˜¯å¦æ˜¯ç©ºå€¼</span></span><br><span class="line">        <span class="keyword">if</span>(json != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4. ä¸å­˜åœ¨ï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> dbFallback.apply(id);</span><br><span class="line">        <span class="comment">// 5. ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">        <span class="keyword">if</span>(r == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å°†ç©ºå€¼å†™å…¥redis</span></span><br><span class="line">            stringRedisTemplate.opsForValue().set(key, <span class="string">&quot;&quot;</span>, CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6. å­˜åœ¨ï¼Œå†™å…¥redis</span></span><br><span class="line">        <span class="built_in">this</span>.set(key, r, time, unit);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">CACHE_REBUILD_EXECUTOR</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;R, ID&gt; R <span class="title function_">queryWithLogicalExpire</span><span class="params">(String keyPrefix, ID id,</span></span><br><span class="line"><span class="params">                                            Class&lt;R&gt; type, Function&lt;ID, R&gt; dbFallBack, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keyPrefix + id;</span><br><span class="line">        <span class="comment">// 1. ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">// 2. åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(shopJson)) &#123;</span><br><span class="line">            <span class="comment">// 3. ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4. å‘½ä¸­ï¼Œéœ€è¦å…ˆæŠŠjsonååºåˆ—åŒ–æœªå¯¹è±¡</span></span><br><span class="line">        <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> JSONUtil.toBean(shopJson, RedisData.class);</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> JSONUtil.toBean((JSONObject) redisData.getData(), type);</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">expireTime</span> <span class="operator">=</span> redisData.getExpireTime();</span><br><span class="line">        <span class="comment">// 5. åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">        <span class="keyword">if</span>(expireTime.isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="comment">// 5.1 æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›åº—é“ºä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">return</span> r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5.2 å·²è¿‡æœŸï¼Œéœ€è¦ç¼“å­˜é‡å»º</span></span><br><span class="line">        <span class="comment">// 6. ç¼“å­˜é‡å»º</span></span><br><span class="line">        <span class="comment">// 6.1 è·å–äº’æ–¥é”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> LOCK_SHOP_KEY + id;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">        <span class="comment">// 6.2 åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span>(isLock) &#123;</span><br><span class="line">            <span class="comment">// 6.3 å†æ¬¡æ£€æµ‹redisç¼“å­˜æ˜¯å¦è¿‡æœŸï¼ŒåšDoubleCheck</span></span><br><span class="line">            <span class="keyword">if</span>(expireTime.isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">                <span class="keyword">return</span> r;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 6.4 æˆåŠŸï¼Œå¼€å¯ç‹¬ç«‹çº¿ç¨‹ï¼Œå®ç°ç¼“å­˜é‡å»º</span></span><br><span class="line">            CACHE_REBUILD_EXECUTOR.submit(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">                    <span class="type">R</span> <span class="variable">r1</span> <span class="operator">=</span> dbFallBack.apply(id);</span><br><span class="line">                    <span class="comment">// å†™å…¥redis</span></span><br><span class="line">                    <span class="built_in">this</span>.setWithLogicalExpire(key, r1, time, unit);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">                    unlock(lockKey);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.5 è¿”å›è¿‡æœŸçš„å•†é“ºä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="string">&quot;1&quot;</span>, LOCK_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">        <span class="keyword">return</span> BooleanUtil.isTrue(flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        stringRedisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>åœ¨ShopServiceImpl ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// ç¼“å­˜ç©¿é€</span></span><br><span class="line">    <span class="comment">// Shop shop = queryWithPassThrough(id);</span></span><br><span class="line">    <span class="comment">// Shop shop = cacheClient.queryWithPassThrough(CACHE_SHOP_KEY, id, Shop.class,</span></span><br><span class="line">    <span class="comment">//         this::getById, CACHE_SHOP_TTL, TimeUnit.MINUTES);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿</span></span><br><span class="line">    <span class="comment">// Shop shop = queryWithMutex(id);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿</span></span><br><span class="line">    <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> cacheClient.queryWithLogicalExpire(</span><br><span class="line">            CACHE_SHOP_KEY, id, Shop.class, <span class="built_in">this</span>::getById, <span class="number">20L</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(shop == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº—é“ºä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="you-hui-juan-miao-sha-quan-ju-wei-yi-id-le-guan-suo">ä¼˜æƒ å·ç§’æ€ï¼ˆå…¨å±€å”¯ä¸€IDã€ä¹è§‚é”ï¼‰</h1><h2 id="quan-ju-wei-yi-id" id="å…¨å±€å”¯ä¸€ID">å…¨å±€å”¯ä¸€ID</h2><p>æ¯ä¸ªåº—é“ºéƒ½å¯ä»¥å‘å¸ƒä¼˜æƒ åˆ¸ï¼š</p><ul><li><p>å½“ç”¨æˆ·æŠ¢è´­æ—¶ï¼Œå°±ä¼šç”Ÿæˆè®¢å•å¹¶ä¿å­˜åˆ°tb_voucher_orderè¿™å¼ è¡¨ä¸­ï¼Œ</p></li><li><p>è€Œè®¢å•è¡¨å¦‚æœä½¿ç”¨æ•°æ®åº“è‡ªå¢IDå°±å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li><p>idçš„è§„å¾‹æ€§å¤ªæ˜æ˜¾</p></li><li><p>å—å•è¡¨æ•°æ®é‡çš„é™åˆ¶</p></li></ul></li></ul><p>åœºæ™¯åˆ†æä¸€ï¼šå¦‚æœæˆ‘ä»¬çš„idå…·æœ‰å¤ªæ˜æ˜¾çš„è§„åˆ™ï¼Œç”¨æˆ·æˆ–è€…è¯´å•†ä¸šå¯¹æ‰‹å¾ˆå®¹æ˜“çŒœæµ‹å‡ºæ¥æˆ‘ä»¬çš„ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œ</p><ul><li>æ¯”å¦‚å•†åŸåœ¨ä¸€å¤©æ—¶é—´å†…ï¼Œå–å‡ºäº†å¤šå°‘å•ï¼Œè¿™æ˜æ˜¾ä¸åˆé€‚ã€‚</li></ul><p>åœºæ™¯åˆ†æäºŒï¼šéšç€æˆ‘ä»¬å•†åŸè§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œmysqlçš„å•è¡¨çš„å®¹é‡ä¸å®œè¶…è¿‡500Wï¼Œ</p><ul><li>æ•°æ®é‡è¿‡å¤§ä¹‹åï¼Œæˆ‘ä»¬è¦è¿›è¡Œæ‹†åº“æ‹†è¡¨ï¼Œä½†æ‹†åˆ†è¡¨äº†ä¹‹åï¼Œä»–ä»¬ä»é€»è¾‘ä¸Šè®²ä»–ä»¬æ˜¯åŒä¸€å¼ è¡¨ï¼Œ</li><li>æ‰€ä»¥ä»–ä»¬çš„idæ˜¯ä¸èƒ½ä¸€æ ·çš„ï¼Œ äºæ˜¯ä¹æˆ‘ä»¬éœ€è¦ä¿è¯idçš„å”¯ä¸€æ€§ã€‚</li></ul><blockquote><p><strong>å…¨å±€IDç”Ÿæˆå™¨</strong>ï¼Œæ˜¯ä¸€ç§åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ç”¨æ¥ç”Ÿæˆå…¨å±€å”¯ä¸€IDçš„å·¥å…·ï¼Œä¸€èˆ¬è¦æ»¡è¶³ä¸‹åˆ—ç‰¹æ€§ï¼š</p></blockquote><p><img src="https://s1.vika.cn/space/2023/03/27/962a898562554a97abdd3eb95430f155" alt="1653363100502"></p><p>ä¸ºäº†å¢åŠ IDçš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç›´æ¥ä½¿ç”¨Redisè‡ªå¢çš„æ•°å€¼ï¼Œè€Œæ˜¯æ‹¼æ¥ä¸€äº›å…¶å®ƒä¿¡æ¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/27/876aaae45b5c43f9bba99cfeb5f4a173" alt="1653363172079"></p><p>â€‹</p><p>IDçš„ç»„æˆéƒ¨åˆ†ï¼š</p><ul><li><p>ç¬¦å·ä½ï¼š1bitï¼Œæ°¸è¿œä¸º0</p></li><li><p>æ—¶é—´æˆ³ï¼š31bitï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œå¯ä»¥ä½¿ç”¨69å¹´</p></li><li><p>åºåˆ—å·ï¼š32bitï¼Œç§’å†…çš„è®¡æ•°å™¨ï¼Œæ”¯æŒæ¯ç§’äº§ç”Ÿ<code>2^32</code>ä¸ªä¸åŒID</p></li></ul><h2 id="redis-shi-xian-quan-ju-wei-yi-id" id="Rediså®ç°å…¨å±€å”¯ä¸€Id">Rediså®ç°å…¨å±€å”¯ä¸€Id</h2><ul><li><code>return timestamp &lt;&lt; COUNT_BITS | count;</code>è§£é‡Šï¼š<ul><li>åˆ©ç”¨ä½è¿ç®—ç¬¦ <code>&lt;&lt;</code>  æŠŠæ—¶é—´æˆ³å‘å³ç§»åŠ¨ COUNT_BITS ä½</li><li>å†åˆ©ç”¨ <code>|</code> æˆ–è¿ç®—ç¬¦ æŠŠç©ºå‡ºæ¥çš„ 0 ç”¨åºåˆ—å·è¡¥é½</li></ul></li></ul><p>â€‹æ—¶é—´æˆ³ï¼ˆ31bitï¼‰åºåˆ—å·ï¼ˆ32bitï¼‰</p><p><code> 0 - 00000000 00000000 00000000 00000000 - 00000000 00000000 00000000 00000000 </code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisIdWorker</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼€å§‹æ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">BEGIN_TIMESTAMP</span> <span class="operator">=</span> <span class="number">1640995200L</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åºåˆ—å·çš„ä½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">COUNT_BITS</span> <span class="operator">=</span> <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisIdWorker</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">nextId</span><span class="params">(String keyPrefix)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.ç”Ÿæˆæ—¶é—´æˆ³</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="type">long</span> <span class="variable">nowSecond</span> <span class="operator">=</span> now.toEpochSecond(ZoneOffset.UTC);</span><br><span class="line">        <span class="type">long</span> <span class="variable">timestamp</span> <span class="operator">=</span> nowSecond - BEGIN_TIMESTAMP;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.ç”Ÿæˆåºåˆ—å·</span></span><br><span class="line">        <span class="comment">// 2.1.è·å–å½“å‰æ—¥æœŸï¼Œç²¾ç¡®åˆ°å¤©</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy:MM:dd&quot;</span>));</span><br><span class="line">        <span class="comment">// 2.2.è‡ªå¢é•¿</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().increment(<span class="string">&quot;icr:&quot;</span> + keyPrefix + <span class="string">&quot;:&quot;</span> + date); </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.æ‹¼æ¥å¹¶è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> timestamp &lt;&lt; COUNT_BITS | count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><h3 id="zhi-shi-xiao-tie-shi-guan-yu-countdownlatch" id="çŸ¥è¯†å°è´´å£«ï¼šå…³äºcountdownlatch">çŸ¥è¯†å°è´´å£«ï¼šå…³äºcountdownlatch</h3><blockquote><p>countdownlatchåä¸ºä¿¡å·æªï¼šä¸»è¦çš„ä½œç”¨æ˜¯åŒæ­¥åè°ƒåœ¨å¤šçº¿ç¨‹çš„ç­‰å¾…äºå”¤é†’é—®é¢˜</p></blockquote><p>æˆ‘ä»¬å¦‚æœæ²¡æœ‰CountDownLatch ï¼Œ</p><ul><li>é‚£ä¹ˆç”±äºç¨‹åºæ˜¯å¼‚æ­¥çš„ï¼Œ</li><li>å½“å¼‚æ­¥ç¨‹åºæ²¡æœ‰æ‰§è¡Œå®Œæ—¶ï¼Œä¸»çº¿ç¨‹å°±å·²ç»æ‰§è¡Œå®Œäº†ï¼Œ</li><li>ç„¶åæˆ‘ä»¬æœŸæœ›çš„æ˜¯åˆ†çº¿ç¨‹å…¨éƒ¨èµ°å®Œä¹‹åï¼Œä¸»çº¿ç¨‹å†èµ°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ­¤æ—¶éœ€è¦ä½¿ç”¨åˆ°CountDownLatch</li></ul><p>CountDownLatch ä¸­æœ‰ä¸¤ä¸ªæœ€é‡è¦çš„æ–¹æ³•</p><ol><li><p><code>countDown</code></p></li><li><p><code>await</code></p></li></ol><p><code>await æ–¹æ³•</code> æ˜¯é˜»å¡æ–¹æ³•ï¼Œ</p><ul><li><p>æˆ‘ä»¬æ‹…å¿ƒåˆ†çº¿ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œæ—¶ï¼Œmainçº¿ç¨‹å°±å…ˆæ‰§è¡Œï¼Œæ‰€ä»¥ä½¿ç”¨awaitå¯ä»¥è®©mainçº¿ç¨‹é˜»å¡ï¼Œ</p></li><li><p>é‚£ä¹ˆä»€ä¹ˆæ—¶å€™mainçº¿ç¨‹ä¸å†é˜»å¡å‘¢ï¼Ÿ</p><ul><li>å½“CountDownLatch  å†…éƒ¨ç»´æŠ¤çš„ å˜é‡å˜ä¸º0æ—¶ï¼Œå°±ä¸å†é˜»å¡ï¼Œç›´æ¥æ”¾è¡Œï¼Œ<ul><li>é‚£ä¹ˆä»€ä¹ˆæ—¶å€™CountDownLatch   ç»´æŠ¤çš„å˜é‡å˜ä¸º0 å‘¢ï¼Œ</li><li>æˆ‘ä»¬åªéœ€è¦è°ƒç”¨ä¸€æ¬¡countDown ï¼Œå†…éƒ¨å˜é‡å°±å‡å°‘1ï¼Œ</li><li>æˆ‘ä»¬è®©åˆ†çº¿ç¨‹å’Œå˜é‡ç»‘å®šï¼Œ æ‰§è¡Œå®Œä¸€ä¸ªåˆ†çº¿ç¨‹å°±å‡å°‘ä¸€ä¸ªå˜é‡ï¼Œ</li><li>å½“åˆ†çº¿ç¨‹å…¨éƒ¨èµ°å®Œï¼ŒCountDownLatch ç»´æŠ¤çš„å˜é‡å°±æ˜¯0ï¼Œ</li><li>æ­¤æ—¶awaitå°±ä¸å†é˜»å¡ï¼Œç»Ÿè®¡å‡ºæ¥çš„æ—¶é—´ä¹Ÿå°±æ˜¯æ‰€æœ‰åˆ†çº¿ç¨‹æ‰§è¡Œå®Œåçš„æ—¶é—´ã€‚</li></ul></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testIdWorker</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">300</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;id = &quot;</span> + id);</span><br><span class="line">        &#125;</span><br><span class="line">        latch.countDown();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">300</span>; i++) &#123;</span><br><span class="line">        es.submit(task);</span><br><span class="line">    &#125;</span><br><span class="line">    latch.await();</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;time = &quot;</span> + (end - begin));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="zong-jie" id="æ€»ç»“">æ€»ç»“</h3><p>å…¨å±€å”¯ä¸€IDç”Ÿæˆç­–ç•¥ï¼š</p><ul><li>UUID</li><li>Redis è‡ªå¢</li><li>snowflake ç®—æ³•</li><li>æ•°æ®åº“è‡ªå¢</li></ul><p>Redis è‡ªå¢IDç­–ç•¥ï¼š</p><ul><li>æ¯å¤©ä¸€ä¸ªkeyï¼Œæ–¹ä¾¿ç»Ÿè®¡è®¢å•é‡</li><li>IDæ„é€ æ˜¯ æ—¶é—´æˆ³ + è®¡æ•°å™¨</li></ul><h2 id="tian-jia-you-hui-juan" id="æ·»åŠ ä¼˜æƒ å·">æ·»åŠ ä¼˜æƒ å·</h2><p>æ¯ä¸ªåº—é“ºéƒ½å¯ä»¥å‘å¸ƒä¼˜æƒ åˆ¸ï¼Œåˆ†ä¸ºå¹³ä»·åˆ¸å’Œç‰¹ä»·åˆ¸ã€‚å¹³ä»·åˆ¸å¯ä»¥ä»»æ„è´­ä¹°ï¼Œè€Œç‰¹ä»·åˆ¸éœ€è¦ç§’æ€æŠ¢è´­ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/27/cf654d751e2c4161b698d271a5d99990" alt="1653365145124"></p><ul><li>tb_voucherï¼šä¼˜æƒ åˆ¸çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¼˜æƒ é‡‘é¢ã€ä½¿ç”¨è§„åˆ™ç­‰</li><li>tb_seckill_voucherï¼šä¼˜æƒ åˆ¸çš„åº“å­˜ã€å¼€å§‹æŠ¢è´­æ—¶é—´ï¼Œç»“æŸæŠ¢è´­æ—¶é—´ã€‚ç‰¹ä»·ä¼˜æƒ åˆ¸æ‰éœ€è¦å¡«å†™è¿™äº›ä¿¡æ¯</li></ul><p>å¹³ä»·å·ç”±äºä¼˜æƒ åŠ›åº¦å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥ä»»æ„é¢†å–</p><p>è€Œä»£é‡‘åˆ¸ç”±äºä¼˜æƒ åŠ›åº¦å¤§ï¼Œæ‰€ä»¥åƒç¬¬äºŒç§å·ï¼Œå°±å¾—é™åˆ¶æ•°é‡ï¼Œä»è¡¨ç»“æ„ä¸Šä¹Ÿèƒ½çœ‹å‡ºï¼Œç‰¹ä»·å·é™¤äº†å…·æœ‰ä¼˜æƒ å·çš„åŸºæœ¬ä¿¡æ¯ä»¥å¤–ï¼Œè¿˜å…·æœ‰åº“å­˜ï¼ŒæŠ¢è´­æ—¶é—´ï¼Œç»“æŸæ—¶é—´ç­‰ç­‰å­—æ®µ</p><p><strong>æ·»åŠ ç§’æ€åˆ¸Jsonæ•°æ®</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;shopId&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;100å…ƒä»£é‡‘åˆ¸&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;subTitle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å‘¨ä¸€è‡³å‘¨äº”å‡å¯ä½¿ç”¨&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rules&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å…¨åœºé€šç”¨\\næ— éœ€é¢„çº¦\\nå¯æ— é™å åŠ \\ä¸å…‘ç°ã€ä¸æ‰¾é›¶\\nä»…é™å ‚é£Ÿ&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;payValue&quot;</span><span class="punctuation">:</span> <span class="number">8000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;actualValue&quot;</span><span class="punctuation">:</span> <span class="number">10000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;stock&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;beginTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-03-28T10:00:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;endTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-04-01T10:00:00&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>æ–°å¢æ™®é€šåˆ¸ä»£ç </strong>ï¼š  VoucherController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">addVoucher</span><span class="params">(<span class="meta">@RequestBody</span> Voucher voucher)</span> &#123;</span><br><span class="line">    voucherService.save(voucher);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(voucher.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–°å¢ç§’æ€åˆ¸ä»£ç </strong>ï¼š<strong>VoucherController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;seckill&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">addSeckillVoucher</span><span class="params">(<span class="meta">@RequestBody</span> Voucher voucher)</span> &#123;</span><br><span class="line">    voucherService.addSeckillVoucher(voucher);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(voucher.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>VoucherServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSeckillVoucher</span><span class="params">(Voucher voucher)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜ä¼˜æƒ åˆ¸</span></span><br><span class="line">    save(voucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€ä¿¡æ¯</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">seckillVoucher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SeckillVoucher</span>();</span><br><span class="line">    seckillVoucher.setVoucherId(voucher.getId());</span><br><span class="line">    seckillVoucher.setStock(voucher.getStock());</span><br><span class="line">    seckillVoucher.setBeginTime(voucher.getBeginTime());</span><br><span class="line">    seckillVoucher.setEndTime(voucher.getEndTime());</span><br><span class="line">    seckillVoucherService.save(seckillVoucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€åº“å­˜åˆ°Redisä¸­</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(SECKILL_STOCK_KEY + voucher.getId(), voucher.getStock().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="shi-xian-miao-sha-xia-dan" id="å®ç°ç§’æ€ä¸‹å•">å®ç°ç§’æ€ä¸‹å•</h2><blockquote><p>ä¸‹å•æ ¸å¿ƒæ€è·¯ï¼šå½“æˆ‘ä»¬ç‚¹å‡»æŠ¢è´­æ—¶ï¼Œä¼šè§¦å‘å³ä¾§çš„è¯·æ±‚ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™å¯¹åº”çš„controllerå³å¯</p></blockquote><p><img src="https://s1.vika.cn/space/2023/03/27/d7c41f884e77465e8b71b49506f7df9e" alt="1653365839526"></p><p>ç§’æ€ä¸‹å•åº”è¯¥æ€è€ƒçš„å†…å®¹ï¼š</p><p>ä¸‹å•æ—¶éœ€è¦åˆ¤æ–­ä¸¤ç‚¹ï¼š</p><ul><li>ç§’æ€æ˜¯å¦å¼€å§‹æˆ–ç»“æŸï¼Œå¦‚æœå°šæœªå¼€å§‹æˆ–å·²ç»ç»“æŸåˆ™æ— æ³•ä¸‹å•</li><li>åº“å­˜æ˜¯å¦å……è¶³ï¼Œä¸è¶³åˆ™æ— æ³•ä¸‹å•</li></ul><p>ä¸‹å•æ ¸å¿ƒé€»è¾‘åˆ†æï¼š</p><ul><li><p>å½“ç”¨æˆ·å¼€å§‹è¿›è¡Œä¸‹å•ï¼Œæˆ‘ä»¬åº”å½“å»æŸ¥è¯¢ä¼˜æƒ å·ä¿¡æ¯ï¼ŒæŸ¥è¯¢åˆ°ä¼˜æƒ å·ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦æ»¡è¶³ç§’æ€æ¡ä»¶</p><ul><li><p>æ¯”å¦‚æ—¶é—´æ˜¯å¦å……è¶³ï¼Œå¦‚æœæ—¶é—´å……è¶³ï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­åº“å­˜æ˜¯å¦è¶³å¤Ÿï¼Œ</p></li><li><p>å¦‚æœä¸¤è€…éƒ½æ»¡è¶³ï¼Œåˆ™æ‰£å‡åº“å­˜ï¼Œåˆ›å»ºè®¢å•ï¼Œç„¶åè¿”å›è®¢å•idï¼Œ</p></li><li><p>å¦‚æœæœ‰ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³åˆ™ç›´æ¥ç»“æŸã€‚</p></li></ul></li></ul><p><img src="https://s1.vika.cn/space/2023/03/28/028067c216424fce8a575e8d0d7c4c7f" alt="1653366238564"></p><p><strong>VoucherOrderServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5ï¼Œæ‰£å‡åº“å­˜</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock= stock -1&quot;</span>)</span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update();</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="comment">//æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.åˆ›å»ºè®¢å•</span></span><br><span class="line">    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">    <span class="comment">// 6.1.è®¢å•id</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    voucherOrder.setId(orderId);</span><br><span class="line">    <span class="comment">// 6.2.ç”¨æˆ·id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    voucherOrder.setUserId(userId);</span><br><span class="line">    <span class="comment">// 6.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">    voucherOrder.setVoucherId(voucherId);</span><br><span class="line">    save(voucherOrder);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ku-cun-chao-mai-wen-ti-fen-xi" id="åº“å­˜è¶…å–é—®é¢˜åˆ†æ">åº“å­˜è¶…å–é—®é¢˜åˆ†æ</h2><p>æœ‰å…³è¶…å–é—®é¢˜åˆ†æï¼šåœ¨æˆ‘ä»¬åŸæœ‰ä»£ç ä¸­æ˜¯è¿™ä¹ˆå†™çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">       <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">       <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//5ï¼Œæ‰£å‡åº“å­˜</span></span><br><span class="line">   <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">           .setSql(<span class="string">&quot;stock= stock -1&quot;</span>)</span><br><span class="line">           .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update();</span><br><span class="line">   <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">       <span class="comment">//æ‰£å‡åº“å­˜</span></span><br><span class="line">       <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å‡è®¾çº¿ç¨‹1è¿‡æ¥æŸ¥è¯¢åº“å­˜ï¼Œåˆ¤æ–­å‡ºæ¥åº“å­˜å¤§äº1ï¼Œæ­£å‡†å¤‡å»æ‰£å‡åº“å­˜ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ¥å¾—åŠå»æ‰£å‡ï¼Œ</p><ul><li>æ­¤æ—¶çº¿ç¨‹2è¿‡æ¥ï¼Œçº¿ç¨‹2ä¹Ÿå»æŸ¥è¯¢åº“å­˜ï¼Œå‘ç°è¿™ä¸ªæ•°é‡ä¸€å®šä¹Ÿå¤§äº1ï¼Œ</li><li>é‚£ä¹ˆè¿™ä¸¤ä¸ªçº¿ç¨‹éƒ½ä¼šå»æ‰£å‡åº“å­˜ï¼Œæœ€ç»ˆå¤šä¸ªçº¿ç¨‹ç›¸å½“äºä¸€èµ·å»æ‰£å‡åº“å­˜ï¼Œ</li><li>æ­¤æ—¶å°±ä¼šå‡ºç°åº“å­˜çš„è¶…å–é—®é¢˜ã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/03/28/f8adc84aba1f4817aee1b74a31379719" alt="1653368335155"></p><p>è¶…å–é—®é¢˜æ˜¯å…¸å‹çš„å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œé’ˆå¯¹è¿™ä¸€é—®é¢˜çš„å¸¸è§è§£å†³æ–¹æ¡ˆå°±æ˜¯<strong>åŠ é”</strong>ï¼šè€Œå¯¹äºåŠ é”ï¼Œæˆ‘ä»¬é€šå¸¸æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šè§ä¸‹å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/28/2ef0233096d64ebbb087f67ecbc56845" alt="1653368562591"></p><p><strong>æ‚²è§‚é”ï¼š</strong></p><p>æ‚²è§‚é”å¯ä»¥å®ç°å¯¹äºæ•°æ®çš„ä¸²è¡ŒåŒ–æ‰§è¡Œï¼Œ</p><ul><li>æ¯”å¦‚synï¼Œå’Œlockéƒ½æ˜¯æ‚²è§‚é”çš„ä»£è¡¨ï¼Œ</li><li>åŒæ—¶ï¼Œæ‚²è§‚é”ä¸­åˆå¯ä»¥å†ç»†åˆ†ä¸ºå…¬å¹³é”ï¼Œéå…¬å¹³é”ï¼Œå¯é‡å…¥é”ï¼Œç­‰ç­‰</li></ul><p><strong>ä¹è§‚é”ï¼š</strong></p><p>ä¼šæœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ“ä½œæ•°æ®ä¼šå¯¹ç‰ˆæœ¬å·+1ï¼Œ</p><ul><li>å†æäº¤å›æ•°æ®æ—¶ï¼Œä¼šå»æ ¡éªŒæ˜¯å¦æ¯”ä¹‹å‰çš„ç‰ˆæœ¬å¤§1 ï¼Œå¦‚æœå¤§1 ï¼Œåˆ™è¿›è¡Œæ“ä½œæˆåŠŸï¼Œ</li><li>è¿™å¥—æœºåˆ¶çš„æ ¸å¿ƒé€»è¾‘åœ¨äºï¼Œå¦‚æœåœ¨æ“ä½œè¿‡ç¨‹ä¸­ï¼Œç‰ˆæœ¬å·åªæ¯”åŸæ¥å¤§1 ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€æ“ä½œè¿‡ç¨‹ä¸­æ²¡æœ‰äººå¯¹ä»–è¿›è¡Œè¿‡ä¿®æ”¹ï¼Œä»–çš„æ“ä½œå°±æ˜¯å®‰å…¨çš„ï¼Œ</li><li>å¦‚æœä¸å¤§1ï¼Œåˆ™æ•°æ®è¢«ä¿®æ”¹è¿‡ï¼Œå½“ç„¶ä¹è§‚é”è¿˜æœ‰ä¸€äº›å˜ç§çš„å¤„ç†æ–¹å¼æ¯”å¦‚cas</li></ul><p>1ã€ä¹è§‚é”çš„å…¸å‹ä»£è¡¨ï¼šå°±æ˜¯<strong>cas</strong>ï¼Œ</p><ul><li><p>åˆ©ç”¨casè¿›è¡Œæ— é”åŒ–æœºåˆ¶åŠ é”ï¼Œvar5 æ˜¯æ“ä½œå‰è¯»å–çš„å†…å­˜å€¼ï¼Œ</p></li><li><p>whileä¸­çš„var1+var2 æ˜¯é¢„ä¼°å€¼ï¼Œå¦‚æœé¢„ä¼°å€¼ == å†…å­˜å€¼ï¼Œåˆ™ä»£è¡¨ä¸­é—´æ²¡æœ‰è¢«äººä¿®æ”¹è¿‡ï¼Œæ­¤æ—¶å°±å°†æ–°å€¼å»æ›¿æ¢ å†…å­˜å€¼</p></li><li><p>å…¶ä¸­do while æ˜¯ä¸ºäº†åœ¨æ“ä½œå¤±è´¥æ—¶ï¼Œå†æ¬¡è¿›è¡Œè‡ªæ—‹æ“ä½œï¼Œå³æŠŠä¹‹å‰çš„é€»è¾‘å†æ“ä½œä¸€æ¬¡ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> var5;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    var5 = <span class="built_in">this</span>.getIntVolatile(var1, var2);</span><br><span class="line">&#125; <span class="keyword">while</span>(!<span class="built_in">this</span>.compareAndSwapInt(var1, var2, var5, var5 + var4));</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> var5;</span><br></pre></td></tr></table></figure><p>2ã€<strong>è¯¾ç¨‹ä¸­çš„ä½¿ç”¨æ–¹å¼ï¼š</strong></p><p>è¯¾ç¨‹ä¸­çš„ä½¿ç”¨æ–¹å¼æ˜¯æ²¡æœ‰åƒcasä¸€æ ·å¸¦è‡ªæ—‹çš„æ“ä½œï¼Œä¹Ÿæ²¡æœ‰å¯¹versionçš„ç‰ˆæœ¬å·+1 ï¼Œ</p><ul><li>ä»–çš„æ“ä½œé€»è¾‘æ˜¯åœ¨æ“ä½œæ—¶ï¼Œå¯¹ç‰ˆæœ¬å·è¿›è¡Œ+1 æ“ä½œï¼Œ</li><li>ç„¶åè¦æ±‚version å¦‚æœæ˜¯1 çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½æ“ä½œï¼Œ</li><li>é‚£ä¹ˆç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œåï¼Œæ•°æ®åº“ä¸­çš„versionå˜æˆäº†2ï¼Œä½†æ˜¯ä»–è‡ªå·±æ»¡è¶³version=1 ï¼Œæ‰€ä»¥æ²¡æœ‰é—®é¢˜ï¼Œ</li><li>æ­¤æ—¶çº¿ç¨‹2æ‰§è¡Œï¼Œçº¿ç¨‹2 æœ€åä¹Ÿéœ€è¦åŠ ä¸Šæ¡ä»¶version =1 ï¼Œä½†æ˜¯ç°åœ¨ç”±äºçº¿ç¨‹1å·²ç»æ“ä½œè¿‡äº†ï¼Œ</li><li>æ‰€ä»¥çº¿ç¨‹2ï¼Œæ“ä½œæ—¶å°±ä¸æ»¡è¶³version=1 çš„æ¡ä»¶äº†ï¼Œæ‰€ä»¥çº¿ç¨‹2æ— æ³•æ‰§è¡ŒæˆåŠŸ</li></ul><p><img src="https://s1.vika.cn/space/2023/03/28/680ce4a851014890a33b7fb8cff9702f" alt="1653369268550"></p><h2 id="le-guan-suo-jie-jue-chao-mai-wen-ti" id="ä¹è§‚é”è§£å†³è¶…å–é—®é¢˜">ä¹è§‚é”è§£å†³è¶…å–é—®é¢˜</h2><p><strong>ä¿®æ”¹ä»£ç æ–¹æ¡ˆä¸€</strong></p><p>VoucherOrderServiceImpl åœ¨æ‰£å‡åº“å­˜æ—¶ï¼Œæ”¹ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock= stock -1&quot;</span>) <span class="comment">//set stock = stock -1</span></span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).eq(<span class="string">&quot;stock&quot;</span>,voucher.getStock()).update(); <span class="comment">//where id = ï¼Ÿ and stock = ?</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šé€»è¾‘çš„æ ¸å¿ƒå«ä¹‰æ˜¯ï¼š</p><ul><li>åªè¦æˆ‘æ‰£å‡åº“å­˜æ—¶çš„åº“å­˜å’Œä¹‹å‰æˆ‘æŸ¥è¯¢åˆ°çš„åº“å­˜æ˜¯ä¸€æ ·çš„ï¼Œå°±æ„å‘³ç€æ²¡æœ‰äººåœ¨ä¸­é—´ä¿®æ”¹è¿‡åº“å­˜ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±æ˜¯å®‰å…¨çš„ï¼Œ</li><li>ä½†æ˜¯ä»¥ä¸Šè¿™ç§æ–¹å¼é€šè¿‡æµ‹è¯•å‘ç°ä¼šæœ‰å¾ˆå¤šå¤±è´¥çš„æƒ…å†µï¼Œ<ul><li>å¤±è´¥çš„åŸå› ï¼šåœ¨ä½¿ç”¨ä¹è§‚é”è¿‡ç¨‹ä¸­å‡è®¾100ä¸ªçº¿ç¨‹åŒæ—¶éƒ½æ‹¿åˆ°äº†100çš„åº“å­˜ï¼Œç„¶åå¤§å®¶ä¸€èµ·å»è¿›è¡Œæ‰£å‡ï¼Œ</li><li>ä½†æ˜¯100ä¸ªäººä¸­åªæœ‰1ä¸ªäººèƒ½æ‰£å‡æˆåŠŸï¼Œå…¶ä»–çš„äººåœ¨å¤„ç†æ—¶ï¼Œä»–ä»¬åœ¨æ‰£å‡æ—¶ï¼Œåº“å­˜å·²ç»è¢«ä¿®æ”¹è¿‡äº†ï¼Œæ‰€ä»¥æ­¤æ—¶å…¶ä»–çº¿ç¨‹éƒ½ä¼šå¤±è´¥</li></ul></li></ul><p><strong>ä¿®æ”¹ä»£ç æ–¹æ¡ˆäºŒ</strong></p><p>ä¹‹å‰çš„æ–¹å¼è¦ä¿®æ”¹å‰åéƒ½ä¿æŒä¸€è‡´ï¼Œä½†æ˜¯è¿™æ ·æˆ‘ä»¬åˆ†æè¿‡ï¼ŒæˆåŠŸçš„æ¦‚ç‡å¤ªä½ï¼Œ</p><ul><li>æ‰€ä»¥æˆ‘ä»¬çš„ä¹è§‚é”éœ€è¦å˜ä¸€ä¸‹ï¼Œæ”¹æˆstockå¤§äº0 å³å¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock= stock -1&quot;</span>)</span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update().gt(<span class="string">&quot;stock&quot;</span>,<span class="number">0</span>); <span class="comment">//where id = ? and stock &gt; 0</span></span><br></pre></td></tr></table></figure><h3 id="zhi-shi-xiao-kuo-zhan" id="çŸ¥è¯†å°æ‰©å±•ï¼š">çŸ¥è¯†å°æ‰©å±•ï¼š</h3><p>é’ˆå¯¹casä¸­çš„è‡ªæ—‹å‹åŠ›è¿‡å¤§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Longaddrè¿™ä¸ªç±»å»è§£å†³</p><ul><li>Java8 æä¾›çš„ä¸€ä¸ªå¯¹AtomicLongæ”¹è¿›åçš„ä¸€ä¸ªç±»ï¼ŒLongAdder</li></ul><p>å¤§é‡çº¿ç¨‹å¹¶å‘æ›´æ–°ä¸€ä¸ªåŸå­æ€§çš„æ—¶å€™ï¼Œå¤©ç„¶çš„é—®é¢˜å°±æ˜¯è‡ªæ—‹ï¼Œä¼šå¯¼è‡´å¹¶å‘æ€§é—®é¢˜ï¼Œå½“ç„¶è¿™ä¹Ÿæ¯”æˆ‘ä»¬ç›´æ¥ä½¿ç”¨synæ¥çš„å¥½</p><p>æ‰€ä»¥åˆ©ç”¨è¿™ä¹ˆä¸€ä¸ªç±»ï¼ŒLongAdderæ¥è¿›è¡Œä¼˜åŒ–</p><p>å¦‚æœè·å–æŸä¸ªå€¼ï¼Œåˆ™ä¼šå¯¹cellå’Œbaseçš„å€¼è¿›è¡Œé€’å¢ï¼Œæœ€åè¿”å›ä¸€ä¸ªå®Œæ•´çš„å€¼</p><p><img src="https://s1.vika.cn/space/2023/03/28/15a8f01ac4e04508abe2c2f8f998493d" alt="1653370271627"></p><h3 id="zong-jie-1" id="æ€»ç»“-2">æ€»ç»“</h3><p>è¶…å–è¿™æ ·çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ</p><ol><li>æ‚²è§‚é”ï¼šæ·»åŠ åŒæ­¥é”ï¼Œè®©çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œ<ul><li>ä¼˜ç‚¹ï¼šç®€å•ç²—æš´</li><li>ç¼ºç‚¹ï¼šæ€§èƒ½ä¸€èˆ¬</li></ul></li><li>ä¹è§‚é”ï¼šä¸åŠ é”ï¼Œåœ¨æ›´æ–°æ—¶åˆ¤æ–­æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹åœ¨ä¿®æ”¹<ul><li>ä¼˜ç‚¹ï¼šæ€§èƒ½å¥½</li><li>ç¼ºç‚¹ï¼šå­˜åœ¨æˆåŠŸç‡ä½çš„é—®é¢˜</li></ul></li></ol><h2 id="you-hui-quan-miao-sha-yi-ren-yi-dan" id="ä¼˜æƒ åˆ¸ç§’æ€â€”ä¸€äººä¸€å•">ä¼˜æƒ åˆ¸ç§’æ€â€”ä¸€äººä¸€å•</h2><blockquote><p>éœ€æ±‚ï¼šä¿®æ”¹ç§’æ€ä¸šåŠ¡ï¼Œè¦æ±‚åŒä¸€ä¸ªä¼˜æƒ åˆ¸ï¼Œä¸€ä¸ªç”¨æˆ·åªèƒ½ä¸‹ä¸€å•</p></blockquote><p><strong>ç°åœ¨çš„é—®é¢˜åœ¨äº</strong>ï¼š</p><p>ä¼˜æƒ å·æ˜¯ä¸ºäº†å¼•æµï¼Œ</p><ul><li>ä½†æ˜¯ç›®å‰çš„æƒ…å†µæ˜¯ï¼Œä¸€ä¸ªäººå¯ä»¥æ— é™åˆ¶çš„æŠ¢è¿™ä¸ªä¼˜æƒ å·ï¼Œ</li><li>æ‰€ä»¥æˆ‘ä»¬åº”å½“å¢åŠ ä¸€å±‚é€»è¾‘ï¼Œè®©ä¸€ä¸ªç”¨æˆ·åªèƒ½ä¸‹ä¸€ä¸ªå•ï¼Œè€Œä¸æ˜¯è®©ä¸€ä¸ªç”¨æˆ·ä¸‹å¤šä¸ªå•</li></ul><p>å…·ä½“æ“ä½œé€»è¾‘å¦‚ä¸‹ï¼š</p><ul><li>æ¯”å¦‚æ—¶é—´æ˜¯å¦å……è¶³ï¼Œå¦‚æœæ—¶é—´å……è¶³ï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­åº“å­˜æ˜¯å¦è¶³å¤Ÿï¼Œ</li><li>ç„¶åå†æ ¹æ®ä¼˜æƒ å·idå’Œç”¨æˆ·idæŸ¥è¯¢æ˜¯å¦å·²ç»ä¸‹è¿‡è¿™ä¸ªè®¢å•ï¼Œå¦‚æœä¸‹è¿‡è¿™ä¸ªè®¢å•ï¼Œåˆ™ä¸å†ä¸‹å•ï¼Œå¦åˆ™è¿›è¡Œä¸‹å•</li></ul><p><img src="https://s1.vika.cn/space/2023/03/28/afbe65edeb8a45108331471469741e22" alt="1653371854389"></p><p>VoucherOrderServiceImpl</p><p><strong>åˆæ­¥ä»£ç ï¼šå¢åŠ ä¸€äººä¸€å•é€»è¾‘</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.ä¸€äººä¸€å•é€»è¾‘</span></span><br><span class="line">    <span class="comment">// 5.1.ç”¨æˆ·id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">    <span class="comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6ï¼Œæ‰£å‡åº“å­˜</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock= stock -1&quot;</span>)</span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update();</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="comment">//æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//7.åˆ›å»ºè®¢å•</span></span><br><span class="line">    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">    <span class="comment">// 7.1.è®¢å•id</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    voucherOrder.setId(orderId);</span><br><span class="line"></span><br><span class="line">    voucherOrder.setUserId(userId);</span><br><span class="line">    <span class="comment">// 7.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">    voucherOrder.setVoucherId(voucherId);</span><br><span class="line">    save(voucherOrder);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>**å­˜åœ¨é—®é¢˜ï¼š**ç°åœ¨çš„é—®é¢˜è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼Œ</p><ul><li>å¹¶å‘è¿‡æ¥ï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œéƒ½ä¸å­˜åœ¨è®¢å•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯éœ€è¦åŠ é”ï¼Œ</li><li>ä½†æ˜¯ä¹è§‚é”æ¯”è¾ƒé€‚åˆæ›´æ–°æ•°æ®ï¼Œè€Œç°åœ¨æ˜¯æ’å…¥æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ‚²è§‚é”æ“ä½œ</li></ul><p>**æ³¨æ„ï¼š**åœ¨è¿™é‡Œæåˆ°äº†éå¸¸å¤šçš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ…¢æ…¢çš„æ¥æ€è€ƒï¼Œé¦–å…ˆæˆ‘ä»¬çš„åˆå§‹æ–¹æ¡ˆæ˜¯å°è£…äº†ä¸€ä¸ªcreateVoucherOrderæ–¹æ³•ï¼ŒåŒæ—¶ä¸ºäº†ç¡®ä¿ä»–çº¿ç¨‹å®‰å…¨ï¼Œåœ¨æ–¹æ³•ä¸Šæ·»åŠ äº†ä¸€æŠŠsynchronized é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> Result <span class="title function_">createVoucherOrder</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">         <span class="comment">// 5.1.æŸ¥è¯¢è®¢å•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">        <span class="comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>) <span class="comment">// set stock = stock - 1</span></span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).gt(<span class="string">&quot;stock&quot;</span>, <span class="number">0</span>) <span class="comment">// where id = ? and stock &gt; 0</span></span><br><span class="line">                .update();</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            <span class="comment">// æ‰£å‡å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">        <span class="comment">// 7.1.è®¢å•id</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        voucherOrder.setId(orderId);</span><br><span class="line">        <span class="comment">// 7.2.ç”¨æˆ·id</span></span><br><span class="line">        voucherOrder.setUserId(userId);</span><br><span class="line">        <span class="comment">// 7.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">        voucherOrder.setVoucherId(voucherId);</span><br><span class="line">        save(voucherOrder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.è¿”å›è®¢å•id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·æ·»åŠ é”ï¼Œé”çš„ç²’åº¦å¤ªç²—äº†ï¼Œ</p><ul><li>åœ¨ä½¿ç”¨é”è¿‡ç¨‹ä¸­ï¼Œæ§åˆ¶<strong>é”ç²’åº¦</strong> æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„äº‹æƒ…ï¼Œ</li><li>å› ä¸ºå¦‚æœé”çš„ç²’åº¦å¤ªå¤§ï¼Œä¼šå¯¼è‡´æ¯ä¸ªçº¿ç¨‹è¿›æ¥éƒ½ä¼šé”ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»æ§åˆ¶é”çš„ç²’åº¦ï¼Œ</li><li>ä»¥ä¸‹è¿™æ®µä»£ç éœ€è¦ä¿®æ”¹ä¸ºï¼š<ul><li>intern() è¿™ä¸ªæ–¹æ³•æ˜¯ä»å¸¸é‡æ± ä¸­æ‹¿åˆ°æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨userId.toString() ä»–æ‹¿åˆ°çš„å¯¹è±¡å®é™…ä¸Šæ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œnewå‡ºæ¥çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ä½¿ç”¨é”å¿…é¡»ä¿è¯é”å¿…é¡»æ˜¯åŒä¸€æŠŠï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨intern()æ–¹æ³•</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span>  Result <span class="title function_">createVoucherOrder</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line"><span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line"><span class="keyword">synchronized</span>(userId.toString().intern())&#123;</span><br><span class="line">         <span class="comment">// 5.1.æŸ¥è¯¢è®¢å•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">        <span class="comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>) <span class="comment">// set stock = stock - 1</span></span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).gt(<span class="string">&quot;stock&quot;</span>, <span class="number">0</span>) <span class="comment">// where id = ? and stock &gt; 0</span></span><br><span class="line">                .update();</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            <span class="comment">// æ‰£å‡å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">        <span class="comment">// 7.1.è®¢å•id</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        voucherOrder.setId(orderId);</span><br><span class="line">        <span class="comment">// 7.2.ç”¨æˆ·id</span></span><br><span class="line">        voucherOrder.setUserId(userId);</span><br><span class="line">        <span class="comment">// 7.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">        voucherOrder.setVoucherId(voucherId);</span><br><span class="line">        save(voucherOrder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.è¿”å›è®¢å•id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä»¥ä¸Šä»£ç è¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼Œ</p><ul><li>é—®é¢˜çš„åŸå› åœ¨äºå½“å‰æ–¹æ³•è¢«springçš„äº‹åŠ¡æ§åˆ¶ï¼Œ</li><li>å¦‚æœä½ åœ¨æ–¹æ³•å†…éƒ¨åŠ é”ï¼Œå¯èƒ½ä¼šå¯¼è‡´å½“å‰æ–¹æ³•äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤ï¼Œä½†æ˜¯é”å·²ç»é‡Šæ”¾ä¹Ÿä¼šå¯¼è‡´é—®é¢˜ï¼Œ</li><li>æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©å°†å½“å‰æ–¹æ³•æ•´ä½“åŒ…è£¹èµ·æ¥ï¼Œç¡®ä¿äº‹åŠ¡ä¸ä¼šå‡ºç°é—®é¢˜ï¼šå¦‚ä¸‹ï¼š</li></ul><p>åœ¨seckillVoucher æ–¹æ³•ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹é€»è¾‘ï¼Œè¿™æ ·å°±èƒ½ä¿è¯äº‹åŠ¡çš„ç‰¹æ€§ï¼ŒåŒæ—¶ä¹Ÿæ§åˆ¶äº†é”çš„ç²’åº¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line"><span class="keyword">synchronized</span> (userId.toString().intern()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.createVoucherOrder(voucherId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä»¥ä¸Šåšæ³•ä¾ç„¶æœ‰é—®é¢˜ï¼Œ</p><ul><li>å› ä¸ºä½ è°ƒç”¨çš„æ–¹æ³•ï¼Œå…¶å®æ˜¯this.çš„æ–¹å¼è°ƒç”¨çš„ï¼Œ</li><li>äº‹åŠ¡æƒ³è¦ç”Ÿæ•ˆï¼Œè¿˜å¾—åˆ©ç”¨ä»£ç†æ¥ç”Ÿæ•ˆï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—åŸå§‹çš„äº‹åŠ¡å¯¹è±¡ï¼Œ æ¥æ“ä½œäº‹åŠ¡</li></ul><p>æ­¤å¤„é€šè¿‡ <code>AopContext.currentProxy()</code> æ–¹æ³•è·å–ä»£ç†å¯¹è±¡ <code>IVoucherOrderService</code></p><div class="tabs" id="proxytransactional"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#proxytransactional-1">AopContext</button></li><li class="tab"><button type="button" data-href="#proxytransactional-2">å®Œæ•´ä»£ç </button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="proxytransactional-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line"><span class="keyword">synchronized</span> (userId.toString().intern()) &#123;</span><br><span class="line">    <span class="comment">// è·å–ä»£ç†å¯¹è±¡ï¼ˆäº‹åŠ¡ï¼‰</span></span><br><span class="line">    <span class="type">IVoucherOrderService</span> <span class="variable">proxy</span> <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">    <span class="keyword">return</span> proxy.createVoucherOrder(voucherId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="proxytransactional-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;VoucherOrderMapper, VoucherOrder&gt; <span class="keyword">implements</span> <span class="title class_">IVoucherOrderService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ISeckillVoucherService seckillVoucherService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisIdWorker redisIdWorker;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">        <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">        <span class="comment">// 2. åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4. åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="keyword">synchronized</span> (userId.toString().intern()) &#123;</span><br><span class="line">            <span class="comment">// è·å–ä»£ç†å¯¹è±¡ï¼ˆäº‹åŠ¡ï¼‰</span></span><br><span class="line">            <span class="type">IVoucherOrderService</span> <span class="variable">proxy</span> <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">            <span class="keyword">return</span> proxy.createVoucherOrder(voucherId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">createVoucherOrder</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">        <span class="comment">// 5. ä¸€äººä¸€å•</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.1 æŸ¥è¯¢è®¢å•</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">        <span class="comment">// 5.2 åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·å·²ç»ä¹°è¿‡ä¸€æ¬¡&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6. æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>)</span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).gt(<span class="string">&quot;stock&quot;</span>, <span class="number">0</span>)</span><br><span class="line">                .update();</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            <span class="comment">// æ‰£æ¬¾å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 7. åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">        <span class="comment">// 7.1 è®¢å•id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        voucherOrder.setId(orderId);</span><br><span class="line">        <span class="comment">// 7.2 ç”¨æˆ·id</span></span><br><span class="line">        voucherOrder.setUserId(userId);</span><br><span class="line">        <span class="comment">// 7.3 ä»£é‡‘åˆ¸id</span></span><br><span class="line">        voucherOrder.setVoucherId(voucherId);</span><br><span class="line">        save(voucherOrder);</span><br><span class="line">        <span class="comment">// 8. è¿”å›è®¢å•id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="ji-qun-huan-jing-xia-de-bing-fa-wen-ti" id="é›†ç¾¤ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜">é›†ç¾¤ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜</h2><p>é€šè¿‡åŠ é”å¯ä»¥è§£å†³åœ¨å•æœºæƒ…å†µä¸‹çš„ä¸€äººä¸€å•å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯åœ¨é›†ç¾¤æ¨¡å¼ä¸‹å°±ä¸è¡Œäº†ã€‚</p><p>1ã€æˆ‘ä»¬å°†æœåŠ¡å¯åŠ¨ä¸¤ä»½ï¼Œç«¯å£åˆ†åˆ«ä¸º8081å’Œ8082ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/28/116647f19b654f4b84808539e1955410" alt="1653373887844"></p><p>2ã€ç„¶åä¿®æ”¹nginxçš„confç›®å½•ä¸‹çš„nginx.confæ–‡ä»¶ï¼Œé…ç½®åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/28/87bdf71a748f463f8d56991cab915b6d" alt="1653373908620"></p><p><strong>å…·ä½“æ“ä½œ(ç•¥)</strong></p><p><strong>æœ‰å…³é”å¤±æ•ˆåŸå› åˆ†æ</strong></p><p>ç”±äºç°åœ¨æˆ‘ä»¬éƒ¨ç½²äº†å¤šä¸ªtomcatï¼Œæ¯ä¸ªtomcatéƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„jvmï¼Œ</p><ul><li>é‚£ä¹ˆå‡è®¾åœ¨æœåŠ¡å™¨Açš„tomcatå†…éƒ¨ï¼Œæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹ç”±äºä½¿ç”¨çš„æ˜¯åŒä¸€ä»½ä»£ç ï¼Œ</li><li>é‚£ä¹ˆä»–ä»¬çš„é”å¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼Œæ˜¯å¯ä»¥å®ç°äº’æ–¥çš„ï¼Œä½†æ˜¯å¦‚æœç°åœ¨æ˜¯æœåŠ¡å™¨Bçš„tomcatå†…éƒ¨ï¼Œåˆæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œ</li><li>ä½†æ˜¯ä»–ä»¬çš„é”å¯¹è±¡å†™çš„è™½ç„¶å’ŒæœåŠ¡å™¨Aä¸€æ ·ï¼Œä½†æ˜¯é”å¯¹è±¡å´ä¸æ˜¯åŒä¸€ä¸ªï¼Œæ‰€ä»¥çº¿ç¨‹3å’Œçº¿ç¨‹4å¯ä»¥å®ç°äº’æ–¥ï¼Œ</li><li>ä½†æ˜¯å´æ— æ³•å’Œçº¿ç¨‹1å’Œçº¿ç¨‹2å®ç°äº’æ–¥ï¼Œè¿™å°±æ˜¯ é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œsyné”å¤±æ•ˆçš„åŸå› ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/03/28/2517de6f319d45dcae8cfe9252624346" alt="1653374044740"></p><h1 id="fen-bu-shi-suo">åˆ†å¸ƒå¼é”</h1><h2 id="ji-ben-yuan-li-he-shi-xian-fang-shi-dui-bi" id="åŸºæœ¬åŸç†å’Œå®ç°æ–¹å¼å¯¹æ¯”">åŸºæœ¬åŸç†å’Œå®ç°æ–¹å¼å¯¹æ¯”</h2><blockquote><p>åˆ†å¸ƒå¼é”ï¼šæ»¡è¶³åˆ†å¸ƒå¼ç³»ç»Ÿæˆ–é›†ç¾¤æ¨¡å¼ä¸‹å¤šè¿›ç¨‹å¯è§å¹¶ä¸”äº’æ–¥çš„é”ã€‚</p></blockquote><p>åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯è®©å¤§å®¶éƒ½ä½¿ç”¨åŒä¸€æŠŠé”ï¼Œåªè¦å¤§å®¶ä½¿ç”¨çš„æ˜¯åŒä¸€æŠŠé”ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½é”ä½çº¿ç¨‹ï¼Œä¸è®©çº¿ç¨‹è¿›è¡Œï¼Œè®©ç¨‹åºä¸²è¡Œæ‰§è¡Œï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ€è·¯</p><p><img src="https://s1.vika.cn/space/2023/03/28/f49fec411f0940a38e55557a67b69d19" alt="1653374296906"></p><p>é‚£ä¹ˆåˆ†å¸ƒå¼é”ä»–åº”è¯¥æ»¡è¶³ä¸€äº›ä»€ä¹ˆæ ·çš„æ¡ä»¶å‘¢ï¼Ÿ</p><ul><li><p><strong>å¯è§æ€§</strong>ï¼šå¤šä¸ªçº¿ç¨‹éƒ½èƒ½çœ‹åˆ°ç›¸åŒçš„ç»“æœï¼Œæ³¨æ„ï¼šè¿™ä¸ªåœ°æ–¹è¯´çš„å¯è§æ€§å¹¶ä¸æ˜¯å¹¶å‘ç¼–ç¨‹ä¸­æŒ‡çš„å†…å­˜å¯è§æ€§ï¼Œåªæ˜¯è¯´å¤šä¸ªè¿›ç¨‹ä¹‹é—´éƒ½èƒ½æ„ŸçŸ¥åˆ°å˜åŒ–çš„æ„æ€</p></li><li><p><strong>äº’æ–¥</strong>ï¼šäº’æ–¥æ˜¯åˆ†å¸ƒå¼é”çš„æœ€åŸºæœ¬çš„æ¡ä»¶ï¼Œä½¿å¾—ç¨‹åºä¸²è¡Œæ‰§è¡Œ</p></li><li><p><strong>é«˜å¯ç”¨</strong>ï¼šç¨‹åºä¸æ˜“å´©æºƒï¼Œæ—¶æ—¶åˆ»åˆ»éƒ½ä¿è¯è¾ƒé«˜çš„å¯ç”¨æ€§</p></li><li><p><strong>é«˜æ€§èƒ½</strong>ï¼šç”±äºåŠ é”æœ¬èº«å°±è®©æ€§èƒ½é™ä½ï¼Œæ‰€æœ‰å¯¹äºåˆ†å¸ƒå¼é”æœ¬èº«éœ€è¦ä»–å°±è¾ƒé«˜çš„åŠ é”æ€§èƒ½å’Œé‡Šæ”¾é”æ€§èƒ½</p></li><li><p><strong>å®‰å…¨æ€§</strong>ï¼šå®‰å…¨ä¹Ÿæ˜¯ç¨‹åºä¸­å¿…ä¸å¯å°‘çš„ä¸€ç¯</p></li></ul><p><img src="https://s1.vika.cn/space/2023/03/28/20f3854ed2f840e68c3be823804dbfb9" alt="1653381992018"></p><p>å¸¸è§çš„åˆ†å¸ƒå¼é”æœ‰ä¸‰ç§</p><ul><li><p><strong>Mysql</strong>ï¼šmysqlæœ¬èº«å°±å¸¦æœ‰é”æœºåˆ¶ï¼Œä½†æ˜¯ç”±äºmysqlæ€§èƒ½æœ¬èº«ä¸€èˆ¬ï¼Œæ‰€ä»¥é‡‡ç”¨åˆ†å¸ƒå¼é”çš„æƒ…å†µä¸‹ï¼Œå…¶å®ä½¿ç”¨mysqlä½œä¸ºåˆ†å¸ƒå¼é”æ¯”è¾ƒå°‘è§</p></li><li><p><strong>Redis</strong>ï¼šredisä½œä¸ºåˆ†å¸ƒå¼é”æ˜¯éå¸¸å¸¸è§çš„ä¸€ç§ä½¿ç”¨æ–¹å¼ï¼Œç°åœ¨ä¼ä¸šçº§å¼€å‘ä¸­åŸºæœ¬éƒ½ä½¿ç”¨redisæˆ–è€…zookeeperä½œä¸ºåˆ†å¸ƒå¼é”ï¼Œåˆ©ç”¨setnxè¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœæ’å…¥keyæˆåŠŸï¼Œåˆ™è¡¨ç¤ºè·å¾—åˆ°äº†é”ï¼Œå¦‚æœæœ‰äººæ’å…¥æˆåŠŸï¼Œå…¶ä»–äººæ’å…¥å¤±è´¥åˆ™è¡¨ç¤ºæ— æ³•è·å¾—åˆ°é”ï¼Œåˆ©ç”¨è¿™å¥—é€»è¾‘æ¥å®ç°åˆ†å¸ƒå¼é”</p></li><li><p><strong>Zookeeper</strong>ï¼šzookeeperä¹Ÿæ˜¯ä¼ä¸šçº§å¼€å‘ä¸­è¾ƒå¥½çš„ä¸€ä¸ªå®ç°åˆ†å¸ƒå¼é”çš„æ–¹æ¡ˆï¼Œç”±äºæœ¬å¥—è§†é¢‘å¹¶ä¸è®²è§£zookeeperçš„åŸç†å’Œåˆ†å¸ƒå¼é”çš„å®ç°ï¼Œæ‰€ä»¥ä¸è¿‡å¤šé˜è¿°</p></li></ul><p><img src="https://s1.vika.cn/space/2023/03/28/67da817556504abcbed4e8510371dd80" alt="1653382219377"></p><h2 id="redis-fen-bu-shi-suo-de-shi-xian-he-xin-si-lu" id="Redisåˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯">Redisåˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯</h2><p>å®ç°åˆ†å¸ƒå¼é”æ—¶éœ€è¦å®ç°çš„ä¸¤ä¸ªåŸºæœ¬æ–¹æ³•ï¼š</p><ul><li><p>è·å–é”ï¼š</p><ul><li>äº’æ–¥ï¼šç¡®ä¿åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–é”</li><li>éé˜»å¡ï¼šå°è¯•ä¸€æ¬¡ï¼ŒæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false</li></ul></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ é”ï¼Œåˆ©ç”¨setnxçš„äº’æ–¥ç‰¹æ€§</span></span><br><span class="line">SETNX lock thread1</span><br><span class="line"><span class="comment"># æ·»åŠ é”è¿‡æœŸæ—¶é—´ï¼Œé¿å…æœåŠ¡å®•æœºå¼•èµ·çš„æ­»é”ï¼Œä½†æ˜¯å¯èƒ½è¿˜æœªæ‰§è¡Œå°±å·²å®•æœº</span></span><br><span class="line">EXPIRE lock 10</span><br><span class="line"><span class="comment"># æ·»åŠ é”ï¼ŒNXæ˜¯äº’æ–¥ï¼ŒEXæ˜¯è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œæœ€ç»ˆæ–¹å¼</span></span><br><span class="line">SET lock thread1 NX EX 10</span><br></pre></td></tr></table></figure><ul><li><p>é‡Šæ”¾é”ï¼š</p><ul><li>æ‰‹åŠ¨é‡Šæ”¾</li><li>è¶…æ—¶é‡Šæ”¾ï¼šè·å–é”æ—¶æ·»åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´</li></ul></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡Šæ”¾é”ï¼Œåˆ é™¤å³å¯</span></span><br><span class="line">DEL thread1</span><br></pre></td></tr></table></figure><p><strong>æ ¸å¿ƒæ€è·¯</strong>ï¼š</p><p>æˆ‘ä»¬åˆ©ç”¨redis çš„setNx æ–¹æ³•ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹è¿›å…¥æ—¶ï¼Œæˆ‘ä»¬å°±åˆ©ç”¨è¯¥æ–¹æ³•ï¼Œ</p><ul><li>ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›å…¥æ—¶ï¼Œredis ä¸­å°±æœ‰è¿™ä¸ªkey äº†ï¼Œè¿”å›äº†1ï¼Œå¦‚æœç»“æœæ˜¯1ï¼Œåˆ™è¡¨ç¤ºä»–æŠ¢åˆ°äº†é”ï¼Œ</li><li>é‚£ä¹ˆä»–å»æ‰§è¡Œä¸šåŠ¡ï¼Œç„¶åå†åˆ é™¤é”ï¼Œé€€å‡ºé”é€»è¾‘ï¼Œ</li><li>æ²¡æœ‰æŠ¢åˆ°é”çš„å“¥ä»¬ï¼Œç­‰å¾…ä¸€å®šæ—¶é—´åé‡è¯•å³å¯</li></ul><p><img src="https://s1.vika.cn/space/2023/03/28/eee0cc2045404c66a51ebfecd0ceec5b" alt="1653382830810"></p><h2 id="shi-xian-fen-bu-shi-suo-ban-ben-yi" id="å®ç°åˆ†å¸ƒå¼é”ç‰ˆæœ¬ä¸€">å®ç°åˆ†å¸ƒå¼é”ç‰ˆæœ¬ä¸€</h2><blockquote><p>éœ€æ±‚ï¼šå®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ç°ä¸‹é¢æ¥å£ï¼Œåˆ©ç”¨Rediså®ç°åˆ†å¸ƒå¼é”åŠŸèƒ½</p></blockquote><ul><li>åŠ é”é€»è¾‘</li></ul><p><strong>é”çš„åŸºæœ¬æ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ILock</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°è¯•è·å–é”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeoutSec é”æŒæœ‰çš„è¶…æ—¶æ—¶é—´ï¼Œè¿‡æœŸåè‡ªåŠ¨é‡Šæ”¾</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> trueä»£è¡¨è·å–é”æˆåŠŸï¼Œfalseä»£è¡¨è·å–é”å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> timeoutSec)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡Šæ”¾é”</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>SimpleRedisLock</strong></p><div class="tabs" id="simpleredislock"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#simpleredislock-1">è·å–é”tryLock</button></li><li class="tab"><button type="button" data-href="#simpleredislock-2">é‡Šæ”¾é”unLock</button></li><li class="tab"><button type="button" data-href="#simpleredislock-3">å®Œæ•´ä»£ç </button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="simpleredislock-1"><p><strong>è·å–é”é€»è¾‘</strong></p><p>åˆ©ç”¨setnxæ–¹æ³•è¿›è¡ŒåŠ é”ï¼ŒåŒæ—¶å¢åŠ è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”ï¼Œæ­¤æ–¹æ³•å¯ä»¥ä¿è¯åŠ é”å’Œå¢åŠ è¿‡æœŸæ—¶é—´å…·æœ‰åŸå­æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_PREFIX=<span class="string">&quot;lock:&quot;</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> timeoutSec)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">threadId</span> <span class="operator">=</span> Thread.currentThread().getId()</span><br><span class="line">    <span class="comment">// è·å–é”</span></span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">success</span> <span class="operator">=</span> stringRedisTemplate.opsForValue()</span><br><span class="line">            .setIfAbsent(KEY_PREFIX + name, threadId + <span class="string">&quot;&quot;</span>, timeoutSec, TimeUnit.SECONDS);</span><br><span class="line">    <span class="keyword">return</span> Boolean.TRUE.equals(success); <span class="comment">// æ‹†ç®±æ—¶é¿å…ç©ºæŒ‡é’ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="simpleredislock-2"><p><strong>é‡Šæ”¾é”é€»è¾‘</strong></p><p>é‡Šæ”¾é”ï¼Œé˜²æ­¢åˆ é™¤åˆ«äººçš„é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//é€šè¿‡delåˆ é™¤é”</span></span><br><span class="line">    stringRedisTemplate.delete(KEY_PREFIX + name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="simpleredislock-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleRedisLock</span> <span class="keyword">implements</span> <span class="title class_">ILock</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;lock:&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SimpleRedisLock</span><span class="params">(String name, StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> timeoutSec)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">threadId</span> <span class="operator">=</span> Thread.currentThread().getId();</span><br><span class="line">        <span class="comment">// è·å–é”</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">success</span> <span class="operator">=</span> stringRedisTemplate.opsForValue()</span><br><span class="line">                .setIfAbsent(KEY_PREFIX + name, threadId + <span class="string">&quot;&quot;</span>, timeoutSec, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">return</span> Boolean.TRUE.equals(success);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">        stringRedisTemplate.delete(KEY_PREFIX + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p><strong>ä¿®æ”¹ä¸šåŠ¡ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">    <span class="comment">// 2. åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// åˆ›å»ºé”å¯¹è±¡</span></span><br><span class="line">    <span class="type">SimpleRedisLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleRedisLock</span>(<span class="string">&quot;order:&quot;</span> + userId, stringRedisTemplate);</span><br><span class="line">    <span class="comment">// è·å–é”</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock(<span class="number">1200</span>);</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span>(!isLock) &#123;</span><br><span class="line">        <span class="comment">// è·å–é”å¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯æˆ–é‡è¯•</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ä»£ç†å¯¹è±¡ï¼ˆäº‹åŠ¡ï¼‰</span></span><br><span class="line">        <span class="type">IVoucherOrderService</span> <span class="variable">proxy</span> <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">        <span class="keyword">return</span> proxy.createVoucherOrder(voucherId);</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="redis-fen-bu-shi-suo-wu-shan-qing-kuang-shuo-ming" id="Redisåˆ†å¸ƒå¼é”è¯¯åˆ æƒ…å†µè¯´æ˜">Redisåˆ†å¸ƒå¼é”è¯¯åˆ æƒ…å†µè¯´æ˜</h2><p><strong>é€»è¾‘è¯´æ˜</strong>ï¼š</p><p>æŒæœ‰é”çš„çº¿ç¨‹åœ¨é”çš„å†…éƒ¨å‡ºç°äº†é˜»å¡ï¼Œå¯¼è‡´ä»–çš„é”è‡ªåŠ¨é‡Šæ”¾ï¼Œ</p><ul><li>è¿™æ—¶å…¶ä»–çº¿ç¨‹ï¼Œçº¿ç¨‹2æ¥å°è¯•è·å¾—é”ï¼Œå°±æ‹¿åˆ°äº†è¿™æŠŠé”ï¼Œ</li><li>ç„¶åçº¿ç¨‹2åœ¨æŒæœ‰é”æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹1ååº”è¿‡æ¥ï¼Œç»§ç»­æ‰§è¡Œï¼Œ</li><li>è€Œçº¿ç¨‹1æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œèµ°åˆ°äº†åˆ é™¤é”é€»è¾‘ï¼Œæ­¤æ—¶å°±ä¼šæŠŠæœ¬åº”è¯¥å±äºçº¿ç¨‹2çš„é”è¿›è¡Œåˆ é™¤ï¼Œè¿™å°±æ˜¯è¯¯åˆ åˆ«äººé”çš„æƒ…å†µè¯´æ˜</li></ul><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šè§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨æ¯ä¸ªçº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå»åˆ¤æ–­ä¸€ä¸‹å½“å‰è¿™æŠŠé”æ˜¯å¦å±äºè‡ªå·±ï¼Œ</p><ul><li>å¦‚æœä¸å±äºè‡ªå·±ï¼Œåˆ™ä¸è¿›è¡Œé”çš„åˆ é™¤ï¼Œå‡è®¾è¿˜æ˜¯ä¸Šè¾¹çš„æƒ…å†µï¼Œçº¿ç¨‹1å¡é¡¿ï¼Œé”è‡ªåŠ¨é‡Šæ”¾ï¼Œ</li><li>çº¿ç¨‹2è¿›å…¥åˆ°é”çš„å†…éƒ¨æ‰§è¡Œé€»è¾‘ï¼Œæ­¤æ—¶çº¿ç¨‹1ååº”è¿‡æ¥ï¼Œç„¶ååˆ é™¤é”ï¼Œ</li><li>ä½†æ˜¯çº¿ç¨‹1ï¼Œä¸€çœ‹å½“å‰è¿™æŠŠé”ä¸æ˜¯å±äºè‡ªå·±ï¼Œäºæ˜¯ä¸è¿›è¡Œåˆ é™¤é”é€»è¾‘ï¼Œå½“çº¿ç¨‹2èµ°åˆ°åˆ é™¤é”é€»è¾‘æ—¶ï¼Œ</li><li>å¦‚æœæ²¡æœ‰å¡è¿‡è‡ªåŠ¨é‡Šæ”¾é”çš„æ—¶é—´ç‚¹ï¼Œåˆ™åˆ¤æ–­å½“å‰è¿™æŠŠé”æ˜¯å±äºè‡ªå·±çš„ï¼Œäºæ˜¯åˆ é™¤è¿™æŠŠé”ã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/03/29/77015819c68d416e90bc9cd62cc03215" alt="1653385920025"></p><h2 id="jie-jue-redis-fen-bu-shi-suo-wu-shan-wen-ti" id="è§£å†³Redisåˆ†å¸ƒå¼é”è¯¯åˆ é—®é¢˜">è§£å†³Redisåˆ†å¸ƒå¼é”è¯¯åˆ é—®é¢˜</h2><blockquote><p>éœ€æ±‚ï¼šä¿®æ”¹ä¹‹å‰çš„åˆ†å¸ƒå¼é”å®ç°ï¼Œ</p><p>æ»¡è¶³ï¼šåœ¨è·å–é”æ—¶å­˜å…¥çº¿ç¨‹æ ‡ç¤ºï¼ˆå¯ä»¥ç”¨UUIDè¡¨ç¤ºï¼‰</p><p>â€‹åœ¨é‡Šæ”¾é”æ—¶å…ˆè·å–é”ä¸­çš„çº¿ç¨‹æ ‡ç¤ºï¼Œåˆ¤æ–­æ˜¯å¦ä¸å½“å‰çº¿ç¨‹æ ‡ç¤ºä¸€è‡´</p><ul><li>å¦‚æœä¸€è‡´åˆ™é‡Šæ”¾é”</li></ul><ul><li>å¦‚æœä¸ä¸€è‡´åˆ™ä¸é‡Šæ”¾é”</li></ul></blockquote><p><strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼šåœ¨å­˜å…¥é”æ—¶ï¼Œæ”¾å…¥è‡ªå·±çº¿ç¨‹çš„æ ‡è¯†ï¼Œåœ¨åˆ é™¤é”æ—¶ï¼Œåˆ¤æ–­å½“å‰è¿™æŠŠé”çš„æ ‡è¯†æ˜¯ä¸æ˜¯è‡ªå·±å­˜å…¥çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›è¡Œåˆ é™¤ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¸è¿›è¡Œåˆ é™¤ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/29/29bdaec3312646bbbe4bbd8819631514" alt="1653387398820"></p><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><p><strong>åŠ é”</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ID_PREFIX</span> <span class="operator">=</span> UUID.randomUUID().toString(<span class="literal">true</span>) + <span class="string">&quot;-&quot;</span>;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> timeoutSec)</span> &#123;</span><br><span class="line">   <span class="comment">// è·å–çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">threadId</span> <span class="operator">=</span> ID_PREFIX + Thread.currentThread().getId();</span><br><span class="line">   <span class="comment">// è·å–é”</span></span><br><span class="line">   <span class="type">Boolean</span> <span class="variable">success</span> <span class="operator">=</span> stringRedisTemplate.opsForValue()</span><br><span class="line">                .setIfAbsent(KEY_PREFIX + name, threadId, timeoutSec, TimeUnit.SECONDS);</span><br><span class="line">   <span class="keyword">return</span> Boolean.TRUE.equals(success);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é‡Šæ”¾é”</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">threadId</span> <span class="operator">=</span> ID_PREFIX + Thread.currentThread().getId();</span><br><span class="line">    <span class="comment">// è·å–é”ä¸­çš„æ ‡ç¤º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(KEY_PREFIX + name);</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ ‡ç¤ºæ˜¯å¦ä¸€è‡´</span></span><br><span class="line">    <span class="keyword">if</span>(threadId.equals(id)) &#123;</span><br><span class="line">        <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">        stringRedisTemplate.delete(KEY_PREFIX + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœ‰å…³ä»£ç å®æ“è¯´æ˜ï¼š</strong></p><p>åœ¨æˆ‘ä»¬ä¿®æ”¹å®Œæ­¤å¤„ä»£ç åï¼Œæˆ‘ä»¬é‡å¯å·¥ç¨‹ï¼Œç„¶åå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œ</p><ul><li>ç¬¬ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”åï¼Œæ‰‹åŠ¨é‡Šæ”¾é”ï¼Œ</li><li>ç¬¬äºŒä¸ªçº¿ç¨‹ æ­¤æ—¶è¿›å…¥åˆ°é”å†…éƒ¨ï¼Œå†æ”¾è¡Œç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªçº¿ç¨‹ç”±äºé”çš„valueå€¼å¹¶éæ˜¯è‡ªå·±ï¼Œæ‰€ä»¥ä¸èƒ½é‡Šæ”¾é”ï¼Œä¹Ÿå°±æ— æ³•åˆ é™¤åˆ«äººçš„é”ï¼Œ</li><li>æ­¤æ—¶ç¬¬äºŒä¸ªçº¿ç¨‹èƒ½å¤Ÿæ­£ç¡®é‡Šæ”¾é”ï¼Œé€šè¿‡è¿™ä¸ªæ¡ˆä¾‹åˆæ­¥è¯´æ˜æˆ‘ä»¬è§£å†³äº†é”è¯¯åˆ çš„é—®é¢˜ã€‚</li></ul><h2 id="fen-bu-shi-suo-de-yuan-zi-xing-wen-ti" id="åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜">åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜</h2><p><strong>æ›´ä¸ºæç«¯çš„è¯¯åˆ é€»è¾‘è¯´æ˜</strong>ï¼š</p><p>çº¿ç¨‹1ç°åœ¨æŒæœ‰é”ä¹‹åï¼Œåœ¨æ‰§è¡Œä¸šåŠ¡é€»è¾‘è¿‡ç¨‹ä¸­ï¼Œä»–æ­£å‡†å¤‡åˆ é™¤é”ï¼Œè€Œä¸”å·²ç»èµ°åˆ°äº†æ¡ä»¶åˆ¤æ–­çš„è¿‡ç¨‹ä¸­ï¼Œ</p><ul><li>æ¯”å¦‚ä»–å·²ç»æ‹¿åˆ°äº†å½“å‰è¿™æŠŠé”ç¡®å®æ˜¯å±äºä»–è‡ªå·±çš„ï¼Œæ­£å‡†å¤‡åˆ é™¤é”ï¼Œä½†æ˜¯æ­¤æ—¶ä»–çš„é”åˆ°æœŸäº†ï¼Œ</li><li>é‚£ä¹ˆæ­¤æ—¶çº¿ç¨‹2è¿›æ¥ï¼Œä½†æ˜¯çº¿ç¨‹1ä»–ä¼šæ¥ç€å¾€åæ‰§è¡Œï¼Œå½“ä»–å¡é¡¿ç»“æŸåï¼Œä»–ç›´æ¥å°±ä¼šæ‰§è¡Œåˆ é™¤é”é‚£è¡Œä»£ç ï¼Œ</li><li>ç›¸å½“äº<strong>æ¡ä»¶åˆ¤æ–­å¹¶æ²¡æœ‰èµ·åˆ°ä½œç”¨</strong>ï¼Œè¿™å°±æ˜¯åˆ é”æ—¶çš„åŸå­æ€§é—®é¢˜ï¼Œ</li><li>ä¹‹æ‰€ä»¥æœ‰è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯å› ä¸ºçº¿ç¨‹1çš„æ‹¿é”ï¼Œæ¯”é”ï¼Œåˆ é”ï¼Œå®é™…ä¸Šå¹¶ä¸æ˜¯åŸå­æ€§çš„ï¼Œæˆ‘ä»¬è¦é˜²æ­¢åˆšæ‰çš„æƒ…å†µå‘ç”Ÿï¼Œ</li></ul><p><img src="https://s1.vika.cn/space/2023/03/29/b11b12b7b7f74778a7ad998642f36e9c" alt="1653387764938"></p><h2 id="lua-jiao-ben-jie-jue-duo-tiao-ming-ling-yuan-zi-xing-wen-ti" id="Luaè„šæœ¬è§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜">Luaè„šæœ¬è§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜</h2><p>Redisæä¾›äº†Luaè„šæœ¬åŠŸèƒ½ï¼Œåœ¨ä¸€ä¸ªè„šæœ¬ä¸­ç¼–å†™å¤šæ¡Rediså‘½ä»¤ï¼Œç¡®ä¿å¤šæ¡å‘½ä»¤æ‰§è¡Œæ—¶çš„åŸå­æ€§ã€‚</p><p>Luaæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒçš„åŸºæœ¬è¯­æ³•å¤§å®¶å¯ä»¥å‚è€ƒç½‘ç«™ï¼š<a href="https://www.runoob.com/lua/lua-tutorial.html%EF%BC%8C">https://www.runoob.com/lua/lua-tutorial.htmlï¼Œ</a></p><p>è¿™é‡Œé‡ç‚¹ä»‹ç»Redisæä¾›çš„è°ƒç”¨å‡½æ•°ï¼Œ</p><ul><li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨luaå»æ“ä½œredisï¼Œåˆèƒ½ä¿è¯ä»–çš„åŸå­æ€§ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æ‹¿é”æ¯”é”åˆ é”æ˜¯ä¸€ä¸ªåŸå­æ€§åŠ¨ä½œäº†ï¼Œ</li><li>ä½œä¸ºJavaç¨‹åºå‘˜è¿™ä¸€å—å¹¶ä¸ä½œä¸€ä¸ªç®€å•è¦æ±‚ï¼Œå¹¶ä¸éœ€è¦å¤§å®¶è¿‡äºç²¾é€šï¼Œåªéœ€è¦çŸ¥é“ä»–æœ‰ä»€ä¹ˆä½œç”¨å³å¯ã€‚</li></ul><p>è¿™é‡Œé‡ç‚¹ä»‹ç»Redisæä¾›çš„è°ƒç”¨å‡½æ•°ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis.call(<span class="string">&#x27;å‘½ä»¤åç§°&#x27;</span>, <span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;å…¶å®ƒå‚æ•°&#x27;</span>, ...)</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œset name jackï¼Œåˆ™è„šæœ¬æ˜¯è¿™æ ·ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ‰§è¡Œ set name jack</span><br><span class="line">redis.call(<span class="string">&#x27;set&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;jack&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦å…ˆæ‰§è¡Œset name Roseï¼Œå†æ‰§è¡Œget nameï¼Œåˆ™è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># å…ˆæ‰§è¡Œ set name jack</span><br><span class="line">redis.call(<span class="string">&#x27;set&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;Rose&#x27;</span>)</span><br><span class="line"># å†æ‰§è¡Œ get name</span><br><span class="line"><span class="keyword">local</span> name = redis.call(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"># è¿”å›</span><br><span class="line"><span class="keyword">return</span> name</span><br></pre></td></tr></table></figure><p>å†™å¥½è„šæœ¬ä»¥åï¼Œéœ€è¦ç”¨Rediså‘½ä»¤æ¥è°ƒç”¨è„šæœ¬ï¼Œè°ƒç”¨è„šæœ¬çš„å¸¸è§å‘½ä»¤å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/29/87d5c298795348aca993ef35340935a2" alt="1653392181413"></p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œ redis.call(â€˜setâ€™, â€˜nameâ€™, â€˜jackâ€™) è¿™ä¸ªè„šæœ¬ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/29/93a9a00cbb8243949a2c2c4d4aceefdb" alt="1653392218531"></p><p>å¦‚æœè„šæœ¬ä¸­çš„keyã€valueä¸æƒ³å†™æ­»ï¼Œå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ã€‚keyç±»å‹å‚æ•°ä¼šæ”¾å…¥KEYSæ•°ç»„ï¼Œå…¶å®ƒå‚æ•°ä¼šæ”¾å…¥ARGVæ•°ç»„ï¼Œåœ¨è„šæœ¬ä¸­å¯ä»¥ä»KEYSå’ŒARGVæ•°ç»„è·å–è¿™äº›å‚æ•°ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/29/f8fe96cb4c9648e9ba6ab708724da135" alt="1653392438917"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹æˆ‘ä»¬é‡Šæ”¾é”çš„é€»è¾‘ï¼š</p><p>é‡Šæ”¾é”çš„ä¸šåŠ¡æµç¨‹æ˜¯è¿™æ ·çš„</p><p>â€‹1ã€è·å–é”ä¸­çš„çº¿ç¨‹æ ‡ç¤º</p><p>â€‹2ã€åˆ¤æ–­æ˜¯å¦ä¸æŒ‡å®šçš„æ ‡ç¤ºï¼ˆå½“å‰çº¿ç¨‹æ ‡ç¤ºï¼‰ä¸€è‡´</p><p>â€‹3ã€å¦‚æœä¸€è‡´åˆ™é‡Šæ”¾é”ï¼ˆåˆ é™¤ï¼‰</p><p>â€‹4ã€å¦‚æœä¸ä¸€è‡´åˆ™ä»€ä¹ˆéƒ½ä¸åš</p><p>å¦‚æœç”¨Luaè„šæœ¬æ¥è¡¨ç¤ºåˆ™æ˜¯è¿™æ ·çš„ï¼š</p><p>æœ€ç»ˆæˆ‘ä»¬æ“ä½œredisçš„æ‹¿é”æ¯”é”åˆ é”çš„luaè„šæœ¬å°±ä¼šå˜æˆè¿™æ ·</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¿™é‡Œçš„ KEYS[1] å°±æ˜¯é”çš„keyï¼Œè¿™é‡Œçš„ARGV[1] å°±æ˜¯å½“å‰çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line"><span class="comment">-- è·å–é”ä¸­çš„æ ‡ç¤ºï¼Œåˆ¤æ–­æ˜¯å¦ä¸å½“å‰çº¿ç¨‹æ ‡ç¤ºä¸€è‡´</span></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;GET&#x27;</span>, KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>]) <span class="keyword">then</span></span><br><span class="line">  <span class="comment">-- ä¸€è‡´ï¼Œåˆ™åˆ é™¤é”</span></span><br><span class="line">  <span class="keyword">return</span> redis.call(<span class="string">&#x27;DEL&#x27;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- ä¸ä¸€è‡´ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="li-yong-java-dai-ma-diao-yong-lua-jiao-ben-gai-zao-fen-bu-shi-suo" id="åˆ©ç”¨Javaä»£ç è°ƒç”¨Luaè„šæœ¬æ”¹é€ åˆ†å¸ƒå¼é”">åˆ©ç”¨Javaä»£ç è°ƒç”¨Luaè„šæœ¬æ”¹é€ åˆ†å¸ƒå¼é”</h2><p>luaè„šæœ¬æœ¬èº«å¹¶ä¸éœ€è¦å¤§å®¶èŠ±è´¹å¤ªå¤šæ—¶é—´å»ç ”ç©¶ï¼Œåªéœ€è¦çŸ¥é“å¦‚ä½•è°ƒç”¨ï¼Œå¤§è‡´æ˜¯ä»€ä¹ˆæ„æ€å³å¯ï¼Œæ‰€ä»¥åœ¨ç¬”è®°ä¸­å¹¶ä¸ä¼šè¯¦ç»†çš„å»è§£é‡Šè¿™äº›luaè¡¨è¾¾å¼çš„å«ä¹‰ã€‚</p><p>æˆ‘ä»¬çš„RedisTemplateä¸­ï¼Œå¯ä»¥åˆ©ç”¨executeæ–¹æ³•å»æ‰§è¡Œluaè„šæœ¬ï¼Œå‚æ•°å¯¹åº”å…³ç³»å°±å¦‚ä¸‹å›¾è‚¡</p><p><img src="https://s1.vika.cn/space/2023/03/29/e3e09663e1ec4dfe956e4bf1327710d3" alt="1653393304844"></p><p><strong>Javaä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Long&gt; UNLOCK_SCRIPT;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        UNLOCK_SCRIPT = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;();</span><br><span class="line">        UNLOCK_SCRIPT.setLocation(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;unlock.lua&quot;</span>));</span><br><span class="line">        UNLOCK_SCRIPT.setResultType(Long.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨luaè„šæœ¬</span></span><br><span class="line">    stringRedisTemplate.execute(</span><br><span class="line">            UNLOCK_SCRIPT,</span><br><span class="line">            Collections.singletonList(KEY_PREFIX + name),</span><br><span class="line">            ID_PREFIX + Thread.currentThread().getId());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ç»è¿‡ä»¥ä¸Šä»£ç æ”¹é€ åï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå®ç° æ‹¿é”æ¯”é”åˆ é”çš„åŸå­æ€§åŠ¨ä½œäº†~</li></ul><p><strong>å°æ€»ç»“</strong>ï¼š</p><p>åŸºäºRedisçš„åˆ†å¸ƒå¼é”å®ç°æ€è·¯ï¼š</p><ul><li>åˆ©ç”¨set nx exè·å–é”ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¿å­˜çº¿ç¨‹æ ‡ç¤º</li><li>é‡Šæ”¾é”æ—¶å…ˆåˆ¤æ–­çº¿ç¨‹æ ‡ç¤ºæ˜¯å¦ä¸è‡ªå·±ä¸€è‡´ï¼Œä¸€è‡´åˆ™åˆ é™¤é”<ul><li>ç‰¹æ€§ï¼š<ul><li>åˆ©ç”¨set nxæ»¡è¶³äº’æ–¥æ€§</li><li>åˆ©ç”¨set exä¿è¯æ•…éšœæ—¶é”ä¾ç„¶èƒ½é‡Šæ”¾ï¼Œé¿å…æ­»é”ï¼Œæé«˜å®‰å…¨æ€§</li><li>åˆ©ç”¨Redisé›†ç¾¤ä¿è¯é«˜å¯ç”¨å’Œé«˜å¹¶å‘ç‰¹æ€§</li></ul></li></ul></li></ul><p><strong>ç¬”è€…æ€»ç»“</strong>ï¼šæˆ‘ä»¬ä¸€è·¯èµ°æ¥ï¼Œåˆ©ç”¨æ·»åŠ è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”é—®é¢˜çš„å‘ç”Ÿï¼Œ</p><ul><li>ä½†æ˜¯æœ‰äº†è¿‡æœŸæ—¶é—´ä¹‹åï¼Œå¯èƒ½å‡ºç°è¯¯åˆ åˆ«äººé”çš„é—®é¢˜ï¼Œ</li><li>è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¼€å§‹æ˜¯åˆ©ç”¨åˆ ä¹‹å‰ é€šè¿‡æ‹¿é”ï¼Œæ¯”é”ï¼Œåˆ é”è¿™ä¸ªé€»è¾‘æ¥è§£å†³çš„ï¼Œä¹Ÿå°±æ˜¯åˆ ä¹‹å‰åˆ¤æ–­ä¸€ä¸‹å½“å‰è¿™æŠŠé”æ˜¯å¦æ˜¯å±äºè‡ªå·±çš„ï¼Œ</li><li>ä½†æ˜¯ç°åœ¨è¿˜æœ‰åŸå­æ€§é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ²¡æ³•ä¿è¯æ‹¿é”æ¯”é”åˆ é”æ˜¯ä¸€ä¸ªåŸå­æ€§çš„åŠ¨ä½œï¼Œ</li><li>æœ€åé€šè¿‡luaè¡¨è¾¾å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜</li></ul><p>ä½†æ˜¯ç›®å‰è¿˜å‰©ä¸‹ä¸€ä¸ªé—®é¢˜<strong>é”ä¸ä½</strong>ï¼Œä»€ä¹ˆæ˜¯é”ä¸ä½å‘¢ï¼Œ</p><ul><li>ä½ æƒ³ä¸€æƒ³ï¼Œå¦‚æœå½“è¿‡æœŸæ—¶é—´åˆ°äº†ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä»–ç»­æœŸä¸€ä¸‹ï¼Œæ¯”å¦‚ç»­ä¸ª30sï¼Œ</li><li>å°±å¥½åƒæ˜¯ç½‘å§ä¸Šç½‘ï¼Œ ç½‘è´¹åˆ°äº†ä¹‹åï¼Œç„¶åè¯´ï¼Œæ¥ï¼Œç½‘ç®¡ï¼Œå†ç»™æˆ‘æ¥10å—çš„ï¼Œ</li><li>æ˜¯ä¸æ˜¯åè¾¹çš„é—®é¢˜éƒ½ä¸ä¼šå‘ç”Ÿäº†ï¼Œé‚£ä¹ˆç»­æœŸé—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Œå¯ä»¥ä¾èµ–äºæˆ‘ä»¬æ¥ä¸‹æ¥è¦å­¦ä¹ redissionå•¦</li></ul><p><strong>æµ‹è¯•é€»è¾‘ï¼š</strong></p><p>ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›æ¥ï¼Œå¾—åˆ°äº†é”ï¼Œæ‰‹åŠ¨åˆ é™¤é”ï¼Œæ¨¡æ‹Ÿé”è¶…æ—¶äº†ï¼Œå…¶ä»–çº¿ç¨‹ä¼šæ‰§è¡Œluaæ¥æŠ¢é”ï¼Œå½“ç¬¬ä¸€ä¸ªçº¿ç¨‹åˆ©ç”¨luaåˆ é™¤é”æ—¶ï¼Œluaèƒ½ä¿è¯ä»–ä¸èƒ½åˆ é™¤ä»–çš„é”ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹åˆ é™¤é”æ—¶ï¼Œåˆ©ç”¨luaåŒæ ·å¯ä»¥ä¿è¯ä¸ä¼šåˆ é™¤åˆ«äººçš„é”ï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯åŸå­æ€§ã€‚</p><h1 id="fen-bu-shi-suo-redission">åˆ†å¸ƒå¼é”-redission</h1><h2 id="fen-bu-shi-suo-redission-gong-neng-jie-shao" id="åˆ†å¸ƒå¼é”-redissionåŠŸèƒ½ä»‹ç»">åˆ†å¸ƒå¼é”-redissionåŠŸèƒ½ä»‹ç»</h2><p>åŸºäºsetnxå®ç°çš„åˆ†å¸ƒå¼é”å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p><p><strong>é‡å…¥é—®é¢˜</strong>ï¼šé‡å…¥é—®é¢˜æ˜¯æŒ‡ è·å¾—é”çš„çº¿ç¨‹å¯ä»¥å†æ¬¡è¿›å…¥åˆ°ç›¸åŒçš„é”çš„ä»£ç å—ä¸­ï¼Œ</p><ul><li>å¯é‡å…¥é”çš„æ„ä¹‰åœ¨äºé˜²æ­¢æ­»é”ï¼Œæ¯”å¦‚HashTableè¿™æ ·çš„ä»£ç ä¸­ï¼Œä»–çš„æ–¹æ³•éƒ½æ˜¯ä½¿ç”¨synchronizedä¿®é¥°çš„ï¼Œ</li><li>å‡å¦‚ä»–åœ¨ä¸€ä¸ªæ–¹æ³•å†…ï¼Œè°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶å¦‚æœæ˜¯ä¸å¯é‡å…¥çš„ï¼Œä¸å°±æ­»é”äº†å—ï¼Ÿ</li><li>æ‰€ä»¥å¯é‡å…¥é”ä»–çš„ä¸»è¦æ„ä¹‰æ˜¯<strong>é˜²æ­¢æ­»é”</strong>ï¼Œæˆ‘ä»¬çš„<u>synchronizedå’ŒLocké”éƒ½æ˜¯å¯é‡å…¥çš„</u>ã€‚</li></ul><p><strong>ä¸å¯é‡è¯•</strong>ï¼šæ˜¯æŒ‡ç›®å‰çš„åˆ†å¸ƒå¼åªèƒ½å°è¯•ä¸€æ¬¡ï¼Œæˆ‘ä»¬è®¤ä¸ºåˆç†çš„æƒ…å†µæ˜¯ï¼š</p><ul><li>å½“çº¿ç¨‹åœ¨è·å¾—é”å¤±è´¥åï¼Œä»–åº”è¯¥èƒ½å†æ¬¡å°è¯•è·å¾—é”ã€‚</li></ul><p><strong>è¶…æ—¶é‡Šæ”¾</strong>ï¼šæˆ‘ä»¬åœ¨åŠ é”æ—¶å¢åŠ äº†è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·çš„æˆ‘ä»¬å¯ä»¥é˜²æ­¢æ­»é”ï¼Œ</p><ul><li>ä½†æ˜¯å¦‚æœå¡é¡¿çš„æ—¶é—´è¶…é•¿ï¼Œè™½ç„¶æˆ‘ä»¬é‡‡ç”¨äº†luaè¡¨è¾¾å¼é˜²æ­¢åˆ é”çš„æ—¶å€™ï¼Œè¯¯åˆ åˆ«äººçš„é”ï¼Œ</li><li>ä½†æ˜¯æ¯•ç«Ÿæ²¡æœ‰é”ä½ï¼Œæœ‰å®‰å…¨éšæ‚£</li></ul><p><strong>ä¸»ä»ä¸€è‡´æ€§</strong>ï¼š å¦‚æœRedisæä¾›äº†ä¸»ä»é›†ç¾¤ï¼Œå½“æˆ‘ä»¬å‘é›†ç¾¤å†™æ•°æ®æ—¶ï¼Œ</p><ul><li>ä¸»æœºéœ€è¦å¼‚æ­¥çš„å°†æ•°æ®åŒæ­¥ç»™ä»æœºï¼Œè€Œä¸‡ä¸€åœ¨åŒæ­¥è¿‡å»ä¹‹å‰ï¼Œä¸»æœºå®•æœºäº†ï¼Œå°±ä¼šå‡ºç°æ­»é”é—®é¢˜ã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/03/29/701eb8ee363648f8b5eceaeb044511bc" alt="1653546070602"></p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯<strong>Redission</strong>å‘¢</p><p>Redissonæ˜¯ä¸€ä¸ªåœ¨Redisçš„åŸºç¡€ä¸Šå®ç°çš„Javaé©»å†…å­˜æ•°æ®ç½‘æ ¼ï¼ˆIn-Memory Data Gridï¼‰ã€‚</p><ul><li>å®ƒä¸ä»…æä¾›äº†ä¸€ç³»åˆ—çš„åˆ†å¸ƒå¼çš„Javaå¸¸ç”¨å¯¹è±¡ï¼Œè¿˜æä¾›äº†è®¸å¤šåˆ†å¸ƒå¼æœåŠ¡ï¼Œå…¶ä¸­å°±åŒ…å«äº†å„ç§åˆ†å¸ƒå¼é”çš„å®ç°ã€‚</li><li>å®˜ç½‘åœ°å€ï¼š<a href="https://redisson.org">https://redisson.org</a></li><li>Githubåœ°å€ï¼š<a href="https://github.com/redisson/redisson">https://github.com/redisson/redisson</a></li></ul><blockquote><p>Redissionæä¾›äº†åˆ†å¸ƒå¼é”çš„å¤šç§å¤šæ ·çš„åŠŸèƒ½</p></blockquote><ol><li>å¯é‡å…¥é”(Reentrant Lock)</li><li>å…¬å¹³é”(Fair Lock)</li><li>è”é”(MultiLock)</li><li>çº¢é”(RedLock)</li><li>è¯»å†™é”(ReadWriteLock)</li><li>ä¿¡å·é‡(Semaphore)</li><li>å¯è¿‡æœŸæ€§ä¿¡å·é‡(PermitExpirableSemaphore)</li><li>é—­é”(CountDownLatch)</li></ol><h2 id="fen-bu-shi-suo-redission-kuai-su-ru-men" id="åˆ†å¸ƒå¼é”-Redissionå¿«é€Ÿå…¥é—¨">åˆ†å¸ƒå¼é”-Redissionå¿«é€Ÿå…¥é—¨</h2><ol><li>å¼•å…¥ä¾èµ–ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.redisson&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;redisson&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;<span class="number">3.13</span><span class="number">.6</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>é…ç½®Redissonå®¢æˆ·ç«¯</strong>ï¼Œåœ¨configåŒ…ä¸‹æ–°å»º<code>RedissonConfig</code>ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedissonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedissonClient <span class="title function_">redissonClient</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// é…ç½®</span></span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">        config.useSingleServer().setAddress(<span class="string">&quot;redis://192.168.150.101:6379&quot;</span>)</span><br><span class="line">            .setPassword(<span class="string">&quot;123321&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºRedissonClientå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> Redisson.create(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨Redissionçš„åˆ†å¸ƒå¼é”</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedissionClient redissonClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testRedisson</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">//è·å–é”(å¯é‡å…¥)ï¼ŒæŒ‡å®šé”çš„åç§°</span></span><br><span class="line">    <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;anyLock&quot;</span>);</span><br><span class="line">    <span class="comment">//å°è¯•è·å–é”ï¼Œå‚æ•°åˆ†åˆ«æ˜¯ï¼šè·å–é”çš„æœ€å¤§ç­‰å¾…æ—¶é—´(æœŸé—´ä¼šé‡è¯•)ï¼Œé”è‡ªåŠ¨é‡Šæ”¾æ—¶é—´ï¼Œæ—¶é—´å•ä½</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock(<span class="number">1</span>,<span class="number">10</span>,TimeUnit.SECONDS);</span><br><span class="line">    <span class="comment">//åˆ¤æ–­è·å–é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span>(isLock)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ‰§è¡Œä¸šåŠ¡&quot;</span>);          </span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>åœ¨ VoucherOrderServiceImpl</li></ol><p>æ³¨å…¥<strong>RedissonClient</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">        <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="comment">//åˆ›å»ºé”å¯¹è±¡ è¿™ä¸ªä»£ç ä¸ç”¨äº†ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨è¦ä½¿ç”¨åˆ†å¸ƒå¼é”</span></span><br><span class="line">        <span class="comment">//SimpleRedisLock lock = new SimpleRedisLock(&quot;order:&quot; + userId, stringRedisTemplate);</span></span><br><span class="line">        <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;lock:order:&quot;</span> + userId);</span><br><span class="line">        <span class="comment">//è·å–é”å¯¹è±¡</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock();</span><br><span class="line">       </span><br><span class="line"><span class="comment">//åŠ é”å¤±è´¥</span></span><br><span class="line">        <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è·å–ä»£ç†å¯¹è±¡(äº‹åŠ¡)</span></span><br><span class="line">            <span class="type">IVoucherOrderService</span> <span class="variable">proxy</span> <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">            <span class="keyword">return</span> proxy.createVoucherOrder(voucherId);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="fen-bu-shi-suo-redission-ke-zhong-ru-suo-yuan-li" id="åˆ†å¸ƒå¼é”-redissionå¯é‡å…¥é”åŸç†">åˆ†å¸ƒå¼é”-redissionå¯é‡å…¥é”åŸç†</h2><ul><li><p>åœ¨Locké”ä¸­ï¼Œä»–æ˜¯å€ŸåŠ©äºç­‰æ›¾çš„ä¸€ä¸ªvoaltileçš„ä¸€ä¸ªstateå˜é‡æ¥è®°å½•é‡å…¥çš„çŠ¶æ€çš„</p><ul><li>å¦‚æœå½“å‰<code>æ²¡æœ‰</code>äººæŒæœ‰è¿™æŠŠé”ï¼Œé‚£ä¹ˆ<code>state = 0</code></li><li>å¦‚æœ<code>æœ‰</code>äººæŒæœ‰è¿™æŠŠé”ï¼Œé‚£ä¹ˆ<code>state = 1</code><ul><li>å¦‚æœæŒæœ‰è¿™æŠŠé”çš„äººå†æ¬¡æŒæœ‰è¿™æŠŠé”ï¼Œé‚£ä¹ˆstateä¼š<code>+1</code></li></ul></li><li>å¦‚æœå¯¹äº<code>synchronize</code>è€Œè¨€ï¼Œä»–åœ¨cè¯­è¨€ä»£ç ä¸­ä¼šæœ‰ä¸€ä¸ªcount</li><li>åŸç†ä¸<code>state</code>ç±»ä¼¼ï¼Œä¹Ÿæ˜¯é‡å…¥ä¸€æ¬¡å°±<code>+1</code>ï¼Œé‡Šæ”¾ä¸€æ¬¡å°±<code>-1</code>ï¼Œç›´è‡³å‡åˆ°0ï¼Œè¡¨ç¤ºè¿™æŠŠé”æ²¡æœ‰è¢«äººæŒæœ‰</li></ul></li><li><p>åœ¨redissonä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ”¯æŒå¯é‡å…¥é”</p><ul><li>åœ¨åˆ†å¸ƒå¼é”ä¸­ï¼Œå®ƒé‡‡ç”¨hashç»“æ„æ¥å­˜å‚¨é”ï¼Œå…¶ä¸­å¤–å±‚keyè¡¨ç¤ºè¿™æŠŠé”æ˜¯å¦å­˜åœ¨ï¼Œå†…å±‚keyåˆ™è®°å½•å½“å‰è¿™æŠŠé”è¢«å“ªä¸ªçº¿ç¨‹æŒæœ‰</li></ul></li><li><p>method1åœ¨æ–¹æ³•å†…éƒ¨è°ƒç”¨method2ï¼Œmethod1å’Œmethod2å‡ºäºåŒä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆmethod1å·²ç»æ‹¿åˆ°ä¸€æŠŠé”äº†ï¼Œæƒ³è¿›å…¥method2ä¸­æ‹¿å¦å¤–ä¸€æŠŠé”ï¼Œå¿…ç„¶æ˜¯æ‹¿ä¸åˆ°çš„ï¼Œäºæ˜¯å°±å‡ºç°äº†æ­»é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> RLock lock;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BeforeEach</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">    lock = redissonClient.getLock(<span class="string">&quot;lock&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> lock.tryLock();</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;è·å–é”å¤±è´¥ï¼Œ1&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;è·å–é”æˆåŠŸ&quot;</span>);</span><br><span class="line">        method2();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;é‡Šæ”¾é”ï¼Œ1&quot;</span>);</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;lock&quot;</span>);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> lock.tryLock();</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;è·å–é”å¤±è´¥ï¼Œ2&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;è·å–é”æˆåŠŸï¼Œ2&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;é‡Šæ”¾é”ï¼Œ2&quot;</span>);</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦é¢å¤–åˆ¤æ–­ï¼Œmethod1å’Œmethod2æ˜¯å¦å¤„äºåŒä¸€çº¿ç¨‹ï¼Œå¦‚æœæ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œåˆ™å¯ä»¥æ‹¿åˆ°é”ï¼Œä½†æ˜¯stateä¼š<code>+1</code>ï¼Œä¹‹åæ‰§è¡Œmethod2ä¸­çš„æ–¹æ³•ï¼Œé‡Šæ”¾é”ï¼Œé‡Šæ”¾é”çš„æ—¶å€™ä¹Ÿåªæ˜¯å°†stateè¿›è¡Œ<code>-1</code>ï¼Œåªæœ‰å‡è‡³0ï¼Œæ‰ä¼šçœŸæ­£é‡Šæ”¾é”</p></li><li><p>ç”±äºæˆ‘ä»¬éœ€è¦é¢å¤–å­˜å‚¨ä¸€ä¸ªstateï¼Œæ‰€ä»¥ç”¨å­—ç¬¦ä¸²å‹<code>SET NX EX</code>æ˜¯ä¸è¡Œçš„ï¼Œéœ€è¦ç”¨åˆ°<code>Hash</code>ç»“æ„ï¼Œä½†æ˜¯<code>Hash</code>ç»“æ„åˆæ²¡æœ‰<code>NX</code>è¿™ç§æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†åŸæœ‰çš„é€»è¾‘æ‹†å¼€ï¼Œè¿›è¡Œæ‰‹åŠ¨åˆ¤æ–­</p></li></ul><p><img src="https://s1.vika.cn/space/2023/03/29/541dc8eeef67443f990e7ea5c86bacea" alt="image-20230329204452027"></p><ul><li>ä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œæ‰€ä»¥æµç¨‹å›¾ä¸­çš„ä¸šåŠ¡é€»è¾‘ä¹Ÿæ˜¯éœ€è¦æˆ‘ä»¬ç”¨Luaæ¥å®ç°çš„</li></ul><div class="tabs" id="luarlock"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#luarlock-1">è·å–é”çš„é€»è¾‘</button></li><li class="tab"><button type="button" data-href="#luarlock-2">é‡Šæ”¾é”çš„é€»è¾‘</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="luarlock-1"><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> key = KEYS[<span class="number">1</span>]; <span class="comment">-- é”çš„key</span></span><br><span class="line"><span class="keyword">local</span> threadId = ARGV[<span class="number">1</span>]; <span class="comment">-- çº¿ç¨‹å”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="keyword">local</span> releaseTime = ARGV[<span class="number">2</span>]; <span class="comment">-- é”çš„è‡ªåŠ¨é‡Šæ”¾æ—¶é—´</span></span><br><span class="line"><span class="comment">-- é”ä¸å­˜åœ¨</span></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;exists&#x27;</span>, key) == <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- è·å–é”å¹¶æ·»åŠ çº¿ç¨‹æ ‡è¯†ï¼Œstateè®¾ä¸º1</span></span><br><span class="line">    redis.call(<span class="string">&#x27;hset&#x27;</span>, key, threadId, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">    <span class="comment">-- è®¾ç½®é”æœ‰æ•ˆæœŸ</span></span><br><span class="line">    redis.call(<span class="string">&#x27;expire&#x27;</span>, key, releaseTime);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">-- è¿”å›ç»“æœ</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">-- é”å­˜åœ¨ï¼Œåˆ¤æ–­threadIdæ˜¯å¦ä¸ºè‡ªå·±</span></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;hexists&#x27;</span>, key, threadId) == <span class="number">1</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- é”å­˜åœ¨ï¼Œé‡å…¥æ¬¡æ•° +1ï¼Œè¿™é‡Œç”¨çš„æ˜¯hashç»“æ„çš„incrbyå¢é•¿</span></span><br><span class="line">    redis.call(<span class="string">&#x27;hincrby&#x27;</span>, key, thread, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">-- è®¾ç½®é”çš„æœ‰æ•ˆæœŸ</span></span><br><span class="line">    redis.call(<span class="string">&#x27;expire&#x27;</span>, key, releaseTime);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">-- è¿”å›ç»“æœ</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>; <span class="comment">-- ä»£ç èµ°åˆ°è¿™é‡Œï¼Œè¯´æ˜è·å–é”çš„ä¸æ˜¯è‡ªå·±ï¼Œè·å–é”å¤±è´¥</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="luarlock-2"><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> key = KEYS[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">local</span> threadId = ARGV[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">local</span> releaseTime = ARGV[<span class="number">2</span>];</span><br><span class="line"><span class="comment">-- å¦‚æœé”ä¸æ˜¯è‡ªå·±çš„</span></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;HEXISTS&#x27;</span>, key, threadId) == <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>; <span class="comment">-- ç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">-- é”æ˜¯è‡ªå·±çš„ï¼Œé”è®¡æ•°-1ï¼Œè¿˜æ˜¯ç”¨hincrbyï¼Œä¸è¿‡è‡ªå¢é•¿çš„å€¼ä¸º-1</span></span><br><span class="line"><span class="keyword">local</span> count = redis.call(<span class="string">&#x27;hincrby&#x27;</span>, key, threadId, <span class="number">-1</span>);</span><br><span class="line"><span class="comment">-- åˆ¤æ–­é‡å…¥æ¬¡æ•°ä¸ºå¤šå°‘</span></span><br><span class="line"><span class="keyword">if</span> (count &gt; <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- å¤§äº0ï¼Œé‡ç½®æœ‰æ•ˆæœŸ</span></span><br><span class="line">    redis.call(<span class="string">&#x27;expire&#x27;</span>, key, releaseTime);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="comment">-- å¦åˆ™ç›´æ¥é‡Šæ”¾é”</span></span><br><span class="line">    redis.call(<span class="string">&#x27;del&#x27;</span>, key);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p><strong>æºç å¯¹ç…§</strong></p><ul><li>è·å–é”æºç </li></ul><div class="tabs" id="luarlock"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#luarlock-1">è·å–é”çš„é€»è¾‘</button></li><li class="tab"><button type="button" data-href="#luarlock-2">é‡Šæ”¾é”çš„é€»è¾‘</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="luarlock-1"><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> key = KEYS[<span class="number">1</span>]; <span class="comment">-- é”çš„key</span></span><br><span class="line"><span class="keyword">local</span> threadId = ARGV[<span class="number">1</span>]; <span class="comment">-- çº¿ç¨‹å”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="keyword">local</span> releaseTime = ARGV[<span class="number">2</span>]; <span class="comment">-- é”çš„è‡ªåŠ¨é‡Šæ”¾æ—¶é—´</span></span><br><span class="line"><span class="comment">-- é”ä¸å­˜åœ¨</span></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;exists&#x27;</span>, key) == <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- è·å–é”å¹¶æ·»åŠ çº¿ç¨‹æ ‡è¯†ï¼Œstateè®¾ä¸º1</span></span><br><span class="line">    redis.call(<span class="string">&#x27;hset&#x27;</span>, key, threadId, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">    <span class="comment">-- è®¾ç½®é”æœ‰æ•ˆæœŸ</span></span><br><span class="line">    redis.call(<span class="string">&#x27;expire&#x27;</span>, key, releaseTime);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">-- è¿”å›ç»“æœ</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">-- é”å­˜åœ¨ï¼Œåˆ¤æ–­threadIdæ˜¯å¦ä¸ºè‡ªå·±</span></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;hexists&#x27;</span>, key, threadId) == <span class="number">1</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- é”å­˜åœ¨ï¼Œé‡å…¥æ¬¡æ•° +1ï¼Œè¿™é‡Œç”¨çš„æ˜¯hashç»“æ„çš„incrbyå¢é•¿</span></span><br><span class="line">    redis.call(<span class="string">&#x27;hincrby&#x27;</span>, key, thread, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">-- è®¾ç½®é”çš„æœ‰æ•ˆæœŸ</span></span><br><span class="line">    redis.call(<span class="string">&#x27;expire&#x27;</span>, key, releaseTime);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">-- è¿”å›ç»“æœ</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>; <span class="comment">-- ä»£ç èµ°åˆ°è¿™é‡Œï¼Œè¯´æ˜è·å–é”çš„ä¸æ˜¯è‡ªå·±ï¼Œè·å–é”å¤±è´¥</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="luarlock-2"><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> key = KEYS[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">local</span> threadId = ARGV[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">local</span> releaseTime = ARGV[<span class="number">2</span>];</span><br><span class="line"><span class="comment">-- å¦‚æœé”ä¸æ˜¯è‡ªå·±çš„</span></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;HEXISTS&#x27;</span>, key, threadId) == <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>; <span class="comment">-- ç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">-- é”æ˜¯è‡ªå·±çš„ï¼Œé”è®¡æ•°-1ï¼Œè¿˜æ˜¯ç”¨hincrbyï¼Œä¸è¿‡è‡ªå¢é•¿çš„å€¼ä¸º-1</span></span><br><span class="line"><span class="keyword">local</span> count = redis.call(<span class="string">&#x27;hincrby&#x27;</span>, key, threadId, <span class="number">-1</span>);</span><br><span class="line"><span class="comment">-- åˆ¤æ–­é‡å…¥æ¬¡æ•°ä¸ºå¤šå°‘</span></span><br><span class="line"><span class="keyword">if</span> (count &gt; <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- å¤§äº0ï¼Œé‡ç½®æœ‰æ•ˆæœŸ</span></span><br><span class="line">    redis.call(<span class="string">&#x27;expire&#x27;</span>, key, releaseTime);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="comment">-- å¦åˆ™ç›´æ¥é‡Šæ”¾é”</span></span><br><span class="line">    redis.call(<span class="string">&#x27;del&#x27;</span>, key);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p><strong>Lua ä»£ç å®ç°</strong></p><p>â€‹è·å–é”çš„Luaè„šæœ¬ï¼šé‡Šæ”¾é”çš„Luaè„šæœ¬ï¼š</p><img src="https://s1.vika.cn/space/2023/03/29/908f34d5fdbf4fb3b8d96015d7060853" alt="image-20230329204822084" style="zoom:150%;" /><h2 id="fen-bu-shi-suo-redission-suo-zhong-shi-he-watch-dog-ji-zhi" id="åˆ†å¸ƒå¼é”-redissioné”é‡è¯•å’ŒWatchDogæœºåˆ¶">åˆ†å¸ƒå¼é”-redissioné”é‡è¯•å’ŒWatchDogæœºåˆ¶</h2><p><img src="https://s1.vika.cn/space/2023/03/29/45a9e252ba514547ac885e240cf6b1c4" alt="image-20230329211757854"></p><blockquote><p><strong>è¯´æ˜</strong>ï¼šç”±äºè¯¾ç¨‹ä¸­å·²ç»è¯´æ˜äº†æœ‰å…³tryLockçš„æºç è§£æä»¥åŠå…¶çœ‹é—¨ç‹—åŸç†ï¼Œæ‰€ä»¥ç¬”è€…åœ¨è¿™é‡Œç»™å¤§å®¶åˆ†ælock()æ–¹æ³•çš„æºç è§£æï¼Œå¸Œæœ›å¤§å®¶åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œèƒ½å¤ŸæŒæ¡æ›´å¤šçš„çŸ¥è¯†</p></blockquote><ul><li><p>å‰é¢æˆ‘ä»¬åˆ†æçš„æ˜¯ç©ºå‚çš„tryLockæ–¹æ³•ï¼Œç°åœ¨æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªå¸¦å‚æ•°çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">JAVA</span><br><span class="line">&lt;T&gt; RFuture&lt;T&gt; <span class="title function_">tryLockInnerAsync</span><span class="params">(<span class="type">long</span> waitTime, <span class="type">long</span> leaseTime, TimeUnit unit, <span class="type">long</span> threadId, RedisStrictCommand&lt;T&gt; command)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.internalLockLeaseTime = unit.toMillis(leaseTime);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.evalWriteAsync(<span class="built_in">this</span>.getName(), LongCodec.INSTANCE, command, <span class="string">&quot;if (redis.call(&#x27;exists&#x27;, KEYS[1]) == 0) then redis.call(&#x27;hincrby&#x27;, KEYS[1], ARGV[2], 1); redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); return nil; end; if (redis.call(&#x27;hexists&#x27;, KEYS[1], ARGV[2]) == 1) then redis.call(&#x27;hincrby&#x27;, KEYS[1], ARGV[2], 1); redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); return nil; end; return redis.call(&#x27;pttl&#x27;, KEYS[1]);&quot;</span>, Collections.singletonList(<span class="built_in">this</span>.getName()), <span class="built_in">this</span>.internalLockLeaseTime, <span class="built_in">this</span>.getLockName(threadId));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æºç åˆ†æ</strong></p></li><li><p>tryAcquireAsync</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">JAVA</span><br><span class="line"><span class="keyword">private</span> &lt;T&gt; RFuture&lt;Long&gt; <span class="title function_">tryAcquireAsync</span><span class="params">(<span class="type">long</span> waitTime, <span class="type">long</span> leaseTime, TimeUnit unit, <span class="type">long</span> threadId)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (leaseTime != -<span class="number">1L</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.tryLockInnerAsync(waitTime, leaseTime, unit, threadId, RedisCommands.EVAL_LONG);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰æŒ‡å®šé‡Šæ”¾æ—¶é—´æ—¶é—´ï¼Œåˆ™æŒ‡å®šé»˜è®¤é‡Šæ”¾æ—¶é—´ä¸ºgetLockWatchdogTimeoutï¼Œåº•å±‚æºç æ˜¾ç¤ºæ˜¯30*1000msï¼Œä¹Ÿå°±æ˜¯30ç§’</span></span><br><span class="line">        RFuture&lt;Long&gt; ttlRemainingFuture = <span class="built_in">this</span>.tryLockInnerAsync(waitTime, <span class="built_in">this</span>.commandExecutor.getConnectionManager().getCfg().getLockWatchdogTimeout(), TimeUnit.MILLISECONDS, threadId, RedisCommands.EVAL_LONG);</span><br><span class="line">        ttlRemainingFuture.onComplete((ttlRemaining, e) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (e == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ttlRemaining == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.scheduleExpirationRenewal(threadId);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> ttlRemainingFuture;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>tryLock</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> waitTime, <span class="type">long</span> leaseTime, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> unit.toMillis(waitTime);</span><br><span class="line">        <span class="type">long</span> <span class="variable">current</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">long</span> <span class="variable">threadId</span> <span class="operator">=</span> Thread.currentThread().getId();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">ttl</span> <span class="operator">=</span> <span class="built_in">this</span>.tryAcquire(waitTime, leaseTime, unit, threadId);</span><br><span class="line">        <span class="comment">//åˆ¤æ–­ttlæ˜¯å¦ä¸ºnull</span></span><br><span class="line">        <span class="keyword">if</span> (ttl == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//è®¡ç®—å½“å‰æ—¶é—´ä¸è·å–é”æ—¶é—´çš„å·®å€¼ï¼Œè®©ç­‰å¾…æ—¶é—´å‡å»è¿™ä¸ªå€¼</span></span><br><span class="line">            time -= System.currentTimeMillis() - current;</span><br><span class="line">            <span class="comment">//å¦‚æœæ¶ˆè€—æ—¶é—´å¤ªé•¿äº†ï¼Œç›´æ¥è¿”å›falseï¼Œè·å–é”å¤±è´¥</span></span><br><span class="line">            <span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//ç­‰å¾…æ—¶é—´è¿˜æœ‰å‰©ä½™ï¼Œå†æ¬¡è·å–å½“å‰æ—¶é—´</span></span><br><span class="line">                current = System.currentTimeMillis();</span><br><span class="line">                <span class="comment">//è®¢é˜…åˆ«äººé‡Šæ”¾é”çš„ä¿¡å·</span></span><br><span class="line">                RFuture&lt;RedissonLockEntry&gt; subscribeFuture = <span class="built_in">this</span>.subscribe(threadId);</span><br><span class="line">                <span class="comment">//åœ¨å‰©ä½™æ—¶é—´å†…ï¼Œç­‰å¾…è¿™ä¸ªä¿¡å·</span></span><br><span class="line">                <span class="keyword">if</span> (!subscribeFuture.await(time, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!subscribeFuture.cancel(<span class="literal">false</span>)) &#123;</span><br><span class="line">                        subscribeFuture.onComplete((res, e) -&gt; &#123;</span><br><span class="line">                            <span class="keyword">if</span> (e == <span class="literal">null</span>) &#123;</span><br><span class="line">                                <span class="comment">//å–æ¶ˆè®¢é˜…</span></span><br><span class="line">                                <span class="built_in">this</span>.unsubscribe(subscribeFuture, threadId);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//å‰©ä½™æ—¶é—´å†…æ²¡ç­‰åˆ°ï¼Œè¿”å›false</span></span><br><span class="line">                    <span class="built_in">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">//å¦‚æœå‰©ä½™æ—¶é—´å†…ç­‰åˆ°äº†åˆ«äººé‡Šæ”¾é”çš„ä¿¡å·ï¼Œå†æ¬¡è®¡ç®—å½“å‰å‰©ä½™æœ€å¤§ç­‰å¾…æ—¶é—´</span></span><br><span class="line">                        time -= System.currentTimeMillis() - current;</span><br><span class="line">                        <span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">                            <span class="comment">//å¦‚æœå‰©ä½™æ—¶é—´ä¸ºè´Ÿæ•°ï¼Œåˆ™ç›´æ¥è¿”å›false</span></span><br><span class="line">                            <span class="built_in">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                            <span class="type">boolean</span> <span class="variable">var20</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">                            <span class="keyword">return</span> var20;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="type">boolean</span> var16;</span><br><span class="line">                            <span class="keyword">do</span> &#123;</span><br><span class="line">                                <span class="comment">//å¦‚æœå‰©ä½™æ—¶é—´ç­‰åˆ°äº†ï¼Œdowhileå¾ªç¯é‡è¯•è·å–é”</span></span><br><span class="line">                                <span class="type">long</span> <span class="variable">currentTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">                                ttl = <span class="built_in">this</span>.tryAcquire(waitTime, leaseTime, unit, threadId);</span><br><span class="line">                                <span class="keyword">if</span> (ttl == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    var16 = <span class="literal">true</span>;</span><br><span class="line">                                    <span class="keyword">return</span> var16;</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                                time -= System.currentTimeMillis() - currentTime;</span><br><span class="line">                                <span class="keyword">if</span> (time &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">                                    <span class="built_in">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                                    var16 = <span class="literal">false</span>;</span><br><span class="line">                                    <span class="keyword">return</span> var16;</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                                currentTime = System.currentTimeMillis();</span><br><span class="line">                                <span class="keyword">if</span> (ttl &gt;= <span class="number">0L</span> &amp;&amp; ttl &lt; time) &#123;</span><br><span class="line">                                    ((RedissonLockEntry)subscribeFuture.getNow()).getLatch().tryAcquire(ttl, TimeUnit.MILLISECONDS);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    ((RedissonLockEntry)subscribeFuture.getNow()).getLatch().tryAcquire(time, TimeUnit.MILLISECONDS);</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                                time -= System.currentTimeMillis() - currentTime;</span><br><span class="line">                            &#125; <span class="keyword">while</span>(time &gt; <span class="number">0L</span>);</span><br><span class="line"></span><br><span class="line">                            <span class="built_in">this</span>.acquireFailed(waitTime, unit, threadId);</span><br><span class="line">                            var16 = <span class="literal">false</span>;</span><br><span class="line">                            <span class="keyword">return</span> var16;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.unsubscribe(subscribeFuture, threadId);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>scheduleExpirationRenewal</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">scheduleExpirationRenewal</span><span class="params">(<span class="type">long</span> threadId)</span> &#123;</span><br><span class="line">    <span class="type">ExpirationEntry</span> <span class="variable">entry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExpirationEntry</span>();  </span><br><span class="line">    <span class="comment">//ä¸å­˜åœ¨ï¼Œæ‰putï¼Œè¡¨æ˜æ˜¯ç¬¬ä¸€æ¬¡è¿›å…¥ï¼Œä¸æ˜¯é‡å…¥</span></span><br><span class="line">    <span class="type">ExpirationEntry</span> <span class="variable">oldEntry</span> <span class="operator">=</span> (ExpirationEntry)EXPIRATION_RENEWAL_MAP.putIfAbsent(<span class="built_in">this</span>.getEntryName(), entry);</span><br><span class="line">    <span class="keyword">if</span> (oldEntry != <span class="literal">null</span>) &#123;</span><br><span class="line">        oldEntry.addThreadId(threadId);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿›å…¥ï¼Œåˆ™è·Ÿæ–°æœ‰æ•ˆæœŸ</span></span><br><span class="line">        entry.addThreadId(threadId);</span><br><span class="line">        <span class="built_in">this</span>.renewExpiration();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>renewExpiration</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">renewExpiration</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ExpirationEntry</span> <span class="variable">ee</span> <span class="operator">=</span> (ExpirationEntry)EXPIRATION_RENEWAL_MAP.get(<span class="built_in">this</span>.getEntryName());</span><br><span class="line">    <span class="keyword">if</span> (ee != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//Timeoutæ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡</span></span><br><span class="line">        <span class="type">Timeout</span> <span class="variable">task</span> <span class="operator">=</span> <span class="built_in">this</span>.commandExecutor.getConnectionManager().newTimeout(<span class="keyword">new</span> <span class="title class_">TimerTask</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(Timeout timeout)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                <span class="type">ExpirationEntry</span> <span class="variable">ent</span> <span class="operator">=</span> (ExpirationEntry)RedissonLock.EXPIRATION_RENEWAL_MAP.get(RedissonLock.<span class="built_in">this</span>.getEntryName());</span><br><span class="line">                <span class="keyword">if</span> (ent != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">Long</span> <span class="variable">threadId</span> <span class="operator">=</span> ent.getFirstThreadId();</span><br><span class="line">                    <span class="keyword">if</span> (threadId != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="comment">//é‡ç½®æœ‰æ•ˆæœŸ</span></span><br><span class="line">                        RFuture&lt;Boolean&gt; future = RedissonLock.<span class="built_in">this</span>.renewExpirationAsync(threadId);</span><br><span class="line">                        future.onComplete((res, e) -&gt; &#123;</span><br><span class="line">                            <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">                                RedissonLock.log.error(<span class="string">&quot;Can&#x27;t update lock &quot;</span> + RedissonLock.<span class="built_in">this</span>.getName() + <span class="string">&quot; expiration&quot;</span>, e);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                                    <span class="comment">//ç„¶åè°ƒç”¨è‡ªå·±ï¼Œé€’å½’é‡ç½®æœ‰æ•ˆæœŸ</span></span><br><span class="line">                                    RedissonLock.<span class="built_in">this</span>.renewExpiration();</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//internalLockLeaseTimeæ˜¯ä¹‹å‰WatchDogé»˜è®¤æœ‰æ•ˆæœŸ30ç§’ï¼Œé‚£è¿™é‡Œå°±æ˜¯ 30 / 3 = 10ç§’ä¹‹åï¼Œæ‰ä¼šæ‰§è¡Œ</span></span><br><span class="line">        &#125;, <span class="built_in">this</span>.internalLockLeaseTime / <span class="number">3L</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">        ee.setTimeout(task);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>renewExpirationAsync<br>é‡ç‚¹çœ‹luaè„šæœ¬ï¼Œå…ˆåˆ¤æ–­é”æ˜¯ä¸æ˜¯è‡ªå·±çš„ï¼Œç„¶åæ›´æ–°æœ‰æ•ˆæ—¶é—´</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JAVA</span><br><span class="line">protected RFuture&lt;Boolean&gt; renewExpirationAsync(long threadId) &#123;</span><br><span class="line">    <span class="keyword">return</span> this.evalWriteAsync(this.getName(), LongCodec.INSTANCE, RedisCommands.EVAL_BOOLEAN, <span class="string">&quot;if (redis.call(&#x27;hexists&#x27;, KEYS[1], ARGV[2]) == 1) then redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); return 1; end; return 0;&quot;</span>, Collections.singletonList(this.getName()), this.internalLockLeaseTime, this.getLockName(threadId));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é‚£ä¹ˆä¹‹å‰çš„é‡ç½®æœ‰æ•ˆæœŸçš„è¡Œä¸ºè¯¥æ€ä¹ˆç»ˆæ­¢å‘¢ï¼Ÿå½“ç„¶æ˜¯é‡Šæ”¾é”çš„æ—¶å€™ä¼šç»ˆæ­¢</p></li><li><p>cancelExpirationRenewal</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">JAVA</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">cancelExpirationRenewal</span><span class="params">(Long threadId)</span> &#123;</span><br><span class="line">    <span class="comment">//å°†ä¹‹å‰çš„çº¿ç¨‹ç»ˆæ­¢æ‰</span></span><br><span class="line">    <span class="type">ExpirationEntry</span> <span class="variable">task</span> <span class="operator">=</span> (ExpirationEntry)EXPIRATION_RENEWAL_MAP.get(<span class="built_in">this</span>.getEntryName());</span><br><span class="line">    <span class="keyword">if</span> (task != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (threadId != <span class="literal">null</span>) &#123;</span><br><span class="line">            task.removeThreadId(threadId);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (threadId == <span class="literal">null</span> || task.hasNoThreads()) &#123;</span><br><span class="line">            <span class="comment">//è·å–ä¹‹å‰çš„å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">            <span class="type">Timeout</span> <span class="variable">timeout</span> <span class="operator">=</span> task.getTimeout();</span><br><span class="line">            <span class="keyword">if</span> (timeout != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//å–æ¶ˆ</span></span><br><span class="line">                timeout.cancel();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            EXPIRATION_RENEWAL_MAP.remove(<span class="built_in">this</span>.getEntryName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>æ€»ç»“</strong></p><p>Redissonåˆ†å¸ƒå¼é”åŸç†ï¼š</p><ul><li><p><strong>å¯é‡å…¥</strong>ï¼šåˆ©ç”¨hashç»“æ„è®°å½•çº¿ç¨‹idå’Œé‡å…¥æ¬¡æ•°</p></li><li><p><strong>å¯é‡è¯•</strong>ï¼šåˆ©ç”¨ä¿¡å·é‡å’ŒPubSubåŠŸèƒ½å®ç°ç­‰å¾…ã€å”¤é†’ï¼Œè·å–é”å¤±è´¥çš„é‡è¯•æœºåˆ¶</p></li><li><p><strong>è¶…æ—¶ç»­çº¦</strong>ï¼šåˆ©ç”¨watchDogï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆreleaseTime / 3ï¼‰ï¼Œé‡ç½®è¶…æ—¶æ—¶é—´</p></li></ul><h2 id="fen-bu-shi-suo-redission-suo-de-muti-lock-yuan-li" id="åˆ†å¸ƒå¼é”-redissioné”çš„MutiLockåŸç†">åˆ†å¸ƒå¼é”-redissioné”çš„MutiLockåŸç†</h2><p>ä¸ºäº†æé«˜redisçš„å¯ç”¨æ€§ï¼Œæˆ‘ä»¬ä¼šæ­å»ºé›†ç¾¤æˆ–è€…ä¸»ä»ï¼Œç°åœ¨ä»¥ä¸»ä»ä¸ºä¾‹</p><p>æ­¤æ—¶æˆ‘ä»¬å»å†™å‘½ä»¤ï¼Œå†™åœ¨ä¸»æœºä¸Šï¼Œ ä¸»æœºä¼šå°†æ•°æ®åŒæ­¥ç»™ä»æœºï¼Œ</p><ul><li>ä½†æ˜¯å‡è®¾åœ¨ä¸»æœºè¿˜æ²¡æœ‰æ¥å¾—åŠæŠŠæ•°æ®å†™å…¥åˆ°ä»æœºå»çš„æ—¶å€™ï¼Œæ­¤æ—¶ä¸»æœºå®•æœºï¼Œå“¨å…µä¼šå‘ç°ä¸»æœºå®•æœºï¼Œ</li><li>å¹¶ä¸”é€‰ä¸¾ä¸€ä¸ªslaveå˜æˆmasterï¼Œè€Œæ­¤æ—¶æ–°çš„masterä¸­å®é™…ä¸Šå¹¶æ²¡æœ‰é”ä¿¡æ¯ï¼Œæ­¤æ—¶<u>é”ä¿¡æ¯å°±å·²ç»ä¸¢æ‰äº†</u>ã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/03/29/1fd961e4e5544141be84c36cf36060d1" alt="1653553998403"></p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œredissionæå‡ºæ¥äº†<strong>MutiLocké”</strong>ï¼Œä½¿ç”¨è¿™æŠŠé”å’±ä»¬å°±ä¸ä½¿ç”¨ä¸»ä»äº†ï¼Œ</p><ul><li>æ¯ä¸ªèŠ‚ç‚¹çš„åœ°ä½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œ è¿™æŠŠé”åŠ é”çš„é€»è¾‘éœ€è¦å†™å…¥åˆ°æ¯ä¸€ä¸ªä¸»ä»èŠ‚ç‚¹ä¸Šï¼Œ</li><li>åªæœ‰æ‰€æœ‰çš„æœåŠ¡å™¨éƒ½å†™å…¥æˆåŠŸï¼Œæ­¤æ—¶æ‰æ˜¯åŠ é”æˆåŠŸï¼Œ</li><li>å‡è®¾ç°åœ¨æŸä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œé‚£ä¹ˆä»–å»è·å¾—é”çš„æ—¶å€™ï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹æ‹¿ä¸åˆ°ï¼Œéƒ½ä¸èƒ½ç®—æ˜¯åŠ é”æˆåŠŸï¼Œå°±ä¿è¯äº†åŠ é”çš„å¯é æ€§ã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/03/29/c0cfbd0f20314278b9c4fd98b09eb46d" alt="1653554055048"></p><p>é‚£ä¹ˆMutiLock åŠ é”åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç¬”è€…ç”»äº†ä¸€å¹…å›¾æ¥è¯´æ˜</p><p>å½“æˆ‘ä»¬å»è®¾ç½®äº†å¤šä¸ªé”æ—¶ï¼Œredissionä¼šå°†å¤šä¸ªé”æ·»åŠ åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼Œç„¶åç”¨whileå¾ªç¯å»ä¸åœå»å°è¯•æ‹¿é”ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªæ€»å…±çš„åŠ é”æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯ç”¨éœ€è¦åŠ é”çš„ä¸ªæ•° * 1500ms ï¼Œå‡è®¾æœ‰3ä¸ªé”ï¼Œé‚£ä¹ˆæ—¶é—´å°±æ˜¯4500msï¼Œå‡è®¾åœ¨è¿™4500mså†…ï¼Œæ‰€æœ‰çš„é”éƒ½åŠ é”æˆåŠŸï¼Œ é‚£ä¹ˆæ­¤æ—¶æ‰ç®—æ˜¯åŠ é”æˆåŠŸï¼Œå¦‚æœåœ¨4500msæœ‰çº¿ç¨‹åŠ é”å¤±è´¥ï¼Œåˆ™ä¼šå†æ¬¡å»è¿›è¡Œé‡è¯•.</p><img src="https://s1.vika.cn/space/2023/03/29/f4bfcda78da24902a1cb999cb925aab9" alt="1653553093967" style="zoom:200%;" /><h1 id="fen-bu-shi-suo-zong-jie">åˆ†å¸ƒå¼é”æ€»ç»“</h1><p>1ï¼‰ä¸å¯é‡å…¥Redisåˆ†å¸ƒå¼é”ï¼š</p><ul><li><p>åŸç†ï¼šåˆ©ç”¨setnxçš„äº’æ–¥æ€§ï¼›åˆ©ç”¨exé¿å…æ­»é”ï¼›é‡Šæ”¾é”æ—¶åˆ¤æ–­çº¿ç¨‹æ ‡ç¤º</p></li><li><p>ç¼ºé™·ï¼šä¸å¯é‡å…¥ã€æ— æ³•é‡è¯•ã€é”è¶…æ—¶å¤±æ•ˆ</p></li></ul><p>2ï¼‰å¯é‡å…¥çš„Redisåˆ†å¸ƒå¼é”ï¼š</p><ul><li><p>åŸç†ï¼šåˆ©ç”¨hashç»“æ„ï¼Œè®°å½•çº¿ç¨‹æ ‡ç¤ºå’Œé‡å…¥æ¬¡æ•°ï¼›åˆ©ç”¨watchDogå»¶ç»­é”æ—¶é—´ï¼›åˆ©ç”¨ä¿¡å·é‡æ§åˆ¶é”é‡è¯•ç­‰å¾…</p></li><li><p>ç¼ºé™·ï¼šrediså®•æœºå¼•èµ·é”å¤±æ•ˆé—®é¢˜</p></li></ul><p>3ï¼‰Redissonçš„multiLockï¼š</p><ul><li><p>åŸç†ï¼šå¤šä¸ªç‹¬ç«‹çš„RedisèŠ‚ç‚¹ï¼Œå¿…é¡»åœ¨æ‰€æœ‰èŠ‚ç‚¹éƒ½è·å–é‡å…¥é”ï¼Œæ‰ç®—è·å–é”æˆåŠŸ</p></li><li><p>ç¼ºé™·ï¼šè¿ç»´æˆæœ¬é«˜ã€å®ç°å¤æ‚</p></li></ul>]]></content>
    
    
    <summary type="html">é»‘é©¬ç‚¹è¯„é¡¹ç›®å®æˆ˜ï¼šç¼“å­˜ã€åˆ†å¸ƒå¼é”</summary>
    
    
    
    <category term="Java" scheme="https://www.taoyaopc.live/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>è®¾è®¡åŸåˆ™</title>
    <link href="https://www.taoyaopc.live/posts/a151c9f2.html"/>
    <id>https://www.taoyaopc.live/posts/a151c9f2.html</id>
    <published>2023-03-23T10:33:33.000Z</published>
    <updated>2023-04-06T07:47:42.129Z</updated>
    
    <content type="html"><![CDATA[<h1 id="dan-yi-zhi-ze-yuan-ze">å•ä¸€èŒè´£åŸåˆ™</h1><h1 id="kai-fang-bi-he-yuan-ze">å¼€æ”¾â€”é—­åˆåŸåˆ™</h1><h1 id="li-shi-dai-huan-yuan-ze">é‡Œæ°ä»£æ¢åŸåˆ™</h1><h1 id="yi-lai-dao-zhuan-yuan-ze">ä¾èµ–å€’è½¬åŸåˆ™</h1><h1 id="jie-kou-ge-chi-yuan-ze">æ¥å£éš”ç¦»åŸåˆ™</h1><h1 id="di-mi-te-fa-ze">è¿ªç±³ç‰¹æ³•åˆ™</h1><h2 id="xia-yi-de-di-mi-te-fa-ze" id="ç‹­ä¹‰çš„è¿ªç±³ç‰¹æ³•åˆ™">ç‹­ä¹‰çš„è¿ªç±³ç‰¹æ³•åˆ™</h2><h2 id="yan-yi-de-di-mi-te-fa-ze" id="å¹¿ä¹‰çš„è¿ªç±³ç‰¹æ³•åˆ™">å¹¿ä¹‰çš„è¿ªç±³ç‰¹æ³•åˆ™</h2><h1 id="he-cheng-ju-he-fu-yong-yuan-ze">åˆæˆ/èšåˆå¤ç”¨åŸåˆ™</h1>]]></content>
    
    
    <summary type="html">å¸¸è§è®¾è®¡åŸåˆ™</summary>
    
    
    
    <category term="ç¼–ç¨‹æ€æƒ³æ–¹æ³•" scheme="https://www.taoyaopc.live/categories/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%E6%96%B9%E6%B3%95/"/>
    
    
  </entry>
  
  <entry>
    <title>Redis åŸºç¡€ç¯‡</title>
    <link href="https://www.taoyaopc.live/posts/f52b4fc3.html"/>
    <id>https://www.taoyaopc.live/posts/f52b4fc3.html</id>
    <published>2023-03-19T08:30:30.000Z</published>
    <updated>2023-03-21T06:15:23.655Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ji-chu-pian-redis">åŸºç¡€ç¯‡Redis</h1><h1 id="redis-jian-dan-jie-shao">Redisç®€å•ä»‹ç»</h1><p>Redisæ˜¯ä¸€ç§é”®å€¼å‹çš„NoSqlæ•°æ®åº“ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªå…³é”®å­—ï¼š</p><ul><li>é”®å€¼å‹</li><li>NoSql</li></ul><p>å…¶ä¸­<strong>é”®å€¼å‹</strong>ï¼Œæ˜¯æŒ‡Redisä¸­å­˜å‚¨çš„æ•°æ®éƒ½æ˜¯ä»¥key.valueå¯¹çš„å½¢å¼å­˜å‚¨ï¼Œè€Œvalueçš„å½¢å¼å¤šç§å¤šæ ·ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸².æ•°å€¼.ç”šè‡³jsonï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/22cd55e30faa4e9b8f4f7f66c02d2b89" alt="1652882668159"></p><p>è€ŒNoSqlåˆ™æ˜¯ç›¸å¯¹äºä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“è€Œè¨€ï¼Œæœ‰å¾ˆå¤§å·®å¼‚çš„ä¸€ç§æ•°æ®åº“ã€‚</p><p>å¯¹äºå­˜å‚¨çš„æ•°æ®ï¼Œæ²¡æœ‰ç±»ä¼¼Mysqlé‚£ä¹ˆä¸¥æ ¼çš„çº¦æŸï¼Œæ¯”å¦‚å”¯ä¸€æ€§ï¼Œæ˜¯å¦å¯ä»¥ä¸ºnullç­‰ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ç§æ¾æ•£ç»“æ„çš„æ•°æ®åº“ï¼Œç§°ä¹‹ä¸ºNoSQLæ•°æ®åº“ã€‚</p><h1 id="ke-cheng-mu-lu">è¯¾ç¨‹ç›®å½•</h1><blockquote><ul><li>åˆå§‹Redis<ul><li>è®¤è¯†NoSQL</li><li>è®¤è¯†Redis</li><li>å®‰è£…Redis</li></ul></li><li>Rediså¸¸è§å‘½ä»¤<ul><li>5ç§å¸¸è§æ•°æ®ç»“æ„</li><li>é€šç”¨å‘½ä»¤</li><li>ä¸åŒæ•°æ®ç»“æ„çš„æ“ä½œå‘½ä»¤</li></ul></li><li>Redisçš„Javaå®¢æˆ·ç«¯<ul><li>Jediså®¢æˆ·ç«¯</li><li>SpringDataRediså®¢æˆ·ç«¯</li></ul></li></ul></blockquote><h1 id="chu-shi-redis">åˆè¯†Redis</h1><p>Redisæ˜¯ä¸€ç§é”®å€¼å‹çš„NoSqlæ•°æ®åº“ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªå…³é”®å­—ï¼š</p><ul><li><p>é”®å€¼å‹</p></li><li><p>NoSql</p></li></ul><p>å…¶ä¸­<strong>é”®å€¼å‹</strong>ï¼Œæ˜¯æŒ‡Redisä¸­å­˜å‚¨çš„æ•°æ®éƒ½æ˜¯ä»¥keyã€valueå¯¹çš„å½¢å¼å­˜å‚¨ï¼Œè€Œvalueçš„å½¢å¼å¤šç§å¤šæ ·ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°å€¼ã€ç”šè‡³jsonï¼š</p><p><img src="https://s1.vika.cn/space/2022/12/12/854c5049a5c84639a5c1b95193ab1903" alt="image-20220502190959608"></p><p>è€ŒNoSqlåˆ™æ˜¯ç›¸å¯¹äºä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“è€Œè¨€ï¼Œæœ‰å¾ˆå¤§å·®å¼‚çš„ä¸€ç§æ•°æ®åº“ã€‚</p><h2 id="ren-shi-no-sql" id="è®¤è¯†NoSQL">è®¤è¯†NoSQL</h2><p><strong>NoSql</strong>å¯ä»¥ç¿»è¯‘åšNot Only Sqlï¼ˆä¸ä»…ä»…æ˜¯SQLï¼‰ï¼Œæˆ–è€…æ˜¯No Sqlï¼ˆéSqlçš„ï¼‰æ•°æ®åº“ã€‚æ˜¯ç›¸å¯¹äºä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“è€Œè¨€ï¼Œæœ‰å¾ˆå¤§å·®å¼‚çš„ä¸€ç§ç‰¹æ®Šçš„æ•°æ®åº“ï¼Œå› æ­¤ä¹Ÿç§°ä¹‹ä¸º<strong>éå…³ç³»å‹æ•°æ®åº“</strong>ã€‚</p><h3 id="jie-gou-hua-yu-fei-jie-gou-hua" id="ç»“æ„åŒ–ä¸éç»“æ„åŒ–">ç»“æ„åŒ–ä¸éç»“æ„åŒ–</h3><p>ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“æ˜¯ç»“æ„åŒ–æ•°æ®ï¼Œæ¯ä¸€å¼ è¡¨éƒ½æœ‰ä¸¥æ ¼çš„çº¦æŸä¿¡æ¯ï¼šå­—æ®µåã€å­—æ®µæ•°æ®ç±»å‹ã€å­—æ®µçº¦æŸç­‰ç­‰ä¿¡æ¯ï¼Œæ’å…¥çš„æ•°æ®å¿…é¡»éµå®ˆè¿™äº›çº¦æŸï¼š</p><p><img src="https://s1.vika.cn/space/2022/12/12/fcd3a28c5ace4da3a6751173125efa7c" alt=""></p><p>è€ŒNoSqlåˆ™å¯¹æ•°æ®åº“æ ¼å¼æ²¡æœ‰ä¸¥æ ¼çº¦æŸï¼Œå¾€å¾€å½¢å¼æ¾æ•£ï¼Œè‡ªç”±ã€‚</p><p>å¯ä»¥æ˜¯é”®å€¼å‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/41a137a8aea54192b02f9ad32edb706c" alt=""></p><p>ä¹Ÿå¯ä»¥æ˜¯æ–‡æ¡£å‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/922ba20cb1b84d539eab786fb55f2a54" alt=""></p><p>ç”šè‡³å¯ä»¥æ˜¯å›¾æ ¼å¼ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/a2cbf9bb60d349bf9279fea040ea091f" alt=""></p><h3 id="guan-lian-he-fei-guan-lian" id="å…³è”å’Œéå…³è”">å…³è”å’Œéå…³è”</h3><p>ä¼ ç»Ÿæ•°æ®åº“çš„è¡¨ä¸è¡¨ä¹‹é—´å¾€å¾€å­˜åœ¨å…³è”ï¼Œä¾‹å¦‚å¤–é”®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/b218d3ebe74e40f7a9145708b6b7c710" alt=""></p><p>è€Œéå…³ç³»å‹æ•°æ®åº“ä¸å­˜åœ¨å…³è”å…³ç³»ï¼Œè¦ç»´æŠ¤å…³ç³»è¦ä¹ˆé ä»£ç ä¸­çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¦ä¹ˆé æ•°æ®ä¹‹é—´çš„è€¦åˆï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  id<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  name<span class="punctuation">:</span> <span class="string">&quot;å¼ ä¸‰&quot;</span><span class="punctuation">,</span></span><br><span class="line">  orders<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">       id<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">       item<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"> id<span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span> title<span class="punctuation">:</span> <span class="string">&quot;è£è€€6&quot;</span><span class="punctuation">,</span> price<span class="punctuation">:</span> <span class="number">4999</span></span><br><span class="line">       <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">       id<span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">       item<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"> id<span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span> title<span class="punctuation">:</span> <span class="string">&quot;å°ç±³11&quot;</span><span class="punctuation">,</span> price<span class="punctuation">:</span> <span class="number">3999</span></span><br><span class="line">       <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æ­¤å¤„è¦ç»´æŠ¤â€œå¼ ä¸‰â€çš„è®¢å•ä¸å•†å“â€œè£è€€â€å’Œâ€œå°ç±³11â€çš„å…³ç³»ï¼Œä¸å¾—ä¸å†—ä½™çš„å°†è¿™ä¸¤ä¸ªå•†å“ä¿å­˜åœ¨å¼ ä¸‰çš„è®¢å•æ–‡æ¡£ä¸­ï¼Œä¸å¤Ÿä¼˜é›…ã€‚è¿˜æ˜¯å»ºè®®ç”¨ä¸šåŠ¡æ¥ç»´æŠ¤å…³è”å…³ç³»ã€‚</p><h3 id="cha-xun-fang-shi" id="æŸ¥è¯¢æ–¹å¼">æŸ¥è¯¢æ–¹å¼</h3><p>ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“ä¼šåŸºäºSqlè¯­å¥åšæŸ¥è¯¢ï¼Œè¯­æ³•æœ‰ç»Ÿä¸€æ ‡å‡†ï¼›</p><p>è€Œä¸åŒçš„éå…³ç³»æ•°æ®åº“æŸ¥è¯¢è¯­æ³•å·®å¼‚æå¤§ï¼Œäº”èŠ±å…«é—¨å„ç§å„æ ·ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/19/7dbc853ab49f4a98a3c2f12cec4fc883" alt=""></p><h3 id="shi-wu" id="äº‹åŠ¡">äº‹åŠ¡</h3><p>ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“èƒ½æ»¡è¶³äº‹åŠ¡ACIDçš„åŸåˆ™ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/19/3b75fc52e40f4031b1394efb819d4f6f" alt=""></p><p>è€Œéå…³ç³»å‹æ•°æ®åº“å¾€å¾€ä¸æ”¯æŒäº‹åŠ¡ï¼Œæˆ–è€…ä¸èƒ½ä¸¥æ ¼ä¿è¯ACIDçš„ç‰¹æ€§ï¼Œåªèƒ½å®ç°åŸºæœ¬çš„ä¸€è‡´æ€§ã€‚</p><h3 id="zong-jie" id="æ€»ç»“">æ€»ç»“</h3><p>é™¤äº†ä¸Šè¿°å››ç‚¹ä»¥å¤–ï¼Œåœ¨å­˜å‚¨æ–¹å¼ã€æ‰©å±•æ€§ã€æŸ¥è¯¢æ€§èƒ½ä¸Šå…³ç³»å‹ä¸éå…³ç³»å‹ä¹Ÿéƒ½æœ‰ç€æ˜¾è‘—å·®å¼‚ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/7f5542adc8fa413db4a35ee95099e7d6" alt=""></p><ul><li>å­˜å‚¨æ–¹å¼<ul><li>å…³ç³»å‹æ•°æ®åº“åŸºäºç£ç›˜è¿›è¡Œå­˜å‚¨ï¼Œä¼šæœ‰å¤§é‡çš„ç£ç›˜IOï¼Œå¯¹æ€§èƒ½æœ‰ä¸€å®šå½±å“</li><li>éå…³ç³»å‹æ•°æ®åº“ï¼Œä»–ä»¬çš„æ“ä½œæ›´å¤šçš„æ˜¯ä¾èµ–äºå†…å­˜æ¥æ“ä½œï¼Œå†…å­˜çš„è¯»å†™é€Ÿåº¦ä¼šéå¸¸å¿«ï¼Œæ€§èƒ½è‡ªç„¶ä¼šå¥½ä¸€äº›</li></ul></li></ul><ul><li>æ‰©å±•æ€§<ul><li>å…³ç³»å‹æ•°æ®åº“é›†ç¾¤æ¨¡å¼ä¸€èˆ¬æ˜¯ä¸»ä»ï¼Œä¸»ä»æ•°æ®ä¸€è‡´ï¼Œèµ·åˆ°æ•°æ®å¤‡ä»½çš„ä½œç”¨ï¼Œç§°ä¸ºå‚ç›´æ‰©å±•ã€‚</li><li>éå…³ç³»å‹æ•°æ®åº“å¯ä»¥å°†æ•°æ®æ‹†åˆ†ï¼Œå­˜å‚¨åœ¨ä¸åŒæœºå™¨ä¸Šï¼Œå¯ä»¥ä¿å­˜æµ·é‡æ•°æ®ï¼Œè§£å†³å†…å­˜å¤§å°æœ‰é™çš„é—®é¢˜ã€‚ç§°ä¸ºæ°´å¹³æ‰©å±•ã€‚</li><li>å…³ç³»å‹æ•°æ®åº“å› ä¸ºè¡¨ä¹‹é—´å­˜åœ¨å…³è”å…³ç³»ï¼Œå¦‚æœåšæ°´å¹³æ‰©å±•ä¼šç»™æ•°æ®æŸ¥è¯¢å¸¦æ¥å¾ˆå¤šéº»çƒ¦</li></ul></li></ul><h2 id="ren-shi-redis" id="è®¤è¯†Redis">è®¤è¯†Redis</h2><p>Redisè¯ç”Ÿäº2009å¹´å…¨ç§°æ˜¯<strong>Re</strong>mote  <strong>D</strong>ictionary <strong>S</strong>erver è¿œç¨‹è¯å…¸æœåŠ¡å™¨ï¼Œæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„é”®å€¼å‹NoSQLæ•°æ®åº“ã€‚</p><p><strong>ç‰¹å¾</strong>ï¼š</p><ul><li>é”®å€¼ï¼ˆkey-valueï¼‰å‹ï¼Œvalueæ”¯æŒå¤šç§ä¸åŒæ•°æ®ç»“æ„ï¼ŒåŠŸèƒ½ä¸°å¯Œ</li><li>å•çº¿ç¨‹ï¼Œæ¯ä¸ªå‘½ä»¤å…·å¤‡åŸå­æ€§</li><li>ä½å»¶è¿Ÿï¼Œé€Ÿåº¦å¿«ï¼ˆåŸºäºå†…å­˜ã€IOå¤šè·¯å¤ç”¨ã€è‰¯å¥½çš„ç¼–ç ï¼‰ã€‚</li><li>æ”¯æŒæ•°æ®æŒä¹…åŒ–</li><li>æ”¯æŒä¸»ä»é›†ç¾¤ã€åˆ†ç‰‡é›†ç¾¤</li><li>æ”¯æŒå¤šè¯­è¨€å®¢æˆ·ç«¯</li></ul><p><strong>ä½œè€…</strong>ï¼šAntirez</p><p>Redisçš„å®˜æ–¹ç½‘ç«™åœ°å€ï¼š<a href="https://redis.io/">https://redis.io/</a></p><h2 id="an-zhuang-redis" id="å®‰è£…Redis">å®‰è£…Redis</h2><p>å¤§å¤šæ•°ä¼ä¸šéƒ½æ˜¯åŸºäºLinuxæœåŠ¡å™¨æ¥éƒ¨ç½²é¡¹ç›®ï¼Œè€Œä¸”Rediså®˜æ–¹ä¹Ÿæ²¡æœ‰æä¾›Windowsç‰ˆæœ¬çš„å®‰è£…åŒ…ã€‚å› æ­¤è¯¾ç¨‹ä¸­æˆ‘ä»¬ä¼šåŸºäºLinuxç³»ç»Ÿæ¥å®‰è£…Redis.</p><p>æ­¤å¤„é€‰æ‹©çš„Linuxç‰ˆæœ¬ä¸ºCentOS 7.</p><h3 id="yi-lai-ku" id="ä¾èµ–åº“">ä¾èµ–åº“</h3><p>Redisæ˜¯åŸºäºCè¯­è¨€ç¼–å†™çš„ï¼Œå› æ­¤é¦–å…ˆéœ€è¦å®‰è£…Redisæ‰€éœ€è¦çš„gccä¾èµ–ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc tcl</span><br></pre></td></tr></table></figure><h3 id="shang-chuan-an-zhuang-bao-bing-jie-ya" id="ä¸Šä¼ å®‰è£…åŒ…å¹¶è§£å‹">ä¸Šä¼ å®‰è£…åŒ…å¹¶è§£å‹</h3><p>ç„¶åå°†è¯¾å‰èµ„æ–™æä¾›çš„Rediså®‰è£…åŒ…ä¸Šä¼ åˆ°è™šæ‹Ÿæœºçš„ä»»æ„ç›®å½•ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/4fee2002a5514de4978e1d0684392685" alt=""></p><p>ä¾‹å¦‚ï¼Œæˆ‘æ”¾åˆ°äº†/usr/local/src ç›®å½•ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/c266309eaf4b4c99b25a8ab5436f58b7" alt=""></p><p>è§£å‹ç¼©ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzf redis-6.2.6.tar.gz</span><br></pre></td></tr></table></figure><p>è§£å‹åï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/a2fea596c49a4921bc095a824a898711" alt="image-20211211080339076"></p><p>è¿›å…¥redisç›®å½•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> redis-6.2.6</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¼–è¯‘å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰å‡ºé”™ï¼Œåº”è¯¥å°±å®‰è£…æˆåŠŸäº†ã€‚</p><p>é»˜è®¤çš„å®‰è£…è·¯å¾„æ˜¯åœ¨ <code>/usr/local/bin</code>ç›®å½•ä¸‹ï¼š</p><p><img src="https://i.imgur.com/YSxkGm7.png" alt=""></p><p>è¯¥ç›®å½•å·²ç»é»˜è®¤é…ç½®åˆ°ç¯å¢ƒå˜é‡ï¼Œå› æ­¤å¯ä»¥åœ¨ä»»æ„ç›®å½•ä¸‹è¿è¡Œè¿™äº›å‘½ä»¤ã€‚å…¶ä¸­ï¼š</p><ul><li>redis-cliï¼šæ˜¯redisæä¾›çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯</li><li>redis-serverï¼šæ˜¯redisçš„æœåŠ¡ç«¯å¯åŠ¨è„šæœ¬</li><li>redis-sentinelï¼šæ˜¯redisçš„å“¨å…µå¯åŠ¨è„šæœ¬</li></ul><h3 id="qi-dong" id="å¯åŠ¨">å¯åŠ¨</h3><p>redisçš„å¯åŠ¨æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä¾‹å¦‚ï¼š</p><ul><li>é»˜è®¤å¯åŠ¨</li><li>æŒ‡å®šé…ç½®å¯åŠ¨</li><li>å¼€æœºè‡ªå¯</li></ul><h3 id="mo-ren-qi-dong" id="é»˜è®¤å¯åŠ¨">é»˜è®¤å¯åŠ¨</h3><p>å®‰è£…å®Œæˆåï¼Œåœ¨ä»»æ„ç›®å½•è¾“å…¥redis-serverå‘½ä»¤å³å¯å¯åŠ¨Redisï¼š</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-<span class="keyword">server</span></span><br></pre></td></tr></table></figure><p>å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/cf46a891e0234837bab3f3795caf4a86" alt=""></p><p>è¿™ç§å¯åŠ¨å±äº<code>å‰å°å¯åŠ¨</code>ï¼Œä¼šé˜»å¡æ•´ä¸ªä¼šè¯çª—å£ï¼Œçª—å£å…³é—­æˆ–è€…æŒ‰ä¸‹<code>CTRL + C</code>åˆ™Redisåœæ­¢ã€‚ä¸æ¨èä½¿ç”¨ã€‚</p><h3 id="zhi-ding-pei-zhi-qi-dong" id="æŒ‡å®šé…ç½®å¯åŠ¨">æŒ‡å®šé…ç½®å¯åŠ¨</h3><p>å¦‚æœè¦è®©Redisä»¥<code>åå°</code>æ–¹å¼å¯åŠ¨ï¼Œåˆ™å¿…é¡»ä¿®æ”¹Redisé…ç½®æ–‡ä»¶ï¼Œå°±åœ¨æˆ‘ä»¬ä¹‹å‰è§£å‹çš„rediså®‰è£…åŒ…ä¸‹ï¼ˆ<code>/usr/local/src/redis-6.2.6</code>ï¼‰ï¼Œåå­—å«redis.confï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/9886e37b47b64c58bb6259d308341e6f" alt="image-20211211082225509"></p><p>æˆ‘ä»¬å…ˆå°†è¿™ä¸ªé…ç½®æ–‡ä»¶å¤‡ä»½ä¸€ä»½ï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cp</span> redis.<span class="keyword">conf</span> redis.<span class="keyword">conf</span>.bck</span><br></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹redis.confæ–‡ä»¶ä¸­çš„ä¸€äº›é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…è®¸è®¿é—®çš„åœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1ï¼Œä¼šå¯¼è‡´åªèƒ½åœ¨æœ¬åœ°è®¿é—®ã€‚ä¿®æ”¹ä¸º0.0.0.0åˆ™å¯ä»¥åœ¨ä»»æ„IPè®¿é—®ï¼Œç”Ÿäº§ç¯å¢ƒä¸è¦è®¾ç½®ä¸º0.0.0.0</span></span><br><span class="line"><span class="attr">bind</span> <span class="string">0.0.0.0</span></span><br><span class="line"><span class="comment"># å®ˆæŠ¤è¿›ç¨‹ï¼Œä¿®æ”¹ä¸ºyesåå³å¯åå°è¿è¡Œ</span></span><br><span class="line"><span class="attr">daemonize</span> <span class="string">yes </span></span><br><span class="line"><span class="comment"># å¯†ç ï¼Œè®¾ç½®åè®¿é—®Rediså¿…é¡»è¾“å…¥å¯†ç </span></span><br><span class="line"><span class="attr">requirepass</span> <span class="string">123321</span></span><br></pre></td></tr></table></figure><p>Redisçš„å…¶å®ƒå¸¸è§é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›‘å¬çš„ç«¯å£</span></span><br><span class="line"><span class="attr">port</span> <span class="string">6379</span></span><br><span class="line"><span class="comment"># å·¥ä½œç›®å½•ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œredis-serveræ—¶çš„å‘½ä»¤ï¼Œæ—¥å¿—ã€æŒä¹…åŒ–ç­‰æ–‡ä»¶ä¼šä¿å­˜åœ¨è¿™ä¸ªç›®å½•</span></span><br><span class="line"><span class="attr">dir</span> <span class="string">.</span></span><br><span class="line"><span class="comment"># æ•°æ®åº“æ•°é‡ï¼Œè®¾ç½®ä¸º1ï¼Œä»£è¡¨åªä½¿ç”¨1ä¸ªåº“ï¼Œé»˜è®¤æœ‰16ä¸ªåº“ï¼Œç¼–å·0~15</span></span><br><span class="line"><span class="attr">databases</span> <span class="string">1</span></span><br><span class="line"><span class="comment"># è®¾ç½®redisèƒ½å¤Ÿä½¿ç”¨çš„æœ€å¤§å†…å­˜</span></span><br><span class="line"><span class="attr">maxmemory</span> <span class="string">512mb</span></span><br><span class="line"><span class="comment"># æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºç©ºï¼Œä¸è®°å½•æ—¥å¿—ï¼Œå¯ä»¥æŒ‡å®šæ—¥å¿—æ–‡ä»¶å</span></span><br><span class="line"><span class="attr">logfile</span> <span class="string">&quot;redis.log&quot;</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨Redisï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥rediså®‰è£…ç›®å½• </span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/src/redis-6.2.6</span><br><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">redis-server redis.conf</span><br></pre></td></tr></table></figure><p>åœæ­¢æœåŠ¡ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨redis-cliæ¥æ‰§è¡Œ shutdown å‘½ä»¤ï¼Œå³å¯åœæ­¢ Redis æœåŠ¡ï¼Œ</span></span><br><span class="line"><span class="comment"># å› ä¸ºä¹‹å‰é…ç½®äº†å¯†ç ï¼Œå› æ­¤éœ€è¦é€šè¿‡ -u æ¥æŒ‡å®šå¯†ç </span></span><br><span class="line">redis-cli -u 123321 shutdown</span><br></pre></td></tr></table></figure><h3 id="kai-ji-zi-qi" id="å¼€æœºè‡ªå¯">å¼€æœºè‡ªå¯</h3><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ¥å®ç°å¼€æœºè‡ªå¯ã€‚</p><p>é¦–å…ˆï¼Œæ–°å»ºä¸€ä¸ªç³»ç»ŸæœåŠ¡æ–‡ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/systemd/system/redis.service</span><br></pre></td></tr></table></figure><p>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=redis-server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/bin/redis-server /usr/local/src/redis-6.2.6/redis.conf</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>ç„¶åé‡è½½ç³»ç»ŸæœåŠ¡ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢è¿™ç»„å‘½ä»¤æ¥æ“ä½œredisäº†ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">systemctl start redis</span><br><span class="line"><span class="comment"># åœæ­¢</span></span><br><span class="line">systemctl stop redis</span><br><span class="line"><span class="comment"># é‡å¯</span></span><br><span class="line">systemctl restart redis</span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">systemctl status redis</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¯ä»¥è®©rediså¼€æœºè‡ªå¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> redis</span><br></pre></td></tr></table></figure><h2 id="redis-zhuo-mian-ke-hu-duan" id="Redisæ¡Œé¢å®¢æˆ·ç«¯">Redisæ¡Œé¢å®¢æˆ·ç«¯</h2><p>å®‰è£…å®ŒæˆRedisï¼Œæˆ‘ä»¬å°±å¯ä»¥æ“ä½œRedisï¼Œå®ç°æ•°æ®çš„CRUDäº†ã€‚è¿™éœ€è¦ç”¨åˆ°Rediså®¢æˆ·ç«¯ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>å‘½ä»¤è¡Œå®¢æˆ·ç«¯</li><li>å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯</li><li>ç¼–ç¨‹å®¢æˆ·ç«¯</li></ul><h3 id="redis-ming-ling-xing-ke-hu-duan" id="Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯">Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯</h3><p>Rediså®‰è£…å®Œæˆåå°±è‡ªå¸¦äº†å‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼šredis-cliï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli [options] [commonds]</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å¸¸è§çš„optionsæœ‰ï¼š</p><ul><li><code>-h 127.0.0.1</code>ï¼šæŒ‡å®šè¦è¿æ¥çš„redisèŠ‚ç‚¹çš„IPåœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1</li><li><code>-p 6379</code>ï¼šæŒ‡å®šè¦è¿æ¥çš„redisèŠ‚ç‚¹çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯6379</li><li><code>-a 123321</code>ï¼šæŒ‡å®šredisçš„è®¿é—®å¯†ç </li></ul><p>å…¶ä¸­çš„commondså°±æ˜¯Redisçš„æ“ä½œå‘½ä»¤ï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>ping</code>ï¼šä¸redisæœåŠ¡ç«¯åšå¿ƒè·³æµ‹è¯•ï¼ŒæœåŠ¡ç«¯æ­£å¸¸ä¼šè¿”å›<code>pong</code></li></ul><p>ä¸æŒ‡å®šcommondæ—¶ï¼Œä¼šè¿›å…¥<code>redis-cli</code>çš„äº¤äº’æ§åˆ¶å°ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/4aae43d3ea4b4e568a0ef72ff98b0f76" alt=""></p><h3 id="tu-xing-hua-zhuo-mian-ke-hu-duan" id="å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯">å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯</h3><p>GitHubä¸Šçš„å¤§ç¥ç¼–å†™äº†Redisçš„å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯ï¼Œåœ°å€ï¼š<a href="https://github.com/uglide/RedisDesktopManager">https://github.com/uglide/RedisDesktopManager</a></p><p>ä¸è¿‡è¯¥ä»“åº“æä¾›çš„æ˜¯RedisDesktopManagerçš„æºç ï¼Œå¹¶æœªæä¾›windowså®‰è£…åŒ…ã€‚</p><p>åœ¨ä¸‹é¢è¿™ä¸ªä»“åº“å¯ä»¥æ‰¾åˆ°å®‰è£…åŒ…ï¼š<a href="https://github.com/lework/RedisDesktopManager-Windows/releases">https://github.com/lework/RedisDesktopManager-Windows/releases</a></p><h3 id="jian-li-lian-jie" id="å»ºç«‹è¿æ¥">å»ºç«‹è¿æ¥</h3><p>ç‚¹å‡»å·¦ä¸Šè§’çš„<code>è¿æ¥åˆ°RedisæœåŠ¡å™¨</code>æŒ‰é’®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/5184b486e5d84123a0a42a80f6b076ed" alt=""></p><p>åœ¨å¼¹å‡ºçš„çª—å£ä¸­å¡«å†™RedisæœåŠ¡ä¿¡æ¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/0d4af399470141e4a049014712f64a11" alt=""></p><p>ç‚¹å‡»ç¡®å®šåï¼Œåœ¨å·¦ä¾§èœå•ä¼šå‡ºç°è¿™ä¸ªé“¾æ¥ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/4d43e92e74f5453d9241e351f7428905" alt=""></p><p>ç‚¹å‡»å³å¯å»ºç«‹è¿æ¥äº†ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/19/5a6cbd41a6414f21bc1a21ac325d968c" alt=""></p><p>Redisé»˜è®¤æœ‰16ä¸ªä»“åº“ï¼Œç¼–å·ä»0è‡³15.  é€šè¿‡é…ç½®æ–‡ä»¶å¯ä»¥è®¾ç½®ä»“åº“æ•°é‡ï¼Œä½†æ˜¯ä¸è¶…è¿‡16ï¼Œå¹¶ä¸”ä¸èƒ½è‡ªå®šä¹‰ä»“åº“åç§°ã€‚</p><p>å¦‚æœæ˜¯åŸºäºredis-cliè¿æ¥RedisæœåŠ¡ï¼Œå¯ä»¥é€šè¿‡selectå‘½ä»¤æ¥é€‰æ‹©æ•°æ®åº“ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€‰æ‹© 0å·åº“</span></span><br><span class="line">select 0</span><br></pre></td></tr></table></figure><h1 id="redis-chang-jian-ming-ling">Rediså¸¸è§å‘½ä»¤</h1><h2 id="redis-shu-ju-jie-gou-jie-shao" id="Redisæ•°æ®ç»“æ„ä»‹ç»">Redisæ•°æ®ç»“æ„ä»‹ç»</h2><p>Redisæ˜¯ä¸€ä¸ªkey-valueçš„æ•°æ®åº“ï¼Œkeyä¸€èˆ¬æ˜¯Stringç±»å‹ï¼Œä¸è¿‡valueçš„ç±»å‹å¤šç§å¤šæ ·ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/f8d65d9aa4a844a4828cc62a175ad949" alt="1652887393157"></p><p><strong>è´´å¿ƒå°å»ºè®®ï¼šå‘½ä»¤ä¸è¦æ­»è®°ï¼Œå­¦ä¼šæŸ¥è¯¢å°±å¥½å•¦</strong></p><p>Redisä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å­¦ä¹ ï¼Œå°†æ“ä½œä¸åŒæ•°æ®ç±»å‹çš„å‘½ä»¤ä¹Ÿåšäº†åˆ†ç»„ï¼Œåœ¨å®˜ç½‘ï¼ˆ <a href="https://redis.io/commands">https://redis.io/commands</a> ï¼‰å¯ä»¥æŸ¥çœ‹åˆ°ä¸åŒçš„å‘½ä»¤ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/a981ece771db4fbaaea63afe00932514" alt="1652887648826"></p><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡Helpå‘½ä»¤æ¥å¸®åŠ©æˆ‘ä»¬å»æŸ¥çœ‹å‘½ä»¤</p><p><img src="https://s1.vika.cn/space/2023/03/19/256f7de11800490c9e0e273b6c996653" alt="1652887748279"></p><h2 id="redis-tong-yong-ming-ling" id="Redis-é€šç”¨å‘½ä»¤">Redis é€šç”¨å‘½ä»¤</h2><p>é€šç”¨æŒ‡ä»¤æ˜¯éƒ¨åˆ†æ•°æ®ç±»å‹çš„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨çš„æŒ‡ä»¤ï¼Œå¸¸è§çš„æœ‰ï¼š</p><ul><li>KEYSï¼šæŸ¥çœ‹ç¬¦åˆæ¨¡æ¿çš„æ‰€æœ‰key</li><li>DELï¼šåˆ é™¤ä¸€ä¸ªæŒ‡å®šçš„key</li><li>EXISTSï¼šåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨</li><li>EXPIREï¼šç»™ä¸€ä¸ªkeyè®¾ç½®æœ‰æ•ˆæœŸï¼Œæœ‰æ•ˆæœŸåˆ°æœŸæ—¶è¯¥keyä¼šè¢«è‡ªåŠ¨åˆ é™¤</li><li>TTLï¼šæŸ¥çœ‹ä¸€ä¸ªKEYçš„å‰©ä½™æœ‰æ•ˆæœŸ</li></ul><p>é€šè¿‡help [command] å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªå‘½ä»¤çš„å…·ä½“ç”¨æ³•ï¼Œä¾‹å¦‚ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/4a9effb0baa042969d9bb651258d3d68" alt="1652887865189"></p><p>è¯¾å ‚ä»£ç å¦‚ä¸‹</p><ul><li>KEYS</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;age&quot;</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ä»¥aå¼€å¤´çš„key</span></span><br><span class="line">127.0.0.1:6379&gt; keys a*</span><br><span class="line">1) <span class="string">&quot;age&quot;</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><p><strong>è´´å¿ƒå°æç¤ºï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä¸æ¨èä½¿ç”¨keys å‘½ä»¤ï¼Œå› ä¸ºè¿™ä¸ªå‘½ä»¤åœ¨keyè¿‡å¤šçš„æƒ…å†µä¸‹ï¼Œæ•ˆç‡ä¸é«˜</strong></p><ul><li>DEL</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">help</span> del</span><br><span class="line"></span><br><span class="line">  DEL key [key ...]</span><br><span class="line">  summary: Delete a key</span><br><span class="line">  since: 1.0.0</span><br><span class="line">  group: generic</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; del name <span class="comment">#åˆ é™¤å•ä¸ª</span></span><br><span class="line">(<span class="built_in">integer</span>) 1  <span class="comment">#æˆåŠŸåˆ é™¤1ä¸ª</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;age&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; MSET k1 v1 k2 v2 k3 v3 <span class="comment">#æ‰¹é‡æ·»åŠ æ•°æ®</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;k3&quot;</span></span><br><span class="line">2) <span class="string">&quot;k2&quot;</span></span><br><span class="line">3) <span class="string">&quot;k1&quot;</span></span><br><span class="line">4) <span class="string">&quot;age&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; del k1 k2 k3 k4</span><br><span class="line">(<span class="built_in">integer</span>) 3   <span class="comment">#æ­¤å¤„è¿”å›çš„æ˜¯æˆåŠŸåˆ é™¤çš„keyï¼Œç”±äºredisä¸­åªæœ‰k1,k2,k3 æ‰€ä»¥åªæˆåŠŸåˆ é™¤3ä¸ªï¼Œæœ€ç»ˆè¿”å›</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys * <span class="comment">#å†æŸ¥è¯¢å…¨éƒ¨çš„key</span></span><br><span class="line">1) <span class="string">&quot;age&quot;</span><span class="comment">#åªå‰©ä¸‹ä¸€ä¸ªäº†</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><p><strong>è´´å¿ƒå°æç¤ºï¼šåŒå­¦ä»¬åœ¨æ‹·è´ä»£ç çš„æ—¶å€™ï¼Œåªéœ€è¦æ‹·è´å¯¹åº”çš„å‘½ä»¤å“¦~</strong></p><ul><li>EXISTS</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">help</span> EXISTS</span><br><span class="line"></span><br><span class="line">  EXISTS key [key ...]</span><br><span class="line">  summary: Determine <span class="keyword">if</span> a key exists</span><br><span class="line">  since: 1.0.0</span><br><span class="line">  group: generic</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; exists age</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; exists name</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure><ul><li>EXPIRE</li></ul><p><strong>è´´å¿ƒå°æç¤º</strong>ï¼šå†…å­˜éå¸¸å®è´µï¼Œå¯¹äºä¸€äº›æ•°æ®ï¼Œæˆ‘ä»¬åº”å½“ç»™ä»–ä¸€äº›è¿‡æœŸæ—¶é—´ï¼Œå½“è¿‡æœŸæ—¶é—´åˆ°äº†ä¹‹åï¼Œä»–å°±ä¼šè‡ªåŠ¨è¢«åˆ é™¤~</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; expire age 10</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) 8</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) -2</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) -2  <span class="comment">#å½“è¿™ä¸ªkeyè¿‡æœŸäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶æŸ¥è¯¢å‡ºæ¥å°±æ˜¯-2 </span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> age 10 <span class="comment">#å¦‚æœæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) -1  <span class="comment"># ttlçš„è¿”å›å€¼å°±æ˜¯-1</span></span><br></pre></td></tr></table></figure><h2 id="redis-ming-ling-string-ming-ling" id="Rediså‘½ä»¤-Stringå‘½ä»¤">Rediså‘½ä»¤-Stringå‘½ä»¤</h2><p>Stringç±»å‹ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ˜¯Redisä¸­æœ€ç®€å•çš„å­˜å‚¨ç±»å‹ã€‚</p><p>å…¶valueæ˜¯å­—ç¬¦ä¸²ï¼Œä¸è¿‡æ ¹æ®å­—ç¬¦ä¸²çš„æ ¼å¼ä¸åŒï¼Œåˆå¯ä»¥åˆ†ä¸º3ç±»ï¼š</p><ul><li>stringï¼šæ™®é€šå­—ç¬¦ä¸²</li><li>intï¼šæ•´æ•°ç±»å‹ï¼Œå¯ä»¥åšè‡ªå¢.è‡ªå‡æ“ä½œ</li><li>floatï¼šæµ®ç‚¹ç±»å‹ï¼Œå¯ä»¥åšè‡ªå¢.è‡ªå‡æ“ä½œ</li></ul><p><img src="https://s1.vika.cn/space/2023/03/19/7934e6fca0014ca9ae5a1ade138ee74c" alt="1652890121291"></p><p>Stringçš„å¸¸è§å‘½ä»¤æœ‰ï¼š</p><ul><li>SETï¼šæ·»åŠ æˆ–è€…ä¿®æ”¹å·²ç»å­˜åœ¨çš„ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹</li><li>GETï¼šæ ¹æ®keyè·å–Stringç±»å‹çš„value</li><li>MSETï¼šæ‰¹é‡æ·»åŠ å¤šä¸ªStringç±»å‹çš„é”®å€¼å¯¹</li><li>MGETï¼šæ ¹æ®å¤šä¸ªkeyè·å–å¤šä¸ªStringç±»å‹çš„value</li><li>INCRï¼šè®©ä¸€ä¸ªæ•´å‹çš„keyè‡ªå¢1</li><li>INCRBY:è®©ä¸€ä¸ªæ•´å‹çš„keyè‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿ï¼Œä¾‹å¦‚ï¼šincrby num 2 è®©numå€¼è‡ªå¢2</li><li>INCRBYFLOATï¼šè®©ä¸€ä¸ªæµ®ç‚¹ç±»å‹çš„æ•°å­—è‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿</li><li>SETNXï¼šæ·»åŠ ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹ï¼Œå‰ææ˜¯è¿™ä¸ªkeyä¸å­˜åœ¨ï¼Œå¦åˆ™ä¸æ‰§è¡Œ</li><li>SETEXï¼šæ·»åŠ ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹ï¼Œå¹¶ä¸”æŒ‡å®šæœ‰æ•ˆæœŸ</li></ul><p><strong>è´´å¿ƒå°æç¤º</strong>ï¼šä»¥ä¸Šå‘½ä»¤é™¤äº†INCRBYFLOAT éƒ½æ˜¯å¸¸ç”¨å‘½ä»¤</p><ul><li>SET å’ŒGET: å¦‚æœkeyä¸å­˜åœ¨åˆ™æ˜¯æ–°å¢ï¼Œå¦‚æœå­˜åœ¨åˆ™æ˜¯ä¿®æ”¹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; set name Rose  <span class="comment">//åŸæ¥ä¸å­˜åœ¨</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get name </span><br><span class="line"><span class="string">&quot;Rose&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; set name Jack <span class="comment">//åŸæ¥å­˜åœ¨ï¼Œå°±æ˜¯ä¿®æ”¹</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get name</span><br><span class="line"><span class="string">&quot;Jack&quot;</span></span><br></pre></td></tr></table></figure><ul><li>MSETå’ŒMGET</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; MSET k1 v1 k2 v2 k3 v3</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; MGET name age k1 k2 k3</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Jack&quot;</span> <span class="comment">//ä¹‹å‰å­˜åœ¨çš„name</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;10&quot;</span>   <span class="comment">//ä¹‹å‰å­˜åœ¨çš„age</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;v1&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;v2&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;v3&quot;</span></span><br></pre></td></tr></table></figure><ul><li>INCRå’ŒINCRBYå’ŒDECY</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get age </span><br><span class="line"><span class="string">&quot;10&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; incr age <span class="comment">//å¢åŠ 1</span></span><br><span class="line">(integer) <span class="number">11</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get age <span class="comment">//è·å¾—age</span></span><br><span class="line"><span class="string">&quot;11&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; incrby age <span class="number">2</span> <span class="comment">//ä¸€æ¬¡å¢åŠ 2</span></span><br><span class="line">(integer) <span class="number">13</span> <span class="comment">//è¿”å›ç›®å‰çš„ageçš„å€¼</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; incrby age <span class="number">2</span></span><br><span class="line">(integer) <span class="number">15</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; incrby age -<span class="number">1</span> <span class="comment">//ä¹Ÿå¯ä»¥å¢åŠ è´Ÿæ•°ï¼Œç›¸å½“äºå‡</span></span><br><span class="line">(integer) <span class="number">14</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; incrby age -<span class="number">2</span> <span class="comment">//ä¸€æ¬¡å‡å°‘2ä¸ª</span></span><br><span class="line">(integer) <span class="number">12</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; DECR age <span class="comment">//ç›¸å½“äº incr è´Ÿæ•°ï¼Œå‡å°‘æ­£å¸¸ç”¨æ³•</span></span><br><span class="line">(integer) <span class="number">11</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get age </span><br><span class="line"><span class="string">&quot;11&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>SETNX</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; help setnx</span><br><span class="line"></span><br><span class="line">  SETNX key value</span><br><span class="line">  summary: Set the value of a key, only <span class="keyword">if</span> the key does not exist</span><br><span class="line">  since: <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  group: string</span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; set name Jack  <span class="comment">//è®¾ç½®åç§°</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; setnx name lisi <span class="comment">//å¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ æˆåŠŸ</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get name <span class="comment">//ç”±äºnameå·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥lisiçš„æ“ä½œå¤±è´¥</span></span><br><span class="line"><span class="string">&quot;Jack&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; setnx name2 lisi <span class="comment">//name2 ä¸å­˜åœ¨ï¼Œæ‰€ä»¥æ“ä½œæˆåŠŸ</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get name2 </span><br><span class="line"><span class="string">&quot;lisi&quot;</span></span><br></pre></td></tr></table></figure><ul><li>SETEX</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; setex name 10 jack</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(<span class="built_in">integer</span>) 8</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br></pre></td></tr></table></figure><h2 id="redis-ming-ling-key-de-ceng-ji-jie-gou" id="Rediså‘½ä»¤-Keyçš„å±‚çº§ç»“æ„">Rediså‘½ä»¤-Keyçš„å±‚çº§ç»“æ„</h2><p>Redisæ²¡æœ‰ç±»ä¼¼MySQLä¸­çš„Tableçš„æ¦‚å¿µï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•åŒºåˆ†ä¸åŒç±»å‹çš„keyå‘¢ï¼Ÿ</p><p>ä¾‹å¦‚ï¼Œéœ€è¦å­˜å‚¨ç”¨æˆ·.å•†å“ä¿¡æ¯åˆ°redisï¼Œæœ‰ä¸€ä¸ªç”¨æˆ·idæ˜¯1ï¼Œæœ‰ä¸€ä¸ªå•†å“idæ°å¥½ä¹Ÿæ˜¯1ï¼Œæ­¤æ—¶å¦‚æœä½¿ç”¨idä½œä¸ºkeyï¼Œé‚£å°±ä¼šå†²çªäº†ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™keyæ·»åŠ å‰ç¼€åŠ ä»¥åŒºåˆ†ï¼Œä¸è¿‡è¿™ä¸ªå‰ç¼€ä¸æ˜¯éšä¾¿åŠ çš„ï¼Œæœ‰ä¸€å®šçš„è§„èŒƒï¼š</p><p>Redisçš„keyå…è®¸æœ‰å¤šä¸ªå•è¯å½¢æˆå±‚çº§ç»“æ„ï¼Œå¤šä¸ªå•è¯ä¹‹é—´ç”¨â€™:'éš”å¼€ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/cce4fb616ea9467aada10cc1f419992c" alt="1652941631682"></p><p>è¿™ä¸ªæ ¼å¼å¹¶éå›ºå®šï¼Œä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥åˆ é™¤æˆ–æ·»åŠ è¯æ¡ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬çš„é¡¹ç›®åç§°å« heimaï¼Œæœ‰userå’Œproductä¸¤ç§ä¸åŒç±»å‹çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰keyï¼š</p><ul><li><p>userç›¸å…³çš„keyï¼š<strong>heima:user:1</strong></p></li><li><p>productç›¸å…³çš„keyï¼š<strong>heima:product:1</strong></p></li></ul><p>å¦‚æœValueæ˜¯ä¸€ä¸ªJavaå¯¹è±¡ï¼Œä¾‹å¦‚ä¸€ä¸ªUserå¯¹è±¡ï¼Œåˆ™å¯ä»¥å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²åå­˜å‚¨ï¼š</p><table><thead><tr><th><strong>KEY</strong></th><th><strong>VALUE</strong></th></tr></thead><tbody><tr><td>heima:user:1</td><td>{â€œidâ€:1, â€œnameâ€: â€œJackâ€, â€œageâ€: 21}</td></tr><tr><td>heima:product:1</td><td>{â€œidâ€:1, â€œnameâ€: â€œå°ç±³11â€, â€œpriceâ€: 4999}</td></tr></tbody></table><p>ä¸€æ—¦æˆ‘ä»¬å‘redisé‡‡ç”¨è¿™æ ·çš„æ–¹å¼å­˜å‚¨ï¼Œé‚£ä¹ˆåœ¨å¯è§†åŒ–ç•Œé¢ä¸­ï¼Œredisä¼šä»¥å±‚çº§ç»“æ„æ¥è¿›è¡Œå­˜å‚¨ï¼Œå½¢æˆç±»ä¼¼äºè¿™æ ·çš„ç»“æ„ï¼Œæ›´åŠ æ–¹ä¾¿Redisè·å–æ•°æ®</p><p><img src="https://s1.vika.cn/space/2023/03/19/aaed2a28fb3440f3a86ba18179e51b1e" alt="1652941883537"></p><h2 id="redis-ming-ling-hash-ming-ling" id="Rediså‘½ä»¤-Hashå‘½ä»¤">Rediså‘½ä»¤-Hashå‘½ä»¤</h2><p>Hashç±»å‹ï¼Œä¹Ÿå«æ•£åˆ—ï¼Œå…¶valueæ˜¯ä¸€ä¸ªæ— åºå­—å…¸ï¼Œç±»ä¼¼äºJavaä¸­çš„HashMapç»“æ„ã€‚</p><p>Stringç»“æ„æ˜¯å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²åå­˜å‚¨ï¼Œå½“éœ€è¦ä¿®æ”¹å¯¹è±¡æŸä¸ªå­—æ®µæ—¶å¾ˆä¸æ–¹ä¾¿ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/b4c165d659f44d83a25a5b3f266e1541" alt="1652941995945"></p><p>Hashç»“æ„å¯ä»¥å°†å¯¹è±¡ä¸­çš„æ¯ä¸ªå­—æ®µç‹¬ç«‹å­˜å‚¨ï¼Œå¯ä»¥é’ˆå¯¹å•ä¸ªå­—æ®µåšCRUDï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/8bda389dc31b47c7ab7ea22c73389e0b" alt="1652942027719"></p><p><strong>Hashç±»å‹çš„å¸¸è§å‘½ä»¤</strong></p><ul><li><p>HSET key field valueï¼šæ·»åŠ æˆ–è€…ä¿®æ”¹hashç±»å‹keyçš„fieldçš„å€¼</p></li><li><p>HGET key fieldï¼šè·å–ä¸€ä¸ªhashç±»å‹keyçš„fieldçš„å€¼</p></li><li><p>HMSETï¼šæ‰¹é‡æ·»åŠ å¤šä¸ªhashç±»å‹keyçš„fieldçš„å€¼</p></li><li><p>HMGETï¼šæ‰¹é‡è·å–å¤šä¸ªhashç±»å‹keyçš„fieldçš„å€¼</p></li><li><p>HGETALLï¼šè·å–ä¸€ä¸ªhashç±»å‹çš„keyä¸­çš„æ‰€æœ‰çš„fieldå’Œvalue</p></li><li><p>HKEYSï¼šè·å–ä¸€ä¸ªhashç±»å‹çš„keyä¸­çš„æ‰€æœ‰çš„field</p></li><li><p>HINCRBY:è®©ä¸€ä¸ªhashç±»å‹keyçš„å­—æ®µå€¼è‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿</p></li><li><p>HSETNXï¼šæ·»åŠ ä¸€ä¸ªhashç±»å‹çš„keyçš„fieldå€¼ï¼Œå‰ææ˜¯è¿™ä¸ªfieldä¸å­˜åœ¨ï¼Œå¦åˆ™ä¸æ‰§è¡Œ</p></li></ul><p><strong>è´´å¿ƒå°æç¤º</strong>ï¼šå“ˆå¸Œç»“æ„ä¹Ÿæ˜¯æˆ‘ä»¬ä»¥åå®é™…å¼€å‘ä¸­å¸¸ç”¨çš„å‘½ä»¤å“Ÿ</p><ul><li>HSETå’ŒHGET</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HSET heima:user:<span class="number">3</span> name Lucy<span class="comment">//å¤§keyæ˜¯ heima:user:3 å°keyæ˜¯nameï¼Œå°valueæ˜¯Lucy</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HSET heima:user:<span class="number">3</span> age <span class="number">21</span><span class="comment">// å¦‚æœæ“ä½œä¸å­˜åœ¨çš„æ•°æ®ï¼Œåˆ™æ˜¯æ–°å¢</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HSET heima:user:<span class="number">3</span> age <span class="number">17</span> <span class="comment">//å¦‚æœæ“ä½œå­˜åœ¨çš„æ•°æ®ï¼Œåˆ™æ˜¯ä¿®æ”¹</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HGET heima:user:<span class="number">3</span> name </span><br><span class="line"><span class="string">&quot;Lucy&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HGET heima:user:<span class="number">3</span> age</span><br><span class="line"><span class="string">&quot;17&quot;</span></span><br></pre></td></tr></table></figure><ul><li>HMSETå’ŒHMGET</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HMSET heima:user:<span class="number">4</span> name HanMeiMei</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HMSET heima:user:<span class="number">4</span> name LiLei age <span class="number">20</span> sex man</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HMGET heima:user:<span class="number">4</span> name age sex</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;LiLei&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;20&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;man&quot;</span></span><br></pre></td></tr></table></figure><ul><li>HGETALL</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HGETALL heima:user:<span class="number">4</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;LiLei&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;age&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;20&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;sex&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;man&quot;</span></span><br></pre></td></tr></table></figure><ul><li>HKEYSå’ŒHVALS</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HKEYS heima:user:<span class="number">4</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;age&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;sex&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HVALS heima:user:<span class="number">4</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;LiLei&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;20&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;man&quot;</span></span><br></pre></td></tr></table></figure><ul><li>HINCRBY</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HINCRBY  heima:user:<span class="number">4</span> age <span class="number">2</span></span><br><span class="line">(integer) <span class="number">22</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HVALS heima:user:<span class="number">4</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;LiLei&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;22&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;man&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HINCRBY  heima:user:<span class="number">4</span> age -<span class="number">2</span></span><br><span class="line">(integer) <span class="number">20</span></span><br></pre></td></tr></table></figure><ul><li>HSETNX</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HSETNX heima:user4 sex <span class="title function_">woman</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HGETALL heima:user:<span class="number">3</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Lucy&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;age&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;17&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HSETNX heima:user:<span class="number">3</span> sex <span class="title function_">woman</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HGETALL heima:user:<span class="number">3</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Lucy&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;age&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;17&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;sex&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;woman&quot;</span></span><br></pre></td></tr></table></figure><h2 id="redis-ming-ling-list-ming-ling" id="Rediså‘½ä»¤-Listå‘½ä»¤">Rediså‘½ä»¤-Listå‘½ä»¤</h2><p>Redisä¸­çš„Listç±»å‹ä¸Javaä¸­çš„LinkedListç±»ä¼¼ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ç»“æ„ã€‚æ—¢å¯ä»¥æ”¯æŒæ­£å‘æ£€ç´¢å’Œä¹Ÿå¯ä»¥æ”¯æŒåå‘æ£€ç´¢ã€‚</p><p>ç‰¹å¾ä¹Ÿä¸LinkedListç±»ä¼¼ï¼š</p><ul><li>æœ‰åº</li><li>å…ƒç´ å¯ä»¥é‡å¤</li><li>æ’å…¥å’Œåˆ é™¤å¿«</li><li>æŸ¥è¯¢é€Ÿåº¦ä¸€èˆ¬</li></ul><p>å¸¸ç”¨æ¥å­˜å‚¨ä¸€ä¸ªæœ‰åºæ•°æ®ï¼Œä¾‹å¦‚ï¼šæœ‹å‹åœˆç‚¹èµåˆ—è¡¨ï¼Œè¯„è®ºåˆ—è¡¨ç­‰ã€‚</p><p><strong>Listçš„å¸¸è§å‘½ä»¤æœ‰ï¼š</strong></p><ul><li>LPUSH key element â€¦ ï¼šå‘åˆ—è¡¨å·¦ä¾§æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li><li>LPOP keyï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨å·¦ä¾§çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰åˆ™è¿”å›nil</li><li>RPUSH key element â€¦ ï¼šå‘åˆ—è¡¨å³ä¾§æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li><li>RPOP keyï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨å³ä¾§çš„ç¬¬ä¸€ä¸ªå…ƒç´ </li><li>LRANGE key star endï¼šè¿”å›ä¸€æ®µè§’æ ‡èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ </li><li>BLPOPå’ŒBRPOPï¼šä¸LPOPå’ŒRPOPç±»ä¼¼ï¼Œåªä¸è¿‡åœ¨æ²¡æœ‰å…ƒç´ æ—¶ç­‰å¾…æŒ‡å®šæ—¶é—´ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›nil</li></ul><p><img src="https://s1.vika.cn/space/2023/03/19/a875b838ad144ee38845a4509130627a" alt="1652943604992"></p><ul><li>LPUSHå’ŒRPUSH</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; LPUSH users <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; RPUSH users <span class="number">4</span> <span class="number">5</span> <span class="number">6</span></span><br><span class="line">(integer) <span class="number">6</span></span><br></pre></td></tr></table></figure><ul><li>LPOPå’ŒRPOP</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; LPOP users</span><br><span class="line"><span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; RPOP users</span><br><span class="line"><span class="string">&quot;6&quot;</span></span><br></pre></td></tr></table></figure><ul><li>LRANGE</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; LRANGE users <span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;4&quot;</span></span><br></pre></td></tr></table></figure><h2 id="redis-ming-ling-set-ming-ling" id="Rediså‘½ä»¤-Setå‘½ä»¤">Rediså‘½ä»¤-Setå‘½ä»¤</h2><p>Redisçš„Setç»“æ„ä¸Javaä¸­çš„HashSetç±»ä¼¼ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªvalueä¸ºnullçš„HashMapã€‚å› ä¸ºä¹Ÿæ˜¯ä¸€ä¸ªhashè¡¨ï¼Œå› æ­¤å…·å¤‡ä¸HashSetç±»ä¼¼çš„ç‰¹å¾ï¼š</p><ul><li>æ— åº</li><li>å…ƒç´ ä¸å¯é‡å¤</li><li>æŸ¥æ‰¾å¿«</li><li>æ”¯æŒäº¤é›†.å¹¶é›†.å·®é›†ç­‰åŠŸèƒ½</li></ul><p><strong>Setç±»å‹çš„å¸¸è§å‘½ä»¤</strong></p><ul><li>SADD key member â€¦ ï¼šå‘setä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li><li>SREM key member â€¦ : ç§»é™¤setä¸­çš„æŒ‡å®šå…ƒç´ </li><li>SCARD keyï¼š è¿”å›setä¸­å…ƒç´ çš„ä¸ªæ•°</li><li>SISMEMBER key memberï¼šåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºsetä¸­</li><li>SMEMBERSï¼šè·å–setä¸­çš„æ‰€æœ‰å…ƒç´ </li><li>SINTER key1 key2 â€¦ ï¼šæ±‚key1ä¸key2çš„äº¤é›†</li><li>SDIFF key1 key2 â€¦ ï¼šæ±‚key1ä¸key2çš„å·®é›†</li><li>SUNION key1 key2 â€¦ï¼šæ±‚key1å’Œkey2çš„å¹¶é›†</li></ul><p><strong>å…·ä½“å‘½ä»¤</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; sadd s1 a b <span class="title function_">c</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; smembers s1</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; srem s1 <span class="title function_">a</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SISMEMBER s1 <span class="title function_">a</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SISMEMBER s1 <span class="title function_">b</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SCARD <span class="title function_">s1</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><p><strong>æ¡ˆä¾‹</strong></p><ul><li>å°†ä¸‹åˆ—æ•°æ®ç”¨Redisçš„Seté›†åˆæ¥å­˜å‚¨ï¼š</li><li>å¼ ä¸‰çš„å¥½å‹æœ‰ï¼šæå››.ç‹äº”.èµµå…­</li><li>æå››çš„å¥½å‹æœ‰ï¼šç‹äº”.éº»å­.äºŒç‹—</li><li>åˆ©ç”¨Setçš„å‘½ä»¤å®ç°ä¸‹åˆ—åŠŸèƒ½ï¼š</li><li>è®¡ç®—å¼ ä¸‰çš„å¥½å‹æœ‰å‡ äºº</li><li>è®¡ç®—å¼ ä¸‰å’Œæå››æœ‰å“ªäº›å…±åŒå¥½å‹</li><li>æŸ¥è¯¢å“ªäº›äººæ˜¯å¼ ä¸‰çš„å¥½å‹å´ä¸æ˜¯æå››çš„å¥½å‹</li><li>æŸ¥è¯¢å¼ ä¸‰å’Œæå››çš„å¥½å‹æ€»å…±æœ‰å“ªäº›äºº</li><li>åˆ¤æ–­æå››æ˜¯å¦æ˜¯å¼ ä¸‰çš„å¥½å‹</li><li>åˆ¤æ–­å¼ ä¸‰æ˜¯å¦æ˜¯æå››çš„å¥½å‹</li><li>å°†æå››ä»å¼ ä¸‰çš„å¥½å‹åˆ—è¡¨ä¸­ç§»é™¤</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SADD zs lisi wangwu <span class="title function_">zhaoliu</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">3</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SADD ls wangwu mazi <span class="title function_">ergou</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">3</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SCARD <span class="title function_">zs</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">3</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SINTER zs ls</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;wangwu&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SDIFF zs ls</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;zhaoliu&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;lisi&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SUNION zs ls</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;wangwu&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;zhaoliu&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;lisi&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;mazi&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;ergou&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SISMEMBER zs <span class="title function_">lisi</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SISMEMBER ls <span class="title function_">zhangsan</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SREM zs <span class="title function_">lisi</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SMEMBERS zs</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;zhaoliu&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;wangwu&quot;</span></span><br></pre></td></tr></table></figure><h2 id="redis-ming-ling-sorted-set-lei-xing" id="Rediså‘½ä»¤-SortedSetç±»å‹">Rediså‘½ä»¤-SortedSetç±»å‹</h2><p>Redisçš„SortedSetæ˜¯ä¸€ä¸ªå¯æ’åºçš„seté›†åˆï¼Œä¸Javaä¸­çš„TreeSetæœ‰äº›ç±»ä¼¼ï¼Œä½†åº•å±‚æ•°æ®ç»“æ„å´å·®åˆ«å¾ˆå¤§ã€‚SortedSetä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½å¸¦æœ‰ä¸€ä¸ªscoreå±æ€§ï¼Œå¯ä»¥åŸºäºscoreå±æ€§å¯¹å…ƒç´ æ’åºï¼Œåº•å±‚çš„å®ç°æ˜¯ä¸€ä¸ªè·³è¡¨ï¼ˆSkipListï¼‰åŠ  hashè¡¨ã€‚</p><p>SortedSetå…·å¤‡ä¸‹åˆ—ç‰¹æ€§ï¼š</p><ul><li>å¯æ’åº</li><li>å…ƒç´ ä¸é‡å¤</li><li>æŸ¥è¯¢é€Ÿåº¦å¿«</li></ul><p>å› ä¸ºSortedSetçš„å¯æ’åºç‰¹æ€§ï¼Œç»å¸¸è¢«ç”¨æ¥å®ç°æ’è¡Œæ¦œè¿™æ ·çš„åŠŸèƒ½ã€‚</p><p>SortedSetçš„å¸¸è§å‘½ä»¤æœ‰ï¼š</p><ul><li>ZADD key score memberï¼šæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ åˆ°sorted set ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™æ›´æ–°å…¶scoreå€¼</li><li>ZREM key memberï¼šåˆ é™¤sorted setä¸­çš„ä¸€ä¸ªæŒ‡å®šå…ƒç´ </li><li>ZSCORE key member : è·å–sorted setä¸­çš„æŒ‡å®šå…ƒç´ çš„scoreå€¼</li><li>ZRANK key memberï¼šè·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’å</li><li>ZCARD keyï¼šè·å–sorted setä¸­çš„å…ƒç´ ä¸ªæ•°</li><li>ZCOUNT key min maxï¼šç»Ÿè®¡scoreå€¼åœ¨ç»™å®šèŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ çš„ä¸ªæ•°</li><li>ZINCRBY key increment memberï¼šè®©sorted setä¸­çš„æŒ‡å®šå…ƒç´ è‡ªå¢ï¼Œæ­¥é•¿ä¸ºæŒ‡å®šçš„incrementå€¼</li><li>ZRANGE key min maxï¼šæŒ‰ç…§scoreæ’åºåï¼Œè·å–æŒ‡å®šæ’åèŒƒå›´å†…çš„å…ƒç´ </li><li>ZRANGEBYSCORE key min maxï¼šæŒ‰ç…§scoreæ’åºåï¼Œè·å–æŒ‡å®šscoreèŒƒå›´å†…çš„å…ƒç´ </li><li>ZDIFF.ZINTER.ZUNIONï¼šæ±‚å·®é›†.äº¤é›†.å¹¶é›†</li></ul><p>æ³¨æ„ï¼šæ‰€æœ‰çš„æ’åé»˜è®¤éƒ½æ˜¯å‡åºï¼Œå¦‚æœè¦é™åºåˆ™åœ¨å‘½ä»¤çš„Zåé¢æ·»åŠ REVå³å¯ï¼Œä¾‹å¦‚ï¼š</p><ul><li><strong>å‡åº</strong>è·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’åï¼šZRANK key member</li><li><strong>é™åº</strong>è·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’åï¼šZREVRANK key memeber</li></ul><h1 id="redis-de-java-ke-hu-duan-jedis">Redisçš„Javaå®¢æˆ·ç«¯-Jedis</h1><p>åœ¨Rediså®˜ç½‘ä¸­æä¾›äº†å„ç§è¯­è¨€çš„å®¢æˆ·ç«¯ï¼Œåœ°å€ï¼š<a href="https://redis.io/docs/clients/">https://redis.io/docs/clients/</a></p><p>å…¶ä¸­Javaå®¢æˆ·ç«¯ä¹ŸåŒ…å«å¾ˆå¤šï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/44f5d5d2f1a44b41abb4ab42832489d5" alt="image-20220609102817435"></p><p>æ ‡è®°ä¸ºâ¤çš„å°±æ˜¯æ¨èä½¿ç”¨çš„javaå®¢æˆ·ç«¯ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>Jediså’ŒLettuceï¼šè¿™ä¸¤ä¸ªä¸»è¦æ˜¯æä¾›äº†Rediså‘½ä»¤å¯¹åº”çš„APIï¼Œæ–¹ä¾¿æˆ‘ä»¬æ“ä½œRedisï¼Œè€ŒSpringDataRedisåˆå¯¹è¿™ä¸¤ç§åšäº†æŠ½è±¡å’Œå°è£…ï¼Œå› æ­¤æˆ‘ä»¬åæœŸä¼šç›´æ¥ä»¥SpringDataRedisæ¥å­¦ä¹ ã€‚</li><li>Redissonï¼šæ˜¯åœ¨RedisåŸºç¡€ä¸Šå®ç°äº†åˆ†å¸ƒå¼çš„å¯ä¼¸ç¼©çš„javaæ•°æ®ç»“æ„ï¼Œä¾‹å¦‚Map.Queueç­‰ï¼Œè€Œä¸”æ”¯æŒè·¨è¿›ç¨‹çš„åŒæ­¥æœºåˆ¶ï¼šLock.Semaphoreç­‰å¾…ï¼Œæ¯”è¾ƒé€‚åˆç”¨æ¥å®ç°ç‰¹æ®Šçš„åŠŸèƒ½éœ€æ±‚ã€‚</li></ul><h2 id="jedis-kuai-su-ru-men" id="Jediså¿«é€Ÿå…¥é—¨">Jediså¿«é€Ÿå…¥é—¨</h2><h3 id="ru-men-an-li-xiang-xi-bu-zou" id="å…¥é—¨æ¡ˆä¾‹è¯¦ç»†æ­¥éª¤">å…¥é—¨æ¡ˆä¾‹è¯¦ç»†æ­¥éª¤</h3><p>æ¡ˆä¾‹åˆ†æï¼š</p><p>0ï¼‰åˆ›å»ºå·¥ç¨‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/e4a075ef86ec4e63b64ac8cc7f3d0c77" alt="1652959239813"></p><p>1ï¼‰å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--jedis--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--å•å…ƒæµ‹è¯•--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2ï¼‰å»ºç«‹è¿æ¥</p><p>æ–°å»ºä¸€ä¸ªå•å…ƒæµ‹è¯•ç±»ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Jedis jedis;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BeforeEach</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.å»ºç«‹è¿æ¥</span></span><br><span class="line">    <span class="comment">// jedis = new Jedis(&quot;192.168.150.101&quot;, 6379);</span></span><br><span class="line">    jedis = JedisConnectionFactory.getJedis();</span><br><span class="line">    <span class="comment">// 2.è®¾ç½®å¯†ç </span></span><br><span class="line">    jedis.auth(<span class="string">&quot;123321&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.é€‰æ‹©åº“</span></span><br><span class="line">    jedis.select(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å­˜å…¥æ•°æ®</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> jedis.set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;è™å“¥&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;result = &quot;</span> + result);</span><br><span class="line">    <span class="comment">// è·å–æ•°æ®</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> jedis.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;name = &quot;</span> + name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ’å…¥hashæ•°æ®</span></span><br><span class="line">    jedis.hset(<span class="string">&quot;user:1&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">    jedis.hset(<span class="string">&quot;user:1&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;21&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–</span></span><br><span class="line">    Map&lt;String, String&gt; map = jedis.hgetAll(<span class="string">&quot;user:1&quot;</span>);</span><br><span class="line">    System.out.println(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ï¼‰é‡Šæ”¾èµ„æº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterEach</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (jedis != <span class="literal">null</span>) &#123;</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="jedis-lian-jie-chi" id="Jedisè¿æ¥æ± ">Jedisè¿æ¥æ± </h2><p>Jedisæœ¬èº«æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¹¶ä¸”é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯è¿æ¥ä¼šæœ‰æ€§èƒ½æŸè€—ï¼Œå› æ­¤æˆ‘ä»¬æ¨èå¤§å®¶ä½¿ç”¨Jedisè¿æ¥æ± ä»£æ›¿Jedisçš„ç›´è¿æ–¹å¼</p><p>æœ‰å…³æ± åŒ–æ€æƒ³ï¼Œå¹¶ä¸ä»…ä»…æ˜¯è¿™é‡Œä¼šä½¿ç”¨ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½æœ‰ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬çš„æ•°æ®åº“è¿æ¥æ± ï¼Œæ¯”å¦‚æˆ‘ä»¬tomcatä¸­çš„çº¿ç¨‹æ± ï¼Œè¿™äº›éƒ½æ˜¯æ± åŒ–æ€æƒ³çš„ä½“ç°ã€‚</p><h3 id="chuang-jian-jedis-de-lian-jie-chi" id="åˆ›å»ºJedisçš„è¿æ¥æ± ">åˆ›å»ºJedisçš„è¿æ¥æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisConnectionFacotry</span> &#123;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">static</span> &#123;</span><br><span class="line">         <span class="comment">//é…ç½®è¿æ¥æ± </span></span><br><span class="line">         <span class="type">JedisPoolConfig</span> <span class="variable">poolConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPoolConfig</span>();</span><br><span class="line">         poolConfig.setMaxTotal(<span class="number">8</span>);</span><br><span class="line">         poolConfig.setMaxIdle(<span class="number">8</span>);</span><br><span class="line">         poolConfig.setMinIdle(<span class="number">0</span>);</span><br><span class="line">         poolConfig.setMaxWaitMillis(<span class="number">1000</span>);</span><br><span class="line">         <span class="comment">//åˆ›å»ºè¿æ¥æ± å¯¹è±¡</span></span><br><span class="line">         jedisPool = <span class="keyword">new</span> <span class="title class_">JedisPool</span>(poolConfig,</span><br><span class="line">                 <span class="string">&quot;192.168.150.101&quot;</span>,<span class="number">6379</span>,<span class="number">1000</span>,<span class="string">&quot;123321&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> Jedis <span class="title function_">getJedis</span><span class="params">()</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> jedisPool.getResource();</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä»£ç è¯´æ˜ï¼š</strong></p><ul><li><p>1ï¼‰ JedisConnectionFacotryï¼šå·¥å‚è®¾è®¡æ¨¡å¼æ˜¯å®é™…å¼€å‘ä¸­éå¸¸å¸¸ç”¨çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·¥å‚ï¼Œå»é™ä½ä»£çš„è€¦åˆï¼Œæ¯”å¦‚Springä¸­çš„Beançš„åˆ›å»ºï¼Œå°±ç”¨åˆ°äº†å·¥å‚è®¾è®¡æ¨¡å¼</p></li><li><p>2ï¼‰é™æ€ä»£ç å—ï¼šéšç€ç±»çš„åŠ è½½è€ŒåŠ è½½ï¼Œç¡®ä¿åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œæˆ‘ä»¬åœ¨åŠ è½½å½“å‰å·¥å‚ç±»çš„æ—¶å€™ï¼Œå°±å¯ä»¥æ‰§è¡Œstaticçš„æ“ä½œå®Œæˆå¯¹ è¿æ¥æ± çš„åˆå§‹åŒ–</p></li><li><p>3ï¼‰æœ€åæä¾›è¿”å›è¿æ¥æ± ä¸­è¿æ¥çš„æ–¹æ³•.</p></li></ul><h3 id="gai-zao-yuan-shi-dai-ma" id="æ”¹é€ åŸå§‹ä»£ç ">æ”¹é€ åŸå§‹ä»£ç </h3><p><strong>ä»£ç è¯´æ˜:</strong></p><p>1.åœ¨æˆ‘ä»¬å®Œæˆäº†ä½¿ç”¨å·¥å‚è®¾è®¡æ¨¡å¼æ¥å®Œæˆä»£ç çš„ç¼–å†™ä¹‹åï¼Œæˆ‘ä»¬åœ¨è·å¾—è¿æ¥æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡å·¥å‚æ¥è·å¾—ã€‚</p><p>ï¼Œè€Œä¸ç”¨ç›´æ¥å»newå¯¹è±¡ï¼Œé™ä½è€¦åˆï¼Œå¹¶ä¸”ä½¿ç”¨çš„è¿˜æ˜¯è¿æ¥æ± å¯¹è±¡ã€‚</p><p>2.å½“æˆ‘ä»¬ä½¿ç”¨äº†è¿æ¥æ± åï¼Œå½“æˆ‘ä»¬å…³é—­è¿æ¥å…¶å®å¹¶ä¸æ˜¯å…³é—­ï¼Œè€Œæ˜¯å°†Jedisè¿˜å›è¿æ¥æ± çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@BeforeEach</span></span><br><span class="line"> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="comment">//å»ºç«‹è¿æ¥</span></span><br><span class="line">     <span class="comment">/*jedis = new Jedis(&quot;127.0.0.1&quot;,6379);*/</span></span><br><span class="line">     jedis = JedisConnectionFacotry.getJedis();</span><br><span class="line">      <span class="comment">//é€‰æ‹©åº“</span></span><br><span class="line">     jedis.select(<span class="number">0</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AfterEach</span></span><br><span class="line"> <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="keyword">if</span> (jedis != <span class="literal">null</span>) &#123;</span><br><span class="line">         jedis.close();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h1 id="redis-de-java-ke-hu-duan-spring-data-redis">Redisçš„Javaå®¢æˆ·ç«¯-SpringDataRedis</h1><p>SpringDataæ˜¯Springä¸­æ•°æ®æ“ä½œçš„æ¨¡å—ï¼ŒåŒ…å«å¯¹å„ç§æ•°æ®åº“çš„é›†æˆï¼Œå…¶ä¸­å¯¹Redisçš„é›†æˆæ¨¡å—å°±å«åšSpringDataRedisï¼Œå®˜ç½‘åœ°å€ï¼š<a href="https://spring.io/projects/spring-data-redis">https://spring.io/projects/spring-data-redis</a></p><ul><li>æä¾›äº†å¯¹ä¸åŒRediså®¢æˆ·ç«¯çš„æ•´åˆï¼ˆLettuceå’ŒJedisï¼‰</li><li>æä¾›äº†RedisTemplateç»Ÿä¸€APIæ¥æ“ä½œRedis</li><li>æ”¯æŒRedisçš„å‘å¸ƒè®¢é˜…æ¨¡å‹</li><li>æ”¯æŒRediså“¨å…µå’ŒRedisé›†ç¾¤</li><li>æ”¯æŒåŸºäºLettuceçš„å“åº”å¼ç¼–ç¨‹</li><li>æ”¯æŒåŸºäºJDK.JSON.å­—ç¬¦ä¸².Springå¯¹è±¡çš„æ•°æ®åºåˆ—åŒ–åŠååºåˆ—åŒ–</li><li>æ”¯æŒåŸºäºRedisçš„JDKCollectionå®ç°</li></ul><p>SpringDataRedisä¸­æä¾›äº†RedisTemplateå·¥å…·ç±»ï¼Œå…¶ä¸­å°è£…äº†å„ç§å¯¹Redisçš„æ“ä½œã€‚å¹¶ä¸”å°†ä¸åŒæ•°æ®ç±»å‹çš„æ“ä½œAPIå°è£…åˆ°äº†ä¸åŒçš„ç±»å‹ä¸­ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/5e83207c7dd143fba5a15219d7cc1e0c" alt="1652976773295"></p><h2 id="kuai-su-ru-men" id="å¿«é€Ÿå…¥é—¨">å¿«é€Ÿå…¥é—¨</h2><p>SpringBootå·²ç»æä¾›äº†å¯¹SpringDataRedisçš„æ”¯æŒï¼Œä½¿ç”¨éå¸¸ç®€å•ï¼š</p><h3 id="dao-ru-pom-zuo-biao" id="å¯¼å…¥pomåæ ‡">å¯¼å…¥pomåæ ‡</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.heima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redis-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>redis-demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--redisä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--common-pool--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Jacksonä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="pei-zhi-wen-jian" id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123321</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span>  <span class="comment">#æœ€å¤§è¿æ¥</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">8</span>   <span class="comment">#æœ€å¤§ç©ºé—²è¿æ¥</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span>   <span class="comment">#æœ€å°ç©ºé—²è¿æ¥</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">100ms</span> <span class="comment">#è¿æ¥ç­‰å¾…æ—¶é—´</span></span><br></pre></td></tr></table></figure><h3 id="ce-shi-dai-ma" id="æµ‹è¯•ä»£ç ">æµ‹è¯•ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedisDemoApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å†™å…¥ä¸€æ¡Stringæ•°æ®</span></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;è™å“¥&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–stringæ•°æ®</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">name</span> <span class="operator">=</span> redisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;name = &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è´´å¿ƒå°æç¤ºï¼šSpringDataJpaä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼Œè®°ä½å¦‚ä¸‹å‡ ä¸ªæ­¥éª¤å³å¯</strong></p><p>SpringDataRedisçš„ä½¿ç”¨æ­¥éª¤ï¼š</p><ul><li>å¼•å…¥spring-boot-starter-data-redisä¾èµ–</li><li>åœ¨application.ymlé…ç½®Redisä¿¡æ¯</li><li>æ³¨å…¥RedisTemplate</li></ul><h2 id="shu-ju-xu-lie-hua-qi" id="æ•°æ®åºåˆ—åŒ–å™¨">æ•°æ®åºåˆ—åŒ–å™¨</h2><p>æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰RedisTemplateçš„åºåˆ—åŒ–æ–¹å¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory connectionFactory)</span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºRedisTemplateå¯¹è±¡</span></span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// è®¾ç½®è¿æ¥å·¥å‚</span></span><br><span class="line">        template.setConnectionFactory(connectionFactory);</span><br><span class="line">        <span class="comment">// åˆ›å»ºJSONåºåˆ—åŒ–å·¥å…·</span></span><br><span class="line">        <span class="type">GenericJackson2JsonRedisSerializer</span> <span class="variable">jsonRedisSerializer</span> <span class="operator">=</span> </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>();</span><br><span class="line">        <span class="comment">// è®¾ç½®Keyçš„åºåˆ—åŒ–</span></span><br><span class="line">        template.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        template.setHashKeySerializer(RedisSerializer.string());</span><br><span class="line">        <span class="comment">// è®¾ç½®Valueçš„åºåˆ—åŒ–</span></span><br><span class="line">        template.setValueSerializer(jsonRedisSerializer);</span><br><span class="line">        template.setHashValueSerializer(jsonRedisSerializer);</span><br><span class="line">        <span class="comment">// è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé‡‡ç”¨äº†JSONåºåˆ—åŒ–æ¥ä»£æ›¿é»˜è®¤çš„JDKåºåˆ—åŒ–æ–¹å¼ã€‚</p><p>æ•´ä½“å¯è¯»æ€§æœ‰äº†å¾ˆå¤§æå‡ï¼Œå¹¶ä¸”èƒ½å°†Javaå¯¹è±¡è‡ªåŠ¨çš„åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æŸ¥è¯¢æ—¶èƒ½è‡ªåŠ¨æŠŠJSONååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚ä¸è¿‡ï¼Œå…¶ä¸­è®°å½•äº†åºåˆ—åŒ–æ—¶å¯¹åº”çš„classåç§°ï¼Œç›®çš„æ˜¯ä¸ºäº†æŸ¥è¯¢æ—¶å®ç°è‡ªåŠ¨ååºåˆ—åŒ–ã€‚è¿™ä¼šå¸¦æ¥é¢å¤–çš„å†…å­˜å¼€é”€ã€‚</p><h2 id="string-redis-template" id="StringRedisTemplate">StringRedisTemplate</h2><p>å°½ç®¡JSONçš„åºåˆ—åŒ–æ–¹å¼å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä½†ä¾ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/4231856659b044b788f9b1d6257ed24b" alt="1653054602930"></p><p>ä¸ºäº†åœ¨ååºåˆ—åŒ–æ—¶çŸ¥é“å¯¹è±¡çš„ç±»å‹ï¼ŒJSONåºåˆ—åŒ–å™¨ä¼šå°†ç±»çš„classç±»å‹å†™å…¥jsonç»“æœä¸­ï¼Œå­˜å…¥Redisï¼Œä¼šå¸¦æ¥é¢å¤–çš„å†…å­˜å¼€é”€ã€‚</p><p>ä¸ºäº†å‡å°‘å†…å­˜çš„æ¶ˆè€—ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ‰‹åŠ¨åºåˆ—åŒ–çš„æ–¹å¼ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯ä¸å€ŸåŠ©é»˜è®¤çš„åºåˆ—åŒ–å™¨ï¼Œè€Œæ˜¯æˆ‘ä»¬è‡ªå·±æ¥æ§åˆ¶åºåˆ—åŒ–çš„åŠ¨ä½œï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬åªé‡‡ç”¨Stringçš„åºåˆ—åŒ–å™¨ï¼Œè¿™æ ·ï¼Œåœ¨å­˜å‚¨valueæ—¶ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦åœ¨å†…å­˜ä¸­å°±ä¸ç”¨å¤šå­˜å‚¨æ•°æ®ï¼Œä»è€ŒèŠ‚çº¦æˆ‘ä»¬çš„å†…å­˜ç©ºé—´</p><p><img src="https://s1.vika.cn/space/2023/03/19/ecd0c482ee674666a0547df953eded96" alt="1653054744832"></p><p>è¿™ç§ç”¨æ³•æ¯”è¾ƒæ™®éï¼Œå› æ­¤SpringDataRediså°±æä¾›äº†RedisTemplateçš„å­ç±»ï¼šStringRedisTemplateï¼Œå®ƒçš„keyå’Œvalueçš„åºåˆ—åŒ–æ–¹å¼é»˜è®¤å°±æ˜¯Stringæ–¹å¼ã€‚</p><p>çœå»äº†æˆ‘ä»¬è‡ªå®šä¹‰RedisTemplateçš„åºåˆ—åŒ–æ–¹å¼çš„æ­¥éª¤ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedisStringTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å†™å…¥ä¸€æ¡Stringæ•°æ®</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(<span class="string">&quot;verify:phone:13600527634&quot;</span>, <span class="string">&quot;124143&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–stringæ•°æ®</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">name</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;name = &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSaveUser</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;è™å“¥&quot;</span>, <span class="number">21</span>);</span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨åºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(user);</span><br><span class="line">        <span class="comment">// å†™å…¥æ•°æ®</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(<span class="string">&quot;user:200&quot;</span>, json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ•°æ®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonUser</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(<span class="string">&quot;user:200&quot;</span>);</span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> mapper.readValue(jsonUser, User.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;user1 = &quot;</span> + user1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬å†æ¥çœ‹ä¸€çœ‹å­˜å‚¨çš„æ•°æ®ï¼Œå°ä¼™ä¼´ä»¬å°±ä¼šå‘ç°é‚£ä¸ªclassæ•°æ®å·²ç»ä¸åœ¨äº†ï¼ŒèŠ‚çº¦äº†æˆ‘ä»¬çš„ç©ºé—´~</p><p><img src="https://s1.vika.cn/space/2023/03/19/665ca7a618384e83b661d1e7a7257fef" alt="1653054945211"></p><p>æœ€åå°æ€»ç»“ï¼š</p><p>RedisTemplateçš„ä¸¤ç§åºåˆ—åŒ–å®è·µæ–¹æ¡ˆï¼š</p><ul><li><p>æ–¹æ¡ˆä¸€ï¼š</p><ul><li>è‡ªå®šä¹‰RedisTemplate</li><li>ä¿®æ”¹RedisTemplateçš„åºåˆ—åŒ–å™¨ä¸ºGenericJackson2JsonRedisSerializer</li></ul></li><li><p>æ–¹æ¡ˆäºŒï¼š</p><ul><li>ä½¿ç”¨StringRedisTemplate</li><li>å†™å…¥Redisæ—¶ï¼Œæ‰‹åŠ¨æŠŠå¯¹è±¡åºåˆ—åŒ–ä¸ºJSON</li><li>è¯»å–Redisæ—¶ï¼Œæ‰‹åŠ¨æŠŠè¯»å–åˆ°çš„JSONååºåˆ—åŒ–ä¸ºå¯¹è±¡</li></ul></li></ul><h2 id="hash-jie-gou-cao-zuo" id="Hashç»“æ„æ“ä½œ">Hashç»“æ„æ“ä½œ</h2><p>åœ¨åŸºç¡€ç¯‡çš„æœ€åï¼Œå’±ä»¬å¯¹Hashç»“æ„æ“ä½œä¸€ä¸‹ï¼Œæ”¶ä¸€ä¸ªå°å°¾å·´ï¼Œè¿™ä¸ªä»£ç å’±ä»¬å°±ä¸å†è§£é‡Šå•¦</p><p>é©¬ä¸Šå°±å¼€å§‹æ–°çš„ç¯‡ç« ~~~è¿›å…¥åˆ°æˆ‘ä»¬çš„Rediså®æˆ˜ç¯‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedisStringTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span> &#123;</span><br><span class="line">        stringRedisTemplate.opsForHash().put(<span class="string">&quot;user:400&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;è™å“¥&quot;</span>);</span><br><span class="line">        stringRedisTemplate.opsForHash().put(<span class="string">&quot;user:400&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;21&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;Object, Object&gt; entries = stringRedisTemplate.opsForHash().entries(<span class="string">&quot;user:400&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;entries = &quot;</span> + entries);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">redis å®‰è£…ã€å¸¸ç”¨å‘½ä»¤ã€Jediså…¥é—¨</summary>
    
    
    
    <category term="Java" scheme="https://www.taoyaopc.live/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼äº‹åŠ¡</title>
    <link href="https://www.taoyaopc.live/posts/cdcc4eae.html"/>
    <id>https://www.taoyaopc.live/posts/cdcc4eae.html</id>
    <published>2023-03-18T08:00:00.000Z</published>
    <updated>2023-03-21T06:15:23.666Z</updated>
    
    <content type="html"><![CDATA[<h1 id="fen-bu-shi-shi-wu">åˆ†å¸ƒå¼äº‹åŠ¡</h1><h1 id="fen-bu-shi-shi-wu-wen-ti">åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</h1><h2 id="ben-di-shi-wu" id="æœ¬åœ°äº‹åŠ¡">æœ¬åœ°äº‹åŠ¡</h2><p>æœ¬åœ°äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯ä¼ ç»Ÿçš„<strong>å•æœºäº‹åŠ¡</strong>ã€‚åœ¨ä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡ä¸­ï¼Œå¿…é¡»è¦æ»¡è¶³å››ä¸ªåŸåˆ™ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/74ca8d6ffb564fdc80ac189f37b898f2" alt="image-20210724165045186"></p><h2 id="fen-bu-shi-shi-wu-1" id="åˆ†å¸ƒå¼äº‹åŠ¡">åˆ†å¸ƒå¼äº‹åŠ¡</h2><p><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼Œå°±æ˜¯æŒ‡ä¸æ˜¯åœ¨å•ä¸ªæœåŠ¡æˆ–å•ä¸ªæ•°æ®åº“æ¶æ„ä¸‹ï¼Œäº§ç”Ÿçš„äº‹åŠ¡ï¼Œä¾‹å¦‚ï¼š</p><ul><li>è·¨æ•°æ®æºçš„åˆ†å¸ƒå¼äº‹åŠ¡</li><li>è·¨æœåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡</li><li>ç»¼åˆæƒ…å†µ</li></ul><p>åœ¨æ•°æ®åº“æ°´å¹³æ‹†åˆ†ã€æœåŠ¡å‚ç›´æ‹†åˆ†ä¹‹åï¼Œä¸€ä¸ªä¸šåŠ¡æ“ä½œé€šå¸¸è¦è·¨å¤šä¸ªæ•°æ®åº“ã€æœåŠ¡æ‰èƒ½å®Œæˆã€‚ä¾‹å¦‚ç”µå•†è¡Œä¸šä¸­æ¯”è¾ƒå¸¸è§çš„ä¸‹å•ä»˜æ¬¾æ¡ˆä¾‹ï¼ŒåŒ…æ‹¬ä¸‹é¢å‡ ä¸ªè¡Œä¸ºï¼š</p><ul><li>åˆ›å»ºæ–°è®¢å•</li><li>æ‰£å‡å•†å“åº“å­˜</li><li>ä»ç”¨æˆ·è´¦æˆ·ä½™é¢æ‰£é™¤é‡‘é¢</li></ul><p>å®Œæˆä¸Šé¢çš„æ“ä½œéœ€è¦è®¿é—®ä¸‰ä¸ªä¸åŒçš„å¾®æœåŠ¡å’Œä¸‰ä¸ªä¸åŒçš„æ•°æ®åº“ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/18/0b42de0c55cf4cd9b7efe5bda0397408" alt="image-20210724165338958"></p><p>è®¢å•çš„åˆ›å»ºã€åº“å­˜çš„æ‰£å‡ã€è´¦æˆ·æ‰£æ¬¾åœ¨æ¯ä¸€ä¸ªæœåŠ¡å’Œæ•°æ®åº“å†…æ˜¯ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œå¯ä»¥ä¿è¯ACIDåŸåˆ™ã€‚</p><p>ä½†æ˜¯å½“æˆ‘ä»¬æŠŠä¸‰ä»¶äº‹æƒ…çœ‹åšä¸€ä¸ª&quot;ä¸šåŠ¡&quot;ï¼Œè¦æ»¡è¶³ä¿è¯â€œä¸šåŠ¡â€çš„åŸå­æ€§ï¼Œè¦ä¹ˆæ‰€æœ‰æ“ä½œå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸å…è®¸å‡ºç°éƒ¨åˆ†æˆåŠŸéƒ¨åˆ†å¤±è´¥çš„ç°è±¡ï¼Œè¿™å°±æ˜¯<strong>åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹çš„äº‹åŠ¡</strong>äº†ã€‚</p><p>æ­¤æ—¶ACIDéš¾ä»¥æ»¡è¶³ï¼Œè¿™æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡è¦è§£å†³çš„é—®é¢˜</p><h2 id="yan-shi-fen-bu-shi-shi-wu-wen-ti" id="æ¼”ç¤ºåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜">æ¼”ç¤ºåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</h2><p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹æ¥æ¼”ç¤ºåˆ†å¸ƒå¼äº‹åŠ¡çš„é—®é¢˜ï¼š</p><p>1ï¼‰<strong>åˆ›å»ºæ•°æ®åº“ï¼Œåä¸ºseata_demoï¼Œç„¶åå¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„SQLæ–‡ä»¶ï¼š</strong></p><p><img src="https://s1.vika.cn/space/2023/03/18/871a2bb164384dfb92f4d2f0e08afb93" alt="image-20210724165634571"></p><p>2ï¼‰<strong>å¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„å¾®æœåŠ¡ï¼š</strong></p><p><img src="https://s1.vika.cn/space/2023/03/18/c6f91e2c6c0d4fbe990db06e6bfea62d" alt="image-20210724165709994"></p><p>å¾®æœåŠ¡ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/335b6c6227a04fdcabb926d86f56d91c" alt="image-20210724165729273"></p><p>å…¶ä¸­ï¼š</p><p>seata-demoï¼šçˆ¶å·¥ç¨‹ï¼Œè´Ÿè´£ç®¡ç†é¡¹ç›®ä¾èµ–</p><ul><li>account-serviceï¼šè´¦æˆ·æœåŠ¡ï¼Œè´Ÿè´£ç®¡ç†ç”¨æˆ·çš„èµ„é‡‘è´¦æˆ·ã€‚æä¾›æ‰£å‡ä½™é¢çš„æ¥å£</li><li>storage-serviceï¼šåº“å­˜æœåŠ¡ï¼Œè´Ÿè´£ç®¡ç†å•†å“åº“å­˜ã€‚æä¾›æ‰£å‡åº“å­˜çš„æ¥å£</li><li>order-serviceï¼šè®¢å•æœåŠ¡ï¼Œè´Ÿè´£ç®¡ç†è®¢å•ã€‚åˆ›å»ºè®¢å•æ—¶ï¼Œéœ€è¦è°ƒç”¨account-serviceå’Œstorage-service</li></ul><p><strong>3ï¼‰å¯åŠ¨nacosã€æ‰€æœ‰å¾®æœåŠ¡</strong></p><p><strong>4ï¼‰æµ‹è¯•ä¸‹å•åŠŸèƒ½ï¼Œå‘å‡ºPostè¯·æ±‚ï¼š</strong></p><p>è¯·æ±‚å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --location --request POST <span class="string">&#x27;http://localhost:8082/order?userId=user202103032042012&amp;commodityCode=100202003032041&amp;count=20&amp;money=200&#x27;</span></span><br></pre></td></tr></table></figure><p>å¦‚å›¾ï¼š</p><p><img src="assets/image-20210724170113404.png" alt="image-20210724170113404"></p><p>æµ‹è¯•å‘ç°ï¼Œå½“åº“å­˜ä¸è¶³æ—¶ï¼Œå¦‚æœä½™é¢å·²ç»æ‰£å‡ï¼Œå¹¶ä¸ä¼šå›æ»šï¼Œå‡ºç°äº†åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚</p><h1 id="li-lun-ji-chu">ç†è®ºåŸºç¡€</h1><p>è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Œéœ€è¦ä¸€äº›åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºç¡€çŸ¥è¯†ä½œä¸ºç†è®ºæŒ‡å¯¼ã€‚</p><h2 id="cap-ding-li" id="CAPå®šç†">CAPå®šç†</h2><p>1998å¹´ï¼ŒåŠ å·å¤§å­¦çš„è®¡ç®—æœºç§‘å­¦å®¶ Eric Brewer æå‡ºï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæœ‰ä¸‰ä¸ªæŒ‡æ ‡ã€‚</p><blockquote><ul><li>Consistencyï¼ˆä¸€è‡´æ€§ï¼‰</li><li>Availabilityï¼ˆå¯ç”¨æ€§ï¼‰</li><li>Partition tolerance ï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰</li></ul></blockquote><p><img src="https://s1.vika.cn/space/2023/03/18/fcd56a0386004754965417591d922442" alt="image-20210724170517944"></p><p>å®ƒä»¬çš„ç¬¬ä¸€ä¸ªå­—æ¯åˆ†åˆ«æ˜¯ Cã€Aã€Pã€‚</p><p>Eric Brewer è¯´ï¼Œè¿™ä¸‰ä¸ªæŒ‡æ ‡ä¸å¯èƒ½åŒæ—¶åšåˆ°ã€‚è¿™ä¸ªç»“è®ºå°±å«åš CAP å®šç†ã€‚</p><h3 id="yi-zhi-xing" id="ä¸€è‡´æ€§">ä¸€è‡´æ€§</h3><p>Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼šç”¨æˆ·è®¿é—®åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä»»æ„èŠ‚ç‚¹ï¼Œå¾—åˆ°çš„æ•°æ®å¿…é¡»ä¸€è‡´ã€‚</p><p>æ¯”å¦‚ç°åœ¨åŒ…å«ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä¸­çš„åˆå§‹æ•°æ®æ˜¯ä¸€è‡´çš„ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/76b1efa2e3884ac5a8fc7d3b9b2c87c6" alt="image-20210724170704694"></p><p>å½“æˆ‘ä»¬ä¿®æ”¹å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®æ—¶ï¼Œä¸¤è€…çš„æ•°æ®äº§ç”Ÿäº†å·®å¼‚ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/71318a9936de4985825f77f4f0f6f40b" alt="image-20210724170735847"></p><p>è¦æƒ³ä¿ä½ä¸€è‡´æ€§ï¼Œå°±å¿…é¡»å®ç°node01 åˆ° node02çš„æ•°æ® åŒæ­¥ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/bace6a14641249bd8afa13c55c70ae63" alt="image-20210724170834855"></p><h3 id="ke-yong-xing" id="å¯ç”¨æ€§">å¯ç”¨æ€§</h3><p>Availability ï¼ˆå¯ç”¨æ€§ï¼‰ï¼šç”¨æˆ·è®¿é—®é›†ç¾¤ä¸­çš„ä»»æ„å¥åº·èŠ‚ç‚¹ï¼Œå¿…é¡»èƒ½å¾—åˆ°å“åº”ï¼Œè€Œä¸æ˜¯è¶…æ—¶æˆ–æ‹’ç»ã€‚</p><p>å¦‚å›¾ï¼Œæœ‰ä¸‰ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œè®¿é—®ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥åŠæ—¶å¾—åˆ°å“åº”ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/ab0a6ba546494f688326503613a2635e" alt="image-20210724170932072"></p><p>å½“æœ‰éƒ¨åˆ†èŠ‚ç‚¹å› ä¸ºç½‘ç»œæ•…éšœæˆ–å…¶å®ƒåŸå› æ— æ³•è®¿é—®æ—¶ï¼Œä»£è¡¨èŠ‚ç‚¹ä¸å¯ç”¨ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/fc439a0b6e8d45c5899af0781367d574" alt="image-20210724171007516"></p><h3 id="fen-qu-rong-cuo" id="åˆ†åŒºå®¹é”™">åˆ†åŒºå®¹é”™</h3><p><strong>Partitionï¼ˆåˆ†åŒºï¼‰</strong>ï¼šå› ä¸ºç½‘ç»œæ•…éšœæˆ–å…¶å®ƒåŸå› å¯¼è‡´åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„éƒ¨åˆ†èŠ‚ç‚¹ä¸å…¶å®ƒèŠ‚ç‚¹å¤±å»è¿æ¥ï¼Œå½¢æˆç‹¬ç«‹åˆ†åŒºã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/18/73c5227e6f634e8f8734921736f8d219" alt="image-20210724171041210"></p><p><strong>Toleranceï¼ˆå®¹é”™ï¼‰</strong>ï¼šåœ¨é›†ç¾¤å‡ºç°åˆ†åŒºæ—¶ï¼Œæ•´ä¸ªç³»ç»Ÿä¹Ÿè¦æŒç»­å¯¹å¤–æä¾›æœåŠ¡</p><h3 id="mao-dun" id="çŸ›ç›¾">çŸ›ç›¾</h3><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿé—´çš„ç½‘ç»œä¸èƒ½100%ä¿è¯å¥åº·ï¼Œä¸€å®šä¼šæœ‰æ•…éšœçš„æ—¶å€™ï¼Œè€ŒæœåŠ¡æœ‰å¿…é¡»å¯¹å¤–ä¿è¯æœåŠ¡ã€‚å› æ­¤Partition Toleranceä¸å¯é¿å…ã€‚</p><p>å½“èŠ‚ç‚¹æ¥æ”¶åˆ°æ–°çš„æ•°æ®å˜æ›´æ—¶ï¼Œå°±ä¼šå‡ºç°é—®é¢˜äº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/f560a52a610443ccb99f0edf597075f1" alt="image-20210724171546472"></p><p>å¦‚æœæ­¤æ—¶è¦ä¿è¯<strong>ä¸€è‡´æ€§</strong>ï¼Œå°±å¿…é¡»ç­‰å¾…ç½‘ç»œæ¢å¤ï¼Œå®Œæˆæ•°æ®åŒæ­¥åï¼Œæ•´ä¸ªé›†ç¾¤æ‰å¯¹å¤–æä¾›æœåŠ¡ï¼ŒæœåŠ¡å¤„äºé˜»å¡çŠ¶æ€ï¼Œä¸å¯ç”¨ã€‚</p><p>å¦‚æœæ­¤æ—¶è¦ä¿è¯<strong>å¯ç”¨æ€§</strong>ï¼Œå°±ä¸èƒ½ç­‰å¾…ç½‘ç»œæ¢å¤ï¼Œé‚£node01ã€node02ä¸node03ä¹‹é—´å°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨Pä¸€å®šä¼šå‡ºç°çš„æƒ…å†µä¸‹ï¼ŒAå’ŒCä¹‹é—´åªèƒ½å®ç°ä¸€ä¸ªã€‚</p><h2 id="base-li-lun" id="BASEç†è®º">BASEç†è®º</h2><p>BASEç†è®ºæ˜¯å¯¹CAPçš„ä¸€ç§è§£å†³æ€è·¯ï¼ŒåŒ…å«ä¸‰ä¸ªæ€æƒ³ï¼š</p><ul><li><strong>Basically Available</strong> <strong>ï¼ˆåŸºæœ¬å¯ç”¨ï¼‰</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œå³ä¿è¯æ ¸å¿ƒå¯ç”¨ã€‚</li><li>**Soft Stateï¼ˆè½¯çŠ¶æ€ï¼‰ï¼š**åœ¨ä¸€å®šæ—¶é—´å†…ï¼Œå…è®¸å‡ºç°ä¸­é—´çŠ¶æ€ï¼Œæ¯”å¦‚ä¸´æ—¶çš„ä¸ä¸€è‡´çŠ¶æ€ã€‚</li><li><strong>Eventually Consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰</strong>ï¼šè™½ç„¶æ— æ³•ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œä½†æ˜¯åœ¨è½¯çŠ¶æ€ç»“æŸåï¼Œæœ€ç»ˆè¾¾åˆ°æ•°æ®ä¸€è‡´ã€‚</li></ul><h2 id="jie-jue-fen-bu-shi-shi-wu-de-si-lu" id="è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€è·¯">è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€è·¯</h2><p>åˆ†å¸ƒå¼äº‹åŠ¡æœ€å¤§çš„é—®é¢˜æ˜¯å„ä¸ªå­äº‹åŠ¡çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œå› æ­¤å¯ä»¥å€Ÿé‰´CAPå®šç†å’ŒBASEç†è®ºï¼Œæœ‰ä¸¤ç§è§£å†³æ€è·¯ï¼š</p><ul><li><p>APæ¨¡å¼ï¼šå„å­äº‹åŠ¡åˆ†åˆ«æ‰§è¡Œå’Œæäº¤ï¼Œå…è®¸å‡ºç°ç»“æœä¸ä¸€è‡´ï¼Œç„¶åé‡‡ç”¨å¼¥è¡¥æªæ–½æ¢å¤æ•°æ®å³å¯ï¼Œå®ç°æœ€ç»ˆä¸€è‡´ã€‚</p></li><li><p>CPæ¨¡å¼ï¼šå„ä¸ªå­äº‹åŠ¡æ‰§è¡Œåäº’ç›¸ç­‰å¾…ï¼ŒåŒæ—¶æäº¤ï¼ŒåŒæ—¶å›æ»šï¼Œè¾¾æˆå¼ºä¸€è‡´ã€‚ä½†äº‹åŠ¡ç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œå¤„äºå¼±å¯ç”¨çŠ¶æ€ã€‚</p></li></ul><p>ä½†ä¸ç®¡æ˜¯å“ªä¸€ç§æ¨¡å¼ï¼Œéƒ½éœ€è¦åœ¨å­ç³»ç»Ÿäº‹åŠ¡ä¹‹é—´äº’ç›¸é€šè®¯ï¼Œåè°ƒäº‹åŠ¡çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä¸€ä¸ª<strong>äº‹åŠ¡åè°ƒè€…(TC)</strong>ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/150193529ac9402ba14fad18f5164b8b" alt="image-20210724172123567"></p><p>è¿™é‡Œçš„å­ç³»ç»Ÿäº‹åŠ¡ï¼Œç§°ä¸º<strong>åˆ†æ”¯äº‹åŠ¡</strong>ï¼›æœ‰å…³è”çš„å„ä¸ªåˆ†æ”¯äº‹åŠ¡åœ¨ä¸€èµ·ç§°ä¸º<strong>å…¨å±€äº‹åŠ¡</strong>ã€‚</p><h1 id="chu-shi-seata">åˆè¯†Seata</h1><p>Seataæ˜¯ 2019 å¹´ 1 æœˆä»½èš‚èšé‡‘æœå’Œé˜¿é‡Œå·´å·´å…±åŒå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚è‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚</p><p>å®˜ç½‘åœ°å€ï¼š<a href="http://seata.io/%EF%BC%8C%E5%85%B6%E4%B8%AD%E7%9A%84%E6%96%87%E6%A1%A3%E3%80%81%E6%92%AD%E5%AE%A2%E4%B8%AD%E6%8F%90%E4%BE%9B%E4%BA%86%E5%A4%A7%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E%E3%80%81%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E3%80%82">http://seata.io/ï¼Œå…¶ä¸­çš„æ–‡æ¡£ã€æ’­å®¢ä¸­æä¾›äº†å¤§é‡çš„ä½¿ç”¨è¯´æ˜ã€æºç åˆ†æã€‚</a></p><p><img src="https://s1.vika.cn/space/2023/03/18/ca4ac58fc9d24da69384ca4132b905e5" alt="image-20210724172225817"></p><h2 id="seata-de-jia-gou" id="Seataçš„æ¶æ„">Seataçš„æ¶æ„</h2><p>Seataäº‹åŠ¡ç®¡ç†ä¸­æœ‰ä¸‰ä¸ªé‡è¦çš„è§’è‰²ï¼š</p><ul><li><p><strong>TC (Transaction Coordinator) -</strong> **äº‹åŠ¡åè°ƒè€…ï¼š**ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œåè°ƒå…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p></li><li><p><strong>TM (Transaction Manager) -</strong> **äº‹åŠ¡ç®¡ç†å™¨ï¼š**å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ã€å¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</p></li><li><p><strong>RM (Resource Manager) -</strong> **èµ„æºç®¡ç†å™¨ï¼š**ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p></li></ul><p>æ•´ä½“çš„æ¶æ„å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/3be7722e1bdb48048c049a157a29ab43" alt="image-20210724172326452"></p><p>SeataåŸºäºä¸Šè¿°æ¶æ„æä¾›äº†å››ç§ä¸åŒçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>XAæ¨¡å¼ï¼šå¼ºä¸€è‡´æ€§åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œç‰ºç‰²äº†ä¸€å®šçš„å¯ç”¨æ€§ï¼Œæ— ä¸šåŠ¡ä¾µå…¥</li><li>TCCæ¨¡å¼ï¼šæœ€ç»ˆä¸€è‡´çš„åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œæœ‰ä¸šåŠ¡ä¾µå…¥</li><li>ATæ¨¡å¼ï¼šæœ€ç»ˆä¸€è‡´çš„åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œæ— ä¸šåŠ¡ä¾µå…¥ï¼Œä¹Ÿæ˜¯Seataçš„é»˜è®¤æ¨¡å¼</li><li>SAGAæ¨¡å¼ï¼šé•¿äº‹åŠ¡æ¨¡å¼ï¼Œæœ‰ä¸šåŠ¡ä¾µå…¥</li></ul><p>æ— è®ºå“ªç§æ–¹æ¡ˆï¼Œéƒ½ç¦»ä¸å¼€TCï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡çš„åè°ƒè€…ã€‚</p><h2 id="bu-shu-seata-de-tc-server" id="éƒ¨ç½²Seataçš„tc-server">éƒ¨ç½²Seataçš„tc-server</h2><h3 id="xia-zai" id="ä¸‹è½½">ä¸‹è½½</h3><p>é¦–å…ˆæˆ‘ä»¬è¦ä¸‹è½½seata-serveråŒ…ï¼Œåœ°å€åœ¨<a href="http://seata.io/zh-cn/blog/download.html">http</a><a href="http://seata.io/zh-cn/blog/download.html">://seata.io/zh-cn/blog/download</a><a href="http://seata.io/zh-cn/blog/download.html">.</a><a href="http://seata.io/zh-cn/blog/download.html">html</a></p><p>å½“ç„¶ï¼Œè¯¾å‰èµ„æ–™ä¹Ÿå‡†å¤‡å¥½äº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/904940f22b20482cbf272946b7538d7a" alt="image-20210622202357640"></p><h3 id="jie-ya" id="è§£å‹">è§£å‹</h3><p>åœ¨éä¸­æ–‡ç›®å½•è§£å‹ç¼©è¿™ä¸ªzipåŒ…ï¼Œå…¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/f953f05262524174a4ad924e9281ccc4" alt="image-20210622202515014"></p><h3 id="xiu-gai-pei-zhi" id="ä¿®æ”¹é…ç½®">ä¿®æ”¹é…ç½®</h3><p>ä¿®æ”¹confç›®å½•ä¸‹çš„registry.confæ–‡ä»¶ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/ab293e19d19f45de9f0653237151dd52" alt="image-20210622202622874"></p><p>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">registry</span> <span class="string">&#123;</span></span><br><span class="line"><span class="comment">  # tcæœåŠ¡çš„æ³¨å†Œä¸­å¿ƒç±»ï¼Œè¿™é‡Œé€‰æ‹©nacosï¼Œä¹Ÿå¯ä»¥æ˜¯eurekaã€zookeeperç­‰</span></span><br><span class="line">  <span class="attr">type</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nacos</span> <span class="string">&#123;</span></span><br><span class="line"><span class="comment">    # seata tc æœåŠ¡æ³¨å†Œåˆ° nacosçš„æœåŠ¡åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰</span></span><br><span class="line">    <span class="attr">application</span> = <span class="string">&quot;seata-tc-server&quot;</span></span><br><span class="line">    <span class="attr">serverAddr</span> = <span class="string">&quot;127.0.0.1:8848&quot;</span></span><br><span class="line">    <span class="attr">group</span> = <span class="string">&quot;DEFAULT_GROUP&quot;</span></span><br><span class="line">    <span class="attr">namespace</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">cluster</span> = <span class="string">&quot;SH&quot;</span></span><br><span class="line">    <span class="attr">username</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line">    <span class="attr">password</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line">  <span class="attr">&#125;</span></span><br><span class="line"><span class="attr">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">config</span> <span class="string">&#123;</span></span><br><span class="line"><span class="comment">  # è¯»å–tcæœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œè¿™é‡Œæ˜¯ä»nacosé…ç½®ä¸­å¿ƒè¯»å–ï¼Œè¿™æ ·å¦‚æœtcæ˜¯é›†ç¾¤ï¼Œå¯ä»¥å…±äº«é…ç½®</span></span><br><span class="line">  <span class="attr">type</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line"><span class="comment">  # é…ç½®nacosåœ°å€ç­‰ä¿¡æ¯</span></span><br><span class="line">  <span class="attr">nacos</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">serverAddr</span> = <span class="string">&quot;127.0.0.1:8848&quot;</span></span><br><span class="line">    <span class="attr">namespace</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">group</span> = <span class="string">&quot;SEATA_GROUP&quot;</span></span><br><span class="line">    <span class="attr">username</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line">    <span class="attr">password</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line">    <span class="attr">dataId</span> = <span class="string">&quot;seataServer.properties&quot;</span></span><br><span class="line">  <span class="attr">&#125;</span></span><br><span class="line"><span class="attr">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="zai-nacos-tian-jia-pei-zhi" id="åœ¨nacosæ·»åŠ é…ç½®">åœ¨nacosæ·»åŠ é…ç½®</h3><p>ç‰¹åˆ«æ³¨æ„ï¼Œä¸ºäº†è®©tcæœåŠ¡çš„é›†ç¾¤å¯ä»¥å…±äº«é…ç½®ï¼Œæˆ‘ä»¬é€‰æ‹©äº†nacosä½œä¸ºç»Ÿä¸€é…ç½®ä¸­å¿ƒã€‚å› æ­¤æœåŠ¡ç«¯é…ç½®æ–‡ä»¶seataServer.propertiesæ–‡ä»¶éœ€è¦åœ¨nacosä¸­é…å¥½ã€‚</p><p>æ ¼å¼å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/ffa08d2e0e124d269ffe813a8fd51143" alt="image-20210622203609227"></p><p>é…ç½®å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œdbä»£è¡¨æ•°æ®åº“</span></span><br><span class="line"><span class="attr">store.mode</span>=<span class="string">db</span></span><br><span class="line"><span class="attr">store.db.datasource</span>=<span class="string">druid</span></span><br><span class="line"><span class="attr">store.db.dbType</span>=<span class="string">mysql</span></span><br><span class="line"><span class="attr">store.db.driverClassName</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">store.db.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true&amp;rewriteBatchedStatements=true&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">store.db.user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">store.db.password</span>=<span class="string">abc123</span></span><br><span class="line"><span class="attr">store.db.minConn</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">store.db.maxConn</span>=<span class="string">30</span></span><br><span class="line"><span class="attr">store.db.globalTable</span>=<span class="string">global_table</span></span><br><span class="line"><span class="attr">store.db.branchTable</span>=<span class="string">branch_table</span></span><br><span class="line"><span class="attr">store.db.queryLimit</span>=<span class="string">100</span></span><br><span class="line"><span class="attr">store.db.lockTable</span>=<span class="string">lock_table</span></span><br><span class="line"><span class="attr">store.db.maxWait</span>=<span class="string">5000</span></span><br><span class="line"><span class="comment"># äº‹åŠ¡ã€æ—¥å¿—ç­‰é…ç½®</span></span><br><span class="line"><span class="attr">server.recovery.committingRetryPeriod</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">server.recovery.asynCommittingRetryPeriod</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">server.recovery.rollbackingRetryPeriod</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">server.recovery.timeoutRetryPeriod</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">server.maxCommitRetryTimeout</span>=<span class="string">-1</span></span><br><span class="line"><span class="attr">server.maxRollbackRetryTimeout</span>=<span class="string">-1</span></span><br><span class="line"><span class="attr">server.rollbackRetryTimeoutUnlockEnable</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">server.undo.logSaveDays</span>=<span class="string">7</span></span><br><span class="line"><span class="attr">server.undo.logDeletePeriod</span>=<span class="string">86400000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¼ è¾“æ–¹å¼</span></span><br><span class="line"><span class="attr">transport.serialization</span>=<span class="string">seata</span></span><br><span class="line"><span class="attr">transport.compressor</span>=<span class="string">none</span></span><br><span class="line"><span class="comment"># å…³é—­metricsåŠŸèƒ½ï¼Œæé«˜æ€§èƒ½</span></span><br><span class="line"><span class="attr">metrics.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">metrics.registryType</span>=<span class="string">compact</span></span><br><span class="line"><span class="attr">metrics.exporterList</span>=<span class="string">prometheus</span></span><br><span class="line"><span class="attr">metrics.exporterPrometheusPort</span>=<span class="string">9898</span></span><br></pre></td></tr></table></figure><p>==å…¶ä¸­çš„æ•°æ®åº“åœ°å€ã€ç”¨æˆ·åã€å¯†ç éƒ½éœ€è¦ä¿®æ”¹æˆä½ è‡ªå·±çš„æ•°æ®åº“ä¿¡æ¯ã€‚==</p><h3 id="chuang-jian-shu-ju-ku-biao" id="åˆ›å»ºæ•°æ®åº“è¡¨">åˆ›å»ºæ•°æ®åº“è¡¨</h3><p>ç‰¹åˆ«æ³¨æ„ï¼štcæœåŠ¡åœ¨ç®¡ç†åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼Œéœ€è¦è®°å½•äº‹åŠ¡ç›¸å…³æ•°æ®åˆ°æ•°æ®åº“ä¸­ï¼Œä½ éœ€è¦æå‰åˆ›å»ºå¥½è¿™äº›è¡¨ã€‚</p><p>æ–°å»ºä¸€ä¸ªåä¸ºseataçš„æ•°æ®åº“ï¼Œè¿è¡Œè¯¾å‰èµ„æ–™æä¾›çš„sqlæ–‡ä»¶ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/c6597ae167554f41ab898ec0d58a1eab" alt="image-20210622204145159"></p><p>è¿™äº›è¡¨ä¸»è¦è®°å½•å…¨å±€äº‹åŠ¡ã€åˆ†æ”¯äº‹åŠ¡ã€å…¨å±€é”ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">SET NAMES utf8mb4;</span><br><span class="line">SET FOREIGN_KEY_CHECKS = 0;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- åˆ†æ”¯äº‹åŠ¡è¡¨</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `branch_table`;</span><br><span class="line">CREATE TABLE `branch_table`  (</span><br><span class="line">  `branch_id` bigint(20) NOT NULL,</span><br><span class="line">  `xid` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,</span><br><span class="line">  `transaction_id` bigint(20) NULL DEFAULT NULL,</span><br><span class="line">  `resource_group_id` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span><br><span class="line">  `resource_id` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span><br><span class="line">  `branch_type` varchar(8) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span><br><span class="line">  `status` tinyint(4) NULL DEFAULT NULL,</span><br><span class="line">  `client_id` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span><br><span class="line">  `application_data` varchar(2000) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span><br><span class="line">  `gmt_create` datetime(6) NULL DEFAULT NULL,</span><br><span class="line">  `gmt_modified` datetime(6) NULL DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`branch_id`) USING BTREE,</span><br><span class="line">  INDEX `idx_xid`(`xid`) USING BTREE</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- å…¨å±€äº‹åŠ¡è¡¨</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `global_table`;</span><br><span class="line">CREATE TABLE `global_table`  (</span><br><span class="line">  `xid` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,</span><br><span class="line">  `transaction_id` bigint(20) NULL DEFAULT NULL,</span><br><span class="line">  `status` tinyint(4) NOT NULL,</span><br><span class="line">  `application_id` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span><br><span class="line">  `transaction_service_group` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span><br><span class="line">  `transaction_name` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span><br><span class="line">  `timeout` int(11) NULL DEFAULT NULL,</span><br><span class="line">  `begin_time` bigint(20) NULL DEFAULT NULL,</span><br><span class="line">  `application_data` varchar(2000) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span><br><span class="line">  `gmt_create` datetime NULL DEFAULT NULL,</span><br><span class="line">  `gmt_modified` datetime NULL DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`xid`) USING BTREE,</span><br><span class="line">  INDEX `idx_gmt_modified_status`(`gmt_modified`, `status`) USING BTREE,</span><br><span class="line">  INDEX `idx_transaction_id`(`transaction_id`) USING BTREE</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;</span><br><span class="line"></span><br><span class="line">SET FOREIGN_KEY_CHECKS = 1;</span><br></pre></td></tr></table></figure><h3 id="qi-dong-tc-fu-wu" id="å¯åŠ¨TCæœåŠ¡">å¯åŠ¨TCæœåŠ¡</h3><p>è¿›å…¥binç›®å½•ï¼Œè¿è¡Œå…¶ä¸­çš„seata-server.batå³å¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/d222998864ad4505866111abbb95db1d" alt="image-20210622205427318"></p><p>å¯åŠ¨æˆåŠŸåï¼Œseata-serveråº”è¯¥å·²ç»æ³¨å†Œåˆ°nacosæ³¨å†Œä¸­å¿ƒäº†ã€‚</p><p>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®nacosåœ°å€ï¼š<a href="http://localhost:8848">http://localhost:8848</a>ï¼Œç„¶åè¿›å…¥æœåŠ¡åˆ—è¡¨é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°seata-tc-serverçš„ä¿¡æ¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/769ce8659caa4ba8b5e20e3317e346f0" alt="image-20210622205901450"></p><h2 id="wei-fu-wu-ji-cheng-seata" id="å¾®æœåŠ¡é›†æˆSeata">å¾®æœåŠ¡é›†æˆSeata</h2><p>æˆ‘ä»¬ä»¥order-serviceä¸ºä¾‹æ¥æ¼”ç¤ºã€‚</p><blockquote><p>æ³¨æ„ï¼šjdk ç‰ˆæœ¬è¦å’Œ seata ç‰ˆæœ¬åŒ¹é…ï¼Œæ­¤å¤„å¯ç”¨ jdk11</p></blockquote><h3 id="yin-ru-yi-lai" id="å¼•å…¥ä¾èµ–">å¼•å…¥ä¾èµ–</h3><p>é¦–å…ˆï¼Œåœ¨order-serviceä¸­å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--seata--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ç‰ˆæœ¬è¾ƒä½ï¼Œ1.3.0ï¼Œå› æ­¤æ’é™¤--&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--seata starter é‡‡ç”¨1.4.2ç‰ˆæœ¬--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;seata.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="pei-zhi-tc-di-zhi" id="é…ç½®TCåœ°å€">é…ç½®TCåœ°å€</h3><p>åœ¨order-serviceä¸­çš„application.ymlä¸­ï¼Œé…ç½®TCæœåŠ¡ä¿¡æ¯ï¼Œé€šè¿‡æ³¨å†Œä¸­å¿ƒnacosï¼Œç»“åˆæœåŠ¡åç§°è·å–TCåœ°å€ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">seata:</span></span><br><span class="line">  <span class="attr">registry:</span> <span class="comment"># TCæœåŠ¡æ³¨å†Œä¸­å¿ƒçš„é…ç½®ï¼Œå¾®æœåŠ¡æ ¹æ®è¿™äº›ä¿¡æ¯å»æ³¨å†Œä¸­å¿ƒè·å–tcæœåŠ¡åœ°å€</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">nacos</span> <span class="comment"># æ³¨å†Œä¸­å¿ƒç±»å‹ nacos</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span> <span class="comment"># nacosåœ°å€</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">&quot;&quot;</span> <span class="comment"># namespaceï¼Œé»˜è®¤ä¸ºç©º</span></span><br><span class="line">      <span class="attr">group:</span> <span class="string">DEFAULT_GROUP</span> <span class="comment"># åˆ†ç»„ï¼Œé»˜è®¤æ˜¯DEFAULT_GROUP</span></span><br><span class="line">      <span class="attr">application:</span> <span class="string">seata-tc-server</span> <span class="comment"># seataæœåŠ¡åç§°</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="attr">tx-service-group:</span> <span class="string">seata-demo</span> <span class="comment"># äº‹åŠ¡ç»„åç§°</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">vgroup-mapping:</span> <span class="comment"># äº‹åŠ¡ç»„ä¸clusterçš„æ˜ å°„å…³ç³»</span></span><br><span class="line">      <span class="attr">seata-demo:</span> <span class="string">SH</span></span><br></pre></td></tr></table></figure><p>å¾®æœåŠ¡å¦‚ä½•æ ¹æ®è¿™äº›é…ç½®å¯»æ‰¾TCçš„åœ°å€å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çŸ¥é“æ³¨å†Œåˆ°Nacosä¸­çš„å¾®æœåŠ¡ï¼Œç¡®å®šä¸€ä¸ªå…·ä½“å®ä¾‹éœ€è¦å››ä¸ªä¿¡æ¯ï¼š</p><ul><li>namespaceï¼šå‘½åç©ºé—´</li><li>groupï¼šåˆ†ç»„</li><li>applicationï¼šæœåŠ¡å</li><li>clusterï¼šé›†ç¾¤å</li></ul><p>ä»¥ä¸Šå››ä¸ªä¿¡æ¯ï¼Œåœ¨åˆšæ‰çš„yamlæ–‡ä»¶ä¸­éƒ½èƒ½æ‰¾åˆ°ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/1ad8a27b5dcf4b5f881f361178631294" alt="image-20210724173654258"></p><p>namespaceä¸ºç©ºï¼Œå°±æ˜¯é»˜è®¤çš„public</p><p>ç»“åˆèµ·æ¥ï¼ŒTCæœåŠ¡çš„ä¿¡æ¯å°±æ˜¯ï¼špublic@DEFAULT_GROUP@seata-tc-server@SHï¼Œè¿™æ ·å°±èƒ½ç¡®å®šTCæœåŠ¡é›†ç¾¤äº†ã€‚ç„¶åå°±å¯ä»¥å»Nacosæ‹‰å–å¯¹åº”çš„å®ä¾‹ä¿¡æ¯äº†ã€‚</p><h3 id="qi-ta-fu-wu" id="å…¶å®ƒæœåŠ¡">å…¶å®ƒæœåŠ¡</h3><p>å…¶å®ƒä¸¤ä¸ªå¾®æœåŠ¡ä¹Ÿéƒ½å‚è€ƒorder-serviceçš„æ­¥éª¤æ¥åšï¼Œå®Œå…¨ä¸€æ ·ã€‚</p><h1 id="dong-shou-shi-jian">åŠ¨æ‰‹å®è·µ</h1><p>ä¸‹é¢æˆ‘ä»¬å°±ä¸€èµ·å­¦ä¹ ä¸‹Seataä¸­çš„å››ç§ä¸åŒçš„äº‹åŠ¡æ¨¡å¼ã€‚</p><h2 id="xa-mo-shi" id="XAæ¨¡å¼">XAæ¨¡å¼</h2><p>XA è§„èŒƒ æ˜¯ X/Open ç»„ç»‡å®šä¹‰çš„åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ï¼ˆDTPï¼ŒDistributed Transaction Processingï¼‰æ ‡å‡†ï¼ŒXA è§„èŒƒ æè¿°äº†å…¨å±€çš„TMä¸å±€éƒ¨çš„RMä¹‹é—´çš„æ¥å£ï¼Œå‡ ä¹æ‰€æœ‰ä¸»æµçš„æ•°æ®åº“éƒ½å¯¹ XA è§„èŒƒ æä¾›äº†æ”¯æŒã€‚</p><h3 id="liang-jie-duan-ti-jiao" id="ä¸¤é˜¶æ®µæäº¤">ä¸¤é˜¶æ®µæäº¤</h3><p>XAæ˜¯è§„èŒƒï¼Œç›®å‰ä¸»æµæ•°æ®åº“éƒ½å®ç°äº†è¿™ç§è§„èŒƒï¼Œå®ç°çš„åŸç†éƒ½æ˜¯åŸºäºä¸¤é˜¶æ®µæäº¤ã€‚</p><p>æ­£å¸¸æƒ…å†µï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/852a4775004c41a083ec9f52211468d6" alt="image-20210724174102768"></p><p>å¼‚å¸¸æƒ…å†µï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/f8904f3029ac47f997ff9fc22f4fb5e3" alt="image-20210724174234987"></p><p>ä¸€é˜¶æ®µï¼š</p><ul><li>äº‹åŠ¡åè°ƒè€…é€šçŸ¥æ¯ä¸ªäº‹ç‰©å‚ä¸è€…æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</li><li>æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå®ŒæˆåæŠ¥å‘Šäº‹åŠ¡æ‰§è¡ŒçŠ¶æ€ç»™äº‹åŠ¡åè°ƒè€…ï¼Œæ­¤æ—¶äº‹åŠ¡ä¸æäº¤ï¼Œç»§ç»­æŒæœ‰æ•°æ®åº“é”</li></ul><p>äºŒé˜¶æ®µï¼š</p><ul><li>äº‹åŠ¡åè°ƒè€…åŸºäºä¸€é˜¶æ®µçš„æŠ¥å‘Šæ¥åˆ¤æ–­ä¸‹ä¸€æ­¥æ“ä½œ<ul><li>å¦‚æœä¸€é˜¶æ®µéƒ½æˆåŠŸï¼Œåˆ™é€šçŸ¥æ‰€æœ‰äº‹åŠ¡å‚ä¸è€…ï¼Œæäº¤äº‹åŠ¡</li><li>å¦‚æœä¸€é˜¶æ®µä»»æ„ä¸€ä¸ªå‚ä¸è€…å¤±è´¥ï¼Œåˆ™é€šçŸ¥æ‰€æœ‰äº‹åŠ¡å‚ä¸è€…å›æ»šäº‹åŠ¡</li></ul></li></ul><h3 id="seata-de-xa-mo-xing" id="Seataçš„XAæ¨¡å‹">Seataçš„XAæ¨¡å‹</h3><p>Seataå¯¹åŸå§‹çš„XAæ¨¡å¼åšäº†ç®€å•çš„å°è£…å’Œæ”¹é€ ï¼Œä»¥é€‚åº”è‡ªå·±çš„äº‹åŠ¡æ¨¡å‹ï¼ŒåŸºæœ¬æ¶æ„å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/65fb470a75674e18afa54ff975fd56d6" alt="image-20210724174424070"></p><p>RMä¸€é˜¶æ®µçš„å·¥ä½œï¼š</p><p>â€‹â‘  æ³¨å†Œåˆ†æ”¯äº‹åŠ¡åˆ°TC</p><p>â€‹â‘¡ æ‰§è¡Œåˆ†æ”¯ä¸šåŠ¡sqlä½†ä¸æäº¤</p><p>â€‹â‘¢ æŠ¥å‘Šæ‰§è¡ŒçŠ¶æ€åˆ°TC</p><p>TCäºŒé˜¶æ®µçš„å·¥ä½œï¼š</p><ul><li><p>TCæ£€æµ‹å„åˆ†æ”¯äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€</p><p>a.å¦‚æœéƒ½æˆåŠŸï¼Œé€šçŸ¥æ‰€æœ‰RMæäº¤äº‹åŠ¡</p><p>b.å¦‚æœæœ‰å¤±è´¥ï¼Œé€šçŸ¥æ‰€æœ‰RMå›æ»šäº‹åŠ¡</p></li></ul><p>RMäºŒé˜¶æ®µçš„å·¥ä½œï¼š</p><ul><li>æ¥æ”¶TCæŒ‡ä»¤ï¼Œæäº¤æˆ–å›æ»šäº‹åŠ¡</li></ul><h3 id="you-que-dian" id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h3><p>XAæ¨¡å¼çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>äº‹åŠ¡çš„å¼ºä¸€è‡´æ€§ï¼Œæ»¡è¶³ACIDåŸåˆ™ã€‚</li><li>å¸¸ç”¨æ•°æ®åº“éƒ½æ”¯æŒï¼Œå®ç°ç®€å•ï¼Œå¹¶ä¸”æ²¡æœ‰ä»£ç ä¾µå…¥</li></ul><p>XAæ¨¡å¼çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>å› ä¸ºä¸€é˜¶æ®µéœ€è¦é”å®šæ•°æ®åº“èµ„æºï¼Œç­‰å¾…äºŒé˜¶æ®µç»“æŸæ‰é‡Šæ”¾ï¼Œæ€§èƒ½è¾ƒå·®</li><li>ä¾èµ–å…³ç³»å‹æ•°æ®åº“å®ç°äº‹åŠ¡</li></ul><h3 id="shi-xian-xa-mo-shi" id="å®ç°XAæ¨¡å¼">å®ç°XAæ¨¡å¼</h3><p>Seataçš„starterå·²ç»å®Œæˆäº†XAæ¨¡å¼çš„è‡ªåŠ¨è£…é…ï¼Œå®ç°éå¸¸ç®€å•ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><blockquote><p>æ³¨æ„Mysql ç‰ˆæœ¬ï¼šæ­¤å¤„ä½¿ç”¨ 8.0.11</p></blockquote><ol><li>ä¿®æ”¹application.ymlæ–‡ä»¶ï¼ˆæ¯ä¸ªå‚ä¸äº‹åŠ¡çš„å¾®æœåŠ¡ï¼‰ï¼Œå¼€å¯XAæ¨¡å¼ï¼š</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">seata:</span></span><br><span class="line">  <span class="attr">data-source-proxy-mode:</span> <span class="string">XA</span></span><br></pre></td></tr></table></figure><ol start="2"><li>ç»™å‘èµ·å…¨å±€äº‹åŠ¡çš„å…¥å£æ–¹æ³•æ·»åŠ @GlobalTransactionalæ³¨è§£:</li></ol><p>æœ¬ä¾‹ä¸­æ˜¯OrderServiceImplä¸­çš„createæ–¹æ³•.</p><p><img src="https://s1.vika.cn/space/2023/03/18/7362c4e8f7854b149728165d99557002" alt="image-20210724174859556"></p><ol start="3"><li>é‡å¯æœåŠ¡å¹¶æµ‹è¯•</li></ol><p>é‡å¯order-serviceï¼Œå†æ¬¡æµ‹è¯•ï¼Œå‘ç°æ— è®ºæ€æ ·ï¼Œä¸‰ä¸ªå¾®æœåŠ¡éƒ½èƒ½æˆåŠŸå›æ»šã€‚</p><h2 id="at-mo-shi" id="ATæ¨¡å¼">ATæ¨¡å¼</h2><p>ATæ¨¡å¼åŒæ ·æ˜¯åˆ†é˜¶æ®µæäº¤çš„äº‹åŠ¡æ¨¡å‹ï¼Œä¸è¿‡ç¼ºå¼¥è¡¥äº†XAæ¨¡å‹ä¸­èµ„æºé”å®šå‘¨æœŸè¿‡é•¿çš„ç¼ºé™·ã€‚</p><h3 id="seata-de-at-mo-xing" id="Seataçš„ATæ¨¡å‹">Seataçš„ATæ¨¡å‹</h3><p>åŸºæœ¬æµç¨‹å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/a65f1c05e0eb4b899214fbc9ff6f533f" alt="image-20210724175327511"></p><p>é˜¶æ®µä¸€RMçš„å·¥ä½œï¼š</p><ul><li>æ³¨å†Œåˆ†æ”¯äº‹åŠ¡</li><li>è®°å½•undo-logï¼ˆæ•°æ®å¿«ç…§ï¼‰</li><li>æ‰§è¡Œä¸šåŠ¡sqlå¹¶æäº¤</li><li>æŠ¥å‘Šäº‹åŠ¡çŠ¶æ€</li></ul><p>é˜¶æ®µäºŒæäº¤æ—¶RMçš„å·¥ä½œï¼š</p><ul><li>åˆ é™¤undo-logå³å¯</li></ul><p>é˜¶æ®µäºŒå›æ»šæ—¶RMçš„å·¥ä½œï¼š</p><ul><li>æ ¹æ®undo-logæ¢å¤æ•°æ®åˆ°æ›´æ–°å‰</li></ul><h3 id="liu-cheng-shu-li" id="æµç¨‹æ¢³ç†">æµç¨‹æ¢³ç†</h3><p>æˆ‘ä»¬ç”¨ä¸€ä¸ªçœŸå®çš„ä¸šåŠ¡æ¥æ¢³ç†ä¸‹ATæ¨¡å¼çš„åŸç†ã€‚</p><p>æ¯”å¦‚ï¼Œç°åœ¨åˆä¸€ä¸ªæ•°æ®åº“è¡¨ï¼Œè®°å½•ç”¨æˆ·ä½™é¢ï¼š</p><table><thead><tr><th><strong>id</strong></th><th><strong>money</strong></th></tr></thead><tbody><tr><td>1</td><td>100</td></tr></tbody></table><p>å…¶ä¸­ä¸€ä¸ªåˆ†æ”¯ä¸šåŠ¡è¦æ‰§è¡Œçš„SQLä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> tb_account <span class="keyword">set</span> money <span class="operator">=</span> money <span class="operator">-</span> <span class="number">10</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ATæ¨¡å¼ä¸‹ï¼Œå½“å‰åˆ†æ”¯äº‹åŠ¡æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p>ä¸€é˜¶æ®µï¼š</p><p>1ï¼‰TMå‘èµ·å¹¶æ³¨å†Œå…¨å±€äº‹åŠ¡åˆ°TC</p><p>2ï¼‰TMè°ƒç”¨åˆ†æ”¯äº‹åŠ¡</p><p>3ï¼‰åˆ†æ”¯äº‹åŠ¡å‡†å¤‡æ‰§è¡Œä¸šåŠ¡SQL</p><p>4ï¼‰RMæ‹¦æˆªä¸šåŠ¡SQLï¼Œæ ¹æ®whereæ¡ä»¶æŸ¥è¯¢åŸå§‹æ•°æ®ï¼Œå½¢æˆå¿«ç…§ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;money&quot;</span><span class="punctuation">:</span> <span class="number">100</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>5ï¼‰RMæ‰§è¡Œä¸šåŠ¡SQLï¼Œæäº¤æœ¬åœ°äº‹åŠ¡ï¼Œé‡Šæ”¾æ•°æ®åº“é”ã€‚æ­¤æ—¶ <code>money = 90</code></p><p>6ï¼‰RMæŠ¥å‘Šæœ¬åœ°äº‹åŠ¡çŠ¶æ€ç»™TC</p><p>äºŒé˜¶æ®µï¼š</p><p>1ï¼‰TMé€šçŸ¥TCäº‹åŠ¡ç»“æŸ</p><p>2ï¼‰TCæ£€æŸ¥åˆ†æ”¯äº‹åŠ¡çŠ¶æ€</p><p>â€‹ aï¼‰å¦‚æœéƒ½æˆåŠŸï¼Œåˆ™ç«‹å³åˆ é™¤å¿«ç…§</p><p>â€‹ bï¼‰å¦‚æœæœ‰åˆ†æ”¯äº‹åŠ¡å¤±è´¥ï¼Œéœ€è¦å›æ»šã€‚è¯»å–å¿«ç…§æ•°æ®ï¼ˆ<code>&#123;&quot;id&quot;: 1, &quot;money&quot;: 100&#125;</code>ï¼‰ï¼Œå°†å¿«ç…§æ¢å¤åˆ°æ•°æ®åº“ã€‚æ­¤æ—¶æ•°æ®åº“å†æ¬¡æ¢å¤ä¸º100</p><p>æµç¨‹å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/507370293e284983b3b7bc45afb48fa5" alt="image-20210724180722921"></p><h3 id="at-yu-xa-de-qu-bie" id="ATä¸XAçš„åŒºåˆ«">ATä¸XAçš„åŒºåˆ«</h3><p>ç®€è¿°ATæ¨¡å¼ä¸XAæ¨¡å¼æœ€å¤§çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>XAæ¨¡å¼ä¸€é˜¶æ®µä¸æäº¤äº‹åŠ¡ï¼Œé”å®šèµ„æºï¼›ATæ¨¡å¼ä¸€é˜¶æ®µç›´æ¥æäº¤ï¼Œä¸é”å®šèµ„æºã€‚</li><li>XAæ¨¡å¼ä¾èµ–æ•°æ®åº“æœºåˆ¶å®ç°å›æ»šï¼›ATæ¨¡å¼åˆ©ç”¨æ•°æ®å¿«ç…§å®ç°æ•°æ®å›æ»šã€‚</li><li>XAæ¨¡å¼å¼ºä¸€è‡´ï¼›ATæ¨¡å¼æœ€ç»ˆä¸€è‡´</li></ul><h3 id="zang-xie-wen-ti" id="è„å†™é—®é¢˜">è„å†™é—®é¢˜</h3><p>åœ¨å¤šçº¿ç¨‹å¹¶å‘è®¿é—®ATæ¨¡å¼çš„åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼Œæœ‰å¯èƒ½å‡ºç°è„å†™é—®é¢˜ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/b5be5feef8e7478c8b65c8b766f2a750" alt="image-20210724181541234"></p><p>è§£å†³æ€è·¯å°±æ˜¯å¼•å…¥äº†å…¨å±€é”çš„æ¦‚å¿µã€‚åœ¨é‡Šæ”¾DBé”ä¹‹å‰ï¼Œå…ˆæ‹¿åˆ°å…¨å±€é”ã€‚é¿å…åŒä¸€æ—¶åˆ»æœ‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ¥æ“ä½œå½“å‰æ•°æ®ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/18/5434488485b24c1c90617f4718634d14" alt="image-20210724181843029"></p><p>äººå·¥ä»‹å…¥æƒ…å†µï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/1895eac336a64b8ebe055125d4920ae5" alt="image-20230319140211966"></p><h3 id="you-que-dian-1" id="ä¼˜ç¼ºç‚¹-2">ä¼˜ç¼ºç‚¹</h3><p>ATæ¨¡å¼çš„ä¼˜ç‚¹ï¼š</p><ul><li>ä¸€é˜¶æ®µå®Œæˆç›´æ¥æäº¤äº‹åŠ¡ï¼Œé‡Šæ”¾æ•°æ®åº“èµ„æºï¼Œæ€§èƒ½æ¯”è¾ƒå¥½</li><li>åˆ©ç”¨å…¨å±€é”å®ç°è¯»å†™éš”ç¦»</li><li>æ²¡æœ‰ä»£ç ä¾µå…¥ï¼Œæ¡†æ¶è‡ªåŠ¨å®Œæˆå›æ»šå’Œæäº¤</li></ul><p>ATæ¨¡å¼çš„ç¼ºç‚¹ï¼š</p><ul><li>ä¸¤é˜¶æ®µä¹‹é—´å±äºè½¯çŠ¶æ€ï¼Œå±äºæœ€ç»ˆä¸€è‡´</li><li>æ¡†æ¶çš„å¿«ç…§åŠŸèƒ½ä¼šå½±å“æ€§èƒ½ï¼Œä½†æ¯”XAæ¨¡å¼è¦å¥½å¾ˆå¤š</li></ul><h3 id="shi-xian-at-mo-shi" id="å®ç°ATæ¨¡å¼">å®ç°ATæ¨¡å¼</h3><p>ATæ¨¡å¼ä¸­çš„å¿«ç…§ç”Ÿæˆã€å›æ»šç­‰åŠ¨ä½œéƒ½æ˜¯ç”±æ¡†æ¶è‡ªåŠ¨å®Œæˆï¼Œæ²¡æœ‰ä»»ä½•ä»£ç ä¾µå…¥ï¼Œå› æ­¤å®ç°éå¸¸ç®€å•ã€‚</p><p>åªä¸è¿‡ï¼ŒATæ¨¡å¼éœ€è¦ä¸€ä¸ªè¡¨æ¥è®°å½•å…¨å±€é”ã€å¦ä¸€å¼ è¡¨æ¥è®°å½•æ•°æ®å¿«ç…§undo_logã€‚</p><p>1ï¼‰å¯¼å…¥æ•°æ®åº“è¡¨ï¼Œè®°å½•å…¨å±€é”</p><p>å¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„Sqlæ–‡ä»¶ï¼šseata-at.sqlï¼Œå…¶ä¸­lock_tableå¯¼å…¥åˆ°TCæœåŠ¡å…³è”çš„æ•°æ®åº“ï¼Œundo_logè¡¨å¯¼å…¥åˆ°å¾®æœåŠ¡å…³è”çš„æ•°æ®åº“ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/a54af310cb624ed98097699525efaa72" alt="image-20210724182217272"></p><ol><li><p>seata æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for lock_table</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `lock_table`;</span><br><span class="line">CREATE TABLE `lock_table`  (</span><br><span class="line">  `row_key` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,</span><br><span class="line">  `xid` varchar(96) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span><br><span class="line">  `transaction_id` bigint(20) NULL DEFAULT NULL,</span><br><span class="line">  `branch_id` bigint(20) NOT NULL,</span><br><span class="line">  `resource_id` varchar(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span><br><span class="line">  `table_name` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span><br><span class="line">  `pk` varchar(36) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,</span><br><span class="line">  `gmt_create` datetime NULL DEFAULT NULL,</span><br><span class="line">  `gmt_modified` datetime NULL DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`row_key`) USING BTREE,</span><br><span class="line">  INDEX `idx_branch_id`(`branch_id`) USING BTREE</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Compact;</span><br></pre></td></tr></table></figure></li><li><p>seata_demo æ•°æ®åº“</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for undo_log</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `undo_log`;</span><br><span class="line">CREATE TABLE `undo_log`  (</span><br><span class="line">  `branch_id` bigint(20) NOT NULL COMMENT &#x27;branch transaction id&#x27;,</span><br><span class="line">  `xid` varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT &#x27;global transaction id&#x27;,</span><br><span class="line">  `context` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT &#x27;undo_log context,such as serialization&#x27;,</span><br><span class="line">  `rollback_info` longblob NOT NULL COMMENT &#x27;rollback info&#x27;,</span><br><span class="line">  `log_status` int(11) NOT NULL COMMENT &#x27;0:normal status,1:defense status&#x27;,</span><br><span class="line">  `log_created` datetime(6) NOT NULL COMMENT &#x27;create datetime&#x27;,</span><br><span class="line">  `log_modified` datetime(6) NOT NULL COMMENT &#x27;modify datetime&#x27;,</span><br><span class="line">  UNIQUE INDEX `ux_undo_log`(`xid`, `branch_id`) USING BTREE</span><br><span class="line">) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = &#x27;AT transaction mode undo table&#x27; ROW_FORMAT = Compact;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of undo_log</span><br><span class="line">-- ----------------------------</span><br></pre></td></tr></table></figure><p>2ï¼‰ä¿®æ”¹application.ymlæ–‡ä»¶ï¼Œå°†äº‹åŠ¡æ¨¡å¼ä¿®æ”¹ä¸ºATæ¨¡å¼å³å¯ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">seata:</span></span><br><span class="line">  <span class="attr">data-source-proxy-mode:</span> <span class="string">AT</span> <span class="comment"># é»˜è®¤å°±æ˜¯AT</span></span><br></pre></td></tr></table></figure><p>3ï¼‰é‡å¯æœåŠ¡å¹¶æµ‹è¯•</p><h2 id="tcc-mo-shi" id="TCCæ¨¡å¼">TCCæ¨¡å¼</h2><p>TCCæ¨¡å¼ä¸ATæ¨¡å¼éå¸¸ç›¸ä¼¼ï¼Œæ¯é˜¶æ®µéƒ½æ˜¯ç‹¬ç«‹äº‹åŠ¡ï¼Œä¸åŒçš„æ˜¯TCCé€šè¿‡äººå·¥ç¼–ç æ¥å®ç°æ•°æ®æ¢å¤ã€‚éœ€è¦å®ç°ä¸‰ä¸ªæ–¹æ³•ï¼š</p><ul><li><p>Tryï¼šèµ„æºçš„æ£€æµ‹å’Œé¢„ç•™ï¼›</p></li><li><p>Confirmï¼šå®Œæˆèµ„æºæ“ä½œä¸šåŠ¡ï¼›è¦æ±‚ Try æˆåŠŸ Confirm ä¸€å®šè¦èƒ½æˆåŠŸã€‚</p></li><li><p>Cancelï¼šé¢„ç•™èµ„æºé‡Šæ”¾ï¼Œå¯ä»¥ç†è§£ä¸ºtryçš„åå‘æ“ä½œã€‚</p></li></ul><h3 id="liu-cheng-fen-xi" id="æµç¨‹åˆ†æ">æµç¨‹åˆ†æ</h3><p>ä¸¾ä¾‹ï¼Œä¸€ä¸ªæ‰£å‡ç”¨æˆ·ä½™é¢çš„ä¸šåŠ¡ã€‚å‡è®¾è´¦æˆ·AåŸæ¥ä½™é¢æ˜¯100ï¼Œéœ€è¦ä½™é¢æ‰£å‡30å…ƒã€‚</p><ul><li><strong>é˜¶æ®µä¸€ï¼ˆ Try ï¼‰</strong>ï¼šæ£€æŸ¥ä½™é¢æ˜¯å¦å……è¶³ï¼Œå¦‚æœå……è¶³åˆ™å†»ç»“é‡‘é¢å¢åŠ 30å…ƒï¼Œå¯ç”¨ä½™é¢æ‰£é™¤30</li></ul><p>åˆè¯†ä½™é¢ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/d8423c3e274f4769ae97118452556b82" alt="image-20210724182424907"></p><p>ä½™é¢å……è¶³ï¼Œå¯ä»¥å†»ç»“ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/f228de8717194f968679754e981c82c1" alt="image-20210724182457951"></p><p>æ­¤æ—¶ï¼Œæ€»é‡‘é¢ = å†»ç»“é‡‘é¢ + å¯ç”¨é‡‘é¢ï¼Œæ•°é‡ä¾ç„¶æ˜¯100ä¸å˜ã€‚äº‹åŠ¡ç›´æ¥æäº¤æ— éœ€ç­‰å¾…å…¶å®ƒäº‹åŠ¡ã€‚</p><ul><li><strong>é˜¶æ®µäºŒï¼ˆConfirm)</strong>ï¼šå‡å¦‚è¦æäº¤ï¼ˆConfirmï¼‰ï¼Œåˆ™å†»ç»“é‡‘é¢æ‰£å‡30</li></ul><p>ç¡®è®¤å¯ä»¥æäº¤ï¼Œä¸è¿‡ä¹‹å‰å¯ç”¨é‡‘é¢å·²ç»æ‰£å‡è¿‡äº†ï¼Œè¿™é‡Œåªè¦æ¸…é™¤å†»ç»“é‡‘é¢å°±å¥½äº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/b311f3718cdd44619f258bf1e08bf544" alt="image-20210724182706011"></p><p>æ­¤æ—¶ï¼Œæ€»é‡‘é¢ = å†»ç»“é‡‘é¢ + å¯ç”¨é‡‘é¢ = 0 + 70  = 70å…ƒ</p><ul><li><strong>é˜¶æ®µäºŒ(Canncel)</strong>ï¼šå¦‚æœè¦å›æ»šï¼ˆCancelï¼‰ï¼Œåˆ™å†»ç»“é‡‘é¢æ‰£å‡30ï¼Œå¯ç”¨ä½™é¢å¢åŠ 30</li></ul><p>éœ€è¦å›æ»šï¼Œé‚£ä¹ˆå°±è¦é‡Šæ”¾å†»ç»“é‡‘é¢ï¼Œæ¢å¤å¯ç”¨é‡‘é¢ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/b40e2bc08f244c679648fbf8894ba6b6" alt="image-20210724182810734"></p><h3 id="seata-de-tcc-mo-xing" id="Seataçš„TCCæ¨¡å‹">Seataçš„TCCæ¨¡å‹</h3><p>Seataä¸­çš„TCCæ¨¡å‹ä¾ç„¶å»¶ç»­ä¹‹å‰çš„äº‹åŠ¡æ¶æ„ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/16b62fb7c54440e2bd7394a5d79c7ace" alt="image-20210724182937713"></p><h3 id="you-que-dian-2" id="ä¼˜ç¼ºç‚¹-3">ä¼˜ç¼ºç‚¹</h3><p>TCCæ¨¡å¼çš„æ¯ä¸ªé˜¶æ®µæ˜¯åšä»€ä¹ˆçš„ï¼Ÿ</p><ul><li>Tryï¼šèµ„æºæ£€æŸ¥å’Œé¢„ç•™</li><li>Confirmï¼šä¸šåŠ¡æ‰§è¡Œå’Œæäº¤</li><li>Cancelï¼šé¢„ç•™èµ„æºçš„é‡Šæ”¾</li></ul><p>TCCçš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>ä¸€é˜¶æ®µå®Œæˆç›´æ¥æäº¤äº‹åŠ¡ï¼Œé‡Šæ”¾æ•°æ®åº“èµ„æºï¼Œæ€§èƒ½å¥½</li><li>ç›¸æ¯”ATæ¨¡å‹ï¼Œæ— éœ€ç”Ÿæˆå¿«ç…§ï¼Œæ— éœ€ä½¿ç”¨å…¨å±€é”ï¼Œæ€§èƒ½æœ€å¼º</li><li>ä¸ä¾èµ–æ•°æ®åº“äº‹åŠ¡ï¼Œè€Œæ˜¯ä¾èµ–è¡¥å¿æ“ä½œï¼Œå¯ä»¥ç”¨äºéäº‹åŠ¡å‹æ•°æ®åº“</li></ul><p>TCCçš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>æœ‰ä»£ç ä¾µå…¥ï¼Œéœ€è¦äººä¸ºç¼–å†™tryã€Confirmå’ŒCancelæ¥å£ï¼Œå¤ªéº»çƒ¦</li><li>è½¯çŠ¶æ€ï¼Œäº‹åŠ¡æ˜¯æœ€ç»ˆä¸€è‡´</li><li>éœ€è¦è€ƒè™‘Confirmå’ŒCancelçš„å¤±è´¥æƒ…å†µï¼Œåšå¥½å¹‚ç­‰å¤„ç†</li></ul><h3 id="shi-wu-xuan-gua-he-kong-hui-gun" id="äº‹åŠ¡æ‚¬æŒ‚å’Œç©ºå›æ»š">äº‹åŠ¡æ‚¬æŒ‚å’Œç©ºå›æ»š</h3><h4 id="kong-hui-gun" id="ç©ºå›æ»š">ç©ºå›æ»š</h4><p>å½“æŸåˆ†æ”¯äº‹åŠ¡çš„tryé˜¶æ®µ<strong>é˜»å¡</strong>æ—¶ï¼Œå¯èƒ½å¯¼è‡´å…¨å±€äº‹åŠ¡è¶…æ—¶è€Œè§¦å‘äºŒé˜¶æ®µçš„cancelæ“ä½œã€‚åœ¨æœªæ‰§è¡Œtryæ“ä½œæ—¶å…ˆæ‰§è¡Œäº†cancelæ“ä½œï¼Œè¿™æ—¶cancelä¸èƒ½åšå›æ»šï¼Œå°±æ˜¯<strong>ç©ºå›æ»š</strong>ã€‚</p><p>å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/a70d0381f9e64e919ff87e2783999db2" alt="image-20210724183426891"></p><p>æ‰§è¡Œcancelæ“ä½œæ—¶ï¼Œåº”å½“åˆ¤æ–­tryæ˜¯å¦å·²ç»æ‰§è¡Œï¼Œå¦‚æœå°šæœªæ‰§è¡Œï¼Œåˆ™åº”è¯¥ç©ºå›æ»šã€‚</p><h4 id="ye-wu-xuan-gua" id="ä¸šåŠ¡æ‚¬æŒ‚">ä¸šåŠ¡æ‚¬æŒ‚</h4><p>å¯¹äºå·²ç»ç©ºå›æ»šçš„ä¸šåŠ¡ï¼Œä¹‹å‰è¢«é˜»å¡çš„tryæ“ä½œæ¢å¤ï¼Œç»§ç»­æ‰§è¡Œtryï¼Œå°±æ°¸è¿œä¸å¯èƒ½confirmæˆ–cancel ï¼Œäº‹åŠ¡ä¸€ç›´å¤„äºä¸­é—´çŠ¶æ€ï¼Œè¿™å°±æ˜¯<strong>ä¸šåŠ¡æ‚¬æŒ‚</strong>ã€‚</p><p>æ‰§è¡Œtryæ“ä½œæ—¶ï¼Œåº”å½“åˆ¤æ–­cancelæ˜¯å¦å·²ç»æ‰§è¡Œè¿‡äº†ï¼Œå¦‚æœå·²ç»æ‰§è¡Œï¼Œåº”å½“é˜»æ­¢ç©ºå›æ»šåçš„tryæ“ä½œï¼Œé¿å…æ‚¬æŒ‚</p><h3 id="shi-xian-tcc-mo-shi" id="å®ç°TCCæ¨¡å¼">å®ç°TCCæ¨¡å¼</h3><p>è§£å†³ç©ºå›æ»šå’Œä¸šåŠ¡æ‚¬æŒ‚é—®é¢˜ï¼Œå¿…é¡»è¦è®°å½•å½“å‰äº‹åŠ¡çŠ¶æ€ï¼Œæ˜¯åœ¨tryã€è¿˜æ˜¯cancelï¼Ÿ</p><blockquote><p>æ¡ˆä¾‹ï¼šæ”¹é€ account-serviceæœåŠ¡ï¼Œåˆ©ç”¨TCCå®ç°åˆ†å¸ƒå¼äº‹åŠ¡</p><p>éœ€æ±‚å¦‚ä¸‹ï¼š</p><ul><li><p>ä¿®æ”¹account-serviceï¼Œç¼–å†™tryã€confirmã€cancelé€»è¾‘</p></li><li><p>tryä¸šåŠ¡ï¼šæ·»åŠ å†»ç»“é‡‘é¢ï¼Œæ‰£å‡å¯ç”¨é‡‘é¢</p></li><li><p>confirmä¸šåŠ¡ï¼šåˆ é™¤å†»ç»“é‡‘é¢</p></li><li><p>cancelä¸šåŠ¡ï¼šåˆ é™¤å†»ç»“é‡‘é¢ï¼Œæ¢å¤å¯ç”¨é‡‘é¢</p></li><li><p>ä¿è¯confirmã€cancelæ¥å£çš„å¹‚ç­‰æ€§</p></li><li><p>å…è®¸ç©ºå›æ»š</p></li><li><p>æ‹’ç»ä¸šåŠ¡æ‚¬æŒ‚</p></li></ul></blockquote><h4 id="si-lu-fen-xi" id="æ€è·¯åˆ†æ">æ€è·¯åˆ†æ</h4><p>è¿™é‡Œæˆ‘ä»¬å®šä¹‰ä¸€å¼ è¡¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span>Â <span class="keyword">TABLE</span>Â `account_freeze_tbl`Â (</span><br><span class="line">Â Â `xid`Â <span class="type">varchar</span>(<span class="number">128</span>)Â <span class="keyword">NOT</span>Â <span class="keyword">NULL</span>,</span><br><span class="line">Â Â `user_id`Â <span class="type">varchar</span>(<span class="number">255</span>)Â <span class="keyword">DEFAULT</span>Â <span class="keyword">NULL</span>Â COMMENTÂ <span class="string">&#x27;ç”¨æˆ·id&#x27;</span>,</span><br><span class="line">Â Â `freeze_money`Â <span class="type">int</span>(<span class="number">11</span>)Â unsignedÂ <span class="keyword">DEFAULT</span>Â <span class="string">&#x27;0&#x27;</span>Â COMMENTÂ <span class="string">&#x27;å†»ç»“é‡‘é¢&#x27;</span>,</span><br><span class="line">Â Â `state`Â <span class="type">int</span>(<span class="number">1</span>)Â <span class="keyword">DEFAULT</span>Â <span class="keyword">NULL</span>Â COMMENTÂ <span class="string">&#x27;äº‹åŠ¡çŠ¶æ€ï¼Œ0:tryï¼Œ1:confirmï¼Œ2:cancel&#x27;</span>,</span><br><span class="line">Â Â <span class="keyword">PRIMARY</span>Â KEYÂ (`xid`)Â <span class="keyword">USING</span>Â BTREE</span><br><span class="line">)Â ENGINE<span class="operator">=</span>InnoDBÂ <span class="keyword">DEFAULT</span>Â CHARSET<span class="operator">=</span>utf8Â ROW_FORMAT<span class="operator">=</span>COMPACT;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><ul><li>xidï¼šæ˜¯å…¨å±€äº‹åŠ¡id</li><li>freeze_moneyï¼šç”¨æ¥è®°å½•ç”¨æˆ·å†»ç»“é‡‘é¢</li><li>stateï¼šç”¨æ¥è®°å½•äº‹åŠ¡çŠ¶æ€</li></ul><p>é‚£æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡å¼€æ€ä¹ˆåšå‘¢ï¼Ÿ</p><ul><li>Tryä¸šåŠ¡ï¼š<ul><li>è®°å½•å†»ç»“é‡‘é¢å’Œäº‹åŠ¡çŠ¶æ€åˆ°account_freezeè¡¨</li><li>æ‰£å‡accountè¡¨å¯ç”¨é‡‘é¢</li></ul></li><li>Confirmä¸šåŠ¡<ul><li>æ ¹æ®xidåˆ é™¤account_freezeè¡¨çš„å†»ç»“è®°å½•</li></ul></li><li>Cancelä¸šåŠ¡<ul><li>ä¿®æ”¹account_freezeè¡¨ï¼Œå†»ç»“é‡‘é¢ä¸º0ï¼Œstateä¸º2</li><li>ä¿®æ”¹accountè¡¨ï¼Œæ¢å¤å¯ç”¨é‡‘é¢</li></ul></li><li>å¦‚ä½•åˆ¤æ–­æ˜¯å¦ç©ºå›æ»šï¼Ÿ<ul><li>cancelä¸šåŠ¡ä¸­ï¼Œæ ¹æ®xidæŸ¥è¯¢account_freezeï¼Œå¦‚æœä¸ºnullåˆ™è¯´æ˜tryè¿˜æ²¡åšï¼Œéœ€è¦ç©ºå›æ»š</li></ul></li><li>å¦‚ä½•é¿å…ä¸šåŠ¡æ‚¬æŒ‚ï¼Ÿ<ul><li>tryä¸šåŠ¡ä¸­ï¼Œæ ¹æ®xidæŸ¥è¯¢account_freeze ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™è¯æ˜Cancelå·²ç»æ‰§è¡Œï¼Œæ‹’ç»æ‰§è¡Œtryä¸šåŠ¡</li></ul></li></ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ”¹é€ account-serviceï¼Œåˆ©ç”¨TCCå®ç°ä½™é¢æ‰£å‡åŠŸèƒ½ã€‚</p><h4 id="sheng-ming-tcc-jie-kou" id="å£°æ˜TCCæ¥å£">å£°æ˜TCCæ¥å£</h4><p>TCCçš„Tryã€Confirmã€Cancelæ–¹æ³•éƒ½éœ€è¦åœ¨æ¥å£ä¸­åŸºäºæ³¨è§£æ¥å£°æ˜ï¼Œ</p><p>æˆ‘ä»¬åœ¨account-serviceé¡¹ç›®ä¸­çš„<code>cn.itcast.account.service</code>åŒ…ä¸­æ–°å»ºä¸€ä¸ªæ¥å£ï¼Œå£°æ˜TCCä¸‰ä¸ªæ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.account.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.seata.rm.tcc.api.BusinessActionContext;</span><br><span class="line"><span class="keyword">import</span> io.seata.rm.tcc.api.BusinessActionContextParameter;</span><br><span class="line"><span class="keyword">import</span> io.seata.rm.tcc.api.LocalTCC;</span><br><span class="line"><span class="keyword">import</span> io.seata.rm.tcc.api.TwoPhaseBusinessAction;</span><br><span class="line"></span><br><span class="line"><span class="meta">@LocalTCC</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountTCCService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TwoPhaseBusinessAction(name = &quot;deduct&quot;, commitMethod = &quot;confirm&quot;, rollbackMethod = &quot;cancel&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deduct</span><span class="params">(<span class="meta">@BusinessActionContextParameter(paramName = &quot;userId&quot;)</span> String userId,</span></span><br><span class="line"><span class="params">                <span class="meta">@BusinessActionContextParameter(paramName = &quot;money&quot;)</span><span class="type">int</span> money)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">confirm</span><span class="params">(BusinessActionContext ctx)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">cancel</span><span class="params">(BusinessActionContext ctx)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="bian-xie-shi-xian-lei" id="ç¼–å†™å®ç°ç±»">ç¼–å†™å®ç°ç±»</h4><p>åœ¨account-serviceæœåŠ¡ä¸­çš„<code>cn.itcast.account.service.impl</code>åŒ…ä¸‹æ–°å»ºä¸€ä¸ªç±»ï¼Œå®ç°TCCä¸šåŠ¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.account.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.account.entity.AccountFreeze;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.account.mapper.AccountFreezeMapper;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.account.mapper.AccountMapper;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.account.service.AccountTCCService;</span><br><span class="line"><span class="keyword">import</span> io.seata.core.context.RootContext;</span><br><span class="line"><span class="keyword">import</span> io.seata.rm.tcc.api.BusinessActionContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> TaoYao</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> <span class="doctag">@date</span>&#125; 2023/3/19 14:36</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountTCCServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountTCCService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountFreezeMapper accountFreezeMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deduct</span><span class="params">(String userId, <span class="type">int</span> money)</span> &#123;</span><br><span class="line">        <span class="comment">// 0. è·å–äº‹åŠ¡id</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">xid</span> <span class="operator">=</span> RootContext.getXID();</span><br><span class="line">        <span class="comment">// 1. åˆ¤æ–­freezeä¸­æ˜¯å¦æœ‰å†»ç»“è®°å½•ï¼Œå¦‚æœæœ‰ï¼Œä¸€å®šæ˜¯CANCEL æ‰§è¡Œè¿‡ï¼Œæˆ‘è¦æ‹’ç»ä¸šåŠ¡</span></span><br><span class="line">        <span class="type">AccountFreeze</span> <span class="variable">oldFreeze</span> <span class="operator">=</span> accountFreezeMapper.selectById(xid);</span><br><span class="line">        <span class="keyword">if</span>(oldFreeze != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// CANCEL æ‰§è¡Œè¿‡ï¼Œæˆ‘è¦æ‹’ç»ä¸šåŠ¡</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 1. æ‰£å‡å¯ç”¨ä½™é¢</span></span><br><span class="line">        accountMapper.deduct(userId, money);</span><br><span class="line">        <span class="comment">// 2. è®°å½•å†»ç»“é‡‘é¢ï¼Œäº‹åŠ¡çŠ¶æ€</span></span><br><span class="line">        <span class="type">AccountFreeze</span> <span class="variable">accountFreeze</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountFreeze</span>();</span><br><span class="line">        accountFreeze.setUserId(userId);</span><br><span class="line">        accountFreeze.setFreezeMoney(money);</span><br><span class="line">        accountFreeze.setState(AccountFreeze.State.TRY);</span><br><span class="line">        accountFreeze.setXid(xid);</span><br><span class="line">        accountFreezeMapper.insert(accountFreeze);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">confirm</span><span class="params">(BusinessActionContext ctx)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. è·å–äº‹åŠ¡id</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">xid</span> <span class="operator">=</span> ctx.getXid();</span><br><span class="line">        <span class="comment">// 2. æ ¹æ®idåˆ é™¤å†»ç»“è®°å½•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> accountFreezeMapper.deleteById(xid);</span><br><span class="line">        <span class="keyword">return</span> i == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">cancel</span><span class="params">(BusinessActionContext ctx)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 0. æŸ¥è¯¢å†»ç»“è®°å½•</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">xid</span> <span class="operator">=</span> ctx.getXid();</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> ctx.getActionContext(<span class="string">&quot;userId&quot;</span>).toString();</span><br><span class="line">        <span class="type">AccountFreeze</span> <span class="variable">accountFreeze</span> <span class="operator">=</span> accountFreezeMapper.selectById(xid);</span><br><span class="line">        <span class="comment">// 1. ç©ºå›æ»šçš„åˆ¤æ–­ï¼Œåˆ¤æ–­freezeæ˜¯å¦ä¸ºnullï¼Œä¸ºnullè¯æ˜tryæ²¡æ‰§è¡Œï¼Œéœ€è¦ç©ºå›æ»š</span></span><br><span class="line">        <span class="keyword">if</span>(accountFreeze == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// è¯æ˜tryæ²¡æ‰§è¡Œï¼Œéœ€è¦ç©ºå›æ»š</span></span><br><span class="line">            accountFreeze = <span class="keyword">new</span> <span class="title class_">AccountFreeze</span>();</span><br><span class="line">            accountFreeze.setUserId(userId);</span><br><span class="line">            accountFreeze.setFreezeMoney(<span class="number">0</span>);</span><br><span class="line">            accountFreeze.setState(AccountFreeze.State.CANCEL);</span><br><span class="line">            accountFreeze.setXid(xid);</span><br><span class="line">            accountFreezeMapper.insert(accountFreeze);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2. å¹‚ç­‰åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span>(accountFreeze.getState() == AccountFreeze.State.CANCEL) &#123;</span><br><span class="line">            <span class="comment">// å·²ç»å¤„ç†è¿‡ä¸€æ¬¡CANCELäº†ï¼Œæ— éœ€é‡å¤å¤„ç†</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 1. æ¢å¤å¯ç”¨ä½™é¢</span></span><br><span class="line">        accountMapper.refund(accountFreeze.getUserId(), accountFreeze.getFreezeMoney());</span><br><span class="line">        <span class="comment">// 2. å°†å†»ç»“é‡‘é¢æ¸…é›¶ï¼ŒçŠ¶æ€æ”¹ä¸º cancel</span></span><br><span class="line">        accountFreeze.setFreezeMoney(<span class="number">0</span>);</span><br><span class="line">        accountFreeze.setState(AccountFreeze.State.CANCEL);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> accountFreezeMapper.updateById(accountFreeze);</span><br><span class="line">        <span class="keyword">return</span> count == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="saga-mo-shi" id="SAGAæ¨¡å¼">SAGAæ¨¡å¼</h2><p>Saga æ¨¡å¼æ˜¯ Seata å³å°†å¼€æºçš„é•¿äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œå°†ç”±èš‚èšé‡‘æœä¸»è¦è´¡çŒ®ã€‚</p><p>å…¶ç†è®ºåŸºç¡€æ˜¯Hector &amp; Kenneth  åœ¨1987å¹´å‘è¡¨çš„è®ºæ–‡<a href="https://microservices.io/patterns/data/saga.html">Sagas</a>ã€‚</p><p>Seataå®˜ç½‘å¯¹äºSagaçš„æŒ‡å—ï¼š<a href="https://seata.io/zh-cn/docs/user/saga.html">https://seata.io/zh-cn/docs/user/saga.html</a></p><h3 id="yuan-li" id="åŸç†">åŸç†</h3><p>åœ¨ Saga æ¨¡å¼ä¸‹ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å†…æœ‰å¤šä¸ªå‚ä¸è€…ï¼Œæ¯ä¸€ä¸ªå‚ä¸è€…éƒ½æ˜¯ä¸€ä¸ªå†²æ­£è¡¥å¿æœåŠ¡ï¼Œéœ€è¦ç”¨æˆ·æ ¹æ®ä¸šåŠ¡åœºæ™¯å®ç°å…¶æ­£å‘æ“ä½œå’Œé€†å‘å›æ»šæ“ä½œã€‚</p><p>åˆ†å¸ƒå¼äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¾æ¬¡æ‰§è¡Œå„å‚ä¸è€…çš„æ­£å‘æ“ä½œï¼Œå¦‚æœæ‰€æœ‰æ­£å‘æ“ä½œå‡æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆåˆ†å¸ƒå¼äº‹åŠ¡æäº¤ã€‚å¦‚æœä»»ä½•ä¸€ä¸ªæ­£å‘æ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆåˆ†å¸ƒå¼äº‹åŠ¡ä¼šå»é€€å›å»æ‰§è¡Œå‰é¢å„å‚ä¸è€…çš„é€†å‘å›æ»šæ“ä½œï¼Œå›æ»šå·²æäº¤çš„å‚ä¸è€…ï¼Œä½¿åˆ†å¸ƒå¼äº‹åŠ¡å›åˆ°åˆå§‹çŠ¶æ€ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/18/b7dbca120dd648d9aeec9edbe88be9d2" alt="image-20210724184846396"></p><p>Sagaä¹Ÿåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><ul><li>ä¸€é˜¶æ®µï¼šç›´æ¥æäº¤æœ¬åœ°äº‹åŠ¡</li><li>äºŒé˜¶æ®µï¼šæˆåŠŸåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼›å¤±è´¥åˆ™é€šè¿‡ç¼–å†™è¡¥å¿ä¸šåŠ¡æ¥å›æ»š</li></ul><h3 id="you-que-dian-3" id="ä¼˜ç¼ºç‚¹-4">ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹ï¼š</p><ul><li>äº‹åŠ¡å‚ä¸è€…å¯ä»¥åŸºäºäº‹ä»¶é©±åŠ¨å®ç°å¼‚æ­¥è°ƒç”¨ï¼Œååé«˜</li><li>ä¸€é˜¶æ®µç›´æ¥æäº¤äº‹åŠ¡ï¼Œæ— é”ï¼Œæ€§èƒ½å¥½</li><li>ä¸ç”¨ç¼–å†™TCCä¸­çš„ä¸‰ä¸ªé˜¶æ®µï¼Œå®ç°ç®€å•</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>è½¯çŠ¶æ€æŒç»­æ—¶é—´ä¸ç¡®å®šï¼Œæ—¶æ•ˆæ€§å·®</li><li>æ²¡æœ‰é”ï¼Œæ²¡æœ‰äº‹åŠ¡éš”ç¦»ï¼Œä¼šæœ‰è„å†™</li></ul><h2 id="si-chong-mo-shi-dui-bi" id="å››ç§æ¨¡å¼å¯¹æ¯”">å››ç§æ¨¡å¼å¯¹æ¯”</h2><p>æˆ‘ä»¬ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥å¯¹æ¯”å››ç§å®ç°ï¼š</p><ul><li>ä¸€è‡´æ€§ï¼šèƒ½å¦ä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Ÿå¼ºä¸€è‡´è¿˜æ˜¯æœ€ç»ˆä¸€è‡´ï¼Ÿ</li><li>éš”ç¦»æ€§ï¼šäº‹åŠ¡ä¹‹é—´çš„éš”ç¦»æ€§å¦‚ä½•ï¼Ÿ</li><li>ä»£ç ä¾µå…¥ï¼šæ˜¯å¦éœ€è¦å¯¹ä¸šåŠ¡ä»£ç æ”¹é€ ï¼Ÿ</li><li>æ€§èƒ½ï¼šæœ‰æ— æ€§èƒ½æŸè€—ï¼Ÿ</li><li>åœºæ™¯ï¼šå¸¸è§çš„ä¸šåŠ¡åœºæ™¯</li></ul><p>å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/301b0b6c16bc4703a9cb656587240537" alt="image-20210724185021819"></p><h1 id="gao-ke-yong">é«˜å¯ç”¨</h1><p>Seataçš„TCæœåŠ¡ä½œä¸ºåˆ†å¸ƒå¼äº‹åŠ¡æ ¸å¿ƒï¼Œä¸€å®šè¦ä¿è¯é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚</p><h2 id="gao-ke-yong-jia-gou-mo-xing" id="é«˜å¯ç”¨æ¶æ„æ¨¡å‹">é«˜å¯ç”¨æ¶æ„æ¨¡å‹</h2><p>æ­å»ºTCæœåŠ¡é›†ç¾¤éå¸¸ç®€å•ï¼Œå¯åŠ¨å¤šä¸ªTCæœåŠ¡ï¼Œæ³¨å†Œåˆ°nacoså³å¯ã€‚</p><p>ä½†é›†ç¾¤å¹¶ä¸èƒ½ç¡®ä¿100%å®‰å…¨ï¼Œä¸‡ä¸€é›†ç¾¤æ‰€åœ¨æœºæˆ¿æ•…éšœæ€ä¹ˆåŠï¼Ÿæ‰€ä»¥å¦‚æœè¦æ±‚è¾ƒé«˜ï¼Œä¸€èˆ¬éƒ½ä¼šåšå¼‚åœ°å¤šæœºæˆ¿å®¹ç¾ã€‚</p><p>æ¯”å¦‚ä¸€ä¸ªTCé›†ç¾¤åœ¨ä¸Šæµ·ï¼Œå¦ä¸€ä¸ªTCé›†ç¾¤åœ¨æ­å·ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/f3465b76bc8e428aa60e39be0b4e75bb" alt="image-20210724185240957"></p><p>å¾®æœåŠ¡åŸºäºäº‹åŠ¡ç»„ï¼ˆtx-service-group)ä¸TCé›†ç¾¤çš„æ˜ å°„å…³ç³»ï¼Œæ¥æŸ¥æ‰¾å½“å‰åº”è¯¥ä½¿ç”¨å“ªä¸ªTCé›†ç¾¤ã€‚å½“SHé›†ç¾¤æ•…éšœæ—¶ï¼Œåªéœ€è¦å°†vgroup-mappingä¸­çš„æ˜ å°„å…³ç³»æ”¹æˆHZã€‚åˆ™æ‰€æœ‰å¾®æœåŠ¡å°±ä¼šåˆ‡æ¢åˆ°HZçš„TCé›†ç¾¤äº†ã€‚</p><h2 id="tc-fu-wu-de-gao-ke-yong-he-yi-di-rong-zai" id="TCæœåŠ¡çš„é«˜å¯ç”¨å’Œå¼‚åœ°å®¹ç¾">TCæœåŠ¡çš„é«˜å¯ç”¨å’Œå¼‚åœ°å®¹ç¾</h2><h3 id="mo-ni-yi-di-rong-zai-de-tc-ji-qun" id="æ¨¡æ‹Ÿå¼‚åœ°å®¹ç¾çš„TCé›†ç¾¤">æ¨¡æ‹Ÿå¼‚åœ°å®¹ç¾çš„TCé›†ç¾¤</h3><p>è®¡åˆ’å¯åŠ¨ä¸¤å°seataçš„tcæœåŠ¡èŠ‚ç‚¹ï¼š</p><table><thead><tr><th>èŠ‚ç‚¹åç§°</th><th>ipåœ°å€</th><th>ç«¯å£å·</th><th>é›†ç¾¤åç§°</th></tr></thead><tbody><tr><td>seata</td><td>127.0.0.1</td><td>8091</td><td>SH</td></tr><tr><td>seata2</td><td>127.0.0.1</td><td>8092</td><td>HZ</td></tr></tbody></table><p>ä¹‹å‰æˆ‘ä»¬å·²ç»å¯åŠ¨äº†ä¸€å°seataæœåŠ¡ï¼Œç«¯å£æ˜¯8091ï¼Œé›†ç¾¤åä¸ºSHã€‚</p><p>ç°åœ¨ï¼Œå°†seataç›®å½•å¤åˆ¶ä¸€ä»½ï¼Œèµ·åä¸ºseata2</p><p>ä¿®æ”¹seata2/conf/registry.confå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">registry</span> &#123;</span><br><span class="line">  <span class="comment"># tcæœåŠ¡çš„æ³¨å†Œä¸­å¿ƒç±»ï¼Œè¿™é‡Œé€‰æ‹©nacosï¼Œä¹Ÿå¯ä»¥æ˜¯eurekaã€zookeeperç­‰</span></span><br><span class="line">  <span class="attribute">type</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line"></span><br><span class="line">  nacos &#123;</span><br><span class="line">    <span class="comment"># seata tc æœåŠ¡æ³¨å†Œåˆ° nacosçš„æœåŠ¡åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰</span></span><br><span class="line">    <span class="attribute">application</span> = <span class="string">&quot;seata-tc-server&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:8848&quot;</span></span><br><span class="line">    group = <span class="string">&quot;DEFAULT_GROUP&quot;</span></span><br><span class="line">    namespace = <span class="string">&quot;&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;HZ&quot;</span></span><br><span class="line">    username = <span class="string">&quot;nacos&quot;</span></span><br><span class="line">    password = <span class="string">&quot;nacos&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">config &#123;</span><br><span class="line">  <span class="comment"># è¯»å–tcæœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œè¿™é‡Œæ˜¯ä»nacosé…ç½®ä¸­å¿ƒè¯»å–ï¼Œè¿™æ ·å¦‚æœtcæ˜¯é›†ç¾¤ï¼Œå¯ä»¥å…±äº«é…ç½®</span></span><br><span class="line">  <span class="attribute">type</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line">  <span class="comment"># é…ç½®nacosåœ°å€ç­‰ä¿¡æ¯</span></span><br><span class="line">  nacos &#123;</span><br><span class="line">    <span class="attribute">serverAddr</span> = <span class="string">&quot;127.0.0.1:8848&quot;</span></span><br><span class="line">    namespace = <span class="string">&quot;&quot;</span></span><br><span class="line">    group = <span class="string">&quot;SEATA_GROUP&quot;</span></span><br><span class="line">    username = <span class="string">&quot;nacos&quot;</span></span><br><span class="line">    password = <span class="string">&quot;nacos&quot;</span></span><br><span class="line">    dataId = <span class="string">&quot;seataServer.properties&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›å…¥seata2/binç›®å½•ï¼Œç„¶åè¿è¡Œå‘½ä»¤ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seata<span class="literal">-server</span>.bat <span class="literal">-p</span> <span class="number">8092</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€nacosæ§åˆ¶å°ï¼ŒæŸ¥çœ‹æœåŠ¡åˆ—è¡¨ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/1483947d4e8a428fbd9225ed3c5fb974" alt="image-20210624151150840"></p><p>ç‚¹è¿›è¯¦æƒ…æŸ¥çœ‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/b7eae251891a4a108324c787e39d17b7" alt="image-20210624151221747"></p><h3 id="jiang-shi-wu-zu-ying-she-pei-zhi-dao-nacos" id="å°†äº‹åŠ¡ç»„æ˜ å°„é…ç½®åˆ°nacos">å°†äº‹åŠ¡ç»„æ˜ å°„é…ç½®åˆ°nacos</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†tx-service-groupä¸clusterçš„æ˜ å°„å…³ç³»éƒ½é…ç½®åˆ°nacosé…ç½®ä¸­å¿ƒã€‚</p><p>æ–°å»ºä¸€ä¸ªé…ç½®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/19/8aa8cb347a6346f385af1fa56be0dbb3" alt="image-20210624151507072"></p><p>é…ç½®çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># äº‹åŠ¡ç»„æ˜ å°„å…³ç³»</span></span><br><span class="line"><span class="attr">service.vgroupMapping.seata-demo</span>=<span class="string">SH</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service.enableDegrade</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">service.disableGlobalTransaction</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># ä¸TCæœåŠ¡çš„é€šä¿¡é…ç½®</span></span><br><span class="line"><span class="attr">transport.type</span>=<span class="string">TCP</span></span><br><span class="line"><span class="attr">transport.server</span>=<span class="string">NIO</span></span><br><span class="line"><span class="attr">transport.heartbeat</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">transport.enableClientBatchSendRequest</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">transport.threadFactory.bossThreadPrefix</span>=<span class="string">NettyBoss</span></span><br><span class="line"><span class="attr">transport.threadFactory.workerThreadPrefix</span>=<span class="string">NettyServerNIOWorker</span></span><br><span class="line"><span class="attr">transport.threadFactory.serverExecutorThreadPrefix</span>=<span class="string">NettyServerBizHandler</span></span><br><span class="line"><span class="attr">transport.threadFactory.shareBossWorker</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">transport.threadFactory.clientSelectorThreadPrefix</span>=<span class="string">NettyClientSelector</span></span><br><span class="line"><span class="attr">transport.threadFactory.clientSelectorThreadSize</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">transport.threadFactory.clientWorkerThreadPrefix</span>=<span class="string">NettyClientWorkerThread</span></span><br><span class="line"><span class="attr">transport.threadFactory.bossThreadSize</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">transport.threadFactory.workerThreadSize</span>=<span class="string">default</span></span><br><span class="line"><span class="attr">transport.shutdown.wait</span>=<span class="string">3</span></span><br><span class="line"><span class="comment"># RMé…ç½®</span></span><br><span class="line"><span class="attr">client.rm.asyncCommitBufferLimit</span>=<span class="string">10000</span></span><br><span class="line"><span class="attr">client.rm.lock.retryInterval</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">client.rm.lock.retryTimes</span>=<span class="string">30</span></span><br><span class="line"><span class="attr">client.rm.lock.retryPolicyBranchRollbackOnConflict</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">client.rm.reportRetryCount</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">client.rm.tableMetaCheckEnable</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">client.rm.tableMetaCheckerInterval</span>=<span class="string">60000</span></span><br><span class="line"><span class="attr">client.rm.sqlParserType</span>=<span class="string">druid</span></span><br><span class="line"><span class="attr">client.rm.reportSuccessEnable</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">client.rm.sagaBranchRegisterEnable</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># TMé…ç½®</span></span><br><span class="line"><span class="attr">client.tm.commitRetryCount</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">client.tm.rollbackRetryCount</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">client.tm.defaultGlobalTransactionTimeout</span>=<span class="string">60000</span></span><br><span class="line"><span class="attr">client.tm.degradeCheck</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">client.tm.degradeCheckAllowTimes</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">client.tm.degradeCheckPeriod</span>=<span class="string">2000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># undoæ—¥å¿—é…ç½®</span></span><br><span class="line"><span class="attr">client.undo.dataValidation</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">client.undo.logSerialization</span>=<span class="string">jackson</span></span><br><span class="line"><span class="attr">client.undo.onlyCareUpdateColumns</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">client.undo.logTable</span>=<span class="string">undo_log</span></span><br><span class="line"><span class="attr">client.undo.compress.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">client.undo.compress.type</span>=<span class="string">zip</span></span><br><span class="line"><span class="attr">client.undo.compress.threshold</span>=<span class="string">64k</span></span><br><span class="line"><span class="attr">client.log.exceptionRate</span>=<span class="string">100</span></span><br></pre></td></tr></table></figure><h3 id="wei-fu-wu-du-qu-nacos-pei-zhi" id="å¾®æœåŠ¡è¯»å–nacosé…ç½®">å¾®æœåŠ¡è¯»å–nacosé…ç½®</h3><p>æ¥ä¸‹æ¥ï¼Œéœ€è¦ä¿®æ”¹æ¯ä¸€ä¸ªå¾®æœåŠ¡çš„application.ymlæ–‡ä»¶ï¼Œè®©å¾®æœåŠ¡è¯»å–nacosä¸­çš„client.propertiesæ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">seata:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">nacos</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">group:</span> <span class="string">SEATA_GROUP</span></span><br><span class="line">      <span class="attr">data-id:</span> <span class="string">client.properties</span></span><br></pre></td></tr></table></figure><p>é‡å¯å¾®æœåŠ¡ï¼Œç°åœ¨å¾®æœåŠ¡åˆ°åº•æ˜¯è¿æ¥tcçš„SHé›†ç¾¤ï¼Œè¿˜æ˜¯tcçš„HZé›†ç¾¤ï¼Œéƒ½ç»Ÿä¸€ç”±nacosçš„client.propertiesæ¥å†³å®šäº†ã€‚</p>]]></content>
    
    
    <summary type="html">åˆ†å¸ƒå¼äº‹åŠ¡ç¬”è®°</summary>
    
    
    
    <category term="Java" scheme="https://www.taoyaopc.live/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>Java ç¯å¢ƒé…ç½®</title>
    <link href="https://www.taoyaopc.live/posts/4c8e8e1b.html"/>
    <id>https://www.taoyaopc.live/posts/4c8e8e1b.html</id>
    <published>2023-03-16T14:46:00.000Z</published>
    <updated>2023-03-21T06:15:23.633Z</updated>
    
    <content type="html"><![CDATA[<h1 id="jdk-pei-zhi-duo-ge">JDK é…ç½®å¤šä¸ª</h1><blockquote><p>å®˜ç½‘ä¸‹è½½åœ°å€ï¼š<a href="https://www.oracle.com/java/technologies/downloads/">Java Downloads | Oracle</a></p></blockquote><h2 id="xia-zai-jdk-ya-suo-bao" id="ä¸‹è½½-JDK-å‹ç¼©åŒ…">ä¸‹è½½ JDK å‹ç¼©åŒ…</h2><p><img src="https://s1.vika.cn/space/2023/03/16/90cc4e5e31694a819cf8de28523c2da4" alt="image-20230316223134345"></p><h2 id="jie-ya-dao-fei-zhong-wen-mu-lu-xia" id="è§£å‹åˆ°éä¸­æ–‡ç›®å½•ä¸‹">è§£å‹åˆ°éä¸­æ–‡ç›®å½•ä¸‹</h2><h2 id="pei-zhi-huan-jing-bian-liang" id="é…ç½®ç¯å¢ƒå˜é‡">é…ç½®ç¯å¢ƒå˜é‡</h2><ul><li>æœç´¢ç¯å¢ƒå˜é‡å¹¶æ‰“å¼€</li></ul><img src="https://s1.vika.cn/space/2023/03/16/8dd3e5d4db334fbeb6d23af18e9441e4" alt="image-20230316223836125" style="zoom:50%;" /><ul><li><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¦‚å›¾æ‰€ç¤º</p><p><img src="https://s1.vika.cn/space/2023/03/16/681dcd02d3a74216b5f59e570aca3c65" alt="image-20230316230744612"></p></li><li><p>å…¶ä¸­ <code>%JAVA_HOME?%</code> ï¼Œ ï¼Ÿä»£è¡¨é€‰æ‹©çš„jdkç‰ˆæœ¬</p></li><li><p>æ–°å¢ç³»ç»Ÿå˜é‡ <code>CLASS_PATH</code> , è¾“å…¥å†…å®¹ <code>;%JAVA_HOME%\lib\tools.jar;%JAVA_HOME%\jre\lib\dt.jar</code></p></li></ul><p><img src="https://s1.vika.cn/space/2023/03/17/c6282cbcbb5d4ef78dacf1ea9f5be568" alt="image-20230317210818606"></p><ul><li>åŒå‡»è¿›å…¥ç³»ç»Ÿå˜é‡çš„ Pathï¼Œæ·»åŠ ä»¥ä¸‹ä¸¤æ¡</li></ul><p><img src="https://s1.vika.cn/space/2023/03/17/00e8ec6bb6da49359a4042df142fb91a" alt="image-20230317210951837"></p><h2 id="wen-ti-1-wu-fa-qie-huan-jdk-ban-ben" id="é—®é¢˜1ï¼šæ— æ³•åˆ‡æ¢jdkç‰ˆæœ¬">é—®é¢˜1ï¼šæ— æ³•åˆ‡æ¢jdkç‰ˆæœ¬</h2><ul><li><p>å¦‚æœè¿˜æ˜¯æ›´æ”¹ä¸äº†JDKçš„ç‰ˆæœ¬æƒ…å†µï¼ˆæ³¨æ„ï¼Œæ¯æ¬¡æ›´æ¢ä¹‹åéƒ½è¦é‡æ–°å¼€å¯docçª—å£ï¼‰</p></li><li><p>å°†C:\Program Files\Common Files\Oracle\Java\javapathç›®å½•ä¸‹çš„java.exeã€javaw.exeã€javaws.exe åˆ é™¤ï¼Œ</p></li><li><p>å› ä¸ºå®‰è£…JDKæ—¶è‡ªåŠ¨å°†java.exeã€javaw.exeã€javaws.exeä¸‰ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°äº†C:\Program Files\Common Files\Oracle\Java\javapathç›®å½•</p></li><li><p>ç”±äºè¿™ä¸ªç›®å½•åœ¨WINDOWSç¯å¢ƒå˜é‡ä¸­çš„ä¼˜å…ˆçº§é«˜äºJAVA_HOMEè®¾ç½®çš„ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">Java ç¯å¢ƒé…ç½®</summary>
    
    
    
    <category term="Java" scheme="https://www.taoyaopc.live/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>å¾®æœåŠ¡ä¿æŠ¤</title>
    <link href="https://www.taoyaopc.live/posts/3b2912fc.html"/>
    <id>https://www.taoyaopc.live/posts/3b2912fc.html</id>
    <published>2023-03-16T05:00:00.000Z</published>
    <updated>2023-03-21T06:15:23.680Z</updated>
    
    <content type="html"><![CDATA[<h1 id="wei-fu-wu-bao-hu">å¾®æœåŠ¡ä¿æŠ¤</h1><h2 id="ben-zhang-zhu-yao-pei-zhi" id="æœ¬ç« ä¸»è¦é…ç½®">æœ¬ç« ä¸»è¦é…ç½®</h2><h3 id="nacos-fu-wu-qi-dong" id="nacos-æœåŠ¡å¯åŠ¨">nacos æœåŠ¡å¯åŠ¨</h3><h3 id="gateway-wang-guan-pei-zhi" id="Gateway-ç½‘å…³é…ç½®">Gateway ç½‘å…³é…ç½®</h3><h3 id="feign-pei-zhi" id="Feign-é…ç½®">Feign é…ç½®</h3><h3 id="wei-fu-wu-zheng-he-sentinel" id="å¾®æœåŠ¡æ•´åˆSentinel">å¾®æœåŠ¡æ•´åˆSentinel</h3><h3 id="feign-client-zheng-he-sentinel" id="FeignClient-æ•´åˆ-Sentinel">FeignClient æ•´åˆ Sentinel</h3><h3 id="jmeter-pei-zhi" id="Jmeter-é…ç½®">Jmeter é…ç½®</h3><h1 id="chu-shi-sentinel">åˆè¯†Sentinel</h1><h2 id="xue-beng-wen-ti-ji-jie-jue-fang-an" id="é›ªå´©é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ">é›ªå´©é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h2><h3 id="xue-beng-wen-ti" id="é›ªå´©é—®é¢˜">é›ªå´©é—®é¢˜</h3><p>å¾®æœåŠ¡ä¸­ï¼ŒæœåŠ¡é—´è°ƒç”¨å…³ç³»é”™ç»¼å¤æ‚ï¼Œä¸€ä¸ªå¾®æœåŠ¡å¾€å¾€ä¾èµ–äºå¤šä¸ªå…¶å®ƒå¾®æœåŠ¡ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/16/d5fc1ca5c99746798225274dcb88d04f" alt="1533829099748"></p><p>å¦‚å›¾ï¼Œå¦‚æœæœåŠ¡æä¾›è€…Iå‘ç”Ÿäº†æ•…éšœï¼Œå½“å‰çš„åº”ç”¨çš„éƒ¨åˆ†ä¸šåŠ¡å› ä¸ºä¾èµ–äºæœåŠ¡Iï¼Œå› æ­¤ä¹Ÿä¼šè¢«é˜»å¡ã€‚æ­¤æ—¶ï¼Œå…¶å®ƒä¸ä¾èµ–äºæœåŠ¡Içš„ä¸šåŠ¡ä¼¼ä¹ä¸å—å½±å“ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/16/7683a899c5664cd1912ac1297ec26f52" alt="1533829198240"></p><p>ä½†æ˜¯ï¼Œä¾èµ–æœåŠ¡Içš„ä¸šåŠ¡è¯·æ±‚è¢«é˜»å¡ï¼Œç”¨æˆ·ä¸ä¼šå¾—åˆ°å“åº”ï¼Œåˆ™tomcatçš„è¿™ä¸ªçº¿ç¨‹ä¸ä¼šé‡Šæ”¾ï¼Œäºæ˜¯è¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·è¯·æ±‚åˆ°æ¥ï¼Œè¶Šæ¥è¶Šå¤šçš„çº¿ç¨‹ä¼šé˜»å¡ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/c858be78e3254b57b4f8e328acd8442a" alt="1533829307389"></p><p>æœåŠ¡å™¨æ”¯æŒçš„çº¿ç¨‹å’Œå¹¶å‘æ•°æœ‰é™ï¼Œè¯·æ±‚ä¸€ç›´é˜»å¡ï¼Œä¼šå¯¼è‡´æœåŠ¡å™¨èµ„æºè€—å°½ï¼Œä»è€Œå¯¼è‡´æ‰€æœ‰å…¶å®ƒæœåŠ¡éƒ½ä¸å¯ç”¨ï¼Œé‚£ä¹ˆå½“å‰æœåŠ¡ä¹Ÿå°±ä¸å¯ç”¨äº†ã€‚</p><p>é‚£ä¹ˆï¼Œä¾èµ–äºå½“å‰æœåŠ¡çš„å…¶å®ƒæœåŠ¡éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæœ€ç»ˆä¹Ÿéƒ½ä¼šå˜çš„ä¸å¯ç”¨ï¼Œå½¢æˆçº§è”å¤±è´¥ï¼Œé›ªå´©å°±å‘ç”Ÿäº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/2fd18a0c35dd434bb68a671affdbfc82" alt="image-20210715172710340"></p><blockquote><p>è§£å†³é›ªå´©é—®é¢˜çš„å¸¸è§æ–¹å¼æœ‰å››ç§ï¼š</p></blockquote><h3 id="fang-an-yi-chao-shi-chu-li" id="æ–¹æ¡ˆä¸€ï¼šè¶…æ—¶å¤„ç†">æ–¹æ¡ˆä¸€ï¼šè¶…æ—¶å¤„ç†</h3><ul><li>è¶…æ—¶å¤„ç†ï¼šè®¾å®šè¶…æ—¶æ—¶é—´ï¼Œè¯·æ±‚è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰å“åº”å°±è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œä¸ä¼šæ— ä¼‘æ­¢ç­‰å¾…</li></ul><p><img src="https://s1.vika.cn/space/2023/03/16/0900eaf82c744ccab46730b1499046b9" alt="image-20210715172820438"></p><h3 id="fang-an-er-cang-bi-mo-shi" id="æ–¹æ¡ˆäºŒï¼šä»“å£æ¨¡å¼">æ–¹æ¡ˆäºŒï¼šä»“å£æ¨¡å¼</h3><p>ä»“å£æ¨¡å¼æ¥æºäºèˆ¹èˆ±çš„è®¾è®¡ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/5aef46b61b5747a79b65b334a6a4a150" alt="image-20210715172946352"></p><p>èˆ¹èˆ±éƒ½ä¼šè¢«éš”æ¿åˆ†ç¦»ä¸ºå¤šä¸ªç‹¬ç«‹ç©ºé—´ï¼Œå½“èˆ¹ä½“ç ´æŸæ—¶ï¼Œåªä¼šå¯¼è‡´éƒ¨åˆ†ç©ºé—´è¿›å…¥ï¼Œå°†æ•…éšœæ§åˆ¶åœ¨ä¸€å®šèŒƒå›´å†…ï¼Œé¿å…æ•´ä¸ªèˆ¹ä½“éƒ½è¢«æ·¹æ²¡ã€‚</p><ul><li>äºæ­¤ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥é™å®šæ¯ä¸ªä¸šåŠ¡èƒ½ä½¿ç”¨çš„çº¿ç¨‹æ•°ï¼Œé¿å…è€—å°½æ•´ä¸ªtomcatçš„èµ„æºï¼Œå› æ­¤ä¹Ÿå«<strong>çº¿ç¨‹éš”ç¦»</strong>ã€‚</li></ul><p><img src="https://s1.vika.cn/space/2023/03/16/5bf6bdbfd13d46db8261afc754a4db00" alt="image-20210715173215243"></p><h3 id="fang-an-san-duan-lu-qi" id="æ–¹æ¡ˆä¸‰ï¼šæ–­è·¯å™¨">æ–¹æ¡ˆä¸‰ï¼šæ–­è·¯å™¨</h3><ul><li><p>æ–­è·¯å™¨æ¨¡å¼ï¼šç”±<strong>æ–­è·¯å™¨</strong>ç»Ÿè®¡ä¸šåŠ¡æ‰§è¡Œçš„å¼‚å¸¸æ¯”ä¾‹ï¼Œå¦‚æœè¶…å‡ºé˜ˆå€¼åˆ™ä¼š<strong>ç†”æ–­</strong>è¯¥ä¸šåŠ¡ï¼Œæ‹¦æˆªè®¿é—®è¯¥ä¸šåŠ¡çš„ä¸€åˆ‡è¯·æ±‚ã€‚</p></li><li><p>æ–­è·¯å™¨ä¼šç»Ÿè®¡è®¿é—®æŸä¸ªæœåŠ¡çš„è¯·æ±‚æ•°é‡ï¼Œå¼‚å¸¸æ¯”ä¾‹ï¼š</p></li></ul><p><img src="https://s1.vika.cn/space/2023/03/16/8cdf4b0d5c08477eb539ee1a69ce3960" alt="image-20210715173327075"></p><p>å½“å‘ç°è®¿é—®æœåŠ¡Dçš„è¯·æ±‚å¼‚å¸¸æ¯”ä¾‹è¿‡é«˜æ—¶ï¼Œè®¤ä¸ºæœåŠ¡Dæœ‰å¯¼è‡´é›ªå´©çš„é£é™©ï¼Œä¼šæ‹¦æˆªè®¿é—®æœåŠ¡Dçš„ä¸€åˆ‡è¯·æ±‚ï¼Œå½¢æˆç†”æ–­ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/8d4546ee64b84b479715c5ff3116f843" alt="image-20210715173428073"></p><h3 id="fang-an-si-xian-liu" id="æ–¹æ¡ˆå››ï¼šé™æµ">æ–¹æ¡ˆå››ï¼šé™æµ</h3><p><strong>æµé‡æ§åˆ¶</strong>ï¼šé™åˆ¶ä¸šåŠ¡è®¿é—®çš„QPSï¼Œé¿å…æœåŠ¡å› æµé‡çš„çªå¢è€Œæ•…éšœã€‚</p><p><strong>QPS</strong>ï¼šæ¯ç§’é’Ÿå¤„ç†çš„è¯·æ±‚æ•°</p><p><img src="https://s1.vika.cn/space/2023/03/16/9a0ad33b9b444583970542d4f21e0d69" alt="image-20210715173555158"></p><h3 id="zong-jie" id="æ€»ç»“">æ€»ç»“</h3><p>ä»€ä¹ˆæ˜¯é›ªå´©é—®é¢˜ï¼Ÿ</p><ul><li>å¾®æœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨ï¼Œå› ä¸ºè°ƒç”¨é“¾ä¸­çš„ä¸€ä¸ªæœåŠ¡æ•…éšœï¼Œå¼•èµ·æ•´ä¸ªé“¾è·¯éƒ½æ— æ³•è®¿é—®çš„æƒ…å†µã€‚</li></ul><p>å¯ä»¥è®¤ä¸ºï¼š</p><ul><li><p><strong>é™æµ</strong>æ˜¯å¯¹æœåŠ¡çš„ä¿æŠ¤ï¼Œé¿å…å› ç¬é—´é«˜å¹¶å‘æµé‡è€Œå¯¼è‡´æœåŠ¡æ•…éšœï¼Œè¿›è€Œé¿å…é›ªå´©ã€‚æ˜¯ä¸€ç§<strong>é¢„é˜²</strong>æªæ–½ã€‚</p></li><li><p><strong>è¶…æ—¶å¤„ç†ã€çº¿ç¨‹éš”ç¦»ã€é™çº§ç†”æ–­</strong>æ˜¯åœ¨éƒ¨åˆ†æœåŠ¡æ•…éšœæ—¶ï¼Œå°†æ•…éšœæ§åˆ¶åœ¨ä¸€å®šèŒƒå›´ï¼Œé¿å…é›ªå´©ã€‚æ˜¯ä¸€ç§<strong>è¡¥æ•‘</strong>æªæ–½ã€‚</p></li></ul><h2 id="fu-wu-bao-hu-ji-zhu-dui-bi" id="æœåŠ¡ä¿æŠ¤æŠ€æœ¯å¯¹æ¯”">æœåŠ¡ä¿æŠ¤æŠ€æœ¯å¯¹æ¯”</h2><p>åœ¨SpringCloudå½“ä¸­æ”¯æŒå¤šç§æœåŠ¡ä¿æŠ¤æŠ€æœ¯ï¼š</p><ul><li><a href="https://github.com/Netflix/Hystrix">Netfix Hystrix</a></li><li><a href="https://github.com/alibaba/Sentinel">Sentinel</a></li><li><a href="https://github.com/resilience4j/resilience4j">Resilience4J</a></li></ul><p>æ—©æœŸæ¯”è¾ƒæµè¡Œçš„æ˜¯Hystrixæ¡†æ¶ï¼Œä½†ç›®å‰å›½å†…å®ç”¨æœ€å¹¿æ³›çš„è¿˜æ˜¯é˜¿é‡Œå·´å·´çš„Sentinelæ¡†æ¶ï¼Œè¿™é‡Œæˆ‘ä»¬åšä¸‹å¯¹æ¯”ï¼š</p><table><thead><tr><th></th><th><strong>Sentinel</strong></th><th><strong>Hystrix</strong></th></tr></thead><tbody><tr><td>éš”ç¦»ç­–ç•¥</td><td>ä¿¡å·é‡éš”ç¦»</td><td>çº¿ç¨‹æ± éš”ç¦»/ä¿¡å·é‡éš”ç¦»</td></tr><tr><td>ç†”æ–­é™çº§ç­–ç•¥</td><td>åŸºäºæ…¢è°ƒç”¨æ¯”ä¾‹æˆ–å¼‚å¸¸æ¯”ä¾‹</td><td>åŸºäºå¤±è´¥æ¯”ç‡</td></tr><tr><td>å®æ—¶æŒ‡æ ‡å®ç°</td><td>æ»‘åŠ¨çª—å£</td><td>æ»‘åŠ¨çª—å£ï¼ˆåŸºäº RxJavaï¼‰</td></tr><tr><td>è§„åˆ™é…ç½®</td><td>æ”¯æŒå¤šç§æ•°æ®æº</td><td>æ”¯æŒå¤šç§æ•°æ®æº</td></tr><tr><td>æ‰©å±•æ€§</td><td>å¤šä¸ªæ‰©å±•ç‚¹</td><td>æ’ä»¶çš„å½¢å¼</td></tr><tr><td>åŸºäºæ³¨è§£çš„æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>é™æµ</td><td>åŸºäº QPSï¼Œæ”¯æŒåŸºäºè°ƒç”¨å…³ç³»çš„é™æµ</td><td>æœ‰é™çš„æ”¯æŒ</td></tr><tr><td>æµé‡æ•´å½¢</td><td>æ”¯æŒæ…¢å¯åŠ¨ã€åŒ€é€Ÿæ’é˜Ÿæ¨¡å¼</td><td>ä¸æ”¯æŒ</td></tr><tr><td>ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>æ§åˆ¶å°</td><td>å¼€ç®±å³ç”¨ï¼Œå¯é…ç½®è§„åˆ™ã€æŸ¥çœ‹ç§’çº§ç›‘æ§ã€æœºå™¨å‘ç°ç­‰</td><td>ä¸å®Œå–„</td></tr><tr><td>å¸¸è§æ¡†æ¶çš„é€‚é…</td><td>Servletã€Spring Cloudã€Dubboã€gRPC  ç­‰</td><td>Servletã€Spring Cloud Netflix</td></tr></tbody></table><h2 id="sentinel-jie-shao-he-an-zhuang" id="Sentinelä»‹ç»å’Œå®‰è£…">Sentinelä»‹ç»å’Œå®‰è£…</h2><h3 id="chu-shi-sentinel-1" id="åˆè¯†Sentinel">åˆè¯†Sentinel</h3><p>Sentinelæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾å¾®æœåŠ¡æµé‡æ§åˆ¶ç»„ä»¶ã€‚å®˜ç½‘åœ°å€ï¼š<a href="https://sentinelguard.io/zh-cn/index.html">https://sentinelguard.io/zh-cn/index.html</a></p><p>Sentinel å…·æœ‰ä»¥ä¸‹ç‰¹å¾:</p><ul><li><p><strong>ä¸°å¯Œçš„åº”ç”¨åœºæ™¯</strong>ï¼šSentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿‘ 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ï¼ˆå³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´ï¼‰ã€æ¶ˆæ¯å‰Šå³°å¡«è°·ã€é›†ç¾¤æµé‡æ§åˆ¶ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚</p></li><li><p><strong>å®Œå¤‡çš„å®æ—¶ç›‘æ§</strong>ï¼šSentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°æœºå™¨ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µã€‚</p></li><li><p><strong>å¹¿æ³›çš„å¼€æºç”Ÿæ€</strong>ï¼šSentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶/åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring Cloudã€Dubboã€gRPC çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿›è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿåœ°æ¥å…¥ Sentinelã€‚</p></li><li><p><strong>å®Œå–„çš„</strong> <strong>SPI</strong> <strong>æ‰©å±•ç‚¹</strong>ï¼šSentinel æä¾›ç®€å•æ˜“ç”¨ã€å®Œå–„çš„ SPI æ‰©å±•æ¥å£ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿåœ°å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ã€é€‚é…åŠ¨æ€æ•°æ®æºç­‰ã€‚</p></li></ul><h3 id="an-zhuang-sentinel" id="å®‰è£…Sentinel">å®‰è£…Sentinel</h3><ol><li>ä¸‹è½½</li></ol><p>sentinelå®˜æ–¹æä¾›äº†UIæ§åˆ¶å°ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹ç³»ç»Ÿåšé™æµè®¾ç½®ã€‚å¤§å®¶å¯ä»¥åœ¨<a href="https://github.com/alibaba/Sentinel/releases">GitHub</a>ä¸‹è½½ã€‚</p><p>è¯¾å‰èµ„æ–™ä¹Ÿæä¾›äº†ä¸‹è½½å¥½çš„jaråŒ…ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/a181b11c7f484a2ea10fe8f905ae632f" alt="image-20210715174252531"></p><ol start="2"><li>è¿è¡Œ</li></ol><p>å°†jaråŒ…æ”¾åˆ°ä»»æ„éä¸­æ–‡ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p><blockquote><p>ç”±äºjdk ç‰ˆæœ¬è¿‡é«˜ï¼Œå¯åŠ¨ä¼šæŠ¥é”™æ•…æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p></blockquote><p>é«˜ç‰ˆæœ¬jdkï¼šæ›´æ”¹å¯åŠ¨å‘½ä»¤ï¼Œæ‰“å¼€ç‰¹å®šçš„åŒ…è£…è¿›è¡Œåå°„ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java --add-opens java.base/java.lang=ALL-UNNAMED -jar sentinel-dashboard-1.8.1.jar</span><br></pre></td></tr></table></figure><p>ä½ç‰ˆæœ¬jdkï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar sentinel-dashboard-1.8.1.jar</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦ä¿®æ”¹Sentinelçš„é»˜è®¤ç«¯å£ã€è´¦æˆ·ã€å¯†ç ï¼Œå¯ä»¥é€šè¿‡ä¸‹åˆ—é…ç½®ï¼š</p><table><thead><tr><th><strong>é…ç½®é¡¹</strong></th><th><strong>é»˜è®¤å€¼</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>server.port</td><td>8080</td><td>æœåŠ¡ç«¯å£</td></tr><tr><td>sentinel.dashboard.auth.username</td><td>sentinel</td><td>é»˜è®¤ç”¨æˆ·å</td></tr><tr><td>sentinel.dashboard.auth.password</td><td>sentinel</td><td>é»˜è®¤å¯†ç </td></tr></tbody></table><p>ä¾‹å¦‚ï¼Œä¿®æ”¹ç«¯å£ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Dserver.port=8090 -jar sentinel-dashboard-1.8.1.jar</span><br></pre></td></tr></table></figure><ol start="3"><li>è®¿é—®</li></ol><p>è®¿é—®http://localhost:8080é¡µé¢ï¼Œå°±å¯ä»¥çœ‹åˆ°sentinelçš„æ§åˆ¶å°äº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/3e02f80bac4540ecad07e112963e5096" alt="image-20210715190827846"></p><p>éœ€è¦è¾“å…¥è´¦å·å’Œå¯†ç ï¼Œé»˜è®¤éƒ½æ˜¯ï¼šsentinel</p><p>ç™»å½•åï¼Œå‘ç°ä¸€ç‰‡ç©ºç™½ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/2f076945128a4a0e86c23b942ad3723b" alt="image-20210715191134448"></p><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ä¸å¾®æœåŠ¡æ•´åˆã€‚</p><h2 id="wei-fu-wu-zheng-he-sentinel-1" id="å¾®æœåŠ¡æ•´åˆSentinel-2">å¾®æœåŠ¡æ•´åˆSentinel</h2><p>æˆ‘ä»¬åœ¨order-serviceä¸­æ•´åˆsentinelï¼Œå¹¶è¿æ¥sentinelçš„æ§åˆ¶å°ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å¼•å…¥sentinelä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--sentinel--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½®æ§åˆ¶å°</li></ol><p>ä¿®æ”¹application.yamlæ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8088</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span> </span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span></span><br></pre></td></tr></table></figure><ol start="3"><li>è®¿é—®order-serviceçš„ä»»æ„ç«¯ç‚¹</li></ol><p>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®http://localhost:8088/order/101ï¼Œè¿™æ ·æ‰èƒ½è§¦å‘sentinelçš„ç›‘æ§ã€‚</p><p>ç„¶åå†è®¿é—®sentinelçš„æ§åˆ¶å°ï¼ŒæŸ¥çœ‹æ•ˆæœï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/8b5f4a4fd6a64d19bfab35203c65e894" alt="image-20210715191241799"></p><h1 id="jmeter-kuai-su-ru-men">Jmeterå¿«é€Ÿå…¥é—¨</h1><h2 id="an-zhuang-jmeter" id="å®‰è£…Jmeter">å®‰è£…Jmeter</h2><p>Jmeterä¾èµ–äºJDKï¼Œæ‰€ä»¥å¿…é¡»ç¡®ä¿å½“å‰è®¡ç®—æœºä¸Šå·²ç»å®‰è£…äº†JDKï¼Œå¹¶ä¸”é…ç½®äº†ç¯å¢ƒå˜é‡ã€‚</p><h2 id="xia-zai" id="ä¸‹è½½">ä¸‹è½½</h2><p>å¯ä»¥Apache Jmeterå®˜ç½‘ä¸‹è½½ï¼Œåœ°å€ï¼š<a href="http://jmeter.apache.org/download_jmeter.cgi">http://jmeter.apache.org/download_jmeter.cgi</a></p><p><img src="https://s1.vika.cn/space/2023/03/16/54799d3764054de78ed1130aac448f16" alt="image-20210715193149837"></p><p>å½“ç„¶ï¼Œæˆ‘ä»¬è¯¾å‰èµ„æ–™ä¹Ÿæä¾›äº†ä¸‹è½½å¥½çš„å®‰è£…åŒ…ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/258731e4d8f847c5858f62110a91b4b7" alt="image-20210715193224094"></p><h2 id="jie-ya" id="è§£å‹">è§£å‹</h2><p>å› ä¸ºä¸‹è½½çš„æ˜¯zipåŒ…ï¼Œè§£å‹ç¼©å³å¯ä½¿ç”¨ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/9cc4068babf94dbe9340010b2ce3cd09" alt="image-20210715193334367"></p><p>å…¶ä¸­çš„binç›®å½•å°±æ˜¯æ‰§è¡Œçš„è„šæœ¬ï¼Œå…¶ä¸­åŒ…å«å¯åŠ¨è„šæœ¬ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/2ee2aa6aa83749d9bb414c00a5616175" alt="image-20210715193414601"></p><h3 id="yun-xing" id="è¿è¡Œ">è¿è¡Œ</h3><p>åŒå‡»å³å¯è¿è¡Œï¼Œä½†æ˜¯æœ‰ä¸¤ç‚¹æ³¨æ„ï¼š</p><ul><li>å¯åŠ¨é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œè¦è€å¿ƒç­‰å¾…</li><li>å¯åŠ¨åé»‘çª—å£ä¸èƒ½å…³é—­ï¼Œå¦åˆ™Jmeterä¹Ÿè·Ÿç€å…³é—­äº†</li></ul><p><img src="https://s1.vika.cn/space/2023/03/16/aeebcfc0c4834dd48ee385a6c512928c" alt="image-20210715193730096"></p><h2 id="kuai-su-ru-men" id="å¿«é€Ÿå…¥é—¨">å¿«é€Ÿå…¥é—¨</h2><h3 id="she-zhi-zhong-wen-yu-yan" id="è®¾ç½®ä¸­æ–‡è¯­è¨€">è®¾ç½®ä¸­æ–‡è¯­è¨€</h3><p>é»˜è®¤Jmeterçš„è¯­è¨€æ˜¯è‹±æ–‡ï¼Œéœ€è¦è®¾ç½®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/c97f175d06d949bc87c78aaabb315579" alt="image-20210715193838719"></p><p>æ•ˆæœï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/a460663fb3a64674980ca4ceee827080" alt="image-20210715193914039"></p><blockquote><p><strong>æ³¨æ„</strong>ï¼šä¸Šé¢çš„é…ç½®åªèƒ½ä¿è¯æœ¬æ¬¡è¿è¡Œæ˜¯ä¸­æ–‡ï¼Œå¦‚æœè¦æ°¸ä¹…ä¸­æ–‡ï¼Œéœ€è¦ä¿®æ”¹Jmeterçš„é…ç½®æ–‡ä»¶</p></blockquote><p>æ‰“å¼€jmeteræ–‡ä»¶å¤¹ï¼Œåœ¨binç›®å½•ä¸­æ‰¾åˆ° <strong>jmeter.properties</strong>ï¼Œæ·»åŠ ä¸‹é¢é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">language</span>=<span class="string">zh_CN</span></span><br></pre></td></tr></table></figure><p><img src="https://s1.vika.cn/space/2023/03/16/b5d2120cde554a93959c6fe90a96b8ac" alt="image-20210715194137982"></p><blockquote><p>æ³¨æ„ï¼šå‰é¢ä¸è¦å‡ºç°#ï¼Œ#ä»£è¡¨æ³¨é‡Šï¼Œå¦å¤–è¿™é‡Œæ˜¯ä¸‹åˆ’çº¿ï¼Œä¸æ˜¯ä¸­åˆ’çº¿</p></blockquote><h2 id="ji-ben-yong-fa" id="åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</h2><p>åœ¨æµ‹è¯•è®¡åˆ’ä¸Šç‚¹é¼ æ ‡å³é”®ï¼Œé€‰æ‹©æ·»åŠ  &gt; çº¿ç¨‹ï¼ˆç”¨æˆ·ï¼‰ &gt; çº¿ç¨‹ç»„ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/11aec9e99430435dbcfe70101ed52110" alt="image-20210715194413178"></p><p>åœ¨æ–°å¢çš„çº¿ç¨‹ç»„ä¸­ï¼Œå¡«å†™çº¿ç¨‹ä¿¡æ¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/e310c4928bf64d1688d398564b9d146f" alt="image-20210715195053807"></p><p>ç»™çº¿ç¨‹ç»„ç‚¹é¼ æ ‡å³é”®ï¼Œæ·»åŠ httpå–æ ·å™¨ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/e44be110558048af91a399c15e122f1a" alt="image-20210715195144130"></p><p>ç¼–å†™å–æ ·å™¨å†…å®¹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/47819c554c864c009807869f44970175" alt="image-20210715195410764"></p><p>æ·»åŠ ç›‘å¬æŠ¥å‘Šï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/e8f3d57051d0469a963a9c03231e88ea" alt="image-20210715195844978"></p><p>æ·»åŠ ç›‘å¬ç»“æœæ ‘ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/3082812cabd240c188f4aa8060c947ea" alt="image-20210715200155537"></p><p>æ±‡æ€»æŠ¥å‘Šç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/5e504e6e3e73429583a6833d124949c9" alt="image-20210715200243194"></p><p>ç»“æœæ ‘ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/dd336a55db784397907f87d887886321" alt="image-20210715200336526"></p><h1 id="liu-liang-kong-zhi">æµé‡æ§åˆ¶</h1><p>é›ªå´©é—®é¢˜è™½ç„¶æœ‰å››ç§æ–¹æ¡ˆï¼Œä½†æ˜¯é™æµæ˜¯é¿å…æœåŠ¡å› çªå‘çš„æµé‡è€Œå‘ç”Ÿæ•…éšœï¼Œæ˜¯å¯¹å¾®æœåŠ¡é›ªå´©é—®é¢˜çš„é¢„é˜²ã€‚æˆ‘ä»¬å…ˆå­¦ä¹ è¿™ç§æ¨¡å¼ã€‚</p><h2 id="cu-dian-lian-lu" id="ç°‡ç‚¹é“¾è·¯">ç°‡ç‚¹é“¾è·¯</h2><p>å½“è¯·æ±‚è¿›å…¥å¾®æœåŠ¡æ—¶ï¼Œé¦–å…ˆä¼šè®¿é—®DispatcherServletï¼Œç„¶åè¿›å…¥Controllerã€Serviceã€Mapperï¼Œè¿™æ ·çš„ä¸€ä¸ªè°ƒç”¨é“¾å°±å«åš<strong>ç°‡ç‚¹é“¾è·¯</strong>ã€‚ç°‡ç‚¹é“¾è·¯ä¸­è¢«ç›‘æ§çš„æ¯ä¸€ä¸ªæ¥å£å°±æ˜¯ä¸€ä¸ª<strong>èµ„æº</strong>ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹sentinelä¼šç›‘æ§SpringMVCçš„æ¯ä¸€ä¸ªç«¯ç‚¹ï¼ˆEndpointï¼Œä¹Ÿå°±æ˜¯controllerä¸­çš„æ–¹æ³•ï¼‰ï¼Œå› æ­¤SpringMVCçš„æ¯ä¸€ä¸ªç«¯ç‚¹ï¼ˆEndpointï¼‰å°±æ˜¯è°ƒç”¨é“¾è·¯ä¸­çš„ä¸€ä¸ªèµ„æºã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åˆšæ‰è®¿é—®çš„order-serviceä¸­çš„OrderControllerä¸­çš„ç«¯ç‚¹ï¼š/order/{orderId}</p><p><img src="https://s1.vika.cn/space/2023/03/16/4c4c9e21886747dfabaa23b01daa5726" alt="image-20210715191757319"></p><p>æµæ§ã€ç†”æ–­ç­‰éƒ½æ˜¯é’ˆå¯¹ç°‡ç‚¹é“¾è·¯ä¸­çš„èµ„æºæ¥è®¾ç½®çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç‚¹å‡»å¯¹åº”èµ„æºåé¢çš„æŒ‰é’®æ¥è®¾ç½®è§„åˆ™ï¼š</p><ul><li>æµæ§ï¼šæµé‡æ§åˆ¶</li><li>é™çº§ï¼šé™çº§ç†”æ–­</li><li>çƒ­ç‚¹ï¼šçƒ­ç‚¹å‚æ•°é™æµï¼Œæ˜¯é™æµçš„ä¸€ç§</li><li>æˆæƒï¼šè¯·æ±‚çš„æƒé™æ§åˆ¶</li></ul><h2 id="kuai-su-ru-men-1" id="å¿«é€Ÿå…¥é—¨-2">å¿«é€Ÿå…¥é—¨</h2><h3 id="shi-li" id="ç¤ºä¾‹">ç¤ºä¾‹</h3><p>ç‚¹å‡»èµ„æº/order/{orderId}åé¢çš„æµæ§æŒ‰é’®ï¼Œå°±å¯ä»¥å¼¹å‡ºè¡¨å•ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/16/4c4c9e21886747dfabaa23b01daa5726" alt="image-20210715191757319"></p><p>è¡¨å•ä¸­å¯ä»¥å¡«å†™é™æµè§„åˆ™ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/db76ca0e128e46048a2e1f7edebcb32f" alt="image-20210715192010657"></p><p>å…¶å«ä¹‰æ˜¯é™åˆ¶ /order/{orderId}è¿™ä¸ªèµ„æºçš„å•æœºQPSä¸º1ï¼Œå³æ¯ç§’åªå…è®¸1æ¬¡è¯·æ±‚ï¼Œè¶…å‡ºçš„è¯·æ±‚ä¼šè¢«æ‹¦æˆªå¹¶æŠ¥é”™ã€‚</p><h3 id="lian-xi" id="ç»ƒä¹ ï¼š">ç»ƒä¹ ï¼š</h3><blockquote><p>éœ€æ±‚ï¼šç»™ /order/{orderId}è¿™ä¸ªèµ„æºè®¾ç½®æµæ§è§„åˆ™ï¼ŒQPSä¸èƒ½è¶…è¿‡ 5ï¼Œç„¶åæµ‹è¯•ã€‚</p></blockquote><ol><li>é¦–å…ˆåœ¨sentinelæ§åˆ¶å°æ·»åŠ é™æµè§„åˆ™</li></ol><p><img src="assets/image-20210715192455429.png" alt="image-20210715192455429"></p><ol start="2"><li>åˆ©ç”¨jmeteræµ‹è¯•</li></ol><p>å¦‚æœæ²¡æœ‰ç”¨è¿‡jmeterï¼Œå¯ä»¥å‚è€ƒè¯¾å‰èµ„æ–™æä¾›çš„æ–‡æ¡£ã€Š<a href="http://xn--Jmeter-8l2jo37gfx4ggdm.md">Jmeterå¿«é€Ÿå…¥é—¨.md</a>ã€‹</p><p>è¯¾å‰èµ„æ–™æä¾›äº†ç¼–å†™å¥½çš„Jmeteræµ‹è¯•æ ·ä¾‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/f924658cc59d47aaad1472300aacf660" alt="image-20210715200431615"></p><p>æ‰“å¼€jmeterï¼Œå¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„æµ‹è¯•æ ·ä¾‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/6eaf0db898e443b3994ac9b43f503bd3" alt="image-20210715200537171"></p><p>é€‰æ‹©ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/a4e05494f4b64e5f88aa3300ec66725a" alt="image-20210715200635414"></p><p>20ä¸ªç”¨æˆ·ï¼Œ2ç§’å†…è¿è¡Œå®Œï¼ŒQPSæ˜¯10ï¼Œè¶…è¿‡äº†5.</p><p>é€‰ä¸­<code>æµæ§å…¥é—¨ï¼ŒQPS&lt;5</code>å³é”®è¿è¡Œï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/ea7e06a41a90465995bdf743dc99c051" alt="image-20210715200804594"></p><blockquote><p>æ³¨æ„ï¼Œä¸è¦ç‚¹å‡»èœå•ä¸­çš„æ‰§è¡ŒæŒ‰é’®æ¥è¿è¡Œã€‚</p></blockquote><p>ç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/89b0f196bb7b4c55889c7d9e49891abf" alt="image-20210715200853671"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒæˆåŠŸçš„è¯·æ±‚æ¯æ¬¡åªæœ‰5ä¸ª</p><h2 id="liu-kong-mo-shi" id="æµæ§æ¨¡å¼">æµæ§æ¨¡å¼</h2><p>åœ¨æ·»åŠ é™æµè§„åˆ™æ—¶ï¼Œç‚¹å‡»é«˜çº§é€‰é¡¹ï¼Œå¯ä»¥é€‰æ‹©ä¸‰ç§<strong>æµæ§æ¨¡å¼</strong>ï¼š</p><ul><li>ç›´æ¥ï¼šç»Ÿè®¡å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶å¯¹å½“å‰èµ„æºç›´æ¥é™æµï¼Œä¹Ÿæ˜¯é»˜è®¤çš„æ¨¡å¼</li><li>å…³è”ï¼šç»Ÿè®¡ä¸å½“å‰èµ„æºç›¸å…³çš„å¦ä¸€ä¸ªèµ„æºï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹å½“å‰èµ„æºé™æµ</li><li>é“¾è·¯ï¼šç»Ÿè®¡ä»æŒ‡å®šé“¾è·¯è®¿é—®åˆ°æœ¬èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹æŒ‡å®šé“¾è·¯é™æµ</li></ul><p><img src="https://s1.vika.cn/space/2023/03/16/d29c5b6b4b034ee2afc151bbe9eafa7c" alt="image-20210715201827886"></p><p>å¿«é€Ÿå…¥é—¨æµ‹è¯•çš„å°±æ˜¯ç›´æ¥æ¨¡å¼ã€‚</p><h3 id="guan-lian-mo-shi" id="å…³è”æ¨¡å¼">å…³è”æ¨¡å¼</h3><blockquote><p><strong>å…³è”æ¨¡å¼</strong>ï¼šç»Ÿè®¡ä¸å½“å‰èµ„æºç›¸å…³çš„å¦ä¸€ä¸ªèµ„æºï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹å½“å‰èµ„æºé™æµ</p></blockquote><p><strong>é…ç½®è§„åˆ™</strong>ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/8dc0e0b1635c49caac94d48831295f4d" alt="image-20210715202540786"></p><p><strong>è¯­æ³•è¯´æ˜</strong>ï¼šå½“/writeèµ„æºè®¿é—®é‡è§¦å‘é˜ˆå€¼æ—¶ï¼Œå°±ä¼šå¯¹/readèµ„æºé™æµï¼Œé¿å…å½±å“/writeèµ„æºã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šæ¯”å¦‚ç”¨æˆ·æ”¯ä»˜æ—¶éœ€è¦ä¿®æ”¹è®¢å•çŠ¶æ€ï¼ŒåŒæ—¶ç”¨æˆ·è¦æŸ¥è¯¢è®¢å•ã€‚æŸ¥è¯¢å’Œä¿®æ”¹æ“ä½œä¼šäº‰æŠ¢æ•°æ®åº“é”ï¼Œäº§ç”Ÿç«äº‰ã€‚ä¸šåŠ¡éœ€æ±‚æ˜¯ä¼˜å…ˆæ”¯ä»˜å’Œæ›´æ–°è®¢å•çš„ä¸šåŠ¡ï¼Œå› æ­¤å½“ä¿®æ”¹è®¢å•ä¸šåŠ¡è§¦å‘é˜ˆå€¼æ—¶ï¼Œéœ€è¦å¯¹æŸ¥è¯¢è®¢å•ä¸šåŠ¡é™æµã€‚</p><blockquote><p><strong>éœ€æ±‚è¯´æ˜</strong>ï¼š</p><ul><li><p>åœ¨OrderControlleræ–°å»ºä¸¤ä¸ªç«¯ç‚¹ï¼š/order/queryå’Œ/order/updateï¼Œæ— éœ€å®ç°ä¸šåŠ¡</p></li><li><p>é…ç½®æµæ§è§„åˆ™ï¼Œå½“/order/ updateèµ„æºè¢«è®¿é—®çš„QPSè¶…è¿‡5æ—¶ï¼Œå¯¹/order/queryè¯·æ±‚é™æµ</p></li></ul></blockquote><ol><li>å®šä¹‰/order/queryç«¯ç‚¹ï¼Œæ¨¡æ‹Ÿè®¢å•æŸ¥è¯¢</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/query&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">queryOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æŸ¥è¯¢è®¢å•æˆåŠŸ&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å®šä¹‰/order/updateç«¯ç‚¹ï¼Œæ¨¡æ‹Ÿè®¢å•æ›´æ–°</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/update&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">updateOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æ›´æ–°è®¢å•æˆåŠŸ&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡ï¼ŒæŸ¥çœ‹sentinelæ§åˆ¶å°çš„ç°‡ç‚¹é“¾è·¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/30157ce99570450c8d70ef3aac7f1ead" alt="image-20210716101805951"></p><ol start="3"><li>é…ç½®æµæ§è§„åˆ™</li></ol><p>å¯¹å“ªä¸ªç«¯ç‚¹é™æµï¼Œå°±ç‚¹å‡»å“ªä¸ªç«¯ç‚¹åé¢çš„æŒ‰é’®ã€‚æˆ‘ä»¬æ˜¯å¯¹è®¢å•æŸ¥è¯¢/order/queryé™æµï¼Œå› æ­¤ç‚¹å‡»å®ƒåé¢çš„æŒ‰é’®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/9c2237af30cd4bb3b42f7314f2ff9f02" alt="image-20210716101934499"></p><p>åœ¨è¡¨å•ä¸­å¡«å†™æµæ§è§„åˆ™ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/e182d4483260420db4b13315bfa494ae" alt="image-20210716102103814"></p><ol start="4"><li>åœ¨Jmeteræµ‹è¯•</li></ol><p>é€‰æ‹©ã€Šæµæ§æ¨¡å¼-å…³è”ã€‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/78817f88cdbe41caa6f5b2d113fe3e6d" alt="image-20210716102416266"></p><p>å¯ä»¥çœ‹åˆ°1000ä¸ªç”¨æˆ·ï¼Œ100ç§’ï¼Œå› æ­¤QPSä¸º10ï¼Œè¶…è¿‡äº†æˆ‘ä»¬è®¾å®šçš„é˜ˆå€¼ï¼š5</p><p>æŸ¥çœ‹httpè¯·æ±‚ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/758f7d1575f147d38262cd0653350c5b" alt="image-20210716102532554"></p><p>è¯·æ±‚çš„ç›®æ ‡æ˜¯/order/updateï¼Œè¿™æ ·è¿™ä¸ªæ–­ç‚¹å°±ä¼šè§¦å‘é˜ˆå€¼ã€‚</p><p>ä½†é™æµçš„ç›®æ ‡æ˜¯/order/queryï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨è®¿é—®ï¼Œå¯ä»¥å‘ç°ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/8e9decab20444398b8c9b2056dbcdc40" alt="image-20210716102636030"></p><p>ç¡®å®è¢«é™æµäº†ã€‚</p><ol start="5"><li>æ€»ç»“</li></ol><p><img src="https://s1.vika.cn/space/2023/03/16/5670231ba71e46eab9d3df2ab40ac49d" alt="image-20210716103143002"></p><h3 id="lian-lu-mo-shi" id="é“¾è·¯æ¨¡å¼">é“¾è·¯æ¨¡å¼</h3><p><strong>é“¾è·¯æ¨¡å¼</strong>ï¼šåªé’ˆå¯¹ä»æŒ‡å®šé“¾è·¯è®¿é—®åˆ°æœ¬èµ„æºçš„è¯·æ±‚åšç»Ÿè®¡ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼ã€‚</p><p><strong>é…ç½®ç¤ºä¾‹</strong>ï¼š</p><p>ä¾‹å¦‚æœ‰ä¸¤æ¡è¯·æ±‚é“¾è·¯ï¼š</p><ul><li><p>/test1 --&gt; /common</p></li><li><p>/test2 --&gt; /common</p></li></ul><p>å¦‚æœåªå¸Œæœ›ç»Ÿè®¡ä»/test2è¿›å…¥åˆ°/commonçš„è¯·æ±‚ï¼Œåˆ™å¯ä»¥è¿™æ ·é…ç½®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/f65276d6db9841e994d3f73949bca332" alt="image-20210716103536346"></p><p><strong>å®æˆ˜æ¡ˆä¾‹</strong></p><blockquote><p>éœ€æ±‚ï¼šæœ‰æŸ¥è¯¢è®¢å•å’Œåˆ›å»ºè®¢å•ä¸šåŠ¡ï¼Œä¸¤è€…éƒ½éœ€è¦æŸ¥è¯¢å•†å“ã€‚é’ˆå¯¹ä»æŸ¥è¯¢è®¢å•è¿›å…¥åˆ°æŸ¥è¯¢å•†å“çš„è¯·æ±‚ç»Ÿè®¡ï¼Œå¹¶è®¾ç½®é™æµã€‚</p><p>æ­¥éª¤ï¼š</p><ol><li><p>åœ¨OrderServiceä¸­æ·»åŠ ä¸€ä¸ªqueryGoodsæ–¹æ³•ï¼Œä¸ç”¨å®ç°ä¸šåŠ¡</p></li><li><p>åœ¨OrderControllerä¸­ï¼Œæ”¹é€ /order/queryç«¯ç‚¹ï¼Œè°ƒç”¨OrderServiceä¸­çš„queryGoodsæ–¹æ³•</p></li><li><p>åœ¨OrderControllerä¸­æ·»åŠ ä¸€ä¸ª/order/saveçš„ç«¯ç‚¹ï¼Œè°ƒç”¨OrderServiceçš„queryGoodsæ–¹æ³•</p></li><li><p>ç»™queryGoodsè®¾ç½®é™æµè§„åˆ™ï¼Œä»/order/queryè¿›å…¥queryGoodsçš„æ–¹æ³•é™åˆ¶QPSå¿…é¡»å°äº2</p></li></ol></blockquote><p>å®ç°ï¼š</p><h4 id="tian-jia-cha-xun-shang-pin-fang-fa" id="æ·»åŠ æŸ¥è¯¢å•†å“æ–¹æ³•">æ·»åŠ æŸ¥è¯¢å•†å“æ–¹æ³•</h4><p>åœ¨order-serviceæœåŠ¡ä¸­ï¼Œç»™OrderServiceç±»æ·»åŠ ä¸€ä¸ªqueryGoodsæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryGoods</span><span class="params">()</span>&#123;</span><br><span class="line">    System.err.println(<span class="string">&quot;æŸ¥è¯¢å•†å“&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="cha-xun-ding-dan-shi-cha-xun-shang-pin" id="æŸ¥è¯¢è®¢å•æ—¶ï¼ŒæŸ¥è¯¢å•†å“">æŸ¥è¯¢è®¢å•æ—¶ï¼ŒæŸ¥è¯¢å•†å“</h4><p>åœ¨order-serviceçš„OrderControllerä¸­ï¼Œä¿®æ”¹/order/queryç«¯ç‚¹çš„ä¸šåŠ¡é€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/query&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">queryOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢å•†å“</span></span><br><span class="line">    orderService.queryGoods();</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢è®¢å•</span></span><br><span class="line">    System.out.println(<span class="string">&quot;æŸ¥è¯¢è®¢å•&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æŸ¥è¯¢è®¢å•æˆåŠŸ&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="xin-zeng-ding-dan-cha-xun-shang-pin" id="æ–°å¢è®¢å•ï¼ŒæŸ¥è¯¢å•†å“">æ–°å¢è®¢å•ï¼ŒæŸ¥è¯¢å•†å“</h4><p>åœ¨order-serviceçš„OrderControllerä¸­ï¼Œä¿®æ”¹/order/saveç«¯ç‚¹ï¼Œæ¨¡æ‹Ÿæ–°å¢è®¢å•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">saveOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢å•†å“</span></span><br><span class="line">    orderService.queryGoods();</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢è®¢å•</span></span><br><span class="line">    System.err.println(<span class="string">&quot;æ–°å¢è®¢å•&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æ–°å¢è®¢å•æˆåŠŸ&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="gei-cha-xun-shang-pin-tian-jia-zi-yuan-biao-ji" id="ç»™æŸ¥è¯¢å•†å“æ·»åŠ èµ„æºæ ‡è®°">ç»™æŸ¥è¯¢å•†å“æ·»åŠ èµ„æºæ ‡è®°</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒOrderServiceä¸­çš„æ–¹æ³•æ˜¯ä¸è¢«Sentinelç›‘æ§çš„ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±é€šè¿‡æ³¨è§£æ¥æ ‡è®°è¦ç›‘æ§çš„æ–¹æ³•ã€‚</p><p>ç»™OrderServiceçš„queryGoodsæ–¹æ³•æ·»åŠ @SentinelResourceæ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SentinelResource(&quot;goods&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryGoods</span><span class="params">()</span>&#123;</span><br><span class="line">    System.err.println(<span class="string">&quot;æŸ¥è¯¢å•†å“&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é“¾è·¯æ¨¡å¼ä¸­ï¼Œæ˜¯å¯¹ä¸åŒæ¥æºçš„ä¸¤ä¸ªé“¾è·¯åšç›‘æ§ã€‚ä½†æ˜¯sentinelé»˜è®¤ä¼šç»™è¿›å…¥SpringMVCçš„æ‰€æœ‰è¯·æ±‚è®¾ç½®åŒä¸€ä¸ªrootèµ„æºï¼Œä¼šå¯¼è‡´é“¾è·¯æ¨¡å¼å¤±æ•ˆã€‚</p><p>æˆ‘ä»¬éœ€è¦å…³é—­è¿™ç§å¯¹SpringMVCçš„èµ„æºèšåˆï¼Œä¿®æ”¹order-serviceæœåŠ¡çš„application.ymlæ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">web-context-unify:</span> <span class="literal">false</span> <span class="comment"># å…³é—­contextæ•´åˆ</span></span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡ï¼Œè®¿é—®/order/queryå’Œ/order/saveï¼Œå¯ä»¥æŸ¥çœ‹åˆ°sentinelçš„ç°‡ç‚¹é“¾è·¯è§„åˆ™ä¸­ï¼Œå‡ºç°äº†æ–°çš„èµ„æºï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/7316271692e54816be931c8281824444" alt="image-20210716105227163"></p><h4 id="tian-jia-liu-kong-gui-ze" id="æ·»åŠ æµæ§è§„åˆ™">æ·»åŠ æµæ§è§„åˆ™</h4><p>ç‚¹å‡»goodsèµ„æºåé¢çš„æµæ§æŒ‰é’®ï¼Œåœ¨å¼¹å‡ºçš„è¡¨å•ä¸­å¡«å†™ä¸‹é¢ä¿¡æ¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/cbe94ea2d3d64d598e874ac66ab29f3f" alt="image-20210716105408723"></p><p>åªç»Ÿè®¡ä»/order/queryè¿›å…¥/goodsçš„èµ„æºï¼ŒQPSé˜ˆå€¼ä¸º2ï¼Œè¶…å‡ºåˆ™è¢«é™æµã€‚</p><h4 id="jmeter-ce-shi" id="Jmeteræµ‹è¯•">Jmeteræµ‹è¯•</h4><p>é€‰æ‹©ã€Šæµæ§æ¨¡å¼-é“¾è·¯ã€‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/d26a94001e044f48b6ac48f94c547a2c" alt="image-20210716105612312"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œ200ä¸ªç”¨æˆ·ï¼Œ50ç§’å†…å‘å®Œï¼ŒQPSä¸º4ï¼Œè¶…è¿‡äº†æˆ‘ä»¬è®¾å®šçš„é˜ˆå€¼2</p><p>ä¸€ä¸ªhttpè¯·æ±‚æ˜¯è®¿é—®/order/saveï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/c92de729dc3343a5b8bf90847beaaca3" alt="image-20210716105812789"></p><p>è¿è¡Œçš„ç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/f04bb536ca3c4283ac81cc53f0f5595c" alt="image-20210716110027064"></p><p>å®Œå…¨ä¸å—å½±å“ã€‚</p><p>å¦ä¸€ä¸ªæ˜¯è®¿é—®/order/queryï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/b5e54e66a1974fae898b6f4edfaad358" alt="image-20210716105855951"></p><p>è¿è¡Œç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/4470a851e0b740838960940d894b3862" alt="image-20210716105956401"></p><p>æ¯æ¬¡åªæœ‰2ä¸ªé€šè¿‡ã€‚</p><h3 id="zong-jie-1" id="æ€»ç»“-2">æ€»ç»“</h3><p>æµæ§æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ</p><ul><li><p>ç›´æ¥ï¼šå¯¹å½“å‰èµ„æºé™æµ</p></li><li><p>å…³è”ï¼šé«˜ä¼˜å…ˆçº§èµ„æºè§¦å‘é˜ˆå€¼ï¼Œå¯¹ä½ä¼˜å…ˆçº§èµ„æºé™æµã€‚</p></li><li><p>é“¾è·¯ï¼šé˜ˆå€¼ç»Ÿè®¡æ—¶ï¼Œåªç»Ÿè®¡ä»æŒ‡å®šèµ„æºè¿›å…¥å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œæ˜¯å¯¹è¯·æ±‚æ¥æºçš„é™æµ</p></li></ul><h2 id="liu-kong-xiao-guo" id="æµæ§æ•ˆæœ">æµæ§æ•ˆæœ</h2><p>åœ¨æµæ§çš„é«˜çº§é€‰é¡¹ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªæµæ§æ•ˆæœé€‰é¡¹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/8b8ac971607e4e318295921214682823" alt="image-20210716110225104"></p><p>æµæ§æ•ˆæœæ˜¯æŒ‡è¯·æ±‚è¾¾åˆ°æµæ§é˜ˆå€¼æ—¶åº”è¯¥é‡‡å–çš„æªæ–½ï¼ŒåŒ…æ‹¬ä¸‰ç§ï¼š</p><ul><li><p>å¿«é€Ÿå¤±è´¥ï¼šè¾¾åˆ°é˜ˆå€¼åï¼Œæ–°çš„è¯·æ±‚ä¼šè¢«ç«‹å³æ‹’ç»å¹¶æŠ›å‡ºFlowExceptionå¼‚å¸¸ã€‚æ˜¯é»˜è®¤çš„å¤„ç†æ–¹å¼ã€‚</p></li><li><p>warm upï¼šé¢„çƒ­æ¨¡å¼ï¼Œå¯¹è¶…å‡ºé˜ˆå€¼çš„è¯·æ±‚åŒæ ·æ˜¯æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚ä½†è¿™ç§æ¨¡å¼é˜ˆå€¼ä¼šåŠ¨æ€å˜åŒ–ï¼Œä»ä¸€ä¸ªè¾ƒå°å€¼é€æ¸å¢åŠ åˆ°æœ€å¤§é˜ˆå€¼ã€‚</p></li><li><p>æ’é˜Ÿç­‰å¾…ï¼šè®©æ‰€æœ‰çš„è¯·æ±‚æŒ‰ç…§å…ˆåæ¬¡åºæ’é˜Ÿæ‰§è¡Œï¼Œä¸¤ä¸ªè¯·æ±‚çš„é—´éš”ä¸èƒ½å°äºæŒ‡å®šæ—¶é•¿</p></li></ul><h3 id="warm-up" id="warm-up">warm up</h3><p>é˜ˆå€¼ä¸€èˆ¬æ˜¯ä¸€ä¸ªå¾®æœåŠ¡èƒ½æ‰¿æ‹…çš„æœ€å¤§QPSï¼Œä½†æ˜¯ä¸€ä¸ªæœåŠ¡åˆšåˆšå¯åŠ¨æ—¶ï¼Œä¸€åˆ‡èµ„æºå°šæœªåˆå§‹åŒ–ï¼ˆ<strong>å†·å¯åŠ¨</strong>ï¼‰ï¼Œå¦‚æœç›´æ¥å°†QPSè·‘åˆ°æœ€å¤§å€¼ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡ç¬é—´å®•æœºã€‚</p><p>warm upä¹Ÿå«<strong>é¢„çƒ­æ¨¡å¼</strong>ï¼Œæ˜¯åº”å¯¹æœåŠ¡å†·å¯åŠ¨çš„ä¸€ç§æ–¹æ¡ˆã€‚è¯·æ±‚é˜ˆå€¼åˆå§‹å€¼æ˜¯ maxThreshold / coldFactorï¼ŒæŒç»­æŒ‡å®šæ—¶é•¿åï¼Œé€æ¸æé«˜åˆ°maxThresholdå€¼ã€‚è€ŒcoldFactorçš„é»˜è®¤å€¼æ˜¯3.</p><p>ä¾‹å¦‚ï¼Œæˆ‘è®¾ç½®QPSçš„maxThresholdä¸º10ï¼Œé¢„çƒ­æ—¶é—´ä¸º5ç§’ï¼Œé‚£ä¹ˆåˆå§‹é˜ˆå€¼å°±æ˜¯ 10 / 3 ï¼Œä¹Ÿå°±æ˜¯3ï¼Œç„¶ååœ¨5ç§’åé€æ¸å¢é•¿åˆ°10.</p><p><img src="https://s1.vika.cn/space/2023/03/16/eb3cd4b4c4294ef582f1bd283fe97920" alt="image-20210716110629796"></p><p><strong>æ¡ˆä¾‹</strong></p><blockquote><p>éœ€æ±‚ï¼šç»™/order/{orderId}è¿™ä¸ªèµ„æºè®¾ç½®é™æµï¼Œæœ€å¤§QPSä¸º10ï¼Œåˆ©ç”¨warm upæ•ˆæœï¼Œé¢„çƒ­æ—¶é•¿ä¸º5ç§’</p></blockquote><h4 id="pei-zhi-liu-kong-gui-ze" id="é…ç½®æµæ§è§„åˆ™ï¼š">é…ç½®æµæ§è§„åˆ™ï¼š</h4><p><img src="https://s1.vika.cn/space/2023/03/16/1650084d77b0469eb8638ea156bd22a0" alt="image-20210716111012387"></p><h4 id="jmeter-ce-shi-1" id="Jmeteræµ‹è¯•-2">Jmeteræµ‹è¯•</h4><p>é€‰æ‹©ã€Šæµæ§æ•ˆæœï¼Œwarm upã€‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/bf94e2ba91264d9297e4f87c27888793" alt="image-20210716111136699"></p><p>QPSä¸º10.</p><p>åˆšåˆšå¯åŠ¨æ—¶ï¼Œå¤§éƒ¨åˆ†è¯·æ±‚å¤±è´¥ï¼ŒæˆåŠŸçš„åªæœ‰3ä¸ªï¼Œè¯´æ˜QPSè¢«é™å®šåœ¨3ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/063bf643e83f421aaeb46ec18677ce11" alt="image-20210716111303701"></p><p>éšç€æ—¶é—´æ¨ç§»ï¼ŒæˆåŠŸæ¯”ä¾‹è¶Šæ¥è¶Šé«˜ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/755fccc0a9ab4ef3884d58b3888639fc" alt="image-20210716111404717"></p><p>åˆ°Sentinelæ§åˆ¶å°æŸ¥çœ‹å®æ—¶ç›‘æ§ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/4984b810276a44d7a98fbae69e09c05d" alt="image-20210716111526480"></p><p>ä¸€æ®µæ—¶é—´åï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/bc506d1239cd4f55af2a29dd2bd26953" alt="image-20210716111658541"></p><h3 id="pai-dui-deng-dai" id="æ’é˜Ÿç­‰å¾…">æ’é˜Ÿç­‰å¾…</h3><ul><li><p>å½“è¯·æ±‚è¶…è¿‡QPSé˜ˆå€¼æ—¶ï¼Œå¿«é€Ÿå¤±è´¥å’Œwarm up ä¼šæ‹’ç»æ–°çš„è¯·æ±‚å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚</p></li><li><p>è€Œæ’é˜Ÿç­‰å¾…åˆ™æ˜¯è®©æ‰€æœ‰è¯·æ±‚è¿›å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç„¶åæŒ‰ç…§é˜ˆå€¼å…è®¸çš„æ—¶é—´é—´éš”ä¾æ¬¡æ‰§è¡Œã€‚åæ¥çš„è¯·æ±‚å¿…é¡»ç­‰å¾…å‰é¢æ‰§è¡Œå®Œæˆï¼Œå¦‚æœè¯·æ±‚é¢„æœŸçš„ç­‰å¾…æ—¶é—´è¶…å‡ºæœ€å¤§æ—¶é•¿ï¼Œåˆ™ä¼šè¢«æ‹’ç»ã€‚</p></li></ul><p>å·¥ä½œåŸç†</p><p>ä¾‹å¦‚ï¼šQPS = 5ï¼Œæ„å‘³ç€æ¯200mså¤„ç†ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„è¯·æ±‚ï¼›timeout = 2000ï¼Œæ„å‘³ç€<strong>é¢„æœŸç­‰å¾…æ—¶é•¿</strong>è¶…è¿‡2000msçš„è¯·æ±‚ä¼šè¢«æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>é‚£ä»€ä¹ˆå«åšé¢„æœŸç­‰å¾…æ—¶é•¿å‘¢ï¼Ÿ</p><p>æ¯”å¦‚ç°åœ¨ä¸€ä¸‹å­æ¥äº†12 ä¸ªè¯·æ±‚ï¼Œå› ä¸ºæ¯200msæ‰§è¡Œä¸€ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆï¼š</p><ul><li>ç¬¬6ä¸ªè¯·æ±‚çš„<strong>é¢„æœŸç­‰å¾…æ—¶é•¿</strong> =  200 * ï¼ˆ6 - 1ï¼‰ = 1000ms</li><li>ç¬¬12ä¸ªè¯·æ±‚çš„é¢„æœŸç­‰å¾…æ—¶é•¿ = 200 * ï¼ˆ12-1ï¼‰ = 2200ms</li></ul><p>ç°åœ¨ï¼Œç¬¬1ç§’åŒæ—¶æ¥æ”¶åˆ°10ä¸ªè¯·æ±‚ï¼Œä½†ç¬¬2ç§’åªæœ‰1ä¸ªè¯·æ±‚ï¼Œæ­¤æ—¶QPSçš„æ›²çº¿è¿™æ ·çš„ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/946b847c74cc4d7f847bb6181bf4f985" alt="image-20210716113147176"></p><p>å¦‚æœä½¿ç”¨é˜Ÿåˆ—æ¨¡å¼åšæµæ§ï¼Œæ‰€æœ‰è¿›å…¥çš„è¯·æ±‚éƒ½è¦æ’é˜Ÿï¼Œä»¥å›ºå®šçš„200msçš„é—´éš”æ‰§è¡Œï¼ŒQPSä¼šå˜çš„å¾ˆå¹³æ»‘ï¼š</p><p><img src="https://s1.vika.cn/space/2020/04/19/1251738678275870721" alt="image-20210716113426524"></p><p>å¹³æ»‘çš„QPSæ›²çº¿ï¼Œå¯¹äºæœåŠ¡å™¨æ¥è¯´æ˜¯æ›´å‹å¥½çš„ã€‚</p><p><strong>æ¡ˆä¾‹</strong></p><blockquote><p>éœ€æ±‚ï¼šç»™/order/{orderId}è¿™ä¸ªèµ„æºè®¾ç½®é™æµï¼Œæœ€å¤§QPSä¸º10ï¼Œåˆ©ç”¨æ’é˜Ÿçš„æµæ§æ•ˆæœï¼Œè¶…æ—¶æ—¶é•¿è®¾ç½®ä¸º5s</p></blockquote><h4 id="tian-jia-liu-kong-gui-ze-1" id="æ·»åŠ æµæ§è§„åˆ™-2">æ·»åŠ æµæ§è§„åˆ™</h4><p><img src="https://s1.vika.cn/space/2023/03/16/c7cca4123fc449e7ace0d909b47fac9a" alt="image-20210716114048918"></p><h4 id="jmeter-ce-shi-2" id="Jmeteræµ‹è¯•-3">Jmeteræµ‹è¯•</h4><p>é€‰æ‹©ã€Šæµæ§æ•ˆæœï¼Œé˜Ÿåˆ—ã€‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/b961ae101af7462b88f5c8cbeaca55cb" alt="image-20210716114243558"></p><p>QPSä¸º15ï¼Œå·²ç»è¶…è¿‡äº†æˆ‘ä»¬è®¾å®šçš„10ã€‚</p><p>å¦‚æœæ˜¯ä¹‹å‰çš„ å¿«é€Ÿå¤±è´¥ã€warmupæ¨¡å¼ï¼Œè¶…å‡ºçš„è¯·æ±‚åº”è¯¥ä¼šç›´æ¥æŠ¥é”™ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬çœ‹çœ‹é˜Ÿåˆ—æ¨¡å¼çš„è¿è¡Œç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/dff7a93307a34eff913ff347c0b88f99" alt="image-20210716114429361"></p><p>å…¨éƒ¨éƒ½é€šè¿‡äº†ã€‚</p><p>å†å»sentinelæŸ¥çœ‹å®æ—¶ç›‘æ§çš„QPSæ›²çº¿ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/10c79fffe5a94b8b8cb40eaed61e942a" alt="image-20210716114522935"></p><p>QPSéå¸¸å¹³æ»‘ï¼Œä¸€è‡´ä¿æŒåœ¨10ï¼Œä½†æ˜¯è¶…å‡ºçš„è¯·æ±‚æ²¡æœ‰è¢«æ‹’ç»ï¼Œè€Œæ˜¯æ”¾å…¥é˜Ÿåˆ—ã€‚å› æ­¤<strong>å“åº”æ—¶é—´</strong>ï¼ˆç­‰å¾…æ—¶é—´ï¼‰ä¼šè¶Šæ¥è¶Šé•¿ã€‚</p><p>å½“é˜Ÿåˆ—æ»¡äº†ä»¥åï¼Œæ‰ä¼šæœ‰éƒ¨åˆ†è¯·æ±‚å¤±è´¥ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/90921d26c8e24f8d83acc01ffcbb0bda" alt="image-20210716114651137"></p><h3 id="zong-jie-2" id="æ€»ç»“-3">æ€»ç»“</h3><p>æµæ§æ•ˆæœæœ‰å“ªäº›ï¼Ÿ</p><ul><li><p>å¿«é€Ÿå¤±è´¥ï¼šQPSè¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæ‹’ç»æ–°çš„è¯·æ±‚</p></li><li><p>warm upï¼š QPSè¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæ‹’ç»æ–°çš„è¯·æ±‚ï¼›QPSé˜ˆå€¼æ˜¯é€æ¸æå‡çš„ï¼Œå¯ä»¥é¿å…å†·å¯åŠ¨æ—¶é«˜å¹¶å‘å¯¼è‡´æœåŠ¡å®•æœºã€‚</p></li><li><p>æ’é˜Ÿç­‰å¾…ï¼šè¯·æ±‚ä¼šè¿›å…¥é˜Ÿåˆ—ï¼ŒæŒ‰ç…§é˜ˆå€¼å…è®¸çš„æ—¶é—´é—´éš”ä¾æ¬¡æ‰§è¡Œè¯·æ±‚ï¼›å¦‚æœè¯·æ±‚é¢„æœŸç­‰å¾…æ—¶é•¿å¤§äºè¶…æ—¶æ—¶é—´ï¼Œç›´æ¥æ‹’ç»</p></li></ul><h2 id="re-dian-can-shu-xian-liu" id="çƒ­ç‚¹å‚æ•°é™æµ">çƒ­ç‚¹å‚æ•°é™æµ</h2><p>ä¹‹å‰çš„é™æµæ˜¯ç»Ÿè®¡è®¿é—®æŸä¸ªèµ„æºçš„æ‰€æœ‰è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡QPSé˜ˆå€¼ã€‚è€Œçƒ­ç‚¹å‚æ•°é™æµæ˜¯<strong>åˆ†åˆ«ç»Ÿè®¡å‚æ•°å€¼ç›¸åŒçš„è¯·æ±‚</strong>ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡QPSé˜ˆå€¼ã€‚</p><h3 id="quan-ju-can-shu-xian-liu" id="å…¨å±€å‚æ•°é™æµ">å…¨å±€å‚æ•°é™æµ</h3><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªæ ¹æ®idæŸ¥è¯¢å•†å“çš„æ¥å£ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/c3c4ebf2c2e54365aeab466d4288b57b" alt="image-20210716115014663"></p><p>è®¿é—®/goods/{id}çš„è¯·æ±‚ä¸­ï¼Œidå‚æ•°å€¼ä¼šæœ‰å˜åŒ–ï¼Œçƒ­ç‚¹å‚æ•°é™æµä¼šæ ¹æ®å‚æ•°å€¼åˆ†åˆ«ç»Ÿè®¡QPSï¼Œç»Ÿè®¡ç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/12b7923226394e919ac584c6c33d2791" alt="image-20210716115131463"></p><p>å½“id=1çš„è¯·æ±‚è§¦å‘é˜ˆå€¼è¢«é™æµæ—¶ï¼Œidå€¼ä¸ä¸º1çš„è¯·æ±‚ä¸å—å½±å“ã€‚</p><p>é…ç½®ç¤ºä¾‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/653a79e02a074d0799c63140e3d3d030" alt="image-20210716115232426"></p><p>ä»£è¡¨çš„å«ä¹‰æ˜¯ï¼šå¯¹hotè¿™ä¸ªèµ„æºçš„0å·å‚æ•°ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰åšç»Ÿè®¡ï¼Œæ¯1ç§’<strong>ç›¸åŒå‚æ•°å€¼</strong>çš„è¯·æ±‚æ•°ä¸èƒ½è¶…è¿‡5</p><h3 id="re-dian-can-shu-xian-liu-1" id="çƒ­ç‚¹å‚æ•°é™æµ-2">çƒ­ç‚¹å‚æ•°é™æµ</h3><p>åˆšæ‰çš„é…ç½®ä¸­ï¼Œå¯¹æŸ¥è¯¢å•†å“è¿™ä¸ªæ¥å£çš„æ‰€æœ‰å•†å“ä¸€è§†åŒä»ï¼ŒQPSéƒ½é™å®šä¸º5.</p><p>è€Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯èƒ½éƒ¨åˆ†å•†å“æ˜¯çƒ­ç‚¹å•†å“ï¼Œä¾‹å¦‚ç§’æ€å•†å“ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™éƒ¨åˆ†å•†å“çš„QPSé™åˆ¶ä¸å…¶å®ƒå•†å“ä¸ä¸€æ ·ï¼Œé«˜ä¸€äº›ã€‚é‚£å°±éœ€è¦é…ç½®çƒ­ç‚¹å‚æ•°é™æµçš„é«˜çº§é€‰é¡¹äº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/0813e3685a364410b71384e39a0ae1fa" alt="image-20210716115717523"></p><p>ç»“åˆä¸Šä¸€ä¸ªé…ç½®ï¼Œè¿™é‡Œçš„å«ä¹‰æ˜¯å¯¹0å·çš„longç±»å‹å‚æ•°é™æµï¼Œæ¯1ç§’ç›¸åŒå‚æ•°çš„QPSä¸èƒ½è¶…è¿‡5ï¼Œæœ‰ä¸¤ä¸ªä¾‹å¤–ï¼š</p><ul><li><p>å¦‚æœå‚æ•°å€¼æ˜¯100ï¼Œåˆ™æ¯1ç§’å…è®¸çš„QPSä¸º10</p></li><li><p>å¦‚æœå‚æ•°å€¼æ˜¯101ï¼Œåˆ™æ¯1ç§’å…è®¸çš„QPSä¸º15</p></li></ul><h3 id="an-li" id="æ¡ˆä¾‹">æ¡ˆä¾‹</h3><blockquote><p><strong>æ¡ˆä¾‹éœ€æ±‚</strong>ï¼šç»™/order/{orderId}è¿™ä¸ªèµ„æºæ·»åŠ çƒ­ç‚¹å‚æ•°é™æµï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li><p>é»˜è®¤çš„çƒ­ç‚¹å‚æ•°è§„åˆ™æ˜¯æ¯1ç§’è¯·æ±‚é‡ä¸è¶…è¿‡2</p></li><li><p>ç»™102è¿™ä¸ªå‚æ•°è®¾ç½®ä¾‹å¤–ï¼šæ¯1ç§’è¯·æ±‚é‡ä¸è¶…è¿‡4</p></li><li><p>ç»™103è¿™ä¸ªå‚æ•°è®¾ç½®ä¾‹å¤–ï¼šæ¯1ç§’è¯·æ±‚é‡ä¸è¶…è¿‡10</p></li></ul></blockquote><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼šçƒ­ç‚¹å‚æ•°é™æµå¯¹é»˜è®¤çš„SpringMVCèµ„æºæ— æ•ˆï¼Œéœ€è¦åˆ©ç”¨@SentinelResourceæ³¨è§£æ ‡è®°èµ„æº</p><h4 id="biao-ji-zi-yuan" id="æ ‡è®°èµ„æº">æ ‡è®°èµ„æº</h4><p>ç»™order-serviceä¸­çš„OrderControllerä¸­çš„/order/{orderId}èµ„æºæ·»åŠ æ³¨è§£ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/20519126183c4c58ab7f2b074520711a" alt="image-20210716120033572"></p><h4 id="re-dian-can-shu-xian-liu-gui-ze" id="çƒ­ç‚¹å‚æ•°é™æµè§„åˆ™">çƒ­ç‚¹å‚æ•°é™æµè§„åˆ™</h4><p>è®¿é—®è¯¥æ¥å£ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ ‡è®°çš„hotèµ„æºå‡ºç°äº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/226e6663ad1a486bb4a530cfcfdce922" alt="image-20210716120208509"></p><p>è¿™é‡Œä¸è¦ç‚¹å‡»hotåé¢çš„æŒ‰é’®ï¼Œé¡µé¢æœ‰BUG</p><p>ç‚¹å‡»å·¦ä¾§èœå•ä¸­<strong>çƒ­ç‚¹è§„åˆ™</strong>èœå•ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/800123915df04ddc8fbc5c97108d0cb5" alt="image-20210716120319009"></p><p>ç‚¹å‡»æ–°å¢ï¼Œå¡«å†™è¡¨å•ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/b4e8804965954eabb74b31b02aea4077" alt="image-20210716120536714"></p><h4 id="jmeter-ce-shi-3" id="Jmeteræµ‹è¯•-4">Jmeteræµ‹è¯•</h4><p>é€‰æ‹©ã€Šçƒ­ç‚¹å‚æ•°é™æµ QPS1ã€‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/dc77020bd06c40a988945a028ca779fd" alt="image-20210716120754527"></p><p>è¿™é‡Œå‘èµ·è¯·æ±‚çš„QPSä¸º5.</p><p>åŒ…å«3ä¸ªhttpè¯·æ±‚ï¼š</p><p>æ™®é€šå‚æ•°ï¼ŒQPSé˜ˆå€¼ä¸º2</p><p><img src="https://s1.vika.cn/space/2023/03/16/77330df50c6845f28679d56a62b526b9" alt="image-20210716120840501"></p><p>è¿è¡Œç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/9115d61a7bec4bff837b7820616a214a" alt="image-20210716121105567"></p><p>ä¾‹å¤–é¡¹ï¼ŒQPSé˜ˆå€¼ä¸º4</p><p><img src="https://s1.vika.cn/space/2023/03/16/b33ad998eeda46dea99d6bfa51d7e768" alt="image-20210716120900365"></p><p>è¿è¡Œç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/a66adf4606074c47af432e7c2592e5cd" alt="image-20210716121201630"></p><p>ä¾‹å¤–é¡¹ï¼ŒQPSé˜ˆå€¼ä¸º10</p><p><img src="https://s1.vika.cn/space/2023/03/16/69c08a98d5dd4873927026cf3f10b66b" alt="image-20210716120919131"></p><p>è¿è¡Œç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/16/38a5feb7d91340cfa3b9cc457166c203" alt="image-20210716121220305"></p><h1 id="ge-chi-he-jiang-ji">éš”ç¦»å’Œé™çº§</h1><p>é™æµæ˜¯ä¸€ç§é¢„é˜²æªæ–½ï¼Œè™½ç„¶é™æµå¯ä»¥å°½é‡é¿å…å› é«˜å¹¶å‘è€Œå¼•èµ·çš„æœåŠ¡æ•…éšœï¼Œä½†æœåŠ¡è¿˜ä¼šå› ä¸ºå…¶å®ƒåŸå› è€Œæ•…éšœã€‚</p><p>è€Œè¦å°†è¿™äº›æ•…éšœæ§åˆ¶åœ¨ä¸€å®šèŒƒå›´ï¼Œé¿å…é›ªå´©ï¼Œå°±è¦é <strong>çº¿ç¨‹éš”ç¦»</strong>ï¼ˆèˆ±å£æ¨¡å¼ï¼‰å’Œ<strong>ç†”æ–­é™çº§</strong>æ‰‹æ®µäº†ã€‚</p><p><strong>çº¿ç¨‹éš”ç¦»</strong>ä¹‹å‰è®²åˆ°è¿‡ï¼šè°ƒç”¨è€…åœ¨è°ƒç”¨æœåŠ¡æä¾›è€…æ—¶ï¼Œç»™æ¯ä¸ªè°ƒç”¨çš„è¯·æ±‚åˆ†é…ç‹¬ç«‹çº¿ç¨‹æ± ï¼Œå‡ºç°æ•…éšœæ—¶ï¼Œæœ€å¤šæ¶ˆè€—è¿™ä¸ªçº¿ç¨‹æ± å†…èµ„æºï¼Œé¿å…æŠŠè°ƒç”¨è€…çš„æ‰€æœ‰èµ„æºè€—å°½ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/16/5bf6bdbfd13d46db8261afc754a4db00" alt="image-20210715173215243"></p><p><strong>ç†”æ–­é™çº§</strong>ï¼šæ˜¯åœ¨è°ƒç”¨æ–¹è¿™è¾¹åŠ å…¥æ–­è·¯å™¨ï¼Œç»Ÿè®¡å¯¹æœåŠ¡æä¾›è€…çš„è°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨çš„å¤±è´¥æ¯”ä¾‹è¿‡é«˜ï¼Œåˆ™ç†”æ–­è¯¥ä¸šåŠ¡ï¼Œä¸å…è®¸è®¿é—®è¯¥æœåŠ¡çš„æä¾›è€…äº†ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/16/8d4546ee64b84b479715c5ff3116f843" alt="image-20210715173428073"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸ç®¡æ˜¯çº¿ç¨‹éš”ç¦»è¿˜æ˜¯ç†”æ–­é™çº§ï¼Œéƒ½æ˜¯å¯¹<strong>å®¢æˆ·ç«¯</strong>ï¼ˆè°ƒç”¨æ–¹ï¼‰çš„ä¿æŠ¤ã€‚éœ€è¦åœ¨<strong>è°ƒç”¨æ–¹</strong> å‘èµ·è¿œç¨‹è°ƒç”¨æ—¶åšçº¿ç¨‹éš”ç¦»ã€æˆ–è€…æœåŠ¡ç†”æ–­ã€‚</p><p>è€Œæˆ‘ä»¬çš„å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨éƒ½æ˜¯åŸºäºFeignæ¥å®Œæˆçš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†Feignä¸Sentinelæ•´åˆï¼Œåœ¨Feigné‡Œé¢å®ç°çº¿ç¨‹éš”ç¦»å’ŒæœåŠ¡ç†”æ–­ã€‚</p><h2 id="feign-client-zheng-he-sentinel-1" id="FeignClientæ•´åˆSentinel">FeignClientæ•´åˆSentinel</h2><p>SpringCloudä¸­ï¼Œå¾®æœåŠ¡è°ƒç”¨éƒ½æ˜¯é€šè¿‡Feignæ¥å®ç°çš„ï¼Œå› æ­¤åšå®¢æˆ·ç«¯ä¿æŠ¤å¿…é¡»æ•´åˆFeignå’ŒSentinelã€‚</p><h3 id="xiu-gai-pei-zhi-kai-qi-sentinel-gong-neng" id="ä¿®æ”¹é…ç½®ï¼Œå¼€å¯sentinelåŠŸèƒ½">ä¿®æ”¹é…ç½®ï¼Œå¼€å¯sentinelåŠŸèƒ½</h3><p>ä¿®æ”¹OrderServiceçš„application.ymlæ–‡ä»¶ï¼Œå¼€å¯Feignçš„SentinelåŠŸèƒ½ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># å¼€å¯feignå¯¹sentinelçš„æ”¯æŒ</span></span><br></pre></td></tr></table></figure><h3 id="bian-xie-shi-bai-jiang-ji-luo-ji" id="ç¼–å†™å¤±è´¥é™çº§é€»è¾‘">ç¼–å†™å¤±è´¥é™çº§é€»è¾‘</h3><p>ä¸šåŠ¡å¤±è´¥åï¼Œä¸èƒ½ç›´æ¥æŠ¥é”™ï¼Œè€Œåº”è¯¥è¿”å›ç”¨æˆ·ä¸€ä¸ªå‹å¥½æç¤ºæˆ–è€…é»˜è®¤ç»“æœï¼Œè¿™ä¸ªå°±æ˜¯å¤±è´¥é™çº§é€»è¾‘ã€‚</p><p>ç»™FeignClientç¼–å†™å¤±è´¥åçš„é™çº§é€»è¾‘</p><p>â‘ æ–¹å¼ä¸€ï¼šFallbackClassï¼Œæ— æ³•å¯¹è¿œç¨‹è°ƒç”¨çš„å¼‚å¸¸åšå¤„ç†</p><p>â‘¡æ–¹å¼äºŒï¼šFallbackFactoryï¼Œå¯ä»¥å¯¹è¿œç¨‹è°ƒç”¨çš„å¼‚å¸¸åšå¤„ç†ï¼Œæˆ‘ä»¬é€‰æ‹©è¿™ç§</p><p>è¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºæ–¹å¼äºŒçš„å¤±è´¥é™çº§å¤„ç†ã€‚</p><p><strong>æ­¥éª¤ä¸€</strong>ï¼šåœ¨feing-apié¡¹ç›®ä¸­å®šä¹‰ç±»ï¼Œå®ç°FallbackFactoryï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/1e8309c5e80544dbb635d03746d04a8d" alt="image-20210716122403502"></p><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.feign.clients.fallback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.feign.clients.UserClient;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.feign.pojo.User;</span><br><span class="line"><span class="keyword">import</span> feign.hystrix.FallbackFactory;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserClientFallbackFactory</span> <span class="keyword">implements</span> <span class="title class_">FallbackFactory</span>&lt;UserClient&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserClient <span class="title function_">create</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserClient</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">                log.error(<span class="string">&quot;æŸ¥è¯¢ç”¨æˆ·å¼‚å¸¸&quot;</span>, throwable);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤äºŒ</strong>ï¼šåœ¨feing-apié¡¹ç›®ä¸­çš„DefaultFeignConfigurationç±»ä¸­å°†UserClientFallbackFactoryæ³¨å†Œä¸ºä¸€ä¸ªBeanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> UserClientFallbackFactory <span class="title function_">userClientFallbackFactory</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserClientFallbackFactory</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤ä¸‰</strong>ï¼šåœ¨feing-apié¡¹ç›®ä¸­çš„UserClientæ¥å£ä¸­ä½¿ç”¨UserClientFallbackFactoryï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.itcast.feign.clients.fallback.UserClientFallbackFactory;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.feign.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;userservice&quot;, fallbackFactory = UserClientFallbackFactory.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯åï¼Œè®¿é—®ä¸€æ¬¡è®¢å•æŸ¥è¯¢ä¸šåŠ¡ï¼Œç„¶åæŸ¥çœ‹sentinelæ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°æ–°çš„ç°‡ç‚¹é“¾è·¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/a05d45315e8f4b70b8fd81c0142556e6" alt="image-20210716123705780"></p><h3 id="zong-jie-3" id="æ€»ç»“-4">æ€»ç»“</h3><p>Sentinelæ”¯æŒçš„é›ªå´©è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>çº¿ç¨‹éš”ç¦»ï¼ˆä»“å£æ¨¡å¼ï¼‰</li><li>é™çº§ç†”æ–­</li></ul><p>Feignæ•´åˆSentinelçš„æ­¥éª¤ï¼š</p><ul><li>åœ¨application.ymlä¸­é…ç½®ï¼šfeign.sentienl.enable=true</li><li>ç»™FeignClientç¼–å†™FallbackFactoryå¹¶æ³¨å†Œä¸ºBean</li><li>å°†FallbackFactoryé…ç½®åˆ°FeignClient</li></ul><h2 id="xian-cheng-ge-chi-cang-bi-mo-shi" id="çº¿ç¨‹éš”ç¦»ï¼ˆèˆ±å£æ¨¡å¼ï¼‰">çº¿ç¨‹éš”ç¦»ï¼ˆèˆ±å£æ¨¡å¼ï¼‰</h2><h3 id="xian-cheng-ge-chi-de-shi-xian-fang-shi" id="çº¿ç¨‹éš”ç¦»çš„å®ç°æ–¹å¼">çº¿ç¨‹éš”ç¦»çš„å®ç°æ–¹å¼</h3><p>çº¿ç¨‹éš”ç¦»æœ‰ä¸¤ç§æ–¹å¼å®ç°ï¼š</p><ul><li><p>çº¿ç¨‹æ± éš”ç¦»</p></li><li><p>ä¿¡å·é‡éš”ç¦»ï¼ˆSentinelé»˜è®¤é‡‡ç”¨ï¼‰</p></li></ul><p>å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/c2e9273fa4eb4bab88b6a0ce3c6e1ff0" alt="image-20210716123036937"></p><p><strong>çº¿ç¨‹æ± éš”ç¦»</strong>ï¼šç»™æ¯ä¸ªæœåŠ¡è°ƒç”¨ä¸šåŠ¡åˆ†é…ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œåˆ©ç”¨çº¿ç¨‹æ± æœ¬èº«å®ç°éš”ç¦»æ•ˆæœ</p><p><strong>ä¿¡å·é‡éš”ç¦»</strong>ï¼šä¸åˆ›å»ºçº¿ç¨‹æ± ï¼Œè€Œæ˜¯è®¡æ•°å™¨æ¨¡å¼ï¼Œè®°å½•ä¸šåŠ¡ä½¿ç”¨çš„çº¿ç¨‹æ•°é‡ï¼Œè¾¾åˆ°ä¿¡å·é‡ä¸Šé™æ—¶ï¼Œç¦æ­¢æ–°çš„è¯·æ±‚ã€‚</p><p>ä¸¤è€…çš„ä¼˜ç¼ºç‚¹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/a4d1cfc3b5bd4a56811b1681932f27b0" alt="image-20210716123240518"></p><h3 id="sentinel-de-xian-cheng-ge-chi" id="sentinelçš„çº¿ç¨‹éš”ç¦»">sentinelçš„çº¿ç¨‹éš”ç¦»</h3><p><strong>ç”¨æ³•è¯´æ˜</strong>ï¼š</p><p>åœ¨æ·»åŠ é™æµè§„åˆ™æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä¸¤ç§é˜ˆå€¼ç±»å‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/5a70e2475de6462f816e42554772fc44" alt="image-20210716123411217"></p><ul><li><p>QPSï¼šå°±æ˜¯æ¯ç§’çš„è¯·æ±‚æ•°ï¼Œåœ¨å¿«é€Ÿå…¥é—¨ä¸­å·²ç»æ¼”ç¤ºè¿‡</p></li><li><p>çº¿ç¨‹æ•°ï¼šæ˜¯è¯¥èµ„æºèƒ½ä½¿ç”¨ç”¨çš„tomcatçº¿ç¨‹æ•°çš„æœ€å¤§å€¼ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡é™åˆ¶çº¿ç¨‹æ•°é‡ï¼Œå®ç°<strong>çº¿ç¨‹éš”ç¦»</strong>ï¼ˆèˆ±å£æ¨¡å¼ï¼‰ã€‚</p></li></ul><blockquote><p><strong>æ¡ˆä¾‹éœ€æ±‚</strong>ï¼šç»™ order-serviceæœåŠ¡ä¸­çš„UserClientçš„æŸ¥è¯¢ç”¨æˆ·æ¥å£è®¾ç½®æµæ§è§„åˆ™ï¼Œçº¿ç¨‹æ•°ä¸èƒ½è¶…è¿‡ 2ã€‚ç„¶ååˆ©ç”¨jemeteræµ‹è¯•ã€‚</p></blockquote><h4 id="pei-zhi-ge-chi-gui-ze" id="é…ç½®éš”ç¦»è§„åˆ™">é…ç½®éš”ç¦»è§„åˆ™</h4><p>é€‰æ‹©feignæ¥å£åé¢çš„æµæ§æŒ‰é’®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/c7fad13e891f4b9187e848dd83d07891" alt="image-20210716123831992"></p><p>å¡«å†™è¡¨å•ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/a57ab4bf45a948bfb410ac9a0cf967a9" alt="image-20210716123936844"></p><h4 id="jmeter-ce-shi-4" id="Jmeteræµ‹è¯•-5">Jmeteræµ‹è¯•</h4><p>é€‰æ‹©ã€Šé˜ˆå€¼ç±»å‹-çº¿ç¨‹æ•°&lt;2ã€‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/0629dead8ff949f286a7af850bbe4488" alt="image-20210716124229894"></p><p>ä¸€æ¬¡å‘ç”Ÿ10ä¸ªè¯·æ±‚ï¼Œæœ‰è¾ƒå¤§æ¦‚ç‡å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡2ï¼Œè€Œè¶…å‡ºçš„è¯·æ±‚ä¼šèµ°ä¹‹å‰å®šä¹‰çš„å¤±è´¥é™çº§é€»è¾‘ã€‚</p><p>æŸ¥çœ‹è¿è¡Œç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/40a29c766f8e489da9e2493ce3a44636" alt="image-20210716124147820"></p><p>å‘ç°è™½ç„¶ç»“æœéƒ½æ˜¯é€šè¿‡äº†ï¼Œä¸è¿‡éƒ¨åˆ†è¯·æ±‚å¾—åˆ°çš„å“åº”æ˜¯é™çº§è¿”å›çš„nullä¿¡æ¯ã€‚</p><h3 id="zong-jie-4" id="æ€»ç»“-5">æ€»ç»“</h3><p>çº¿ç¨‹éš”ç¦»çš„ä¸¤ç§æ‰‹æ®µæ˜¯ï¼Ÿ</p><ul><li><p>ä¿¡å·é‡éš”ç¦»</p></li><li><p>çº¿ç¨‹æ± éš”ç¦»</p></li></ul><p>ä¿¡å·é‡éš”ç¦»çš„ç‰¹ç‚¹æ˜¯ï¼Ÿ</p><ul><li>åŸºäºè®¡æ•°å™¨æ¨¡å¼ï¼Œç®€å•ï¼Œå¼€é”€å°</li></ul><p>çº¿ç¨‹æ± éš”ç¦»çš„ç‰¹ç‚¹æ˜¯ï¼Ÿ</p><ul><li>åŸºäºçº¿ç¨‹æ± æ¨¡å¼ï¼Œæœ‰é¢å¤–å¼€é”€ï¼Œä½†éš”ç¦»æ§åˆ¶æ›´å¼º</li></ul><h2 id="rong-duan-jiang-ji" id="ç†”æ–­é™çº§">ç†”æ–­é™çº§</h2><blockquote><p>ç†”æ–­é™çº§æ˜¯è§£å†³é›ªå´©é—®é¢˜çš„é‡è¦æ‰‹æ®µã€‚å…¶æ€è·¯æ˜¯ç”±<strong>æ–­è·¯å™¨</strong>ç»Ÿè®¡æœåŠ¡è°ƒç”¨çš„å¼‚å¸¸æ¯”ä¾‹ã€æ…¢è¯·æ±‚æ¯”ä¾‹ï¼Œå¦‚æœè¶…å‡ºé˜ˆå€¼åˆ™ä¼š<strong>ç†”æ–­</strong>è¯¥æœåŠ¡ã€‚å³æ‹¦æˆªè®¿é—®è¯¥æœåŠ¡çš„ä¸€åˆ‡è¯·æ±‚ï¼›è€Œå½“æœåŠ¡æ¢å¤æ—¶ï¼Œæ–­è·¯å™¨ä¼šæ”¾è¡Œè®¿é—®è¯¥æœåŠ¡çš„è¯·æ±‚ã€‚</p></blockquote><p>æ–­è·¯å™¨æ§åˆ¶ç†”æ–­å’Œæ”¾è¡Œæ˜¯é€šè¿‡çŠ¶æ€æœºæ¥å®Œæˆçš„ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/ac4d56b8f7264763a80d5f4287980eae" alt="image-20210716130958518"></p><p>çŠ¶æ€æœºåŒ…æ‹¬ä¸‰ä¸ªçŠ¶æ€ï¼š</p><ul><li>closedï¼šå…³é—­çŠ¶æ€ï¼Œæ–­è·¯å™¨æ”¾è¡Œæ‰€æœ‰è¯·æ±‚ï¼Œå¹¶å¼€å§‹ç»Ÿè®¡å¼‚å¸¸æ¯”ä¾‹ã€æ…¢è¯·æ±‚æ¯”ä¾‹ã€‚è¶…è¿‡é˜ˆå€¼åˆ™åˆ‡æ¢åˆ°opençŠ¶æ€</li><li>openï¼šæ‰“å¼€çŠ¶æ€ï¼ŒæœåŠ¡è°ƒç”¨è¢«<strong>ç†”æ–­</strong>ï¼Œè®¿é—®è¢«ç†”æ–­æœåŠ¡çš„è¯·æ±‚ä¼šè¢«æ‹’ç»ï¼Œå¿«é€Ÿå¤±è´¥ï¼Œç›´æ¥èµ°é™çº§é€»è¾‘ã€‚OpençŠ¶æ€5ç§’åä¼šè¿›å…¥half-opençŠ¶æ€</li><li>half-openï¼šåŠå¼€çŠ¶æ€ï¼Œæ”¾è¡Œä¸€æ¬¡è¯·æ±‚ï¼Œæ ¹æ®æ‰§è¡Œç»“æœæ¥åˆ¤æ–­æ¥ä¸‹æ¥çš„æ“ä½œã€‚<ul><li>è¯·æ±‚æˆåŠŸï¼šåˆ™åˆ‡æ¢åˆ°closedçŠ¶æ€</li><li>è¯·æ±‚å¤±è´¥ï¼šåˆ™åˆ‡æ¢åˆ°opençŠ¶æ€</li></ul></li></ul><blockquote><p>æ–­è·¯å™¨ç†”æ–­ç­–ç•¥æœ‰ä¸‰ç§ï¼šæ…¢è°ƒç”¨ã€å¼‚å¸¸æ¯”ä¾‹ã€å¼‚å¸¸æ•°</p></blockquote><h3 id="man-diao-yong" id="æ…¢è°ƒç”¨">æ…¢è°ƒç”¨</h3><p><strong>æ…¢è°ƒç”¨</strong>ï¼šä¸šåŠ¡çš„å“åº”æ—¶é•¿ï¼ˆRTï¼‰å¤§äºæŒ‡å®šæ—¶é•¿çš„è¯·æ±‚è®¤å®šä¸ºæ…¢è°ƒç”¨è¯·æ±‚ã€‚åœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œå¦‚æœè¯·æ±‚æ•°é‡è¶…è¿‡è®¾å®šçš„æœ€å°æ•°é‡ï¼Œæ…¢è°ƒç”¨æ¯”ä¾‹å¤§äºè®¾å®šçš„é˜ˆå€¼ï¼Œåˆ™è§¦å‘ç†”æ–­ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/73985954eb424d5baa548b8ac99e2cee" alt="image-20210716145934347"></p><p>è§£è¯»ï¼šRTè¶…è¿‡500msçš„è°ƒç”¨æ˜¯æ…¢è°ƒç”¨ï¼Œç»Ÿè®¡æœ€è¿‘10000mså†…çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚é‡è¶…è¿‡10æ¬¡ï¼Œå¹¶ä¸”æ…¢è°ƒç”¨æ¯”ä¾‹ä¸ä½äº0.5ï¼Œåˆ™è§¦å‘ç†”æ–­ï¼Œç†”æ–­æ—¶é•¿ä¸º5ç§’ã€‚ç„¶åè¿›å…¥half-opençŠ¶æ€ï¼Œæ”¾è¡Œä¸€æ¬¡è¯·æ±‚åšæµ‹è¯•ã€‚</p><p><strong>æ¡ˆä¾‹</strong></p><blockquote><p>éœ€æ±‚ï¼šç»™ UserClientçš„æŸ¥è¯¢ç”¨æˆ·æ¥å£è®¾ç½®é™çº§è§„åˆ™ï¼Œæ…¢è°ƒç”¨çš„RTé˜ˆå€¼ä¸º50msï¼Œç»Ÿè®¡æ—¶é—´ä¸º1ç§’ï¼Œæœ€å°è¯·æ±‚æ•°é‡ä¸º5ï¼Œå¤±è´¥é˜ˆå€¼æ¯”ä¾‹ä¸º0.4ï¼Œç†”æ–­æ—¶é•¿ä¸º5</p></blockquote><h4 id="she-zhi-man-diao-yong" id="è®¾ç½®æ…¢è°ƒç”¨">è®¾ç½®æ…¢è°ƒç”¨</h4><p>ä¿®æ”¹user-serviceä¸­çš„/user/{id}è¿™ä¸ªæ¥å£çš„ä¸šåŠ¡ã€‚é€šè¿‡ä¼‘çœ æ¨¡æ‹Ÿä¸€ä¸ªå»¶è¿Ÿæ—¶é—´ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/fb3b97a0dd844ce298bed8010040a39d" alt="image-20210716150234787"></p><p>æ­¤æ—¶ï¼ŒorderId=101çš„è®¢å•ï¼Œå…³è”çš„æ˜¯idä¸º1çš„ç”¨æˆ·ï¼Œè°ƒç”¨æ—¶é•¿ä¸º60msï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/a0b050e471024caa9c5e444c6b22a6d0" alt="image-20210716150510956"></p><p>orderId=102çš„è®¢å•ï¼Œå…³è”çš„æ˜¯idä¸º2çš„ç”¨æˆ·ï¼Œè°ƒç”¨æ—¶é•¿ä¸ºéå¸¸çŸ­ï¼›</p><p><img src="https://s1.vika.cn/space/2023/03/18/68c9778cd40b4b098500b5046457a9ac" alt="image-20210716150605208"></p><h4 id="she-zhi-rong-duan-gui-ze" id="è®¾ç½®ç†”æ–­è§„åˆ™">è®¾ç½®ç†”æ–­è§„åˆ™</h4><p>ä¸‹é¢ï¼Œç»™feignæ¥å£è®¾ç½®é™çº§è§„åˆ™ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/e77fed40ddd843808bb7278e8ea6c3d3" alt="image-20210716150654094"></p><p>è§„åˆ™ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/9379f2abf0d44ccebf8ed7cc68f48eb2" alt="image-20210716150740434"></p><p>è¶…è¿‡50msçš„è¯·æ±‚éƒ½ä¼šè¢«è®¤ä¸ºæ˜¯æ…¢è¯·æ±‚</p><h4 id="ce-shi" id="æµ‹è¯•">æµ‹è¯•</h4><p>åœ¨æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost:8088/order/101%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%88%B7%E6%96%B05%E6%AC%A1%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%8F%91%E7%8E%B0%EF%BC%9A">http://localhost:8088/order/101ï¼Œå¿«é€Ÿåˆ·æ–°5æ¬¡ï¼Œå¯ä»¥å‘ç°ï¼š</a></p><p><img src="https://s1.vika.cn/space/2023/03/18/6ac0732f325b4d13af7c5f7998b342c7" alt="image-20210716150911004"></p><p>è§¦å‘äº†ç†”æ–­ï¼Œè¯·æ±‚æ—¶é•¿ç¼©çŸ­è‡³5msï¼Œå¿«é€Ÿå¤±è´¥äº†ï¼Œå¹¶ä¸”èµ°é™çº§é€»è¾‘ï¼Œè¿”å›çš„null</p><p>åœ¨æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost:8088/order/102%EF%BC%8C%E7%AB%9F%E7%84%B6%E4%B9%9F%E8%A2%AB%E7%86%94%E6%96%AD%E4%BA%86%EF%BC%9A">http://localhost:8088/order/102ï¼Œç«Ÿç„¶ä¹Ÿè¢«ç†”æ–­äº†ï¼š</a></p><p><img src="https://s1.vika.cn/space/2023/03/18/7c8821df9987417898fa97f83a6d6511" alt="image-20210716151107785"></p><h3 id="yi-chang-bi-li-yi-chang-shu" id="å¼‚å¸¸æ¯”ä¾‹ã€å¼‚å¸¸æ•°">å¼‚å¸¸æ¯”ä¾‹ã€å¼‚å¸¸æ•°</h3><p><strong>å¼‚å¸¸æ¯”ä¾‹æˆ–å¼‚å¸¸æ•°</strong>ï¼šç»Ÿè®¡æŒ‡å®šæ—¶é—´å†…çš„è°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨æ¬¡æ•°è¶…è¿‡æŒ‡å®šè¯·æ±‚æ•°ï¼Œå¹¶ä¸”å‡ºç°å¼‚å¸¸çš„æ¯”ä¾‹è¾¾åˆ°è®¾å®šçš„æ¯”ä¾‹é˜ˆå€¼ï¼ˆæˆ–è¶…è¿‡æŒ‡å®šå¼‚å¸¸æ•°ï¼‰ï¼Œåˆ™è§¦å‘ç†”æ–­ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªå¼‚å¸¸æ¯”ä¾‹è®¾ç½®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/4ec6387e636244de8d3bd2f6bdba0492" alt="image-20210716131430682"></p><p>è§£è¯»ï¼šç»Ÿè®¡æœ€è¿‘1000mså†…çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚é‡è¶…è¿‡10æ¬¡ï¼Œå¹¶ä¸”å¼‚å¸¸æ¯”ä¾‹ä¸ä½äº0.4ï¼Œåˆ™è§¦å‘ç†”æ–­ã€‚</p><p>ä¸€ä¸ªå¼‚å¸¸æ•°è®¾ç½®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/117cec9612a04c38a3180b611694b323" alt="image-20210716131522912"></p><p>è§£è¯»ï¼šç»Ÿè®¡æœ€è¿‘1000mså†…çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚é‡è¶…è¿‡10æ¬¡ï¼Œå¹¶ä¸”å¼‚å¸¸æ¯”ä¾‹ä¸ä½äº2æ¬¡ï¼Œåˆ™è§¦å‘ç†”æ–­ã€‚</p><p><strong>æ¡ˆä¾‹</strong></p><blockquote><p>éœ€æ±‚ï¼šç»™ UserClientçš„æŸ¥è¯¢ç”¨æˆ·æ¥å£è®¾ç½®é™çº§è§„åˆ™ï¼Œç»Ÿè®¡æ—¶é—´ä¸º1ç§’ï¼Œæœ€å°è¯·æ±‚æ•°é‡ä¸º5ï¼Œå¤±è´¥é˜ˆå€¼æ¯”ä¾‹ä¸º0.4ï¼Œç†”æ–­æ—¶é•¿ä¸º5s</p></blockquote><h4 id="she-zhi-yi-chang-qing-qiu" id="è®¾ç½®å¼‚å¸¸è¯·æ±‚">è®¾ç½®å¼‚å¸¸è¯·æ±‚</h4><p>é¦–å…ˆï¼Œä¿®æ”¹user-serviceä¸­çš„/user/{id}è¿™ä¸ªæ¥å£çš„ä¸šåŠ¡ã€‚æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œä»¥è§¦å‘å¼‚å¸¸æ¯”ä¾‹çš„ç†”æ–­ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/98c2aa50ad58418fbae3caafd18aae7e" alt="image-20210716151348183"></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œid ä¸º 2æ—¶ï¼Œå°±ä¼šè§¦å‘å¼‚å¸¸</p><h4 id="she-zhi-rong-duan-gui-ze-1" id="è®¾ç½®ç†”æ–­è§„åˆ™-2">è®¾ç½®ç†”æ–­è§„åˆ™</h4><p>ä¸‹é¢ï¼Œç»™feignæ¥å£è®¾ç½®é™çº§è§„åˆ™ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/e77fed40ddd843808bb7278e8ea6c3d3" alt="image-20210716150654094"></p><p>è§„åˆ™ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/c0e45662b9d1402bac6226186ae27a50" alt="image-20210716151538785"></p><p>åœ¨5æ¬¡è¯·æ±‚ä¸­ï¼Œåªè¦å¼‚å¸¸æ¯”ä¾‹è¶…è¿‡0.4ï¼Œä¹Ÿå°±æ˜¯æœ‰2æ¬¡ä»¥ä¸Šçš„å¼‚å¸¸ï¼Œå°±ä¼šè§¦å‘ç†”æ–­ã€‚</p><h4 id="ce-shi-1" id="æµ‹è¯•-2">æµ‹è¯•</h4><p>åœ¨æµè§ˆå™¨å¿«é€Ÿè®¿é—®ï¼š<a href="http://localhost:8088/order/102%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%88%B7%E6%96%B05%E6%AC%A1%EF%BC%8C%E8%A7%A6%E5%8F%91%E7%86%94%E6%96%AD%EF%BC%9A">http://localhost:8088/order/102ï¼Œå¿«é€Ÿåˆ·æ–°5æ¬¡ï¼Œè§¦å‘ç†”æ–­ï¼š</a></p><p><img src="https://s1.vika.cn/space/2023/03/18/01e23105f0a947af95f603313d2fee90" alt="image-20210716151722916"></p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å»è®¿é—®æœ¬æ¥åº”è¯¥æ­£å¸¸çš„103ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/d68aae0f42374f019d3e8f17b63e3d10" alt="image-20210716151844817"></p><h1 id="shou-quan-gui-ze">æˆæƒè§„åˆ™</h1><p>æˆæƒè§„åˆ™å¯ä»¥å¯¹è¯·æ±‚æ–¹æ¥æºåšåˆ¤æ–­å’Œæ§åˆ¶ã€‚</p><h2 id="shou-quan-gui-ze-1" id="æˆæƒè§„åˆ™">æˆæƒè§„åˆ™</h2><h3 id="ji-ben-gui-ze" id="åŸºæœ¬è§„åˆ™">åŸºæœ¬è§„åˆ™</h3><p>æˆæƒè§„åˆ™å¯ä»¥å¯¹è°ƒç”¨æ–¹çš„æ¥æºåšæ§åˆ¶ï¼Œæœ‰ç™½åå•å’Œé»‘åå•ä¸¤ç§æ–¹å¼ã€‚</p><ul><li><p>ç™½åå•ï¼šæ¥æºï¼ˆoriginï¼‰åœ¨ç™½åå•å†…çš„è°ƒç”¨è€…å…è®¸è®¿é—®</p></li><li><p>é»‘åå•ï¼šæ¥æºï¼ˆoriginï¼‰åœ¨é»‘åå•å†…çš„è°ƒç”¨è€…ä¸å…è®¸è®¿é—®</p></li></ul><p>ç‚¹å‡»å·¦ä¾§èœå•çš„æˆæƒï¼Œå¯ä»¥çœ‹åˆ°æˆæƒè§„åˆ™ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/4015c75c611f44d28489bad55cf4482b" alt="image-20210716152010750"></p><ul><li><p>èµ„æºåï¼šå°±æ˜¯å—ä¿æŠ¤çš„èµ„æºï¼Œä¾‹å¦‚/order/{orderId}</p></li><li><p>æµæ§åº”ç”¨ï¼šæ˜¯æ¥æºè€…çš„åå•ï¼Œ</p><ul><li>å¦‚æœæ˜¯å‹¾é€‰ç™½åå•ï¼Œåˆ™åå•ä¸­çš„æ¥æºè¢«è®¸å¯è®¿é—®ã€‚</li><li>å¦‚æœæ˜¯å‹¾é€‰é»‘åå•ï¼Œåˆ™åå•ä¸­çš„æ¥æºè¢«ç¦æ­¢è®¿é—®ã€‚</li></ul></li></ul><p>æ¯”å¦‚ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/fdd14c1307cc4e85bd2b1e680709079e" alt="image-20210716152349191"></p><p>æˆ‘ä»¬å…è®¸è¯·æ±‚ä»gatewayåˆ°order-serviceï¼Œä¸å…è®¸æµè§ˆå™¨è®¿é—®order-serviceï¼Œé‚£ä¹ˆç™½åå•ä¸­å°±è¦å¡«å†™<strong>ç½‘å…³çš„æ¥æºåç§°ï¼ˆoriginï¼‰</strong>ã€‚</p><h3 id="ru-he-huo-qu-origin" id="å¦‚ä½•è·å–origin">å¦‚ä½•è·å–origin</h3><ul><li>Sentinelæ˜¯é€šè¿‡RequestOriginParserè¿™ä¸ªæ¥å£çš„parseOriginæ¥è·å–è¯·æ±‚çš„æ¥æºçš„ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RequestOriginParser</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»è¯·æ±‚requestå¯¹è±¡ä¸­è·å–originï¼Œè·å–æ–¹å¼è‡ªå®šä¹‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">parseOrigin</span><span class="params">(HttpServletRequest request)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯ä»requestå¯¹è±¡ä¸­ï¼Œè·å–è¯·æ±‚è€…çš„originå€¼å¹¶è¿”å›ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œsentinelä¸ç®¡è¯·æ±‚è€…ä»å“ªé‡Œæ¥ï¼Œè¿”å›å€¼æ°¸è¿œæ˜¯defaultï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€åˆ‡è¯·æ±‚çš„æ¥æºéƒ½è¢«è®¤ä¸ºæ˜¯ä¸€æ ·çš„å€¼defaultã€‚</p><ul><li>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰è¿™ä¸ªæ¥å£çš„å®ç°ï¼Œè®©<strong>ä¸åŒçš„è¯·æ±‚ï¼Œè¿”å›ä¸åŒçš„origin</strong>ã€‚</li></ul><p>ä¾‹å¦‚order-serviceæœåŠ¡ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªRequestOriginParserçš„å®ç°ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.order.sentinel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.adapter.spring.webmvc.callback.RequestOriginParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeaderOriginParser</span> <span class="keyword">implements</span> <span class="title class_">RequestOriginParser</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">parseOrigin</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–è¯·æ±‚å¤´</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">origin</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;origin&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.éç©ºåˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(origin)) &#123;</span><br><span class="line">            origin = <span class="string">&quot;blank&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> origin;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå°è¯•ä»request-headerä¸­è·å–originå€¼ã€‚</p><h3 id="gei-wang-guan-tian-jia-qing-qiu-tou" id="ç»™ç½‘å…³æ·»åŠ è¯·æ±‚å¤´">ç»™ç½‘å…³æ·»åŠ è¯·æ±‚å¤´</h3><ul><li><p>æ—¢ç„¶è·å–è¯·æ±‚originçš„æ–¹å¼æ˜¯ä»reques-headerä¸­è·å–originå€¼ï¼Œæˆ‘ä»¬å¿…é¡»è®©<strong>æ‰€æœ‰ä»gatewayè·¯ç”±åˆ°å¾®æœåŠ¡çš„è¯·æ±‚éƒ½å¸¦ä¸Šoriginå¤´</strong>ã€‚</p></li><li><p>è¿™ä¸ªéœ€è¦åˆ©ç”¨ä¹‹å‰å­¦ä¹ çš„ä¸€ä¸ªGatewayFilteræ¥å®ç°ï¼ŒAddRequestHeaderGatewayFilterã€‚</p></li></ul><p>ä¿®æ”¹gatewayæœåŠ¡ä¸­çš„application.ymlï¼Œæ·»åŠ ä¸€ä¸ªdefaultFilterï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">default-filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestHeader=origin,gateway</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">       <span class="comment"># ...ç•¥</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œä»gatewayè·¯ç”±çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šå¸¦ä¸Šoriginå¤´ï¼Œå€¼ä¸ºgatewayã€‚è€Œä»å…¶å®ƒåœ°æ–¹åˆ°è¾¾å¾®æœåŠ¡çš„è¯·æ±‚åˆ™æ²¡æœ‰è¿™ä¸ªå¤´ã€‚</p><h3 id="pei-zhi-shou-quan-gui-ze" id="é…ç½®æˆæƒè§„åˆ™">é…ç½®æˆæƒè§„åˆ™</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæˆæƒè§„åˆ™ï¼Œæ”¾è¡Œoriginå€¼ä¸ºgatewayçš„è¯·æ±‚ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/18/0d8d5da463bb4bacb3bfdd7c1ebdb2fc" alt="image-20210716153250134"></p><p>é…ç½®å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/b06c20cf74d4480283f3ea3800a503bc" alt="image-20210716153301069"></p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç›´æ¥è·³è¿‡ç½‘å…³ï¼Œè®¿é—®order-serviceæœåŠ¡ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/17ff60570bce45cf95672bdb62539706" alt="image-20210716153348396"></p><p>é€šè¿‡ç½‘å…³è®¿é—®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/8688b5f15eae4bca88916afa6fd11308" alt="image-20210716153434095"></p><h2 id="zi-ding-yi-yi-chang-jie-guo" id="è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ">è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘ç”Ÿé™æµã€é™çº§ã€æˆæƒæ‹¦æˆªæ—¶ï¼Œéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸åˆ°è°ƒç”¨æ–¹ã€‚å¼‚å¸¸ç»“æœéƒ½æ˜¯flow limmitingï¼ˆé™æµï¼‰ã€‚è¿™æ ·ä¸å¤Ÿå‹å¥½ï¼Œæ— æ³•å¾—çŸ¥æ˜¯é™æµè¿˜æ˜¯é™çº§è¿˜æ˜¯æˆæƒæ‹¦æˆªã€‚</p><h3 id="yi-chang-lei-xing" id="å¼‚å¸¸ç±»å‹">å¼‚å¸¸ç±»å‹</h3><p>è€Œå¦‚æœè¦è‡ªå®šä¹‰å¼‚å¸¸æ—¶çš„è¿”å›ç»“æœï¼Œéœ€è¦å®ç°BlockExceptionHandleræ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlockExceptionHandler</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†è¯·æ±‚è¢«é™æµã€é™çº§ã€æˆæƒæ‹¦æˆªæ—¶æŠ›å‡ºçš„å¼‚å¸¸ï¼šBlockException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, BlockException e)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li>HttpServletRequest requestï¼šrequestå¯¹è±¡</li><li>HttpServletResponse responseï¼šresponseå¯¹è±¡</li><li>BlockException eï¼šè¢«sentinelæ‹¦æˆªæ—¶æŠ›å‡ºçš„å¼‚å¸¸</li></ul><p>è¿™é‡Œçš„BlockExceptionåŒ…å«å¤šä¸ªä¸åŒçš„å­ç±»ï¼š</p><table><thead><tr><th><strong>å¼‚å¸¸</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>FlowException</td><td>é™æµå¼‚å¸¸</td></tr><tr><td>ParamFlowException</td><td>çƒ­ç‚¹å‚æ•°é™æµçš„å¼‚å¸¸</td></tr><tr><td>DegradeException</td><td>é™çº§å¼‚å¸¸</td></tr><tr><td>AuthorityException</td><td>æˆæƒè§„åˆ™å¼‚å¸¸</td></tr><tr><td>SystemBlockException</td><td>ç³»ç»Ÿè§„åˆ™å¼‚å¸¸</td></tr></tbody></table><h3 id="zi-ding-yi-yi-chang-chu-li" id="è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†">è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†</h3><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°±åœ¨order-serviceå®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.order.sentinel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.adapter.spring.webmvc.callback.BlockExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.BlockException;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.authority.AuthorityException;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.degrade.DegradeException;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.flow.FlowException;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.flow.param.ParamFlowException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SentinelExceptionHandler</span> <span class="keyword">implements</span> <span class="title class_">BlockExceptionHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, BlockException e)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;æœªçŸ¥å¼‚å¸¸&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">status</span> <span class="operator">=</span> <span class="number">429</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> FlowException) &#123;</span><br><span class="line">            msg = <span class="string">&quot;è¯·æ±‚è¢«é™æµäº†&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ParamFlowException) &#123;</span><br><span class="line">            msg = <span class="string">&quot;è¯·æ±‚è¢«çƒ­ç‚¹å‚æ•°é™æµ&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> DegradeException) &#123;</span><br><span class="line">            msg = <span class="string">&quot;è¯·æ±‚è¢«é™çº§äº†&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> AuthorityException) &#123;</span><br><span class="line">            msg = <span class="string">&quot;æ²¡æœ‰æƒé™è®¿é—®&quot;</span>;</span><br><span class="line">            status = <span class="number">401</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">        response.setStatus(status);</span><br><span class="line">        response.getWriter().println(<span class="string">&quot;&#123;\&quot;msg\&quot;: &quot;</span> + msg + <span class="string">&quot;, \&quot;status\&quot;: &quot;</span> + status + <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æµ‹è¯•ï¼Œåœ¨ä¸åŒåœºæ™¯ä¸‹ï¼Œä¼šè¿”å›ä¸åŒçš„å¼‚å¸¸æ¶ˆæ¯.</p><p>é™æµï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/705fd78435df420f9bc9319a149ad6c6" alt="image-20210716153938887"></p><p>æˆæƒæ‹¦æˆªæ—¶ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/0298196a138045fe82b47e8b59728831" alt="image-20210716154012736"></p><h2 id="zong-jie-5" id="æ€»ç»“-6">æ€»ç»“</h2><ol><li>è·å–è¯·æ±‚æ¥æºçš„æ¥å£æ—¶ä»€ä¹ˆï¼Ÿ<ul><li>RequestOriginParser</li></ul></li><li>å¤„ç†BlockExceptionçš„æ¥å£æ˜¯ä»€ä¹ˆï¼Ÿ<ul><li>BlockExceptionHandler</li></ul></li></ol><h1 id="gui-ze-chi-jiu-hua">è§„åˆ™æŒä¹…åŒ–</h1><p>ç°åœ¨ï¼Œsentinelçš„æ‰€æœ‰è§„åˆ™éƒ½æ˜¯å†…å­˜å­˜å‚¨ï¼Œé‡å¯åæ‰€æœ‰è§„åˆ™éƒ½ä¼šä¸¢å¤±ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿è¿™äº›è§„åˆ™çš„æŒä¹…åŒ–ï¼Œé¿å…ä¸¢å¤±ã€‚</p><h2 id="gui-ze-guan-li-mo-shi" id="è§„åˆ™ç®¡ç†æ¨¡å¼">è§„åˆ™ç®¡ç†æ¨¡å¼</h2><p>è§„åˆ™æ˜¯å¦èƒ½æŒä¹…åŒ–ï¼Œå–å†³äºè§„åˆ™ç®¡ç†æ¨¡å¼ï¼Œsentinelæ”¯æŒä¸‰ç§è§„åˆ™ç®¡ç†æ¨¡å¼ï¼š</p><ul><li>åŸå§‹æ¨¡å¼ï¼šSentinelçš„é»˜è®¤æ¨¡å¼ï¼Œå°†è§„åˆ™ä¿å­˜åœ¨å†…å­˜ï¼Œé‡å¯æœåŠ¡ä¼šä¸¢å¤±ã€‚</li><li>pullæ¨¡å¼</li><li>pushæ¨¡å¼</li></ul><h3 id="pull-mo-shi" id="pullæ¨¡å¼">pullæ¨¡å¼</h3><p>pullæ¨¡å¼ï¼šæ§åˆ¶å°å°†é…ç½®çš„è§„åˆ™æ¨é€åˆ°Sentinelå®¢æˆ·ç«¯ï¼Œè€Œå®¢æˆ·ç«¯ä¼šå°†é…ç½®è§„åˆ™ä¿å­˜åœ¨æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­ã€‚ä»¥åä¼šå®šæ—¶å»æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­æŸ¥è¯¢ï¼Œæ›´æ–°æœ¬åœ°è§„åˆ™ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/18/289d8bbd692b440d8fe6a121baac6c2c" alt="image-20210716154155238"></p><h3 id="push-mo-shi-tui-jian" id="pushæ¨¡å¼-ï¼ˆæ¨èï¼‰">pushæ¨¡å¼ ï¼ˆæ¨èï¼‰</h3><p>pushæ¨¡å¼ï¼šæ§åˆ¶å°å°†é…ç½®è§„åˆ™æ¨é€åˆ°è¿œç¨‹é…ç½®ä¸­å¿ƒï¼Œä¾‹å¦‚Nacosã€‚Sentinelå®¢æˆ·ç«¯ç›‘å¬Nacosï¼Œè·å–é…ç½®å˜æ›´çš„æ¨é€æ¶ˆæ¯ï¼Œå®Œæˆæœ¬åœ°é…ç½®æ›´æ–°ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/18/e406c7b33f624a32a6165152c5863394" alt="image-20210716154215456"></p><h2 id="shi-xian-push-mo-shi-can-kao-xia-wen-sentinel-gui-ze-chi-jiu-hua" id="å®ç°pushæ¨¡å¼ï¼ˆå‚è€ƒä¸‹æ–‡Sentinel-è§„åˆ™æŒä¹…åŒ–ï¼‰">å®ç°pushæ¨¡å¼ï¼ˆå‚è€ƒä¸‹æ–‡Sentinel è§„åˆ™æŒä¹…åŒ–ï¼‰</h2><p>è¯¦ç»†æ­¥éª¤å¯ä»¥å‚è€ƒè¯¾å‰èµ„æ–™çš„ã€Šsentinelè§„åˆ™æŒä¹…åŒ–ã€‹ï¼š</p><h1 id="sentinel-gui-ze-chi-jiu-hua-push-mo-shi">Sentinel è§„åˆ™æŒä¹…åŒ–ï¼ˆpushæ¨¡å¼ï¼‰</h1><h2 id="xiu-gai-order-service-fu-wu" id="ä¿®æ”¹order-serviceæœåŠ¡">ä¿®æ”¹order-serviceæœåŠ¡</h2><p>ä¿®æ”¹OrderServiceï¼Œè®©å…¶ç›‘å¬Nacosä¸­çš„sentinelè§„åˆ™é…ç½®ã€‚</p><p>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><h3 id="yin-ru-yi-lai" id="å¼•å…¥ä¾èµ–">å¼•å…¥ä¾èµ–</h3><p>åœ¨order-serviceä¸­å¼•å…¥sentinelç›‘å¬nacosçš„ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="pei-zhi-nacos-di-zhi" id="é…ç½®nacosåœ°å€">é…ç½®nacosåœ°å€</h3><p>åœ¨order-serviceä¸­çš„application.ymlæ–‡ä»¶é…ç½®nacosåœ°å€åŠç›‘å¬çš„é…ç½®ä¿¡æ¯ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">flow:</span></span><br><span class="line">          <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacosåœ°å€</span></span><br><span class="line">            <span class="attr">dataId:</span> <span class="string">orderservice-flow-rules</span></span><br><span class="line">            <span class="attr">groupId:</span> <span class="string">SENTINEL_GROUP</span></span><br><span class="line">            <span class="attr">rule-type:</span> <span class="string">flow</span> <span class="comment"># è¿˜å¯ä»¥æ˜¯ï¼šdegradeã€authorityã€param-flow</span></span><br></pre></td></tr></table></figure><h2 id="xiu-gai-sentinel-dashboard-yuan-ma" id="ä¿®æ”¹sentinel-dashboardæºç ">ä¿®æ”¹sentinel-dashboardæºç </h2><p>SentinelDashboardé»˜è®¤ä¸æ”¯æŒnacosçš„æŒä¹…åŒ–ï¼Œéœ€è¦ä¿®æ”¹æºç ã€‚</p><h3 id="jie-ya-1" id="è§£å‹-2">è§£å‹</h3><p>è§£å‹è¯¾å‰èµ„æ–™ä¸­çš„sentinelæºç åŒ…ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/4cb182e8fe7d44e89ac6bc3a861c176f" alt="image-20210618201340086"></p><p>ç„¶åå¹¶ç”¨IDEAæ‰“å¼€è¿™ä¸ªé¡¹ç›®ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/23194f17471a481cb268e9178fa7f175" alt="image-20210618201412878"></p><h3 id="xiu-gai-nacos-yi-lai" id="ä¿®æ”¹nacosä¾èµ–">ä¿®æ”¹nacosä¾èµ–</h3><p>åœ¨sentinel-dashboardæºç çš„pomæ–‡ä»¶ä¸­ï¼Œnacosçš„ä¾èµ–é»˜è®¤çš„scopeæ˜¯testï¼Œåªèƒ½åœ¨æµ‹è¯•æ—¶ä½¿ç”¨ï¼Œè¿™é‡Œè¦å»é™¤ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/660de99ef32f49a28b1d5faac29fcb70" alt="image-20210618201607831"></p><p>å°†sentinel-datasource-nacosä¾èµ–çš„scopeå»æ‰ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="tian-jia-nacos-zhi-chi" id="æ·»åŠ nacosæ”¯æŒ">æ·»åŠ nacosæ”¯æŒ</h3><p>åœ¨sentinel-dashboardçš„teståŒ…ä¸‹ï¼Œå·²ç»ç¼–å†™äº†å¯¹nacosçš„æ”¯æŒï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ‹·è´åˆ°mainä¸‹ã€‚</p><p><img src="https://s1.vika.cn/space/2023/03/18/6635f1056b5848a7a5e8e124956ff2dd" alt="image-20210618201726280"></p><h3 id="xiu-gai-nacos-di-zhi" id="ä¿®æ”¹nacosåœ°å€">ä¿®æ”¹nacosåœ°å€</h3><p>ç„¶åï¼Œè¿˜éœ€è¦ä¿®æ”¹æµ‹è¯•ä»£ç ä¸­çš„NacosConfigç±»ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/bfcc66c9772949dcbfc2dceff7374229" alt="image-20210618201912078"></p><p>ä¿®æ”¹å…¶ä¸­çš„nacosåœ°å€ï¼Œè®©å…¶è¯»å–application.propertiesä¸­çš„é…ç½®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/abd7562444bf4875ae0ec2a0a8e39492" alt="image-20210618202047575"></p><p>åœ¨sentinel-dashboardçš„application.propertiesä¸­æ·»åŠ nacosåœ°å€é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nacos.addr</span>=<span class="string">localhost:8848</span></span><br></pre></td></tr></table></figure><h3 id="pei-zhi-nacos-shu-ju-yuan" id="é…ç½®nacosæ•°æ®æº">é…ç½®nacosæ•°æ®æº</h3><p>å¦å¤–ï¼Œè¿˜éœ€è¦ä¿®æ”¹com.alibaba.csp.sentinel.dashboard.controller.v2åŒ…ä¸‹çš„FlowControllerV2ç±»ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/ad3302beb55c422589930694fa51087b" alt="image-20210618202322301"></p><p>è®©æˆ‘ä»¬æ·»åŠ çš„Nacosæ•°æ®æºç”Ÿæ•ˆï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/099f5989a3814c2c9a35e706960d3345" alt="image-20210618202334536"></p><h3 id="xiu-gai-qian-duan-ye-mian" id="ä¿®æ”¹å‰ç«¯é¡µé¢">ä¿®æ”¹å‰ç«¯é¡µé¢</h3><p>æ¥ä¸‹æ¥ï¼Œè¿˜è¦ä¿®æ”¹å‰ç«¯é¡µé¢ï¼Œæ·»åŠ ä¸€ä¸ªæ”¯æŒnacosçš„èœå•ã€‚</p><p>ä¿®æ”¹src/main/webapp/resources/app/scripts/directives/sidebar/ç›®å½•ä¸‹çš„sidebar.htmlæ–‡ä»¶ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/b79a1e4d4fec453ebbd9adc0e4c2342d" alt="image-20210618202433356"></p><p>å°†å…¶ä¸­çš„è¿™éƒ¨åˆ†æ³¨é‡Šæ‰“å¼€ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/41f58be862164275924ebc147d8af8d8" alt="image-20210618202449881"></p><p>ä¿®æ”¹å…¶ä¸­çš„æ–‡æœ¬ï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/cc9acf2de3364b0b9ba92b9cf204fe23" alt="image-20210618202501928"></p><h3 id="zhong-xin-bian-yi-da-bao-xiang-mu" id="é‡æ–°ç¼–è¯‘ã€æ‰“åŒ…é¡¹ç›®">é‡æ–°ç¼–è¯‘ã€æ‰“åŒ…é¡¹ç›®</h3><p>è¿è¡ŒIDEAä¸­çš„mavenæ’ä»¶ï¼Œç¼–è¯‘å’Œæ‰“åŒ…ä¿®æ”¹å¥½çš„Sentinel-Dashboardï¼š</p><p><img src="https://s1.vika.cn/space/2023/03/18/a68c719bfa5e43ffa18e6f1949ddad3e" alt="image-20210618202701492"></p><h3 id="qi-dong" id="å¯åŠ¨">å¯åŠ¨</h3><p>å¯åŠ¨æ–¹å¼è·Ÿå®˜æ–¹ä¸€æ ·ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar sentinel-dashboard.jar</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦ä¿®æ”¹nacosåœ°å€ï¼Œéœ€è¦æ·»åŠ å‚æ•°ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar -Dnacos.addr=localhost:8848 sentinel-dashboard.jar</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å¾®æœåŠ¡ä¿æŠ¤ç¬”è®°</summary>
    
    
    
    <category term="Java" scheme="https://www.taoyaopc.live/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>Idea å¿«æ·é”®</title>
    <link href="https://www.taoyaopc.live/posts/2f8dc7f4.html"/>
    <id>https://www.taoyaopc.live/posts/2f8dc7f4.html</id>
    <published>2023-03-14T13:30:00.000Z</published>
    <updated>2023-03-21T06:15:23.636Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ctrl-alt">Ctrl + Alt</h1><h2 id="ctrl-alt-b" id="Ctrl-Alt-B">Ctrl + Alt + B</h2><ul><li>åŠŸèƒ½ï¼šæ‰¾åˆ°å½“å‰æ–¹æ³•çš„å®ç°ç±»</li></ul><h2 id="ctrl-alt-m" id="Ctrl-Alt-M">Ctrl + Alt + M</h2><ul><li>åŠŸèƒ½ï¼šå¿«é€Ÿå°è£…é€‰ä¸­çš„ä»£ç ä¸ºå‡½æ•°</li></ul><h1 id="ctrl-shift">Ctrl + Shift</h1><h2 id="ctrl-shift-u" id="Ctrl-Shift-u">Ctrl + Shift + u</h2><ul><li>åŠŸèƒ½ï¼šè½¬æ¢å¤§å°å†™</li></ul>]]></content>
    
    
    <summary type="html">Idea å¸¸ç”¨å¿«æ·é”®</summary>
    
    
    
    <category term="Java" scheme="https://www.taoyaopc.live/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>ElasticSearch3</title>
    <link href="https://www.taoyaopc.live/posts/72dc8cc7.html"/>
    <id>https://www.taoyaopc.live/posts/72dc8cc7.html</id>
    <published>2023-03-14T12:30:00.000Z</published>
    <updated>2023-03-21T06:15:23.626Z</updated>
    
    <content type="html"><![CDATA[<h1 id="fen-bu-shi-sou-suo-yin-qing-03">åˆ†å¸ƒå¼æœç´¢å¼•æ“03</h1><h1 id="shu-ju-ju-he">æ•°æ®èšåˆ</h1><blockquote><p>**<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html">èšåˆï¼ˆ</a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html">aggregations</a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html">ï¼‰</a>**å¯ä»¥è®©æˆ‘ä»¬æå…¶æ–¹ä¾¿çš„å®ç°å¯¹æ•°æ®çš„ç»Ÿè®¡ã€åˆ†æã€è¿ç®—ã€‚ä¾‹å¦‚ï¼š</p></blockquote><ul><li>ä»€ä¹ˆå“ç‰Œçš„æ‰‹æœºæœ€å—æ¬¢è¿ï¼Ÿ</li><li>è¿™äº›æ‰‹æœºçš„å¹³å‡ä»·æ ¼ã€æœ€é«˜ä»·æ ¼ã€æœ€ä½ä»·æ ¼ï¼Ÿ</li><li>è¿™äº›æ‰‹æœºæ¯æœˆçš„é”€å”®æƒ…å†µå¦‚ä½•ï¼Ÿ</li></ul><p>å®ç°è¿™äº›ç»Ÿè®¡åŠŸèƒ½çš„æ¯”æ•°æ®åº“çš„sqlè¦æ–¹ä¾¿çš„å¤šï¼Œè€Œä¸”æŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«ï¼Œå¯ä»¥å®ç°è¿‘å®æ—¶æœç´¢æ•ˆæœã€‚</p><h2 id="ju-he-de-chong-lei" id="èšåˆçš„ç§ç±»">èšåˆçš„ç§ç±»</h2><p>èšåˆå¸¸è§çš„æœ‰ä¸‰ç±»ï¼š</p><ul><li><p>**æ¡¶ï¼ˆBucketï¼‰**èšåˆï¼šç”¨æ¥å¯¹æ–‡æ¡£åšåˆ†ç»„</p><ul><li>TermAggregationï¼šæŒ‰ç…§æ–‡æ¡£å­—æ®µå€¼åˆ†ç»„ï¼Œä¾‹å¦‚æŒ‰ç…§å“ç‰Œå€¼åˆ†ç»„ã€æŒ‰ç…§å›½å®¶åˆ†ç»„</li><li>Date Histogramï¼šæŒ‰ç…§æ—¥æœŸé˜¶æ¢¯åˆ†ç»„ï¼Œä¾‹å¦‚ä¸€å‘¨ä¸ºä¸€ç»„ï¼Œæˆ–è€…ä¸€æœˆä¸ºä¸€ç»„</li></ul></li><li><p>**åº¦é‡ï¼ˆMetricï¼‰**èšåˆï¼šç”¨ä»¥è®¡ç®—ä¸€äº›å€¼ï¼Œæ¯”å¦‚ï¼šæœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ç­‰</p><ul><li>Avgï¼šæ±‚å¹³å‡å€¼</li><li>Maxï¼šæ±‚æœ€å¤§å€¼</li><li>Minï¼šæ±‚æœ€å°å€¼</li><li>Statsï¼šåŒæ—¶æ±‚maxã€minã€avgã€sumç­‰</li></ul></li><li><p>**ç®¡é“ï¼ˆpipelineï¼‰**èšåˆï¼šå…¶å®ƒèšåˆçš„ç»“æœä¸ºåŸºç¡€åšèšåˆ</p></li></ul><blockquote><p>**æ³¨æ„ï¼š**å‚åŠ èšåˆçš„å­—æ®µå¿…é¡»æ˜¯keywordã€æ—¥æœŸã€æ•°å€¼ã€å¸ƒå°”ç±»å‹</p></blockquote><h2 id="dsl-shi-xian-ju-he" id="DSLå®ç°èšåˆ">DSLå®ç°èšåˆ</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬è¦ç»Ÿè®¡æ‰€æœ‰æ•°æ®ä¸­çš„é…’åº—å“ç‰Œæœ‰å‡ ç§ï¼Œå…¶å®å°±æ˜¯æŒ‰ç…§å“ç‰Œå¯¹æ•°æ®åˆ†ç»„ã€‚æ­¤æ—¶å¯ä»¥æ ¹æ®é…’åº—å“ç‰Œçš„åç§°åšèšåˆï¼Œä¹Ÿå°±æ˜¯Bucketèšåˆã€‚</p><h3 id="bucket-ju-he-yu-fa" id="Bucketèšåˆè¯­æ³•">Bucketèšåˆè¯­æ³•</h3><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span>Â <span class="number">0</span><span class="punctuation">,</span>Â Â <span class="comment">//Â è®¾ç½®sizeä¸º0ï¼Œç»“æœä¸­ä¸åŒ…å«æ–‡æ¡£ï¼ŒåªåŒ…å«èšåˆç»“æœ</span></span><br><span class="line">Â Â <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="comment">//Â å®šä¹‰èšåˆ</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;brandAgg&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="comment">//ç»™èšåˆèµ·ä¸ªåå­—</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="comment">//Â èšåˆçš„ç±»å‹ï¼ŒæŒ‰ç…§å“ç‰Œå€¼èšåˆï¼Œæ‰€ä»¥é€‰æ‹©term</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;brand&quot;</span><span class="punctuation">,</span>Â <span class="comment">//Â å‚ä¸èšåˆçš„å­—æ®µ</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span>Â <span class="number">20</span>Â <span class="comment">//Â å¸Œæœ›è·å–çš„èšåˆç»“æœæ•°é‡</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/c319e384729c4b2e947c37ff6c121b29" alt="image-20210723171948228"></p><h3 id="ju-he-jie-guo-pai-xu" id="èšåˆç»“æœæ’åº">èšåˆç»“æœæ’åº</h3><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒBucketèšåˆä¼šç»Ÿè®¡Bucketå†…çš„æ–‡æ¡£æ•°é‡ï¼Œè®°ä¸º_countï¼Œå¹¶ä¸”æŒ‰ç…§_counté™åºæ’åºã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥æŒ‡å®šorderå±æ€§ï¼Œè‡ªå®šä¹‰èšåˆçš„æ’åºæ–¹å¼ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span>Â <span class="number">0</span><span class="punctuation">,</span>Â </span><br><span class="line">Â Â <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;brandAgg&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;brand&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;_count&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;asc&quot;</span> <span class="comment">//Â æŒ‰ç…§_countå‡åºæ’åˆ—</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span>Â <span class="number">20</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="xian-ding-ju-he-fan-wei" id="é™å®šèšåˆèŒƒå›´">é™å®šèšåˆèŒƒå›´</h3><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒBucketèšåˆæ˜¯å¯¹ç´¢å¼•åº“çš„æ‰€æœ‰æ–‡æ¡£åšèšåˆï¼Œä½†çœŸå®åœºæ™¯ä¸‹ï¼Œç”¨æˆ·ä¼šè¾“å…¥æœç´¢æ¡ä»¶ï¼Œå› æ­¤èšåˆå¿…é¡»æ˜¯å¯¹æœç´¢ç»“æœèšåˆã€‚é‚£ä¹ˆèšåˆå¿…é¡»æ·»åŠ é™å®šæ¡ä»¶ã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥é™å®šè¦èšåˆçš„æ–‡æ¡£èŒƒå›´ï¼Œåªè¦æ·»åŠ queryæ¡ä»¶å³å¯ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span>Â <span class="number">200</span> <span class="comment">// åªå¯¹200å…ƒä»¥ä¸‹çš„æ–‡æ¡£èšåˆ</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span>Â </span><br><span class="line">Â Â <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span>Â <span class="number">0</span><span class="punctuation">,</span>Â </span><br><span class="line">Â Â <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;brandAgg&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;brand&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span>Â <span class="number">20</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™æ¬¡ï¼Œèšåˆå¾—åˆ°çš„å“ç‰Œæ˜æ˜¾å˜å°‘äº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/f2154ad187d24b95aa554b617e54fddb" alt="image-20210723172404836"></p><h3 id="metric-ju-he-yu-fa" id="Metricèšåˆè¯­æ³•">Metricèšåˆè¯­æ³•</h3><p>ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬å¯¹é…’åº—æŒ‰ç…§å“ç‰Œåˆ†ç»„ï¼Œå½¢æˆäº†ä¸€ä¸ªä¸ªæ¡¶ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦å¯¹æ¡¶å†…çš„é…’åº—åšè¿ç®—ï¼Œè·å–æ¯ä¸ªå“ç‰Œçš„ç”¨æˆ·è¯„åˆ†çš„minã€maxã€avgç­‰å€¼ã€‚</p><p>è¿™å°±è¦ç”¨åˆ°Metricèšåˆäº†ï¼Œä¾‹å¦‚statèšåˆï¼šå°±å¯ä»¥è·å–minã€maxã€avgç­‰ç»“æœã€‚</p><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span>Â <span class="number">0</span><span class="punctuation">,</span>Â </span><br><span class="line">Â Â <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;brandAgg&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â </span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â </span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;brand&quot;</span><span class="punctuation">,</span>Â </span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span>Â <span class="number">20</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="comment">//Â æ˜¯brandsèšåˆçš„å­èšåˆï¼Œä¹Ÿå°±æ˜¯åˆ†ç»„åå¯¹æ¯ç»„åˆ†åˆ«è®¡ç®—</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;score_stats&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="comment">//Â èšåˆåç§°</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;stats&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="comment">//Â èšåˆç±»å‹ï¼Œè¿™é‡Œstatså¯ä»¥è®¡ç®—minã€maxã€avgç­‰</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;score&quot;</span>Â <span class="comment">//Â èšåˆå­—æ®µï¼Œè¿™é‡Œæ˜¯score</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™æ¬¡çš„score_statsèšåˆæ˜¯åœ¨brandAggçš„èšåˆå†…éƒ¨åµŒå¥—çš„å­èšåˆã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªæ¡¶åˆ†åˆ«è®¡ç®—ã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç»™èšåˆç»“æœåšä¸ªæ’åºï¼Œä¾‹å¦‚æŒ‰ç…§æ¯ä¸ªæ¡¶çš„é…’åº—å¹³å‡åˆ†åšæ’åºï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/20a8c0aff3fe4da5996a7a558013164b" alt="image-20210723172917636"></p><h3 id="xiao-jie" id="å°ç»“">å°ç»“</h3><p>aggsä»£è¡¨èšåˆï¼Œä¸queryåŒçº§ï¼Œæ­¤æ—¶queryçš„ä½œç”¨æ˜¯ï¼Ÿ</p><ul><li>é™å®šèšåˆçš„çš„æ–‡æ¡£èŒƒå›´</li></ul><p>èšåˆå¿…é¡»çš„ä¸‰è¦ç´ ï¼š</p><ul><li>èšåˆåç§°</li><li>èšåˆç±»å‹</li><li>èšåˆå­—æ®µ</li></ul><p>èšåˆå¯é…ç½®å±æ€§æœ‰ï¼š</p><ul><li>sizeï¼šæŒ‡å®šèšåˆç»“æœæ•°é‡</li><li>orderï¼šæŒ‡å®šèšåˆç»“æœæ’åºæ–¹å¼</li><li>fieldï¼šæŒ‡å®šèšåˆå­—æ®µ</li></ul><h2 id="rest-api-shi-xian-ju-he" id="RestAPIå®ç°èšåˆ">RestAPIå®ç°èšåˆ</h2><h3 id="api-yu-fa" id="APIè¯­æ³•">APIè¯­æ³•</h3><p>èšåˆæ¡ä»¶ä¸queryæ¡ä»¶åŒçº§åˆ«ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨request.source()æ¥æŒ‡å®šèšåˆæ¡ä»¶ã€‚</p><p>èšåˆæ¡ä»¶çš„è¯­æ³•ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/22858db1d93c4fe1ba475709fb086bbd" alt="image-20210723173057733"></p><p>èšåˆçš„ç»“æœä¹Ÿä¸æŸ¥è¯¢ç»“æœä¸åŒï¼ŒAPIä¹Ÿæ¯”è¾ƒç‰¹æ®Šã€‚ä¸è¿‡åŒæ ·æ˜¯JSONé€å±‚è§£æï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/a52a55135a27436d8da7ab157e54dff3" alt="image-20210723173215728"></p><h3 id="ye-wu-xu-qiu" id="ä¸šåŠ¡éœ€æ±‚">ä¸šåŠ¡éœ€æ±‚</h3><blockquote><p>éœ€æ±‚ï¼šæœç´¢é¡µé¢çš„å“ç‰Œã€åŸå¸‚ç­‰ä¿¡æ¯ä¸åº”è¯¥æ˜¯åœ¨é¡µé¢å†™æ­»ï¼Œè€Œæ˜¯é€šè¿‡èšåˆç´¢å¼•åº“ä¸­çš„é…’åº—æ•°æ®å¾—æ¥çš„ï¼š</p></blockquote><p><img src="https://s1.vika.cn/space/2023/01/07/3afb0223d2904e6691ad72bb8ee284db" alt="image-20210723192605566"></p><p>åˆ†æï¼š</p><p>ç›®å‰ï¼Œé¡µé¢çš„åŸå¸‚åˆ—è¡¨ã€æ˜Ÿçº§åˆ—è¡¨ã€å“ç‰Œåˆ—è¡¨éƒ½æ˜¯å†™æ­»çš„ï¼Œå¹¶ä¸ä¼šéšç€æœç´¢ç»“æœçš„å˜åŒ–è€Œå˜åŒ–ã€‚ä½†æ˜¯ç”¨æˆ·æœç´¢æ¡ä»¶æ”¹å˜æ—¶ï¼Œæœç´¢ç»“æœä¼šè·Ÿç€å˜åŒ–ã€‚</p><p>ä¾‹å¦‚ï¼šç”¨æˆ·æœç´¢â€œä¸œæ–¹æ˜ç â€ï¼Œé‚£æœç´¢çš„é…’åº—è‚¯å®šæ˜¯åœ¨ä¸Šæµ·ä¸œæ–¹æ˜ç é™„è¿‘ï¼Œå› æ­¤ï¼ŒåŸå¸‚åªèƒ½æ˜¯ä¸Šæµ·ï¼Œæ­¤æ—¶åŸå¸‚åˆ—è¡¨ä¸­å°±ä¸åº”è¯¥æ˜¾ç¤ºåŒ—äº¬ã€æ·±åœ³ã€æ­å·è¿™äº›ä¿¡æ¯äº†ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæœç´¢ç»“æœä¸­åŒ…å«å“ªäº›åŸå¸‚ï¼Œé¡µé¢å°±åº”è¯¥åˆ—å‡ºå“ªäº›åŸå¸‚ï¼›æœç´¢ç»“æœä¸­åŒ…å«å“ªäº›å“ç‰Œï¼Œé¡µé¢å°±åº”è¯¥åˆ—å‡ºå“ªäº›å“ç‰Œã€‚</p><p>å¦‚ä½•å¾—çŸ¥æœç´¢ç»“æœä¸­åŒ…å«å“ªäº›å“ç‰Œï¼Ÿå¦‚ä½•å¾—çŸ¥æœç´¢ç»“æœä¸­åŒ…å«å“ªäº›åŸå¸‚ï¼Ÿ</p><p>ä½¿ç”¨èšåˆåŠŸèƒ½ï¼Œåˆ©ç”¨Bucketèšåˆï¼Œå¯¹æœç´¢ç»“æœä¸­çš„æ–‡æ¡£åŸºäºå“ç‰Œåˆ†ç»„ã€åŸºäºåŸå¸‚åˆ†ç»„ï¼Œå°±èƒ½å¾—çŸ¥åŒ…å«å“ªäº›å“ç‰Œã€å“ªäº›åŸå¸‚äº†ã€‚</p><p>å› ä¸ºæ˜¯å¯¹æœç´¢ç»“æœèšåˆï¼Œå› æ­¤èšåˆæ˜¯<strong>é™å®šèŒƒå›´çš„èšåˆ</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´èšåˆçš„é™å®šæ¡ä»¶è·Ÿæœç´¢æ–‡æ¡£çš„æ¡ä»¶ä¸€è‡´ã€‚</p><p>æŸ¥çœ‹æµè§ˆå™¨å¯ä»¥å‘ç°ï¼Œå‰ç«¯å…¶å®å·²ç»å‘å‡ºäº†è¿™æ ·çš„ä¸€ä¸ªè¯·æ±‚ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/51b3bb80a5654dbd874aca298d52216b" alt="image-20210723193730799"></p><p>è¯·æ±‚<strong>å‚æ•°ä¸æœç´¢æ–‡æ¡£çš„å‚æ•°å®Œå…¨ä¸€è‡´</strong>ã€‚</p><p>è¿”å›å€¼ç±»å‹å°±æ˜¯é¡µé¢è¦å±•ç¤ºçš„æœ€ç»ˆç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/a633a59855d54873959a2b965e068799" alt="image-20210723203915982"></p><p>ç»“æœæ˜¯ä¸€ä¸ªMapç»“æ„ï¼š</p><ul><li>keyæ˜¯å­—ç¬¦ä¸²ï¼ŒåŸå¸‚ã€æ˜Ÿçº§ã€å“ç‰Œã€ä»·æ ¼</li><li>valueæ˜¯é›†åˆï¼Œä¾‹å¦‚å¤šä¸ªåŸå¸‚çš„åç§°</li></ul><h3 id="ye-wu-shi-xian" id="ä¸šåŠ¡å®ç°">ä¸šåŠ¡å®ç°</h3><p>åœ¨<code>cn.itcast.hotel.web</code>åŒ…çš„<code>HotelController</code>ä¸­æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œéµå¾ªä¸‹é¢çš„è¦æ±‚ï¼š</p><ul><li>è¯·æ±‚æ–¹å¼ï¼š<code>POST</code></li><li>è¯·æ±‚è·¯å¾„ï¼š<code>/hotel/filters</code></li><li>è¯·æ±‚å‚æ•°ï¼š<code>RequestParams</code>ï¼Œä¸æœç´¢æ–‡æ¡£çš„å‚æ•°ä¸€è‡´</li><li>è¿”å›å€¼ç±»å‹ï¼š<code>Map&lt;String, List&lt;String&gt;&gt;</code></li></ul><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;filters&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;String&gt;&gt; <span class="title function_">getFilters</span><span class="params">(<span class="meta">@RequestBody</span> RequestParams params)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> hotelService.getFilters(params);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè°ƒç”¨äº†IHotelServiceä¸­çš„getFiltersæ–¹æ³•ï¼Œå°šæœªå®ç°ã€‚</p><p>åœ¨<code>cn.itcast.hotel.service.IHotelService</code>ä¸­å®šä¹‰æ–°æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, List&lt;String&gt;&gt; <span class="title function_">filters</span><span class="params">(RequestParams params)</span>;</span><br></pre></td></tr></table></figure><p>åœ¨<code>cn.itcast.hotel.service.impl.HotelService</code>ä¸­å®ç°è¯¥æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;String&gt;&gt; <span class="title function_">filters</span><span class="params">(RequestParams params)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">        <span class="comment">// 2.1.query</span></span><br><span class="line">        buildBasicQuery(params, request);</span><br><span class="line">        <span class="comment">// 2.2.è®¾ç½®size</span></span><br><span class="line">        request.source().size(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 2.3.èšåˆ</span></span><br><span class="line">        buildAggregation(request);</span><br><span class="line">        <span class="comment">// 3.å‘å‡ºè¯·æ±‚</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">// 4.è§£æç»“æœ</span></span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Aggregations</span> <span class="variable">aggregations</span> <span class="operator">=</span> response.getAggregations();</span><br><span class="line">        <span class="comment">// 4.1.æ ¹æ®å“ç‰Œåç§°ï¼Œè·å–å“ç‰Œç»“æœ</span></span><br><span class="line">        List&lt;String&gt; brandList = getAggByName(aggregations, <span class="string">&quot;brandAgg&quot;</span>);</span><br><span class="line">        result.put(<span class="string">&quot;å“ç‰Œ&quot;</span>, brandList);</span><br><span class="line">        <span class="comment">// 4.2.æ ¹æ®å“ç‰Œåç§°ï¼Œè·å–å“ç‰Œç»“æœ</span></span><br><span class="line">        List&lt;String&gt; cityList = getAggByName(aggregations, <span class="string">&quot;cityAgg&quot;</span>);</span><br><span class="line">        result.put(<span class="string">&quot;åŸå¸‚&quot;</span>, cityList);</span><br><span class="line">        <span class="comment">// 4.3.æ ¹æ®å“ç‰Œåç§°ï¼Œè·å–å“ç‰Œç»“æœ</span></span><br><span class="line">        List&lt;String&gt; starList = getAggByName(aggregations, <span class="string">&quot;starAgg&quot;</span>);</span><br><span class="line">        result.put(<span class="string">&quot;æ˜Ÿçº§&quot;</span>, starList);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildAggregation</span><span class="params">(SearchRequest request)</span> &#123;</span><br><span class="line">    request.source().aggregation(AggregationBuilders</span><br><span class="line">                                 .terms(<span class="string">&quot;brandAgg&quot;</span>)</span><br><span class="line">                                 .field(<span class="string">&quot;brand&quot;</span>)</span><br><span class="line">                                 .size(<span class="number">100</span>)</span><br><span class="line">                                );</span><br><span class="line">    request.source().aggregation(AggregationBuilders</span><br><span class="line">                                 .terms(<span class="string">&quot;cityAgg&quot;</span>)</span><br><span class="line">                                 .field(<span class="string">&quot;city&quot;</span>)</span><br><span class="line">                                 .size(<span class="number">100</span>)</span><br><span class="line">                                );</span><br><span class="line">    request.source().aggregation(AggregationBuilders</span><br><span class="line">                                 .terms(<span class="string">&quot;starAgg&quot;</span>)</span><br><span class="line">                                 .field(<span class="string">&quot;starName&quot;</span>)</span><br><span class="line">                                 .size(<span class="number">100</span>)</span><br><span class="line">                                );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;String&gt; <span class="title function_">getAggByName</span><span class="params">(Aggregations aggregations, String aggName)</span> &#123;</span><br><span class="line">    <span class="comment">// 4.1.æ ¹æ®èšåˆåç§°è·å–èšåˆç»“æœ</span></span><br><span class="line">    <span class="type">Terms</span> <span class="variable">brandTerms</span> <span class="operator">=</span> aggregations.get(aggName);</span><br><span class="line">    <span class="comment">// 4.2.è·å–buckets</span></span><br><span class="line">    List&lt;? <span class="keyword">extends</span> <span class="title class_">Terms</span>.Bucket&gt; buckets = brandTerms.getBuckets();</span><br><span class="line">    <span class="comment">// 4.3.éå†</span></span><br><span class="line">    List&lt;String&gt; brandList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Terms.Bucket bucket : buckets) &#123;</span><br><span class="line">        <span class="comment">// 4.4.è·å–key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> bucket.getKeyAsString();</span><br><span class="line">        brandList.add(key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> brandList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="zi-dong-bu-quan">è‡ªåŠ¨è¡¥å…¨</h1><p>å½“ç”¨æˆ·åœ¨æœç´¢æ¡†è¾“å…¥å­—ç¬¦æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥æç¤ºå‡ºä¸è¯¥å­—ç¬¦æœ‰å…³çš„æœç´¢é¡¹ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/d86860706e0d48f8b85e0b741e6c7b0c" alt="image-20210723204936367"></p><p>è¿™ç§æ ¹æ®ç”¨æˆ·è¾“å…¥çš„å­—æ¯ï¼Œæç¤ºå®Œæ•´è¯æ¡çš„åŠŸèƒ½ï¼Œå°±æ˜¯è‡ªåŠ¨è¡¥å…¨äº†ã€‚</p><p>å› ä¸ºéœ€è¦æ ¹æ®æ‹¼éŸ³å­—æ¯æ¥æ¨æ–­ï¼Œå› æ­¤è¦ç”¨åˆ°æ‹¼éŸ³åˆ†è¯åŠŸèƒ½ã€‚</p><h2 id="pin-yin-fen-ci-qi" id="æ‹¼éŸ³åˆ†è¯å™¨">æ‹¼éŸ³åˆ†è¯å™¨</h2><p>è¦å®ç°æ ¹æ®å­—æ¯åšè¡¥å…¨ï¼Œå°±å¿…é¡»å¯¹æ–‡æ¡£æŒ‰ç…§æ‹¼éŸ³åˆ†è¯ã€‚åœ¨GitHubä¸Šæ°å¥½æœ‰elasticsearchçš„æ‹¼éŸ³åˆ†è¯æ’ä»¶ã€‚åœ°å€ï¼š<a href="https://github.com/medcl/elasticsearch-analysis-pinyin">https://github.com/medcl/elasticsearch-analysis-pinyin</a></p><p>è¯¾å‰èµ„æ–™ä¸­ä¹Ÿæä¾›äº†æ‹¼éŸ³åˆ†è¯å™¨çš„å®‰è£…åŒ…ï¼š</p><p>å®‰è£…æ–¹å¼ä¸IKåˆ†è¯å™¨ä¸€æ ·ï¼Œåˆ†ä¸‰æ­¥ï¼š</p><p>â€‹â‘ è§£å‹</p><p>â€‹â‘¡ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­ï¼Œelasticsearchçš„pluginç›®å½•</p><p>â€‹â‘¢é‡å¯elasticsearch</p><p>â€‹â‘£æµ‹è¯•</p><p>è¯¦ç»†å®‰è£…æ­¥éª¤å¯ä»¥å‚è€ƒIKåˆ†è¯å™¨çš„å®‰è£…è¿‡ç¨‹ã€‚</p><p>æµ‹è¯•ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POSTÂ /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å¦‚å®¶é…’åº—è¿˜ä¸é”™&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;pinyin&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/7232a1657e594de99d871f16f7a99e30" alt="image-20210723210126506">è‡ªå®šä¹‰åˆ†è¯å™¨</p><p>é»˜è®¤çš„æ‹¼éŸ³åˆ†è¯å™¨ä¼šå°†æ¯ä¸ªæ±‰å­—å•ç‹¬åˆ†ä¸ºæ‹¼éŸ³ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯æ¯ä¸ªè¯æ¡å½¢æˆä¸€ç»„æ‹¼éŸ³ï¼Œéœ€è¦å¯¹æ‹¼éŸ³åˆ†è¯å™¨åšä¸ªæ€§åŒ–å®šåˆ¶ï¼Œå½¢æˆè‡ªå®šä¹‰åˆ†è¯å™¨ã€‚</p><p>elasticsearchä¸­åˆ†è¯å™¨ï¼ˆanalyzerï¼‰çš„ç»„æˆåŒ…å«ä¸‰éƒ¨åˆ†ï¼š</p><ul><li>character filtersï¼šåœ¨tokenizerä¹‹å‰å¯¹æ–‡æœ¬è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚åˆ é™¤å­—ç¬¦ã€æ›¿æ¢å­—ç¬¦</li><li>tokenizerï¼šå°†æ–‡æœ¬æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ‡å‰²æˆè¯æ¡ï¼ˆtermï¼‰ã€‚ä¾‹å¦‚keywordï¼Œå°±æ˜¯ä¸åˆ†è¯ï¼›è¿˜æœ‰ik_smart</li><li>tokenizer filterï¼šå°†tokenizerè¾“å‡ºçš„è¯æ¡åšè¿›ä¸€æ­¥å¤„ç†ã€‚ä¾‹å¦‚å¤§å°å†™è½¬æ¢ã€åŒä¹‰è¯å¤„ç†ã€æ‹¼éŸ³å¤„ç†ç­‰</li></ul><p>æ–‡æ¡£åˆ†è¯æ—¶ä¼šä¾æ¬¡ç”±è¿™ä¸‰éƒ¨åˆ†æ¥å¤„ç†æ–‡æ¡£ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/29b5092475604822bd2a4542454b0fa0" alt="image-20210723210427878"></p><p>å£°æ˜è‡ªå®šä¹‰åˆ†è¯å™¨çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">PUTÂ /test</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;analysis&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="comment">//Â è‡ªå®šä¹‰åˆ†è¯å™¨</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;my_analyzer&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â Â <span class="comment">//Â åˆ†è¯å™¨åç§°</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;tokenizer&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;py&quot;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="comment">//Â è‡ªå®šä¹‰tokenizerÂ filter</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;py&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="comment">//Â è¿‡æ»¤å™¨åç§°</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;pinyin&quot;</span><span class="punctuation">,</span>Â <span class="comment">//Â è¿‡æ»¤å™¨ç±»å‹ï¼Œè¿™é‡Œæ˜¯pinyin</span></span><br><span class="line">  <span class="attr">&quot;keep_full_pinyin&quot;</span><span class="punctuation">:</span>Â <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;keep_joined_full_pinyin&quot;</span><span class="punctuation">:</span>Â <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;keep_original&quot;</span><span class="punctuation">:</span>Â <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;limit_first_letter_length&quot;</span><span class="punctuation">:</span>Â <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;remove_duplicated_term&quot;</span><span class="punctuation">:</span>Â <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;none_chinese_pinyin_tokenize&quot;</span><span class="punctuation">:</span>Â <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;my_analyzer&quot;</span><span class="punctuation">,</span> <span class="comment">// åˆ›å»ºç´¢å¼•åº“æ—¶ä½¿ç”¨</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;search_analyzer&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;ik_smart&quot;</span> <span class="comment">// æŸ¥æ‰¾æ•°æ®æ—¶ä½¿ç”¨</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/55e43d87dcaa4d58a0215b5ff602eed4" alt="image-20210723211829150"></p><h3 id="zong-jie" id="æ€»ç»“ï¼š">æ€»ç»“ï¼š</h3><p>å¦‚ä½•ä½¿ç”¨æ‹¼éŸ³åˆ†è¯å™¨ï¼Ÿ</p><ul><li><p>â‘ ä¸‹è½½pinyinåˆ†è¯å™¨</p></li><li><p>â‘¡è§£å‹å¹¶æ”¾åˆ°elasticsearchçš„pluginç›®å½•</p></li><li><p>â‘¢é‡å¯å³å¯</p></li></ul><p>å¦‚ä½•è‡ªå®šä¹‰åˆ†è¯å™¨ï¼Ÿ</p><ul><li><p>â‘ åˆ›å»ºç´¢å¼•åº“æ—¶ï¼Œåœ¨settingsä¸­é…ç½®ï¼Œå¯ä»¥åŒ…å«ä¸‰éƒ¨åˆ†</p></li><li><p>â‘¡character filter</p></li><li><p>â‘¢tokenizer</p></li><li><p>â‘£filter</p></li></ul><p>æ‹¼éŸ³åˆ†è¯å™¨æ³¨æ„äº‹é¡¹ï¼Ÿ</p><ul><li>ä¸ºäº†é¿å…æœç´¢åˆ°åŒéŸ³å­—ï¼Œæœç´¢æ—¶ä¸è¦ä½¿ç”¨æ‹¼éŸ³åˆ†è¯å™¨</li></ul><h2 id="zi-dong-bu-quan-cha-xun" id="è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢">è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢</h2><p>elasticsearchæä¾›äº†<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.6/search-suggesters.html">Completion Suggester</a>æŸ¥è¯¢æ¥å®ç°è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚è¿™ä¸ªæŸ¥è¯¢ä¼šåŒ¹é…ä»¥ç”¨æˆ·è¾“å…¥å†…å®¹å¼€å¤´çš„è¯æ¡å¹¶è¿”å›ã€‚ä¸ºäº†æé«˜è¡¥å…¨æŸ¥è¯¢çš„æ•ˆç‡ï¼Œå¯¹äºæ–‡æ¡£ä¸­å­—æ®µçš„ç±»å‹æœ‰ä¸€äº›çº¦æŸï¼š</p><ul><li><p>å‚ä¸è¡¥å…¨æŸ¥è¯¢çš„å­—æ®µå¿…é¡»æ˜¯completionç±»å‹ã€‚</p></li><li><p>å­—æ®µçš„å†…å®¹ä¸€èˆ¬æ˜¯ç”¨æ¥è¡¥å…¨çš„å¤šä¸ªè¯æ¡å½¢æˆçš„æ•°ç»„ã€‚</p></li></ul><p>æ¯”å¦‚ï¼Œä¸€ä¸ªè¿™æ ·çš„ç´¢å¼•åº“ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºç´¢å¼•åº“</span><br><span class="line">PUT test2</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;completion&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ’å…¥ä¸‹é¢çš„æ•°æ®ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># ç¤ºä¾‹æ•°æ®</span><br><span class="line">POST test2/_doc</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;Sony&quot;</span><span class="punctuation">,</span> <span class="string">&quot;WH-1000XM3&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">POST test2/_doc</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;SK-II&quot;</span><span class="punctuation">,</span> <span class="string">&quot;PITERA&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">POST test2/_doc</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;Nintedo&quot;</span><span class="punctuation">,</span> <span class="string">&quot;switch&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢çš„DSLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢</span></span><br><span class="line">GETÂ /test/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;suggest&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;title_suggest&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;s&quot;</span><span class="punctuation">,</span>Â <span class="comment">//Â å…³é”®å­—</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;completion&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;title&quot;</span><span class="punctuation">,</span>Â <span class="comment">//Â è¡¥å…¨æŸ¥è¯¢çš„å­—æ®µ</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;skip_duplicates&quot;</span><span class="punctuation">:</span>Â <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>Â <span class="comment">//Â è·³è¿‡é‡å¤çš„</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span>Â <span class="number">10</span>Â <span class="comment">//Â è·å–å‰10æ¡ç»“æœ</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="shi-xian-jiu-dian-sou-suo-kuang-zi-dong-bu-quan" id="å®ç°é…’åº—æœç´¢æ¡†è‡ªåŠ¨è¡¥å…¨">å®ç°é…’åº—æœç´¢æ¡†è‡ªåŠ¨è¡¥å…¨</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬çš„hotelç´¢å¼•åº“è¿˜æ²¡æœ‰è®¾ç½®æ‹¼éŸ³åˆ†è¯å™¨ï¼Œéœ€è¦ä¿®æ”¹ç´¢å¼•åº“ä¸­çš„é…ç½®ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ç´¢å¼•åº“æ˜¯æ— æ³•ä¿®æ”¹çš„ï¼Œåªèƒ½åˆ é™¤ç„¶åé‡æ–°åˆ›å»ºã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œç”¨æ¥åšè‡ªåŠ¨è¡¥å…¨ï¼Œå°†brandã€suggestionã€cityç­‰éƒ½æ”¾è¿›å»ï¼Œä½œä¸ºè‡ªåŠ¨è¡¥å…¨çš„æç¤ºã€‚</p><blockquote><p>å› æ­¤ï¼Œæ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åšçš„äº‹æƒ…åŒ…æ‹¬ï¼š</p><ol><li><p>ä¿®æ”¹hotelç´¢å¼•åº“ç»“æ„ï¼Œè®¾ç½®è‡ªå®šä¹‰æ‹¼éŸ³åˆ†è¯å™¨</p></li><li><p>ä¿®æ”¹ç´¢å¼•åº“çš„nameã€allå­—æ®µï¼Œä½¿ç”¨è‡ªå®šä¹‰åˆ†è¯å™¨</p></li><li><p>ç´¢å¼•åº“æ·»åŠ ä¸€ä¸ªæ–°å­—æ®µsuggestionï¼Œç±»å‹ä¸ºcompletionç±»å‹ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„åˆ†è¯å™¨</p></li><li><p>ç»™HotelDocç±»æ·»åŠ suggestionå­—æ®µï¼Œå†…å®¹åŒ…å«brandã€business</p></li><li><p>é‡æ–°å¯¼å…¥æ•°æ®åˆ°hotelåº“</p></li></ol></blockquote><h3 id="xiu-gai-jiu-dian-ying-she-jie-gou" id="ä¿®æ”¹é…’åº—æ˜ å°„ç»“æ„">ä¿®æ”¹é…’åº—æ˜ å°„ç»“æ„</h3><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é…’åº—æ•°æ®ç´¢å¼•åº“</span></span><br><span class="line">PUT /hotel</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;analysis&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;text_anlyzer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;tokenizer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;py&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;completion_analyzer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;tokenizer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;py&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;py&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pinyin&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;keep_full_pinyin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;keep_joined_full_pinyin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;keep_original&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;limit_first_letter_length&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;remove_duplicated_term&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;none_chinese_pinyin_tokenize&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text_anlyzer&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;copy_to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;all&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;copy_to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;all&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;starName&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;business&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;copy_to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;all&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;geo_point&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;pic&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;all&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text_anlyzer&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;search_analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;suggestion&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;completion&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;completion_analyzer&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="xiu-gai-hotel-doc-shi-ti" id="ä¿®æ”¹HotelDocå®ä½“">ä¿®æ”¹HotelDocå®ä½“</h3><p>HotelDocä¸­è¦æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œç”¨æ¥åšè‡ªåŠ¨è¡¥å…¨ï¼Œå†…å®¹å¯ä»¥æ˜¯é…’åº—å“ç‰Œã€åŸå¸‚ã€å•†åœˆç­‰ä¿¡æ¯ã€‚æŒ‰ç…§è‡ªåŠ¨è¡¥å…¨å­—æ®µçš„è¦æ±‚ï¼Œæœ€å¥½æ˜¯è¿™äº›å­—æ®µçš„æ•°ç»„ã€‚</p><p>å› æ­¤æˆ‘ä»¬åœ¨HotelDocä¸­æ·»åŠ ä¸€ä¸ªsuggestionå­—æ®µï¼Œç±»å‹ä¸º<code>List&lt;String&gt;</code>ï¼Œç„¶åå°†brandã€cityã€businessç­‰ä¿¡æ¯æ”¾åˆ°é‡Œé¢ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelDoc</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">    <span class="keyword">private</span> Integer score;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String starName;</span><br><span class="line">    <span class="keyword">private</span> String business;</span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line">    <span class="keyword">private</span> String pic;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object distance;</span><br><span class="line">    <span class="keyword">private</span> Boolean isAd;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; suggestion;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HotelDoc</span><span class="params">(Hotel hotel)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = hotel.getId();</span><br><span class="line">        <span class="built_in">this</span>.name = hotel.getName();</span><br><span class="line">        <span class="built_in">this</span>.address = hotel.getAddress();</span><br><span class="line">        <span class="built_in">this</span>.price = hotel.getPrice();</span><br><span class="line">        <span class="built_in">this</span>.score = hotel.getScore();</span><br><span class="line">        <span class="built_in">this</span>.brand = hotel.getBrand();</span><br><span class="line">        <span class="built_in">this</span>.city = hotel.getCity();</span><br><span class="line">        <span class="built_in">this</span>.starName = hotel.getStarName();</span><br><span class="line">        <span class="built_in">this</span>.business = hotel.getBusiness();</span><br><span class="line">        <span class="built_in">this</span>.location = hotel.getLatitude() + <span class="string">&quot;, &quot;</span> + hotel.getLongitude();</span><br><span class="line">        <span class="built_in">this</span>.pic = hotel.getPic();</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.business.contains(<span class="string">&quot;ã€&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">// business æœ‰å¤šä¸ªå€¼ï¼Œéœ€è¦åˆ‡å‰²</span></span><br><span class="line">            String[] arr = <span class="built_in">this</span>.business.split(<span class="string">&quot;ã€&quot;</span>);</span><br><span class="line">            <span class="comment">// æ·»å…ƒç´ </span></span><br><span class="line">            <span class="built_in">this</span>.suggestion = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="built_in">this</span>.suggestion.add(<span class="built_in">this</span>.brand);</span><br><span class="line">            Collections.addAll(<span class="built_in">this</span>.suggestion, arr);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">this</span>.business.contains(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">// business æœ‰å¤šä¸ªå€¼ï¼Œéœ€è¦åˆ‡å‰²</span></span><br><span class="line">            String[] arr = <span class="built_in">this</span>.business.split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">            <span class="comment">// æ·»å…ƒç´ </span></span><br><span class="line">            <span class="built_in">this</span>.suggestion = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="built_in">this</span>.suggestion.add(<span class="built_in">this</span>.brand);</span><br><span class="line">            Collections.addAll(<span class="built_in">this</span>.suggestion, arr);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.suggestion = Arrays.asList(<span class="built_in">this</span>.brand, <span class="built_in">this</span>.business);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="zhong-xin-dao-ru" id="é‡æ–°å¯¼å…¥">é‡æ–°å¯¼å…¥</h3><p>é‡æ–°æ‰§è¡Œä¹‹å‰ç¼–å†™çš„å¯¼å…¥æ•°æ®åŠŸèƒ½ï¼Œå¯ä»¥çœ‹åˆ°æ–°çš„é…’åº—æ•°æ®ä¸­åŒ…å«äº†suggestionï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/34c44ba190f54b52b59a73c0080b91a8" alt="image-20210723213546183"></p><h3 id="zi-dong-bu-quan-cha-xun-de-java-api" id="è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢çš„JavaAPI">è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢çš„JavaAPI</h3><p>ä¹‹å‰æˆ‘ä»¬å­¦ä¹ äº†è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢çš„DSLï¼Œè€Œæ²¡æœ‰å­¦ä¹ å¯¹åº”çš„JavaAPIï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªç¤ºä¾‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/576ff8a8fa0f46e694e00e0e40105161" alt="image-20210723213759922"></p><p>è€Œè‡ªåŠ¨è¡¥å…¨çš„ç»“æœä¹Ÿæ¯”è¾ƒç‰¹æ®Šï¼Œè§£æçš„ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/d295bed21ecd4291a7cacca098a2afd7" alt="image-20210723213917524"></p><h3 id="shi-xian-sou-suo-kuang-zi-dong-bu-quan" id="å®ç°æœç´¢æ¡†è‡ªåŠ¨è¡¥å…¨">å®ç°æœç´¢æ¡†è‡ªåŠ¨è¡¥å…¨</h3><p>æŸ¥çœ‹å‰ç«¯é¡µé¢ï¼Œå¯ä»¥å‘ç°å½“æˆ‘ä»¬åœ¨è¾“å…¥æ¡†é”®å…¥æ—¶ï¼Œå‰ç«¯ä¼šå‘èµ·ajaxè¯·æ±‚ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/68daac49d4bd4d3d903a50ad4c5e7486" alt="image-20210723214021062"></p><p>è¿”å›å€¼æ˜¯è¡¥å…¨è¯æ¡çš„é›†åˆï¼Œç±»å‹ä¸º<code>List&lt;String&gt;</code></p><ol><li>åœ¨<code>cn.itcast.hotel.web</code>åŒ…ä¸‹çš„<code>HotelController</code>ä¸­æ·»åŠ æ–°æ¥å£ï¼Œæ¥æ”¶æ–°çš„è¯·æ±‚ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;suggestion&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getSuggestions</span><span class="params">(<span class="meta">@RequestParam(&quot;key&quot;)</span> String prefix)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> hotelService.getSuggestions(prefix);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>åœ¨<code>cn.itcast.hotel.service</code>åŒ…ä¸‹çš„<code>IhotelService</code>ä¸­æ·»åŠ æ–¹æ³•ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; <span class="title function_">getSuggestions</span><span class="params">(String prefix)</span>;</span><br></pre></td></tr></table></figure><ol start="3"><li>åœ¨<code>cn.itcast.hotel.service.impl.HotelService</code>ä¸­å®ç°è¯¥æ–¹æ³•ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getSuggestions</span><span class="params">(String prefix)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">        request.source().suggest(<span class="keyword">new</span> <span class="title class_">SuggestBuilder</span>().addSuggestion(</span><br><span class="line">            <span class="string">&quot;suggestions&quot;</span>,</span><br><span class="line">            SuggestBuilders.completionSuggestion(<span class="string">&quot;suggestion&quot;</span>)</span><br><span class="line">            .prefix(prefix)</span><br><span class="line">            .skipDuplicates(<span class="literal">true</span>)</span><br><span class="line">            .size(<span class="number">10</span>)</span><br><span class="line">        ));</span><br><span class="line">        <span class="comment">// 3.å‘èµ·è¯·æ±‚</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">// 4.è§£æç»“æœ</span></span><br><span class="line">        <span class="type">Suggest</span> <span class="variable">suggest</span> <span class="operator">=</span> response.getSuggest();</span><br><span class="line">        <span class="comment">// 4.1.æ ¹æ®è¡¥å…¨æŸ¥è¯¢åç§°ï¼Œè·å–è¡¥å…¨ç»“æœ</span></span><br><span class="line">        <span class="type">CompletionSuggestion</span> <span class="variable">suggestions</span> <span class="operator">=</span> suggest.getSuggestion(<span class="string">&quot;suggestions&quot;</span>);</span><br><span class="line">        <span class="comment">// 4.2.è·å–options</span></span><br><span class="line">        List&lt;CompletionSuggestion.Entry.Option&gt; options = suggestions.getOptions();</span><br><span class="line">        <span class="comment">// 4.3.éå†</span></span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(options.size());</span><br><span class="line">        <span class="keyword">for</span> (CompletionSuggestion.Entry.Option option : options) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> option.getText().toString();</span><br><span class="line">            list.add(text);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="shu-ju-tong-bu">æ•°æ®åŒæ­¥</h1><blockquote><p>elasticsearchä¸­çš„é…’åº—æ•°æ®æ¥è‡ªäºmysqlæ•°æ®åº“ï¼Œå› æ­¤mysqlæ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œelasticsearchä¹Ÿå¿…é¡»è·Ÿç€æ”¹å˜ï¼Œè¿™ä¸ªå°±æ˜¯elasticsearchä¸mysqlä¹‹é—´çš„<strong>æ•°æ®åŒæ­¥</strong>ã€‚</p></blockquote><p><img src="https://s1.vika.cn/space/2023/01/07/85b199f7576144ee843732ea396c5054" alt="image-20210723214758392"></p><h2 id="si-lu-fen-xi" id="æ€è·¯åˆ†æ">æ€è·¯åˆ†æ</h2><p>å¸¸è§çš„æ•°æ®åŒæ­¥æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</p><ul><li>åŒæ­¥è°ƒç”¨</li><li>å¼‚æ­¥é€šçŸ¥</li><li>ç›‘å¬binlog</li></ul><h3 id="tong-bu-diao-yong" id="åŒæ­¥è°ƒç”¨">åŒæ­¥è°ƒç”¨</h3><p>æ–¹æ¡ˆä¸€ï¼šåŒæ­¥è°ƒç”¨</p><p><img src="https://s1.vika.cn/space/2023/01/07/cbfe0462174b43c9bbd8db10c5cbdd69" alt="image-20210723214931869"></p><p>åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>hotel-demoå¯¹å¤–æä¾›æ¥å£ï¼Œç”¨æ¥ä¿®æ”¹elasticsearchä¸­çš„æ•°æ®</li><li>é…’åº—ç®¡ç†æœåŠ¡åœ¨å®Œæˆæ•°æ®åº“æ“ä½œåï¼Œç›´æ¥è°ƒç”¨hotel-demoæä¾›çš„æ¥å£ï¼Œ</li></ul><h3 id="yi-bu-tong-zhi" id="å¼‚æ­¥é€šçŸ¥">å¼‚æ­¥é€šçŸ¥</h3><p>æ–¹æ¡ˆäºŒï¼šå¼‚æ­¥é€šçŸ¥</p><p><img src="https://s1.vika.cn/space/2023/01/07/62ab9fbbd4f74ebca7247fbe18159de2" alt="image-20210723215140735"></p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>hotel-adminå¯¹mysqlæ•°æ®åº“æ•°æ®å®Œæˆå¢ã€åˆ ã€æ”¹åï¼Œå‘é€MQæ¶ˆæ¯</li><li>hotel-demoç›‘å¬MQï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯åå®Œæˆelasticsearchæ•°æ®ä¿®æ”¹</li></ul><h3 id="jian-ting-binlog" id="ç›‘å¬binlog">ç›‘å¬binlog</h3><p>æ–¹æ¡ˆä¸‰ï¼šç›‘å¬binlog</p><p><img src="https://s1.vika.cn/space/2023/01/07/f5f121cf9b3948acaebca8935b8a589a" alt="image-20210723215518541"></p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç»™mysqlå¼€å¯binlogåŠŸèƒ½</li><li>mysqlå®Œæˆå¢ã€åˆ ã€æ”¹æ“ä½œéƒ½ä¼šè®°å½•åœ¨binlogä¸­</li><li>hotel-demoåŸºäºcanalç›‘å¬binlogå˜åŒ–ï¼Œå®æ—¶æ›´æ–°elasticsearchä¸­çš„å†…å®¹</li></ul><h3 id="xuan-ze" id="é€‰æ‹©">é€‰æ‹©</h3><p>æ–¹å¼ä¸€ï¼šåŒæ­¥è°ƒç”¨</p><ul><li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç²—æš´</li><li>ç¼ºç‚¹ï¼šä¸šåŠ¡è€¦åˆåº¦é«˜</li></ul><p>æ–¹å¼äºŒï¼šå¼‚æ­¥é€šçŸ¥</p><ul><li>ä¼˜ç‚¹ï¼šä½è€¦åˆï¼Œå®ç°éš¾åº¦ä¸€èˆ¬</li><li>ç¼ºç‚¹ï¼šä¾èµ–mqçš„å¯é æ€§</li></ul><p>æ–¹å¼ä¸‰ï¼šç›‘å¬binlog</p><ul><li>ä¼˜ç‚¹ï¼šå®Œå…¨è§£é™¤æœåŠ¡é—´è€¦åˆ</li><li>ç¼ºç‚¹ï¼šå¼€å¯binlogå¢åŠ æ•°æ®åº“è´Ÿæ‹…ã€å®ç°å¤æ‚åº¦é«˜</li></ul><h2 id="shi-xian-shu-ju-tong-bu" id="å®ç°æ•°æ®åŒæ­¥">å®ç°æ•°æ®åŒæ­¥</h2><h3 id="si-lu" id="æ€è·¯">æ€è·¯</h3><p>åˆ©ç”¨è¯¾å‰èµ„æ–™æä¾›çš„hotel-adminé¡¹ç›®ä½œä¸ºé…’åº—ç®¡ç†çš„å¾®æœåŠ¡ã€‚å½“é…’åº—æ•°æ®å‘ç”Ÿå¢ã€åˆ ã€æ”¹æ—¶ï¼Œè¦æ±‚å¯¹elasticsearchä¸­æ•°æ®ä¹Ÿè¦å®Œæˆç›¸åŒæ“ä½œã€‚</p><blockquote><p>æ­¥éª¤ï¼š</p><ul><li><p>å¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„hotel-adminé¡¹ç›®ï¼Œå¯åŠ¨å¹¶æµ‹è¯•é…’åº—æ•°æ®çš„CRUD</p></li><li><p>å£°æ˜exchangeã€queueã€RoutingKey</p></li><li><p>åœ¨hotel-adminä¸­çš„å¢ã€åˆ ã€æ”¹ä¸šåŠ¡ä¸­å®Œæˆæ¶ˆæ¯å‘é€</p></li><li><p>åœ¨hotel-demoä¸­å®Œæˆæ¶ˆæ¯ç›‘å¬ï¼Œå¹¶æ›´æ–°elasticsearchä¸­æ•°æ®</p></li><li><p>å¯åŠ¨å¹¶æµ‹è¯•æ•°æ®åŒæ­¥åŠŸèƒ½</p></li></ul></blockquote><h3 id="dao-ru-demo" id="å¯¼å…¥demo">å¯¼å…¥demo</h3><p>å¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„hotel-adminé¡¹ç›®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/dbf3d179d4dc480c91f0a4d322e9a185" alt="image-20210723220237930"></p><p>è¿è¡Œåï¼Œè®¿é—® <a href="http://localhost:8099">http://localhost:8099</a></p><p><img src="assets/image-20210723220354464.png" alt="image-20210723220354464"></p><p>å…¶ä¸­åŒ…å«äº†é…’åº—çš„CRUDåŠŸèƒ½ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/2657d136d84d4277880181305babc11e" alt="image-20210723220511090"></p><h3 id="sheng-ming-jiao-huan-ji-dui-lie" id="å£°æ˜äº¤æ¢æœºã€é˜Ÿåˆ—">å£°æ˜äº¤æ¢æœºã€é˜Ÿåˆ—</h3><p>MQç»“æ„å¦‚å›¾ï¼š</p><p><img src="E:%5CBlog%5CHexo-Blog%5Csource_posts%5CJava%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%5Cassets%5Cimage-20210723215850307.png" alt="image-20210723215850307"></p><h4 id="yin-ru-yi-lai" id="å¼•å…¥ä¾èµ–">å¼•å…¥ä¾èµ–</h4><p>åœ¨hotel-adminã€hotel-demoä¸­å¼•å…¥rabbitmqçš„ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--amqp--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="sheng-ming-dui-lie-jiao-huan-ji-ming-cheng" id="å£°æ˜é˜Ÿåˆ—äº¤æ¢æœºåç§°">å£°æ˜é˜Ÿåˆ—äº¤æ¢æœºåç§°</h4><p>åœ¨hotel-adminå’Œhotel-demoä¸­çš„<code>cn.itcast.hotel.constatnts</code>åŒ…ä¸‹æ–°å»ºä¸€ä¸ªç±»<code>MqConstants</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.constatnts;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MqConstants</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">HOTEL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;hotel.topic&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›‘å¬æ–°å¢å’Œä¿®æ”¹çš„é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">HOTEL_INSERT_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;hotel.insert.queue&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›‘å¬åˆ é™¤çš„é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">HOTEL_DELETE_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;hotel.delete.queue&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢æˆ–ä¿®æ”¹çš„RoutingKey</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">HOTEL_INSERT_KEY</span> <span class="operator">=</span> <span class="string">&quot;hotel.insert&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤çš„RoutingKey</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">HOTEL_DELETE_KEY</span> <span class="operator">=</span> <span class="string">&quot;hotel.delete&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="sheng-ming-dui-lie-jiao-huan-ji" id="å£°æ˜é˜Ÿåˆ—äº¤æ¢æœº">å£°æ˜é˜Ÿåˆ—äº¤æ¢æœº</h4><p>åœ¨hotel-demoä¸­ï¼Œå®šä¹‰é…ç½®ç±»ï¼Œå£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.hotel.constants.MqConstants;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Binding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.TopicExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MqConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TopicExchange <span class="title function_">topicExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TopicExchange</span>(MqConstants.HOTEL_EXCHANGE, <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">insertQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(MqConstants.HOTEL_INSERT_QUEUE, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">deleteQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(MqConstants.HOTEL_DELETE_QUEUE, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">insertQueueBinding</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(insertQueue()).to(topicExchange()).with(MqConstants.HOTEL_INSERT_KEY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">deleteQueueBinding</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(deleteQueue()).to(topicExchange()).with(MqConstants.HOTEL_DELETE_KEY);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="fa-song-mq-xiao-xi" id="å‘é€MQæ¶ˆæ¯">å‘é€MQæ¶ˆæ¯</h3><p>åœ¨hotel-adminä¸­çš„å¢ã€åˆ ã€æ”¹ä¸šåŠ¡ä¸­åˆ†åˆ«å‘é€MQæ¶ˆæ¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/5e44fa3241ea44a3abc19ea3d510e43d" alt="image-20210723221843816"></p><h3 id="jie-shou-mq-xiao-xi" id="æ¥æ”¶MQæ¶ˆæ¯">æ¥æ”¶MQæ¶ˆæ¯</h3><p>hotel-demoæ¥æ”¶åˆ°MQæ¶ˆæ¯è¦åšçš„äº‹æƒ…åŒ…æ‹¬ï¼š</p><ul><li>æ–°å¢æ¶ˆæ¯ï¼šæ ¹æ®ä¼ é€’çš„hotelçš„idæŸ¥è¯¢hotelä¿¡æ¯ï¼Œç„¶åæ–°å¢ä¸€æ¡æ•°æ®åˆ°ç´¢å¼•åº“</li><li>åˆ é™¤æ¶ˆæ¯ï¼šæ ¹æ®ä¼ é€’çš„hotelçš„idåˆ é™¤ç´¢å¼•åº“ä¸­çš„ä¸€æ¡æ•°æ®</li></ul><p>1ï¼‰é¦–å…ˆåœ¨hotel-demoçš„<code>cn.itcast.hotel.service</code>åŒ…ä¸‹çš„<code>IHotelService</code>ä¸­æ–°å¢æ–°å¢ã€åˆ é™¤ä¸šåŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insertById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><p>2ï¼‰ç»™hotel-demoä¸­çš„<code>cn.itcast.hotel.service.impl</code>åŒ…ä¸‹çš„HotelServiceä¸­å®ç°ä¸šåŠ¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">        <span class="type">DeleteRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(<span class="string">&quot;hotel&quot;</span>, id.toString());</span><br><span class="line">        <span class="comment">// 2.å‘é€è¯·æ±‚</span></span><br><span class="line">        client.delete(request, RequestOptions.DEFAULT);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 0.æ ¹æ®idæŸ¥è¯¢é…’åº—æ•°æ®</span></span><br><span class="line">        <span class="type">Hotel</span> <span class="variable">hotel</span> <span class="operator">=</span> getById(id);</span><br><span class="line">        <span class="comment">// è½¬æ¢ä¸ºæ–‡æ¡£ç±»å‹</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotelDoc</span>(hotel);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.å‡†å¤‡Requestå¯¹è±¡</span></span><br><span class="line">        <span class="type">IndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;hotel&quot;</span>).id(hotel.getId().toString());</span><br><span class="line">        <span class="comment">// 2.å‡†å¤‡Jsonæ–‡æ¡£</span></span><br><span class="line">        request.source(JSON.toJSONString(hotelDoc), XContentType.JSON);</span><br><span class="line">        <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">        client.index(request, RequestOptions.DEFAULT);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰ç¼–å†™ç›‘å¬å™¨</p><p>åœ¨hotel-demoä¸­çš„<code>cn.itcast.hotel.mq</code>åŒ…æ–°å¢ä¸€ä¸ªç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.mq;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.hotel.constants.MqConstants;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.hotel.service.IHotelService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IHotelService hotelService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›‘å¬é…’åº—æ–°å¢æˆ–ä¿®æ”¹çš„ä¸šåŠ¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id é…’åº—id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = MqConstants.HOTEL_INSERT_QUEUE)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenHotelInsertOrUpdate</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        hotelService.insertById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›‘å¬é…’åº—åˆ é™¤çš„ä¸šåŠ¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id é…’åº—id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = MqConstants.HOTEL_DELETE_QUEUE)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenHotelDelete</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        hotelService.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ji-qun">é›†ç¾¤</h1><p>å•æœºçš„elasticsearchåšæ•°æ®å­˜å‚¨ï¼Œå¿…ç„¶é¢ä¸´ä¸¤ä¸ªé—®é¢˜ï¼šæµ·é‡æ•°æ®å­˜å‚¨é—®é¢˜ã€å•ç‚¹æ•…éšœé—®é¢˜ã€‚</p><ul><li>æµ·é‡æ•°æ®å­˜å‚¨é—®é¢˜ï¼šå°†ç´¢å¼•åº“ä»é€»è¾‘ä¸Šæ‹†åˆ†ä¸ºNä¸ªåˆ†ç‰‡ï¼ˆshardï¼‰ï¼Œå­˜å‚¨åˆ°å¤šä¸ªèŠ‚ç‚¹</li><li>å•ç‚¹æ•…éšœé—®é¢˜ï¼šå°†åˆ†ç‰‡æ•°æ®åœ¨ä¸åŒèŠ‚ç‚¹å¤‡ä»½ï¼ˆreplica ï¼‰</li></ul><p><strong>ESé›†ç¾¤ç›¸å…³æ¦‚å¿µ</strong>:</p><ul><li><p>é›†ç¾¤ï¼ˆclusterï¼‰ï¼šä¸€ç»„æ‹¥æœ‰å…±åŒçš„ cluster name çš„ èŠ‚ç‚¹ã€‚</p></li><li><p><font color="red">èŠ‚ç‚¹ï¼ˆnode)</font>   ï¼šé›†ç¾¤ä¸­çš„ä¸€ä¸ª Elasticearch å®ä¾‹</p></li><li><p><font color="red">åˆ†ç‰‡ï¼ˆshardï¼‰</font>ï¼šç´¢å¼•å¯ä»¥è¢«æ‹†åˆ†ä¸ºä¸åŒçš„éƒ¨åˆ†è¿›è¡Œå­˜å‚¨ï¼Œç§°ä¸ºåˆ†ç‰‡ã€‚åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªç´¢å¼•çš„ä¸åŒåˆ†ç‰‡å¯ä»¥æ‹†åˆ†åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸­</p><p>è§£å†³é—®é¢˜ï¼šæ•°æ®é‡å¤ªå¤§ï¼Œå•ç‚¹å­˜å‚¨é‡æœ‰é™çš„é—®é¢˜ã€‚</p><p><img src="https://s1.vika.cn/space/2023/01/07/849b58466e904102b3d3b137b27ce459" alt="image-20200104124440086"></p><blockquote><p>æ­¤å¤„ï¼Œæˆ‘ä»¬æŠŠæ•°æ®åˆ†æˆ3ç‰‡ï¼šshard0ã€shard1ã€shard2</p></blockquote></li><li><p>ä¸»åˆ†ç‰‡ï¼ˆPrimary shardï¼‰ï¼šç›¸å¯¹äºå‰¯æœ¬åˆ†ç‰‡çš„å®šä¹‰ã€‚</p></li><li><p>å‰¯æœ¬åˆ†ç‰‡ï¼ˆReplica shardï¼‰æ¯ä¸ªä¸»åˆ†ç‰‡å¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå‰¯æœ¬ï¼Œæ•°æ®å’Œä¸»åˆ†ç‰‡ä¸€æ ·ã€‚</p><p>â€‹</p></li></ul><p>æ•°æ®å¤‡ä»½å¯ä»¥ä¿è¯é«˜å¯ç”¨ï¼Œä½†æ˜¯æ¯ä¸ªåˆ†ç‰‡å¤‡ä»½ä¸€ä»½ï¼Œæ‰€éœ€è¦çš„èŠ‚ç‚¹æ•°é‡å°±ä¼šç¿»ä¸€å€ï¼Œæˆæœ¬å®åœ¨æ˜¯å¤ªé«˜äº†ï¼</p><p>ä¸ºäº†åœ¨é«˜å¯ç”¨å’Œæˆæœ¬é—´å¯»æ±‚å¹³è¡¡ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p><ul><li>é¦–å…ˆå¯¹æ•°æ®åˆ†ç‰‡ï¼Œå­˜å‚¨åˆ°ä¸åŒèŠ‚ç‚¹</li><li>ç„¶åå¯¹æ¯ä¸ªåˆ†ç‰‡è¿›è¡Œå¤‡ä»½ï¼Œæ”¾åˆ°å¯¹æ–¹èŠ‚ç‚¹ï¼Œå®Œæˆäº’ç›¸å¤‡ä»½</li></ul><p>è¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘æ‰€éœ€è¦çš„æœåŠ¡èŠ‚ç‚¹æ•°é‡ï¼Œå¦‚å›¾ï¼Œæˆ‘ä»¬ä»¥3åˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡å¤‡ä»½ä¸€ä»½ä¸ºä¾‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/02d71c475af545858dc894f4a43dfc04" alt="image-20200104124551912"></p><p>ç°åœ¨ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½æœ‰1ä¸ªå¤‡ä»½ï¼Œå­˜å‚¨åœ¨3ä¸ªèŠ‚ç‚¹ï¼š</p><ul><li>node0ï¼šä¿å­˜äº†åˆ†ç‰‡0å’Œ1</li><li>node1ï¼šä¿å­˜äº†åˆ†ç‰‡0å’Œ2</li><li>node2ï¼šä¿å­˜äº†åˆ†ç‰‡1å’Œ2</li></ul><h2 id="da-jian-es-ji-qun" id="æ­å»ºESé›†ç¾¤">æ­å»ºESé›†ç¾¤</h2><p>æˆ‘ä»¬ä¼šåœ¨å•æœºä¸Šåˆ©ç”¨dockerå®¹å™¨è¿è¡Œå¤šä¸ªeså®ä¾‹æ¥æ¨¡æ‹Ÿesé›†ç¾¤ã€‚ä¸è¿‡ç”Ÿäº§ç¯å¢ƒæ¨èå¤§å®¶æ¯ä¸€å°æœåŠ¡èŠ‚ç‚¹ä»…éƒ¨ç½²ä¸€ä¸ªesçš„å®ä¾‹ã€‚</p><p>éƒ¨ç½²esé›†ç¾¤å¯ä»¥ç›´æ¥ä½¿ç”¨docker-composeæ¥å®Œæˆï¼Œä½†è¿™è¦æ±‚ä½ çš„Linuxè™šæ‹Ÿæœºè‡³å°‘æœ‰<strong>4G</strong>çš„å†…å­˜ç©ºé—´</p><h3 id="chuang-jian-es-ji-qun" id="åˆ›å»ºesé›†ç¾¤">åˆ›å»ºesé›†ç¾¤</h3><p>é¦–å…ˆç¼–å†™ä¸€ä¸ªdocker-composeæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;2.2&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  es01:</span><br><span class="line">    image: elasticsearch:7.12.1</span><br><span class="line">    container_name: es01</span><br><span class="line">    environment:</span><br><span class="line">      - node.name=es01</span><br><span class="line">      - cluster.name=es-docker-cluster</span><br><span class="line">      - discovery.seed_hosts=es02,es03</span><br><span class="line">      - cluster.initial_master_nodes=es01,es02,es03</span><br><span class="line">      - <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - data01:/usr/share/elasticsearch/data</span><br><span class="line">    ports:</span><br><span class="line">      - 9200:9200</span><br><span class="line">    networks:</span><br><span class="line">      - elastic</span><br><span class="line">  es02:</span><br><span class="line">    image: elasticsearch:7.12.1</span><br><span class="line">    container_name: es02</span><br><span class="line">    environment:</span><br><span class="line">      - node.name=es02</span><br><span class="line">      - cluster.name=es-docker-cluster</span><br><span class="line">      - discovery.seed_hosts=es01,es03</span><br><span class="line">      - cluster.initial_master_nodes=es01,es02,es03</span><br><span class="line">      - <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - data02:/usr/share/elasticsearch/data</span><br><span class="line">    ports:</span><br><span class="line">      - 9201:9200</span><br><span class="line">    networks:</span><br><span class="line">      - elastic</span><br><span class="line">  es03:</span><br><span class="line">    image: elasticsearch:7.12.1</span><br><span class="line">    container_name: es03</span><br><span class="line">    environment:</span><br><span class="line">      - node.name=es03</span><br><span class="line">      - cluster.name=es-docker-cluster</span><br><span class="line">      - discovery.seed_hosts=es01,es02</span><br><span class="line">      - cluster.initial_master_nodes=es01,es02,es03</span><br><span class="line">      - <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - data03:/usr/share/elasticsearch/data</span><br><span class="line">    networks:</span><br><span class="line">      - elastic</span><br><span class="line">    ports:</span><br><span class="line">      - 9202:9200</span><br><span class="line">volumes:</span><br><span class="line">  data01:</span><br><span class="line">    driver: <span class="built_in">local</span></span><br><span class="line">  data02:</span><br><span class="line">    driver: <span class="built_in">local</span></span><br><span class="line">  data03:</span><br><span class="line">    driver: <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  elastic:</span><br><span class="line">    driver: bridge</span><br></pre></td></tr></table></figure><p>esè¿è¡Œéœ€è¦ä¿®æ”¹ä¸€äº›linuxç³»ç»Ÿæƒé™ï¼Œä¿®æ”¹<code>/etc/sysctl.conf</code>æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysctl.conf</span><br></pre></td></tr></table></figure><p>æ·»åŠ ä¸‹é¢çš„å†…å®¹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count=262144</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œå‘½ä»¤ï¼Œè®©é…ç½®ç”Ÿæ•ˆï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><p>é€šè¿‡docker-composeå¯åŠ¨é›†ç¾¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><h3 id="ji-qun-zhuang-tai-jian-kong" id="é›†ç¾¤çŠ¶æ€ç›‘æ§">é›†ç¾¤çŠ¶æ€ç›‘æ§</h3><p>kibanaå¯ä»¥ç›‘æ§esé›†ç¾¤ï¼Œä¸è¿‡æ–°ç‰ˆæœ¬éœ€è¦ä¾èµ–esçš„x-pack åŠŸèƒ½ï¼Œé…ç½®æ¯”è¾ƒå¤æ‚ã€‚</p><p>è¿™é‡Œæ¨èä½¿ç”¨cerebroæ¥ç›‘æ§esé›†ç¾¤çŠ¶æ€ï¼Œå®˜æ–¹ç½‘å€ï¼š<a href="https://github.com/lmenezes/cerebro">https://github.com/lmenezes/cerebro</a></p><p>è¯¾å‰èµ„æ–™å·²ç»æä¾›äº†å®‰è£…åŒ…ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/4eeeecef9d5c48d08e9bd59856428b2a" alt="image-20210602220751081"></p><p>è§£å‹å³å¯ä½¿ç”¨ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p><p>è§£å‹å¥½çš„ç›®å½•å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/f94c68d59c944398a5a51c16a60fc3a9" alt="image-20210602220824668"></p><p>è¿›å…¥å¯¹åº”çš„binç›®å½•ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/469f18719dd34b4385cbb08d3c977cb4" alt="image-20210602220846137"></p><p>åŒå‡»å…¶ä¸­çš„cerebro.batæ–‡ä»¶å³å¯å¯åŠ¨æœåŠ¡ã€‚</p><p><img src="https://s1.vika.cn/space/2023/01/07/c83909df29444fb89a4b849145576e0b" alt="image-20210602220941101"></p><p>è®¿é—®http://localhost:9000 å³å¯è¿›å…¥ç®¡ç†ç•Œé¢ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/02b45559774c4abd8b44c7bae45e693b" alt="image-20210602221115763"></p><p>è¾“å…¥ä½ çš„elasticsearchçš„ä»»æ„èŠ‚ç‚¹çš„åœ°å€å’Œç«¯å£ï¼Œç‚¹å‡»connectå³å¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/20390accbea84ce492f0f39f961ea832" alt="image-20210109181106866"></p><p>ç»¿è‰²çš„æ¡ï¼Œä»£è¡¨é›†ç¾¤å¤„äºç»¿è‰²ï¼ˆå¥åº·çŠ¶æ€ï¼‰ã€‚</p><h3 id="chuang-jian-suo-yin-ku" id="åˆ›å»ºç´¢å¼•åº“">åˆ›å»ºç´¢å¼•åº“</h3><h4 id="li-yong-kibana-de-dev-tools-chuang-jian-suo-yin-ku" id="åˆ©ç”¨kibanaçš„DevToolsåˆ›å»ºç´¢å¼•åº“">åˆ©ç”¨kibanaçš„DevToolsåˆ›å»ºç´¢å¼•åº“</h4><p>åœ¨DevToolsä¸­è¾“å…¥æŒ‡ä»¤ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT /itcast</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="comment">// åˆ†ç‰‡æ•°é‡</span></span><br><span class="line">    <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">1</span> <span class="comment">// å‰¯æœ¬æ•°é‡</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// mappingæ˜ å°„å®šä¹‰ ...</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="li-yong-cerebro-chuang-jian-suo-yin-ku" id="åˆ©ç”¨cerebroåˆ›å»ºç´¢å¼•åº“">åˆ©ç”¨cerebroåˆ›å»ºç´¢å¼•åº“</h4><p>åˆ©ç”¨cerebroè¿˜å¯ä»¥åˆ›å»ºç´¢å¼•åº“ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/ea2db9289e8b455fb923a9d87d30a611" alt="image-20210602221409524"></p><p>å¡«å†™ç´¢å¼•åº“ä¿¡æ¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/1e130233a04e4cdda503179e88353759" alt="image-20210602221520629"></p><p>ç‚¹å‡»å³ä¸‹è§’çš„createæŒ‰é’®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/bc2953b4bcd04560a70f903a7a3dea12" alt="image-20210602221542745"></p><h3 id="cha-kan-fen-pian-xiao-guo" id="æŸ¥çœ‹åˆ†ç‰‡æ•ˆæœ">æŸ¥çœ‹åˆ†ç‰‡æ•ˆæœ</h3><p>å›åˆ°é¦–é¡µï¼Œå³å¯æŸ¥çœ‹ç´¢å¼•åº“åˆ†ç‰‡æ•ˆæœï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/0aacb687ef94468296f4b27a239cee6d" alt="image-20210602221914483"></p><h2 id="ji-qun-nao-lie-wen-ti" id="é›†ç¾¤è„‘è£‚é—®é¢˜">é›†ç¾¤è„‘è£‚é—®é¢˜</h2><h3 id="ji-qun-zhi-ze-hua-fen" id="é›†ç¾¤èŒè´£åˆ’åˆ†">é›†ç¾¤èŒè´£åˆ’åˆ†</h3><p>elasticsearchä¸­é›†ç¾¤èŠ‚ç‚¹æœ‰ä¸åŒçš„èŒè´£åˆ’åˆ†ï¼š</p><p><img src="assets/image-20210723223008967.png" alt="image-20210723223008967"></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé›†ç¾¤ä¸­çš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹éƒ½åŒæ—¶å…·å¤‡ä¸Šè¿°å››ç§è§’è‰²ã€‚</p><p>ä½†æ˜¯çœŸå®çš„é›†ç¾¤ä¸€å®šè¦å°†é›†ç¾¤èŒè´£åˆ†ç¦»ï¼š</p><ul><li>masterèŠ‚ç‚¹ï¼šå¯¹CPUè¦æ±‚é«˜ï¼Œä½†æ˜¯å†…å­˜è¦æ±‚ä½</li><li>dataèŠ‚ç‚¹ï¼šå¯¹CPUå’Œå†…å­˜è¦æ±‚éƒ½é«˜</li><li>coordinatingèŠ‚ç‚¹ï¼šå¯¹ç½‘ç»œå¸¦å®½ã€CPUè¦æ±‚é«˜</li></ul><p>èŒè´£åˆ†ç¦»å¯ä»¥è®©æˆ‘ä»¬æ ¹æ®ä¸åŒèŠ‚ç‚¹çš„éœ€æ±‚åˆ†é…ä¸åŒçš„ç¡¬ä»¶å»éƒ¨ç½²ã€‚è€Œä¸”é¿å…ä¸šåŠ¡ä¹‹é—´çš„äº’ç›¸å¹²æ‰°ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„esé›†ç¾¤èŒè´£åˆ’åˆ†å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/91759e35353a48a5855733c9c1735923" alt="image-20210723223629142"></p><h3 id="nao-lie-wen-ti" id="è„‘è£‚é—®é¢˜">è„‘è£‚é—®é¢˜</h3><p>è„‘è£‚æ˜¯å› ä¸ºé›†ç¾¤ä¸­çš„èŠ‚ç‚¹å¤±è”å¯¼è‡´çš„ã€‚</p><p>ä¾‹å¦‚ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œä¸»èŠ‚ç‚¹ä¸å…¶å®ƒèŠ‚ç‚¹å¤±è”ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/11543857e2e5404a86ff083bf54d623d" alt="image-20210723223804995"></p><p>æ­¤æ—¶ï¼Œnode2å’Œnode3è®¤ä¸ºnode1å®•æœºï¼Œå°±ä¼šé‡æ–°é€‰ä¸»ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/3630af9f1839410c8158aec3f5d27783" alt="image-20210723223845754"></p><p>å½“node3å½“é€‰åï¼Œé›†ç¾¤ç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ï¼Œnode2å’Œnode3è‡ªæˆé›†ç¾¤ï¼Œnode1è‡ªæˆé›†ç¾¤ï¼Œä¸¤ä¸ªé›†ç¾¤æ•°æ®ä¸åŒæ­¥ï¼Œå‡ºç°æ•°æ®å·®å¼‚ã€‚</p><p>å½“ç½‘ç»œæ¢å¤åï¼Œå› ä¸ºé›†ç¾¤ä¸­æœ‰ä¸¤ä¸ªmasterèŠ‚ç‚¹ï¼Œé›†ç¾¤çŠ¶æ€çš„ä¸ä¸€è‡´ï¼Œå‡ºç°è„‘è£‚çš„æƒ…å†µï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/e12ec335da734846bc03c0bd0b1795c2" alt="image-20210723224000555"></p><blockquote><p>è§£å†³è„‘è£‚çš„æ–¹æ¡ˆæ˜¯ï¼Œè¦æ±‚é€‰ç¥¨è¶…è¿‡ ( eligibleèŠ‚ç‚¹æ•°é‡ + 1 ï¼‰/ 2 æ‰èƒ½å½“é€‰ä¸ºä¸»ï¼Œå› æ­¤eligibleèŠ‚ç‚¹æ•°é‡æœ€å¥½æ˜¯å¥‡æ•°ã€‚å¯¹åº”é…ç½®é¡¹æ˜¯discovery.zen.minimum_master_nodesï¼Œåœ¨es7.0ä»¥åï¼Œå·²ç»æˆä¸ºé»˜è®¤é…ç½®ï¼Œå› æ­¤ä¸€èˆ¬ä¸ä¼šå‘ç”Ÿè„‘è£‚é—®é¢˜</p></blockquote><p>ä¾‹å¦‚ï¼š3ä¸ªèŠ‚ç‚¹å½¢æˆçš„é›†ç¾¤ï¼Œé€‰ç¥¨å¿…é¡»è¶…è¿‡ ï¼ˆ3 + 1ï¼‰ / 2 ï¼Œä¹Ÿå°±æ˜¯2ç¥¨ã€‚node3å¾—åˆ°node2å’Œnode3çš„é€‰ç¥¨ï¼Œå½“é€‰ä¸ºä¸»ã€‚node1åªæœ‰è‡ªå·±1ç¥¨ï¼Œæ²¡æœ‰å½“é€‰ã€‚é›†ç¾¤ä¸­ä¾ç„¶åªæœ‰1ä¸ªä¸»èŠ‚ç‚¹ï¼Œæ²¡æœ‰å‡ºç°è„‘è£‚ã€‚</p><h3 id="xiao-jie-1" id="å°ç»“-2">å°ç»“</h3><p>master eligibleèŠ‚ç‚¹çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>å‚ä¸é›†ç¾¤é€‰ä¸»</li><li>ä¸»èŠ‚ç‚¹å¯ä»¥ç®¡ç†é›†ç¾¤çŠ¶æ€ã€ç®¡ç†åˆ†ç‰‡ä¿¡æ¯ã€å¤„ç†åˆ›å»ºå’Œåˆ é™¤ç´¢å¼•åº“çš„è¯·æ±‚</li></ul><p>dataèŠ‚ç‚¹çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>æ•°æ®çš„CRUD</li></ul><p>coordinatorèŠ‚ç‚¹çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li><p>è·¯ç”±è¯·æ±‚åˆ°å…¶å®ƒèŠ‚ç‚¹</p></li><li><p>åˆå¹¶æŸ¥è¯¢åˆ°çš„ç»“æœï¼Œè¿”å›ç»™ç”¨æˆ·</p></li></ul><h2 id="ji-qun-fen-bu-shi-cun-chu" id="é›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨">é›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨</h2><p>å½“æ–°å¢æ–‡æ¡£æ—¶ï¼Œåº”è¯¥ä¿å­˜åˆ°ä¸åŒåˆ†ç‰‡ï¼Œä¿è¯æ•°æ®å‡è¡¡ï¼Œé‚£ä¹ˆcoordinating nodeå¦‚ä½•ç¡®å®šæ•°æ®è¯¥å­˜å‚¨åˆ°å“ªä¸ªåˆ†ç‰‡å‘¢ï¼Ÿ</p><h3 id="fen-pian-cun-chu-ce-shi" id="åˆ†ç‰‡å­˜å‚¨æµ‹è¯•">åˆ†ç‰‡å­˜å‚¨æµ‹è¯•</h3><p>æ’å…¥ä¸‰æ¡æ•°æ®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/12fa0429f2ae4247b9b27ffbfaead374" alt="image-20210723225006058"></p><p><img src="https://s1.vika.cn/space/2023/01/07/742d30433536440f9add8da8ecb4dfc1" alt="image-20210723225034637"></p><p><img src="https://s1.vika.cn/space/2023/01/07/f6bc83a300a1490cab7af44e6714fc72" alt="image-20210723225112029"></p><p>æµ‹è¯•å¯ä»¥çœ‹åˆ°ï¼Œä¸‰æ¡æ•°æ®åˆ†åˆ«åœ¨ä¸åŒåˆ†ç‰‡ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/05dfcaa7f90e40f6bd895eb4989c374b" alt="image-20210723225227928"></p><p>ç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/fcf424f37311454f980c4ba0216f25fd" alt="image-20210723225342120"></p><h3 id="fen-pian-cun-chu-yuan-li" id="åˆ†ç‰‡å­˜å‚¨åŸç†">åˆ†ç‰‡å­˜å‚¨åŸç†</h3><blockquote><p>elasticsearchä¼šé€šè¿‡hashç®—æ³•æ¥è®¡ç®—æ–‡æ¡£åº”è¯¥å­˜å‚¨åˆ°å“ªä¸ªåˆ†ç‰‡ï¼š</p></blockquote><p><img src="https://s1.vika.cn/space/2023/01/07/d153fa9966de47cd8bb934b2df4e123f" alt="image-20210723224354904"></p><p>è¯´æ˜ï¼š</p><ul><li>_routingé»˜è®¤æ˜¯æ–‡æ¡£çš„id</li><li>ç®—æ³•ä¸åˆ†ç‰‡æ•°é‡æœ‰å…³ï¼Œå› æ­¤ç´¢å¼•åº“ä¸€æ—¦åˆ›å»ºï¼Œåˆ†ç‰‡æ•°é‡ä¸èƒ½ä¿®æ”¹ï¼</li></ul><p>æ–°å¢æ–‡æ¡£çš„æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/0b07dd50c18c422390469e6e48ad6f03" alt="image-20210723225436084"></p><p>è§£è¯»ï¼š</p><ul><li>1ï¼‰æ–°å¢ä¸€ä¸ªid=1çš„æ–‡æ¡£</li><li>2ï¼‰å¯¹idåšhashè¿ç®—ï¼Œå‡å¦‚å¾—åˆ°çš„æ˜¯2ï¼Œåˆ™åº”è¯¥å­˜å‚¨åˆ°shard-2</li><li>3ï¼‰shard-2çš„ä¸»åˆ†ç‰‡åœ¨node3èŠ‚ç‚¹ï¼Œå°†æ•°æ®è·¯ç”±åˆ°node3</li><li>4ï¼‰ä¿å­˜æ–‡æ¡£</li><li>5ï¼‰åŒæ­¥ç»™shard-2çš„å‰¯æœ¬replica-2ï¼Œåœ¨node2èŠ‚ç‚¹</li><li>6ï¼‰è¿”å›ç»“æœç»™coordinating-nodeèŠ‚ç‚¹</li></ul><h2 id="ji-qun-fen-bu-shi-cha-xun" id="é›†ç¾¤åˆ†å¸ƒå¼æŸ¥è¯¢">é›†ç¾¤åˆ†å¸ƒå¼æŸ¥è¯¢</h2><blockquote><p>elasticsearchçš„æŸ¥è¯¢åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼š</p><ul><li><p>scatter phaseï¼šåˆ†æ•£é˜¶æ®µï¼Œcoordinating nodeä¼šæŠŠè¯·æ±‚åˆ†å‘åˆ°æ¯ä¸€ä¸ªåˆ†ç‰‡</p></li><li><p>gather phaseï¼šèšé›†é˜¶æ®µï¼Œcoordinating nodeæ±‡æ€»data nodeçš„æœç´¢ç»“æœï¼Œå¹¶å¤„ç†ä¸ºæœ€ç»ˆç»“æœé›†è¿”å›ç»™ç”¨æˆ·</p></li></ul></blockquote><p><img src="https://s1.vika.cn/space/2023/01/07/0886149c239b46cd8215af217d9e090f" alt="image-20210723225809848"></p><h2 id="ji-qun-gu-zhang-zhuan-yi" id="é›†ç¾¤æ•…éšœè½¬ç§»">é›†ç¾¤æ•…éšœè½¬ç§»</h2><p>é›†ç¾¤çš„masterèŠ‚ç‚¹ä¼šç›‘æ§é›†ç¾¤ä¸­çš„èŠ‚ç‚¹çŠ¶æ€ï¼Œå¦‚æœå‘ç°æœ‰èŠ‚ç‚¹å®•æœºï¼Œä¼šç«‹å³å°†å®•æœºèŠ‚ç‚¹çš„åˆ†ç‰‡æ•°æ®è¿ç§»åˆ°å…¶å®ƒèŠ‚ç‚¹ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ï¼Œè¿™ä¸ªå«åšæ•…éšœè½¬ç§»ã€‚</p><ol><li>ä¾‹å¦‚ä¸€ä¸ªé›†ç¾¤ç»“æ„å¦‚å›¾ï¼š</li></ol><p><img src="https://s1.vika.cn/space/2023/01/07/170d85b45c1c4f79a5a6653b4a385d81" alt="image-20210723225945963"></p><p>ç°åœ¨ï¼Œnode1æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå…¶å®ƒä¸¤ä¸ªèŠ‚ç‚¹æ˜¯ä»èŠ‚ç‚¹ã€‚</p><ol start="2"><li>çªç„¶ï¼Œnode1å‘ç”Ÿäº†æ•…éšœï¼š</li></ol><p><img src="https://s1.vika.cn/space/2023/01/07/eef150df3a054fcaac50b98e1c3d370f" alt="image-20210723230020574"></p><ol start="3"><li>å®•æœºåçš„ç¬¬ä¸€ä»¶äº‹ï¼Œéœ€è¦é‡æ–°é€‰ä¸»ï¼Œä¾‹å¦‚é€‰ä¸­äº†node2ï¼š</li></ol><p><img src="https://s1.vika.cn/space/2023/01/07/3ef964ba2a1c40eb8a5da9a7d83fdf00" alt="image-20210723230055974"></p><ol start="4"><li>node2æˆä¸ºä¸»èŠ‚ç‚¹åï¼Œä¼šæ£€æµ‹é›†ç¾¤ç›‘æ§çŠ¶æ€ï¼Œå‘ç°ï¼šshard-1ã€shard-0æ²¡æœ‰å‰¯æœ¬èŠ‚ç‚¹ã€‚å› æ­¤éœ€è¦å°†node1ä¸Šçš„æ•°æ®è¿ç§»åˆ°node2ã€node3ï¼š</li></ol><p><img src="https://s1.vika.cn/space/2023/01/07/eb2c902964ff4b58a4a346533f6397a7" alt="image-20210723230216642"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;fen-bu-shi-sou-suo-yin-qing-03&quot;&gt;åˆ†å¸ƒå¼æœç´¢å¼•æ“03&lt;/h1&gt;
&lt;h1 id=&quot;shu-ju-ju-he&quot;&gt;æ•°æ®èšåˆ&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;**&lt;a href=&quot;https://www.elastic.co/gui</summary>
      
    
    
    
    <category term="Java" scheme="https://www.taoyaopc.live/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„C++ç‰ˆ</title>
    <link href="https://www.taoyaopc.live/posts/4b0178e0.html"/>
    <id>https://www.taoyaopc.live/posts/4b0178e0.html</id>
    <published>2023-03-14T07:00:00.000Z</published>
    <updated>2023-04-25T15:01:07.120Z</updated>
    
    <content type="html"><![CDATA[<h1 id="xian-xing-biao-he-lian-biao">çº¿æ€§è¡¨å’Œé“¾è¡¨</h1><h2 id="xi-ti" id="ä¹ é¢˜">ä¹ é¢˜</h2><h3 id="2-3" id="2-3">2-3</h3><blockquote><p>é¢˜ç›®æè¿°ï¼šå·²çŸ¥ä¸¤ä¸ªé“¾è¡¨ A å’Œ B åˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªé›†åˆï¼Œå…¶å…ƒç´ é€’å¢æ’åˆ—ã€‚è¯·è®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œç”¨äºæ±‚å‡º A å’Œ B çš„äº¤é›†ï¼Œå¹¶å°†ç»“æœå­˜æ”¾åœ¨ A é“¾è¡¨ä¸­ã€‚</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">LNode</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> data;</span><br><span class="line">LNode *next;</span><br><span class="line">&#125;LNode,*LinkList;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//åˆ›å»ºé“¾è¡¨</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CreateList</span><span class="params">(LinkList &amp;L,<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">LNode *p,*r;<span class="type">int</span> i;</span><br><span class="line">L=<span class="keyword">new</span> LNode;</span><br><span class="line">L-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">r=L;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">&#123;</span><br><span class="line">p=<span class="keyword">new</span> LNode;</span><br><span class="line">cin&gt;&gt;p-&gt;data;</span><br><span class="line">p-&gt;next=<span class="literal">NULL</span>;r-&gt;next=p;</span><br><span class="line">r=p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//è¾“å‡ºé“¾è¡¨</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(LinkList L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">LNode *p;</span><br><span class="line">p=L-&gt;next;</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;&#123;&quot;</span>;</span><br><span class="line"><span class="keyword">while</span>(p)</span><br><span class="line">&#123;cout&lt;&lt;p-&gt;data&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">p=p-&gt;next;&#125;</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;&#125;&quot;</span>&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//äº¤é›†</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MergeList_L</span><span class="params">(LinkList &amp;LA,LinkList &amp;LB,LinkList &amp;LC)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LNode *pa;LNode *pb;LNode *pc;LNode *p;</span><br><span class="line">    pa=LA-&gt;next;pb=LB-&gt;next;</span><br><span class="line">    LC=LA;</span><br><span class="line">    pc=LC;</span><br><span class="line">    <span class="keyword">while</span>(pa&amp;&amp;pb)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(pa-&gt;data==pb-&gt;data)</span><br><span class="line">        &#123;</span><br><span class="line">            pc-&gt;next=pa;</span><br><span class="line">            pc=pa;</span><br><span class="line">            pa=pa-&gt;next;</span><br><span class="line">            pb=pb-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pa-&gt;data&lt;pb-&gt;data)</span><br><span class="line">            pa=pa-&gt;next;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pb=pb-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    pc-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">    LA=LC;</span><br><span class="line">    <span class="keyword">delete</span> LB;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">LinkList LA;LinkList LB;LinkList LC;<span class="type">int</span> n;</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;è¯·è¾“å…¥éœ€è¦åˆ›å»ºçš„Aé›†åˆå…ƒç´ çš„ä¸ªæ•°ï¼š&quot;</span>&lt;&lt;endl;</span><br><span class="line">cin&gt;&gt;n;</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;è¯·ä¾æ¬¡è¾“å…¥éœ€è¦å­˜å…¥çš„æ•°æ®(å°¾æ’æ³•&amp;&amp;é€’å¢)ï¼š&quot;</span>&lt;&lt;endl;</span><br><span class="line"><span class="built_in">CreateList</span> (LA,n);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">cout&lt;&lt;<span class="string">&quot;è¯·è¾“å…¥éœ€è¦åˆ›å»ºçš„Bé›†åˆå…ƒç´ çš„ä¸ªæ•°ï¼š&quot;</span>&lt;&lt;endl;</span><br><span class="line">cin&gt;&gt;n;</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;è¯·ä¾æ¬¡è¾“å…¥éœ€è¦å­˜å…¥çš„æ•°æ®(å°¾æ’æ³•&amp;&amp;é€’å¢)ï¼š&quot;</span>&lt;&lt;endl;</span><br><span class="line"><span class="built_in">CreateList</span> (LB,n);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">cout&lt;&lt;<span class="string">&quot;é›†åˆAä¸ºï¼š&quot;</span>;</span><br><span class="line"><span class="built_in">display</span>(LA);</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;é›†åˆBä¸ºï¼š&quot;</span>;</span><br><span class="line"><span class="built_in">display</span>(LB);</span><br><span class="line"> </span><br><span class="line"><span class="built_in">MergeList_L</span>(LA,LB,LC);</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;äºŒè€…çš„äº¤é›†ä¸ºï¼š&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">display</span>(LA);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><h3 id="2-5" id="2-5">2-5</h3><blockquote><p>é¢˜ç›®æè¿°ï¼šè®¾è®¡ç®—æ³•å°†ä¸€ä¸ªå¸¦å¤´èŠ‚ç‚¹çš„å•é“¾è¡¨Aåˆ†è§£ä¸ºä¸¤ä¸ªå…·æœ‰ç›¸åŒç»“æ„çš„é“¾è¡¨Bå’ŒCï¼Œå…¶ä¸­Bè¡¨ç¤ºçš„èŠ‚ç‚¹ä¸ºAè¡¨ä¸­å€¼å°äº0çš„èŠ‚ç‚¹ï¼Œè€ŒCè¡¨çš„èŠ‚ç‚¹ä¸ºAè¡¨ä¸­å€¼å¤§äº0çš„èŠ‚ç‚¹ï¼ˆé“¾è¡¨Aä¸­çš„å…ƒç´ ä¸ºé0æ•´æ•°ï¼Œè¦æ±‚Bã€Cè¡¨åˆ©ç”¨Aè¡¨çš„èŠ‚ç‚¹ã€‚</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">//å®šä¹‰å­˜å‚¨</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">LNode</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> date;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">LNode</span> *next;</span><br><span class="line">&#125; Lnode, *Linklist;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é“¾è¡¨åˆå§‹åŒ–</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(Linklist &amp;L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    L = <span class="keyword">new</span> Lnode;  <span class="comment">// å¼€è¾Ÿç©ºé—´</span></span><br><span class="line">    L-&gt;next = <span class="literal">NULL</span>; <span class="comment">//å¤´èŠ‚ç‚¹ç½®ä¸ºç©º</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å‡ºæ•°æ®</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">output</span><span class="params">(Linklist &amp;T)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Linklist p = T;</span><br><span class="line">    p = p-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (p)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; p-&gt;date;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åæ’æ³•æ„å»ºé“¾è¡¨</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateLiklist</span><span class="params">(Linklist &amp;L, <span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Linklist r = L;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        Linklist p = <span class="keyword">new</span> Lnode; <span class="comment">//å¼€è¾Ÿç©ºé—´ï¼Œpä¸ºèŠ‚ç‚¹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;è¯·è¾“å…¥%dä¸ªæ•°æ®\n&quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">        cin &gt;&gt; p-&gt;date;</span><br><span class="line">        p-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">        r-&gt;next = p; <span class="comment">//å°†æ–°èŠ‚ç‚¹æ’å…¥rä¹‹å</span></span><br><span class="line">        r = p;       <span class="comment">//ræŒ‡å‘æ–°çš„å°¾èŠ‚ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Resolve</span><span class="params">(Linklist &amp;La, Linklist &amp;Lb)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Linklist pre = La;</span><br><span class="line">    Linklist pb = Lb;</span><br><span class="line">    Linklist pa = La;</span><br><span class="line">    pa = pa-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (pa)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (pa-&gt;date &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Linklist p = <span class="keyword">new</span> Lnode;</span><br><span class="line">            p = pa;               <span class="comment">//ç”Ÿæˆæ–°èŠ‚ç‚¹</span></span><br><span class="line">            pre-&gt;next = pa-&gt;next; <span class="comment">//åˆ é™¤å°äº0çš„èŠ‚ç‚¹ï¼Œpreå§‹ç»ˆä¸ºpaçš„å‰é©±</span></span><br><span class="line">            pa = pa-&gt;next;        <span class="comment">//paåç§»</span></span><br><span class="line">            p-&gt;next = <span class="literal">NULL</span>;       <span class="comment">//åæ’æ³•å°†å…ƒç´ æ’å…¥Lbä¸­</span></span><br><span class="line">            pb-&gt;next = p;</span><br><span class="line">            pb = p; <span class="comment">//æ’å…¥</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">//å¤§äº0</span></span><br><span class="line">        &#123;</span><br><span class="line">            pre = pa;</span><br><span class="line">            pa = pa-&gt;next; <span class="comment">//preä¸ºpaçš„å‰é©±ï¼ŒpaæŒ‡é’ˆåç§»åŠ¨ã€‚</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Linklist La, Lb;</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">init</span>(La);</span><br><span class="line">    <span class="built_in">init</span>(Lb);</span><br><span class="line">    <span class="type">int</span> n1;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;è¯·è¾“å…¥è¯·è¾“å…¥é“¾è¡¨å…ƒç´ çš„ä¸ªæ•°&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cin &gt;&gt; n1;</span><br><span class="line">    <span class="built_in">CreateLiklist</span>(La, n1);</span><br><span class="line">    <span class="built_in">Resolve</span>(La, Lb);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;La:&quot;</span>;</span><br><span class="line">    <span class="built_in">output</span>(La);</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Lb:&quot;</span>;</span><br><span class="line">    <span class="built_in">output</span>(Lb);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-6" id="2-6">2-6</h3><blockquote><p>é¢˜ç›®æè¿°ï¼šè®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œé€šè¿‡ä¸€è¶Ÿéå†ç¡®å®šé•¿åº¦ä¸ºnçš„å•é“¾è¡¨ä¸­å€¼æœ€å¤§çš„èŠ‚ç‚¹</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;malloc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">sqlist</span> sqlist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sqlist</span> &#123;</span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sqlist</span> *next;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">sqlist * <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    sqlist *head = (sqlist *)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(sqlist));</span><br><span class="line">    head-&gt;data = <span class="number">0</span>;</span><br><span class="line">    head-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initList</span><span class="params">(sqlist * head, <span class="type">int</span> * arr, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(arr == <span class="literal">NULL</span> || len == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sqlist *p;</span><br><span class="line">    p = head;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        sqlist *q = <span class="built_in">create</span>();</span><br><span class="line">        p-&gt;data = *arr++;</span><br><span class="line">        p-&gt;next = q;</span><br><span class="line">        p = q;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">sqlist *<span class="title">getMax</span><span class="params">(sqlist *head, <span class="type">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(head == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sqlist *max = head;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        max = head-&gt;data &gt; max-&gt;data ? head : max;</span><br><span class="line">        head = head-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;len);</span><br><span class="line">    <span class="type">int</span> arr[len];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    sqlist *head = <span class="built_in">create</span>();</span><br><span class="line">    <span class="built_in">initList</span>(head, arr, len);</span><br><span class="line">    sqlist *item = <span class="built_in">getMax</span>(head, len);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, item-&gt;data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-7" id="2-7">2-7</h3><blockquote><p>é¢˜ç›®æè¿°ï¼šè®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œå°†é“¾è¡¨ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„é“¾æ¥æ–¹å‘ â€œåŸåœ°â€ é€†è½¬ï¼Œå³è¦æ±‚ä»…åˆ©ç”¨åŸè¡¨çš„å­˜å‚¨ç©ºé—´ï¼Œæ¢å¥è¯è¯´ï¼Œè¦æ±‚ç®—æ³•çš„ç©ºé—´å¤æ‚åº¦ <code>O(1)</code></p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;malloc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">sqlist</span> sqlist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sqlist</span> &#123;</span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sqlist</span> *next;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">sqlist * <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    sqlist *head = (sqlist *)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(sqlist));</span><br><span class="line">    head-&gt;data = <span class="number">0</span>;</span><br><span class="line">    head-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initList</span><span class="params">(sqlist * head, <span class="type">int</span> * arr, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    sqlist *p;</span><br><span class="line">    p = head;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        sqlist *q = <span class="built_in">create</span>();</span><br><span class="line">        p-&gt;data = *arr++;</span><br><span class="line">        p-&gt;next = q;</span><br><span class="line">        p = q;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dispList</span><span class="params">(sqlist *head, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(head == <span class="literal">NULL</span> || len == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len<span class="number">-1</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d-&gt; &quot;</span>, head-&gt;data);</span><br><span class="line">        head = head-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, head-&gt;data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">sqlist * <span class="title">reverseList</span><span class="params">(sqlist *head, <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(head == <span class="literal">NULL</span> || len == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(head-&gt;next == <span class="literal">NULL</span> || len == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    sqlist *p = head;</span><br><span class="line">    sqlist *q = head-&gt;next;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        p = q;</span><br><span class="line">        q = q-&gt;next;</span><br><span class="line">        p-&gt;next = head;</span><br><span class="line">        head = p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;len);</span><br><span class="line">    <span class="type">int</span> arr[len];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    sqlist *head = <span class="built_in">create</span>();</span><br><span class="line">    <span class="built_in">initList</span>(head, arr, len);</span><br><span class="line">    <span class="built_in">dispList</span>(head, len);</span><br><span class="line">    head = <span class="built_in">reverseList</span>(head, len);</span><br><span class="line">    <span class="built_in">dispList</span>(head, len);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-10" id="2-10">2-10</h3><blockquote><p>é¢˜ç›®æè¿°ï¼šå·²çŸ¥é•¿åº¦ä¸ºnçš„çº¿æ€§è¡¨Aé‡‡ç”¨é¡ºåºå­˜å‚¨ç»“æ„ï¼Œè¯·è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º <code>O(n)</code> ã€ç©ºé—´å¤æ‚åº¦ä¸º <code>O(1)</code> çš„ç®—æ³•ï¼Œè¯¥ç®—æ³•å¯åˆ é™¤çº¿æ€§è¡¨ä¸­æ‰€æœ‰å€¼ä¸ºitemçš„æ•°æ®å…ƒç´ ã€‚</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;malloc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> ElemType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span>&#123;</span><br><span class="line">    ElemType data[<span class="number">50</span>];</span><br><span class="line">    <span class="type">int</span> length;</span><br><span class="line">&#125; SqList;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å»ºç«‹é¡ºåºè¡¨</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateList</span><span class="params">(SqList *&amp;L,ElemType a[],<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">    L=(SqList *)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(SqList));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;n; i++)</span><br><span class="line">        L-&gt;data[i]=a[i];</span><br><span class="line">    L-&gt;length=n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">InitList</span><span class="params">(SqList *&amp;L)</span></span>&#123;</span><br><span class="line">    L=(SqList *)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(SqList));</span><br><span class="line">    L-&gt;length=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DispList</span><span class="params">(SqList *L)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;L-&gt;length; i++)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,L-&gt;data[i]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¸å¿ƒç®—æ³•</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Delete</span><span class="params">(SqList *&amp;L,<span class="type">int</span> item)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>,k=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; L-&gt;length)&#123;</span><br><span class="line">        <span class="keyword">if</span>(L-&gt;data[i]!=item)</span><br><span class="line">            L-&gt;data[k++] = L-&gt;data[i]; <span class="comment">// è‹¥ä¸ç›¸ç­‰åˆ™è®°å½•</span></span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    L-&gt;length = k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SqList *L;</span><br><span class="line">    <span class="type">int</span> n = <span class="number">5</span>;</span><br><span class="line">    ElemType a[]= &#123;<span class="number">11</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">13</span>,<span class="number">19</span>&#125;;</span><br><span class="line">    <span class="built_in">CreateList</span>(L,a,n);</span><br><span class="line">    <span class="built_in">DispList</span>(L);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="built_in">Delete</span>(L,<span class="number">13</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;åˆ é™¤ä¹‹åçš„ç»“æœæ˜¯ï¼š&quot;</span>);</span><br><span class="line">    <span class="built_in">DispList</span>(L);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="zhan-he-dui-lie">æ ˆå’Œé˜Ÿåˆ—</h1><h2 id="2-2" id="2-2">2-2</h2><blockquote><p>é¢˜ç›®æè¿°ï¼šå›æ–‡æ˜¯æŒ‡æ­£è¯»ã€åè¯»å‡ç›¸åŒçš„å­—ç¬¦åºåˆ—ï¼Œå¦‚ â€œabbaâ€ å’Œ â€œabdbaâ€ å‡æ˜¯å›æ–‡ï¼Œä½† â€œgoodâ€ ä¸æ˜¯å›æ–‡ã€‚è¯•è®¾è®¡ç®—æ³•åˆ¤å®šç»™å®šçš„å­—ç¬¦åºåˆ—æ˜¯å¦ä¸ºå›æ–‡ã€‚(æç¤ºï¼šå°†ä¸€åŠå­—ç¬¦å…¥æ ˆã€‚)</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> maxSize = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> arr[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">Stack</span> &#123;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    <span class="type">char</span> * base;</span><br><span class="line">    <span class="type">char</span> * top;</span><br><span class="line">&#125; Stack;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„é€ ä¸€ä¸ªç©ºæ ˆ stack</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">initStack</span><span class="params">(Stack &amp;stack)</span> </span>&#123;</span><br><span class="line">    stack.base = <span class="keyword">new</span> <span class="type">char</span>[maxSize]; <span class="comment">// åˆ†é…ç©ºé—´</span></span><br><span class="line">    <span class="keyword">if</span>(!stack.base) </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    stack.top = stack.base;</span><br><span class="line">    stack.size = maxSize;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¥æ ˆ</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">push</span><span class="params">(Stack &amp;stack, <span class="type">char</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(stack.top - stack.base == stack.size)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// æ ˆæ»¡</span></span><br><span class="line">    *stack.top++ = c;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ ˆé¡¶å…ƒç´ </span></span><br><span class="line"><span class="function"><span class="type">char</span> <span class="title">top</span><span class="params">(Stack &amp;stack)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(stack.top != stack.base) </span><br><span class="line">        <span class="keyword">return</span> *(stack.top - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡ºæ ˆå¹¶è¿”å›æ ˆé¡¶å…ƒç´ </span></span><br><span class="line"><span class="function"><span class="type">char</span> <span class="title">pop</span><span class="params">(Stack &amp;stack)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(stack.top == stack.base) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>; <span class="comment">// ç©ºæ ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *--stack.top;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isHuiWen</span><span class="params">(<span class="type">char</span> arr[], <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    Stack stack;</span><br><span class="line">    <span class="built_in">initStack</span>(stack);</span><br><span class="line">    <span class="type">int</span> mid = len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; mid; i++) &#123;</span><br><span class="line">        <span class="built_in">push</span>(stack, arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(mid &lt; len &amp;&amp; len % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">pop</span>(stack) != arr[mid++]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(mid &lt; len<span class="number">-1</span> &amp;&amp; len % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">pop</span>(stack) != arr[++mid]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d &quot;</span>, &amp;len);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>, &amp;arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c &quot;</span>, arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isHuiWen</span>(arr, len)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;hiuwen\n&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;not huiwen\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-6-1" id="2-6-2">2-6</h2><blockquote><p>é¢˜ç›®æè¿°ï¼šå‡è®¾ä»¥å¸¦å¤´èŠ‚ç‚¹çš„å¾ªç¯é“¾è¡¨è¡¨ç¤ºé˜Ÿåˆ—ï¼Œå¹¶ä¸”åªè®¾ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘é˜Ÿå°¾å…ƒç´ èŠ‚ç‚¹ï¼ˆæ³¨æ„ï¼šä¸è®¾å¤´æŒ‡é’ˆï¼‰ï¼Œè¯•ç¼–å†™ç›¸åº”çš„ç½®ç©ºé˜Ÿåˆ—ã€åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€å…¥é˜Ÿå’Œå‡ºé˜Ÿç­‰ç®—æ³•ã€‚</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">QNode</span> &#123;</span><br><span class="line">    QNode *next;</span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">&#125; QNode, *QueuePtr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">LinkQueue</span> &#123;</span><br><span class="line">    QueuePtr rear;</span><br><span class="line">&#125; LinkQueue;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isBlank</span><span class="params">(LinkQueue &amp;queue)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(queue.rear-&gt;next == queue.rear) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initQueue</span><span class="params">(LinkQueue &amp;queue)</span> </span>&#123;</span><br><span class="line">    queue.rear = <span class="keyword">new</span> QNode;</span><br><span class="line">    queue.rear-&gt;next = queue.rear;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;create queue success!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">enQueue</span><span class="params">(LinkQueue &amp;queue, <span class="type">int</span> data)</span> </span>&#123;</span><br><span class="line">    QueuePtr p = <span class="keyword">new</span> QNode;</span><br><span class="line">    p-&gt;data = data;</span><br><span class="line">    p-&gt;next = queue.rear-&gt;next; <span class="comment">// æ„æˆå¾ªç¯</span></span><br><span class="line">    queue.rear-&gt;next = p; <span class="comment">// å…¥é˜Ÿï¼Œæ’åˆ°è¡¨å°¾ä¹‹å</span></span><br><span class="line">    queue.rear = p; <span class="comment">// æ›´æ–°è¡¨å°¾æŒ‡é’ˆ</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;insert %d success\n&quot;</span>, p-&gt;data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">deQueue</span><span class="params">(LinkQueue &amp;queue)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isBlank</span>(queue)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    QueuePtr p = queue.rear-&gt;next-&gt;next;</span><br><span class="line">    queue.rear-&gt;next-&gt;next = p-&gt;next;</span><br><span class="line">    <span class="type">int</span> data = p-&gt;data;</span><br><span class="line">    <span class="keyword">if</span>(queue.rear == p) &#123;</span><br><span class="line">        queue.rear = queue.rear-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span> p;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;delete %d success!\n&quot;</span>, data);</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getHead</span><span class="params">(LinkQueue queue)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isBlank</span>(queue)) &#123;</span><br><span class="line">        <span class="keyword">return</span> queue.rear-&gt;next-&gt;data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printQueue</span><span class="params">(LinkQueue queue)</span> </span>&#123;</span><br><span class="line">    QueuePtr p = queue.rear-&gt;next-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(p != queue.rear-&gt;next) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d-&gt;&quot;</span>, p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LinkQueue queue;</span><br><span class="line">    <span class="built_in">initQueue</span>(queue);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">enQueue</span>(queue, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printQueue</span>(queue);</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isBlank</span>(queue)) &#123;</span><br><span class="line">        <span class="built_in">deQueue</span>(queue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-10-1" id="2-10-2">2-10</h2><blockquote><p>é¢˜ç›®æè¿°ï¼šå·²çŸ¥fä¸ºå•é“¾è¡¨çš„è¡¨å¤´æŒ‡é’ˆï¼Œé“¾è¡¨ä¸­å‚¨å­˜çš„éƒ½æ˜¯æ•´å‹æ•°æ®ï¼Œè¯•å†™å‡ºå®ç°ä¸‹åˆ—è¿ç®—çš„é€’å½’ç®—æ³•ï¼š</p><ol><li>æ±‚é“¾è¡¨ä¸­çš„æœ€å¤§æ•´æ•°ï¼›</li><li>æ±‚é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ä¸ªæ•°ï¼›</li><li>æ±‚æ‰€æœ‰æ•´æ•°çš„å¹³å‡å€¼ã€‚</li></ol></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">getMax</span><span class="params">(LinkList L)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(L-&gt;next == <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> L-&gt;data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> m = <span class="built_in">getMax</span>(L-&gt;next);</span><br><span class="line"><span class="keyword">return</span> m &gt;= L-&gt;data ? m : L-&gt;data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="er-cha-shu">äºŒå‰æ ‘</h1><h2 id="ji-chu-zhi-shi" id="åŸºç¡€çŸ¥è¯†">åŸºç¡€çŸ¥è¯†</h2><p>äºŒå‰æ ‘æ˜¯è¿™ä¹ˆä¸€ç§æ ‘çŠ¶ç»“æ„ï¼šæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­©å­ï¼Œå·¦å­©å­å’Œå³å­©å­</p><p>é‡è¦çš„äºŒå‰æ ‘ç»“æ„</p><ul><li>å®Œå…¨äºŒå‰æ ‘ï¼ˆcomplete binary treeï¼‰æ˜¯ä¸€ç§äºŒå‰æ ‘ç»“æ„ï¼Œé™¤æœ€åä¸€å±‚ä»¥å¤–ï¼Œæ¯ä¸€å±‚éƒ½å¿…é¡»å¡«æ»¡ï¼Œå¡«å……æ—¶è¦éµä»å…ˆå·¦åå³</li><li>å¹³è¡¡äºŒå‰æ ‘ï¼ˆbalance binary treeï¼‰æ˜¯ä¸€ç§äºŒå‰æ ‘ç»“æ„ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦ç›¸å·®ä¸è¶…è¿‡ 1</li></ul><h3 id="cun-chu" id="å­˜å‚¨">å­˜å‚¨</h3><p>å­˜å‚¨æ–¹å¼åˆ†ä¸ºä¸¤ç§</p><ol><li>å®šä¹‰æ ‘èŠ‚ç‚¹ä¸å·¦ã€å³å­©å­å¼•ç”¨ï¼ˆTreeNodeï¼‰</li><li>ä½¿ç”¨æ•°ç»„ï¼Œå‰é¢è®²å †æ—¶ç”¨è¿‡ï¼Œè‹¥ä»¥ 0 ä½œä¸ºæ ‘çš„æ ¹ï¼Œç´¢å¼•å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¡ç®—<ul><li>çˆ¶ = floor((å­ - 1) / 2)</li><li>å·¦å­©å­ = çˆ¶ * 2 + 1</li><li>å³å­©å­ = çˆ¶ * 2 + 2</li></ul></li></ol><h3 id="bian-li" id="éå†">éå†</h3><p>éå†ä¹Ÿåˆ†ä¸ºä¸¤ç§</p><ol><li>å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBreadth-first orderï¼‰ï¼šå°½å¯èƒ½å…ˆè®¿é—®è·ç¦»æ ¹æœ€è¿‘çš„èŠ‚ç‚¹ï¼Œä¹Ÿç§°ä¸ºå±‚åºéå†</li><li>æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDepth-first orderï¼‰ï¼šå¯¹äºäºŒå‰æ ‘ï¼Œå¯ä»¥è¿›ä¸€æ­¥åˆ†æˆä¸‰ç§ï¼ˆè¦æ·±å…¥åˆ°å¶å­èŠ‚ç‚¹ï¼‰<ol><li>pre-order å‰åºéå†ï¼Œå¯¹äºæ¯ä¸€æ£µå­æ ‘ï¼Œå…ˆè®¿é—®è¯¥èŠ‚ç‚¹ï¼Œç„¶åæ˜¯å·¦å­æ ‘ï¼Œæœ€åæ˜¯å³å­æ ‘</li><li>in-order ä¸­åºéå†ï¼Œå¯¹äºæ¯ä¸€æ£µå­æ ‘ï¼Œå…ˆè®¿é—®å·¦å­æ ‘ï¼Œç„¶åæ˜¯è¯¥èŠ‚ç‚¹ï¼Œæœ€åæ˜¯å³å­æ ‘</li><li>post-order ååºéå†ï¼Œå¯¹äºæ¯ä¸€æ£µå­æ ‘ï¼Œå…ˆè®¿é—®å·¦å­æ ‘ï¼Œç„¶åæ˜¯å³å­æ ‘ï¼Œæœ€åæ˜¯è¯¥èŠ‚ç‚¹</li></ol></li></ol><h4 id="yan-du-you-xian" id="å¹¿åº¦ä¼˜å…ˆ">å¹¿åº¦ä¼˜å…ˆ</h4><p><img src="imgs/image-20230216153607396.png" alt="image-20230216153607396"></p><table><thead><tr><th>æœ¬è½®å¼€å§‹æ—¶é˜Ÿåˆ—</th><th>æœ¬è½®è®¿é—®èŠ‚ç‚¹</th></tr></thead><tbody><tr><td>[1]</td><td>1</td></tr><tr><td>[2, 3]</td><td>2</td></tr><tr><td>[3, 4]</td><td>3</td></tr><tr><td>[4, 5, 6]</td><td>4</td></tr><tr><td>[5, 6]</td><td>5</td></tr><tr><td>[6, 7, 8]</td><td>6</td></tr><tr><td>[7, 8]</td><td>7</td></tr><tr><td>[8]</td><td>8</td></tr><tr><td>[]</td><td></td></tr></tbody></table><ol><li>åˆå§‹åŒ–ï¼Œå°†æ ¹èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—</li><li>å¾ªç¯å¤„ç†é˜Ÿåˆ—ä¸­æ¯ä¸ªèŠ‚ç‚¹ï¼Œç›´è‡³é˜Ÿåˆ—ä¸ºç©º</li><li>æ¯æ¬¡å¾ªç¯å†…å¤„ç†èŠ‚ç‚¹åï¼Œå°†å®ƒçš„å­©å­èŠ‚ç‚¹ï¼ˆå³ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ï¼‰åŠ å…¥é˜Ÿåˆ—</li></ol><blockquote><p>æ³¨æ„</p><ul><li><p>ä»¥ä¸Šç”¨é˜Ÿåˆ—æ¥å±‚åºéå†æ˜¯é’ˆå¯¹  TreeNode è¿™ç§æ–¹å¼è¡¨ç¤ºçš„äºŒå‰æ ‘</p></li><li><p>å¯¹äºæ•°ç»„è¡¨ç°çš„äºŒå‰æ ‘ï¼Œåˆ™ç›´æ¥éå†æ•°ç»„å³å¯ï¼Œè‡ªç„¶ä¸ºå±‚åºéå†çš„é¡ºåº</p></li></ul></blockquote><h4 id="shen-du-you-xian" id="æ·±åº¦ä¼˜å…ˆ">æ·±åº¦ä¼˜å…ˆ</h4><p><img src="./imgs/image-20230221110443230.png" alt="image-20230221110443230"></p><table><thead><tr><th>æ ˆæš‚å­˜</th><th>å·²å¤„ç†</th><th>å‰åºéå†</th><th>ä¸­åºéå†</th></tr></thead><tbody><tr><td>[1]</td><td>1 âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤</td><td>1</td><td></td></tr><tr><td>[1, 2]</td><td>2âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤<br />1âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤</td><td>2</td><td></td></tr><tr><td>[1, 2, 4]</td><td>4âœ”ï¸ å·¦âœ”ï¸ å³âœ”ï¸<br />2âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤<br />1âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤</td><td>4</td><td>4</td></tr><tr><td>[1, 2]</td><td>2âœ”ï¸ å·¦âœ”ï¸ å³âœ”ï¸<br />1âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤</td><td></td><td>2</td></tr><tr><td>[1]</td><td>1âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤</td><td></td><td>1</td></tr><tr><td>[1, 3]</td><td>3âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤<br />1âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤</td><td>3</td><td></td></tr><tr><td>[1, 3, 5]</td><td>5âœ”ï¸ å·¦âœ”ï¸ å³âœ”ï¸<br />3âœ”ï¸ å·¦ğŸ’¤ å³ğŸ’¤<br />1âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤</td><td>5</td><td>5</td></tr><tr><td>[1, 3]</td><td>3âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤<br />1âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤</td><td></td><td>3</td></tr><tr><td>[1, 3, 6]</td><td>6âœ”ï¸ å·¦âœ”ï¸ å³âœ”ï¸<br />3âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤<br />1âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤</td><td>6</td><td>6</td></tr><tr><td>[1, 3]</td><td>3âœ”ï¸ å·¦âœ”ï¸ å³âœ”ï¸<br />1âœ”ï¸ å·¦âœ”ï¸ å³ğŸ’¤</td><td></td><td></td></tr><tr><td>[1]</td><td>1âœ”ï¸ å·¦âœ”ï¸ å³âœ”ï¸</td><td></td><td></td></tr><tr><td>[]</td><td></td><td></td><td></td></tr></tbody></table><h4 id="di-gui-shi-xian" id="é€’å½’å®ç°">é€’å½’å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;h3&gt;å‰åºéå†&lt;/h3&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> node èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">preOrder</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.print(node.val + <span class="string">&quot;\t&quot;</span>); <span class="comment">// å€¼</span></span><br><span class="line">    preOrder(node.left); <span class="comment">// å·¦</span></span><br><span class="line">    preOrder(node.right); <span class="comment">// å³</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;h3&gt;ä¸­åºéå†&lt;/h3&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> node èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">inOrder</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    inOrder(node.left); <span class="comment">// å·¦</span></span><br><span class="line">    System.out.print(node.val + <span class="string">&quot;\t&quot;</span>); <span class="comment">// å€¼</span></span><br><span class="line">    inOrder(node.right); <span class="comment">// å³</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;h3&gt;ååºéå†&lt;/h3&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> node èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">postOrder</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    postOrder(node.left); <span class="comment">// å·¦</span></span><br><span class="line">    postOrder(node.right); <span class="comment">// å³</span></span><br><span class="line">    System.out.print(node.val + <span class="string">&quot;\t&quot;</span>); <span class="comment">// å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="fei-di-gui-shi-xian" id="éé€’å½’å®ç°">éé€’å½’å®ç°</h4><p><strong>å‰åºéå†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">LinkedListStack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedListStack</span>&lt;&gt;();</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!stack.isEmpty() || curr != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        stack.push(curr);</span><br><span class="line">        System.out.println(curr);</span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">        curr = pop.right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸­åºéå†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">LinkedListStack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedListStack</span>&lt;&gt;();</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!stack.isEmpty() || curr != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        stack.push(curr);</span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">        System.out.println(pop);</span><br><span class="line">        curr = pop.right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ååºéå†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">LinkedListStack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedListStack</span>&lt;&gt;();</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!stack.isEmpty() || curr != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        stack.push(curr);</span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">peek</span> <span class="operator">=</span> stack.peek();</span><br><span class="line">        <span class="keyword">if</span> (peek.right == <span class="literal">null</span> || peek.right == pop) &#123;</span><br><span class="line">            pop = stack.pop();</span><br><span class="line">            System.out.println(pop);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            curr = peek.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºååºéå†ï¼Œå‘å›èµ°æ—¶ï¼Œéœ€è¦å¤„ç†å®Œå³å­æ ‘æ‰èƒ½ pop å‡ºæ ˆã€‚å¦‚ä½•çŸ¥é“å³å­æ ‘å¤„ç†å®Œæˆå‘¢ï¼Ÿ</p><ul><li><p>å¦‚æœæ ˆé¡¶å…ƒç´ çš„ $right \equiv null$ è¡¨ç¤ºæ²¡å•¥å¯å¤„ç†çš„ï¼Œå¯ä»¥å‡ºæ ˆ</p></li><li><p>å¦‚æœæ ˆé¡¶å…ƒç´ çš„ $right \neq null$ï¼Œ</p><ul><li>é‚£ä¹ˆä½¿ç”¨ lastPop è®°å½•æœ€è¿‘å‡ºæ ˆçš„èŠ‚ç‚¹ï¼Œå³è¡¨ç¤ºä»è¿™ä¸ªèŠ‚ç‚¹å‘å›èµ°</li><li>å¦‚æœæ ˆé¡¶å…ƒç´ çš„ $right==lastPop$ æ­¤æ—¶åº”å½“å‡ºæ ˆ</li></ul></li></ul><p>å¯¹äºå‰ã€ä¸­ä¸¤ç§éå†ï¼Œå®é™…ä»¥ä¸Šä»£ç ä»å³å­æ ‘å‘å›èµ°æ—¶ï¼Œå¹¶æœªèµ°å®Œå…¨ç¨‹ï¼ˆstack æå‰å‡ºæ ˆäº†ï¼‰ååºéå†ä»¥ä¸Šä»£ç æ˜¯èµ°å®Œå…¨ç¨‹äº†</p><p><strong>ç»Ÿä¸€å†™æ³•</strong></p><p>ä¸‹é¢æ˜¯ä¸€ç§ç»Ÿä¸€çš„å†™æ³•ï¼Œä¾æ®ååºéå†ä¿®æ”¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">LinkedList&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root; <span class="comment">// ä»£è¡¨å½“å‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// æœ€è¿‘ä¸€æ¬¡å¼¹æ ˆçš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">while</span> (curr != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        colorPrintln(<span class="string">&quot;å‰: &quot;</span> + curr.val, <span class="number">31</span>);</span><br><span class="line">        stack.push(curr); <span class="comment">// å‹å…¥æ ˆï¼Œä¸ºäº†è®°ä½å›æ¥çš„è·¯</span></span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">peek</span> <span class="operator">=</span> stack.peek();</span><br><span class="line">        <span class="comment">// å³å­æ ‘å¯ä»¥ä¸å¤„ç†, å¯¹ä¸­åºæ¥è¯´, è¦åœ¨å³å­æ ‘å¤„ç†ä¹‹å‰æ‰“å°</span></span><br><span class="line">        <span class="keyword">if</span> (peek.right == <span class="literal">null</span>) &#123;</span><br><span class="line">            colorPrintln(<span class="string">&quot;ä¸­: &quot;</span> + peek.val, <span class="number">36</span>);</span><br><span class="line">            pop = stack.pop();</span><br><span class="line">            colorPrintln(<span class="string">&quot;å: &quot;</span> + pop.val, <span class="number">34</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å³å­æ ‘å¤„ç†å®Œæˆ, å¯¹ä¸­åºæ¥è¯´, æ— éœ€æ‰“å°</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (peek.right == pop) &#123;</span><br><span class="line">            pop = stack.pop();</span><br><span class="line">            colorPrintln(<span class="string">&quot;å: &quot;</span> + pop.val, <span class="number">34</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å³å­æ ‘å¾…å¤„ç†, å¯¹ä¸­åºæ¥è¯´, è¦åœ¨å³å­æ ‘å¤„ç†ä¹‹å‰æ‰“å°</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            colorPrintln(<span class="string">&quot;ä¸­: &quot;</span> + peek.val, <span class="number">36</span>);</span><br><span class="line">            curr = peek.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">colorPrintln</span><span class="params">(String origin, <span class="type">int</span> color)</span> &#123;</span><br><span class="line">    System.out.printf(<span class="string">&quot;\033[%dm%s\033[0m%n&quot;</span>, color, origin);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€å¼ å›¾æ¼”ç¤ºä¸‰ç§éå†</p><p><img src="./imgs/Sorted_binary_tree_ALL_RGB.svg.png" alt="Sorted_binary_tree_ALL_RGB.svg"></p><ul><li>çº¢è‰²ï¼šå‰åºéå†é¡ºåº</li><li>ç»¿è‰²ï¼šä¸­åºéå†é¡ºåº</li><li>è“è‰²ï¼šåç»­éå†é¡ºåº</li></ul><h2 id="xi-ti-1" id="ä¹ é¢˜-2">ä¹ é¢˜</h2><h3 id="3-2" id="3-2">3-2</h3><blockquote><p>é¢˜ç›®æè¿°ï¼šåˆ¤æ–­ä¸¤æ£µæ ‘æ˜¯å¦ç›¸ç­‰</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">BiTNode</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> data;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">BiTNode</span> *lchild;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">BiTNode</span> *rchild;</span><br><span class="line">&#125; BiTNode, *BiTree;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆåºåˆ›å»ºäºŒå‰æ ‘</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateBiTree</span><span class="params">(BiTree &amp;T)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> ch;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>, &amp;ch);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;#&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        T = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        T = <span class="keyword">new</span> BiTNode;</span><br><span class="line">        T-&gt;data = ch;</span><br><span class="line">        <span class="built_in">CreateBiTree</span>(T-&gt;lchild);</span><br><span class="line">        <span class="built_in">CreateBiTree</span>(T-&gt;rchild);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥å‰åºéå†æ–¹å¼æ‰“å°äºŒå‰æ ‘</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">frontPrintTree</span><span class="params">(BiTNode *T)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (T == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c &quot;</span>, T-&gt;data);</span><br><span class="line">    <span class="built_in">frontPrintTree</span>(T-&gt;lchild);</span><br><span class="line">    <span class="built_in">frontPrintTree</span>(T-&gt;rchild);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡‡ç”¨é€’å½’</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(BiTNode *T1, BiTNode *T2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!T1 &amp;&amp; !T2) <span class="comment">// T1å’ŒT2éƒ½ä¸ºç©º?</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (!T1 || !T2) <span class="comment">// T1ï¼ŒT2æœ‰ä¸€é¢—ä¸ºç©ºï¼Œä¸€é¢—ä¸ä¸ºç©º?</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (T1 &amp;&amp; T2)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (T1-&gt;data != T2-&gt;data)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;                       <span class="comment">// èŠ‚ç‚¹ä¸ç›¸ç­‰ï¼Œè¿”å›false</span></span><br><span class="line">        <span class="type">bool</span> l = <span class="built_in">check</span>(T1-&gt;lchild, T2-&gt;lchild); <span class="comment">// é€’å½’åˆ¤æ–­å·¦å­æ ‘</span></span><br><span class="line">        <span class="type">bool</span> r = <span class="built_in">check</span>(T1-&gt;rchild, T2-&gt;rchild); <span class="comment">// é€’å½’åˆ¤æ–­å³å­æ ‘</span></span><br><span class="line">        <span class="keyword">return</span> l &amp;&amp; r;                          <span class="comment">// æ•´åˆç»“æœ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BiTree T1 = <span class="literal">NULL</span>, T2 = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å…ˆåºè¾“å…¥èŠ‚ç‚¹ï¼Œä»¥#è™šè®¾èŠ‚ç‚¹\n&quot;</span>);</span><br><span class="line">    <span class="built_in">CreateBiTree</span>(T1);</span><br><span class="line">    <span class="built_in">getchar</span>(); <span class="comment">// åƒæ‰å›è½¦</span></span><br><span class="line">    <span class="built_in">frontPrintTree</span>(T1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å†åˆ›å»ºä¸€æ£µ\n&quot;</span>);</span><br><span class="line">    <span class="built_in">CreateBiTree</span>(T2);</span><br><span class="line">    <span class="built_in">getchar</span>(); <span class="comment">// åƒæ‰å›è½¦</span></span><br><span class="line">    <span class="built_in">frontPrintTree</span>(T2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;åˆ›å»ºæˆåŠŸ\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">check</span>(T1, T2))</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;T1å’ŒT2ç›¸ç­‰\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;T1å’ŒT2ä¸ç›¸ç­‰\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5" id="3-5">3-5</h3><blockquote><p>é¢˜ç›®æè¿°ï¼šè®¡ç®—äºŒå‰æ ‘æœ€å¤§çš„å®½åº¦ï¼ˆäºŒå‰æ ‘çš„æœ€å¤§å®½åº¦æ˜¯æŒ‡äºŒå‰æ ‘æ‰€æœ‰å±‚ä¸­èŠ‚ç‚¹ä¸ªæ•°çš„æœ€å¤§å€¼ï¼‰ã€‚</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">BiTNode</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> data;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">BiTNode</span> *lchild;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">BiTNode</span> *rchild;</span><br><span class="line">&#125; BiTNode, *BiTree;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆåºåˆ›å»ºäºŒå‰æ ‘</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateBiTree</span><span class="params">(BiTree &amp;T)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> ch;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>, &amp;ch);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;#&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        T = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        T = <span class="keyword">new</span> BiTNode;</span><br><span class="line">        T-&gt;data = ch;</span><br><span class="line">        <span class="built_in">CreateBiTree</span>(T-&gt;lchild);</span><br><span class="line">        <span class="built_in">CreateBiTree</span>(T-&gt;rchild);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥å‰åºéå†æ–¹å¼æ‰“å°äºŒå‰æ ‘</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">frontPrintTree</span><span class="params">(BiTNode *T)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (T == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c &quot;</span>, T-&gt;data);</span><br><span class="line">    <span class="built_in">frontPrintTree</span>(T-&gt;lchild);</span><br><span class="line">    <span class="built_in">frontPrintTree</span>(T-&gt;rchild);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡‡ç”¨å±‚åºéå†ï¼Œæ±‚è§£æ¯ä¸€å±‚çš„å…ƒç´ ä¸ªæ•°ï¼Œè¿”å›æœ€å¤§å€¼</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getMaxWide</span><span class="params">(BiTNode *T)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> max = <span class="number">0</span>;</span><br><span class="line">    std::queue&lt;BiTree&gt; queue;</span><br><span class="line">    queue.<span class="built_in">push</span>(T);</span><br><span class="line">    <span class="keyword">while</span> (!queue.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> count = queue.<span class="built_in">size</span>(); <span class="comment">// æœ¬å±‚å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">        max = max &gt; count ? max : count;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; count; i++) <span class="comment">// ä¸‹ä¸€å±‚å…ƒç´ å…¥é˜Ÿï¼Œå·¦å­æ ‘å…ˆ</span></span><br><span class="line">        &#123;</span><br><span class="line">            BiTNode* node = queue.<span class="built_in">front</span>(); <span class="comment">// é¦–å…ƒç´ å‡ºé˜Ÿ</span></span><br><span class="line">            queue.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%c &quot;</span>, node-&gt;data);</span><br><span class="line">            <span class="keyword">if</span> (node-&gt;lchild != <span class="literal">NULL</span>)</span><br><span class="line">                queue.<span class="built_in">push</span>(node-&gt;lchild);</span><br><span class="line">            <span class="keyword">if</span> (node-&gt;rchild != <span class="literal">NULL</span>)</span><br><span class="line">                queue.<span class="built_in">push</span>(node-&gt;rchild);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BiTree T = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å…ˆåºè¾“å…¥èŠ‚ç‚¹ï¼Œä»¥#è™šè®¾èŠ‚ç‚¹\n&quot;</span>);</span><br><span class="line">    <span class="built_in">CreateBiTree</span>(T);</span><br><span class="line">    <span class="built_in">getchar</span>(); <span class="comment">// åƒæ‰å›è½¦</span></span><br><span class="line">    <span class="built_in">frontPrintTree</span>(T);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;åˆ›å»ºæˆåŠŸ\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;äºŒå‰æ ‘çš„æœ€å¤§å®½åº¦ä¸ºï¼š%d\n&quot;</span>, <span class="built_in">getMaxWide</span>(T));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="cha-zhao">æŸ¥æ‰¾</h1><h2 id="3-1" id="3-1">3-1</h2><blockquote><p>é¢˜ç›®æè¿°ï¼šè¯•è®¾è®¡æŠ˜åŠæŸ¥æ‰¾çš„é€’å½’ç®—æ³•</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">binarySearch</span><span class="params">(<span class="type">int</span> arr[], <span class="type">int</span> left, <span class="type">int</span> right, <span class="type">int</span> data)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(left &gt; right) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">int</span> mid = (right+left) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>(arr[mid] &lt; data) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">binarySearch</span>(arr, mid+<span class="number">1</span>, right, data);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(arr[mid] &gt; data)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">binarySearch</span>(arr, left, mid<span class="number">-1</span>, data);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mid;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> len;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;è¯·è¾“å…¥æ•°ç»„é•¿åº¦ï¼š&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;len);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;è¯·ä¾æ¬¡è¾“å…¥æ•°ç»„å…ƒç´ ï¼š&quot;</span>);</span><br><span class="line">  <span class="type">int</span> arr[len];</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">int</span> data;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;è¯·è¾“å…¥å¾…æŸ¥æ‰¾å…ƒç´ ï¼š&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;data);</span><br><span class="line">  <span class="type">int</span> k = <span class="built_in">binarySearch</span>(arr, <span class="number">0</span>, len<span class="number">-1</span>, data);</span><br><span class="line">  <span class="keyword">if</span>(k!=<span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;arr[%d] = %d&quot;</span>, k, arr[k]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-2-1" id="3-2-2">3-2</h2><blockquote><p>è¯•è®¾è®¡ä¸€ä¸ªåˆ¤åˆ«ç»™å®šäºŒå‰æ ‘æ˜¯å¦ä¸ºäºŒå‰æ’åºæ ‘çš„ç®—æ³•</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>* <span class="title">left</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>* <span class="title">right</span>;</span></span><br><span class="line">&#125; TreeNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* åˆ©ç”¨äºŒå‰æ ‘ä¸­åºéå†ï¼Œå°†äºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹å…ƒç´ å€¼å­˜å…¥æ•°ç»„ */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inorderTraversal</span><span class="params">(TreeNode* root, <span class="type">int</span>* arr, <span class="type">int</span>* index)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">    inorderTraversal(root-&gt;left, arr, index);</span><br><span class="line">    arr[*index] = root-&gt;val;</span><br><span class="line">    (*index)++;</span><br><span class="line">    inorderTraversal(root-&gt;right, arr, index);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* åˆ¤æ–­æ•°ç»„æ˜¯å¦æ˜¯é€’å¢ */</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isNonDecreasing</span><span class="params">(<span class="type">int</span>* arr, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; size - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] &gt; arr[i+<span class="number">1</span>]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ ¹æ®äºŒå‰æ ‘ä¸­åºéå†å‰åèŠ‚ç‚¹å¤§å°å…³ç³»åˆ¤å®š</span></span><br><span class="line"><span class="comment">        è‹¥å­˜åœ¨ pre &gt; rear åˆ™è¿”å›false ----&gt; éBST</span></span><br><span class="line"><span class="comment">        åä¹‹åˆ™è¿”å› true -----&gt; æ˜¯BST*/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode* root)</span> &#123;</span><br><span class="line">    <span class="type">int</span>* arr = (<span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>) * <span class="number">1000</span>);</span><br><span class="line">    <span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line">    inorderTraversal(root, arr, &amp;index);</span><br><span class="line">    <span class="type">bool</span> result = isNonDecreasing(arr, index);</span><br><span class="line">    <span class="built_in">free</span>(arr);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    TreeNode root = &#123; <span class="number">1</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span> &#125;;</span><br><span class="line">    TreeNode node2 = &#123; <span class="number">2</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span> &#125;;</span><br><span class="line">    TreeNode node3 = &#123; <span class="number">3</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span> &#125;;</span><br><span class="line">    TreeNode node4 = &#123; <span class="number">4</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span> &#125;;</span><br><span class="line">    TreeNode node5 = &#123; <span class="number">5</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span> &#125;;</span><br><span class="line">    root.left = &amp;node2;</span><br><span class="line">    root.right = &amp;node3;</span><br><span class="line">    node2.left = &amp;node4;</span><br><span class="line">    node2.right = &amp;node5;</span><br><span class="line">    <span class="keyword">if</span>(isValidBST(&amp;root)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;æ˜¯BST&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ä¸æ˜¯BST&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="15-1" id="15-1">15-1</h2><blockquote><p>é¢˜ç›®æè¿°ï¼šè®¡ç®—äºŒå‰æ’åºæ ‘ä¸­ï¼Œå…³é”®å­—keyçš„æŸ¥æ‰¾é•¿åº¦</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">TreeNode</span> *left;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">TreeNode</span> *right;</span><br><span class="line">&#125; TreeNode ,*Tree;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘äºŒå‰æ ‘ä¸­æ’å…¥ç»“ç‚¹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(Tree &amp;root, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">    TreeNode *new_node = (TreeNode *)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(TreeNode));</span><br><span class="line">    new_node-&gt;val = val;</span><br><span class="line">    new_node-&gt;left = <span class="literal">NULL</span>;</span><br><span class="line">    new_node-&gt;right = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        root = new_node;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    TreeNode *cur = root;</span><br><span class="line">    <span class="keyword">while</span> (cur) &#123;</span><br><span class="line">        <span class="keyword">if</span> (val &lt; cur-&gt;val) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cur-&gt;left == <span class="literal">NULL</span>) &#123;</span><br><span class="line">                cur-&gt;left = new_node;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cur = cur-&gt;left;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (val &gt; cur-&gt;val) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cur-&gt;right == <span class="literal">NULL</span>) &#123;</span><br><span class="line">                cur-&gt;right = new_node;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cur = cur-&gt;right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// å¦‚æœè¯¥å€¼å·²ç»åœ¨æ ‘ä¸­å­˜åœ¨ï¼Œåˆ™ä¸éœ€è¦å†æ¬¡æ’å…¥</span></span><br><span class="line">            <span class="built_in">free</span>(new_node);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—æŸ¥æ‰¾é•¿åº¦</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">keyLength</span><span class="params">(TreeNode *root, <span class="type">int</span> key)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    TreeNode *cur = root;</span><br><span class="line">    <span class="keyword">while</span> (cur) &#123;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">if</span> (key &lt; cur-&gt;val) &#123; <span class="comment">// æ¯è¿›è¡Œä¸€æ¬¡æ¯”è¾ƒcount+1</span></span><br><span class="line">            cur = cur-&gt;left;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key &gt; cur-&gt;val) &#123;</span><br><span class="line">            cur = cur-&gt;right;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">// å¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ™è¿”å›-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Tree root = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> val = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;è¯·è¾“å…¥å…ƒç´ ï¼Œè¾“å…¥-1ä»£è¡¨ç»“æŸè¾“å…¥\n&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span>(val != <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;val);</span><br><span class="line">      <span class="built_in">insert</span>(root, val);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, root-&gt;val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;è¯·è¾“å…¥æŸ¥æ‰¾çš„å…³é”®å­—key\n&quot;</span>);</span><br><span class="line">    <span class="type">int</span> key = <span class="number">0</span>; <span class="comment">// è¦æŸ¥æ‰¾çš„å…³é”®å­—key</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;key);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> length = <span class="built_in">keyLength</span>(root, key); <span class="comment">// è®¡ç®—æŸ¥æ‰¾é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (length == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;æœªåœ¨äºŒå‰æ’åºæ ‘ä¸­æ‰¾åˆ°è¯¥å…³é”®å­—\n&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;å…³é”®å­—ä¸º%dçš„ç»“ç‚¹çš„æŸ¥æ‰¾é•¿åº¦ä¸º%d\n&quot;</span>, key, length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="15-2" id="15-2">15-2</h2><blockquote><p>åœ¨äºŒå‰æ’åºæ ‘ä¸­æ‰“å°aï¼Œbä¸¤ä¸ªèŠ‚ç‚¹çš„å…¬å…±ç¥–å…ˆ</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span> *<span class="title">left</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span> *<span class="title">right</span>;</span></span><br><span class="line">&#125; TreeNode , *Tree;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘äºŒå‰æ ‘ä¸­æ’å…¥ç»“ç‚¹</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">insert</span><span class="params">(Tree &amp;root, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">    TreeNode *new_node = (TreeNode *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TreeNode));</span><br><span class="line">    new_node-&gt;val = val;</span><br><span class="line">    new_node-&gt;left = <span class="literal">NULL</span>;</span><br><span class="line">    new_node-&gt;right = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        root = new_node;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    TreeNode *cur = root;</span><br><span class="line">    <span class="keyword">while</span> (cur) &#123;</span><br><span class="line">        <span class="keyword">if</span> (val &lt; cur-&gt;val) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cur-&gt;left == <span class="literal">NULL</span>) &#123;</span><br><span class="line">                cur-&gt;left = new_node;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cur = cur-&gt;left;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (val &gt; cur-&gt;val) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cur-&gt;right == <span class="literal">NULL</span>) &#123;</span><br><span class="line">                cur-&gt;right = new_node;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cur = cur-&gt;right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// å¦‚æœè¯¥å€¼å·²ç»åœ¨æ ‘ä¸­å­˜åœ¨ï¼Œåˆ™ä¸éœ€è¦å†æ¬¡æ’å…¥</span></span><br><span class="line">            <span class="built_in">free</span>(new_node);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥æ‰¾èŠ‚ç‚¹å‡½æ•°</span></span><br><span class="line">TreeNode *<span class="title function_">search</span><span class="params">(Tree root, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">NULL</span> || root-&gt;val == val) &#123;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (val &lt; root-&gt;val) &#123;</span><br><span class="line">        <span class="keyword">return</span> search(root-&gt;left, val);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> search(root-&gt;right, val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°å…¬å…±ç¥–å…ˆå‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">printCommonAncestor</span><span class="params">(Tree root, <span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;val &gt; a &amp;&amp; root-&gt;val &gt; b) &#123;</span><br><span class="line">        printCommonAncestor(root-&gt;left, a, b);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (root-&gt;val &lt; a &amp;&amp; root-&gt;val &lt; b) &#123; </span><br><span class="line">        printCommonAncestor(root-&gt;right, a, b);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// èŠ‚ç‚¹å€¼å¤„äº(a, b)ä¹‹é—´ï¼Œåˆ™æ˜¯aï¼Œbå…¬å…±ç¥–å…ˆ</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d å’Œ %d çš„å…¬å…±ç¥–å…ˆæ˜¯ %d\n&quot;</span>, a, b, root-&gt;val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    Tree root = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> val = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;è¯·è¾“å…¥å…ƒç´ ï¼Œè¾“å…¥-1ä»£è¡¨ç»“æŸè¾“å…¥\n&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span>(val != <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;val);</span><br><span class="line">      insert(root, val);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, root-&gt;val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;è¯·è¾“å…¥aï¼Œbå…ƒç´ å€¼ï¼š\n&quot;</span>);</span><br><span class="line">    <span class="type">int</span> a, b;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;a, &amp;b);</span><br><span class="line">    TreeNode *Ta = search(root, a);</span><br><span class="line">    TreeNode *Tb = search(root, b);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (Ta == <span class="literal">NULL</span> || Tb == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Not found\n&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        printCommonAncestor(root, Ta-&gt;val, Tb-&gt;val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•°æ®ç»“æ„ä¸ç®—æ³•è¯¾ç¨‹ç¬”è®°ä¸ä¹ é¢˜</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://www.taoyaopc.live/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="C++" scheme="https://www.taoyaopc.live/tags/C/"/>
    
    <category term="ç®—æ³•" scheme="https://www.taoyaopc.live/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ElasticSearch2</title>
    <link href="https://www.taoyaopc.live/posts/5dbbc51.html"/>
    <id>https://www.taoyaopc.live/posts/5dbbc51.html</id>
    <published>2023-03-12T01:00:00.000Z</published>
    <updated>2023-03-21T06:15:23.640Z</updated>
    
    <content type="html"><![CDATA[<h1 id="fen-bu-shi-sou-suo-yin-qing-02">åˆ†å¸ƒå¼æœç´¢å¼•æ“02</h1><p>åœ¨æ˜¨å¤©çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¯¼å…¥äº†å¤§é‡æ•°æ®åˆ°elasticsearchä¸­ï¼Œå®ç°äº†elasticsearchçš„æ•°æ®å­˜å‚¨åŠŸèƒ½ã€‚ä½†elasticsearchæœ€æ“…é•¿çš„è¿˜æ˜¯æœç´¢å’Œæ•°æ®åˆ†æã€‚</p><p>æ‰€ä»¥ä»Šå¤©ï¼Œæˆ‘ä»¬ç ”ç©¶ä¸‹elasticsearchçš„æ•°æ®æœç´¢åŠŸèƒ½ã€‚æˆ‘ä»¬ä¼šåˆ†åˆ«ä½¿ç”¨<strong>DSL</strong>å’Œ<strong>RestClient</strong>å®ç°æœç´¢ã€‚</p><h1 id="dsl-cha-xun-wen-dang">DSLæŸ¥è¯¢æ–‡æ¡£</h1><p>elasticsearchçš„æŸ¥è¯¢ä¾ç„¶æ˜¯åŸºäºJSONé£æ ¼çš„DSLæ¥å®ç°çš„ã€‚</p><h2 id="dsl-cha-xun-fen-lei" id="DSLæŸ¥è¯¢åˆ†ç±»">DSLæŸ¥è¯¢åˆ†ç±»</h2><blockquote><p>Elasticsearchæä¾›äº†åŸºäºJSONçš„DSLï¼ˆ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html">Domain Specific Language</a>ï¼‰æ¥å®šä¹‰æŸ¥è¯¢ã€‚å¸¸è§çš„æŸ¥è¯¢ç±»å‹åŒ…æ‹¬ï¼š</p></blockquote><ul><li><p><strong>æŸ¥è¯¢æ‰€æœ‰</strong>ï¼šæŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®ï¼Œä¸€èˆ¬æµ‹è¯•ç”¨ã€‚ä¾‹å¦‚ï¼šmatch_all</p></li><li><p><strong>å…¨æ–‡æ£€ç´¢ï¼ˆfull textï¼‰æŸ¥è¯¢</strong>ï¼šåˆ©ç”¨åˆ†è¯å™¨å¯¹ç”¨æˆ·è¾“å…¥å†…å®¹åˆ†è¯ï¼Œç„¶åå»å€’æ’ç´¢å¼•åº“ä¸­åŒ¹é…ã€‚ä¾‹å¦‚ï¼š</p><ul><li>match_query</li><li>multi_match_query</li></ul></li><li><p><strong>ç²¾ç¡®æŸ¥è¯¢</strong>ï¼šæ ¹æ®ç²¾ç¡®è¯æ¡å€¼æŸ¥æ‰¾æ•°æ®ï¼Œä¸€èˆ¬æ˜¯æŸ¥æ‰¾keywordã€æ•°å€¼ã€æ—¥æœŸã€booleanç­‰ç±»å‹å­—æ®µã€‚ä¾‹å¦‚ï¼š</p><ul><li>ids</li><li>range</li><li>term</li></ul></li><li><p><strong>åœ°ç†ï¼ˆgeoï¼‰æŸ¥è¯¢</strong>ï¼šæ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼š</p><ul><li>geo_distance</li><li>geo_bounding_box</li></ul></li><li><p><strong>å¤åˆï¼ˆcompoundï¼‰æŸ¥è¯¢</strong>ï¼šå¤åˆæŸ¥è¯¢å¯ä»¥å°†ä¸Šè¿°å„ç§æŸ¥è¯¢æ¡ä»¶ç»„åˆèµ·æ¥ï¼Œåˆå¹¶æŸ¥è¯¢æ¡ä»¶ã€‚ä¾‹å¦‚ï¼š</p><ul><li>bool</li><li>function_score</li></ul></li></ul><p>æŸ¥è¯¢çš„è¯­æ³•åŸºæœ¬ä¸€è‡´ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;æŸ¥è¯¢ç±»å‹&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;æŸ¥è¯¢æ¡ä»¶&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;æ¡ä»¶å€¼&quot;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»¥æŸ¥è¯¢æ‰€æœ‰ä¸ºä¾‹ï¼Œå…¶ä¸­ï¼š</p><ul><li>æŸ¥è¯¢ç±»å‹ä¸ºmatch_all</li><li>æ²¡æœ‰æŸ¥è¯¢æ¡ä»¶</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥è¯¢æ‰€æœ‰</span></span><br><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å…¶å®ƒæŸ¥è¯¢æ— éå°±æ˜¯<strong>æŸ¥è¯¢ç±»å‹</strong>ã€<strong>æŸ¥è¯¢æ¡ä»¶</strong>çš„å˜åŒ–ã€‚</p><h2 id="quan-wen-jian-suo-cha-xun" id="å…¨æ–‡æ£€ç´¢æŸ¥è¯¢">å…¨æ–‡æ£€ç´¢æŸ¥è¯¢</h2><h3 id="shi-yong-chang-jing" id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h3><p>å…¨æ–‡æ£€ç´¢æŸ¥è¯¢çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å¯¹ç”¨æˆ·æœç´¢çš„å†…å®¹åšåˆ†è¯ï¼Œå¾—åˆ°è¯æ¡</li><li>æ ¹æ®è¯æ¡å»å€’æ’ç´¢å¼•åº“ä¸­åŒ¹é…ï¼Œå¾—åˆ°æ–‡æ¡£id</li><li>æ ¹æ®æ–‡æ¡£idæ‰¾åˆ°æ–‡æ¡£ï¼Œè¿”å›ç»™ç”¨æˆ·</li></ul><p>æ¯”è¾ƒå¸¸ç”¨çš„åœºæ™¯åŒ…æ‹¬ï¼š</p><ul><li>å•†åŸçš„è¾“å…¥æ¡†æœç´¢</li><li>ç™¾åº¦è¾“å…¥æ¡†æœç´¢</li></ul><p>ä¾‹å¦‚äº¬ä¸œï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/d1c639afcf6e479c8cee8b07f4a78c21" alt="image-20210721165326938"></p><p>å› ä¸ºæ˜¯æ‹¿ç€è¯æ¡å»åŒ¹é…ï¼Œå› æ­¤å‚ä¸æœç´¢çš„å­—æ®µä¹Ÿå¿…é¡»æ˜¯å¯åˆ†è¯çš„textç±»å‹çš„å­—æ®µã€‚</p><h3 id="ji-ben-yu-fa" id="åŸºæœ¬è¯­æ³•">åŸºæœ¬è¯­æ³•</h3><p>å¸¸è§çš„å…¨æ–‡æ£€ç´¢æŸ¥è¯¢åŒ…æ‹¬ï¼š</p><ul><li>matchæŸ¥è¯¢ï¼šå•å­—æ®µæŸ¥è¯¢</li><li>multi_matchæŸ¥è¯¢ï¼šå¤šå­—æ®µæŸ¥è¯¢ï¼Œä»»æ„ä¸€ä¸ªå­—æ®µç¬¦åˆæ¡ä»¶å°±ç®—ç¬¦åˆæŸ¥è¯¢æ¡ä»¶</li></ul><p>matchæŸ¥è¯¢è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;TEXT&quot;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>mulit_matchè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;multi_match&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;TEXT&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span><span class="string">&quot;FIELD1&quot;</span><span class="punctuation">,</span>Â <span class="string">&quot; FIELD12&quot;</span><span class="punctuation">]</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="shi-li" id="ç¤ºä¾‹">ç¤ºä¾‹</h3><p>matchæŸ¥è¯¢ç¤ºä¾‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/9f21bd6a300847c2a1755b1ff75e3e56" alt="image-20210721170455419"></p><p>multi_matchæŸ¥è¯¢ç¤ºä¾‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/c1b4bc065e5c413d9f00f03a52b1d159" alt="image-20210721170720691"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ç§æŸ¥è¯¢ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><p>å› ä¸ºæˆ‘ä»¬å°†brandã€nameã€businesså€¼éƒ½åˆ©ç”¨copy_toå¤åˆ¶åˆ°äº†allå­—æ®µä¸­ã€‚å› æ­¤ä½ æ ¹æ®ä¸‰ä¸ªå­—æ®µæœç´¢ï¼Œå’Œæ ¹æ®allå­—æ®µæœç´¢æ•ˆæœå½“ç„¶ä¸€æ ·äº†ã€‚</p><blockquote><p>ä½†æ˜¯ï¼Œæœç´¢å­—æ®µè¶Šå¤šï¼Œå¯¹æŸ¥è¯¢æ€§èƒ½å½±å“è¶Šå¤§ï¼Œå› æ­¤å»ºè®®é‡‡ç”¨copy_toï¼Œç„¶åå•å­—æ®µæŸ¥è¯¢çš„æ–¹å¼ã€‚</p></blockquote><h3 id="zong-jie" id="æ€»ç»“">æ€»ç»“</h3><p>matchå’Œmulti_matchçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>matchï¼šæ ¹æ®ä¸€ä¸ªå­—æ®µæŸ¥è¯¢</li><li>multi_matchï¼šæ ¹æ®å¤šä¸ªå­—æ®µæŸ¥è¯¢ï¼Œå‚ä¸æŸ¥è¯¢å­—æ®µè¶Šå¤šï¼ŒæŸ¥è¯¢æ€§èƒ½è¶Šå·®</li></ul><h2 id="jing-zhun-cha-xun" id="ç²¾å‡†æŸ¥è¯¢">ç²¾å‡†æŸ¥è¯¢</h2><blockquote><p>ç²¾ç¡®æŸ¥è¯¢ä¸€èˆ¬æ˜¯æŸ¥æ‰¾keywordã€æ•°å€¼ã€æ—¥æœŸã€booleanç­‰ç±»å‹å­—æ®µã€‚æ‰€ä»¥<strong>ä¸ä¼š</strong>å¯¹æœç´¢æ¡ä»¶åˆ†è¯ã€‚å¸¸è§çš„æœ‰ï¼š</p></blockquote><ul><li>termï¼šæ ¹æ®è¯æ¡ç²¾ç¡®å€¼æŸ¥è¯¢</li><li>rangeï¼šæ ¹æ®å€¼çš„èŒƒå›´æŸ¥è¯¢</li></ul><h3 id="term-cha-xun" id="termæŸ¥è¯¢">termæŸ¥è¯¢</h3><blockquote><p>å› ä¸ºç²¾ç¡®æŸ¥è¯¢çš„å­—æ®µæœæ˜¯ä¸åˆ†è¯çš„å­—æ®µï¼Œå› æ­¤æŸ¥è¯¢çš„æ¡ä»¶ä¹Ÿå¿…é¡»æ˜¯<strong>ä¸åˆ†è¯</strong>çš„è¯æ¡ã€‚æŸ¥è¯¢æ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„å†…å®¹è·Ÿè‡ªåŠ¨å€¼å®Œå…¨åŒ¹é…æ—¶æ‰è®¤ä¸ºç¬¦åˆæ¡ä»¶ã€‚å¦‚æœç”¨æˆ·è¾“å…¥çš„å†…å®¹è¿‡å¤šï¼Œåè€Œæœç´¢ä¸åˆ°æ•°æ®ã€‚</p></blockquote><p>è¯­æ³•è¯´æ˜ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â termæŸ¥è¯¢</span></span><br><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;VALUE&quot;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><p>å½“æˆ‘æœç´¢çš„æ˜¯ç²¾ç¡®è¯æ¡æ—¶ï¼Œèƒ½æ­£ç¡®æŸ¥è¯¢å‡ºç»“æœï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/9d6b730058e248509137f712fe33a9b8" alt="image-20210721171655308"></p><p>ä½†æ˜¯ï¼Œå½“æˆ‘æœç´¢çš„å†…å®¹ä¸æ˜¯è¯æ¡ï¼Œè€Œæ˜¯å¤šä¸ªè¯è¯­å½¢æˆçš„çŸ­è¯­æ—¶ï¼Œåè€Œæœç´¢ä¸åˆ°ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/1d46e8b14a4a4882aed1c7a71ec4f577" alt="image-20210721171838378"></p><h3 id="range-cha-xun" id="rangeæŸ¥è¯¢">rangeæŸ¥è¯¢</h3><blockquote><p>èŒƒå›´æŸ¥è¯¢ï¼Œä¸€èˆ¬åº”ç”¨åœ¨å¯¹æ•°å€¼ç±»å‹åšèŒƒå›´è¿‡æ»¤çš„æ—¶å€™ã€‚æ¯”å¦‚åšä»·æ ¼èŒƒå›´è¿‡æ»¤ã€‚</p></blockquote><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â rangeæŸ¥è¯¢</span></span><br><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span>Â <span class="number">10</span><span class="punctuation">,</span> <span class="comment">// è¿™é‡Œçš„gteä»£è¡¨å¤§äºç­‰äºï¼Œgtåˆ™ä»£è¡¨å¤§äº</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span>Â <span class="number">20</span> <span class="comment">// lteä»£è¡¨å°äºç­‰äºï¼Œltåˆ™ä»£è¡¨å°äº</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/c194e311d0bc430b8294f0ddb5837c4e" alt="image-20210721172307172"></p><h3 id="zong-jie-1" id="æ€»ç»“-2">æ€»ç»“</h3><p>ç²¾ç¡®æŸ¥è¯¢å¸¸è§çš„æœ‰å“ªäº›ï¼Ÿ</p><ul><li>termæŸ¥è¯¢ï¼šæ ¹æ®è¯æ¡ç²¾ç¡®åŒ¹é…ï¼Œä¸€èˆ¬æœç´¢keywordç±»å‹ã€æ•°å€¼ç±»å‹ã€å¸ƒå°”ç±»å‹ã€æ—¥æœŸç±»å‹å­—æ®µ</li><li>rangeæŸ¥è¯¢ï¼šæ ¹æ®æ•°å€¼èŒƒå›´æŸ¥è¯¢ï¼Œå¯ä»¥æ˜¯æ•°å€¼ã€æ—¥æœŸçš„èŒƒå›´</li></ul><h2 id="di-li-zuo-biao-cha-xun" id="åœ°ç†åæ ‡æŸ¥è¯¢">åœ°ç†åæ ‡æŸ¥è¯¢</h2><blockquote><p>æ‰€è°“çš„åœ°ç†åæ ‡æŸ¥è¯¢ï¼Œå…¶å®å°±æ˜¯æ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ï¼Œå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-queries.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-queries.html</a></p></blockquote><p>å¸¸è§çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p><ul><li>æºç¨‹ï¼šæœç´¢æˆ‘é™„è¿‘çš„é…’åº—</li><li>æ»´æ»´ï¼šæœç´¢æˆ‘é™„è¿‘çš„å‡ºç§Ÿè½¦</li><li>å¾®ä¿¡ï¼šæœç´¢æˆ‘é™„è¿‘çš„äºº</li></ul><p>é™„è¿‘çš„é…’åº—ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/84aacc27fe704998a429ecbeafc59af5" alt="image-20210721172645103"></p><h3 id="ju-xing-fan-wei-cha-xun" id="çŸ©å½¢èŒƒå›´æŸ¥è¯¢">çŸ©å½¢èŒƒå›´æŸ¥è¯¢</h3><blockquote><p>çŸ©å½¢èŒƒå›´æŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯geo_bounding_boxæŸ¥è¯¢ï¼ŒæŸ¥è¯¢åæ ‡è½åœ¨æŸä¸ªçŸ©å½¢èŒƒå›´çš„æ‰€æœ‰æ–‡æ¡£ï¼š</p></blockquote><p><img src="assets/DKV9HZbVS6.gif" alt="DKV9HZbVS6"></p><p>æŸ¥è¯¢æ—¶ï¼Œéœ€è¦æŒ‡å®šçŸ©å½¢çš„<strong>å·¦ä¸Š</strong>ã€<strong>å³ä¸‹</strong>ä¸¤ä¸ªç‚¹çš„åæ ‡ï¼Œç„¶åç”»å‡ºä¸€ä¸ªçŸ©å½¢ï¼Œè½åœ¨è¯¥çŸ©å½¢å†…çš„éƒ½æ˜¯ç¬¦åˆæ¡ä»¶çš„ç‚¹ã€‚</p><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â geo_bounding_boxæŸ¥è¯¢</span></span><br><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;geo_bounding_box&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;top_left&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span> <span class="comment">// å·¦ä¸Šç‚¹</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;lat&quot;</span><span class="punctuation">:</span>Â <span class="number">31.1</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;lon&quot;</span><span class="punctuation">:</span>Â <span class="number">121.5</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;bottom_right&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span> <span class="comment">// å³ä¸‹ç‚¹</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;lat&quot;</span><span class="punctuation">:</span>Â <span class="number">30.9</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;lon&quot;</span><span class="punctuation">:</span>Â <span class="number">121.7</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™ç§å¹¶ä¸ç¬¦åˆâ€œé™„è¿‘çš„äººâ€è¿™æ ·çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸åšäº†ã€‚</p><h3 id="fu-jin-cha-xun" id="é™„è¿‘æŸ¥è¯¢">é™„è¿‘æŸ¥è¯¢</h3><blockquote><p>é™„è¿‘æŸ¥è¯¢ï¼Œä¹Ÿå«åšè·ç¦»æŸ¥è¯¢ï¼ˆgeo_distanceï¼‰ï¼šæŸ¥è¯¢åˆ°æŒ‡å®šä¸­å¿ƒç‚¹å°äºæŸä¸ªè·ç¦»å€¼çš„æ‰€æœ‰æ–‡æ¡£ã€‚</p></blockquote><p>æ¢å¥è¯æ¥è¯´ï¼Œåœ¨åœ°å›¾ä¸Šæ‰¾ä¸€ä¸ªç‚¹ä½œä¸ºåœ†å¿ƒï¼Œä»¥æŒ‡å®šè·ç¦»ä¸ºåŠå¾„ï¼Œç”»ä¸€ä¸ªåœ†ï¼Œè½åœ¨åœ†å†…çš„åæ ‡éƒ½ç®—ç¬¦åˆæ¡ä»¶ï¼š</p><p><img src="assets/vZrdKAh19C.gif" alt="vZrdKAh19C"></p><p>è¯­æ³•è¯´æ˜ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â geo_distance æŸ¥è¯¢</span></span><br><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;geo_distance&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;distance&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;15km&quot;</span><span class="punctuation">,</span> <span class="comment">// åŠå¾„</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;31.21,121.5&quot;</span> <span class="comment">// åœ†å¿ƒ</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><p>æˆ‘ä»¬å…ˆæœç´¢é™†å®¶å˜´é™„è¿‘15kmçš„é…’åº—ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/8ae29f011f7b401f8bfc103e2d67531c" alt="image-20210721175443234"></p><p>å‘ç°å…±æœ‰47å®¶é…’åº—ã€‚</p><p>ç„¶åæŠŠåŠå¾„ç¼©çŸ­åˆ°3å…¬é‡Œï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/97f243c2e1eb4fc19e8453ac5556c4d4" alt="image-20210721182031475"></p><p>å¯ä»¥å‘ç°ï¼Œæœç´¢åˆ°çš„é…’åº—æ•°é‡å‡å°‘åˆ°äº†5å®¶ã€‚</p><h2 id="fu-he-cha-xun" id="å¤åˆæŸ¥è¯¢">å¤åˆæŸ¥è¯¢</h2><blockquote><p>å¤åˆï¼ˆcompoundï¼‰æŸ¥è¯¢ï¼šå¤åˆæŸ¥è¯¢å¯ä»¥å°†å…¶å®ƒç®€å•æŸ¥è¯¢ç»„åˆèµ·æ¥ï¼Œå®ç°æ›´å¤æ‚çš„æœç´¢é€»è¾‘ã€‚å¸¸è§çš„æœ‰ä¸¤ç§ï¼š</p><ul><li>fuction scoreï¼šç®—åˆ†å‡½æ•°æŸ¥è¯¢ï¼Œå¯ä»¥æ§åˆ¶æ–‡æ¡£ç›¸å…³æ€§ç®—åˆ†ï¼Œæ§åˆ¶æ–‡æ¡£æ’å</li><li>bool queryï¼šå¸ƒå°”æŸ¥è¯¢ï¼Œåˆ©ç”¨é€»è¾‘å…³ç³»ç»„åˆå¤šä¸ªå…¶å®ƒçš„æŸ¥è¯¢ï¼Œå®ç°å¤æ‚æœç´¢</li></ul></blockquote><h3 id="xiang-guan-xing-suan-fen" id="ç›¸å…³æ€§ç®—åˆ†">ç›¸å…³æ€§ç®—åˆ†</h3><p>å½“æˆ‘ä»¬åˆ©ç”¨matchæŸ¥è¯¢æ—¶ï¼Œæ–‡æ¡£ç»“æœä¼šæ ¹æ®ä¸æœç´¢è¯æ¡çš„å…³è”åº¦æ‰“åˆ†ï¼ˆ_scoreï¼‰ï¼Œè¿”å›ç»“æœæ—¶æŒ‰ç…§åˆ†å€¼é™åºæ’åˆ—ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœç´¢ â€œè™¹æ¡¥å¦‚å®¶â€ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;_score&quot;</span>Â <span class="punctuation">:</span>Â <span class="number">17.850193</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;_source&quot;</span>Â <span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;name&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;è™¹æ¡¥å¦‚å®¶é…’åº—çœŸä¸é”™&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;_score&quot;</span>Â <span class="punctuation">:</span>Â <span class="number">12.259849</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;_source&quot;</span>Â <span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;name&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;å¤–æ»©å¦‚å®¶é…’åº—çœŸä¸é”™&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;_score&quot;</span>Â <span class="punctuation">:</span>Â <span class="number">11.91091</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;_source&quot;</span>Â <span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;name&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;è¿ªå£«å°¼å¦‚å®¶é…’åº—çœŸä¸é”™&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>åœ¨elasticsearchä¸­ï¼Œæ—©æœŸä½¿ç”¨çš„æ‰“åˆ†ç®—æ³•æ˜¯TF-IDFç®—æ³•ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/d7ff0f2cdd0f424e873a1e061f39fff3" alt="image-20210721190152134"></p><p>åœ¨åæ¥çš„5.1ç‰ˆæœ¬å‡çº§ä¸­ï¼Œelasticsearchå°†ç®—æ³•æ”¹è¿›ä¸ºBM25ç®—æ³•ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/1433671427f24e24b764d7e1d8e99c2d" alt="image-20210721190416214"></p><p>TF-IDFç®—æ³•æœ‰ä¸€å„ç¼ºé™·ï¼Œå°±æ˜¯è¯æ¡é¢‘ç‡è¶Šé«˜ï¼Œæ–‡æ¡£å¾—åˆ†ä¹Ÿä¼šè¶Šé«˜ï¼Œå•ä¸ªè¯æ¡å¯¹æ–‡æ¡£å½±å“è¾ƒå¤§ã€‚è€ŒBM25åˆ™ä¼šè®©å•ä¸ªè¯æ¡çš„ç®—åˆ†æœ‰ä¸€ä¸ªä¸Šé™ï¼Œæ›²çº¿æ›´åŠ å¹³æ»‘ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/3a177aa9c9204bccafee0163b99247e4" alt="image-20210721190907320"></p><p>å°ç»“ï¼šelasticsearchä¼šæ ¹æ®è¯æ¡å’Œæ–‡æ¡£çš„ç›¸å…³åº¦åšæ‰“åˆ†ï¼Œç®—æ³•ç”±ä¸¤ç§ï¼š</p><ul><li>TF-IDFç®—æ³•</li><li>BM25ç®—æ³•ï¼Œelasticsearch5.1ç‰ˆæœ¬åé‡‡ç”¨çš„ç®—æ³•</li></ul><h3 id="suan-fen-han-shu-cha-xun" id="ç®—åˆ†å‡½æ•°æŸ¥è¯¢">ç®—åˆ†å‡½æ•°æŸ¥è¯¢</h3><p>æ ¹æ®ç›¸å…³åº¦æ‰“åˆ†æ˜¯æ¯”è¾ƒåˆç†çš„éœ€æ±‚ï¼Œä½†<strong>åˆç†çš„ä¸ä¸€å®šæ˜¯äº§å“ç»ç†éœ€è¦</strong>çš„ã€‚</p><p>ä»¥ç™¾åº¦ä¸ºä¾‹ï¼Œä½ æœç´¢çš„ç»“æœä¸­ï¼Œå¹¶ä¸æ˜¯ç›¸å…³åº¦è¶Šé«˜æ’åè¶Šé å‰ï¼Œè€Œæ˜¯è°æçš„é’±å¤šæ’åå°±è¶Šé å‰ã€‚å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/2ef762947be04d98aad92dde4fdae0ea" alt="image-20210721191144560"></p><p>è¦æƒ³è®¤ä¸ºæ§åˆ¶ç›¸å…³æ€§ç®—åˆ†ï¼Œå°±éœ€è¦åˆ©ç”¨elasticsearchä¸­çš„function score æŸ¥è¯¢äº†ã€‚</p><h4 id="yu-fa-shuo-ming" id="è¯­æ³•è¯´æ˜">è¯­æ³•è¯´æ˜</h4><p><img src="https://s1.vika.cn/space/2023/01/07/4570cb2e4fd245e5894b70846f651d58" alt="image-20210721191544750"></p><p>function score æŸ¥è¯¢ä¸­åŒ…å«å››éƒ¨åˆ†å†…å®¹ï¼š</p><ul><li><strong>åŸå§‹æŸ¥è¯¢</strong>æ¡ä»¶ï¼šqueryéƒ¨åˆ†ï¼ŒåŸºäºè¿™ä¸ªæ¡ä»¶æœç´¢æ–‡æ¡£ï¼Œå¹¶ä¸”åŸºäºBM25ç®—æ³•ç»™æ–‡æ¡£æ‰“åˆ†ï¼Œ<strong>åŸå§‹ç®—åˆ†</strong>ï¼ˆquery score)</li><li><strong>è¿‡æ»¤æ¡ä»¶</strong>ï¼šfilteréƒ¨åˆ†ï¼Œç¬¦åˆè¯¥æ¡ä»¶çš„æ–‡æ¡£æ‰ä¼šé‡æ–°ç®—åˆ†</li><li><strong>ç®—åˆ†å‡½æ•°</strong>ï¼šç¬¦åˆfilteræ¡ä»¶çš„æ–‡æ¡£è¦æ ¹æ®è¿™ä¸ªå‡½æ•°åšè¿ç®—ï¼Œå¾—åˆ°çš„<strong>å‡½æ•°ç®—åˆ†</strong>ï¼ˆfunction scoreï¼‰ï¼Œæœ‰å››ç§å‡½æ•°<ul><li>weightï¼šå‡½æ•°ç»“æœæ˜¯å¸¸é‡</li><li>field_value_factorï¼šä»¥æ–‡æ¡£ä¸­çš„æŸä¸ªå­—æ®µå€¼ä½œä¸ºå‡½æ•°ç»“æœ</li><li>random_scoreï¼šä»¥éšæœºæ•°ä½œä¸ºå‡½æ•°ç»“æœ</li><li>script_scoreï¼šè‡ªå®šä¹‰ç®—åˆ†å‡½æ•°ç®—æ³•</li></ul></li><li><strong>è¿ç®—æ¨¡å¼</strong>ï¼šç®—åˆ†å‡½æ•°çš„ç»“æœã€åŸå§‹æŸ¥è¯¢çš„ç›¸å…³æ€§ç®—åˆ†ï¼Œä¸¤è€…ä¹‹é—´çš„è¿ç®—æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼š<ul><li>multiplyï¼šç›¸ä¹˜</li><li>replaceï¼šç”¨function scoreæ›¿æ¢query score</li><li>å…¶å®ƒï¼Œä¾‹å¦‚ï¼šsumã€avgã€maxã€min</li></ul></li></ul><p>function scoreçš„è¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>1ï¼‰æ ¹æ®<strong>åŸå§‹æ¡ä»¶</strong>æŸ¥è¯¢æœç´¢æ–‡æ¡£ï¼Œå¹¶ä¸”è®¡ç®—ç›¸å…³æ€§ç®—åˆ†ï¼Œç§°ä¸º<strong>åŸå§‹ç®—åˆ†</strong>ï¼ˆquery scoreï¼‰</li><li>2ï¼‰æ ¹æ®<strong>è¿‡æ»¤æ¡ä»¶</strong>ï¼Œè¿‡æ»¤æ–‡æ¡£</li><li>3ï¼‰ç¬¦åˆ<strong>è¿‡æ»¤æ¡ä»¶</strong>çš„æ–‡æ¡£ï¼ŒåŸºäº<strong>ç®—åˆ†å‡½æ•°</strong>è¿ç®—ï¼Œå¾—åˆ°<strong>å‡½æ•°ç®—åˆ†</strong>ï¼ˆfunction scoreï¼‰</li><li>4ï¼‰å°†<strong>åŸå§‹ç®—åˆ†</strong>ï¼ˆquery scoreï¼‰å’Œ<strong>å‡½æ•°ç®—åˆ†</strong>ï¼ˆfunction scoreï¼‰åŸºäº<strong>è¿ç®—æ¨¡å¼</strong>åšè¿ç®—ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœï¼Œä½œä¸ºç›¸å…³æ€§ç®—åˆ†ã€‚</li></ul><p>å› æ­¤ï¼Œå…¶ä¸­çš„å…³é”®ç‚¹æ˜¯ï¼š</p><ul><li>è¿‡æ»¤æ¡ä»¶ï¼šå†³å®šå“ªäº›æ–‡æ¡£çš„ç®—åˆ†è¢«ä¿®æ”¹</li><li>ç®—åˆ†å‡½æ•°ï¼šå†³å®šå‡½æ•°ç®—åˆ†çš„ç®—æ³•</li><li>è¿ç®—æ¨¡å¼ï¼šå†³å®šæœ€ç»ˆç®—åˆ†ç»“æœ</li></ul><h4 id="shi-li-1" id="ç¤ºä¾‹-2">ç¤ºä¾‹</h4><blockquote><p>éœ€æ±‚ï¼šç»™â€œå¦‚å®¶â€è¿™ä¸ªå“ç‰Œçš„é…’åº—æ’åé å‰ä¸€äº›</p></blockquote><p>ç¿»è¯‘ä¸€ä¸‹è¿™ä¸ªéœ€æ±‚ï¼Œè½¬æ¢ä¸ºä¹‹å‰è¯´çš„å››ä¸ªè¦ç‚¹ï¼š</p><ul><li>åŸå§‹æ¡ä»¶ï¼šä¸ç¡®å®šï¼Œå¯ä»¥ä»»æ„å˜åŒ–</li><li>è¿‡æ»¤æ¡ä»¶ï¼šbrand = â€œå¦‚å®¶â€</li><li>ç®—åˆ†å‡½æ•°ï¼šå¯ä»¥ç®€å•ç²—æš´ï¼Œç›´æ¥ç»™å›ºå®šçš„ç®—åˆ†ç»“æœï¼Œweight</li><li>è¿ç®—æ¨¡å¼ï¼šæ¯”å¦‚æ±‚å’Œ</li></ul><p>å› æ­¤æœ€ç»ˆçš„DSLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;function_score&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>  .... <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="comment">// åŸå§‹æŸ¥è¯¢ï¼Œå¯ä»¥æ˜¯ä»»æ„æ¡ä»¶</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;functions&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span>Â <span class="comment">//Â ç®—åˆ†å‡½æ•°</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="comment">//Â æ»¡è¶³çš„æ¡ä»¶ï¼Œå“ç‰Œå¿…é¡»æ˜¯å¦‚å®¶</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;å¦‚å®¶&quot;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span>Â <span class="number">2</span>Â <span class="comment">//Â ç®—åˆ†æƒé‡ä¸º2</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;boost_mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sum&quot;</span> <span class="comment">// åŠ æƒæ¨¡å¼ï¼Œæ±‚å’Œ</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼Œåœ¨æœªæ·»åŠ ç®—åˆ†å‡½æ•°æ—¶ï¼Œå¦‚å®¶å¾—åˆ†å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/1a5b416a6b254884bcdcb1eb213a4942" alt="image-20210721193152520"></p><p>æ·»åŠ äº†ç®—åˆ†å‡½æ•°åï¼Œå¦‚å®¶å¾—åˆ†å°±æå‡äº†ï¼š<img src="https://s1.vika.cn/space/2023/01/07/defcc6c20b504c4cb34ffe1e17852291" alt="image-20210721193458182"></p><h4 id="xiao-jie" id="å°ç»“">å°ç»“</h4><p>function score queryå®šä¹‰çš„ä¸‰è¦ç´ æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>è¿‡æ»¤æ¡ä»¶ï¼šå“ªäº›æ–‡æ¡£è¦åŠ åˆ†</li><li>ç®—åˆ†å‡½æ•°ï¼šå¦‚ä½•è®¡ç®—function score</li><li>åŠ æƒæ–¹å¼ï¼šfunction score ä¸ query scoreå¦‚ä½•è¿ç®—</li></ul><h3 id="bu-er-cha-xun" id="å¸ƒå°”æŸ¥è¯¢">å¸ƒå°”æŸ¥è¯¢</h3><blockquote><p>å¸ƒå°”æŸ¥è¯¢æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæŸ¥è¯¢å­å¥çš„ç»„åˆï¼Œæ¯ä¸€ä¸ªå­å¥å°±æ˜¯ä¸€ä¸ª<strong>å­æŸ¥è¯¢</strong>ã€‚å­æŸ¥è¯¢çš„ç»„åˆæ–¹å¼æœ‰ï¼š</p></blockquote><ul><li>mustï¼šå¿…é¡»åŒ¹é…æ¯ä¸ªå­æŸ¥è¯¢ï¼Œç±»ä¼¼â€œä¸â€</li><li>shouldï¼šé€‰æ‹©æ€§åŒ¹é…å­æŸ¥è¯¢ï¼Œç±»ä¼¼â€œæˆ–â€</li><li>must_notï¼šå¿…é¡»ä¸åŒ¹é…ï¼Œ<strong>ä¸å‚ä¸ç®—åˆ†</strong>ï¼Œç±»ä¼¼â€œéâ€</li><li>filterï¼šå¿…é¡»åŒ¹é…ï¼Œ<strong>ä¸å‚ä¸ç®—åˆ†</strong></li></ul><p>æ¯”å¦‚åœ¨æœç´¢é…’åº—æ—¶ï¼Œé™¤äº†å…³é”®å­—æœç´¢å¤–ï¼Œæˆ‘ä»¬è¿˜å¯èƒ½æ ¹æ®å“ç‰Œã€ä»·æ ¼ã€åŸå¸‚ç­‰å­—æ®µåšè¿‡æ»¤ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/c778e09f349f4529959f5d31d2a6f5a8" alt="image-20210721193822848"></p><p>æ¯ä¸€ä¸ªä¸åŒçš„å­—æ®µï¼Œå…¶æŸ¥è¯¢çš„æ¡ä»¶ã€æ–¹å¼éƒ½ä¸ä¸€æ ·ï¼Œå¿…é¡»æ˜¯å¤šä¸ªä¸åŒçš„æŸ¥è¯¢ï¼Œè€Œè¦ç»„åˆè¿™äº›æŸ¥è¯¢ï¼Œå°±å¿…é¡»ç”¨boolæŸ¥è¯¢äº†ã€‚</p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœç´¢æ—¶ï¼Œå‚ä¸<strong>æ‰“åˆ†çš„å­—æ®µè¶Šå¤šï¼ŒæŸ¥è¯¢çš„æ€§èƒ½ä¹Ÿè¶Šå·®</strong>ã€‚å› æ­¤è¿™ç§å¤šæ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œå»ºè®®è¿™æ ·åšï¼š</p></blockquote><ul><li>æœç´¢æ¡†çš„å…³é”®å­—æœç´¢ï¼Œæ˜¯å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼Œä½¿ç”¨mustæŸ¥è¯¢ï¼Œå‚ä¸ç®—åˆ†</li><li>å…¶å®ƒè¿‡æ»¤æ¡ä»¶ï¼Œé‡‡ç”¨filteræŸ¥è¯¢ã€‚ä¸å‚ä¸ç®—åˆ†</li></ul><h4 id="yu-fa-shi-li" id="è¯­æ³•ç¤ºä¾‹ï¼š">è¯­æ³•ç¤ºä¾‹ï¼š</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#123;</span><span class="attr">&quot;term&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="attr">&quot;city&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;ä¸Šæµ·&quot;</span>Â <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#123;</span><span class="attr">&quot;term&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;çš‡å† å‡æ—¥&quot;</span>Â <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;term&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;åç¾è¾¾&quot;</span>Â <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;must_not&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#123;</span>Â <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span>Â <span class="number">500</span>Â <span class="punctuation">&#125;</span>Â <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="punctuation">&#123;</span>Â <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="attr">&quot;score&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span>Â <span class="number">45</span>Â <span class="punctuation">&#125;</span>Â <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">]</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="shi-li-2" id="ç¤ºä¾‹-3">ç¤ºä¾‹</h4><blockquote><p>éœ€æ±‚ï¼šæœç´¢åå­—åŒ…å«â€œå¦‚å®¶â€ï¼Œä»·æ ¼ä¸é«˜äº400ï¼Œåœ¨åæ ‡31.21,121.5å‘¨å›´10kmèŒƒå›´å†…çš„é…’åº—ã€‚</p></blockquote><p>åˆ†æï¼š</p><ul><li>åç§°æœç´¢ï¼Œå±äºå…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼Œåº”è¯¥å‚ä¸ç®—åˆ†ã€‚æ”¾åˆ°mustä¸­</li><li>ä»·æ ¼ä¸é«˜äº400ï¼Œç”¨rangeæŸ¥è¯¢ï¼Œå±äºè¿‡æ»¤æ¡ä»¶ï¼Œä¸å‚ä¸ç®—åˆ†ã€‚æ”¾åˆ°must_notä¸­</li><li>å‘¨å›´10kmèŒƒå›´å†…ï¼Œç”¨geo_distanceæŸ¥è¯¢ï¼Œå±äºè¿‡æ»¤æ¡ä»¶ï¼Œä¸å‚ä¸ç®—åˆ†ã€‚æ”¾åˆ°filterä¸­</li></ul><p><img src="https://s1.vika.cn/space/2023/01/07/55b00f4d65574c1db45a8222ffd6bf84" alt="image-20210721194744183"></p><h4 id="xiao-jie-1" id="å°ç»“-2">å°ç»“</h4><p>boolæŸ¥è¯¢æœ‰å‡ ç§é€»è¾‘å…³ç³»ï¼Ÿ</p><ul><li>mustï¼šå¿…é¡»åŒ¹é…çš„æ¡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºâ€œä¸â€</li><li>shouldï¼šé€‰æ‹©æ€§åŒ¹é…çš„æ¡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºâ€œæˆ–â€</li><li>must_notï¼šå¿…é¡»ä¸åŒ¹é…çš„æ¡ä»¶ï¼Œä¸å‚ä¸æ‰“åˆ†</li><li>filterï¼šå¿…é¡»åŒ¹é…çš„æ¡ä»¶ï¼Œä¸å‚ä¸æ‰“åˆ†</li></ul><h1 id="sou-suo-jie-guo-chu-li">æœç´¢ç»“æœå¤„ç†</h1><p>æœç´¢çš„ç»“æœå¯ä»¥æŒ‰ç…§ç”¨æˆ·æŒ‡å®šçš„æ–¹å¼å»å¤„ç†æˆ–å±•ç¤ºã€‚</p><h2 id="pai-xu" id="æ’åº">æ’åº</h2><blockquote><p>elasticsearché»˜è®¤æ˜¯æ ¹æ®ç›¸å…³åº¦ç®—åˆ†ï¼ˆ_scoreï¼‰æ¥æ’åºï¼Œä½†æ˜¯ä¹Ÿæ”¯æŒè‡ªå®šä¹‰æ–¹å¼å¯¹æœç´¢<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/sort-search-results.html">ç»“æœæ’åº</a>ã€‚å¯ä»¥æ’åºå­—æ®µç±»å‹æœ‰ï¼škeywordç±»å‹ã€æ•°å€¼ç±»å‹ã€åœ°ç†åæ ‡ç±»å‹ã€æ—¥æœŸç±»å‹ç­‰ã€‚</p></blockquote><h3 id="pu-tong-zi-duan-pai-xu" id="æ™®é€šå­—æ®µæ’åº">æ™®é€šå­—æ®µæ’åº</h3><p>keywordã€æ•°å€¼ã€æ—¥æœŸç±»å‹æ’åºçš„è¯­æ³•åŸºæœ¬ä¸€è‡´ã€‚</p><p><strong>è¯­æ³•</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;desc&quot;</span>Â Â <span class="comment">//Â æ’åºå­—æ®µã€æ’åºæ–¹å¼ASCã€DESC</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æ’åºæ¡ä»¶æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å†™å¤šä¸ªæ’åºæ¡ä»¶ã€‚æŒ‰ç…§å£°æ˜çš„é¡ºåºï¼Œå½“ç¬¬ä¸€ä¸ªæ¡ä»¶ç›¸ç­‰æ—¶ï¼Œå†æŒ‰ç…§ç¬¬äºŒä¸ªæ¡ä»¶æ’åºï¼Œä»¥æ­¤ç±»æ¨</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><blockquote><p>éœ€æ±‚æè¿°ï¼šé…’åº—æ•°æ®æŒ‰ç…§ç”¨æˆ·è¯„ä»·ï¼ˆscore)é™åºæ’åºï¼Œè¯„ä»·ç›¸åŒçš„æŒ‰ç…§ä»·æ ¼(price)å‡åºæ’åº</p></blockquote><p><img src="https://s1.vika.cn/space/2023/01/07/b43264d2d7764591baa6a2f6058a43b0" alt="image-20210721195728306"></p><h3 id="di-li-zuo-biao-pai-xu" id="åœ°ç†åæ ‡æ’åº">åœ°ç†åæ ‡æ’åº</h3><p>åœ°ç†åæ ‡æ’åºç•¥æœ‰ä¸åŒã€‚</p><p><strong>è¯­æ³•è¯´æ˜</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;_geo_distance&quot;</span>Â <span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;çº¬åº¦ï¼Œç»åº¦&quot;</span><span class="punctuation">,</span> <span class="comment">// æ–‡æ¡£ä¸­geo_pointç±»å‹çš„å­—æ®µåã€ç›®æ ‡åæ ‡ç‚¹</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;order&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;asc&quot;</span><span class="punctuation">,</span> <span class="comment">// æ’åºæ–¹å¼</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;unit&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;km&quot;</span> <span class="comment">// æ’åºçš„è·ç¦»å•ä½</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢çš„å«ä¹‰æ˜¯ï¼š</p><ul><li>æŒ‡å®šä¸€ä¸ªåæ ‡ï¼Œä½œä¸ºç›®æ ‡ç‚¹</li><li>è®¡ç®—æ¯ä¸€ä¸ªæ–‡æ¡£ä¸­ï¼ŒæŒ‡å®šå­—æ®µï¼ˆå¿…é¡»æ˜¯geo_pointç±»å‹ï¼‰çš„åæ ‡ åˆ°ç›®æ ‡ç‚¹çš„è·ç¦»æ˜¯å¤šå°‘</li><li>æ ¹æ®è·ç¦»æ’åº</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><blockquote><p>éœ€æ±‚æè¿°ï¼šå®ç°å¯¹é…’åº—æ•°æ®æŒ‰ç…§åˆ°ä½ çš„ä½ç½®åæ ‡çš„è·ç¦»å‡åºæ’åº</p></blockquote><p>æç¤ºï¼šè·å–ä½ çš„ä½ç½®çš„ç»çº¬åº¦çš„æ–¹å¼ï¼š<a href="https://lbs.amap.com/demo/jsapi-v2/example/map/click-to-get-lnglat/">https://lbs.amap.com/demo/jsapi-v2/example/map/click-to-get-lnglat/</a></p><p>å‡è®¾æˆ‘çš„ä½ç½®æ˜¯ï¼š31.034661ï¼Œ121.612282ï¼Œå¯»æ‰¾æˆ‘å‘¨å›´è·ç¦»æœ€è¿‘çš„é…’åº—ã€‚</p><p><img src="https://s1.vika.cn/space/2023/01/07/9dd962a7b3d44eaab55796aec01a168c" alt="image-20210721200214690"></p><h2 id="fen-ye" id="åˆ†é¡µ">åˆ†é¡µ</h2><p>elasticsearch é»˜è®¤æƒ…å†µä¸‹åªè¿”å›top10çš„æ•°æ®ã€‚è€Œå¦‚æœè¦æŸ¥è¯¢æ›´å¤šæ•°æ®å°±éœ€è¦ä¿®æ”¹åˆ†é¡µå‚æ•°äº†ã€‚elasticsearchä¸­é€šè¿‡ä¿®æ”¹fromã€sizeå‚æ•°æ¥æ§åˆ¶è¦è¿”å›çš„åˆ†é¡µç»“æœï¼š</p><ul><li>fromï¼šä»ç¬¬å‡ ä¸ªæ–‡æ¡£å¼€å§‹</li><li>sizeï¼šæ€»å…±æŸ¥è¯¢å‡ ä¸ªæ–‡æ¡£</li></ul><p>ç±»ä¼¼äºmysqlä¸­çš„<code>limit ?, ?</code></p><h3 id="ji-ben-de-fen-ye" id="åŸºæœ¬çš„åˆ†é¡µ">åŸºæœ¬çš„åˆ†é¡µ</h3><p>åˆ†é¡µçš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span>Â <span class="number">0</span><span class="punctuation">,</span>Â <span class="comment">//Â åˆ†é¡µå¼€å§‹çš„ä½ç½®ï¼Œé»˜è®¤ä¸º0</span></span><br><span class="line">Â Â <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span>Â <span class="number">10</span><span class="punctuation">,</span>Â <span class="comment">//Â æœŸæœ›è·å–çš„æ–‡æ¡£æ€»æ•°</span></span><br><span class="line">Â Â <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#123;</span><span class="attr">&quot;price&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;asc&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="shen-du-fen-ye-wen-ti" id="æ·±åº¦åˆ†é¡µé—®é¢˜">æ·±åº¦åˆ†é¡µé—®é¢˜</h3><p>ç°åœ¨ï¼Œæˆ‘è¦æŸ¥è¯¢990~1000çš„æ•°æ®ï¼ŒæŸ¥è¯¢é€»è¾‘è¦è¿™ä¹ˆå†™ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span>Â <span class="number">990</span><span class="punctuation">,</span>Â <span class="comment">//Â åˆ†é¡µå¼€å§‹çš„ä½ç½®ï¼Œé»˜è®¤ä¸º0</span></span><br><span class="line">Â Â <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span>Â <span class="number">10</span><span class="punctuation">,</span>Â <span class="comment">//Â æœŸæœ›è·å–çš„æ–‡æ¡£æ€»æ•°</span></span><br><span class="line">Â Â <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#123;</span><span class="attr">&quot;price&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;asc&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯æŸ¥è¯¢990å¼€å§‹çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ ç¬¬990~ç¬¬1000æ¡ æ•°æ®ã€‚</p><p>ä¸è¿‡ï¼Œelasticsearchå†…éƒ¨åˆ†é¡µæ—¶ï¼Œå¿…é¡»å…ˆæŸ¥è¯¢ 0~1000æ¡ï¼Œç„¶åæˆªå–å…¶ä¸­çš„990 ~ 1000çš„è¿™10æ¡ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/d3807c07d9254441ab74a887526999dc" alt="image-20210721200643029"></p><p>æŸ¥è¯¢TOP1000ï¼Œå¦‚æœesæ˜¯å•ç‚¹æ¨¡å¼ï¼Œè¿™å¹¶æ— å¤ªå¤§å½±å“ã€‚</p><p>ä½†æ˜¯elasticsearchå°†æ¥ä¸€å®šæ˜¯é›†ç¾¤ï¼Œä¾‹å¦‚æˆ‘é›†ç¾¤æœ‰5ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘è¦æŸ¥è¯¢TOP1000çš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªèŠ‚ç‚¹æŸ¥è¯¢200æ¡å°±å¯ä»¥äº†ã€‚</p><p>å› ä¸ºèŠ‚ç‚¹Açš„TOP200ï¼Œåœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½æ’åˆ°10000åä»¥å¤–äº†ã€‚</p><p>å› æ­¤è¦æƒ³è·å–æ•´ä¸ªé›†ç¾¤çš„TOP1000ï¼Œå¿…é¡»å…ˆæŸ¥è¯¢å‡ºæ¯ä¸ªèŠ‚ç‚¹çš„TOP1000ï¼Œæ±‡æ€»ç»“æœåï¼Œé‡æ–°æ’åï¼Œé‡æ–°æˆªå–TOP1000ã€‚</p><p><img src="https://s1.vika.cn/space/2023/01/07/2e17657e25584957822a02a7b488690f" alt="image-20210721201003229"></p><p>é‚£å¦‚æœæˆ‘è¦æŸ¥è¯¢9900~10000çš„æ•°æ®å‘¢ï¼Ÿæ˜¯ä¸æ˜¯è¦å…ˆæŸ¥è¯¢TOP10000å‘¢ï¼Ÿé‚£æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦æŸ¥è¯¢10000æ¡ï¼Ÿæ±‡æ€»åˆ°å†…å­˜ä¸­ï¼Ÿ</p><p>å½“æŸ¥è¯¢åˆ†é¡µæ·±åº¦è¾ƒå¤§æ—¶ï¼Œæ±‡æ€»æ•°æ®è¿‡å¤šï¼Œå¯¹å†…å­˜å’ŒCPUä¼šäº§ç”Ÿéå¸¸å¤§çš„å‹åŠ›ï¼Œå› æ­¤elasticsearchä¼šç¦æ­¢from+ size è¶…è¿‡10000çš„è¯·æ±‚ã€‚</p><p>é’ˆå¯¹æ·±åº¦åˆ†é¡µï¼ŒESæä¾›äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/paginate-search-results.html">å®˜æ–¹æ–‡æ¡£</a>ï¼š</p><ul><li>search afterï¼šåˆ†é¡µæ—¶éœ€è¦æ’åºï¼ŒåŸç†æ˜¯ä»ä¸Šä¸€æ¬¡çš„æ’åºå€¼å¼€å§‹ï¼ŒæŸ¥è¯¢ä¸‹ä¸€é¡µæ•°æ®ã€‚å®˜æ–¹æ¨èä½¿ç”¨çš„æ–¹å¼ã€‚</li><li>scrollï¼šåŸç†å°†æ’åºåçš„æ–‡æ¡£idå½¢æˆå¿«ç…§ï¼Œä¿å­˜åœ¨å†…å­˜ã€‚å®˜æ–¹å·²ç»ä¸æ¨èä½¿ç”¨ã€‚</li></ul><h3 id="xiao-jie-2" id="å°ç»“-3">å°ç»“</h3><p>åˆ†é¡µæŸ¥è¯¢çš„å¸¸è§å®ç°æ–¹æ¡ˆä»¥åŠä¼˜ç¼ºç‚¹ï¼š</p><ul><li><p><code>from + size</code>ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šæ”¯æŒéšæœºç¿»é¡µ</li><li>ç¼ºç‚¹ï¼šæ·±åº¦åˆ†é¡µé—®é¢˜ï¼Œé»˜è®¤æŸ¥è¯¢ä¸Šé™ï¼ˆfrom + sizeï¼‰æ˜¯10000</li><li>åœºæ™¯ï¼šç™¾åº¦ã€äº¬ä¸œã€è°·æ­Œã€æ·˜å®è¿™æ ·çš„éšæœºç¿»é¡µæœç´¢</li></ul></li><li><p><code>after search</code>ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šæ²¡æœ‰æŸ¥è¯¢ä¸Šé™ï¼ˆå•æ¬¡æŸ¥è¯¢çš„sizeä¸è¶…è¿‡10000ï¼‰</li><li>ç¼ºç‚¹ï¼šåªèƒ½å‘åé€é¡µæŸ¥è¯¢ï¼Œä¸æ”¯æŒéšæœºç¿»é¡µ</li><li>åœºæ™¯ï¼šæ²¡æœ‰éšæœºç¿»é¡µéœ€æ±‚çš„æœç´¢ï¼Œä¾‹å¦‚æ‰‹æœºå‘ä¸‹æ»šåŠ¨ç¿»é¡µ</li></ul></li><li><p><code>scroll</code>ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šæ²¡æœ‰æŸ¥è¯¢ä¸Šé™ï¼ˆå•æ¬¡æŸ¥è¯¢çš„sizeä¸è¶…è¿‡10000ï¼‰</li><li>ç¼ºç‚¹ï¼šä¼šæœ‰é¢å¤–å†…å­˜æ¶ˆè€—ï¼Œå¹¶ä¸”æœç´¢ç»“æœæ˜¯éå®æ—¶çš„</li><li>åœºæ™¯ï¼šæµ·é‡æ•°æ®çš„è·å–å’Œè¿ç§»ã€‚ä»ES7.1å¼€å§‹ä¸æ¨èï¼Œå»ºè®®ç”¨ after searchæ–¹æ¡ˆã€‚</li></ul></li></ul><h2 id="gao-liang" id="é«˜äº®">é«˜äº®</h2><h3 id="gao-liang-yuan-li" id="é«˜äº®åŸç†">é«˜äº®åŸç†</h3><p>ä»€ä¹ˆæ˜¯é«˜äº®æ˜¾ç¤ºå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬åœ¨ç™¾åº¦ï¼Œäº¬ä¸œæœç´¢æ—¶ï¼Œå…³é”®å­—ä¼šå˜æˆçº¢è‰²ï¼Œæ¯”è¾ƒé†’ç›®ï¼Œè¿™å«é«˜äº®æ˜¾ç¤ºï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/812b9b7d304f424c91b71406a069e15b" alt="image-20210721202705030"></p><p>é«˜äº®æ˜¾ç¤ºçš„å®ç°åˆ†ä¸ºä¸¤æ­¥ï¼š</p><ul><li>1ï¼‰ç»™æ–‡æ¡£ä¸­çš„æ‰€æœ‰å…³é”®å­—éƒ½æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ï¼Œä¾‹å¦‚<code>&lt;em&gt;</code>æ ‡ç­¾</li><li>2ï¼‰é¡µé¢ç»™<code>&lt;em&gt;</code>æ ‡ç­¾ç¼–å†™CSSæ ·å¼</li></ul><h3 id="shi-xian-gao-liang" id="å®ç°é«˜äº®">å®ç°é«˜äº®</h3><p><strong>é«˜äº®çš„è¯­æ³•</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;TEXT&quot;</span> <span class="comment">// æŸ¥è¯¢æ¡ä»¶ï¼Œé«˜äº®ä¸€å®šè¦ä½¿ç”¨å…¨æ–‡æ£€ç´¢æŸ¥è¯¢</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â <span class="attr">&quot;highlight&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span>Â <span class="comment">//Â æŒ‡å®šè¦é«˜äº®çš„å­—æ®µ</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;pre_tags&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;&lt;em&gt;&quot;</span><span class="punctuation">,</span>Â Â <span class="comment">//Â ç”¨æ¥æ ‡è®°é«˜äº®å­—æ®µçš„å‰ç½®æ ‡ç­¾</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="attr">&quot;post_tags&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;&lt;/em&gt;&quot;</span>Â <span class="comment">//Â ç”¨æ¥æ ‡è®°é«˜äº®å­—æ®µçš„åç½®æ ‡ç­¾</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>é«˜äº®æ˜¯å¯¹å…³é”®å­—é«˜äº®ï¼Œå› æ­¤<strong>æœç´¢æ¡ä»¶å¿…é¡»å¸¦æœ‰å…³é”®å­—</strong>ï¼Œè€Œä¸èƒ½æ˜¯èŒƒå›´è¿™æ ·çš„æŸ¥è¯¢ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>é«˜äº®çš„å­—æ®µï¼Œå¿…é¡»ä¸æœç´¢æŒ‡å®šçš„å­—æ®µä¸€è‡´</strong>ï¼Œå¦åˆ™æ— æ³•é«˜äº®</li><li>å¦‚æœè¦å¯¹éæœç´¢å­—æ®µé«˜äº®ï¼Œåˆ™éœ€è¦æ·»åŠ ä¸€ä¸ªå±æ€§ï¼š<code>required_field_match=false</code></li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/2724953e26d245e19547f4f34ceb9b6e" alt="image-20210721203349633"></p><h2 id="zong-jie-2" id="æ€»ç»“-3">æ€»ç»“</h2><p>æŸ¥è¯¢çš„DSLæ˜¯ä¸€ä¸ªå¤§çš„JSONå¯¹è±¡ï¼ŒåŒ…å«ä¸‹åˆ—å±æ€§ï¼š</p><ul><li>queryï¼šæŸ¥è¯¢æ¡ä»¶</li><li>fromå’Œsizeï¼šåˆ†é¡µæ¡ä»¶</li><li>sortï¼šæ’åºæ¡ä»¶</li><li>highlightï¼šé«˜äº®æ¡ä»¶</li></ul><p>ç¤ºä¾‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/b4766eb80aca45c28f207468e835a2bf" alt="image-20210721203657850"></p><h1 id="rest-client-cha-xun-wen-dang">RestClientæŸ¥è¯¢æ–‡æ¡£</h1><blockquote><p>æ–‡æ¡£çš„æŸ¥è¯¢åŒæ ·é€‚ç”¨æ˜¨å¤©å­¦ä¹ çš„ RestHighLevelClientå¯¹è±¡ï¼ŒåŸºæœ¬æ­¥éª¤åŒ…æ‹¬ï¼š</p><ul><li>1ï¼‰å‡†å¤‡Requestå¯¹è±¡</li><li>2ï¼‰å‡†å¤‡è¯·æ±‚å‚æ•°</li><li>3ï¼‰å‘èµ·è¯·æ±‚</li><li>4ï¼‰è§£æå“åº”</li></ul></blockquote><h2 id="kuai-su-ru-men" id="å¿«é€Ÿå…¥é—¨">å¿«é€Ÿå…¥é—¨</h2><p>æˆ‘ä»¬ä»¥match_allæŸ¥è¯¢ä¸ºä¾‹</p><h3 id="fa-qi-cha-xun-qing-qiu" id="å‘èµ·æŸ¥è¯¢è¯·æ±‚">å‘èµ·æŸ¥è¯¢è¯·æ±‚</h3><p><img src="https://s1.vika.cn/space/2023/01/07/803bab538fbe4fadb505fdcf2bbc70f7" alt="image-20210721203950559"></p><p>ä»£ç è§£è¯»ï¼š</p><ul><li><p>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»º<code>SearchRequest</code>å¯¹è±¡ï¼ŒæŒ‡å®šç´¢å¼•åº“å</p></li><li><p>ç¬¬äºŒæ­¥ï¼Œåˆ©ç”¨<code>request.source()</code>æ„å»ºDSLï¼ŒDSLä¸­å¯ä»¥åŒ…å«æŸ¥è¯¢ã€åˆ†é¡µã€æ’åºã€é«˜äº®ç­‰</p><ul><li><code>query()</code>ï¼šä»£è¡¨æŸ¥è¯¢æ¡ä»¶ï¼Œåˆ©ç”¨<code>QueryBuilders.matchAllQuery()</code>æ„å»ºä¸€ä¸ªmatch_allæŸ¥è¯¢çš„DSL</li></ul></li><li><p>ç¬¬ä¸‰æ­¥ï¼Œåˆ©ç”¨client.search()å‘é€è¯·æ±‚ï¼Œå¾—åˆ°å“åº”</p></li></ul><p>è¿™é‡Œå…³é”®çš„APIæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯<code>request.source()</code>ï¼Œå…¶ä¸­åŒ…å«äº†æŸ¥è¯¢ã€æ’åºã€åˆ†é¡µã€é«˜äº®ç­‰æ‰€æœ‰åŠŸèƒ½ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/d7a62cb7be564b2dbe5b1f2db9650a90" alt="image-20210721215640790"></p><p>å¦ä¸€ä¸ªæ˜¯<code>QueryBuilders</code>ï¼Œå…¶ä¸­åŒ…å«matchã€termã€function_scoreã€boolç­‰å„ç§æŸ¥è¯¢ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/d40bd874ab494fdeb2b38e6729df4d15" alt="image-20210721215729236"></p><h3 id="jie-xi-xiang-ying" id="è§£æå“åº”">è§£æå“åº”</h3><p>å“åº”ç»“æœçš„è§£æï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/e214ec679da04870a549b86d7b85d3b9" alt="image-20210721214221057"></p><p>elasticsearchè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªJSONå­—ç¬¦ä¸²ï¼Œç»“æ„åŒ…å«ï¼š</p><ul><li><code>hits</code>ï¼šå‘½ä¸­çš„ç»“æœ<ul><li><code>total</code>ï¼šæ€»æ¡æ•°ï¼Œå…¶ä¸­çš„valueæ˜¯å…·ä½“çš„æ€»æ¡æ•°å€¼</li><li><code>max_score</code>ï¼šæ‰€æœ‰ç»“æœä¸­å¾—åˆ†æœ€é«˜çš„æ–‡æ¡£çš„ç›¸å…³æ€§ç®—åˆ†</li><li><code>hits</code>ï¼šæœç´¢ç»“æœçš„æ–‡æ¡£æ•°ç»„ï¼Œå…¶ä¸­çš„æ¯ä¸ªæ–‡æ¡£éƒ½æ˜¯ä¸€ä¸ªjsonå¯¹è±¡<ul><li><code>_source</code>ï¼šæ–‡æ¡£ä¸­çš„åŸå§‹æ•°æ®ï¼Œä¹Ÿæ˜¯jsonå¯¹è±¡</li></ul></li></ul></li></ul><p>å› æ­¤ï¼Œæˆ‘ä»¬è§£æå“åº”ç»“æœï¼Œå°±æ˜¯é€å±‚è§£æJSONå­—ç¬¦ä¸²ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li><code>SearchHits</code>ï¼šé€šè¿‡response.getHits()è·å–ï¼Œå°±æ˜¯JSONä¸­çš„æœ€å¤–å±‚çš„hitsï¼Œä»£è¡¨å‘½ä¸­çš„ç»“æœ<ul><li><code>SearchHits#getTotalHits().value</code>ï¼šè·å–æ€»æ¡æ•°ä¿¡æ¯</li><li><code>SearchHits#getHits()</code>ï¼šè·å–SearchHitæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯æ–‡æ¡£æ•°ç»„<ul><li><code>SearchHit#getSourceAsString()</code>ï¼šè·å–æ–‡æ¡£ç»“æœä¸­çš„_sourceï¼Œä¹Ÿå°±æ˜¯åŸå§‹çš„jsonæ–‡æ¡£æ•°æ®</li></ul></li></ul></li></ul><h3 id="wan-zheng-dai-ma" id="å®Œæ•´ä»£ç ">å®Œæ•´ä»£ç </h3><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMatchAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    request.source()</span><br><span class="line">        .query(QueryBuilders.matchAllQuery());</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">    <span class="comment">// 4.1.è·å–æ€»æ¡æ•°</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">    System.out.println(<span class="string">&quot;å…±æœç´¢åˆ°&quot;</span> + total + <span class="string">&quot;æ¡æ•°æ®&quot;</span>);</span><br><span class="line">    <span class="comment">// 4.2.æ–‡æ¡£æ•°ç»„</span></span><br><span class="line">    SearchHit[] hits = searchHits.getHits();</span><br><span class="line">    <span class="comment">// 4.3.éå†</span></span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">        <span class="comment">// è·å–æ–‡æ¡£source</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">        <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;hotelDoc = &quot;</span> + hotelDoc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="xiao-jie-3" id="å°ç»“-4">å°ç»“</h3><p>æŸ¥è¯¢çš„åŸºæœ¬æ­¥éª¤æ˜¯ï¼š</p><ol><li><p>åˆ›å»ºSearchRequestå¯¹è±¡</p></li><li><p>å‡†å¤‡Request.source()ï¼Œä¹Ÿå°±æ˜¯DSLã€‚</p><p>â‘  QueryBuildersæ¥æ„å»ºæŸ¥è¯¢æ¡ä»¶</p><p>â‘¡ ä¼ å…¥Request.source() çš„ query() æ–¹æ³•</p></li><li><p>å‘é€è¯·æ±‚ï¼Œå¾—åˆ°ç»“æœ</p></li><li><p>è§£æç»“æœï¼ˆå‚è€ƒJSONç»“æœï¼Œä»å¤–åˆ°å†…ï¼Œé€å±‚è§£æï¼‰</p></li></ol><h2 id="match-cha-xun" id="matchæŸ¥è¯¢">matchæŸ¥è¯¢</h2><p>å…¨æ–‡æ£€ç´¢çš„matchå’Œmulti_matchæŸ¥è¯¢ä¸match_allçš„APIåŸºæœ¬ä¸€è‡´ã€‚å·®åˆ«æ˜¯æŸ¥è¯¢æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯queryçš„éƒ¨åˆ†ã€‚</p><p><img src="https://s1.vika.cn/space/2023/01/07/dba0d947a83347bda872ca5c69abf9b8" alt="image-20210721215923060"></p><p>å› æ­¤ï¼ŒJavaä»£ç ä¸Šçš„å·®å¼‚ä¸»è¦æ˜¯request.source().query()ä¸­çš„å‚æ•°äº†ã€‚åŒæ ·æ˜¯åˆ©ç”¨QueryBuildersæä¾›çš„æ–¹æ³•ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/c77f2b41f7334912abd0c19cbc10c242" alt="image-20210721215843099"></p><p>è€Œç»“æœè§£æä»£ç åˆ™å®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥æŠ½å–å¹¶å…±äº«ã€‚</p><ul><li>Idea å¿«æ·é”®ï¼šé€‰ä¸­æŠ½å–éƒ¨åˆ†ï¼ŒæŒ‰ä½ <code>ctrl + alt + m</code></li><li>å¼¹å‡ºMethodè®¾ç½®æ¡†</li></ul><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMatch</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    request.source()</span><br><span class="line">        .query(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, <span class="string">&quot;å¦‚å®¶&quot;</span>));</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="jing-que-cha-xun" id="ç²¾ç¡®æŸ¥è¯¢">ç²¾ç¡®æŸ¥è¯¢</h2><p>ç²¾ç¡®æŸ¥è¯¢ä¸»è¦æ˜¯ä¸¤è€…ï¼š</p><ul><li>termï¼šè¯æ¡ç²¾ç¡®åŒ¹é…</li><li>rangeï¼šèŒƒå›´æŸ¥è¯¢</li></ul><p>ä¸ä¹‹å‰çš„æŸ¥è¯¢ç›¸æ¯”ï¼Œå·®å¼‚åŒæ ·åœ¨æŸ¥è¯¢æ¡ä»¶ï¼Œå…¶å®ƒéƒ½ä¸€æ ·ã€‚</p><p>æŸ¥è¯¢æ¡ä»¶æ„é€ çš„APIå¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/b61d18ebc25441518649439cf1d2f722" alt="image-20210721220305140"></p><h2 id="bu-er-cha-xun-1" id="å¸ƒå°”æŸ¥è¯¢-2">å¸ƒå°”æŸ¥è¯¢</h2><p>å¸ƒå°”æŸ¥è¯¢æ˜¯ç”¨mustã€must_notã€filterç­‰æ–¹å¼ç»„åˆå…¶å®ƒæŸ¥è¯¢ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/87732ceb10164131ba9400e48e77a9ec" alt="image-20210721220927286"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒAPIä¸å…¶å®ƒæŸ¥è¯¢çš„å·®åˆ«åŒæ ·æ˜¯åœ¨æŸ¥è¯¢æ¡ä»¶çš„æ„å»ºï¼ŒQueryBuildersï¼Œç»“æœè§£æç­‰å…¶ä»–ä»£ç å®Œå…¨ä¸å˜ã€‚</p><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBool</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    <span class="comment">// 2.1.å‡†å¤‡BooleanQuery</span></span><br><span class="line">    <span class="type">BoolQueryBuilder</span> <span class="variable">boolQuery</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">    <span class="comment">// 2.2.æ·»åŠ term</span></span><br><span class="line">    boolQuery.must(QueryBuilders.termQuery(<span class="string">&quot;city&quot;</span>, <span class="string">&quot;æ­å·&quot;</span>));</span><br><span class="line">    <span class="comment">// 2.3.æ·»åŠ range</span></span><br><span class="line">    boolQuery.filter(QueryBuilders.rangeQuery(<span class="string">&quot;price&quot;</span>).lte(<span class="number">250</span>));</span><br><span class="line"></span><br><span class="line">    request.source().query(boolQuery);</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pai-xu-fen-ye" id="æ’åºã€åˆ†é¡µ">æ’åºã€åˆ†é¡µ</h2><p>æœç´¢ç»“æœçš„æ’åºå’Œåˆ†é¡µæ˜¯ä¸queryåŒçº§çš„å‚æ•°ï¼Œå› æ­¤åŒæ ·æ˜¯ä½¿ç”¨request.source()æ¥è®¾ç½®ã€‚</p><p>å¯¹åº”çš„APIå¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/5bccc4e364d74b7e894c2e9698c85f36" alt="image-20210721221121266"></p><p>å®Œæ•´ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testPageAndSort</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// é¡µç ï¼Œæ¯é¡µå¤§å°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">page</span> <span class="operator">=</span> <span class="number">1</span>, size = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    <span class="comment">// 2.1.query</span></span><br><span class="line">    request.source().query(QueryBuilders.matchAllQuery());</span><br><span class="line">    <span class="comment">// 2.2.æ’åº sort</span></span><br><span class="line">    request.source().sort(<span class="string">&quot;price&quot;</span>, SortOrder.ASC);</span><br><span class="line">    <span class="comment">// 2.3.åˆ†é¡µ fromã€size</span></span><br><span class="line">    request.source().from((page - <span class="number">1</span>) * size).size(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="gao-liang-1" id="é«˜äº®-2">é«˜äº®</h2><p>é«˜äº®çš„ä»£ç ä¸ä¹‹å‰ä»£ç å·®å¼‚è¾ƒå¤§ï¼Œæœ‰ä¸¤ç‚¹ï¼š</p><ul><li>æŸ¥è¯¢çš„DSLï¼šå…¶ä¸­é™¤äº†æŸ¥è¯¢æ¡ä»¶ï¼Œè¿˜éœ€è¦æ·»åŠ é«˜äº®æ¡ä»¶ï¼ŒåŒæ ·æ˜¯ä¸queryåŒçº§ã€‚</li><li>ç»“æœè§£æï¼šç»“æœé™¤äº†è¦è§£æ_sourceæ–‡æ¡£æ•°æ®ï¼Œè¿˜è¦è§£æé«˜äº®ç»“æœ</li></ul><h3 id="gao-liang-qing-qiu-gou-jian" id="é«˜äº®è¯·æ±‚æ„å»º">é«˜äº®è¯·æ±‚æ„å»º</h3><p>é«˜äº®è¯·æ±‚çš„æ„å»ºAPIå¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/60d134dcfae847cd9a5e8905952ab6d2" alt="image-20210721221744883"></p><p>ä¸Šè¿°ä»£ç çœç•¥äº†æŸ¥è¯¢æ¡ä»¶éƒ¨åˆ†ï¼Œä½†æ˜¯å¤§å®¶ä¸è¦å¿˜äº†ï¼šé«˜äº®æŸ¥è¯¢å¿…é¡»ä½¿ç”¨å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼Œå¹¶ä¸”è¦æœ‰æœç´¢å…³é”®å­—ï¼Œå°†æ¥æ‰å¯ä»¥å¯¹å…³é”®å­—é«˜äº®ã€‚</p><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testHighlight</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    <span class="comment">// 2.1.query</span></span><br><span class="line">    request.source().query(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, <span class="string">&quot;å¦‚å®¶&quot;</span>));</span><br><span class="line">    <span class="comment">// 2.2.é«˜äº®</span></span><br><span class="line">    request.source().highlighter(<span class="keyword">new</span> <span class="title class_">HighlightBuilder</span>().field(<span class="string">&quot;name&quot;</span>).requireFieldMatch(<span class="literal">false</span>));</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="gao-liang-jie-guo-jie-xi" id="é«˜äº®ç»“æœè§£æ">é«˜äº®ç»“æœè§£æ</h3><p>é«˜äº®çš„ç»“æœä¸æŸ¥è¯¢çš„æ–‡æ¡£ç»“æœé»˜è®¤æ˜¯åˆ†ç¦»çš„ï¼Œå¹¶ä¸åœ¨ä¸€èµ·ã€‚</p><p>å› æ­¤è§£æé«˜äº®çš„ä»£ç éœ€è¦é¢å¤–å¤„ç†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/b74a63df644b4741959bdd819518c4dc" alt="image-20210721222057212"></p><p>ä»£ç è§£è¯»ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼šä»ç»“æœä¸­è·å–sourceã€‚hit.getSourceAsString()ï¼Œè¿™éƒ¨åˆ†æ˜¯éé«˜äº®ç»“æœï¼Œjsonå­—ç¬¦ä¸²ã€‚è¿˜éœ€è¦ååºåˆ—ä¸ºHotelDocå¯¹è±¡</li><li>ç¬¬äºŒæ­¥ï¼šè·å–é«˜äº®ç»“æœã€‚hit.getHighlightFields()ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªMapï¼Œkeyæ˜¯é«˜äº®å­—æ®µåç§°ï¼Œå€¼æ˜¯HighlightFieldå¯¹è±¡ï¼Œä»£è¡¨é«˜äº®å€¼</li><li>ç¬¬ä¸‰æ­¥ï¼šä»mapä¸­æ ¹æ®é«˜äº®å­—æ®µåç§°ï¼Œè·å–é«˜äº®å­—æ®µå€¼å¯¹è±¡HighlightField</li><li>ç¬¬å››æ­¥ï¼šä»HighlightFieldä¸­è·å–Fragmentsï¼Œå¹¶ä¸”è½¬ä¸ºå­—ç¬¦ä¸²ã€‚è¿™éƒ¨åˆ†å°±æ˜¯çœŸæ­£çš„é«˜äº®å­—ç¬¦ä¸²äº†</li><li>ç¬¬äº”æ­¥ï¼šç”¨é«˜äº®çš„ç»“æœæ›¿æ¢HotelDocä¸­çš„éé«˜äº®ç»“æœ</li></ul><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">    <span class="comment">// 4.1.è·å–æ€»æ¡æ•°</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">    System.out.println(<span class="string">&quot;å…±æœç´¢åˆ°&quot;</span> + total + <span class="string">&quot;æ¡æ•°æ®&quot;</span>);</span><br><span class="line">    <span class="comment">// 4.2.æ–‡æ¡£æ•°ç»„</span></span><br><span class="line">    SearchHit[] hits = searchHits.getHits();</span><br><span class="line">    <span class="comment">// 4.3.éå†</span></span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">        <span class="comment">// è·å–æ–‡æ¡£source</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">        <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">        <span class="comment">// è·å–é«˜äº®ç»“æœ</span></span><br><span class="line">        Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(highlightFields)) &#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®å­—æ®µåè·å–é«˜äº®ç»“æœ</span></span><br><span class="line">            <span class="type">HighlightField</span> <span class="variable">highlightField</span> <span class="operator">=</span> highlightFields.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (highlightField != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// è·å–é«˜äº®å€¼</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> highlightField.getFragments()[<span class="number">0</span>].string();</span><br><span class="line">                <span class="comment">// è¦†ç›–éé«˜äº®ç»“æœ</span></span><br><span class="line">                hotelDoc.setName(name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;hotelDoc = &quot;</span> + hotelDoc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="hei-ma-lu-you-an-li">é»‘é©¬æ—…æ¸¸æ¡ˆä¾‹</h1><blockquote><p>ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡é»‘é©¬æ—…æ¸¸çš„æ¡ˆä¾‹æ¥å®æˆ˜æ¼”ç»ƒä¸‹ä¹‹å‰å­¦ä¹ çš„çŸ¥è¯†ã€‚</p><p>æˆ‘ä»¬å®ç°å››éƒ¨åˆ†åŠŸèƒ½ï¼š</p><ul><li>é…’åº—æœç´¢å’Œåˆ†é¡µ</li><li>é…’åº—ç»“æœè¿‡æ»¤</li><li>æˆ‘å‘¨è¾¹çš„é…’åº—</li><li>é…’åº—ç«ä»·æ’å</li></ul></blockquote><p>å¯åŠ¨æˆ‘ä»¬æä¾›çš„hotel-demoé¡¹ç›®ï¼Œå…¶é»˜è®¤ç«¯å£æ˜¯8089ï¼Œè®¿é—®http://localhost:8090ï¼Œå°±èƒ½çœ‹åˆ°é¡¹ç›®é¡µé¢äº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/c57ac5c285ac4890b4d81b90765ac66c" alt="image-20210721223159598"></p><h2 id="jiu-dian-sou-suo-he-fen-ye" id="é…’åº—æœç´¢å’Œåˆ†é¡µ">é…’åº—æœç´¢å’Œåˆ†é¡µ</h2><blockquote><p>æ¡ˆä¾‹éœ€æ±‚ï¼šå®ç°é»‘é©¬æ—…æ¸¸çš„é…’åº—æœç´¢åŠŸèƒ½ï¼Œå®Œæˆå…³é”®å­—æœç´¢å’Œåˆ†é¡µ</p></blockquote><h3 id="xu-qiu-fen-xi" id="éœ€æ±‚åˆ†æ">éœ€æ±‚åˆ†æ</h3><p>åœ¨é¡¹ç›®çš„é¦–é¡µï¼Œæœ‰ä¸€ä¸ªå¤§å¤§çš„æœç´¢æ¡†ï¼Œè¿˜æœ‰åˆ†é¡µæŒ‰é’®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/fb343f070389436ca2fb83b35c7f67ab" alt="image-20210721223859419"></p><p>ç‚¹å‡»æœç´¢æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨æ§åˆ¶å°å‘å‡ºäº†è¯·æ±‚ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/7da69bba8a99484dac8e5b03d2557c95" alt="image-20210721224033789"></p><p>è¯·æ±‚å‚æ•°å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/7b7657a7ae9e4d219ed79df0e70d28ae" alt="image-20210721224112708"></p><p>ç”±æ­¤å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬è¿™ä¸ªè¯·æ±‚çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p><ul><li>è¯·æ±‚æ–¹å¼ï¼šPOST</li><li>è¯·æ±‚è·¯å¾„ï¼š/hotel/list</li><li>è¯·æ±‚å‚æ•°ï¼šJSONå¯¹è±¡ï¼ŒåŒ…å«4ä¸ªå­—æ®µï¼š<ul><li>keyï¼šæœç´¢å…³é”®å­—</li><li>pageï¼šé¡µç </li><li>sizeï¼šæ¯é¡µå¤§å°</li><li>sortByï¼šæ’åºï¼Œç›®å‰æš‚ä¸å®ç°</li></ul></li><li>è¿”å›å€¼ï¼šåˆ†é¡µæŸ¥è¯¢ï¼Œéœ€è¦è¿”å›åˆ†é¡µç»“æœPageResultï¼ŒåŒ…å«ä¸¤ä¸ªå±æ€§ï¼š<ul><li><code>total</code>ï¼šæ€»æ¡æ•°</li><li><code>List&lt;HotelDoc&gt;</code>ï¼šå½“å‰é¡µçš„æ•°æ®</li></ul></li></ul><p>å› æ­¤ï¼Œæˆ‘ä»¬å®ç°ä¸šåŠ¡çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æ­¥éª¤ä¸€ï¼šå®šä¹‰å®ä½“ç±»ï¼Œæ¥æ”¶è¯·æ±‚å‚æ•°çš„JSONå¯¹è±¡</li><li>æ­¥éª¤äºŒï¼šç¼–å†™controllerï¼Œæ¥æ”¶é¡µé¢çš„è¯·æ±‚</li><li>æ­¥éª¤ä¸‰ï¼šç¼–å†™ä¸šåŠ¡å®ç°ï¼Œåˆ©ç”¨RestHighLevelClientå®ç°æœç´¢ã€åˆ†é¡µ</li></ul><h3 id="ding-yi-shi-ti-lei" id="å®šä¹‰å®ä½“ç±»">å®šä¹‰å®ä½“ç±»</h3><p>å®ä½“ç±»æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å‰ç«¯çš„è¯·æ±‚å‚æ•°å®ä½“ï¼Œä¸€ä¸ªæ˜¯æœåŠ¡ç«¯åº”è¯¥è¿”å›çš„å“åº”ç»“æœå®ä½“ã€‚</p><ol><li>è¯·æ±‚å‚æ•°</li></ol><p>å‰ç«¯è¯·æ±‚çš„jsonç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æœç´¢å…³é”®å­—&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sortBy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨<code>cn.itcast.hotel.pojo</code>åŒ…ä¸‹å®šä¹‰ä¸€ä¸ªå®ä½“ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestParams</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line">    <span class="keyword">private</span> Integer page;</span><br><span class="line">    <span class="keyword">private</span> Integer size;</span><br><span class="line">    <span class="keyword">private</span> String sortBy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>è¿”å›å€¼</li></ol><p>åˆ†é¡µæŸ¥è¯¢ï¼Œéœ€è¦è¿”å›åˆ†é¡µç»“æœPageResultï¼ŒåŒ…å«ä¸¤ä¸ªå±æ€§ï¼š</p><ul><li><code>total</code>ï¼šæ€»æ¡æ•°</li><li><code>List&lt;HotelDoc&gt;</code>ï¼šå½“å‰é¡µçš„æ•°æ®</li></ul><p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨<code>cn.itcast.hotel.pojo</code>ä¸­å®šä¹‰è¿”å›ç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long total;</span><br><span class="line">    <span class="keyword">private</span> List&lt;HotelDoc&gt; hotels;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PageResult</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PageResult</span><span class="params">(Long total, List&lt;HotelDoc&gt; hotels)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.total = total;</span><br><span class="line">        <span class="built_in">this</span>.hotels = hotels;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ding-yi-controller" id="å®šä¹‰controller">å®šä¹‰controller</h3><p>å®šä¹‰ä¸€ä¸ªHotelControllerï¼Œå£°æ˜æŸ¥è¯¢æ¥å£ï¼Œæ»¡è¶³ä¸‹åˆ—è¦æ±‚ï¼š</p><ul><li>è¯·æ±‚æ–¹å¼ï¼šPost</li><li>è¯·æ±‚è·¯å¾„ï¼š/hotel/list</li><li>è¯·æ±‚å‚æ•°ï¼šå¯¹è±¡ï¼Œç±»å‹ä¸ºRequestParam</li><li>è¿”å›å€¼ï¼šPageResultï¼ŒåŒ…å«ä¸¤ä¸ªå±æ€§<ul><li><code>Long total</code>ï¼šæ€»æ¡æ•°</li><li><code>List&lt;HotelDoc&gt; hotels</code>ï¼šé…’åº—æ•°æ®</li></ul></li></ul><p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨<code>cn.itcast.hotel.web</code>ä¸­å®šä¹‰HotelControllerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hotel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IHotelService hotelService;</span><br><span class="line"><span class="comment">// æœç´¢é…’åº—æ•°æ®</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> PageResult <span class="title function_">search</span><span class="params">(<span class="meta">@RequestBody</span> RequestParams params)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hotelService.search(params);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="shi-xian-sou-suo-ye-wu" id="å®ç°æœç´¢ä¸šåŠ¡">å®ç°æœç´¢ä¸šåŠ¡</h3><p>æˆ‘ä»¬åœ¨controllerè°ƒç”¨äº†IHotelServiceï¼Œå¹¶æ²¡æœ‰å®ç°è¯¥æ–¹æ³•ï¼Œå› æ­¤ä¸‹é¢æˆ‘ä»¬å°±åœ¨IHotelServiceä¸­å®šä¹‰æ–¹æ³•ï¼Œå¹¶ä¸”å»å®ç°ä¸šåŠ¡é€»è¾‘ã€‚</p><ol><li>åœ¨<code>cn.itcast.hotel.service</code>ä¸­çš„<code>IHotelService</code>æ¥å£ä¸­å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®å…³é”®å­—æœç´¢é…’åº—ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params è¯·æ±‚å‚æ•°å¯¹è±¡ï¼ŒåŒ…å«ç”¨æˆ·è¾“å…¥çš„å…³é”®å­— </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> é…’åº—æ–‡æ¡£åˆ—è¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">PageResult <span class="title function_">search</span><span class="params">(RequestParams params)</span>;</span><br></pre></td></tr></table></figure><ol start="2"><li>å®ç°æœç´¢ä¸šåŠ¡ï¼Œè‚¯å®šç¦»ä¸å¼€RestHighLevelClientï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒæ³¨å†Œåˆ°Springä¸­ä½œä¸ºä¸€ä¸ªBeanã€‚åœ¨<code>cn.itcast.hotel</code>ä¸­çš„<code>HotelDemoApplication</code>ä¸­å£°æ˜è¿™ä¸ªBeanï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RestHighLevelClient <span class="title function_">client</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">        HttpHost.create(<span class="string">&quot;http://192.168.150.101:9200&quot;</span>)</span><br><span class="line">    ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>åœ¨<code>cn.itcast.hotel.service.impl</code>ä¸­çš„<code>HotelService</code>ä¸­å®ç°searchæ–¹æ³•ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">search</span><span class="params">(RequestParams params)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">        <span class="comment">// 2.1.query</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> params.getKey();</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(key)) &#123;</span><br><span class="line">            boolQuery.must(QueryBuilders.matchAllQuery());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            boolQuery.must(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, key));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.2.åˆ†é¡µ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">page</span> <span class="operator">=</span> params.getPage();</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> params.getSize();</span><br><span class="line">        request.source().from((page - <span class="number">1</span>) * size).size(size);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">        <span class="keyword">return</span> handleResponse(response);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æœè§£æ</span></span><br><span class="line"><span class="keyword">private</span> PageResult <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">    <span class="comment">// 4.1.è·å–æ€»æ¡æ•°</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">    <span class="comment">// 4.2.æ–‡æ¡£æ•°ç»„</span></span><br><span class="line">    SearchHit[] hits = searchHits.getHits();</span><br><span class="line">    <span class="comment">// 4.3.éå†</span></span><br><span class="line">    List&lt;HotelDoc&gt; hotels = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">        <span class="comment">// è·å–æ–‡æ¡£source</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">        <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line"><span class="comment">// æ”¾å…¥é›†åˆ</span></span><br><span class="line">        hotels.add(hotelDoc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.4.å°è£…è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(total, hotels);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="jiu-dian-jie-guo-guo-lu" id="é…’åº—ç»“æœè¿‡æ»¤">é…’åº—ç»“æœè¿‡æ»¤</h2><blockquote><p>éœ€æ±‚ï¼šæ·»åŠ å“ç‰Œã€åŸå¸‚ã€æ˜Ÿçº§ã€ä»·æ ¼ç­‰è¿‡æ»¤åŠŸèƒ½</p></blockquote><h3 id="xu-qiu-fen-xi-1" id="éœ€æ±‚åˆ†æ-2">éœ€æ±‚åˆ†æ</h3><p>åœ¨é¡µé¢æœç´¢æ¡†ä¸‹é¢ï¼Œä¼šæœ‰ä¸€äº›è¿‡æ»¤é¡¹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/2e379e4beb2e4e0c98b80c8aa57b72a7" alt="image-20210722091940726"></p><p>ä¼ é€’çš„å‚æ•°å¦‚å›¾ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/a869e08efd16490285d00b7729c489c3" alt="image-20210722092051994"></p><p>åŒ…å«çš„è¿‡æ»¤æ¡ä»¶æœ‰ï¼š</p><ul><li>brandï¼šå“ç‰Œå€¼</li><li>cityï¼šåŸå¸‚</li><li>minPrice~maxPriceï¼šä»·æ ¼èŒƒå›´</li><li>starNameï¼šæ˜Ÿçº§</li></ul><p>æˆ‘ä»¬éœ€è¦åšä¸¤ä»¶äº‹æƒ…ï¼š</p><ul><li>ä¿®æ”¹è¯·æ±‚å‚æ•°çš„å¯¹è±¡RequestParamsï¼Œæ¥æ”¶ä¸Šè¿°å‚æ•°</li><li>ä¿®æ”¹ä¸šåŠ¡é€»è¾‘ï¼Œåœ¨æœç´¢æ¡ä»¶ä¹‹å¤–ï¼Œæ·»åŠ ä¸€äº›è¿‡æ»¤æ¡ä»¶</li></ul><h3 id="xiu-gai-shi-ti-lei" id="ä¿®æ”¹å®ä½“ç±»">ä¿®æ”¹å®ä½“ç±»</h3><p>ä¿®æ”¹åœ¨<code>cn.itcast.hotel.pojo</code>åŒ…ä¸‹çš„å®ä½“ç±»RequestParamsï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestParams</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line">    <span class="keyword">private</span> Integer page;</span><br><span class="line">    <span class="keyword">private</span> Integer size;</span><br><span class="line">    <span class="keyword">private</span> String sortBy;</span><br><span class="line">    <span class="comment">// ä¸‹é¢æ˜¯æ–°å¢çš„è¿‡æ»¤æ¡ä»¶å‚æ•°</span></span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> String starName;</span><br><span class="line">    <span class="keyword">private</span> Integer minPrice;</span><br><span class="line">    <span class="keyword">private</span> Integer maxPrice;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="xiu-gai-sou-suo-ye-wu" id="ä¿®æ”¹æœç´¢ä¸šåŠ¡">ä¿®æ”¹æœç´¢ä¸šåŠ¡</h3><p>åœ¨HotelServiceçš„searchæ–¹æ³•ä¸­ï¼Œåªæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹ï¼šrequet.source().query( â€¦ )å…¶ä¸­çš„æŸ¥è¯¢æ¡ä»¶ã€‚</p><p>åœ¨ä¹‹å‰çš„ä¸šåŠ¡ä¸­ï¼Œåªæœ‰matchæŸ¥è¯¢ï¼Œæ ¹æ®å…³é”®å­—æœç´¢ï¼Œç°åœ¨è¦æ·»åŠ æ¡ä»¶è¿‡æ»¤ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>å“ç‰Œè¿‡æ»¤ï¼šæ˜¯keywordç±»å‹ï¼Œç”¨termæŸ¥è¯¢</li><li>æ˜Ÿçº§è¿‡æ»¤ï¼šæ˜¯keywordç±»å‹ï¼Œç”¨termæŸ¥è¯¢</li><li>ä»·æ ¼è¿‡æ»¤ï¼šæ˜¯æ•°å€¼ç±»å‹ï¼Œç”¨rangeæŸ¥è¯¢</li><li>åŸå¸‚è¿‡æ»¤ï¼šæ˜¯keywordç±»å‹ï¼Œç”¨termæŸ¥è¯¢</li></ul><p>å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ç»„åˆï¼Œè‚¯å®šæ˜¯booleanæŸ¥è¯¢æ¥ç»„åˆï¼š</p><ul><li>å…³é”®å­—æœç´¢æ”¾åˆ°mustä¸­ï¼Œå‚ä¸ç®—åˆ†</li><li>å…¶å®ƒè¿‡æ»¤æ¡ä»¶æ”¾åˆ°filterä¸­ï¼Œä¸å‚ä¸ç®—åˆ†</li></ul><p>å› ä¸ºæ¡ä»¶æ„å»ºçš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œå…ˆå°è£…ä¸ºä¸€ä¸ªå‡½æ•°ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/ed3b49480133473294849fbecf2b5d01" alt="image-20210722092935453"></p><p>buildBasicQueryçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildBasicQuery</span><span class="params">(RequestParams params, SearchRequest request)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æ„å»ºBooleanQuery</span></span><br><span class="line">    <span class="type">BoolQueryBuilder</span> <span class="variable">boolQuery</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">    <span class="comment">// 2.å…³é”®å­—æœç´¢</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> params.getKey();</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(key)) &#123;</span><br><span class="line">        boolQuery.must(QueryBuilders.matchAllQuery());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        boolQuery.must(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, key));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.åŸå¸‚æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (params.getCity() != <span class="literal">null</span> &amp;&amp; !params.getCity().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;city&quot;</span>, params.getCity()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.å“ç‰Œæ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (params.getBrand() != <span class="literal">null</span> &amp;&amp; !params.getBrand().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;brand&quot;</span>, params.getBrand()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.æ˜Ÿçº§æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (params.getStarName() != <span class="literal">null</span> &amp;&amp; !params.getStarName().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;starName&quot;</span>, params.getStarName()));</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 6.ä»·æ ¼</span></span><br><span class="line">    <span class="keyword">if</span> (params.getMinPrice() != <span class="literal">null</span> &amp;&amp; params.getMaxPrice() != <span class="literal">null</span>) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders</span><br><span class="line">                         .rangeQuery(<span class="string">&quot;price&quot;</span>)</span><br><span class="line">                         .gte(params.getMinPrice())</span><br><span class="line">                         .lte(params.getMaxPrice())</span><br><span class="line">                        );</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 7.æ”¾å…¥source</span></span><br><span class="line">    request.source().query(boolQuery);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="wo-zhou-bian-de-jiu-dian" id="æˆ‘å‘¨è¾¹çš„é…’åº—">æˆ‘å‘¨è¾¹çš„é…’åº—</h2><p>éœ€æ±‚ï¼šæˆ‘é™„è¿‘çš„é…’åº—</p><h3 id="xu-qiu-fen-xi-2" id="éœ€æ±‚åˆ†æ-3">éœ€æ±‚åˆ†æ</h3><p>åœ¨é…’åº—åˆ—è¡¨é¡µçš„å³ä¾§ï¼Œæœ‰ä¸€ä¸ªå°åœ°å›¾ï¼Œç‚¹å‡»åœ°å›¾çš„å®šä½æŒ‰é’®ï¼Œåœ°å›¾ä¼šæ‰¾åˆ°ä½ æ‰€åœ¨çš„ä½ç½®ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/04ff1c3d7fbd41368c148a18c4b07644" alt="image-20210722093414542"></p><p>å¹¶ä¸”ï¼Œåœ¨å‰ç«¯ä¼šå‘èµ·æŸ¥è¯¢è¯·æ±‚ï¼Œå°†ä½ çš„åæ ‡å‘é€åˆ°æœåŠ¡ç«¯ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/24802a1c1ddc4a4faf16fbab687f389b" alt="image-20210722093642382"></p><p>æˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±æ˜¯åŸºäºè¿™ä¸ªlocationåæ ‡ï¼Œç„¶åæŒ‰ç…§è·ç¦»å¯¹å‘¨å›´é…’åº—æ’åºã€‚å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>ä¿®æ”¹RequestParamså‚æ•°ï¼Œæ¥æ”¶locationå­—æ®µ</li><li>ä¿®æ”¹searchæ–¹æ³•ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœlocationæœ‰å€¼ï¼Œæ·»åŠ æ ¹æ®geo_distanceæ’åºçš„åŠŸèƒ½</li></ul><h3 id="xiu-gai-shi-ti-lei-1" id="ä¿®æ”¹å®ä½“ç±»-2">ä¿®æ”¹å®ä½“ç±»</h3><p>ä¿®æ”¹åœ¨<code>cn.itcast.hotel.pojo</code>åŒ…ä¸‹çš„å®ä½“ç±»RequestParamsï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestParams</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line">    <span class="keyword">private</span> Integer page;</span><br><span class="line">    <span class="keyword">private</span> Integer size;</span><br><span class="line">    <span class="keyword">private</span> String sortBy;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> String starName;</span><br><span class="line">    <span class="keyword">private</span> Integer minPrice;</span><br><span class="line">    <span class="keyword">private</span> Integer maxPrice;</span><br><span class="line">    <span class="comment">// æˆ‘å½“å‰çš„åœ°ç†åæ ‡</span></span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ju-chi-pai-xu-api" id="è·ç¦»æ’åºAPI">è·ç¦»æ’åºAPI</h3><p>æˆ‘ä»¬ä»¥å‰å­¦ä¹ è¿‡æ’åºåŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸¤ç§ï¼š</p><ul><li>æ™®é€šå­—æ®µæ’åº</li><li>åœ°ç†åæ ‡æ’åº</li></ul><p>æˆ‘ä»¬åªè®²äº†æ™®é€šå­—æ®µæ’åºå¯¹åº”çš„javaå†™æ³•ã€‚åœ°ç†åæ ‡æ’åºåªå­¦è¿‡DSLè¯­æ³•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"> Â <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;asc&quot;</span>Â Â </span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;_geo_distance&quot;</span>Â <span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;çº¬åº¦ï¼Œç»åº¦&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;order&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;asc&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;unit&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;km&quot;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„javaä»£ç ç¤ºä¾‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/f38d2023dbb645e2af3ffcfce8471b36" alt="image-20210722095227059"></p><h3 id="tian-jia-ju-chi-pai-xu" id="æ·»åŠ è·ç¦»æ’åº">æ·»åŠ è·ç¦»æ’åº</h3><p>åœ¨<code>cn.itcast.hotel.service.impl</code>çš„<code>HotelService</code>çš„<code>search</code>æ–¹æ³•ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ’åºåŠŸèƒ½ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/f24a41deb82342daa8b893341c0c32ff" alt="image-20210722095902314"></p><p>å®Œæ•´ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">search</span><span class="params">(RequestParams params)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">        <span class="comment">// 2.1.query</span></span><br><span class="line">        buildBasicQuery(params, request);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.2.åˆ†é¡µ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">page</span> <span class="operator">=</span> params.getPage();</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> params.getSize();</span><br><span class="line">        request.source().from((page - <span class="number">1</span>) * size).size(size);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.3.æ’åº</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">location</span> <span class="operator">=</span> params.getLocation();</span><br><span class="line">        <span class="keyword">if</span> (location != <span class="literal">null</span> &amp;&amp; !location.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            request.source().sort(SortBuilders</span><br><span class="line">                                  .geoDistanceSort(<span class="string">&quot;location&quot;</span>, <span class="keyword">new</span> <span class="title class_">GeoPoint</span>(location))</span><br><span class="line">                                  .order(SortOrder.ASC)</span><br><span class="line">                                  .unit(DistanceUnit.KILOMETERS)</span><br><span class="line">                                 );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">        <span class="keyword">return</span> handleResponse(response);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="pai-xu-ju-chi-xian-shi" id="æ’åºè·ç¦»æ˜¾ç¤º">æ’åºè·ç¦»æ˜¾ç¤º</h3><p>é‡å¯æœåŠ¡åï¼Œæµ‹è¯•æˆ‘çš„é…’åº—åŠŸèƒ½ï¼š</p><p><img src="assets/image-20210722100040674.png" alt="image-20210722100040674"></p><p>å‘ç°ç¡®å®å¯ä»¥å®ç°å¯¹æˆ‘é™„è¿‘é…’åº—çš„æ’åºï¼Œä¸è¿‡å¹¶æ²¡æœ‰çœ‹åˆ°é…’åº—åˆ°åº•è·ç¦»æˆ‘å¤šè¿œï¼Œè¿™è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>æ’åºå®Œæˆåï¼Œé¡µé¢è¿˜è¦è·å–æˆ‘é™„è¿‘æ¯ä¸ªé…’åº—çš„å…·ä½“<strong>è·ç¦»</strong>å€¼ï¼Œè¿™ä¸ªå€¼åœ¨å“åº”ç»“æœä¸­æ˜¯ç‹¬ç«‹çš„ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/f3adc6e0d3714dabac42411c8cf80745" alt="image-20210722095648542"></p><p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ç»“æœè§£æé˜¶æ®µï¼Œé™¤äº†è§£æsourceéƒ¨åˆ†ä»¥å¤–ï¼Œè¿˜è¦å¾—åˆ°sortéƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯æ’åºçš„è·ç¦»ï¼Œç„¶åæ”¾åˆ°å“åº”ç»“æœä¸­ã€‚</p><p>æˆ‘ä»¬è¦åšä¸¤ä»¶äº‹ï¼š</p><ul><li>ä¿®æ”¹HotelDocï¼Œæ·»åŠ æ’åºè·ç¦»å­—æ®µï¼Œç”¨äºé¡µé¢æ˜¾ç¤º</li><li>ä¿®æ”¹HotelServiceç±»ä¸­çš„handleResponseæ–¹æ³•ï¼Œæ·»åŠ å¯¹sortå€¼çš„è·å–</li></ul><ol><li>ä¿®æ”¹HotelDocç±»ï¼Œæ·»åŠ è·ç¦»å­—æ®µ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelDoc</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">    <span class="keyword">private</span> Integer score;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String starName;</span><br><span class="line">    <span class="keyword">private</span> String business;</span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line">    <span class="keyword">private</span> String pic;</span><br><span class="line">    <span class="comment">// æ’åºæ—¶çš„ è·ç¦»å€¼</span></span><br><span class="line">    <span class="keyword">private</span> Object distance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HotelDoc</span><span class="params">(Hotel hotel)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = hotel.getId();</span><br><span class="line">        <span class="built_in">this</span>.name = hotel.getName();</span><br><span class="line">        <span class="built_in">this</span>.address = hotel.getAddress();</span><br><span class="line">        <span class="built_in">this</span>.price = hotel.getPrice();</span><br><span class="line">        <span class="built_in">this</span>.score = hotel.getScore();</span><br><span class="line">        <span class="built_in">this</span>.brand = hotel.getBrand();</span><br><span class="line">        <span class="built_in">this</span>.city = hotel.getCity();</span><br><span class="line">        <span class="built_in">this</span>.starName = hotel.getStarName();</span><br><span class="line">        <span class="built_in">this</span>.business = hotel.getBusiness();</span><br><span class="line">        <span class="built_in">this</span>.location = hotel.getLatitude() + <span class="string">&quot;, &quot;</span> + hotel.getLongitude();</span><br><span class="line">        <span class="built_in">this</span>.pic = hotel.getPic();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>ä¿®æ”¹HotelServiceä¸­çš„handleResponseæ–¹æ³•</li></ol><p><img src="https://s1.vika.cn/space/2023/01/07/cd50fb44b0ac49f5aa5d74ec0de5cf81" alt="image-20210722100613966"></p><p>é‡å¯åæµ‹è¯•ï¼Œå‘ç°é¡µé¢èƒ½æˆåŠŸæ˜¾ç¤ºè·ç¦»äº†ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/d8becd2d8284462dad2761e5a847e1dd" alt="image-20210722100838604"></p><h2 id="jiu-dian-jing-jie-pai-ming" id="é…’åº—ç«ä»·æ’å">é…’åº—ç«ä»·æ’å</h2><blockquote><p>éœ€æ±‚ï¼šè®©æŒ‡å®šçš„é…’åº—åœ¨æœç´¢ç»“æœä¸­æ’åç½®é¡¶</p></blockquote><h3 id="xu-qiu-fen-xi-3" id="éœ€æ±‚åˆ†æ-4">éœ€æ±‚åˆ†æ</h3><p>è¦è®©æŒ‡å®šé…’åº—åœ¨æœç´¢ç»“æœä¸­æ’åç½®é¡¶</p><p>é¡µé¢ä¼šç»™æŒ‡å®šçš„é…’åº—æ·»åŠ <strong>å¹¿å‘Š</strong>æ ‡è®°ã€‚</p><p>é‚£æ€æ ·æ‰èƒ½è®©æŒ‡å®šçš„é…’åº—æ’åç½®é¡¶å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä¹‹å‰å­¦ä¹ è¿‡çš„function_scoreæŸ¥è¯¢å¯ä»¥å½±å“ç®—åˆ†ï¼Œç®—åˆ†é«˜äº†ï¼Œè‡ªç„¶æ’åä¹Ÿå°±é«˜äº†ã€‚è€Œfunction_scoreåŒ…å«3ä¸ªè¦ç´ ï¼š</p><ul><li>è¿‡æ»¤æ¡ä»¶ï¼šå“ªäº›æ–‡æ¡£è¦åŠ åˆ†</li><li>ç®—åˆ†å‡½æ•°ï¼šå¦‚ä½•è®¡ç®—function score</li><li>åŠ æƒæ–¹å¼ï¼šfunction score ä¸ query scoreå¦‚ä½•è¿ç®—</li></ul><p>è¿™é‡Œçš„éœ€æ±‚æ˜¯ï¼šè®©<strong>æŒ‡å®šé…’åº—</strong>æ’åé å‰ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ç»™è¿™äº›é…’åº—æ·»åŠ ä¸€ä¸ªæ ‡è®°ï¼Œè¿™æ ·åœ¨è¿‡æ»¤æ¡ä»¶ä¸­å°±å¯ä»¥<strong>æ ¹æ®è¿™ä¸ªæ ‡è®°æ¥åˆ¤æ–­ï¼Œæ˜¯å¦è¦æé«˜ç®—åˆ†</strong>ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬ç»™é…’åº—æ·»åŠ ä¸€ä¸ªå­—æ®µï¼šisADï¼ŒBooleanç±»å‹ï¼š</p><ul><li>trueï¼šæ˜¯å¹¿å‘Š</li><li>falseï¼šä¸æ˜¯å¹¿å‘Š</li></ul><p>è¿™æ ·function_scoreåŒ…å«3ä¸ªè¦ç´ å°±å¾ˆå¥½ç¡®å®šäº†ï¼š</p><ul><li>è¿‡æ»¤æ¡ä»¶ï¼šåˆ¤æ–­isAD æ˜¯å¦ä¸ºtrue</li><li>ç®—åˆ†å‡½æ•°ï¼šæˆ‘ä»¬å¯ä»¥ç”¨æœ€ç®€å•æš´åŠ›çš„weightï¼Œå›ºå®šåŠ æƒå€¼</li><li>åŠ æƒæ–¹å¼ï¼šå¯ä»¥ç”¨é»˜è®¤çš„ç›¸ä¹˜ï¼Œå¤§å¤§æé«˜ç®—åˆ†</li></ul><p>å› æ­¤ï¼Œä¸šåŠ¡çš„å®ç°æ­¥éª¤åŒ…æ‹¬ï¼š</p><ol><li><p>ç»™HotelDocç±»æ·»åŠ isADå­—æ®µï¼ŒBooleanç±»å‹</p></li><li><p>æŒ‘é€‰å‡ ä¸ªä½ å–œæ¬¢çš„é…’åº—ï¼Œç»™å®ƒçš„æ–‡æ¡£æ•°æ®æ·»åŠ isADå­—æ®µï¼Œå€¼ä¸ºtrue</p></li><li><p>ä¿®æ”¹searchæ–¹æ³•ï¼Œæ·»åŠ function scoreåŠŸèƒ½ï¼Œç»™isADå€¼ä¸ºtrueçš„é…’åº—å¢åŠ æƒé‡</p></li></ol><h3 id="xiu-gai-hotel-doc-shi-ti" id="ä¿®æ”¹HotelDocå®ä½“">ä¿®æ”¹HotelDocå®ä½“</h3><p>ç»™<code>cn.itcast.hotel.pojo</code>åŒ…ä¸‹çš„HotelDocç±»æ·»åŠ isADå­—æ®µï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/31d8cf89de9945dcb31c4a1bff05e14e" alt="image-20210722101908062"></p><h3 id="tian-jia-yan-gao-biao-ji" id="æ·»åŠ å¹¿å‘Šæ ‡è®°">æ·»åŠ å¹¿å‘Šæ ‡è®°</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ‘å‡ ä¸ªé…’åº—ï¼Œæ·»åŠ isADå­—æ®µï¼Œè®¾ç½®ä¸ºtrueï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">POST /hotel/_update/<span class="number">1902197537</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;isAD&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">POST /hotel/_update/<span class="number">2056126831</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;isAD&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">POST /hotel/_update/<span class="number">1989806195</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;isAD&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">POST /hotel/_update/<span class="number">2056105938</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;isAD&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="tian-jia-suan-fen-han-shu-cha-xun" id="æ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢">æ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦ä¿®æ”¹æŸ¥è¯¢æ¡ä»¶äº†ã€‚ä¹‹å‰æ˜¯ç”¨çš„boolean æŸ¥è¯¢ï¼Œç°åœ¨è¦æ”¹æˆfunction_socreæŸ¥è¯¢ã€‚</p><p>function_scoreæŸ¥è¯¢ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/4570cb2e4fd245e5894b70846f651d58" alt="image-20210721191544750"></p><p>å¯¹åº”çš„JavaAPIå¦‚ä¸‹ï¼š</p><p><img src="https://s1.vika.cn/space/2023/01/07/2753a82636ed488da153ff82bd862c74" alt="image-20210722102850818"></p><p>æˆ‘ä»¬å¯ä»¥å°†ä¹‹å‰å†™çš„booleanæŸ¥è¯¢ä½œä¸º<strong>åŸå§‹æŸ¥è¯¢</strong>æ¡ä»¶æ”¾åˆ°queryä¸­ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ·»åŠ <strong>è¿‡æ»¤æ¡ä»¶</strong>ã€<strong>ç®—åˆ†å‡½æ•°</strong>ã€<strong>åŠ æƒæ¨¡å¼</strong>äº†ã€‚æ‰€ä»¥åŸæ¥çš„ä»£ç ä¾ç„¶å¯ä»¥æ²¿ç”¨ã€‚</p><p>ä¿®æ”¹<code>cn.itcast.hotel.service.impl</code>åŒ…ä¸‹çš„<code>HotelService</code>ç±»ä¸­çš„<code>buildBasicQuery</code>æ–¹æ³•ï¼Œæ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildBasicQuery</span><span class="params">(RequestParams params, SearchRequest request)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æ„å»ºBooleanQuery</span></span><br><span class="line">    <span class="type">BoolQueryBuilder</span> <span class="variable">boolQuery</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">    <span class="comment">// å…³é”®å­—æœç´¢</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> params.getKey();</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(key)) &#123;</span><br><span class="line">        boolQuery.must(QueryBuilders.matchAllQuery());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        boolQuery.must(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, key));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŸå¸‚æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (params.getCity() != <span class="literal">null</span> &amp;&amp; !params.getCity().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;city&quot;</span>, params.getCity()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å“ç‰Œæ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (params.getBrand() != <span class="literal">null</span> &amp;&amp; !params.getBrand().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;brand&quot;</span>, params.getBrand()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ˜Ÿçº§æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (params.getStarName() != <span class="literal">null</span> &amp;&amp; !params.getStarName().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;starName&quot;</span>, params.getStarName()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä»·æ ¼</span></span><br><span class="line">    <span class="keyword">if</span> (params.getMinPrice() != <span class="literal">null</span> &amp;&amp; params.getMaxPrice() != <span class="literal">null</span>) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders</span><br><span class="line">                         .rangeQuery(<span class="string">&quot;price&quot;</span>)</span><br><span class="line">                         .gte(params.getMinPrice())</span><br><span class="line">                         .lte(params.getMaxPrice())</span><br><span class="line">                        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ç®—åˆ†æ§åˆ¶</span></span><br><span class="line">    <span class="type">FunctionScoreQueryBuilder</span> <span class="variable">functionScoreQuery</span> <span class="operator">=</span></span><br><span class="line">        QueryBuilders.functionScoreQuery(</span><br><span class="line">        <span class="comment">// åŸå§‹æŸ¥è¯¢ï¼Œç›¸å…³æ€§ç®—åˆ†çš„æŸ¥è¯¢</span></span><br><span class="line">        boolQuery,</span><br><span class="line">        <span class="comment">// function scoreçš„æ•°ç»„</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder[]&#123;</span><br><span class="line">            <span class="comment">// å…¶ä¸­çš„ä¸€ä¸ªfunction score å…ƒç´ </span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder(</span><br><span class="line">                <span class="comment">// è¿‡æ»¤æ¡ä»¶</span></span><br><span class="line">                QueryBuilders.termQuery(<span class="string">&quot;isAD&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">                <span class="comment">// ç®—åˆ†å‡½æ•°</span></span><br><span class="line">                ScoreFunctionBuilders.weightFactorFunction(<span class="number">10</span>)</span><br><span class="line">            )</span><br><span class="line">        &#125;);</span><br><span class="line">    request.source().query(functionScoreQuery);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">åˆ†å¸ƒå¼æœç´¢ç¬”è®°02ï¼ˆDSLã€RestClientï¼‰</summary>
    
    
    
    <category term="Java" scheme="https://www.taoyaopc.live/categories/Java/"/>
    
    
  </entry>
  
</feed>
